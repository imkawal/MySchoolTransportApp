"use strict";(self.webpackChunkskype4life=self.webpackChunkskype4life||[]).push([[789],{715602:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(994224),s=i(502278),r=i(480200),l=i(469840),c=i(711930),d=i(898278),u=i(677381),h=i(746096),p=i(436237),g=i(915877),C=i(733754),S=i(164723),m=i(693446),y=i(104735),f=i(29130),b=i(172425),_=i(886045),T=i(22222),v=i(581760),w=i(311010),I=i(711828),P=i(680837),M=i(790970),k=i(619675),A=i(853374),R=i(889391),x=(0,g.lazyProperties)({commonTextStyle:()=>n.Styles.createTextStyle({textAlign:"center"}),headerStyle:()=>n.Styles.createTextStyle({color:v.Color.white,marginTop:20,marginBottom:10}),textStyleLightTheme:()=>n.Styles.createTextStyle({color:v.Color.gray300}),subTextStyle:()=>n.Styles.createTextStyle({paddingTop:5,color:v.Color.whiteOverlay70,maxWidth:360,marginBottom:20}),containerStyle:()=>n.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"center",paddingBottom:180,backgroundColor:v.Color.blackOverlay20,paddingHorizontal:10}),containerStyleDesktopCallStage:()=>n.Styles.createViewStyle({paddingBottom:110,backgroundColor:v.Color.transparent}),containerStyleOnMobile:()=>n.Styles.createViewStyle({paddingBottom:80}),containerStyleOnMobileForPortraitMode:()=>n.Styles.createViewStyle({paddingBottom:100}),hyperLinkText:()=>n.Styles.createTextStyle({color:v.Color.blue}),hyperLinkStyle:()=>n.Styles.createTextStyle({marginTop:-15}),subTextContainer:()=>n.Styles.createTextStyle({alignItems:"center",justifyContent:"center",marginTop:-5}),containerNewCallScreenStage:()=>n.Styles.createViewStyle({paddingBottom:105,backgroundColor:v.Color.transparent}),containerNewCallScreenStageDesktop:()=>n.Styles.createViewStyle({paddingBottom:125}),innerContainerNewCallScreenStage:()=>n.Styles.createViewStyle({padding:16,marginHorizontal:16,borderRadius:16,backgroundColor:v.Color.gray400Overlay70,alignItems:"center",alignSelf:"stretch"}),innerContainerNewCallScreenStageCentered:()=>n.Styles.createViewStyle({alignSelf:"center",minWidth:360}),textStyleNewCallScreenStage:()=>n.Styles.createTextStyle({color:v.Color.white,font:w.default.font.uiDisplayRegular,fontSize:w.default.controlFontSize.body}),headerTextStyleNewCallScreenStage:()=>n.Styles.createTextStyle({marginTop:0,marginBottom:16}),hyperLinkStyleNewCallScreenStage:()=>n.Styles.createTextStyle({marginTop:8,marginBottom:0,color:v.Color.avatarBlueLight,fontSize:w.default.controlFontSize.body})});class L extends u.default{constructor(){super(...arguments),this._onInviteButtonRef=e=>{this._shareInviteButtonRef=e||void 0},this._getShareInviteButtonRef=()=>this._shareInviteButtonRef,this._onShareInvitePress=e=>{this.state.joinLink?m.default.show({anchor:this._getShareInviteButtonRef,event:e,rootViewId:this._getRootViewId(),positionPriorities:["bottom","top"],threadId:this.props.conversationMri,joinLink:this.state.joinLink,meetNowParameters:{origin:S.MeetNowOrigin.MessageStream},allowJoiningLink:!0}):p.log(h.LogTraceArea.JoinLink,`AloneInTheCallInformationView._onShareInvitePress cannot show the menu because join link is not defined joinLink: ${this.state.joinLink}, threadId: ${this.props.conversationMri}`)},this._onHyperLinkPress=e=>{const t=A.default.newCauseId();p.log(h.LogTraceArea.CallingUI,"GoLiveInformationView._onHyperLinkPress, causeId: "+t),y.default.openCallRoster(this.props.conversationMri,this.props.callId,t,this._getContext()),M.default.createSession(this.props.callId,r.CallRosterOrigin.GoLiveInformationView,!1),s.default.updateCallTelemetry(this.props.callId,t,(e=>e.callRosterOpenedCount()))},this._onRingTheGroupButtonPress=()=>{b.default.handleRingTheGroup(this.props.conversationMri,this.props.callId);const e=C.getString("CallPanel.GroupCallRingingStatusMessage");n.Accessibility.announceForAccessibility(e),s.default.trackRingTheGroup(this.props.callId)},this._getHeaderText=()=>{switch(this.state.ringlessCallType){case b.LocallyStartedRinglessCallType.OnePerson:case b.LocallyStartedRinglessCallType.SmallGroup:return C.getString("CallPanel.GroupCallWithOnlyCallInitiatorMessage");case b.LocallyStartedRinglessCallType.LargeGroup:return C.getString("CallPanel.RinglessCallHeader");default:return}},this._getText=()=>{switch(this.state.ringlessCallType){case b.LocallyStartedRinglessCallType.OnePerson:return;case b.LocallyStartedRinglessCallType.SmallGroup:return this.state.hasRingingParticipants?C.getString("CallPanel.GroupCallRingingStatusMessage"):C.getString("CallPanel.GroupCallNotifiedTheGroupMessage");case b.LocallyStartedRinglessCallType.LargeGroup:return C.getString("CallPanel.RinglessCallDescription");default:return}}}_buildState(e,t){const i=o.default.CallingStore.hasRingingParticipants(e.callId,!0),a=o.default.CallingStore.isCallConnected(e.callId),n=R.default.getS4LUiFeatures().enableRefreshedPalette,s=b.default.getRinglessCallType(e.conversationMri,e.callId);return{hasRingingParticipants:i,isCallConnected:a,ringlessCallType:s,joinLink:s===b.LocallyStartedRinglessCallType.OnePerson?l.default.getLink(e.conversationMri):void 0,enableRefreshedPalette:n,isViewCentered:!f.default.isWidthSmallerThanThreshold(392,this._getRootViewId())}}componentDidMount(){super.componentDidMount(),this._announceForAccessibility()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!this.state.hasRingingParticipants&&t.hasRingingParticipants&&this._announceForAccessibility()}render(){const e=this._getHeaderText(),t=(0,a.jsx)(n.Text,Object.assign({style:this._getHeaderStyles()},{children:e})),i=this._renderSubText(),o=this._renderRingTheGroupButton(),s=this.state.ringlessCallType===b.LocallyStartedRinglessCallType.OnePerson?this._renderInviteButton():void 0;return this.props.isNewCallScreen?this._renderNewCallScreenStageView(t,i,o,s):(0,a.jsxs)(n.View,Object.assign({style:this._getContainerStyles(),ignorePointerEvents:!0},{children:[t,i,o,s]}))}_renderNewCallScreenStageView(e,t,i,o){if(void 0===this.state.ringlessCallType||this.state.ringlessCallType===b.LocallyStartedRinglessCallType.GoLive||this.state.ringlessCallType===b.LocallyStartedRinglessCallType.None)return null;const s=[x.innerContainerNewCallScreenStage];return this.state.isViewCentered&&s.push(x.innerContainerNewCallScreenStageCentered),(0,a.jsx)(n.View,Object.assign({style:this._getContainerStyles(),ignorePointerEvents:!0},{children:(0,a.jsxs)(n.View,Object.assign({style:s},{children:[e,t,i,o]}))}))}_announceForAccessibility(){let e;e=this._isRingTheGroupAvailable()||this.state.ringlessCallType===b.LocallyStartedRinglessCallType.LargeGroup?this._getAdditionalScreenReaderText():this._getText();const t=c.default.combinedAccessibilityLabel(this._getHeaderText(),e);_.default.maybeAnnounceForAccessibility(t,100)}_renderInviteButton(){return(0,a.jsx)(T.default,{ref:this._onInviteButtonRef,title:C.getString("MeetNow.ShareInvite"),onPress:this._onShareInvitePress,buttonSize:d.SXButtonSize.Medium,iconSize:I.IconSize.size14,iconPositon:d.SXButtonIconPosition.End,disabled:!this.state.joinLink},"invite")}_renderRingTheGroupButton(){if(!this._isRingTheGroupAvailable())return;const e=this.state.enableRefreshedPalette?{}:{buttonStyle:d.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:v.AgnosticGradientFillButtonColors.blue};return(0,a.jsx)(T.default,Object.assign({},e,{buttonSize:d.SXButtonSize.Medium,title:C.getString("CallPanel.GroupCallRingTheGroupButtonTitle"),allowTextWrap:!0,onPress:this._onRingTheGroupButtonPress,disabled:!this.state.isCallConnected}))}_renderSubText(){const e=this._getText();if(!e)return;if(this.state.ringlessCallType===b.LocallyStartedRinglessCallType.SmallGroup&&!this.state.hasRingingParticipants)return;const t=[x.subTextStyle,x.commonTextStyle,w.default.fontStyle.panelHeader,this.props.useLightTheme?x.textStyleLightTheme:void 0,this.props.isNewCallScreen?x.textStyleNewCallScreenStage:void 0];return(0,a.jsxs)(n.View,Object.assign({style:x.subTextContainer},{children:[(0,a.jsx)(n.Text,Object.assign({style:t},{children:e})),this._renderHyperLink()]}))}_renderHyperLink(){if(this.state.ringlessCallType!==b.LocallyStartedRinglessCallType.LargeGroup)return;const e=[x.subTextStyle,x.commonTextStyle,x.hyperLinkText,w.default.fontStyle.panelHeader,this.props.isNewCallScreen?x.hyperLinkStyleNewCallScreenStage:void 0],t=C.getString("CallPanel.RinglessCallHyperLink");return(0,a.jsx)(n.Button,Object.assign({onPress:this._onHyperLinkPress,style:x.hyperLinkStyle,accessibilityLabel:t},{children:(0,a.jsx)(k.BodyText,Object.assign({style:e},{children:t}))}))}_getAdditionalScreenReaderText(){return this.state.ringlessCallType===b.LocallyStartedRinglessCallType.LargeGroup?C.getString("CallPanel.RinglessCallHyperLinkScreenReaderText"):C.getString("CallPanel.GroupCallRingTheGroupButtonDescriptiveScreenReaderText")}_isRingTheGroupAvailable(){return!this.state.hasRingingParticipants&&this.state.ringlessCallType===b.LocallyStartedRinglessCallType.SmallGroup}_getContainerStyles(){const e=[x.containerStyle,P.default.absoluteFill];return this.props.useDesktopCallControls&&e.push(x.containerStyleDesktopCallStage),this.props.callControlsType!==r.CallControlsType.DesktopMinSmallest&&(this.props.isLandscape?e.push(x.containerStyleOnMobile):e.push(x.containerStyleOnMobileForPortraitMode)),this.props.isNewCallScreen&&(e.push(x.containerNewCallScreenStage),e.push(x.containerNewCallScreenStageDesktop)),this.props.style&&e.push(n.Styles.createViewStyle(this.props.style,!1)),e}_getHeaderStyles(){const e=[x.headerStyle,x.commonTextStyle];return this.props.useLightTheme&&e.push(x.textStyleLightTheme),e.push(w.default.fontStyle.messagingHeaderSmall),this.props.isNewCallScreen&&(e.push(x.textStyleNewCallScreenStage),e.push(x.headerTextStyleNewCallScreenStage)),e}}t.default=L},230734:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(583367),o=i(823113),s=i(516778),r=i(244770),l=i(581760),c=i(462033),d=i(67930),u=i(898278),h=i(437490),p=i(746096),g=i(436237),C=i(915877),S=i(733754),m=i(581736),y=i(29130),f=i(451070),b=i(681115),_=i(910265),T=i(22222),v=i(680837),w=i(619675),I=i(853374),P=(0,C.lazyProperties)({container:()=>s.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"center",alignItems:"center"}),containerLandscape:()=>s.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center",alignItems:"center"}),innerContainer:()=>s.Styles.createViewStyle({flexBasis:0,flex:1,justifyContent:"center",alignItems:"stretch",alignSelf:"stretch"}),imageContainer:()=>s.Styles.createViewStyle({flexBasis:0,flex:1,alignSelf:"stretch"}),headerText:()=>s.Styles.createTextStyle({marginVertical:15,marginHorizontal:10,textAlign:"center"}),descriptionText:()=>s.Styles.createTextStyle({marginBottom:15,marginHorizontal:10,textAlign:"center"}),button:()=>s.Styles.createButtonStyle({marginHorizontal:20,alignSelf:"stretch"})});class M extends d.default{constructor(){super(...arguments),this._onBack=()=>(this._submitPressedTrue(),!0),this._submitPressedTrue=()=>this._submitPressed(!0),this._submitPressedFalse=()=>this._submitPressed(!1)}_buildState(e,t){const i=this._getRootViewId();return{isLandscape:y.default.getDeviceOrientation(i)===n.DeviceOrientation.Landscape,safeAreaHorizontalInsets:f.default.horizontalInsets()}}componentDidMount(){super.componentDidMount(),h.dismissAll(),c.default.subscribe(this._onBack)}componentWillUnmount(){super.componentWillUnmount(),c.default.unsubscribe(this._onBack)}render(){const e=this._getHeaderText(this.state),t=[P.innerContainer];this.state.safeAreaHorizontalInsets.right&&t.push(b.default.horizontalPaddingStyle({right:this.state.safeAreaHorizontalInsets.right,left:0}));const i=(0,a.jsxs)(s.View,Object.assign({style:this.state.isLandscape?P.containerLandscape:P.container},{children:[(0,a.jsx)(s.View,Object.assign({style:P.imageContainer},{children:(0,a.jsx)(s.Image,{source:r.Collection.ANDROID_CALL_MONITOR_PERM_ILLUSTRATION,style:v.default.flexOne,resizeMode:"cover"})})),(0,a.jsxs)(s.View,Object.assign({style:t},{children:[(0,a.jsx)(w.PanelHeader,Object.assign({style:P.headerText},{children:e})),(0,a.jsx)(w.BodyText,Object.assign({style:P.descriptionText},{children:S.getString("AndroidCallMonitorPermissionsPanel.DescriptionText")})),(0,a.jsx)(T.default,{style:P.button,buttonStyle:u.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:l.AgnosticGradientFillButtonColors.blue,onPress:this._submitPressedFalse,title:S.getString("AndroidCallMonitorPermissionsPanel.GrantPermissionButtonTitle")}),(0,a.jsx)(T.default,{buttonStyle:u.SXButtonStyle.ThemeNoBackground,buttonSize:u.SXButtonSize.Medium,style:P.button,onPress:this._submitPressedTrue,title:S.getString("AndroidCallMonitorPermissionsPanel.NotNowButtonTitle")})]}))]}));return(0,a.jsx)(_.default,Object.assign({dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:void 0,maxHeight:void 0,fullScreen:!0,useFullSizeContainer:!0,accessibilityLabel:e},{children:(0,a.jsx)(s.View,Object.assign({style:[v.default.flexOne,this._themeStyles.primaryBackgroundColorStyle]},{children:i}))}))}_submitPressed(e){const t=I.default.newCauseId();g.log(p.LogTraceArea.Navigation,"AndroidCallMonitorPermissionPanel._submitPressed, causeId"+t),this.isComponentMounted(),m.default.updateDrawOverPrePermissionStatus(e?o.PermissionStatus.Denied:o.PermissionStatus.Granted),e||o.default.requestDrawOverPermission(),this._goBack(t)}_getHeaderText(e){return S.getString("AndroidCallMonitorPermissionsPanel.HeaderText")}}t.default=M},332143:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=(i(285788),i(665768)),o=i(516778),s=i(217041),r=i(775492),l=i(994224),c=i(47447),d=i(110117),u=i(283706),h=i(915877),p=i(330124),g=i(681115),C=i(886045),S=i(581760),m=i(640363),y=i(711828),f=i(619675),b=(0,h.lazyProperties)({warningContainer:()=>o.Styles.createViewStyle({position:"absolute",bottom:0,left:0,right:0,height:30}),warningContainerNewCallScreenStage:()=>o.Styles.createViewStyle({alignItems:"center",bottom:10,backgroundColor:S.Color.transparent}),warningContainerNewCallScreenStageDesktop:()=>o.Styles.createViewStyle({bottom:85}),innerContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",paddingVertical:5,marginHorizontal:50}),innerContainerNewCallScreenStage:()=>o.Styles.createViewStyle({paddingHorizontal:10,borderRadius:5,backgroundColor:S.Color.gray400Overlay70}),statusText:()=>o.Styles.createTextStyle({color:S.Color.white,backgroundColor:S.Color.transparent}),iconPadding:()=>o.Styles.createViewStyle({paddingRight:10}),iconPaddingRTL:()=>o.Styles.createViewStyle({paddingLeft:10}),desktopCallControlsStyle:()=>o.Styles.createViewStyle({bottom:70})});class _ extends s.ComponentBase{constructor(){super(...arguments),this._onAnimatedWaringRef=e=>{this._animatedView=e||void 0}}_buildState(e,t){const i=p.default.isUsingStackNavigationContext(),a=c.CallingCapabilities.speakerVolumeControlSupported();return{isNotificationHidden:e.hideNotification||i&&r.default.isOverflowMenuVisible(),showMicrophoneMuted:e.isMicrophoneMutedWhileSpeaking||l.default.CallingStore.isMicrophoneMuted(e.callId),callAudioOutputRoute:l.default.CallControlsStore.getAudioOutput(),speakerVolumeControlSupported:a,isSpeakerMuted:!!a&&(l.default.CallingStore.isSpeakerMuted(e.callId)||0===l.default.DeviceStore.getSpeakerVolume())}}componentDidMount(){super.componentDidMount(),this._getWarningViewinfo(),this.state.viewInformation&&C.default.maybeAnnounceForAccessibility(this.state.viewInformation.warningText)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._getWarningViewinfo(),this.state.isNotificationHidden!==t.isNotificationHidden&&this._showOrHideWarningView(!this.state.isNotificationHidden,!1),!this.state.viewInformation||t.viewInformation&&t.viewInformation.warningText===this.state.viewInformation.warningText||C.default.maybeAnnounceForAccessibility(this.state.viewInformation.warningText)}_showOrHideWarningView(e,t=!0,i=0){this.isComponentMounted()&&this._animatedView&&(this._animatedView.stop(),t?e?this._animatedView.fadeIn(void 0,void 0,{delay:i}):this._animatedView.fadeOut(void 0,void 0,{delay:i}):this._animatedView.setValue({opacity:e?1:0}))}render(){if(!this.state.viewInformation)return null;const e=[b.warningContainer];let t,i;this.props.bottomPadding&&(e.push(g.default.paddingBottomStyle(this.props.bottomPadding)),e.push(g.default.heightStyle(30+this.props.bottomPadding))),this.state.viewInformation&&(i=this.state.viewInformation.warningText?this._getWarningText(this.state.viewInformation.warningText):void 0,t=this.state.viewInformation.icon?this._getWarningIcon(this.state.viewInformation.icon):void 0),this.props.useDesktopCallControls&&e.push(b.desktopCallControlsStyle);const s=[b.innerContainer];return this.props.isNewCallScreen&&(e.push(b.warningContainerNewCallScreenStage),s.push(b.innerContainerNewCallScreenStage),e.push(b.warningContainerNewCallScreenStageDesktop)),e.push(this.props.style),(0,a.jsx)(o.View,Object.assign({style:e,blockPointerEvents:!0,ignorePointerEvents:!0},{children:(0,a.jsxs)(n.View,Object.assign({ref:this._onAnimatedWaringRef,style:s},{children:[t,i]}))}))}_getWarningViewinfo(){let e;(this.state.speakerVolumeControlSupported||this.state.showMicrophoneMuted)&&(e=u.default.getViewInformationForAudioMuted(this.state.showMicrophoneMuted,this.state.isSpeakerMuted)),this.setState({viewInformation:e})}_getWarningText(e){return(0,a.jsx)(f.BodyText,Object.assign({style:b.statusText},{children:e}))}_getWarningIcon(e){let t=S.Color.white;return this.state.viewInformation&&this.state.viewInformation.optionalIconColor&&(t=this.state.viewInformation.optionalIconColor),(0,a.jsx)(d.default,{icon:e,size:y.IconSize.size15,color:t,style:m.default.isRTL()?b.iconPaddingRTL:b.iconPadding})}}t.default=_},379231:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioOutputRouteHelper=void 0;const a=i(285788),n=i(889391),o=i(733754),s=(i(404057),i(640363),i(711828));t.AudioOutputRouteHelper=class{static displayInfoForOutputRoute(e){let t=s.SkypeIcon.VolumeMax,i="CallControls.CallButtonSpeaker",n="CallControls.CallButtonSpeakerAccessibilityLabel";return e&&(e===a.default.AudioOutputEarpiece?(t=s.SkypeIcon.VolumeOff,i="CallControls.CallButtonEarpiece",n="CallControls.CallButtonEarpieceAccessibilityLabel"):e===a.default.AudioOutputWiredHeadset?(t=s.SkypeIcon.Headset,i="CallControls.CallButtonHeadset",n="CallControls.CallButtonHeadsetAccessibilityLabel"):e===a.default.AudioOutputBluetooth&&(t=s.SkypeIcon.Bluetooth,i="CallControls.CallButtonBluetooth",n="CallControls.CallButtonBluetoothAccessibilityLabel")),{icon:t,title:o.getString(i),accessibilityLabel:o.getString(n)}}static useiOSRoutePicker(){n.default.getSkypeAudioLibraryFeatures().ECS_AudioDL_DisableRouteChangeNotification;return!1}}},841789:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioRouteSelectionPresenter=t.AudioOutputRouteStrings=void 0;const a=i(496486),n=i(285788),o=i(994224),s=i(502278),r=i(746096),l=i(436237),c=i(733754),d=i(293194);var u;!function(e){e.CallButtonEarpiece="CallControls.CallButtonEarpiece",e.CallButtonSpeaker="CallControls.CallButtonSpeaker",e.CallButtonBluetooth="CallControls.CallButtonBluetooth",e.CallButtonHeadset="CallControls.CallButtonHeadset"}(u=t.AudioOutputRouteStrings||(t.AudioOutputRouteStrings={}));const h={[n.default.AudioOutputEarpiece]:u.CallButtonEarpiece,[n.default.AudioOutputSpeaker]:u.CallButtonSpeaker,[n.default.AudioOutputBluetooth]:u.CallButtonBluetooth,[n.default.AudioOutputWiredHeadset]:u.CallButtonHeadset},p={[n.default.AudioOutputEarpiece]:"Earpiece",[n.default.AudioOutputSpeaker]:"Speaker",[n.default.AudioOutputBluetooth]:"Bluetooth",[n.default.AudioOutputWiredHeadset]:"WiredHeadset",[n.default.AudioOutputOther]:"Other"};t.AudioRouteSelectionPresenter=class{constructor(e){this._causeId=e,this._providingVideo=!1,this._onMenuCancelled=()=>{const e=o.default.CallControlsStore.getAudioOutput(),t=p[e];s.default.trackAudioOutputRouteChange(t,t)},this._onMenuItemSelected=e=>{switch(l.log(r.LogTraceArea.CallingUI,`AudioRouteSelectionPresenter,_onMenuItemSelected command: ${e} causeId: ${this._causeId}`),e){case u.CallButtonEarpiece:this._requestAudioOutputRoute(n.default.AudioOutputEarpiece);break;case u.CallButtonSpeaker:this._requestAudioOutputRoute(n.default.AudioOutputSpeaker);break;case u.CallButtonBluetooth:this._requestAudioOutputRoute(n.default.AudioOutputBluetooth);break;case u.CallButtonHeadset:this._requestAudioOutputRoute(n.default.AudioOutputWiredHeadset)}this._resumeCallControlTimer&&this._resumeCallControlTimer()}}setUserProvidingVideo(e){this._providingVideo=e}setControlTimerHandlers(e,t){this._suspendCallControlTimer=e,this._resumeCallControlTimer=t}show(e,t,i){const s=o.default.CallControlsStore.getAudioOutput();n.default.requestAvailableOutputRoutesArray(s).then((o=>{this._providingVideo&&(o=a.filter(o,(e=>e!==n.default.AudioOutputEarpiece))),o.length>2?this._showMenu(e,t,i,o):2===o.length?this._toggleRoutes(o,s):l.log(r.LogTraceArea.CallingUI,`AudioRouteSelectionPresenter.show() only single route option available current: ${s} available: ${o} causeId: ${this._causeId}`)}))}_toggleRoutes(e,t){e[0]===t?this._requestAudioOutputRoute(e[1]):this._requestAudioOutputRoute(e[0]),this._resumeCallControlTimer&&this._resumeCallControlTimer()}_showMenu(e,t,i,n){const o=[];a.each(n,(e=>{e?o.push({text:c.getString(h[e]),command:h[e]}):l.warn(r.LogTraceArea.CallingUI,"AudioRouteSelectionPresenter._showMenu invalid route in outputRoutes")})),this._suspendCallControlTimer&&this._suspendCallControlTimer(),d.default.showWithActionMenuConfig({options:{anchor:i,buttons:o,title:c.getString("CallPanel.SelectAudioRouteTitle")},callback:this._onMenuItemSelected,maintainAnchor:!0,rootViewId:e,onCancel:this._onMenuCancelled,invokingEvent:t})}_requestAudioOutputRoute(e){const t=o.default.CallControlsStore.getAudioOutput();s.default.trackAudioOutputRouteChange(p[t],p[e]),n.default.requestOutput(e)}}},267743:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(775352),s=i(994224),r=i(109520),l=i(502278),c=i(587134),d=i(285043),u=i(915877),h=i(733754),p=i(535337),g=i(442484),C=i(619675),S=(0,u.lazyProperties)({popupContainer:()=>n.Styles.createViewStyle({width:300,paddingHorizontal:15,borderRadius:5,opacity:.85}),popupTitleRow:()=>n.Styles.createTextStyle({marginTop:15,flexDirection:"row",justifyContent:"space-between"})});class m extends d.HoverPopup{constructor(){super(...arguments),this._allowShowPopup=()=>this._defaultAllowShowPopupConditions()&&!this.state.isAwaitingCameraConfirmation,this._allowHidePopup=()=>this._defaultAllowHidePopupConditions(),this._onMicrophoneSelected=e=>{l.default.updateCallAudioSettingsPopupEvent((t=>{e&&t.markDidChangeMicDevice()}))},this._onSpeakerSelected=e=>{l.default.updateCallAudioSettingsPopupEvent((t=>{e&&t.markDidChangeSpeakerDevice()}))},this._onAdjustSpeakerVolume=()=>{l.default.updateCallAudioSettingsPopupEvent((e=>e.markDidAdjustSpeakerVolume()))},this._onAdjustMicVolume=()=>{l.default.updateCallAudioSettingsPopupEvent((e=>e.markDidAdjustMicVolume()))},this._onToggleMusicMode=e=>{l.default.updateCallAudioSettingsPopupEvent((e=>e.markDidChangeMusicMode()))},this._onToggleAECMode=e=>{l.default.updateCallAudioSettingsPopupEvent((e=>e.markDidChangeAECMode()))}}_buildState(e,t){return Object.assign(Object.assign({},super._buildState(e,t)),{isAwaitingCameraConfirmation:s.default.CallControlsStore.isAwaitingCameraConfirmation()})}componentWillUnmount(){super.componentWillUnmount(),this.onClosed()}renderContent(){return(0,a.jsxs)(n.View,Object.assign({style:[S.popupContainer,this._themeStyles.primaryBackgroundColorStyle]},{children:[(0,a.jsx)(n.View,Object.assign({style:S.popupTitleRow},{children:(0,a.jsx)(C.Subtitle,{children:h.getString("CallControlsOverFlowMenu.AdjustAudioSettings")})})),(0,a.jsx)(p.default,{callId:this.props.callId,colorThemeOverride:this._currentTheme,hideAutoAdjustSetting:!0,micLevelMeterSteps:13,labelMaxWidth:166,onMicrophoneSelected:this._onMicrophoneSelected,onAdjustVolume:this._onAdjustMicVolume,onToggleMusicMode:this._onToggleMusicMode,onToggleAEC:this._onToggleAECMode,origin:o.MicrophoneSettingsOrigin.InCallPopup}),(0,a.jsx)(c.default,{colorThemeOverride:this._currentTheme}),(0,a.jsx)(g.default,{colorThemeOverride:this._currentTheme,compactView:!0,labelMaxWidth:166,onSpeakerSelected:this._onSpeakerSelected,onAdjustVolume:this._onAdjustSpeakerVolume})]}))}popupDescription(){return"AudioSettings"}onOpened(e){l.default.setCallAudioSettingsPopupEvent(new r.CallAudioSettingsPopup(this.props.callId,e)),s.default.CallControlsStore.setSettingsPopupVisibility(!0)}onClosed(){s.default.CallControlsStore.setSettingsPopupVisibility(!1)}}t.default=m},837726:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dismiss=t.show=void 0;const a=i(785893),n=i(809206),o=i(823113),s=i(516778),r=(i(504330),i(994224)),l=i(30062),c=i(147204),d=i(898278),u=i(898278),h=i(746096),p=i(436237),g=i(915877),C=i(733754),S=i(257538),m=i(178735),y=i(581736),f=i(364956),b=i(910265),_=i(710056),T=i(22222),v=i(478262),w=i(619675),I=i(853374),P=i(29130),M=i(24576),k=i(897634),A=(0,g.lazyProperties)({panel:()=>s.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center"}),mainDisplayText:()=>s.Styles.createTextStyle({marginTop:35,textAlign:"center",maxWidth:640,paddingHorizontal:10}),mainDisplayTextSafari:()=>s.Styles.createTextStyle({fontSize:16}),downloadSuggestionText:()=>s.Styles.createTextStyle({marginRight:10}),chromeDisplayImage:()=>s.Styles.createImageStyle({width:612,height:266}),downloadButton:()=>s.Styles.createButtonStyle({alignSelf:"center",minWidth:u.SXButtonSize.Small}),continueWithoutAVButton:()=>s.Styles.createButtonStyle({alignSelf:"center",minWidth:u.SXButtonSize.Small,margin:20}),suggestionContent:()=>s.Styles.createViewStyle({position:"absolute",top:30,right:30,alignItems:"center",flexDirection:"row",overflow:"visible"})});function R(e,t,i){p.log(h.LogTraceArea.Permissions,"AugmentedPermissionsPanelProps.dismiss dismiss causeId: "+i),c.default.dismissModal(e,t)}t.show=function(e,t,i,n,o,s){p.log(h.LogTraceArea.Permissions,"AugmentedPermissionsPanelProps.show permissionType: "+i+" causeId: "+n);const r=(0,a.jsx)(x,{causeId:n,modalId:e,permissionType:i,onContinueAfterPermissionsDenied:s});return c.default.showModal(r,e,t),e=>R(e,t.rootViewId,n)},t.dismiss=R;class x extends M.default{constructor(){super(...arguments),this._onJoinCallWithoutAVPermissions=()=>{this.props.onContinueAfterPermissionsDenied&&this.props.onContinueAfterPermissionsDenied(),this._setTelemetryAction(l.AVPermissionsAction.ContinueWithoutAV),this._dismissAndCleanup()},this._dismissAndCleanup=()=>{R(this.props.modalId,d.MainRootViewId,""),o.PermissionsPromptHelper.resetPermissionPromptsState()},this._onCancelButtonClick=()=>{this._setTelemetryAction(l.AVPermissionsAction.Cancel),this._dismissAndCleanup()}}_buildState(e,t){const i={permissionStatus:y.default.permissionStatus(e.permissionType),isContinueWithoutPermission:r.default.CallingFeaturesHelper.isCallWithoutAVPermissionsBrowserEnabled()};return t&&(i.permissionStatus===o.PermissionStatus.Unknown?y.default.getPermissionStatusFetchIfUnavailable(e.permissionType).then((e=>{i.permissionStatus=e,this._initializeTelemetry(i)})):this._initializeTelemetry(i)),i}componentDidMount(){if(super.componentDidMount(),y.default.permissionStatus(this.props.permissionType)===o.PermissionStatus.Unknown)switch(this.props.permissionType){case v.PermissionType.Microphone:m.default.setUserPreferencesLocal({wasInstructedAboutMicrophoneWebPermissions:!0});break;case v.PermissionType.Camera:m.default.setUserPreferencesLocal({wasInstructedAboutCameraWebPermissions:!0});break;case v.PermissionType.MicrophoneAndCamera:m.default.setUserPreferencesLocal({wasInstructedAboutMicrophoneWebPermissions:!0,wasInstructedAboutCameraWebPermissions:!0})}}componentWillUnmount(){super.componentWillUnmount(),this._callPermissionDeniedEvent&&(this._isGranted(this.state.permissionStatus)&&this._callPermissionDeniedEvent.setAction(l.AVPermissionsAction.PermissionGranted),p.track(this._callPermissionDeniedEvent))}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.permissionStatus!==o.PermissionStatus.Granted&&t.permissionStatus===o.PermissionStatus.Granted&&(this._setTelemetryAction(l.AVPermissionsAction.PermissionGranted),this._dismissAndCleanup())}render(){const{primaryTextColorStyle:e,primaryBackgroundColorStyle:t}=k.themeStyles(this._getContext(),this.props.colorThemeOverride);return(0,a.jsx)(b.default,Object.assign({dialogId:this.props.modalId,containerStyle:S.MeetNowStyle.bgColorStyle,closeOnClickOutside:!1,maxWidth:void 0,fullScreen:!0,useFullSizeContainer:!0},{children:(0,a.jsxs)(s.View,Object.assign({style:[A.panel,t]},{children:[this._renderMainDisplayImage(),this._renderMainDisplayText(e),this._renderContinueWithoutPermissionButton(),!1]}))}))}_renderMainDisplayImage(){if(this._isDeniedScreen(this.state)){const e=f.default.getDeniedImageSourceBrowser(this._useDarkTheme()),t=n.BrowserEnvironment.isSafari()||P.default.isTinyScreenSizeNoSubscription(this._getRootViewId())?d.ImageResizeModeEnum.contain:d.ImageResizeModeEnum.cover;return e?(0,a.jsx)(s.Image,{style:A.chromeDisplayImage,resizeMode:t,source:e}):void 0}return(0,a.jsx)(_.SkypeLogo,{})}_renderMainDisplayText(e){const t=this._isDeniedScreen(this.state),i=t?this._renderMainDisplayTextDenied():this._renderMainDisplayTextRequest(),o=[A.mainDisplayText,e,t&&n.BrowserEnvironment.isSafari()?A.mainDisplayTextSafari:void 0];return(0,a.jsx)(w.Header,Object.assign({style:o,size:5,allowFontScaling:!1,importantForAccessibility:s.Types.ImportantForAccessibility.Yes},{children:i}))}_assertAndWarnUnsupportedBrowser(){p.warn(h.LogTraceArea.Permissions,"AugmentedPermissions UI is not supported for other browsers")}_renderMainDisplayTextRequest(){const e=n.BrowserEnvironment.isEngineChromium()||n.BrowserEnvironment.isEngineWebkit()||n.BrowserEnvironment.isEngineGecko();switch(this.props.permissionType){case v.PermissionType.Microphone:return e?C.getString("AugmentedPermissions.RequestPermissionsChromeTextMic"):C.getString("AugmentedPermissions.RequestPermissionsEdgeTextMic");case v.PermissionType.Camera:return e?C.getString("AugmentedPermissions.RequestPermissionsChromeTextCam"):C.getString("AugmentedPermissions.RequestPermissionsEdgeTextCam");default:return e?C.getString("AugmentedPermissions.RequestPermissionsChromeTextBoth"):C.getString("AugmentedPermissions.RequestPermissionsEdgeTextBoth")}}_renderMainDisplayTextDenied(){const e=f.default.getPermissionDeniedText(v.PermissionType.Camera),t=f.default.getPermissionDeniedText(v.PermissionType.Microphone),i=f.default.getPermissionDeniedText(v.PermissionType.MicrophoneAndCamera),a=f.default.getPermissionDeniedText(v.PermissionType.Notifications);if(!e||!t||!i)return this._assertAndWarnUnsupportedBrowser(),"";if(this.state.permissionStatus===o.PermissionStatus.MicGrantedAndCameraDenied)return e;if(this.state.permissionStatus===o.PermissionStatus.MicDeniedAndCameraGranted)return t;switch(this.props.permissionType){case v.PermissionType.Camera:return e;case v.PermissionType.Microphone:return t;case v.PermissionType.MicrophoneAndCamera:return i;case v.PermissionType.Notifications:return null!=a?a:"";default:I.default.switchStatementExhaustiveChecking(this.props.permissionType,"AugmentedPermissions called for an incorrect permission type")}}_isDeniedScreen(e){return e.permissionStatus===o.PermissionStatus.Denied||e.permissionStatus===o.PermissionStatus.MicDeniedAndCameraGranted||this.props.permissionType===v.PermissionType.Notifications&&e.permissionStatus!==o.PermissionStatus.Granted}_renderContinueWithoutPermissionButton(){if(this.state.isContinueWithoutPermission)return(0,a.jsx)(T.default,{allowTextWrap:!0,buttonSize:u.SXButtonSize.Medium,buttonStyle:u.SXButtonStyle.ThemeStroke,onPress:this.props.permissionType===v.PermissionType.Notifications?this._dismissAndCleanup:this._onJoinCallWithoutAVPermissions,style:A.continueWithoutAVButton,title:this.props.onContinueAfterPermissionsDenied?C.getString("AugmentedPermissions.JoinCallWithoutAV"):C.getString("Global.DoneButtonTitle")})}_initializeTelemetry(e){const t=this._isDeniedScreen(e)?l.InitialScreen.DenyPrompt:l.InitialScreen.AllowPrompt;this._callPermissionDeniedEvent=new l.CallPermissionsBrowserEvent(t)}_setTelemetryAction(e){this._callPermissionDeniedEvent&&this._callPermissionDeniedEvent.setAction(e)}_isGranted(e){switch(this.props.permissionType){case v.PermissionType.Camera:return e===o.PermissionStatus.Granted||e===o.PermissionStatus.MicDeniedAndCameraGranted;case v.PermissionType.Microphone:return e===o.PermissionStatus.Granted||e===o.PermissionStatus.MicGrantedAndCameraDenied;case v.PermissionType.MicrophoneAndCamera:case v.PermissionType.Notifications:return e===o.PermissionStatus.Granted}}}t.default=x},260662:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(217041),r=i(581400),l=i(912614),c=i(480200),d=i(471727),u=i(746096),h=i(436237),p=i(706250),g=i(640363),C=i(853374);class S extends s.ComponentBase{constructor(){super(...arguments),this._itemPrefix="item_",this._lastReactionPostTime=0,this._isRTL=g.default.isRTL(),this._mountedRefsMap=new p.default,this._onPositionDrawer=(e,t)=>{h.log(u.LogTraceArea.CallReactionsDrawer,"_positionDrawer isOpen: "+t.isOpen+" animated: "+e)},this._onPositionDrawerAnimationCompleted=()=>{h.log(u.LogTraceArea.CallReactionsDrawer,"_onPositionDrawerAnimationCompleted isOpen: "+this.state.isOpen),this._drawerAnimation=void 0;const e=this._mountedRefsMap.ref(this._itemPrefix+0);this.isComponentMounted()&&e&&this.state.isOpen&&e.requestFocus(),this.props.onOpenCloseAnimationComplete&&this.props.onOpenCloseAnimationComplete(this.state.isOpen)},this._renderReactionItem=(e,t)=>{switch(e.type){case c.ReactionsItemType.Animation:case c.ReactionsItemType.Emoticon:case c.ReactionsItemType.Sticker:return this._renderItem(e,t)}},this._onToggleOpen=()=>{const e=!this.state.isOpen;h.log(u.LogTraceArea.CallReactionsDrawer,"_onToggleOpen shouldOpen: "+e),this.setState({isOpen:e})},this._onReactionPressed=(e,t)=>{const i=C.default.newCauseId();h.log(u.LogTraceArea.CallReactionsDrawer,"_onReactionPressed causeId: "+i);const a=Date.now();if(a-this._lastReactionPostTime>=500){const n={reactionInfo:e,causeId:i,timestamp:t,postSource:u.PostSource.CallReactionPressed,callId:this.props.callId,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationMri,logTraceArea:u.LogTraceArea.CallReactionsDrawer};r.CallReactionPostingHelpers.postReaction(n),this._selectedReactionInfo=e,this._lastReactionPostTime=a}this._onHandleReactionPressed()},this._onReactionPanHorizontal=e=>{}}_buildState(e,t){const i={isOpen:!t&&this.state.isOpen,emoticonReactionKey:d.default.getEmoticonReactionKey(e.celebrationData),reactions:d.default.getReactionItems(e.celebrationData)};return t&&this._positionDrawer(!1,i),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this.state.isOpen!==t.isOpen;a&&this._positionDrawer(!0,this.state),h.log(u.LogTraceArea.CallReactionsDrawer,"componentDidUpdate  openStateChanged: "+a+" isOpen: "+this.state.isOpen+" emoticonReactionKey: "+this.state.emoticonReactionKey)}_renderContent(){let e=0,t=n.map(this.state.reactions,((t,i)=>this._renderReactionItem(t,i+e)));return e+=t.length,this._isRTL&&(t=n.reverse(t)),this._renderReactionViews(n.compact(t))}_renderItem(e,t){if(!e.key)return;const i=this.state.isOpen?void 0:o.Types.ImportantForAccessibility.NoHideDescendants,n=this.state.isOpen?void 0:-1;return(0,a.jsx)(l.default,{ref:this._mountedRefsMap.onComponentRef(this._itemPrefix+t),info:e,isAnimated:this.state.isOpen,onPress:this._onReactionPressed,onPanHorizontal:this.state.isOpen?void 0:this._onReactionPanHorizontal,importantForAccessibility:i,tabIndex:n,celebrationData:this.props.celebrationData},e.key)}openDrawer(){this.state.isOpen||this._onToggleOpen()}openDrawerOnHover(){}closeDrawer(){return this._drawerAnimation&&(this._drawerAnimation.stop(),this._drawerAnimation=void 0),!!this.state.isOpen&&(h.log(u.LogTraceArea.CallReactionsDrawer,"closeDrawer"),this._onToggleOpen(),!0)}isOpen(){return this.state.isOpen}_onHandleReactionPressed(){}}t.default=S},561541:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalBaseCallRecorderToast=t.RemoteBaseCallRecorderToast=void 0;const a=i(516778),n=i(889391),o=i(816402),s=i(746096),r=i(436237),l=(i(540522),i(733754)),c=i(24576),d=i(912770),u=i(853374);class h extends c.default{constructor(){super(...arguments),this.recordingStartedAnnounceForAccessibility=()=>{if(this.state.initiatorDisplayName){const e=this.state.initiatorDisplayName||"";a.Accessibility.announceForAccessibility(l.getString(this.props.startedAccessibilityLabelTextPath,{name:e}))}},this.recordingStoppedAnnounceForAccessibility=()=>{if(this.state.initiatorDisplayName){const e=this.state.initiatorDisplayName||"";a.Accessibility.announceForAccessibility(l.getString(this.props.stoppedAccessibilityLabelTextPath,{name:e}))}}}componentDidMount(){super.componentDidMount(),this.state.initiatorDisplayName&&this.recordingStartedAnnounceForAccessibility()}componentWillUnmount(){super.componentWillUnmount(),this.recordingStoppedAnnounceForAccessibility()}}t.RemoteBaseCallRecorderToast=h;class p extends c.default{constructor(){super(...arguments),this._onStopPress=e=>{const t=u.default.newCauseId();r.log(s.LogTraceArea.CallingUI,"BaseCallRecorderToast.onStopPress causeId:"+t),this.props.onStopPress(this.state.callId,t)},this._onMorePrivacyInfoPress=e=>{a.Linking.openUrl(n.default.getConfigSettingsNoSubscription().skypeGoLinks.privacyAndCookies)},this._onDismissPrivacyInfoPress=()=>{r.log(s.LogTraceArea.CallingUI,"BaseCallRecorderToast.onDismissPrivacyInfoPress"),this.setState({showPrivacyLink:!1})},this._getElapsedTime=()=>o.default.getElapsedTimeStringFromMs(this.state.recordingElapsedTimeMs),this._recordingStartedAnnounceForAccessibility=()=>{a.Accessibility.announceForAccessibility(l.getString(this.props.startedAccessibilityLabelTextPath))},this._recordingStoppedAnnounceForAccessibility=()=>{a.Accessibility.announceForAccessibility(l.getString(this.props.stoppedAccessibilityLabelTextPath))}}componentDidMount(){super.componentDidMount(),this.callRecordingTimer=d.default.setInterval((()=>{let e=0;const t=this.state.recordingTimestamp?this.state.recordingTimestamp:void 0;if(t){const i=o.default.getUnixMillisecondsTimestamp(t);e=Date.now()-i,e<0&&(e=0)}this.isComponentMounted()&&this.setState({recordingElapsedTimeMs:e})}),1e3),this._recordingStartedAnnounceForAccessibility()}componentWillUnmount(){super.componentWillUnmount(),this.privacyInfoDisplayTimer&&(d.default.clearTimeout(this.privacyInfoDisplayTimer),this.privacyInfoDisplayTimer=void 0),this.callRecordingTimer&&(d.default.clearTimeout(this.callRecordingTimer),this.callRecordingTimer=void 0),this._recordingStoppedAnnounceForAccessibility()}}t.LocalBaseCallRecorderToast=p},560787:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallButton=t.CallButtonSpacing=t.CallButtonBackgroundStyle=t.CallButtonSize=void 0;const a=i(667294),n=i(785893),o=i(496486),s=i(665768),r=i(516778),l=i(436237),c=i(480200),d=i(911009),u=i(913944),h=i(711828),p=i(746096),g=i(297775),C=i(581760),S=i(677381),m=i(168934),y=i(915877),f=i(640363),b=i(311010),_=i(680837),T=i(853374);var v,w,I;!function(e){e[e.ExtraSmall=0]="ExtraSmall",e[e.Small=1]="Small",e[e.Large=2]="Large",e[e.ExtraLarge=3]="ExtraLarge"}(v=t.CallButtonSize||(t.CallButtonSize={})),function(e){e[e.None=0]="None",e[e.Solid=1]="Solid",e[e.Overlay=2]="Overlay"}(w=t.CallButtonBackgroundStyle||(t.CallButtonBackgroundStyle={})),function(e){e[e.Default=0]="Default",e[e.Small=1]="Small",e[e.None=2]="None"}(I=t.CallButtonSpacing||(t.CallButtonSpacing={}));const P=c.CallButtonSizes.callbuttonExtraLargeSize,M=c.CallButtonSizes.callbuttonLargeSize,k=c.CallButtonSizes.callbuttonSmallSize,A=c.CallButtonSizes.callbuttonExtraSmallSize,R=f.default.getPlatformType()===p.PlatformType.iOS,x=(0,y.lazyProperties)({buttonSolidBackground:()=>r.Styles.createViewStyle({backgroundColor:C.Color.gray400}),buttonOverlayBackground:()=>r.Styles.createViewStyle({backgroundColor:C.Color.gray400Overlay10}),callingButtonExtraLarge:()=>r.Styles.createViewStyle({width:P,height:P,borderRadius:P/2}),callingButtonLarge:()=>r.Styles.createViewStyle({width:M,height:M,borderRadius:M/2}),callingButtonSmall:()=>r.Styles.createViewStyle({width:k,height:k,borderRadius:k/2}),callingButtonExtraSmall:()=>r.Styles.createViewStyle({width:A,height:A,borderRadius:A/2}),squareButtonExtraLarge:()=>r.Styles.createViewStyle({width:P,height:P,borderRadius:P/4}),squareButtonLarge:()=>r.Styles.createViewStyle({width:M,height:M,borderRadius:M/4}),squareButtonSmall:()=>r.Styles.createViewStyle({width:k,height:k,borderRadius:k/4}),squareButtonExtraSmall:()=>r.Styles.createViewStyle({width:A,height:A,borderRadius:A/4}),startCallButton:()=>r.Styles.createButtonStyle({backgroundColor:R?C.Color.greenIOS:C.Color.green}),endCallButton:()=>r.Styles.createButtonStyle({backgroundColor:R?C.Color.redIOS:C.Color.red}),mergeCallButton:()=>r.Styles.createButtonStyle({backgroundColor:C.Color.gray200}),innerContainer:()=>r.Styles.createViewStyle({justifyContent:"center",alignItems:"center",overflow:"visible"}),innerContainerMargin:()=>r.Styles.createViewStyle({marginHorizontal:8}),smallButtonMargin:()=>r.Styles.createViewStyle({marginHorizontal:5}),noButtonMargin:()=>r.Styles.createViewStyle({marginHorizontal:0}),mergeIconColor:()=>r.Styles.createTextStyle({color:C.Color.black}),selected:()=>r.Styles.createViewStyle({backgroundColor:C.Color.white}),modernChatIconBadge:()=>r.Styles.createViewStyle({height:8,width:8,backgroundColor:C.Color.red,borderRadius:4,position:"absolute",right:7,top:7,justifyContent:"center",alignItems:"center"}),containerWithCaption:()=>r.Styles.createViewStyle({justifyContent:"center"}),buttonWithCaption:()=>r.Styles.createViewStyle({width:70,justifyContent:"center",overflow:"visible"}),caption:()=>r.Styles.createTextStyle({paddingTop:0,textAlign:"center",fontSize:b.default.controlFontSize.actionButtonLabel,color:C.Color.white,width:70}),iconButtonWithCaption:()=>r.Styles.createViewStyle({justifyContent:"center"}),mainAndAdditionalImageWrapper:()=>r.Styles.createViewStyle({overflow:"visible"})});class L extends S.default{constructor(){super(...arguments),this._pressed=!1,this._hovered=!1,this._onAnimatedViewRef=e=>{this._animatedView=e||void 0},this._onPressIn=()=>{this._updateButton(!0),this._pressed=!0,this.props.onPressIn&&this.props.onPressIn()},this._onPressOut=()=>{this._pressed&&(this._updateButton(!1),this._pressed=!1),this.props.onPressOut&&this.props.onPressOut()},this._onPress=e=>{e.stopPropagation(),this.props.showToolTip&&m.default.clearToolTip(),this.props.onPress&&this.props.onPress(e)},this._onContentIconButtonRef=e=>{this._contentIconButton=e||void 0},this._onHover=e=>{this._hovered=e;const t=()=>!(!(this.isComponentMounted()&&this.props.showToolTip&&this.props.title&&this._hovered)||r.UserInterface.isNavigatingWithKeyboard());t()?o.delay((()=>{t()&&m.default.showToolTip((()=>this.isComponentMounted()?this:void 0),this._getRootViewId(),t,this.props.title||"",this.props.toolTipConfig)}),150):m.default.clearToolTip(),this.props.onHover&&this.props.onHover(e)}}static sizeForCallButtonSize(e){switch(e){case v.ExtraLarge:return P;case v.Large:return M;case v.Small:return k;case v.ExtraSmall:return A}}componentWillUnmount(){super.componentWillUnmount(),this.props.showToolTip&&this._hovered&&m.default.clearToolTip()}componentDidMount(){super.componentDidMount(),this._updateButtonVisibility()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.show!==e.show&&this._updateButtonVisibility()}_updateButtonVisibility(){var e,t;void 0!==this.props.show&&(this.props.show?null===(e=this._animatedView)||void 0===e||e.fadeIn():null===(t=this._animatedView)||void 0===t||t.fadeOut())}_updateButton(e){const t=e?.8:1,i=e?.92:1;this._internalUpdateButton(t,i)}_internalUpdateButton(e,t){const i=T.default.newCauseId();l.log(p.LogTraceArea.SXAnimated,"CallButton._internalUpdateButton causeId: "+i),this._animatedView&&this._animatedView.getAnimation({opacity:e,scale:t},i).start()}_renderIconButton(e,t,i,o,s={}){var r,l,c,h;const p=null!=i?i:this.props.colorConfig?o?this.props.colorConfig.selectedIconColor:this.props.colorConfig.iconColor:o?C.Color.gray400:C.Color.white,S=null===(r=this.props.colorConfig)||void 0===r?void 0:r.hoverStyle,m=Object.assign(Object.assign({},s),{style:e,size:t,title:this.props.showToolTip?void 0:this.props.title,icon:this.props.icon,hoverStyle:S,hoverIcon:null===(l=this.props.colorConfig)||void 0===l?void 0:l.hoverIcon,hoverColor:null===(c=this.props.colorConfig)||void 0===c?void 0:c.hoverColor,color:p,onHover:this.props.onHover||this.props.showToolTip?this._onHover:void 0,showHoverEffect:null===(h=this.props.colorConfig)||void 0===h?void 0:h.showHoverEffect,disabled:this.props.isDisabled,tabIndex:this.props.caption?-1:0,renderIcon:this.props.renderIcon});return this.props.coachMarkType&&this.props.anchorAccessibilityLabel?this.props.caption?(0,n.jsx)(g.default.View,Object.assign({anchorRef:this._onContentIconButtonRef,coachMarkType:this.props.coachMarkType,anchorAccessibilityLabel:this.props.anchorAccessibilityLabel,onAnchorPress:this.props.onAnchorPress,positions:[d.PopupAnchorPositon.Top]},{children:(0,n.jsx)(u.default,Object.assign({},m))}),this.props.coachMarkType):(0,a.createElement)(g.default.IconButton,Object.assign({anchorRef:this._onContentIconButtonRef},m,{coachMarkType:this.props.coachMarkType,anchorAccessibilityLabel:this.props.anchorAccessibilityLabel,onAnchorPress:this.props.onAnchorPress,positions:[d.PopupAnchorPositon.Top],key:this.props.coachMarkType})):(0,n.jsx)(u.default,Object.assign({ref:this._onContentIconButtonRef},m))}requestFocus(){this._contentIconButton&&this._contentIconButton.requestFocus()}render(){const{caption:e,isToggledOn:t,colorConfig:i,borderWidth:a,isBadgeOn:o,additionalImage:l}=this.props,c=[_.default.overflowVisible,_.default.noncollapsibleView,_.default.alignItemsCenter,this.props.style],d=t||this.props.colorConfig&&(this.props.isCallEndButton||this.props.isCallStartButton||this.props.isCallMergeButton),u=this._getIconButtonStylesBySize(),h=[u,this._getIconButtonBackgroundStyle(),d?this._getIconButtonToggledBackgroundStyle():void 0],p=[u,x.innerContainer,this.props.doNotAddHorizontalMargin?void 0:x.innerContainerMargin,this._getSpacing()];if(i){if(i.borderColor){const e=r.Styles.createViewStyle({borderColor:i.borderColor,borderWidth:null!=a?a:1},!1);p.push(e),h.push(e)}}else this.props.isCallEndButton&&h.push(x.endCallButton),this.props.isCallStartButton&&h.push(x.startCallButton),this.props.isCallMergeButton&&h.push(x.mergeCallButton);e&&(h.push(x.iconButtonWithCaption),c.push(x.containerWithCaption));const g=this._getIconBySize();let S;o&&(S=(0,n.jsx)(r.View,{style:x.modernChatIconBadge}));const m=this._getDefaultButtonProps(),y=null==i?void 0:i.showHoverEffect;let f=(0,n.jsxs)(s.View,Object.assign({ref:this._onAnimatedViewRef,style:c},{children:[(0,n.jsxs)(r.View,Object.assign({onMouseLeave:this._onPressOut,style:x.mainAndAdditionalImageWrapper},{children:[(0,n.jsxs)(r.View,Object.assign({style:p},{children:[this._renderIconButton(h,g,this.props.isCallMergeButton?C.Color.black:void 0,!!d,!e||y?m:void 0),S]})),l]})),this._getOptionalCaption()]}));return e&&(f=(0,n.jsx)(r.Button,Object.assign({},m,{importantForAccessibility:r.Types.ImportantForAccessibility.Yes,style:x.buttonWithCaption},{children:f}))),f}_getOptionalCaption(){if(!this.props.caption)return;const e=[x.caption,...this.props.colorConfig&&this.props.colorConfig.captionColor?[{color:this.props.colorConfig.captionColor}]:[]];return(0,n.jsx)(r.Text,Object.assign({style:e,ellipsizeMode:"head",numberOfLines:1},{children:this.props.caption}))}_getDefaultButtonProps(){return{onPress:this._onPress,onPressIn:this._onPressIn,onPressOut:this._onPressOut,onLongPress:this.props.onLongPress,onContextMenu:this.props.onContextMenu,disabled:this.props.isDisabled,disableTouchOpacityAnimation:!0,accessibilityLabel:this.props.accessibilityLabel,importantForAccessibility:this.props.importantForAccessibility}}_getIconButtonStylesBySize(){let e;switch(this.props.size){case v.ExtraSmall:e=this.props.isSquareButton?x.squareButtonExtraSmall:x.callingButtonExtraSmall;break;case v.Small:e=this.props.isSquareButton?x.squareButtonSmall:x.callingButtonSmall;break;case v.Large:e=this.props.isSquareButton?x.squareButtonLarge:x.callingButtonLarge;break;case v.ExtraLarge:e=this.props.isSquareButton?x.squareButtonExtraLarge:x.callingButtonExtraLarge}return e}_getIconButtonBackgroundStyle(){return this.props.colorConfig?r.Styles.createViewStyle({backgroundColor:this.props.colorConfig.backgroundColor},!1):this.props.backgroundStyle===w.Solid?x.buttonSolidBackground:this.props.backgroundStyle===w.Overlay?x.buttonOverlayBackground:void 0}_getIconButtonToggledBackgroundStyle(){return this.props.colorConfig?r.Styles.createViewStyle({backgroundColor:this.props.colorConfig.selectedBackgroundColor},!1):x.selected}_getIconBySize(){switch(this.props.size){case v.ExtraSmall:return h.IconSize.size16;case v.Small:return h.IconSize.size20;case v.Large:return h.IconSize.size24;case v.ExtraLarge:return h.IconSize.size28}}_getSpacing(){let e;switch(this.props.spacing){case I.Small:e=x.smallButtonMargin;break;case I.None:e=x.noButtonMargin}return e}}t.CallButton=L,t.default=L},228664:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(544279),o=i(898278),s=i(527683),r=i(22222),l=i(24576);class c extends l.default{constructor(){super(...arguments),this._onComponentRef=e=>{this._componentRef=e||void 0}}_buildState(e,t){let i;if(s.default.isValidNumberString(e.phoneNumber)){const t=s.default.stripPlusSign(e.phoneNumber);i=n.default.getCallRateByPhoneNumber(t)}return{callRate:i}}render(){const e=s.default.parseAndFormat(this.props.phoneNumber,s.PhoneNumberFormat.INTERNATIONAL)||this.props.phoneNumber;return(0,a.jsx)(r.default,{ref:this._onComponentRef,buttonSize:o.SXButtonSize.Large,icon:this.props.icon,title:e,subtitle:this.state.callRate,accessibilityLabel:this.props.accessibilityLabel,allowTextWrap:!0,onPress:this.props.onPress},"callingbutton_"+this.props.phoneNumber)}requestFocus(){this._componentRef&&this._componentRef.requestFocus()}}t.default=c},795571:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallButtonIconSize=void 0;const a=i(785893),n=i(496486),o=i(516778),s=i(994224),r=i(598925),l=i(37034),c=i(480200),d=i(671830),u=i(952262),h=i(746096),p=i(913944),g=i(436237),C=i(915877),S=i(518460),m=i(733754),y=i(104735),f=i(330124),b=i(45227),_=i(172425),T=i(34273),v=i(279829),w=i(581760),I=i(711828),P=i(24576),M=i(172758),k=i(853374);var A;!function(e){e[e.Default=0]="Default",e[e.Compact=1]="Compact",e[e.ExtraCompact=2]="ExtraCompact"}(A=t.CallButtonIconSize||(t.CallButtonIconSize={}));const R=(0,C.lazyProperties)({hiddenContainer:()=>o.Styles.createViewStyle({width:0,justifyContent:"flex-end"}),button:()=>o.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10,backgroundColor:w.Color.transparent})});class x extends P.default{constructor(){super(...arguments),this._onAudioButtonRef=e=>{this._audioButtonRef=e||void 0},this._onVideoButtonRef=e=>{this._videoButtonRef=e||void 0},this._onUpcomingCallDetailsButtonPress=e=>{if(e.stopPropagation(),!this.props.scheduledCallId)return;const t=k.default.newCauseId();g.log(h.LogTraceArea.CallNavigation,"CallButtons._onUpcomingCallDetailsButtonPress, causeId: "+t),!this.state.isUsingStackNav&&this.props.mri&&y.default.navigateToConversation({convId:this.props.mri,causeId:t,origin:h.NavigationConversationOrigin.Search});const i=T.default.ScheduledCallsStore.getScheduledCallById(this.props.scheduledCallId);i&&T.default.NavigationActions.navigateToScheduledOverviewPanel({scheduledCallId:i.id,entryPoint:v.ScheduleCallEntryPoint.UpcomingCallComponent},this._getRootViewId())},this._onCallButtonPress=e=>{e.stopPropagation();const t=k.default.newCauseId();g.log(h.LogTraceArea.CallNavigation,"SearchItem._onCallButtonPress causeId: "+t);const i=()=>this._audioButtonRef;this.props.mri&&d.isPhoneMri(this.props.mri)&&(!this.props.addressBookContactOverride||this.props.addressBookContactOverride&&this.props.addressBookContactOverride.shortCircuitMriMatch)?this._handlePstnOnlyClick(i):this._startCall(!1,t,i)},this._onVideoCallButtonPress=e=>{e.stopPropagation();const t=k.default.newCauseId();g.log(h.LogTraceArea.CallNavigation,"SearchItem._onVideoCallButtonPress causeId: "+t);this._startCall(!0,t,(()=>this._videoButtonRef))}}_buildState(e,t){const i={};let a=!1;return e.addressBookContactOverride?(i.isEncrypted=!1,i.displayName=e.addressBookContactOverride.getDisplayName()):e.mri?(i.isEncrypted=d.isEncryptedThread(e.mri),i.displayName=u.default.getDisplayName(e.mri)||"",i.activeCallStatus=s.default.ActiveCallUIHelper.activeCallStatus(e.mri),a=d.isPhoneMri(e.mri)):(i.isEncrypted=!1,i.displayName=""),i.isUsingStackNav=f.default.isUsingStackNavigationContext(),i.multipleAudioCallOptionsAvailable=e.mri&&!d.isEncryptedThread(e.mri)&&d.isOneOnOneConversation(e.mri)&&x._areMultipleAudioCallOptionsAvailable(e),i.callingNotAllowed=!e.mri||!d.isMri(e.mri)||!s.default.CallNavigationHelper.isOutgoingCallingAllowed(e.mri),i.allowOutboundVideo=e.mri&&!e.scheduledCallId&&d.isMri(e.mri)&&s.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:a,isEncryptedCall:i.isEncrypted,conversationMri:e.mri}),i}render(){let e,t,i,s,r;const l=this._themeColors.iconHoverColor,d=this.props.iconColor||this._themeColors.primaryIconColor,u=this.state.activeCallStatus===c.ActiveCallStatus.OnHold;this.props.addressBookContactOverride&&!this.props.addressBookContactOverride.shortCircuitMriMatch?(s=!n.isEmpty(this.props.addressBookContactOverride.phones),r=!1):(s=!0,r=this.state.allowOutboundVideo);const h=[R.button];let g=I.IconSize.size24;if(this.props.iconSize&&(g=this.props.iconSize===A.Compact?I.IconSize.size20:I.IconSize.size16),s){let e,i;u?e=I.SkypeIcon.Pause:this.state.isEncrypted?e=I.SkypeIcon.PrivateCallFill:this.state.multipleAudioCallOptionsAvailable?(e=I.SkypeIcon.CallOptions,i=[o.Types.AccessibilityTrait.Button,o.Types.AccessibilityTrait.HasPopup]):e=I.SkypeIcon.CallStart,t=(0,a.jsx)(p.default,{ref:this._onAudioButtonRef,size:g,onPress:this._onCallButtonPress,color:d,hoverColor:l,icon:e,style:h,disabled:this.state.callingNotAllowed,title:m.getString("SkypeUserListItem.StartAudioCallButtonLabel"),accessibilityLabel:m.getString("AccessibilityLabel.StartAudioCallButtonAccessibilityLabel",{displayName:this.state.displayName}),accessibilityTraits:i})}this.props.scheduledCallId&&(i=(0,a.jsx)(p.default,{size:g,onPress:this._onUpcomingCallDetailsButtonPress,color:d,hoverColor:l,icon:I.SkypeIcon.Schedule,style:h,title:m.getString("SkypeUserListItem.ViewUpcomingCallDetailsButtonLabel"),accessibilityLabel:m.getString("AccessibilityLabel.ViewUpcomingCallDetailsButtonAccessibilityLabel",{displayName:this.state.displayName})})),r&&(e=(0,a.jsx)(p.default,{ref:this._onVideoButtonRef,size:g,onPress:this._onVideoCallButtonPress,color:d,hoverColor:l,icon:I.SkypeIcon.Video,style:h,disabled:this.state.callingNotAllowed,title:m.getString("SkypeUserListItem.StartVideoCallButtonLabel"),accessibilityLabel:m.getString("AccessibilityLabel.StartVideoCallButtonAccessibilityLabel",{displayName:this.state.displayName})}));const C=[b.styles.optionalCallButtonsContainer,this.props.hidden?R.hiddenContainer:void 0];return(0,a.jsxs)(o.View,Object.assign({style:C,importantForAccessibility:this.props.hidden?o.Types.ImportantForAccessibility.NoHideDescendants:void 0},{children:[i,e,t]}))}_handlePstnOnlyClick(e){const t=this.props.mri;t&&M.default.getFullUserProfileByMriAsync(t).then((i=>{var a;if(!i)return;const n=d.getPhoneNumberFromMri(t);if(!n)return;const o=S.default.getContactByPhoneNumber(n),s=o?o.getDisplayName():i.getDisplayName(),r=null===(a=i.emails)||void 0===a?void 0:a.map((e=>e.address));l.default.showForAddressContact(e,this._getRootViewId(),s,h.ContactInviteOrigin.CallPanelSearch,h.NavigationCallOrigin.SkypeUserListItem,i.phones,r)}))}_startCall(e,t,i){const a={skypeMri:this.props.addressBookContactOverride&&!this.props.addressBookContactOverride.shortCircuitMriMatch?void 0:this.props.mri,phones:this.props.addressBookContactOverride?this.props.addressBookContactOverride.phones:void 0,userIntent:e?r.StartCallOrMaybePromptUserIntent.Video:r.StartCallOrMaybePromptUserIntent.Audio,inviteOrigin:h.ContactInviteOrigin.SearchItem,callOrigin:h.NavigationCallOrigin.SearchItem},n=this.props.mri;n&&_.default.shouldShowInterstitial(n,e)?_.default.maybeShowRinglessCallInterstitial(n,e,a.callOrigin,t):l.default.startCallOrMaybePrompt(i,this._getRootViewId(),a,t)}static _areMultipleAudioCallOptionsAvailable(e){return!!e.mri&&(!!d.isPhoneMri(e.mri)||M.default.getDisplayableUserByMri(e.mri).getHasPhoneNumbers())}}t.default=x},368625:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(248467),r=i(598925),l=i(37034),c=i(278968),d=i(109520),u=i(346565),h=i(671830),p=i(211437),g=i(23293),C=i(816402),S=i(437490),m=i(952262),y=i(746096),f=i(110117),b=i(436237),_=i(915877),T=i(733754),v=i(223284),w=i(268080),I=i(18078),P=i(527683),M=i(536150),k=i(938985),A=i(293194),R=i(581760),x=i(640363),L=i(311010),V=i(711828),O=i(478262),B=i(680837),D=i(619675),E=i(24576),N=i(853374),F=200,j=110,U=A.default.menuId(),H=(0,_.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",width:F}),cardFooterContainer:()=>o.Styles.createViewStyle({alignItems:"stretch"}),cardFooterContainerEnded:()=>o.Styles.createViewStyle({minHeight:72}),messageText:()=>o.Styles.createTextStyle({paddingHorizontal:10,textAlignVertical:"center",marginTop:3}),messageTextIOS:()=>o.Styles.createTextStyle({paddingVertical:3,marginTop:0}),durationContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingBottom:3}),durationIconMargins:()=>o.Styles.createViewStyle({marginRight:3}),optionalButton:()=>o.Styles.createButtonStyle({paddingVertical:13,borderTopWidth:2,borderStyle:"solid"}),optionalButtonText:()=>o.Styles.createTextStyle({textAlign:"center"}),optionalButtonHover:()=>o.Styles.createTextStyle({color:R.Color.gray300}),participantsText:()=>o.Styles.createTextStyle({paddingHorizontal:10,paddingVertical:3}),picturesContainer:()=>o.Styles.createViewStyle({height:j,flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",backgroundColor:R.Color.gray200}),pictureTripleMain:()=>o.Styles.createViewStyle({height:110,width:100}),pictureTripleStack:()=>o.Styles.createViewStyle({height:55,width:100}),pictureDouble:()=>o.Styles.createViewStyle({height:110,width:100}),pictureSingle:()=>o.Styles.createViewStyle({height:110,width:200}),rightPicturesStackContainer:()=>o.Styles.createViewStyle({justifyContent:"space-between"}),lastPictureOverlay:()=>o.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center",backgroundColor:R.Color.blackOverlay20}),lastPictureOverlayText:()=>o.Styles.createTextStyle({color:R.Color.white})});class z extends E.default{constructor(){super(...arguments),this._mediaThumbnailNodes={},this._onCallBackButtonRef=e=>{this._callBackButton=e||void 0},this._onInviteButtonRef=e=>{this._inviteButton=e||void 0},this._onHoverStartCallBack=()=>{this.setState({hoveringOverCallBack:!0})},this._onHoverEndCallBack=()=>{this.setState({hoveringOverCallBack:!1})},this._onHoverStartInvite=()=>{this.setState({hoveringOverInvite:!0})},this._onHoverEndInvite=()=>{this.setState({hoveringOverInvite:!1})},this._onPicturePress=e=>{b.log(y.LogTraceArea.CallCard,"Loading MediaViewer for CallCard"),b.track(new d.CallActionEnterFromCallCard),w.default.showWithMessageConfig({initialMessage:e,animateOpenClose:!0,rootViewId:this._getRootViewId(),getContentNode:e=>this._mediaThumbnailNodes[e],origin:y.NavigationMediaViewerOrigin.CallCard}),S.dismissAll()},this._onCallBackButtonPress=()=>{const e=N.default.newCauseId();b.log(y.LogTraceArea.CallCard,"CallCard._onCallBackButtonPress causeId: "+e),l.default.startCallOrMaybePrompt((()=>this._callBackButton),this._getRootViewId(),{skypeMri:this.props.conversationId,userIntent:r.StartCallOrMaybePromptUserIntent.Generic,callOrigin:y.NavigationCallOrigin.CallCard,inviteOrigin:y.ContactInviteOrigin.Unknown},e)},this._onInviteButtonPress=e=>{const t=h.getPhoneNumberFromMri(this.props.conversationId)||"",i=[{text:P.default.formatNumberWithType({number:t,type:O.PhoneNumberTypes.Other}),command:`sms:${t}`}],a={anchor:()=>this._inviteButton,useTheme:!0};A.default.showWithOptions({id:U,config:a,getMenuItems:()=>i,handleMenuCommand:this._handleInviteActionCommand,menuTitle:T.getString("CallCard.InviteActionTitle"),rootViewId:this._getRootViewId(),invokingEvent:e})},this._handleInviteActionCommand=e=>{if(e===A.SXActionMenuCancel)return;const t=e.split(":")[1];k.default.initiateJoinLinkInvite({target:new k.SmsInvite(t),origin:y.ContactInviteOrigin.CallCard,showLoadingModalWhileGettingJoinLink:!0,rootViewId:this._getRootViewId()})}}static getConstrainedWidth(){return F}_buildState(e,t){const i=I.default.isMyMri(e.creatorMri),a={creatorUserColor:i?void 0:g.default.getColorInfo(e.creatorMri),isCreatedByUser:i};if(t&&(a.hoveringOverInvite=!1,a.hoveringOverCallBack=!1),u.default.hasVisibleCall()&&u.default.isCallVisible(e.callId))a.pictures=t?[]:this.state.pictures,a.participants=t?[]:this.state.participants,a.isLargeCard=!t&&this.state.isLargeCard,a.participantsText=t?"":this.state.participantsText,a.shouldShowInviteButton=!t&&this.state.shouldShowInviteButton,a.isMobileScreenReaderEnabled=!t&&this.state.isMobileScreenReaderEnabled;else{let i;if(i=e.cardType===s.CallCardType.Cast?e.conversationId:h.getReactionsThreadMriForCallId(e.callId),i){const e=c.default.getPictureReactions(i,0,!0);a.pictures=n.sortBy(e,(e=>e.createdTime)),a.reactionsConversationId=i}else a.pictures=t?[]:this.state.pictures;if(a.participants=n.compact(n.map(e.userParticipantMris,(e=>e?m.default.getDisplayableProfile(e):void 0))),a.isLargeCard=e.cardType===s.CallCardType.Ended||e.cardType===s.CallCardType.Cast,a.participantsText=this._getFormattedParticipantNames(e.conversationId,e.creatorMri),a.isMobileScreenReaderEnabled=M.default.isMobileScreenReaderEnabled(),e.isPSTN){const t=h.getPhoneNumberFromMri(e.conversationId);if(t){const e=p.default.getSortedUsersByPhoneNumber(t);a.shouldShowInviteButton=0===e.length&&!1}else a.shouldShowInviteButton=!1}}return a}render(){return(0,a.jsxs)(o.View,Object.assign({style:[H.container,this.props.containerRadiusStyles],onPress:this.state.isMobileScreenReaderEnabled&&!this.state.isLargeCard?this._onCallBackButtonPress:void 0},{children:[this._renderPictures(),this._renderCardFooter()]}))}_renderPictures(){const e=this.state.pictures.length;if(e){const t=[],i=[],s=2;this._mediaThumbnailNodes={},n.each(this.state.pictures,((n,r)=>{if(r>s)return!1;let l,c=0,d=0;e>=3?0===r?(l=H.pictureTripleMain,c=110,d=100):(l=H.pictureTripleStack,c=55,d=100):2===e?(l=H.pictureDouble,c=110,d=100):1===e&&(l=H.pictureSingle,c=110,d=200);const u=(0,a.jsx)(v.default,{ref:e=>{this._mediaThumbnailNodes[n.cuid]={component:e}},message:n,width:d,height:c});let h;r===s&&3!==e&&(h=(0,a.jsx)(o.View,Object.assign({style:H.lastPictureOverlay,blockPointerEvents:!0},{children:(0,a.jsx)(D.BodyText,Object.assign({bold:!0,style:H.lastPictureOverlayText},{children:"+"+(e-r)}))})));const p=(0,a.jsxs)(o.View,Object.assign({style:l,onPress:()=>this._onPicturePress(n)},{children:[u,h]}),"callPicture"+r);return e<3||0===r?t.push(p):i.push(p),!0}));const r=i.length?(0,a.jsx)(o.View,Object.assign({style:H.rightPicturesStackContainer},{children:i})):null,l=[H.picturesContainer];return!this.state.isCreatedByUser&&this._themeStyles.bubbleColorOtherStyle&&l.push(this._themeStyles.bubbleColorOtherStyle),(0,a.jsxs)(o.View,Object.assign({style:l},{children:[t,r]}))}}_renderCardFooter(){const e=this._isMissedCall(),t=h.isBlockedPSTNMri(this.props.conversationId),i=[L.default.fontStyle.cardAction,this._themeStyles.buttonTextColorStyle,H.optionalButtonText];this.state.hoveringOverCallBack&&i.push(H.optionalButtonHover);const n=e&&!t?(0,a.jsx)(o.Button,Object.assign({ref:this._onCallBackButtonRef,style:[H.optionalButton,this._themeStyles.primaryBorderColorStyle],onPress:this._onCallBackButtonPress,onHoverStart:this._onHoverStartCallBack,onHoverEnd:this._onHoverEndCallBack,underlayColor:this._themeColors.rowHighlightColor},{children:(0,a.jsx)(o.Text,Object.assign({style:i,numberOfLines:1},{children:T.getString("CallCard.CallBackButton")}))})):null,s=[L.default.fontStyle.cardAction,this._themeStyles.buttonTextColorStyle,H.optionalButtonText];this.state.hoveringOverInvite&&s.push(H.optionalButtonHover);const r=this.state.shouldShowInviteButton&&!t?(0,a.jsx)(o.Button,Object.assign({ref:this._onInviteButtonRef,style:[H.optionalButton,this._themeStyles.primaryBorderColorStyle],onPress:this._onInviteButtonPress,onHoverStart:this._onHoverStartInvite,onHoverEnd:this._onHoverEndInvite},{children:(0,a.jsx)(o.Text,Object.assign({style:s},{children:T.getString("CallCard.InviteButton")}))})):null,l=[H.cardFooterContainer,this._themeStyles.cardColorStyle];e?l.push(B.default.flexOne):l.push(H.cardFooterContainerEnded);const c=[H.messageText];return x.default.getPlatformType()===y.PlatformType.iOS&&c.push(H.messageTextIOS),(0,a.jsxs)(o.View,Object.assign({style:l},{children:[(0,a.jsx)(D.Subtitle,Object.assign({style:c,numberOfLines:1},{children:this.props.messageText})),(0,a.jsx)(D.CardTitle,Object.assign({style:H.participantsText,numberOfLines:1},{children:this.state.participantsText})),(0,a.jsxs)(o.View,Object.assign({style:H.durationContainer},{children:[(0,a.jsx)(f.default,{icon:this.props.iconText,size:V.IconSize.size12,color:this._themeColors.secondaryTextColor,style:H.durationIconMargins}),(0,a.jsx)(D.Caption,{children:this.props.durationText?this.props.durationText:C.default.getDisplayTimeString(this.props.createdTime)})]})),r,n]}))}_getFormattedParticipantNames(e,t){const i=h.isThread(e),a=T.getString("DisplayInfoStore.ListMyName"),n=I.default.isMyMri(t)?a:m.default.getShortDisplayName(t);let o="";if(i)o=T.getString("CallCard.CallParticipantsString",{nameA:n,nameB:m.default.getDisplayName(e)||T.getString("Notifications.UnknownUserShort")});else{const i=I.default.isMyMri(t)?m.default.getShortDisplayName(e):a;o=T.getString("CallCard.CallParticipantsString",{nameA:n,nameB:i})}return o}_isMissedCall(){return this.props.cardType===s.CallCardType.Missed}}t.default=z},48777:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(994224),r=i(32057),l=i(502278),c=i(746096),d=i(110117),u=i(436237),h=i(915877),p=i(733754),g=i(581760),C=i(711828),S=i(619675),m=i(853374),y=(0,h.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),icon:()=>n.Styles.createViewStyle({marginRight:10})});class f extends o.ComponentBase{constructor(){super(...arguments),this._onStartAudioOnlyPress=e=>{const t=m.default.newCauseId();u.log(c.LogTraceArea.CallingUI,"CallConnectionQualityBanner starting AudioOnly mode. causeId:"+t),s.default.CallingStore.startAudioOnly(this.props.callId,t)},this._onStopAudioOnlyPress=e=>{const t=m.default.newCauseId();u.log(c.LogTraceArea.CallingUI,"CallConnectionQualityBanner stopping AudioOnlyMode. causeId:"+t),s.default.CallingStore.stopAudioOnly(this.props.callId,t)}}_buildState(e,t){const i={callId:e.callId,conversationMri:e.conversationMri,isPSTNCall:s.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:s.default.CallingStore.isEncryptedCall(e.callId)},a=s.default.CallingStore.isProvidingVideo(e.callId)||s.default.RemoteStreamHelper.isStreamAvailableForAnyParticipant(e.callId),n=(0,r.default)();return{allowAudioOnly:s.default.CallingFeaturesHelper.allowAudioOnly(i)&&a,audioOnlyEnabled:s.default.CallingStore.isAudioOnly(e.callId),callNetworkQualityPoor:n.isCallQualityPoor(e.callId),callNetworkCatastrophic:n.isCallCatastrophic(e.callId)}}_renderHyperlink(){const e=m.default.newCauseId();if(this.state.audioOnlyEnabled){u.log(c.LogTraceArea.CallingUI,`CallConnectionQualityBanner shows stop audio only. causeId: ${e}`);const t=p.getString("CallConnectionQualityToast.StopAudioOnlyLinkText");return this._renderHyperlinkButton(t,this._onStopAudioOnlyPress)}if(this.state.allowAudioOnly&&this.state.callNetworkCatastrophic){u.log(c.LogTraceArea.CallingUI,`CallConnectionQualityBanner audio only suggestion. causeId: ${e}`),l.default.updateCallTelemetry(this.props.callId,e,(e=>e.suggestAudioOnly()));const t=p.getString("CallConnectionQualityToast.StartAudioOnlyLinkText");return this._renderHyperlinkButton(t,this._onStartAudioOnlyPress)}}_renderHyperlinkButton(e,t){return(0,a.jsx)(n.Button,Object.assign({onPress:t},{children:(0,a.jsx)(S.BodyText,Object.assign({style:this.props.linkStyle},{children:e}))}))}_renderIcon(){var e;if(this.state.callNetworkQualityPoor)return(0,a.jsx)(d.default,{style:y.icon,icon:C.SkypeIcon.CallQualityIndicator,size:C.IconSize.size24,color:null!==(e=this.props.iconColor)&&void 0!==e?e:g.Color.white})}_getTitleText(){return this.state.callNetworkQualityPoor&&this.state.audioOnlyEnabled?p.getString("CallConnectionQualityToast.PoorConnectionAndAudioOnlyEnabledTitle"):this.state.audioOnlyEnabled?p.getString("CallConnectionQualityToast.AudioOnlyTitle"):p.getString("CallConnectionQualityToast.PoorConnectionTitle")}render(){return(0,a.jsxs)(n.View,Object.assign({style:y.container},{children:[this._renderIcon(),(0,a.jsxs)(n.View,Object.assign({style:this.props.containerStyle},{children:[(0,a.jsx)(S.BodyText,Object.assign({style:this.props.textStyle,numberOfLines:1},{children:this._getTitleText()})),this._renderHyperlink()]}))]}))}}t.default=f},220187:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StopScreenShareCommand=t.RequestScreenShareCommand=t.ToggleVideoCommand=t.ChangeCallLayoutCommand=t.MuteEveryoneCommand=t.EndCallForEveryoneCommand=t.EndCallCommand=t.ToggleScreenShareCommand=t.ToggleMuteCommand=void 0;const a=i(496486),n=i(148540),o=i(397691),s=i(889391),r=i(994224),l=i(647176),c=i(136850),d=i(502278),u=i(480200),h=i(471727),p=i(539549),g=i(746096),C=i(436237),S=i(844972),m=i(18078),y=i(104735),f=i(364956),b=i(404057),_=i(478262),T=i(66123),v=i(853374),w=i(667024);t.ToggleMuteCommand=class{constructor(e,t,i,a,n,o,s=v.default.newCauseId()){this._callId=e,this._muted=t,this._serverMuted=i,this._isPermissionDenied=a,this._rootViewId=n,this._scenarioId=o,this._causeId=s}execute(){const e=`ToggleMuteCommand.execute causeId: ${this._causeId}`,t=`this.state.isMuted: ${this._muted}`,i=`this.state.isServerMuted: ${this._serverMuted}`;C.log(g.LogTraceArea.CallingUI,`${e}, ${t}, ${i}`),r.default.CallPermissionsUtils.requestPermissionStatus(_.PermissionType.Microphone,this._causeId).then((e=>{e?this._toggleMic(this._causeId):this._showMicDeniedPrompt()}))}_showMicDeniedPrompt(){f.default.showDeniedPromptWithSettingsOption(_.PermissionType.Microphone,this._rootViewId)}_toggleMic(e,t){this._muted?(r.default.CallingStore.unmute(this._callId,e).then((()=>{d.default.trackMicStateChange(this._callId,e),t&&w.default.markActionDoneAndRemoveTracker(t)})),h.default.announceMicrophoneState(!1,!1)):(r.default.CallingStore.mute(this._callId,e).then((()=>{d.default.trackMicStateChange(this._callId,e),t&&w.default.markActionDoneAndRemoveTracker(t)})),h.default.announceMicrophoneState(!0,!1))}};t.ToggleScreenShareCommand=class{constructor(e,t){this._callInfo=e,this._screenSharing=t}canExecute(){return r.default.CallingFeaturesHelper.allowScreenSharing(this._callInfo)}execute(){const e=v.default.newCauseId();C.log(g.LogTraceArea.CallMonitor,`ToggleScreenShareCommand.execute causeId: ${e}`),this._screenSharing?r.default.CallMonitorService.onStopSharing(e):r.default.CallMonitorService.onSwitchToMainView(e).then((()=>{r.default.CallMonitorService.onStartSharing(e)}),(t=>{C.warn(g.LogTraceArea.CallMonitor,`CallMonitorCallControls.onSwitchToMainView failed ${b.default.errorAsString(t)} causeId: ${e}`)}))}};t.EndCallCommand=class{constructor(e,t=v.default.newCauseId(),i){this._callId=e,this._causeId=t,this._failedHandler=i}execute(){C.log(g.LogTraceArea.CallingUI,`EndCallCommand.execute causeId: ${this._causeId}`),r.default.CallingStore.endCall(this._callId,this._causeId).catch((e=>{C.warn(g.LogTraceArea.CallingUI,`EndCallCommand: endCall failed: ${b.default.errorAsString(e)} causeId: ${this._causeId}`),this._failedHandler&&this._failedHandler(this._causeId)}))}};t.EndCallForEveryoneCommand=class{constructor(e,t,i,a){this._callId=e,this._callInfo=t,this._callUIState=i,this._failedHandler=a}canExecute(){const e=r.default.CallingStore.isCallHostless(this._callId),t=r.default.CallingFeaturesHelper.allowEndCallForEveryone(this._callInfo);let i=!1;return this._callUIState!==u.CallUIState.IncomingRing&&this._callUIState!==u.CallUIState.OutgoingRing&&(i=e&&t),C.log(g.LogTraceArea.CallingUI,`EndCallForEveryoneCommand.canExecute returns "${i}" for call with callId ${this._callId}, isCallHostless: ${e}, callUIState: ${u.CallUIState[this._callUIState]}, allowEndCallForEveryone: ${t}`),i}execute(){const e=v.default.newCauseId();C.log(g.LogTraceArea.CallingUI,`EndCallForEveryoneCommand.execute causeId: ${e}`),r.default.CallingStore.endCallForEveryone(this._callId,e).catch((t=>{C.warn(g.LogTraceArea.CallingUI,`EndCallForEveryoneCommand: endCall failed: ${b.default.errorAsString(t)} causeId: ${e}`),this._failedHandler&&this._failedHandler(e)}))}};t.MuteEveryoneCommand=class{constructor(e){this._callId=e}canExecute(){const e=r.default.CallingStore.getCallConversationMri(this._callId),t=e&&(0,p.default)().getConversation(e);return(e?l.default.getActiveParticipants(this._callId,e).length:0)>1&&(0,S.isCurrentUserAdminInModeratedGroup)(t)}execute(){this.canExecute()?r.default.CallingStore.muteParticipants(this._callId,n.MuteScope.All,[],v.default.newCauseId()):C.error(g.LogTraceArea.CallingUI,"[MuteEveryoneCommand] tried execute muting everyone but canExecute is false")}};t.ChangeCallLayoutCommand=class{constructor(e,t,i){this._callInfo=e,this._isIncomingOrOutgoingRing=t,this._fromStageMode=i}canExecute(){return!(!this._callInfo.conversationMri||!this._callInfo.callId)&&(!this._isIncomingOrOutgoingRing&&r.default.CallingStore.getRemoteCallMembers(this._callInfo.callId).length>0)}canExecuteForStageMode(e){switch(e){case u.StageMode.TogetherMode:return r.default.CallingFeaturesHelper.allowCallAudienceBot(this._callInfo);case u.StageMode.LargeGrid:return r.default.CallingFeaturesHelper.allowCallGridViewBot(this._callInfo);default:return!0}}execute(e){const t=v.default.newCauseId();if(C.log(g.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute switching stage mode from'\n            + '${u.StageMode[this._fromStageMode]} to ${u.StageMode[e]} causeId ${t}`),!this._callInfo.callId)return void C.error(g.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute no callId causeId ${t}`);const i=o.Defer();let a=!0;if(e===u.StageMode.TogetherMode)a=this._handleTogetherModeStage(i,this._callInfo.callId,t);else if(e===u.StageMode.LargeGrid){r.default.CallingStore.isPossiblyNotConnectedGridViewBotInCall(this._callInfo.callId)||(a=!1,r.default.InCallBotService.startGridViewMode(this._callInfo.callId,t).then((()=>{i.resolve()})).catch((e=>{i.reject("failed to start GridViewMode: "+e)})))}a&&i.resolve(),i.promise().then((()=>{this._callInfo.callId?(c.default.setStageMode(this._callInfo.callId,e,t),h.default.announceStageMode(e)):C.error(g.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute no callId causeId ${t}`)})).catch((e=>{C.warn(g.LogTraceArea.CallingUI,`ChangeCallLayoutCommand.execute ${e} causeId ${t}`)}))}_handleTogetherModeStage(e,t,i){if(r.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(t))return!0;const n=n=>{r.default.InCallBotService.startAudienceMode(t,i).then((()=>{a.isUndefined(n)||r.default.AudienceBotService.selectAudienceScene(t,i,n.sceneId),e.resolve()})).catch((t=>{e.reject("failed to start AudienceMode:"+t)}))},{enabledBackgroundSelection:o}=s.default.getS4LCMCFeatures().callAudienceBotConfig;if(!o)return n(void 0),!1;const l=T.default.getTogetherModeBackgrounds();if(a.isEmpty(l))return C.warn(g.LogTraceArea.CallingUI,"ChangeCallLayoutCommand.execute no TogetherMode backgrounds to choose from"),n(void 0),!1;const c={conversationMri:this._callInfo.conversationMri,onChangeBackground:n,onStartTogetherMode:n,onClose:()=>{e.reject("Together Mode Panel got closed")},isAudienceBotInCall:!1,selectedBackground:undefined};return y.default.navigateToTogetherModePanel(c,T.default.getPanelId()),!1}};t.ToggleVideoCommand=class{constructor(e,t,i=v.default.newCauseId()){this._callId=e,this._callInfo=t,this._causeId=i}canExecute(){return r.default.CallingFeaturesHelper.allowOutboundVideo(this._callInfo)}execute(){C.log(g.LogTraceArea.CallMonitor,`ToggleVideoCommand.execute causeId: ${this._causeId}`),r.default.CallControlsStore.toggleVideo(this._callId,this._causeId),d.default.trackVideoStateChange(this._callId,this._causeId)}};t.RequestScreenShareCommand=class{constructor(e){this._screenShareControl=e}canExecute(){return void 0!==this._screenShareControl&&this._screenShareControl.canRequestControl()}execute(){return this._screenShareControl?this._screenShareControl.requestControl().then((()=>{C.log(g.LogTraceArea.ScreenSharing,"request control succeeded")})).catch((e=>{C.log(g.LogTraceArea.ScreenSharing,`request control failed with ${b.default.errorAsString(e)}`)})):o.Resolved()}};t.StopScreenShareCommand=class{constructor(e){this._screenShareControl=e,this.viewerInControl=this._screenShareControl?this._screenShareControl.viewerInControl():void 0}canExecute(){return void 0!==this.viewerInControl&&m.default.isMyMri(this.viewerInControl.mri)}execute(){return this._screenShareControl&&this.viewerInControl?this._screenShareControl.terminateControl(this.viewerInControl.mri).then((()=>{C.log(g.LogTraceArea.ScreenSharing,"terminate control succeeded")})).catch((e=>{C.log(g.LogTraceArea.ScreenSharing,`terminate control failed with ${b.default.errorAsString(e)}`)})):o.Resolved()}}},3287:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(775492),s=i(994224),r=i(502278),l=i(480200),c=i(471727),d=i(803493),u=i(898278),h=i(677381),p=i(311734),g=i(552293),C=i(153211),S=i(757139),m=i(746096),y=i(436237),f=i(178735),b=i(29130),_=(i(886045),i(600076)),T=i(293194),v=i(581760),w=i(897634),I=i(853374),P=i(73877),M=50,k=b.default.isSmallDeviceNoSubscription(u.MainRootViewId)?3:4;class A extends h.default{constructor(){super(...arguments),this._recentActions=[]}static menuHeight(e){const t=this._stateForProps(e);let i=0;if(t.toggleItems&&(i+=M*t.toggleItems.length),t.listItems&&(i+=M*t.listItems.length),t.rowButtonsItems&&(i+=M*t.rowButtonsItems.length),i>0){const e={marginTop:8,marginBottom:8};i+=p.default.rowHeight(e)}const a=t.buttonItems;return a&&(a.length>2?i+=g.default.rowHeight(a.length,k):i+=a.length*M),i}static _stateForProps(e){const t=d.default.getCelebrationData(e.conversationMri,e.callId),i=s.default.DeviceStore.isBackgroundBlurEnabled(),a=s.default.DeviceStore.getNoiseSuppressionMode(),{primaryIconColor:n}=(0,w.themeColors)(e.callerContext(),e.colorThemeOverride),o={celebrationData:t,isIncomingVideoDisabled:c.default.isIncomingVideoDisabled(e.callId),isAudioOnlyEnabled:s.default.CallingStore.isAudioOnly(e.callId),noiseSuppressionMode:a,isTranslating:s.default.InCallBotService.isTranslating(e.callId),isSkypeTranslating:s.default.InCallBotService.isSkypeTranslationEnabled(e.callId),isRecording:s.default.CallingStore.isRecording(e.callId),isAudienceMode:s.default.CallingStore.isFullScreenBotInCall(e.callId),isScreenShareActive:s.default.CallingStore.isScreenSharing(e.callId),isVideoActive:s.default.CallingStore.isProvidingVideo(e.callId),isBackroundBlurEnabled:i,isBackgroundBlurSelected:s.default.DeviceStore.isBackgroundBlurred(),isBackgroundBlurNewItem:!1},r=Object.assign(Object.assign(Object.assign({},e),o),{iconColor:n});return o.toggleItems=c.default.overflowMenuToggleDescriptors(r),o.listItems=c.default.overflowMenuListDescriptors(r),o.rowButtonsItems=c.default.overflowMenuRowButtonsDescriptors(r),o.buttonItems=c.default.overflowMenuButtonDescriptors(r,e.callerContext()),o}_buildState(e,t){return A._stateForProps(e)}componentDidMount(){super.componentDidMount();const e=I.default.newCauseId();y.log(m.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.componentDidMount Menu open causeId: ${e}`),o.default.setOverflowMenuVisiblity(!0,e)}componentWillUnmount(){super.componentWillUnmount();const e=I.default.newCauseId();y.log(m.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.componentWillUnMount Menu close causeId: ${e}`),o.default.setOverflowMenuVisiblity(!1,e),r.default.trackOverflowMenuActions(this._recentActions),this.state.isBackroundBlurEnabled&&this.state.isBackgroundBlurNewItem&&f.default.setUserPreferencesLocal(Object.assign({},{}))}_executeDescriptorAndClose(e,t){this._executeDescriptor(e,t),y.log(m.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.ClosingMenu causeId: ${t}`),S.default.close(this._getRootViewId(),t)}_expandList(e,t){const i=l.CallControlsOverflowItem[e.key];y.log(m.LogTraceArea.CallingUI,`CallControlsCustomActionMenu ${i} causeId: ${t}`);const a={anchor:()=>{},useTheme:!0,positionPriorities:["bottom","top"]};return T.default.showWithOptions({id:"listContextMenuItem",config:a,getMenuItems:()=>e.menuItems.map((e=>({text:e.label,command:e.value,isCheckbox:!0}))),handleMenuCommand:t=>{t!==T.SXActionMenuCancel&&(this._recentActions.push(i),e.onItemSelected(t))},rootViewId:this._getRootViewId(),invokingEvent:void 0})}_executeDescriptor(e,t){if(e.onPress){const i=l.CallControlsOverflowItem[e.key];y.log(m.LogTraceArea.CallingUI,`CallControlsCustomActionMenu ${i} causeId: ${t}`),this._recentActions.push(i),e.onPress()}}_createOnRowButtonPress(e){return()=>{const t=I.default.newCauseId();y.log(m.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Button.onRowPress causeId: ${t}`),S.default.close(this._getRootViewId(),t),this._executeDescriptor(e,t)}}render(){const e=[];if(n.each(this.state.toggleItems,(t=>{const i={key:t.key,disabled:!!t.disabled,rowType:C.CustomActionMenuRowType.Toggle,isSelected:t.selected,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:()=>{const e=I.default.newCauseId();y.log(m.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Toggle.onRowPress causeId: ${e}`),this._executeDescriptor(t,e)},rowHeight:M,hideBorder:!0,icon:n.isArray(t.icon)?t.icon[0].icon:t.icon.icon,toggleOverlayColorAndroid:v.Color.black,isNew:!!t.isNew};e.push({props:i,builder:C.default.buildRow})})),n.each(this.state.listItems,(t=>{const i={key:t.key,disabled:!!t.disabled,rowType:C.CustomActionMenuRowType.List,listLabel:t.listLabel,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:()=>{const e=I.default.newCauseId();this._expandList(t,e)},rowHeight:M,hideBorder:!0,icon:n.isArray(t.icon)?t.icon[0].icon:t.icon.icon,toggleOverlayColorAndroid:v.Color.black,isNew:!!t.isNew};e.push({props:i,builder:C.default.buildRow})})),n.each(this.state.rowButtonsItems,(t=>{const i={key:t.key,rowType:C.CustomActionMenuRowType.Default,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:this._createOnRowButtonPress(t),rowHeight:M,hideBorder:!0,icon:n.isArray(t.icon)?t.icon[0].icon:t.icon.icon};e.push({props:i,builder:C.default.buildRow})})),e.length){const t={marginTop:8,marginBottom:8},i=(0,w.themeColors)(this.props.callerContext(),this.props.colorThemeOverride).secondaryTextColor,a=Object.assign(Object.assign({},t),{key:"divider",rowHeight:p.default.rowHeight(t),color:i});e.push({props:a,builder:p.default.buildRow})}const t=this.state.buttonItems;if(t.length-n.filter(t,(e=>!!e.doesNotInfluenceMenuLayout)).length>2){const i={key:"grid",buttonDescriptors:n.map(t,(e=>Object.assign(Object.assign({},e),{onPress:()=>{const t=I.default.newCauseId();y.log(m.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Button.onPress causeId: ${t}`),this._executeDescriptorAndClose(e,t)}}))),rowHeight:g.default.rowHeight(t.length),columnCount:k,estimatedWidth:P.default.measureWindow(this._getRootViewId()).width};e.push({props:i,builder:g.default.buildRow})}else n.each(t,(t=>{const i={key:t.key,accessibilityLabel:t.accessibilityLabel||t.title,titleText:t.title,onRowPress:()=>{const e=I.default.newCauseId();y.log(m.LogTraceArea.CallingUI,`CallControlsCustomActionMenu.Button.onRowPress causeId: ${e}`),this._executeDescriptorAndClose(t,e)},rowHeight:M,hideBorder:!0,icon:n.isArray(t.icon)?t.icon[0].icon:t.icon.icon};e.push({props:i,builder:C.default.buildRow})}));return(0,a.jsx)(_.default,{rowBuilders:e,colorThemeOverride:this.props.colorThemeOverride})}}t.default=A},838008:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AudioOutputButton=t.AudioOutputButtonInternal=void 0;i(785893);const a=i(667294),n=(i(134896),i(379231)),o=(i(4736),i(293055)),s=(i(841789),i(853374),i(491632),i(746096),i(994224)),r=i(258187),l=i(660198),c=i(889391);i(471727);t.AudioOutputButtonInternal=({callId:e,useiOSRoutePicker:t,moreOutputRoutesAvailable:i,outputRoute:n,onInteracting:s})=>{(0,o.useActionButtonColorConfig)(!1);const{rootViewId:l}=(0,r.useCommonContext)();a.useRef(null);return null},t.AudioOutputButton=(0,l.WithResub)(a.memo(t.AudioOutputButtonInternal),(e=>{s.default.CallingStore.isProvidingVideo(e.callId),c.default.getS4LCMCFeatures(),s.default.CallControlsStore.getAvailableAudioRoutes();return Object.assign(Object.assign({},e),{useiOSRoutePicker:n.AudioOutputRouteHelper.useiOSRoutePicker(),moreOutputRoutesAvailable:!1,outputRoute:s.default.CallControlsStore.getAudioOutput()})}))},675990:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(733754),s=i(4736),r=i(711828),l=i(994224),c=i(293055),d=i(660198),u=i(220187),h=i(667024),p=i(415963),g=i(853374);t.default=(0,d.WithResub)(n.memo((e=>{const t=(0,c.useActionButtonColorConfig)(e.isVideoActive),i=(e=>n.useCallback((t=>{const i=g.default.newCauseId();h.default.createTrackerAndMarkPressTime(i,p.ScenarioName.ResponsivenessToggleVideoCall,t),new u.ToggleVideoCommand(e.callId,e).execute(),e.onInteracting(!1),h.default.markActionDoneAndRemoveTracker(i)}),[e]))(e),l=o.getString(e.isVideoActive?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel");return(0,a.jsx)(s.default,{icon:e.isVideoActive?r.SkypeIcon.Video:r.SkypeIcon.VideoOff,accessibilityLabel:l,title:l,size:s.ActionButtonSize.Medium,backgroundColor:null==t?void 0:t.backgroundColor,iconColor:null==t?void 0:t.iconColor,onPress:i,disabled:!e.isVideoButtonEnabled,reverseGradientColor:!0})})),(e=>{const t=new u.ToggleVideoCommand(e.callId,e).canExecute(),i=l.default.CallingStore.isProvidingVideo(e.callId);return Object.assign(Object.assign({},e),{isVideoButtonEnabled:t,isVideoActive:i})}))},250646:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(285788),s=i(583367),r=i(516778),l=i(148540),c=i(889391),d=i(180843),u=i(968894),h=i(560787),p=i(220187),g=i(994224),C=i(912614),S=i(278968),m=i(109520),y=i(502278),f=i(480200),b=i(471727),_=i(47447),T=i(803493),v=i(671830),w=i(911009),I=i(147204),P=i(898278),M=i(118644),k=i(884912),A=i(497081),R=i(437490),x=i(746096),L=i(805581),V=i(436237),O=i(648638),B=i(172490),D=i(915877),E=i(733754),N=i(698977),F=i(104735),j=i(907153),U=i(217093),H=i(498053),z=i(364956),G=i(399189),W=i(390244),K=i(754306),$=i(886045),q=i(404057),Q=i(293194),X=i(915415),Z=i(581760),J=i(311010),Y=i(711828),ee=i(478262),te=i(680837),ie=i(24576),ae=i(66123),ne=i(853374),oe=i(865123),se=i(988154),re="_screenSharingModalId",le=h.CallButtonSize.Small,ce=(0,D.lazyProperties)({spinner:()=>r.Styles.createViewStyle({minWidth:80,alignItems:"center",flex:1,justifyContent:"center",overflow:"visible"}),spinnerMargin:()=>r.Styles.createViewStyle({margin:6,overflow:"visible"}),container:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"space-between",flexDirection:"row",overflow:"visible"}),chatPanelButton:()=>r.Styles.createViewStyle({alignItems:"center",overflow:"visible"}),reactionsPickerButton:()=>r.Styles.createViewStyle({overflow:"visible",alignItems:"center",justifyContent:"center",width:70}),secondaryControlsContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center",width:"50%",flexGrow:1,flexShrink:1,overflow:"visible"}),secondaryControlsContainerRight:()=>r.Styles.createViewStyle({justifyContent:"flex-end"}),caption:()=>r.Styles.createTextStyle({textAlign:"center",fontSize:J.default.controlFontSize.caption,paddingHorizontal:10,color:Z.Color.white}),raiseHandImageWrapper:()=>r.Styles.createViewStyle({position:"absolute",top:-7,left:3,overflow:"visible"}),customCallReactionsButton:()=>r.Styles.createViewStyle({position:"absolute",bottom:8,right:0,overflow:"visible"}),hoverStyleLight:()=>[r.Styles.createButtonStyle({backgroundColor:Z.Color.gray100})],hoverStyleDark:()=>[r.Styles.createButtonStyle({backgroundColor:Z.Color.black})],tooltipStyleDark:()=>r.Styles.createViewStyle({backgroundColor:Z.Color.gray400,paddingHorizontal:14,paddingVertical:7})}),de={style:ce.tooltipStyleDark,showArrow:!0,arrowColor:Z.Color.gray400,containerOffsetY:8};class ue extends ie.default{constructor(){super(...arguments),this._overflowMenuId=Q.default.menuId(),this._screenshareOverflowMenuId=Q.default.menuId(),this._secondaryCallControlsManager=new A.DesktopSecondaryCallControlsManager,this._onReactionsPickerHovered=e=>{n.delay((()=>{!this.state.isReactionsPickerSelected&&e&&this.props.onReactionPickerButtonHover()}),50)},this._setMainCallControlsRef=e=>{this._mainCallControls=e},this._getShareCallLinkButton=()=>(0,a.jsx)(oe.default,{colorConfig:this._colorConfig(),isShowingAloneInCall:this.props.isShowingAloneInCall,conversationMri:this.props.conversationMri,callId:this.props.callId,isShowingRecents:this.props.isShowingRecents,useLightTheme:this.props.useLightTheme,callButtonSize:le}),this._getShareQRButton=e=>{const t=E.getString("MeetNowCallControls.TwinCam"),i=this._hideCaption()?void 0:t,n=this._colorConfig();return n.hoverIcon=Y.SkypeIcon.TwinCamMidGradient,(0,a.jsx)(se.default,{colorConfig:n,conversationMri:this.props.conversationMri,callId:this.props.callId,isDisabled:!this.state.allowTwinCam,isShowingRecents:this.props.isShowingRecents,callButtonSize:le,caption:i,title:t,showToolTip:!i,toolTipConfig:de,onStopTwinCamPressed:()=>this._twinCamCommand.execute(!0),isTwinCamConnected:e})},this._getRequestScreenShareControlButton=()=>{const e=E.getString("CallControls.CallButtonRequestScreenShareControl"),t=this._hideCaption()?void 0:e,i=this._colorConfig();return(0,a.jsx)(h.CallButton,{icon:Y.SkypeIcon.ScreenSharingRequestControl,accessibilityLabel:e,caption:t,title:e,size:le,anchorAccessibilityLabel:e,colorConfig:i,onPress:()=>this._requestScreenShareCommand.execute(),showToolTip:!t,toolTipConfig:de},f.CallControlsKeys.ScreenShareControl)},this._getStopScreenShareControlButton=()=>{const e=E.getString("CallControls.CallButtonStopScreenShareControlFromViewer"),t=this._hideCaption()?void 0:e;return(0,a.jsx)(h.CallButton,{icon:Y.SkypeIcon.ScreenSharingStopControl,accessibilityLabel:e,caption:t,title:e,size:le,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),onPress:()=>this._stopScreenShareCommand.execute(),showToolTip:!t,toolTipConfig:de},f.CallControlsKeys.ScreenShareControl)},this._getScreenShareControlRequestInProgressIndicator=()=>{let e=(0,a.jsx)(X.default,{style:te.default.overflowVisible,size:P.SXActivityIndicatorSize.Small,useRXIndicator:!0});return e=(0,a.jsx)(r.View,Object.assign({style:ce.spinnerMargin},{children:e})),(0,a.jsxs)(r.View,Object.assign({style:ce.spinner},{children:[e,(0,a.jsx)(r.Text,Object.assign({style:ce.caption},{children:E.getString("CallControls.ScreenShareControlRequesting")}))]}))},this._onChatPanelButtonPress=()=>{const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"_onChatPanelButtonPress causeId: "+e),this.props.onChatPanelButtonPress(e)},this._onRaiseHandPressed=()=>{this.setState({isRaisedHandDisabled:!0}),this._raiseHandCommand.execute().finally((()=>{this.setState({isRaisedHandDisabled:!1})}))},this._onLowerHandPressed=()=>{this.setState({isRaisedHandDisabled:!0}),this._lowerHandCommand.execute().finally((()=>{this.setState({isRaisedHandDisabled:!1})}))},this._onOverflowMenuButtonRef=e=>{this._overflowButton=e||void 0},this._onScreenShareOverflowMenuButtonRef=e=>{this._screenShareOverflowMenuButton=e||void 0},this._onCallReactionsDrawerItemRef=e=>{this._reactionsEntryPoint=e||void 0,this._setEngagementTooltipAnchor(e)},this._setEngagementTooltipAnchor=e=>{d.default.setAnchor(u.EngagementTooltipType.CallReactionsBar,e)},this._onReactionsPickerPressed=()=>{this.props.onReactionsPickerButtonPress(),this.props.onInteracting(this.state.isReactionsPickerSelected)},this._onParticipantsButtonPress=()=>{const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._onParticipantsButtonPress "+e),this.props.onShowParticipants(e,f.CallRosterOrigin.CallControls,this.state.isHandRaised)},this._onAddParticipantsButtonPress=()=>{const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._onAddParticipantsButtonPress "+e),this.props.onAddToCall(e,x.NavigationAddToCallOrigin.CallControls)},this._onLiveCaptionsButtonPress=()=>{const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._onLiveCaptionsButtonPress "+e),this.state.isCaptioning?this._stopTranslator():this._startTranslator()},this._onSkypeTranslateButtonPress=()=>{const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._onSkypeTranslateButtonPress "+e),this.state.isSkypeTranslating?g.default.InCallBotService.stopSkypeTranslationConsent(this.props.callId,e):g.default.InCallBotService.startSkypeTranslationConsent(this.props.callId,e)},this._onTogetherModeBackgroundChangeButtonPress=()=>{this._changeTogetherModeBackgroundCommand.execute()},this._getOverflowMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:-10}}),this._showOverflowMenuPopup=e=>{const t=this._getOverflowMenuConfig(this._getAnchorForOverflowMenu);Q.default.showWithOptions({id:this._overflowMenuId,config:t,getMenuItems:this._getOverflowMenuItems,handleMenuCommand:this._selectOverflowMenuItem,onDismiss:this._overflowMenuDismissed,rootViewId:this._getRootViewId(),invokingEvent:e})},this._overflowMenuDismissed=()=>{y.default.trackOverflowMenuActions([])},this._getOverflowMenuItems=()=>this._getOverflowMenuItemsForCommands(this._secondaryCallControlsManager.getOverflowControls()),this._getActiveScreenShareOverflowItems=()=>{const e=[A.OverflowMenuCommands.ConfirmStopSharing];return g.default.CallingFeaturesHelper.allowSwitchingScreenSharing()&&e.push(A.OverflowMenuCommands.SwitchScreen),this._getOverflowMenuItemsForCommands(e)},this._getReactionPickerText=()=>this.state.isReactionsPickerSelected?E.getString("ReactionsStream.ReactionBarCloseDrawerTitle"):E.getString("ReactionsStream.ReactionBarOpenDrawerTitle"),this._getScreenshareButtonTooltip=()=>this.state.isScreenShareActive?E.getString("CallControlsOverFlowMenu.StopShareScreen"):E.getString("CallControlsOverFlowMenu.ShareScreen"),this._getSnapshotText=()=>E.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),this._selectOverflowMenuItem=e=>{const t=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._selectOverflowMenuItem "+t);const i=this._getRootViewId();switch(Q.default.dismiss(this._overflowMenuId,i),Q.default.dismiss(this._screenshareOverflowMenuId,i),y.default.trackOverflowMenuActions([e]),e){case A.OverflowMenuCommands.Blur:g.default.DeviceStore.setBackgroundBlurred(!0),V.track(new m.LocalVideoActionsEvent(m.LocalVideoActions.BackgroundBlur));break;case A.OverflowMenuCommands.Unblur:g.default.DeviceStore.setBackgroundBlurred(!1),V.track(new m.LocalVideoActionsEvent(m.LocalVideoActions.BackgroundUnBlur));break;case A.OverflowMenuCommands.OnAddToCall:this.props.onAddToCall(t,x.NavigationAddToCallOrigin.OverflowMenu);break;case A.OverflowMenuCommands.OnShowParticipants:this.props.onShowParticipants(t,f.CallRosterOrigin.OverflowMenu,!1);break;case A.OverflowMenuCommands.BackgroundEffectsSettings:case A.OverflowMenuCommands.OnShowAVSettings:this._showAVSettings();break;case A.OverflowMenuCommands.OnShowAudioSettings:this._showAudioSettings();break;case A.OverflowMenuCommands.ShareScreen:this._onNewScreenShareButtonPress(void 0,t);break;case A.OverflowMenuCommands.ShareScreenAndSounds:this.state.isScreenShareActive?this._startSoundSharing():this._openScreenSharingModal(!0,t);break;case A.OverflowMenuCommands.ConfirmStopSharing:case A.OverflowMenuCommands.StopSharing:this._stopScreenSharing();break;case A.OverflowMenuCommands.SwitchScreen:this._onSwitchScreen(t);break;case A.OverflowMenuCommands.ScreenShareControl:this._requestScreenShareCommand.execute();break;case A.OverflowMenuCommands.StopScreenShareControl:this._stopScreenShareCommand.execute();break;case A.OverflowMenuCommands.HoldCall:case A.OverflowMenuCommands.ResumeCall:this._toggleHoldState();break;case A.OverflowMenuCommands.StartRecording:this._startRecording();break;case A.OverflowMenuCommands.StopRecording:this._stopRecording();break;case A.OverflowMenuCommands.StartCaptions:this._startTranslator();break;case A.OverflowMenuCommands.StopCaptions:this._stopTranslator();break;case A.OverflowMenuCommands.LiveCaptions:this._onLiveCaptionsButtonPress();break;case A.OverflowMenuCommands.SkypeTranslate:case A.OverflowMenuCommands.StopSkypeTranslate:this._onSkypeTranslateButtonPress();break;case A.OverflowMenuCommands.EnableIncomingVideo:this._enableIncomingVideo();break;case A.OverflowMenuCommands.DisableIncomingVideo:this._disableIncomingVideo();break;case Q.SXActionMenuCancel:break;case A.OverflowMenuCommands.Snap:this.props.onMomentsPress();break;case A.OverflowMenuCommands.React:this._onReactionsPickerPressed();break;case A.OverflowMenuCommands.CustomReact:break;case A.OverflowMenuCommands.CallStats:this._onCallStatsPressed();break;case A.OverflowMenuCommands.Invite:this._invitePeopleCommand.execute();break;case A.OverflowMenuCommands.MuteEveryone:this._muteEveryoneCommand.execute(),V.track(new m.CallMuteEveryoneEvent(m.MuteEveryoneOrigin.OverflowMenu));break;case A.OverflowMenuCommands.RaiseHand:this._onRaiseHandPressed();break;case A.OverflowMenuCommands.LowerHand:this._onLowerHandPressed();break;case A.OverflowMenuCommands.ChangeTogetherModeBackground:this._onTogetherModeBackgroundChangeButtonPress();break;case A.OverflowMenuCommands.TwinCam:this._onTwinCamButtonPress();break;case A.OverflowMenuCommands.StopTwinCam:this._onTwinCamButtonPress(!0)}},this._getAnchorForOverflowMenu=()=>this._overflowButton,this._getAnchorForActiveScreenShareOverflowMenu=()=>this._screenShareOverflowMenuButton,this._toggleHoldState=()=>{const e=ne.default.newCauseId(),t=new H.ToggleHoldCallCommand(this.props,e);t.canExecute()?(V.log(x.LogTraceArea.CallingUI,`DesktopCallControls._toggleHoldState executing ToggleHoldCommand, causeId: ${e}`),t.execute()):V.warn(x.LogTraceArea.CallingUI,"DesktopCallControls._toggleHoldState ToggleHoldCallCommand.canExecute returned false")},this._onCallStatsPressed=()=>{this._callStatsCommand.execute()},this._onTwinCamButtonPress=(e=!1)=>{y.default.onShowShareTwinCamConnection(this.props.callId),this._twinCamCommand&&this._twinCamCommand.canExecute()&&this._twinCamCommand.execute(e)},this._onNewScreenShareButtonPress=(e,t)=>{const i=t||ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"_onNewScreenShareButtonPress causeId: "+i),g.default.CallingFeaturesHelper.isScreenSharingPermissionEnabled(i).then((t=>{if(t)if(this.state.isScreenShareActive)if(this.state.numberAvailableScreens>1||this.state.windowSharingEnabled){const t=this._getOverflowMenuConfig(this._getAnchorForActiveScreenShareOverflowMenu);Q.default.showWithOptions({id:this._screenshareOverflowMenuId,config:t,getMenuItems:this._getActiveScreenShareOverflowItems,handleMenuCommand:this._selectOverflowMenuItem,onDismiss:this._overflowMenuDismissed,rootViewId:this._getRootViewId(),invokingEvent:e})}else this._stopScreenSharing();else this._onShareScreen(i);else z.default.showDeniedPromptWithSettingsOption(ee.PermissionType.ScreenRecording,this._getRootViewId(),s.default.openScreenRecordingPrivacyPane)}))},this._openScreenSharingModal=(e,t)=>{V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._openScreenSharingModal causeId: "+t),y.default.updateCallTelemetry(this.props.callId,t,(e=>e.displayScreenSharingDialogCount())),R.dismissAll(),V.log(x.LogTraceArea.CallingUI,"got windows count 0 will navigate to screen share panel"),F.default.navigateToScreenSharePanel({conversationMri:this.props.conversationMri,currentScreenSharingSource:this._currentScreenSharingSource,currentScreenSharingSourceType:this._currentScreenSharingSourceType,isScreenSharingActive:this.state.isScreenShareActive,onSelectSource:this._selectScreenShareSource,onClose:this._closeScreenSharingModal,shareSounds:e},re)},this._showAVSettings=()=>{const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._showAVSettings causeId: "+e),F.default.navigateToDesktopSettingsGroup(U.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)},this._showAudioSettings=()=>{const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._showAudioSettings causeId: "+e),F.default.navigateToDesktopSettingsGroup(U.SettingsGroup.AudioSettings,this._getRootViewId(),e)},this._closeScreenSharingModal=()=>{I.default.dismissModal(re,this._getRootViewId())},this._selectScreenShareSource=(e,t,i)=>{const a=ne.default.newCauseId();if(V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._selectScreenShareSource causeId: "+a),y.default.updateCallTelemetry(this.props.callId,a,(e=>e.didUserDisplayScreenSharingDialog())),this.state.isScreenShareActive){if(this._currentScreenSharingSource&&e.getId()===this._currentScreenSharingSource.getId())return void this._closeScreenSharingModal();g.default.CallingStore.setSwitchingScreen(!0),g.default.CallingStore.stopScreenSharing(this.props.callId,a).then((()=>{g.default.CallingStore.startScreenSharing(this.props.callId,a,e,t).then((()=>g.default.CallingStore.setSwitchingScreen(!1))),this._currentScreenSharingSource=e,this._currentScreenSharingSourceType=i})),this._incrementSourceTypeTelemetryCounts(i,a),y.default.updateCallTelemetry(this.props.callId,a,(e=>e.switchScreenWhileSharing()))}else this._startScreenSharing(a,t,e,i);$.default.maybeAnnounceForAccessibility(E.getString("AccessibilityLabel.ScreenShareStarted")),this._closeScreenSharingModal()},this._stopScreenSharing=()=>{const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._stopScreenSharing causeId: "+e);const t=g.default.CallingStore.stopScreenSharing(this.props.callId,e,N.StopSharingOrigin.CallView);return $.default.maybeAnnounceForAccessibility(E.getString("AccessibilityLabel.ScreenShareStopped")),this._currentScreenSharingSource=void 0,this._currentScreenSharingSourceType=void 0,y.default.updateCallTelemetry(this.props.callId,e,(e=>e.stopScreenSharing())),this._shouldDisableVideoDuringScreenSharing()&&this.props.showHideOutgoingVideoDisabledToast(!1,e),t},this._startSoundSharing=()=>{const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._startSoundSharing causeId: "+e),g.default.CallingStore.startSoundSharing(this.props.callId,e).then((()=>{y.default.updateCallTelemetry(this.props.callId,e,(e=>e.startSoundSharing()))}))},this._togglePstnDialpadShortcut=(e,t)=>!(t!==this._getRootViewId()||!this.props.isPSTNCall)&&(this.props.onOpenDialpad(),!0),this._toggleCallStatsShortcut=(e,t)=>t===this._getRootViewId()&&(this._onCallStatsPressed(),!0),this._onScreenShareEvent=(e,t)=>{this._openScreenSharingModal(e,t)},this._mediaActionEvent=e=>{g.default.CallingStore.getOutgoingCallIds().indexOf(this.props.callId)>=0?(V.track(new m.MediaActionEvent(m.CallControlContext.DesktopCallControls,m.MediaActionEventResult.EndCall)),V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._mediaActionEvent ending call (causeId: "+e+")"),g.default.CallingStore.endCall(this.props.callId,e)):(V.track(new m.MediaActionEvent(m.CallControlContext.DesktopCallControls,m.MediaActionEventResult.Ignore)),V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._mediaActionEvent no action (causeId: "+e+")"))}}_buildState(e,t){var i,a,n,o;this._callStatsCommand=new H.ToggleCallStatsCommand(e.callId,this._getContext()),this._twinCamCommand=new H.TwinCamCommand(e.callId,{conversationMri:e.conversationMri,callId:e.callId,isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall}),this._muteEveryoneCommand=new p.MuteEveryoneCommand(e.callId),this._changeTogetherModeBackgroundCommand=new H.ChangeTogetherModeBackgroundCommand(e.callId,e.conversationMri),this._invitePeopleCommand=new H.InvitePeopleCommand(e.conversationMri,this._getRootViewId());const s=g.default.CallingStore.isRecording(e.callId),r=g.default.InCallBotService.isTranslating(e.callId),d=g.default.InCallBotService.isCaptioningEnabled(e.callId),u=g.default.InCallBotService.isSkypeTranslationEnabled(e.callId),h=L.default.isConversationTranslated(e.conversationMri),C=g.default.InCallBotService.isPstnTranslationEnabled(e.callId),S=b.default.isIncomingVideoDisabled(e.callId),m=g.default.CallingStore.isAudioOnly(e.callId),y=c.default.getS4LCMCFeatures(),w=y.customCallReactions,I=y.enableNewCustomCallReactions,P=g.default.CallingStore.getCallRecordingInitiator(e.callId),M=T.default.getCelebrationData(e.conversationMri,e.callId),k=e.callUIState===f.CallUIState.Default,A=g.default.CallingStore.getCallState(e.callId),R=A===l.CallState.Connected?g.default.ScreenSharingControlStoreRegistrar.getStoreFromCallId(e.callId):void 0;this._requestScreenShareCommand=new p.RequestScreenShareCommand(R),this._stopScreenShareCommand=new p.StopScreenShareCommand(R);const x=y.enableAllCallButtonsVisible,V=e.callUIState===f.CallUIState.Default||e.callUIState===f.CallUIState.OutgoingRing||e.callUIState===f.CallUIState.GoLiveSinglePlayer,B=x&&!v.isGroupConversation(e.conversationMri)&&!g.default.CallingFeaturesHelper.hasConnectedParticipants(e),D=g.default.CallingFeaturesHelper.allowRecording(e),E=D&&k,N=g.default.CallingFeaturesHelper.allowScreenSharing(e),F=N&&!B,j=N&&k;this._lowerHandCommand=new G.LowerHandCommand(e.callId,K.LowerHandOrigin.CallControls),this._raiseHandCommand=new G.RaiseHandCommand(e.callId,e);const U=this._requestScreenShareCommand.canExecute(),z=this._stopScreenShareCommand.canExecute(),W=!e.isNewCallScreen&&this._changeTogetherModeBackgroundCommand.canExecute(),$=x?D&&V:E,q=x?N&&V:j,Q=this._lowerHandCommand.canExecute(),X=k&&g.default.CallingFeaturesHelper.allowCaptioning(e)&&!h&&!C&&!u,Z=g.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId(),J=g.default.DeviceStore.isBackgroundBlurCapable(),Y=g.default.CallingStore.isProvidingVideo(e.callId),ee=g.default.DeviceStore.isBackgroundReplacementEnabled(),te=k&&g.default.CallingFeaturesHelper.allowIncomingVideoToBeDisabled(e),ie=this._muteEveryoneCommand.canExecute(),ae=k&&g.default.CallingFeaturesHelper.allowHoldCall(e),ne=g.default.CallingStore.isCallOnHoldResumeable(e.callId),oe=this._callStatsCommand.canExecute(),se=g.default.CallingStore.isOneOnOneCall(e.callId),re=g.default.CallingStore.isScreenSharing(e.callId),le=g.default.DeviceStore.getAvailableScreens().length,ce=_.CallingCapabilities.applicationSharingSupported(),de=g.default.InCallBotUtils.isCallRecordingInitiator(P),ue=g.default.CallingFeaturesHelper.allowTwinCam(e),he=ue&&k,pe=x?ue&&V:he,ge=null===(a=(i=g.default.CallingStore).hasConnectedTwinCam)||void 0===a?void 0:a.call(i,e.callId),Ce=X,Se=null!==(o=null===(n=this.state)||void 0===n?void 0:n.isRaisedHandDisabled)&&void 0!==o&&o,me={isVideoActive:Y,isScreenShareActive:re,isReactionsPickerSelected:!t&&!!this.state&&this.state.isReactionsPickerSelected,connectedAndNotOnHoldCallId:Z,isRecording:s,isIncomingVideoDisabled:S,audioOnlyEnabled:m,numberAvailableScreens:le,emoticonReactionKey:b.default.getEmoticonReactionKey(M),callState:A,isChatBadgeOn:this._isUnreadInCallIncomingMessageAndPhoto(),allowScreenSharing:x?F:j,allowRecording:E,isNavigatingWithKeyboard:O.default.isNavigatingWithKeyboard(),windowSharingEnabled:ce,isMinDesktop:b.default.isMinDesktop(e.controlsType),canRequestScreenShareControl:U,canStopScreenShareControl:z,screenShareRequestControlInProgress:R&&R.requestControlInProgress(),isConnecting1on1:B,isHandRaisedForCurrentUser:Q,isHandRaised:g.default.CallingStore.isAnyHandRaised(e.callId),isOneOnOneCall:se,enableNewCustomCallReactions:I,showCustomizeReactionsPencilButton:w&&w.enabled&&!w.useNewAddEmojiIcon,allowTwinCam:he,isTwinCamConnected:ge,isCaptioning:d,isPstnTranslationEnabled:C,isSkypeTranslating:u,isRaisedHandDisabled:Se},ye=g.default.CallingFeaturesHelper.allowSkypeTranslation(e),fe=!se||se&&g.default.CallingFeaturesHelper.allowAddToCall(e),be={idealLeftControls:this._getIdealLeftControls($,U,z,W,se,pe,ge,fe,Ce,ye),idealRightControls:this._getIdealRightControls(q,this._raiseHandCommand.isFeatureEnabled(),Q,I),idealOverflowControls:this._getIdealOverflowControls(!1,X,r,Z,J,Y,ee,te,S,m,ie,ae,ne,oe),leftControlForDesktopMinSmallest:this._getLeftControlForDesktopMinSmallest(),controlsType:e.controlsType,isOneOnOneCall:se,isScreenShareActive:re,numberAvailableScreens:le,windowSharingEnabled:ce,canRequestScreenShareControl:U,allowRecording:E,isRecording:s,connectedAndNotOnHoldCallId:Z,callId:e.callId,isCallRecordingInitiator:de,allowLiveCaptions:Ce,isCaptioning:d,allowSkypeTranslate:ye,isSkypeTranslating:u};return this._secondaryCallControlsManager.configure(be),me}componentDidMount(){super.componentDidMount(),this._screenSharingEventSub=g.default.dangerouslyGetCallNavigationUtils().screenSharePopupEvent.subscribe(this._onScreenShareEvent),this._mediaActionEventSub=o.default.mediaActionEvent.subscribe(this._mediaActionEvent),this._registerKeyboardHandlers()}UNSAFE_componentWillUpdate(e,t,i){if(super.UNSAFE_componentWillUpdate(e,t,i),this.state.isChatBadgeOn!==t.isChatBadgeOn&&V.log(x.LogTraceArea.CallingUI,"DesktopCallControls.UNSAFE_componentWillUpdate isChatBadgeOn changed from "+this.state.isChatBadgeOn+" to "+t.isChatBadgeOn),e.isShowingChat!==this.props.isShowingChat&&e.isShowingChat){const e=v.getReactionsThreadMriForCallId(this.props.callId);S.default.resetUnSeenIncomingPhotoCount(e),S.default.resetUnSeenIncomingTextCount(e)}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.isScreenShareActive!==t.isScreenShareActive&&b.default.announceScreenShareState(this.state.isScreenShareActive),this._shouldDisableVideoDuringScreenSharing()&&t.isScreenShareActive&&!this.state.isScreenShareActive){const e=ne.default.newCauseId();this.props.showHideOutgoingVideoDisabledToast(!1,e)}}componentWillUnmount(){super.componentWillUnmount(),this._unregisterKeyboardHandlers(),this._screenSharingEventSub&&(this._screenSharingEventSub.unsubscribe(),this._screenSharingEventSub=void 0),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0)}toggleReactionsPickerButton(e,t){V.log(x.LogTraceArea.CallingUI,"toggleReactionsPickerButton selected: "+e),this.setState({isReactionsPickerSelected:e},(()=>{t&&this.isComponentMounted()&&!e&&this._reactionsEntryPoint&&this.state.isNavigatingWithKeyboard&&this._reactionsEntryPoint.requestFocus()}))}focusCallEndButton(){this._mainCallControls&&this._mainCallControls.focusCallEndButton()}render(){const e=[ce.container,this.props.opacityStyle];return(0,a.jsxs)(r.Animated.View,Object.assign({style:e,ignorePointerEvents:!0},{children:[(0,a.jsx)(r.View,Object.assign({style:ce.secondaryControlsContainer},{children:this._renderControls(this._secondaryCallControlsManager.getLeftControls())})),(0,a.jsx)(j.default,{ref:this._setMainCallControlsRef,callId:this.props.callId,callUIState:this.props.callUIState,conversationMri:this.props.conversationMri,onOpenDialpad:this.props.onOpenDialpad,onInteracting:this.props.onInteracting,isPSTNCall:this.props.isPSTNCall,isEncryptedCall:this.props.isEncryptedCall,disableMic:this.props.disableMic,onEndCallFailure:this.props.onEndCallFailure,useLightTheme:this.props.useLightTheme,shouldDisableVideoDuringScreenSharing:this._shouldDisableVideoDuringScreenSharing()}),(0,a.jsx)(r.View,Object.assign({style:[ce.secondaryControlsContainer,ce.secondaryControlsContainerRight],ignorePointerEvents:!0},{children:this._renderControls(this._secondaryCallControlsManager.getRightControls())}))]}))}_getIdealLeftControls(e,t,i,a,n,o,s,r,l,c){const d=[];return n||d.push({priority:1,type:f.CallControlsKeys.ShareLink}),e&&d.push({priority:1,type:f.CallControlsKeys.Record}),(t||i)&&d.push({priority:2,type:f.CallControlsKeys.ScreenShareControl}),this.props.showParticipantsButton&&r&&d.push({priority:1,type:f.CallControlsKeys.Participants}),a&&d.push({priority:3,type:f.CallControlsKeys.ChangeScene}),o&&d.push({priority:1,type:s?f.CallControlsKeys.StopTwinCam:f.CallControlsKeys.TwinCam}),c&&d.push({priority:2,type:f.CallControlsKeys.SkypeTranslate}),l&&d.push({priority:2,type:f.CallControlsKeys.LiveCaptions}),d}_getIdealRightControls(e,t,i,a){const n=[];return n.push({priority:2,type:f.CallControlsKeys.Chat}),e&&n.push({priority:5,type:f.CallControlsKeys.ScreenShare}),t&&n.push({priority:4,type:i?f.CallControlsKeys.LowerHand:f.CallControlsKeys.RaiseHand}),this.props.shouldShowReactions&&(a?n.push({priority:3,type:f.CallControlsKeys.ReactionsPopover}):n.push({priority:3,type:f.CallControlsKeys.ReactionsDrawer})),n.push({priority:1,type:f.CallControlsKeys.Overflow}),n}_getIdealOverflowControls(e,t,i,a,n,o,s,r,l,c,d,u,h,p){const C=[];if(e&&C.push(A.OverflowMenuCommands.Snap),n&&o&&!s&&(g.default.DeviceStore.isBackgroundBlurred()?C.push(A.OverflowMenuCommands.Unblur):C.push(A.OverflowMenuCommands.Blur)),a===this.props.callId&&s&&C.push(A.OverflowMenuCommands.BackgroundEffectsSettings),r){const e=!l&&!c;e&&a===this.props.callId?C.push(A.OverflowMenuCommands.DisableIncomingVideo):e||C.push(A.OverflowMenuCommands.EnableIncomingVideo)}return d&&C.push(A.OverflowMenuCommands.MuteEveryone),u?C.push(A.OverflowMenuCommands.HoldCall):h&&C.push(A.OverflowMenuCommands.ResumeCall),this.props.isEncryptedCall||this.props.isPSTNCall||this.props.isOutgoingVideoDisabled?C.push(A.OverflowMenuCommands.OnShowAudioSettings):C.push(A.OverflowMenuCommands.OnShowAVSettings),p&&C.push(A.OverflowMenuCommands.CallStats),C}_getLeftControlForDesktopMinSmallest(){return f.CallControlsKeys.Chat}_renderControls(e){return n.map(e,(e=>this._renderControl(e)))}_renderControl(e){switch(e){case f.CallControlsKeys.Mic:case f.CallControlsKeys.MicQuickSettings:case f.CallControlsKeys.Video:case f.CallControlsKeys.VideoQuickSettings:case f.CallControlsKeys.Dialpad:return;case f.CallControlsKeys.Participants:return this._getAppropriateParticipantsButton();case f.CallControlsKeys.ScreenShare:return this._getScreenshareButton();case f.CallControlsKeys.ScreenShareControl:return this._getScreenShareControlButton();case f.CallControlsKeys.EndCall:return;case f.CallControlsKeys.RaiseHand:return this._getRaiseOrLowerHandButton(!0);case f.CallControlsKeys.LowerHand:return this._getRaiseOrLowerHandButton(!1);case f.CallControlsKeys.ShareLink:return this._getShareCallLinkButton();case f.CallControlsKeys.TwinCam:return this._getShareQRButton(!1);case f.CallControlsKeys.StopTwinCam:return this._getShareQRButton(!0);case f.CallControlsKeys.ChangeScene:return this._getTogetherModeBackgroundChangeButton();case f.CallControlsKeys.Record:return this._getRecordCallButton();case f.CallControlsKeys.ReactionsDrawer:return this._getReactionsDrawer();case f.CallControlsKeys.ReactionsPopover:return this._getReactionsPopover();case f.CallControlsKeys.Overflow:return this._renderMoreButton();case f.CallControlsKeys.Moments:return;case f.CallControlsKeys.Chat:return this._getChatPanelButton();case f.CallControlsKeys.LiveCaptions:return this._getLiveCaptionsButton();case f.CallControlsKeys.SkypeTranslate:return this._getSkypeTranslateButton();default:return ne.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsKeys element")}}_getChatPanelButton(){const e=E.getString("CallPanel.ChatButton"),t=this._hideCaption()?void 0:e,i=this.props.isShowingChat?E.getString("CallPanel.CloseConversation"):E.getString("CallPanel.OpenConversation"),n=this._colorConfig();return n.hoverIcon=Y.SkypeIcon.MessageGradient,(0,a.jsx)(r.View,Object.assign({style:ce.chatPanelButton},{children:(0,a.jsx)(h.CallButton,{ref:this.props.onChatButtonRef,icon:this.props.isShowingChat?Y.SkypeIcon.MessageGradient:Y.SkypeIcon.Message,accessibilityLabel:i,size:le,onPress:this._onChatPanelButtonPress,isToggledOn:this.props.isShowingChat,colorConfig:n,isBadgeOn:this.state.isChatBadgeOn,caption:t,title:e,showToolTip:!t,toolTipConfig:de},f.CallControlsKeys.Chat)}))}_getScreenShareControlButton(){return this.state.canRequestScreenShareControl?this._getRequestScreenShareControlButton():this.state.canStopScreenShareControl?this._getStopScreenShareControlButton():this.state.screenShareRequestControlInProgress?this._getScreenShareControlRequestInProgressIndicator():void 0}_getScreenshareButton(){const{allowScreenSharing:e,isScreenShareActive:t}=this.state,i=this._getScreenshareButtonTooltip(),n=this._hideCaption()?void 0:this._getScreenshareButtonTooltip(),o=this._colorConfig();o.hoverIcon=t?void 0:Y.SkypeIcon.ScreenShareGradient;const s=t?Y.SkypeIcon.ScreenShareStopGradient:Y.SkypeIcon.ScreenShare;return(0,a.jsx)(h.CallButton,{ref:this._onScreenShareOverflowMenuButtonRef,icon:s,accessibilityLabel:i,isDisabled:!e,size:le,isToggledOn:t,onPress:e=>this._onNewScreenShareButtonPress(e,void 0),coachMarkType:w.CoachMarkType.CallPanelScreenShareButton,anchorAccessibilityLabel:i,colorConfig:o,caption:n,title:i,showToolTip:!n,toolTipConfig:de},f.CallControlsKeys.ScreenShare)}_getTogetherModeBackgroundChangeButton(){const e=E.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),t=this._hideCaption()?void 0:e;return(0,a.jsx)(h.CallButton,{icon:ae.default.getBackgroundChangeButtonIcon(),accessibilityLabel:e,size:le,onPress:this._onTogetherModeBackgroundChangeButtonPress,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),caption:t,title:e,showToolTip:!t,toolTipConfig:de},f.CallControlsKeys.ChangeScene)}_getAppropriateParticipantsButton(){return this.state.isOneOnOneCall?this._getAddParticipantsButton():this._getParticipantsButton()}_getParticipantsButton(){const e=this._getParticipantsTitle(),t=this._hideCaption()?void 0:e,i=this.state.isHandRaised?(0,a.jsx)(r.View,Object.assign({style:ce.raiseHandImageWrapper},{children:(0,a.jsx)(W.default,{type:W.RaiseHandImageType.SmallSizeTopLeftAligned})})):void 0;return(0,a.jsx)(h.CallButton,{icon:Y.SkypeIcon.ContactGroupTwoPersonas,accessibilityLabel:e,size:le,onPress:this._onParticipantsButtonPress,anchorAccessibilityLabel:e,colorConfig:this._getParticipantsButtonColorConfig(),caption:t,title:e,additionalImage:i,borderWidth:2,showToolTip:!t,toolTipConfig:de},f.CallControlsKeys.Participants)}_getParticipantsButtonColorConfig(){var e;const t=Y.SkypeIcon.ContactGroupTwoPersonasGradient;if(this.state.isHandRaised){const i=this._colorConfig();return Object.assign(Object.assign({},i),{borderColor:Z.Color.raiseHandOrange,hoverIcon:t,hoverStyle:[...null!==(e=i.hoverStyle)&&void 0!==e?e:[],r.Styles.createButtonStyle({borderWidth:2,borderColor:Z.Color.raiseHandOrange},!1)]})}{const e=this._colorConfig();return e.hoverIcon=t,e}}_hideCaption(){const{controlsType:e}=this.props;return e===f.CallControlsType.DesktopMinSmallest||e===f.CallControlsType.DesktopMedium}_getAddParticipantsButton(){const e=this._getAddParticipantsTitle(),t=this._hideCaption()?void 0:e,i=this._colorConfig();return i.hoverIcon=Y.SkypeIcon.PersonAddGradient,(0,a.jsx)(h.CallButton,{icon:Y.SkypeIcon.ContactAdd,accessibilityLabel:e,size:le,onPress:this._onAddParticipantsButtonPress,anchorAccessibilityLabel:e,colorConfig:i,caption:t,title:e,showToolTip:!t,toolTipConfig:de},f.CallControlsKeys.Participants)}_getAddParticipantsTitle(){return E.getString("CallControls.AddParticipants")}_getParticipantsTitle(){return E.getString("CallControls.Participants")}_getLiveCaptionsButton(){const e=E.getString("CallControls.LiveCaptions"),t=this._hideCaption()?void 0:e,i=this._colorConfig(),n=Y.SkypeIcon.ClosedCaption;return(0,a.jsx)(h.CallButton,{icon:n,accessibilityLabel:e,size:le,onPress:this._onLiveCaptionsButtonPress,anchorAccessibilityLabel:e,colorConfig:i,caption:t,isToggledOn:this.state.isCaptioning,title:e,showToolTip:!t,toolTipConfig:de},f.CallControlsKeys.LiveCaptions)}_getSkypeTranslateButton(){const e=E.getString("CallControls.Translate"),t=this._hideCaption()?void 0:e,i=this._colorConfig(),n=Y.SkypeIcon.SkypeTranslatorNew;return(0,a.jsx)(h.CallButton,{icon:n,accessibilityLabel:e,size:le,onPress:this._onSkypeTranslateButtonPress,anchorAccessibilityLabel:e,colorConfig:i,caption:t,isToggledOn:this.state.isSkypeTranslating,title:e,showToolTip:!t,toolTipConfig:de},f.CallControlsKeys.SkypeTranslate)}_getReactionsDrawer(){const e={key:this.state.emoticonReactionKey,type:f.ReactionsItemType.Emoticon},t=this._getReactionPickerText(),i=E.getString("MeetNowCallControls.ReactionBarDrawerTitle"),n=this._hideCaption()?void 0:i,o=this.state.isConnecting1on1?(0,a.jsx)(h.CallButton,{ref:this._setEngagementTooltipAnchor,size:le,icon:Y.SkypeIcon.HeartOutline,isDisabled:!0,caption:n,title:i,accessibilityLabel:t,showToolTip:!0,colorConfig:this._colorConfig()}):(0,a.jsx)(C.default,{ref:this._onCallReactionsDrawerItemRef,info:e,isAnimated:!this.props.isHidden,importantForAccessibility:r.Types.ImportantForAccessibility.Yes,accessibilityLabel:t,onPress:this._onReactionsPickerPressed,onHover:this.state.isNavigatingWithKeyboard?void 0:this._onReactionsPickerHovered,caption:n,title:i,useDesktopCallControls:!0,isCallMenuItem:!0,useLightTheme:this.props.useLightTheme,hideIcon:this.state.isReactionsPickerSelected,showToolTip:!n},e.key);return(0,a.jsxs)(r.View,Object.assign({style:ce.reactionsPickerButton},{children:[o,this.state.showCustomizeReactionsPencilButton&&(0,a.jsx)(M.default,{styles:ce.customCallReactionsButton,iconSize:Y.IconSize.size12,origin:k.CustomReactionsType.Call})]}),f.CallControlsKeys.ReactionsDrawer)}_getReactionsPopover(){const e=E.getString("MeetNowCallControls.ReactionBarDrawerTitle"),t=this._hideCaption()?void 0:e,i=this._colorConfig();return i.hoverIcon=Y.SkypeIcon.EmojiAddGradient,(0,a.jsx)(r.View,Object.assign({style:ce.reactionsPickerButton},{children:(0,a.jsx)(h.CallButton,{icon:Y.SkypeIcon.EmojiAdd,accessibilityLabel:this._getReactionPickerText(),isDisabled:this.state.isConnecting1on1,size:le,onPress:()=>{},colorConfig:i,caption:t,title:e,showToolTip:!t,toolTipConfig:de})}),f.CallControlsKeys.ReactionsPopover)}_renderMoreButton(){const e=E.getString("CallControls.CallButtonOverflowMenu"),t=E.getString("Global.MoreButtonTitle"),i=this._hideCaption()?void 0:t;return(0,a.jsx)(h.CallButton,{ref:this._onOverflowMenuButtonRef,icon:this._hideCaption()?Y.SkypeIcon.MoreVertical:Y.SkypeIcon.More,accessibilityLabel:e,size:le,onPress:this._showOverflowMenuPopup,coachMarkType:this.state.isMinDesktop&&this.state.allowScreenSharing?w.CoachMarkType.CallPanelScreenShareButton:void 0,anchorAccessibilityLabel:e,colorConfig:this._colorConfig(),caption:i,title:t,showToolTip:!i,toolTipConfig:de},f.CallControlsKeys.Overflow)}_getRecordCallButton(){const e=this.state.isRecording?E.getString("CallControlsOverFlowMenu.StopRecording"):E.getString("CallControlsOverFlowMenu.StartRecording"),t=this.state.isRecording?E.getString("CallControlsOverFlowMenu.StopRecording"):E.getString("MeetNowCallControls.StartRecording"),i=this._hideCaption()?void 0:t,n=this._colorConfig();return n.hoverIcon=Y.SkypeIcon.CallRecordGradient,(0,a.jsx)(h.CallButton,{icon:this.state.isRecording?Y.SkypeIcon.CallRecordGradient:Y.SkypeIcon.CallRecord,accessibilityLabel:e,isDisabled:!this.state.allowRecording,isToggledOn:this.state.isRecording,size:le,colorConfig:n,onPress:this.props.onRecordCallPress,caption:i,title:t,showToolTip:!i,toolTipConfig:de},f.CallControlsKeys.Record)}_isUnreadInCallIncomingMessageAndPhoto(){const e=v.getReactionsThreadMriForCallId(this.props.callId);return S.default.getUnseenIncomingTextCount(e)>0||S.default.getUnseenIncomingPhotoCount(e)>0}_colorConfig(){return this.props.useLightTheme?this._lightThemeColorConfig():{iconColor:Z.Color.gray50,backgroundColor:Z.Color.transparent,selectedIconColor:this._getContext().themeColors.iconInteractive,selectedBackgroundColor:Z.Color.black,showHoverEffect:!0,hoverStyle:ce.hoverStyleDark,hoverColor:this._getContext().themeColors.iconInteractive}}_lightThemeColorConfig(){return{iconColor:Z.Color.gray400,backgroundColor:Z.Color.transparent,selectedIconColor:this._getContext().themeColors.iconInteractive,selectedBackgroundColor:Z.Color.gray100,borderColor:Z.Color.transparent,captionColor:Z.Color.gray400,showHoverEffect:!0,hoverStyle:ce.hoverStyleLight,hoverColor:this._getContext().themeColors.iconInteractive}}_getRaiseOrLowerHandButton(e){const{key:t,icon:i,buttonLabel:n,a11yLabel:o,onButtonPress:s}=e?this._getRaiseHandProps():this._getLowerHandProps(),r=this._colorConfig();r.hoverIcon=Y.SkypeIcon.LowerHandGradient;const c=this._hideCaption()?void 0:n;return(0,a.jsx)(h.CallButton,{icon:i,title:n,size:le,isToggledOn:this.state.isHandRaisedForCurrentUser,onPress:s,accessibilityLabel:o,colorConfig:r,anchorAccessibilityLabel:o,caption:c,isDisabled:this.state.isRaisedHandDisabled||!(this.state.callState===l.CallState.Connected),showToolTip:!c,toolTipConfig:de},t)}_getRaiseHandProps(){const e=E.getString("CallControls.RaiseHand"),t=E.getString("CallControls.RaiseHandLabel"),i=this._onRaiseHandPressed,a=Y.SkypeIcon.RaiseHand;return{key:f.CallControlsKeys.RaiseHand,icon:a,buttonLabel:e,a11yLabel:t,onButtonPress:i}}_getLowerHandProps(){const e=E.getString("CallControls.LowerHand"),t=E.getString("CallControls.LowerHandLabel"),i=this._onLowerHandPressed,a=Y.SkypeIcon.LowerHandGradient;return{key:f.CallControlsKeys.LowerHand,icon:a,buttonLabel:e,a11yLabel:t,onButtonPress:i}}_getOverflowMenuItemsForCommands(e){const t=n.map(e,(e=>{const t=this._menuTextForCommand(e),i=this._menuIconForCommand(e);return t?{text:t,command:e,icon:i}:void 0}));return n.compact(t)}_menuIconForCommand(e){switch(e){case A.OverflowMenuCommands.BackgroundEffectsSettings:case A.OverflowMenuCommands.Blur:case A.OverflowMenuCommands.Unblur:return P.SXMenuIcon.BlurBackground;case A.OverflowMenuCommands.ConfirmStopSharing:case A.OverflowMenuCommands.StopSharing:return P.SXMenuIcon.ScreenshareOff;case A.OverflowMenuCommands.ShareScreen:case A.OverflowMenuCommands.ShareScreenAndSounds:return P.SXMenuIcon.Screenshare;case A.OverflowMenuCommands.SwitchScreen:return P.SXMenuIcon.ViewSwitch;case A.OverflowMenuCommands.ScreenShareControl:return P.SXMenuIcon.ScreenSharingRequestControl;case A.OverflowMenuCommands.StopScreenShareControl:return P.SXMenuIcon.ScreenSharingStopControl;case A.OverflowMenuCommands.Snap:return P.SXMenuIcon.Snapshot;case A.OverflowMenuCommands.React:return P.SXMenuIcon.React;case A.OverflowMenuCommands.CustomReact:return P.SXMenuIcon.CustomReact;case A.OverflowMenuCommands.RaiseHand:return P.SXMenuIcon.RaiseHand;case A.OverflowMenuCommands.LowerHand:return P.SXMenuIcon.LowerHand;case A.OverflowMenuCommands.OnAddToCall:return P.SXMenuIcon.SkypeContacts;case A.OverflowMenuCommands.OnShowParticipants:return P.SXMenuIcon.ContactGroupPair;case A.OverflowMenuCommands.OnShowAudioSettings:case A.OverflowMenuCommands.OnShowAVSettings:case A.OverflowMenuCommands.CallStats:return P.SXMenuIcon.Settings;case A.OverflowMenuCommands.Invite:return P.SXMenuIcon.AddSkypeContacts;case A.OverflowMenuCommands.HoldCall:return P.SXMenuIcon.HoldCall;case A.OverflowMenuCommands.ResumeCall:return P.SXMenuIcon.ResumeCall;case A.OverflowMenuCommands.StartRecording:case A.OverflowMenuCommands.StopRecording:return P.SXMenuIcon.Record;case A.OverflowMenuCommands.StartCaptions:case A.OverflowMenuCommands.StopCaptions:case A.OverflowMenuCommands.LiveCaptions:return P.SXMenuIcon.Subtitles;case A.OverflowMenuCommands.SkypeTranslate:case A.OverflowMenuCommands.StopSkypeTranslate:return P.SXMenuIcon.TranslatorNew;case A.OverflowMenuCommands.EnableIncomingVideo:return P.SXMenuIcon.VideoEnable;case A.OverflowMenuCommands.DisableIncomingVideo:return P.SXMenuIcon.VideoOff;case A.OverflowMenuCommands.MuteEveryone:return P.SXMenuIcon.MicrophoneOff;case A.OverflowMenuCommands.ChangeTogetherModeBackground:return P.SXMenuIcon.Picture;case A.OverflowMenuCommands.BingBackgrounds:return P.SXMenuIcon.Bing;case A.OverflowMenuCommands.TwinCam:return P.SXMenuIcon.TwinCam;case A.OverflowMenuCommands.StopTwinCam:return P.SXMenuIcon.StopTwinCam;default:return}}_menuTextForCommand(e){switch(e){case A.OverflowMenuCommands.Blur:case A.OverflowMenuCommands.Unblur:return g.default.DeviceStore.isBackgroundBlurred()?E.getString("CallControls.CallMenuUnBlurBackground"):E.getString("CallControls.CallMenuBlurBackground");case A.OverflowMenuCommands.ConfirmStopSharing:return E.getString("CallControlsOverFlowMenu.ConfirmStopShareScreen");case A.OverflowMenuCommands.StopSharing:case A.OverflowMenuCommands.ShareScreen:return this.state.isScreenShareActive?E.getString("CallControlsOverFlowMenu.StopShareScreen"):E.getString("CallControlsOverFlowMenu.ShareScreen");case A.OverflowMenuCommands.ShareScreenAndSounds:return E.getString("CallControlsOverFlowMenu.ShareScreenAndSounds");case A.OverflowMenuCommands.ScreenShareControl:return E.getString("CallControls.CallButtonRequestScreenShareControl");case A.OverflowMenuCommands.StopScreenShareControl:return E.getString("CallControls.CallButtonStopScreenShareControlFromViewer");case A.OverflowMenuCommands.SwitchScreen:return this.state.windowSharingEnabled?E.getString("CallControlsOverFlowMenu.SwitchScreenOrWindow"):E.getString("CallControlsOverFlowMenu.SwitchScreen");case A.OverflowMenuCommands.Snap:return this._getSnapshotText();case A.OverflowMenuCommands.React:case A.OverflowMenuCommands.CustomReact:return this._getReactionPickerText();case A.OverflowMenuCommands.RaiseHand:return E.getString("CallControls.RaiseHandLabel");case A.OverflowMenuCommands.LowerHand:return E.getString("CallControls.LowerHandLabel");case A.OverflowMenuCommands.OnAddToCall:return this._getAddParticipantsTitle();case A.OverflowMenuCommands.OnShowParticipants:return this._getParticipantsTitle();case A.OverflowMenuCommands.OnShowAudioSettings:return E.getString("CallControlsOverFlowMenu.AdjustAudioSettings");case A.OverflowMenuCommands.OnShowAVSettings:return E.getString("CallControlsOverFlowMenu.AdjustAVSettings");case A.OverflowMenuCommands.BackgroundEffectsSettings:return E.getString("CallControlsOverFlowMenu.BackgroundEffectsSettings");case A.OverflowMenuCommands.HoldCall:return E.getString("CallControlsOverFlowMenu.HoldCall");case A.OverflowMenuCommands.ResumeCall:return E.getString("CallControlsOverFlowMenu.ResumeCall");case A.OverflowMenuCommands.StartRecording:return E.getString("CallControlsOverFlowMenu.StartRecording");case A.OverflowMenuCommands.StopRecording:return E.getString("CallControlsOverFlowMenu.StopRecording");case A.OverflowMenuCommands.StartCaptions:return E.getString("CallControlsOverFlowMenu.StartSubtitles");case A.OverflowMenuCommands.StopCaptions:return E.getString("CallControlsOverFlowMenu.StopSubtitles");case A.OverflowMenuCommands.EnableIncomingVideo:return E.getString("CallControlsOverFlowMenu.StartIncomingVideo");case A.OverflowMenuCommands.DisableIncomingVideo:return E.getString("CallControlsOverFlowMenu.StopIncomingVideo");case A.OverflowMenuCommands.CallStats:return E.getString("CallPanel.CallStats");case A.OverflowMenuCommands.Invite:return E.getString("MeetNow.ShareInvite");case A.OverflowMenuCommands.MuteEveryone:return E.getString("CallControls.CallButtonMuteEveryone");case A.OverflowMenuCommands.ChangeTogetherModeBackground:return E.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground");case A.OverflowMenuCommands.BingBackgrounds:return E.getString("CallControls.BingBackgrounds");case A.OverflowMenuCommands.TwinCam:return E.getString("CallControlsOverFlowMenu.TwinCam");case A.OverflowMenuCommands.StopTwinCam:return E.getString("CallControlsOverFlowMenu.StopTwinCam");case A.OverflowMenuCommands.LiveCaptions:return E.getString("CallControlsOverFlowMenu.LiveCaptionsStart");case A.OverflowMenuCommands.SkypeTranslate:return E.getString("CallControlsOverFlowMenu.Translate");case A.OverflowMenuCommands.StopSkypeTranslate:return E.getString("CallControlsOverFlowMenu.StopTranslate");default:return}}_onSwitchScreen(e){this._stopScreenSharing().then((()=>{this._startBrowserScreenSharing(e),y.default.updateCallTelemetry(this.props.callId,e,(e=>e.switchScreenWhileSharing()))}))}_onShareScreen(e){this._startBrowserScreenSharing(e)}_startBrowserScreenSharing(e){var t;if(V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._startBrowserScreenSharing for browser causeId: "+e),this._shouldDisableVideoDuringScreenSharing()&&this.state.isVideoActive)return null===(t=g.default.CallingStore.getLocalVideoState(this.props.callId))||void 0===t||t.setLocalVideoEnabled(!1),this.props.showHideOutgoingVideoDisabledToast(!0,e),void this._startScreenSharing(e,!1,void 0,void 0);this._startScreenSharing(e,!1,void 0,void 0)}_shouldDisableVideoDuringScreenSharing(){return!0}_startScreenSharing(e,t,i,a){g.default.CallingStore.startScreenSharing(this.props.callId,e,i,t).catch((t=>{t&&"permissionDeniedError"===t.type&&y.default.updateCallTelemetry(this.props.callId,e,(e=>{e.cancelScreenSharing()}))})),this._currentScreenSharingSource=i,this._currentScreenSharingSourceType=a,y.default.updateCallTelemetry(this.props.callId,e,(e=>{e.startScreenSharing(),t&&e.startSoundSharing()})),a&&this._incrementSourceTypeTelemetryCounts(a,e)}_incrementSourceTypeTelemetryCounts(e,t){y.default.updateCallTelemetry(this.props.callId,t,(t=>e===l.SharingSourceType.Monitor?t.wholeScreenSharedCount():t.appWindowSharedCount()))}_registerKeyboardHandlers(){B.default.addHandler(x.KeyboardShortcut.OpenDialpad,this._togglePstnDialpadShortcut)}_unregisterKeyboardHandlers(){B.default.removeHandler(x.KeyboardShortcut.OpenDialpad,this._togglePstnDialpadShortcut)}_startRecording(){const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._startRecording causeId: "+e),g.default.InCallBotService.startRecording(this.props.callId,e)}_stopRecording(){const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._stopRecording causeId: "+e),g.default.InCallBotService.stopRecording(this.props.callId,e)}_startTranslator(){const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._startTranslator causeId: "+e),b.default.announceSubtitleState(true,!1),g.default.InCallBotService.startTranslator(this.props.callId,e).then((()=>{b.default.announceSubtitleState(true,!0)})).catch((t=>{V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._startTranslator error: "+q.default.errorAsString(t)+" causeId: "+e)}))}_stopTranslator(){const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._stopTranslator causeId: "+e),b.default.announceSubtitleState(false,!1),g.default.InCallBotService.stopTranslator(this.props.callId,e).then((()=>{b.default.announceSubtitleState(false,!0)}))}_enableIncomingVideo(){const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._startIncomingVideo causeId: "+e),this.state.audioOnlyEnabled?g.default.CallingStore.stopAudioOnly(this.props.callId,e):b.default.enableIncomingVideo(this.props.callId,e)}_disableIncomingVideo(){const e=ne.default.newCauseId();V.log(x.LogTraceArea.CallingUI,"DesktopCallControls._stopIncomingVideo causeId: "+e),b.default.disableIncomingVideo(this.props.callId,e)}}t.default=ue},907153:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(516778),s=i(148540),r=i(436237),l=i(733754),c=i(422538),d=i(4736),u=i(560787),h=i(480200),p=i(898278),g=i(711828),C=i(746096),S=i(220187),m=i(267743),y=i(994224),f=i(471727),b=i(581760),_=i(180843),T=i(968894),v=i(306282),w=i(913944),I=i(648638),P=i(172490),M=i(915877),k=i(104735),A=i(217093),R=i(163841),x=i(24576),L=i(853374),V=i(601494),O=i(559479),B=i(889391),D=i(502278),E=(0,M.lazyProperties)({container:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible",alignSelf:"center"}),buttonGroupContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible",alignSelf:"center",marginHorizontal:8,backgroundColor:b.Color.gray400,borderRadius:46,height:40}),buttonGroupContainerLightTheme:()=>o.Styles.createViewStyle({backgroundColor:b.Color.gray100Overlay80}),chevron:()=>o.Styles.createViewStyle({justifyContent:"center",alignItems:"center",paddingHorizontal:4}),extraChevronMargin:()=>o.Styles.createViewStyle({marginRight:8}),micButtonExtraStyles:()=>o.Styles.createViewStyle({marginLeft:-2})});class N extends x.default{constructor(){super(...arguments),this._hangUpButtonAnchor=(0,n.createRef)(),this._renderMicrophoneActivityIcon=e=>(0,a.jsx)(O.MicrophoneActivityIcon,Object.assign({},e,{isMuted:this.state.isMuted})),this._onMicButtonPopupRef=e=>{this._micButtonPopup=e||void 0},this._onVideoButtonPopupRef=e=>{this._videoButtonPopup=e||void 0},this._onMicButtonPopupClosed=()=>{this.setState({isMicPopupOpen:!1})},this._onVideoButtonPopupClosed=()=>{this.setState({isVideoPopupOpen:!1})},this._onMicButtonPopupAnchor=e=>{this._micButtonPopupAnchor=e||void 0},this._onVideoButtonPopupAnchor=e=>{this._videoButtonPopupAnchor=e||void 0,c.EnsureStarted(_.default).then((()=>{_.default.setAnchor(T.EngagementTooltipType.CallVideoSettings,e)}))},this._onMicQuickSettings=()=>{this.setState({isMicPopupOpen:!this.state.isMicPopupOpen},(()=>{this._micButtonPopup&&(this.state.isMicPopupOpen?this._micButtonPopup.showImmediately():this._micButtonPopup.hideImmediately())}))},this._onVideoQuickSettings=()=>{this.setState({isVideoPopupOpen:!this.state.isVideoPopupOpen},(()=>{this._videoButtonPopup&&(this.state.isVideoPopupOpen?this._videoButtonPopup.showImmediately():this._videoButtonPopup.hideImmediately())}))},this._onToggleMicrophone=()=>{const e=L.default.newCauseId();D.default.trackMicButtonClick(this.props.callId,e),this._micButtonPopup&&this._micButtonPopup.onAnchorPress();new S.ToggleMuteCommand(this.props.callId,this.state.isMuted,this.state.isServerMuted,!!this.props.disableMic,this._getRootViewId()).execute(),this.props.onInteracting(!1)},this._onToggleVideo=()=>{const e=L.default.newCauseId();D.default.trackVideoButtonClick(this.props.callId,e),this._videoButtonPopup&&this._videoButtonPopup.onAnchorPress(),this.state.isAwaitingCameraConfirmation?(y.default.CallControlsStore.setIsAwaitingCameraConfirmation(!1),y.default.DeviceStore.choosePreselectedDevices(e)):(this._videoCommand.execute(),this.props.onInteracting(!1))},this._showAVSettings=()=>{const e=L.default.newCauseId();r.log(C.LogTraceArea.CallingUI,"DesktopMainCallControls._showAVSettings causeId: "+e),k.default.navigateToDesktopSettingsGroup(A.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)}}_buildState(e,t){this._videoCommand=new S.ToggleVideoCommand(e.callId,e);return{isMuted:f.default.isLocalOrServerMuted(e.callId),isServerMuted:y.default.CallingStore.isServerMuted(e.callId),isVideoButtonEnabled:this._videoCommand.canExecute(),isVideoActive:y.default.CallingStore.isProvidingVideo(e.callId),isOutgoingVideoDisabled:y.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),callState:y.default.CallingStore.getCallState(e.callId),isNavigatingWithKeyboard:I.default.isNavigatingWithKeyboard(),isAwaitingCameraConfirmation:y.default.CallControlsStore.isAwaitingCameraConfirmation(),isScreenShareActive:y.default.CallingStore.isScreenSharing(e.callId),enableMicSoundIndicator:B.default.getS4LCMCFeatures().enableMicSoundIndicator}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isServerMuted||!this.state.isServerMuted||this.state.isMuted||f.default.announceMicrophoneState(!0,!0),this._logMuteStateChanges(t)}focusCallEndButton(){var e;null===(e=this._hangUpButtonAnchor.current)||void 0===e||e.requestFocus()}render(){const e=(0,a.jsx)(m.default,{colorThemeOverride:this.props.useLightTheme?R.Theme.Colorful:R.Theme.ColorfulDark,ref:this._onMicButtonPopupRef,callId:this.props.callId,onClosed:this._onMicButtonPopupClosed,isSticky:!0,popupId:"AudioSettingsPopup",anchor:()=>this._micButtonPopupAnchor}),t=(0,a.jsx)(V.default,{colorThemeOverride:this.props.useLightTheme?R.Theme.Colorful:R.Theme.ColorfulDark,ref:this._onVideoButtonPopupRef,callId:this.props.callId,isVideoButtonEnabled:this.state.isVideoButtonEnabled,onClosed:this._onVideoButtonPopupClosed,isVideoDisabledDuringScreenSharing:this._isVideoDisabledDuringScreenSharing(),onChangeBackgroundPress:this._showAVSettings,isOutgoingVideoDisabled:this.props.isOutgoingVideoDisabled,isSticky:!0,popupId:"VideoSettingsPopup",anchor:()=>this._videoButtonPopupAnchor,useLightTheme:this.props.useLightTheme});return this._renderNewMainCallControls(e,t)}_shouldRenderVideoButton(){return!this.props.isPSTNCall&&!this.props.isEncryptedCall}_renderNewMainCallControls(e,t){const i=[E.buttonGroupContainer,...this.props.useLightTheme?[E.buttonGroupContainerLightTheme]:[]];let n,s;return this._shouldRenderVideoButton()?n=[this._getVideoButton(),this._getChevronButton(h.CallControlsKeys.VideoQuickSettings,l.getString("CallControls.CallButtonCameraQuickSettings"),this.state.isVideoPopupOpen?p.FontWeight.bold:p.FontWeight.regular,this._onVideoQuickSettings,this._onVideoButtonPopupAnchor,this.state.isOutgoingVideoDisabled,E.extraChevronMargin)]:this.props.isPSTNCall&&(s=[this._getDialPadButton()]),(0,a.jsxs)(o.View,Object.assign({style:E.container},{children:[(0,a.jsxs)(o.View,Object.assign({style:i,ignorePointerEvents:!0},{children:[e,t,this._getMicButton(),this._getChevronButton(h.CallControlsKeys.MicQuickSettings,l.getString("CallControls.CallButtonMicrophoneQuickSettings"),this.state.isMicPopupOpen?p.FontWeight.bold:p.FontWeight.regular,this._onMicQuickSettings,this._onMicButtonPopupAnchor,void 0),this._shouldRenderVideoButton()?n:s]})),this._getHangUpButton()]}))}_getMicButton(){const{enableMicSoundIndicator:e,isMuted:t}=this.state,i=l.getString(t?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute"),n=P.default.generateTooltipLabelWithShortcutForCondition(i,C.KeyboardShortcut.ToggleMicrophone),o=this._getActionButtonColorConfig(!t,this.props.useLightTheme);return(0,a.jsx)(d.default,{icon:t?g.SkypeIcon.MicrophoneOff:g.SkypeIcon.Microphone,size:d.ActionButtonSize.Small,renderIcon:e?this._renderMicrophoneActivityIcon:void 0,onPress:this._onToggleMicrophone,title:n,accessibilityLabel:i,backgroundColor:null==o?void 0:o.backgroundColor,iconColor:null==o?void 0:o.iconColor,style:E.micButtonExtraStyles,reverseGradientColor:!0},h.CallControlsKeys.Mic)}_getChevronButton(e,t,i,n,o,s,r){return(0,a.jsx)(w.default,{ref:o,icon:g.SkypeIcon.UpChevron,title:t,disabled:s,size:g.IconSize.size12,onPress:n,accessibilityLabel:t,hoverColor:this.props.useLightTheme?b.Color.gray400Overlay50:b.Color.whiteOverlay50,color:this.props.useLightTheme?b.Color.gray400:b.Color.white,style:[E.chevron,r]},e)}_getActionButtonColorConfig(e,t){if(e)return;const i={iconColor:b.Color.white,backgroundColor:b.Color.transparent};return t&&(i.iconColor=b.Color.gray400),i}_getVideoButton(){let e,t;this.props.isOutgoingVideoDisabled?e=t=l.getString("AudioVideoSettings.OutgoingVideoDisabled"):(e=l.getString(this.state.isVideoActive?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel"),t=P.default.generateTooltipLabelWithShortcutForCondition(e,C.KeyboardShortcut.ToggleCamera));const i=this._getActionButtonColorConfig(this.state.isVideoActive||this.state.isAwaitingCameraConfirmation,this.props.useLightTheme);return(0,a.jsx)(d.default,{icon:this.state.isAwaitingCameraConfirmation?g.SkypeIcon.Ok:this.state.isVideoActive?g.SkypeIcon.Video:g.SkypeIcon.VideoOff,size:d.ActionButtonSize.Small,onPress:this._onToggleVideo,title:t,accessibilityLabel:e,backgroundColor:null==i?void 0:i.backgroundColor,iconColor:null==i?void 0:i.iconColor,reverseGradientColor:!0},h.CallControlsKeys.Video)}_getDialPadButton(){const e=l.getString("CallPanel.DialpadTooltipTitle");return(0,a.jsx)(u.CallButton,{icon:g.SkypeIcon.Dialpad,title:e,size:u.CallButtonSize.Small,isDisabled:!(this.state.callState===s.CallState.Connected||this.state.callState===s.CallState.EarlyMedia),isToggledOn:!0,onPress:this.props.onOpenDialpad,accessibilityLabel:e,backgroundStyle:u.CallButtonBackgroundStyle.Overlay,doNotAddHorizontalMargin:!0},h.CallControlsKeys.Dialpad)}_getHangUpButton(){return(0,a.jsx)(v.HangUpButton,{ref:this._hangUpButtonAnchor,isPSTNCall:this.props.isPSTNCall,isEncryptedCall:this.props.isEncryptedCall,conversationMri:this.props.conversationMri,connectedCallId:this.props.connectedCallId,callUIState:this.props.callUIState,callId:this.props.callId,onEndCallFailure:this.props.onEndCallFailure,focusOnMount:this.state.isNavigatingWithKeyboard,rootViewId:this._getRootViewId()})}_isVideoDisabledDuringScreenSharing(){return this.props.shouldDisableVideoDuringScreenSharing&&this.state.isScreenShareActive}_logMuteStateChanges(e){this.state.isMuted!==e.isMuted&&r.log(C.LogTraceArea.CallingUI,`DesktopMainCallControls.componentDidUpdate, isMuted - ${e.isMuted} to ${this.state.isMuted}`),this.state.isServerMuted!==e.isServerMuted&&r.log(C.LogTraceArea.CallingUI,`DesktopMainCallControls.componentDidUpdate, isServerMuted - ${e.isServerMuted} to ${this.state.isServerMuted}`)}}t.default=N},306282:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HangUpButton=void 0;const a=i(785893),n=i(217041),o=i(667294),s=i(436237),r=i(733754),l=i(4736),c=i(480200),d=i(581760),u=i(220187),h=i(746096),p=i(633289),g=i(172490),C=i(711828),S=i(912770),m=i(853374);t.HangUpButton=(0,o.memo)((0,o.forwardRef)((0,n.withResubAutoSubscriptions)((({callId:e,isPSTNCall:t,isEncryptedCall:i,conversationMri:n,connectedCallId:y,callUIState:f,onEndCallFailure:b,focusOnMount:_,rootViewId:T},v)=>{const w=(0,o.useRef)(null);((e,t)=>{const i=(0,o.useRef)(!1),a=(0,o.useRef)(0);(0,o.useEffect)((()=>(e.current&&t&&!i.current&&(a.current=S.default.setTimeout((()=>{var t;null===(t=e.current)||void 0===t||t.requestFocus()}),1e3)),i.current=!0,()=>{S.default.clearTimeout(a.current)})),[t,e])})(w,_);const I=new u.EndCallForEveryoneCommand(e,{callId:e,isPSTNCall:t,isEncryptedCall:i,conversationMri:n,connectedCallId:y},f,b),P=I.canExecute(),M=new u.EndCallCommand(e,void 0,b),k=(e,t)=>{s.log(h.LogTraceArea.CallingUI,"DesktopCallControls._endCall forEveryone: "+e+" causeId: "+t),e?I.execute():M.execute()},A=e=>{e.stopPropagation(),e.preventDefault(),P&&p.default.showEndCallMenuPopup(T,e,(()=>w.current),(e=>{p.default.selectEndCallMenuItem(e,T,k)}))},R=r.getString("CallControls.CallButtonEndCall"),x=g.default.generateTooltipLabelWithShortcutForCondition(R,h.KeyboardShortcut.HangupOrRejectCall);return(0,a.jsx)(l.default,{ref:(L=[w,v],function(e){for(const t of L)"function"==typeof t?t(e):null!==t&&(t.current=e)}),icon:C.SkypeIcon.CallEnd,title:x,size:l.ActionButtonSize.Small,backgroundColor:d.Color.red,onPress:()=>{const e=m.default.newCauseId();s.log(h.LogTraceArea.CallingUI,"DesktopCallControls._onEndCallButtonPress "+e),k(!1,e)},onLongPress:A,onContextMenu:A,accessibilityLabel:R},c.CallControlsKeys.EndCall);var L})))),t.HangUpButton.displayName="HangUpButton"},108837:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(733754),s=i(4736),r=i(711828),l=i(994224),c=i(293055),d=i(660198),u=i(220187),h=i(667024),p=i(415963),g=i(853374),C=i(889391),S=i(471727),m=i(502278),y=i(258187),f=i(559479);t.default=(0,d.WithResub)(n.memo((e=>{const t=((e,t)=>n.useCallback((i=>{const a=g.default.newCauseId();h.default.createTrackerAndMarkPressTime(a,p.ScenarioName.ResponsivenessMuteCall,i),m.default.trackMicButtonClick(e.callId,a),new u.ToggleMuteCommand(e.callId,e.isMuted,e.isServerMuted,!!e.disableMic,t,a).execute(),e.isMuted&&e.onLocalUnmute&&e.onLocalUnmute(),e.onInteracting(!1)}),[e,t]))(e,(0,y.useCommonContext)().rootViewId),i=(0,c.useActionButtonColorConfig)(!e.isMuted),l=o.getString(e.isMuted?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute"),d=e.isMuted,C=n.useCallback((e=>(0,a.jsx)(f.MicrophoneActivityIcon,Object.assign({},e,{isMuted:d,legacy:!0}))),[d]);return(0,a.jsx)(s.default,{icon:e.isMuted?r.SkypeIcon.MicrophoneOff:r.SkypeIcon.Microphone,accessibilityLabel:l,title:l,size:s.ActionButtonSize.Medium,backgroundColor:null==i?void 0:i.backgroundColor,iconColor:null==i?void 0:i.iconColor,onPress:t,renderIcon:e.enableMicSoundIndicator?C:void 0,reverseGradientColor:!0})})),(e=>{const t=C.default.getS4LCMCFeatures().enableMicSoundIndicator,i=l.default.CallingStore.isServerMuted(e.callId),a=S.default.isLocalOrServerMuted(e.callId);return Object.assign(Object.assign({},e),{enableMicSoundIndicator:t,isServerMuted:i,isMuted:a})}))},134296:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(705465),s=i(582107),r=i(660198),l=i(994224),c=i(675990),d=i(108837),u=i(764455),h=i(265029),p=i(838008);t.default=(0,r.WithResub)(n.memo((e=>{const t=e.showCallControlsVertically?s.styles.defaultContainerLandscape:s.styles.defaultContainer;return(0,a.jsxs)(o.View,Object.assign({style:t},{children:[(0,a.jsx)(c.default,{callId:e.callId,onInteracting:e.onInteracting,isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,connectedCallId:e.connectedCallId}),(0,a.jsx)(d.default,{callId:e.callId,onInteracting:e.onInteracting,disableMic:e.disableMic,onLocalUnmute:e.onLocalUnmute}),(0,a.jsx)(h.default,{callId:e.callId,callUIState:e.callUIState,isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,connectedCallId:e.connectedCallId}),(0,a.jsx)(p.AudioOutputButton,{callId:e.callId,onInteracting:e.onInteracting}),(0,a.jsx)(u.default,{isEncryptedCall:e.isEncryptedCall,callUIState:e.callUIState,onOverflowPressed:e.onOverflowPressed})]}))})),(e=>{const t=l.default.CallingStore.getCallState(e.callId);return Object.assign(Object.assign({},e),{callState:t})}))},764455:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(4736),s=i(480200),r=i(436237),l=i(516283),c=i(733754),d=i(711828),u=i(293055);t.default=n.memo((e=>{const t=n.useRef(null),i=(h=t.current,p=e.onOverflowPressed,n.useCallback((()=>{r.log(l.LogTraceArea.CallingUI,"MobileCallPanelControls._showOverflowMenu"),p((()=>h),!0)}),[h,p]));var h,p;const g=(0,u.useActionButtonColorConfig)(!1),C=e.isEncryptedCall||e.callUIState===s.CallUIState.None,S=c.getString("CallControls.CallButtonOverflowMenu");return(0,a.jsx)(o.default,{ref:t,icon:d.SkypeIcon.More,title:S,accessibilityLabel:S,backgroundColor:null==g?void 0:g.backgroundColor,iconColor:null==g?void 0:g.iconColor,size:o.ActionButtonSize.Medium,onPress:i,disabled:C})}))},265029:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(4736),s=i(471727),r=i(994224),l=i(480200),c=i(671830),d=i(660198),u=i(293055);t.default=(0,d.WithResub)(n.memo((e=>{const t=(0,u.useActionButtonColorConfig)(!1);if(!e.reactionButtonType||!e.reactionCommand)return null;const i=e.callUIState===l.CallUIState.None,n=s.default.getReactionButtonDescriptors(e.reactionButtonType,e.reactionCommand);return(0,a.jsx)(o.default,{icon:n.icon,title:n.accessibilityLabel,accessibilityLabel:n.accessibilityLabel,backgroundColor:null==t?void 0:t.backgroundColor,iconColor:null==t?void 0:t.iconColor,size:o.ActionButtonSize.Medium,onPress:n.onPress,disabled:i})})),(e=>{const t=r.default.CallingFeaturesHelper.allowReactionsInCallStageMobile();let i,a;return t&&(i=s.default.getReactionButtonType(e.conversationMri,e.callId),a=s.default.getReactionCommand(i,e.callId,e,c.getReactionsThreadMriForCallId(e.callId))),Object.assign(Object.assign({},e),{isReactButtonEnabledInCallControls:t,reactionButtonType:i,reactionCommand:a})}))},582107:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.styles=void 0;const a=i(705465);t.styles=a.StyleSheet.create({defaultContainer:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},defaultContainerLandscape:{display:"flex",flexDirection:"column",flexGrow:1,flexShrink:0,alignItems:"center",justifyContent:"space-between"}})},699620:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallConversationPanel=void 0;const a=i(785893),n=i(516778),o=i(889391),s=i(996074),r=i(109520),l=i(47447),c=i(314920),d=i(614980),u=i(711930),h=i(539549),p=i(437490),g=i(770891),C=i(746096),S=i(139285),m=i(805581),y=i(436237),f=i(915877),b=i(733754),_=i(673319),T=i(663328),v=i(104735),w=i(827357),I=i(126978),P=i(190631),M=i(311010),k=i(711828),A=i(680837),R=i(853374),x=(0,f.lazyProperties)({base:()=>n.Styles.createViewStyle({flex:1,alignItems:"stretch",paddingBottom:20}),baseTablet:()=>n.Styles.createViewStyle({paddingBottom:0}),headerPanelStyle:()=>n.Styles.createViewStyle({paddingHorizontal:0}),centeredText:()=>n.Styles.createTextStyle({textAlign:"center"}),centeredView:()=>n.Styles.createViewStyle({justifyContent:"center",alignItems:"center",flex:1,flexDirection:"row"})});class L extends s.default{constructor(){super(...arguments),this._onToggleFindPanelWithOverflowConfig=e=>{const t=R.default.newCauseId();return y.log(C.LogTraceArea.FindPanel,"CallConversationPanel._onToggleFindPanelWithOverflowConfig, causeId: "+t),this.state.isFindPanelShowing?(y.track(new _.MessageOverflowEvent(_.MessageOverflowAction.MessageOverflowCloseButtonClicked)),v.default.closeFindPanel(t,this._getContext())):(y.track(new _.MessageOverflowEvent(_.MessageOverflowAction.MessageOverflowOpenButtonClicked)),v.default.navigateToFindPanel(this.props.conversationId,e,this._getContext(),t)),!0},this._handleLaunchCamera=()=>{l.UICapabilities.cameraSupported()&&(p.dismissAll(),d.navigateToCaptureComboModalWithParams({capturedContentHandler:new c.CapturedContentHandlerForPosting(this.props.conversationId),conversationId:this.props.conversationId,allowVideo:!0,mediaPickerShouldCollapseFully:!0,showCoachmarksIfNeeded:!0},this._getContext()))},this._onClosePress=()=>{const e=R.default.newCauseId();y.log(C.LogTraceArea.Navigation,"CallConversationPanel._onClosePress, causeId: "+e),this.props.onClose?this.props.onClose(e):v.default.closeConversationInCall(e,this._getContext())},this._onExpandPress=()=>{y.log(C.LogTraceArea.Navigation,"Going to full screen conversation"),y.track(new r.FullChatUXTelemetryEvent(r.FullChatUXNavigation.Enter,this.props.conversationId,this.props.callId)),v.default.navigateToConversation({convId:this.props.conversationId,origin:C.NavigationConversationOrigin.Call,causeId:R.default.newCauseId()})}}_buildState(e){const t=(0,h.default)().getConversation(e.conversationId);return{otherPartyMri:t&&t.isOneOnOne()?t.getOtherPartyMri():void 0,sideBarWidth:I.default.getWidth(),isFindPanelShowing:w.default.isFindPanelShowing(this._getRootViewId()),enableFullChatUx:o.default.getS4LMessagingFeatures().enableFullChatUx,isTranslatedConversation:m.default.isConversationTranslated(e.conversationId),enableRefreshedPalette:o.default.getS4LUiFeatures().enableRefreshedPalette}}_getTitleView(){return(0,a.jsx)(n.View,Object.assign({style:x.centeredView},{children:(0,a.jsx)(S.HiddenText,Object.assign({style:[x.centeredText,M.default.fontStyle.h5,this._themeStyles.headerTextColorStyle]},{children:b.getString("CallPanel.ChatTitle")}))}))}render(){const e=u.default.applyShouldGroupAccessibilityChildren({style:[x.base,this._themeStyles.messageStreamBackgroundColorStyle,void 0,this.state.enableRefreshedPalette?n.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1):void 0]}),t={closeButtonType:P.CloseButtonType.Close,onPress:this._onClosePress,title:b.getString("CallPanel.CloseConversation")},i=[];this.state.enableFullChatUx&&i.push({icon:k.SkypeIcon.Expand,text:b.getString("CallPanel.Expand"),onPress:this._onExpandPress});const o=this._getContext().isPresentedInDesktopRightNav?{leftButton:t,rightButtons:i,titleView:this.state.enableFullChatUx?this._getTitleView():void 0,titleTextStyle:this.state.enableFullChatUx?A.default.flexNegativeOne:void 0}:{leftButton:void 0,rightButtons:t,titleView:(0,a.jsx)(n.View,{style:A.default.flexOne})};return(0,a.jsxs)(n.View,Object.assign({},e,{children:[(0,a.jsx)(P.SimplePanelHeader,Object.assign({style:x.headerPanelStyle,hideBottomBorder:!0,useCenteredControls:!0},o)),(0,a.jsx)(T.default,{conversationId:this.props.conversationId,otherPartyMri:this.state.otherPartyMri,renderOrigin:g.MessageRenderOrigin.CallCanvas,allowUploads:!0,hasConnectedCalls:!0,availableWidth:this.state.sideBarWidth,onHandleOverflow:this._onToggleFindPanelWithOverflowConfig,onLaunchCamera:this._handleLaunchCamera,onToggleFindPanel:this._onToggleFindPanelWithOverflowConfig,isFindPanelHidden:!this.state.isFindPanelShowing,isTranslatedConversation:this.state.isTranslatedConversation})]}))}}t.CallConversationPanel=L,t.default=L},379857:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(469840),s=i(581760),r=i(435084),l=i(257538),c=i(238409),d=i(18078),u=i(915877),h=i(733754),p=i(711828),g=i(110117),C=i(746096),S=i(533603),m=i(172490),y=i(436237),f=i(172758),b=i(865788),_=i(647176),T=i(912770),v=i(910025),w=i(24576),I=i(844285),P=i(539549),M=(0,u.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",top:40,left:0,right:0,margin:6,padding:24,borderRadius:16,maxWidth:400,minHeight:180}),headerView:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",overflow:"visible"}),joinLinkButton:()=>n.Styles.createViewStyle({marginBottom:16}),inviteButton:()=>n.Styles.createButtonStyle({alignSelf:"center",alignContent:"center",alignItems:"center",flexDirection:"row"}),inviteButtonText:()=>n.Styles.createTextStyle({color:s.Color.blue,fontSize:16,lineHeight:24}),nameInput:()=>n.Styles.createViewStyle({marginTop:10}),primaryLabel:()=>n.Styles.createTextStyle({flexGrow:1,marginBottom:16,fontSize:15,lineHeight:22,fontWeight:"600"}),primaryLabelGuestFlow:()=>n.Styles.createTextStyle({flexGrow:1,marginBottom:16,fontSize:16,lineHeight:22}),secondaryLabel:()=>n.Styles.createTextStyle({marginBottom:16,fontSize:16,lineHeight:21}),closeButton:()=>n.Styles.createTextStyle({marginTop:-8,marginRight:-6})});class k extends w.default{constructor(){super(...arguments),this._autoCloseTimeoutMs=5e3,this._isAutoCloseBlocked=!1,this._getContainerBackgroundStyles=()=>{const e=this._useDarkTheme()?s.Color.gray400overlay95:s.Color.gray50overlay95;let t;if(!this.props.isProvidingVideo){const e={backgroundColor:s.Color.whiteOverlay50,shadowColor:s.Color.blackOverlay10,shadowOffset:{width:0,height:2},shadowOpacity:.1,shadowRadius:6},i={backgroundColor:this._themeColors.secondaryBackgroundColor};t=this._useDarkTheme()?i:e}return[M.container,n.Styles.createViewStyle(Object.assign({backgroundColor:e},t))]},this._onClose=()=>(!this.state.isGuestFlow||!this.state.isUserNameRequiredErrorVisible)&&(this._trackCloseEvent(b.MeetNowSharePopupCloseActionType.Manual),this.props.onClose(),!0),this._onUserNameChange=e=>{const t=e.trim();this.setState({isUserNameRequiredErrorVisible:!t.length,guestUserName:t})},this._onInviteSkypeContactsClick=()=>{this._isAutoCloseBlocked=!0},this._inviteByEmail=()=>{if(y.log(C.LogTraceArea.JoinLink,"CallCreatorShareOverlayPopup._inviteByEmail "+l.MeetNowShareInviteCommands.DefaultMail),!this.state.joinLink)return y.log(C.LogTraceArea.JoinLink,"CallCreatorShareOverlayPopup._inviteByEmail abort, no joinLink");S.default.clickShare(l.MeetNowShareInviteCommands.DefaultMail,{joinLink:this.state.joinLink,threadId:this._threadId,rootViewId:this._getRootViewId(),meetNowParameters:Object.assign(Object.assign({},this.props.meetNowParameters),{origin:l.MeetNowOrigin.CreatorPanelPopup})})},this._enableAutoCloseFlow=()=>{const e=_.default.getActiveParticipants(this.props.callId,this.props.conversationMri).length>1,t=!(this._autoCloseTimer||this._isAutoCloseBlocked);e&&t&&this._startAutoCloseTimer(),this._autoCloseTimer&&this._isAutoCloseBlocked&&T.default.clearTimeout(this._autoCloseTimer)},this._startAutoCloseTimer=()=>{this._autoCloseTimer=T.default.setTimeout((()=>{this.isComponentMounted()&&(this._trackCloseEvent(b.MeetNowSharePopupCloseActionType.Auto),this.props.onClose())}),this._autoCloseTimeoutMs)},this._trackCloseEvent=e=>{const t=this._createdAt-(new Date).getTime();y.track(new b.MeetNowSharePopupCloseEvent(this.props.meetNowParameters,e,this.state.isGuestFlow,t))}}_buildState(e,t){var i;const a=d.default.getSkypeMri(),n=f.default.getDisplayableUserByMri(a),s=I.MeetNowHelpers.isGuestFlow();this._threadId=this.props.conversationMri,this._defaultGuestUserName=n.displayName;const r=null===(i=(0,P.default)().getConversation(this._threadId))||void 0===i?void 0:i.isJoinEnabled();return t&&(this._createdAt=(new Date).getTime()),s||this._enableAutoCloseFlow(),{isGuestFlow:s,showLinkCopied:!t&&this.state.showLinkCopied,guestUserName:t?this._defaultGuestUserName:this.state.guestUserName,joinLink:o.default.getLink(this._threadId),isUserNameRequiredErrorVisible:!1,isJoinEnabled:r}}componentDidMount(){super.componentDidMount(),m.default.addEscapeHandler(this._onClose)}componentWillUnmount(){super.componentWillUnmount(),m.default.removeEscapeHandler(this._onClose)}render(){return this.state.isGuestFlow?this._renderGuestPopup():this._renderPopup()}_renderCloseButton(){const e=[M.closeButton];return this._getContext().isRTL&&e.push(n.Styles.createTextStyle({marginRight:0,marginLeft:-6})),(0,a.jsx)(n.Button,Object.assign({accessibilityLabel:h.getString("CallCreatorShareOverlayPopup.CloseButtonAccessibilityLabel"),style:e,onPress:this._onClose},{children:(0,a.jsx)(g.default,{color:this._themeColors.primaryIconColor,size:p.IconSize.size24,icon:p.SkypeIcon.Cancel},"dismissButton")}))}_renderShareInviteEmail(){const e=n.Styles.createTextStyle({textDecorationLine:"underline",alignSelf:"center",color:s.Color.blue});return(0,a.jsx)(n.Button,Object.assign({accessibilityLabel:h.getString("CallCreatorShareOverlayPopup.ShareByEmailLabelAccessibilityLabel"),style:e,onPress:this._inviteByEmail},{children:(0,a.jsx)(n.Text,Object.assign({style:M.inviteButtonText},{children:h.getString("CallCreatorShareOverlayPopup.ShareByEmailLabel")}))}))}_renderMeetNowJoinLinkButton(){return(0,a.jsx)(r.default,{threadId:this._threadId,joinLink:this.state.joinLink,partnerParameters:this.props.meetNowParameters,useVerboseView:!0,style:[M.joinLinkButton],useAppTheme:!0})}_renderGuestPopup(){const e=this.state.isJoinEnabled&&(0,a.jsxs)(n.View,{children:[(0,a.jsx)(n.Text,Object.assign({style:[M.secondaryLabel,{color:this._themeColors.primaryTextColor}]},{children:h.getString("CallCreatorShareOverlayPopup.SecondaryLabel")})),this._renderMeetNowJoinLinkButton(),this._renderShareInviteEmail()]});return(0,a.jsxs)(n.View,Object.assign({style:this._getContainerBackgroundStyles()},{children:[(0,a.jsxs)(n.View,Object.assign({style:M.headerView},{children:[(0,a.jsx)(n.Text,Object.assign({style:[M.primaryLabelGuestFlow,{color:this._themeColors.primaryTextColor}]},{children:h.getString("CallCreatorShareOverlayPopup.PrimaryLabelGuestFlow")})),this._renderCloseButton()]})),(0,a.jsx)(c.default,{threadId:this._threadId,isErrorVisible:this.state.isUserNameRequiredErrorVisible,meetNowParameters:this.props.meetNowParameters,onChangeValue:this._onUserNameChange}),e]}))}_renderPopup(){return(0,a.jsxs)(n.View,Object.assign({style:this._getContainerBackgroundStyles()},{children:[(0,a.jsxs)(n.View,Object.assign({style:M.headerView},{children:[(0,a.jsx)(n.Text,Object.assign({style:[M.primaryLabel,{color:this._themeColors.secondaryTextColor}]},{children:h.getString("CallCreatorShareOverlayPopup.PrimaryLabel")})),this._renderCloseButton()]})),(0,a.jsx)(n.Text,Object.assign({style:[M.secondaryLabel,{color:this._themeColors.primaryTextColor}]},{children:h.getString("CallCreatorShareOverlayPopup.SecondaryLabel")})),this._renderMeetNowJoinLinkButton(),this.state.joinLink&&(0,a.jsx)(v.default,{joinLink:this.state.joinLink,conversationMri:this.props.conversationMri,meetNowParameters:Object.assign(Object.assign({},this.props.meetNowParameters),{origin:l.MeetNowOrigin.CreatorPanelPopup}),logSource:"CallCreatorShareOverlayPopup",onClick:this._onInviteSkypeContactsClick})]}))}}t.default=k},810701:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallEventStreamItem=void 0;const a=i(785893),n=i(516778),o=i(217041),s=(i(934339),i(95952),i(915877)),r=i(390244),l=i(581760),c=i(619675),d=i(702301),u=i(567977).UserIconSize.Size26,h=(0,s.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",left:16,right:16,paddingTop:12,flexDirection:"row",alignSelf:"stretch",overflow:"visible"}),contentContainer:()=>n.Styles.createViewStyle({flex:-1,alignItems:"stretch",alignSelf:"center",paddingLeft:5,paddingRight:10}),middleContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignSelf:"stretch",overflow:"visible"}),middleContentInner:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"flex-start",overflow:"visible"}),contentText:()=>n.Styles.createTextStyle({color:l.Color.black,paddingVertical:8}),contentTextLight:()=>n.Styles.createTextStyle({color:l.Color.white}),wrapper:()=>n.Styles.createViewStyle({flex:-1,paddingHorizontal:8,flexDirection:"row",minHeight:40,borderRadius:20,backgroundColor:l.Color.blackOverlay50,justifyContent:"center",alignItems:"center",overflow:"visible"}),flipSide:()=>n.Styles.createViewStyle({height:u,width:u,alignItems:"center",justifyContent:"center"}),flipContainer:()=>n.Styles.createViewStyle({height:u,width:u,overflow:"visible"}),raiseHandBorderStyle:()=>n.Styles.createViewStyle({borderColor:l.Color.raiseHandOrange,borderWidth:2})});class p extends o.ComponentBase{constructor(){super(...arguments),this._onLayoutChange=e=>{this.props.layoutController&&this.props.layoutController.setIntrinsicHeight(e.height)}}_getColorStyle(){return n.Styles.createViewStyle({backgroundColor:this.props.backgroundColor},!1)}_getUserIconElement(){if(!this.props.mri)return;const e=(0,a.jsx)(d.UserIcon,{size:u,userMri:this.props.mri,imageBorderStyleOverride:this.props.isRaiseHandEvent?h.raiseHandBorderStyle:void 0});return this.props.isLeaveEvent||this.props.isRaiseHandEvent||this.props.isTextEvent,e}componentDidMount(){super.componentDidMount(),n.Accessibility.announceForAccessibility(this.props.displayString)}render(){const e=[h.wrapper,this._getColorStyle()],t=[h.contentText];(this.props.isLeaveEvent||this.props.useLightText)&&t.push(h.contentTextLight);const i=this.props.isRaiseHandEvent?(0,a.jsx)(r.default,{type:r.RaiseHandImageType.SmallSizeTopLeftAligned}):void 0,o=(0,a.jsxs)(n.View,Object.assign({style:e},{children:[this._getUserIconElement(),i,(0,a.jsx)(n.View,Object.assign({style:h.contentContainer},{children:(0,a.jsx)(c.BodyText,Object.assign({size:c.BodyTextSize.SmallDeprecated,style:t},{children:this.props.displayString}))}),"contentContainer")]}),"contentContainerWrapper"),s=(0,a.jsx)(n.View,Object.assign({style:h.middleContentInner,ignorePointerEvents:!0},{children:o}),"middleContentInner"),l=[h.container];return this.props.layoutController&&l.push(this.props.layoutController.getStyles()),this.props.horizontalSafeAreaInsets&&this.props.horizontalSafeAreaInsets.left>16&&l.push(n.Styles.createViewStyle({left:this.props.horizontalSafeAreaInsets.left,right:this.props.horizontalSafeAreaInsets.right},!1)),(0,a.jsx)(n.Animated.View,Object.assign({style:l,ignorePointerEvents:!0,onLayout:this._onLayoutChange},{children:(0,a.jsx)(n.View,Object.assign({style:h.middleContainer,ignorePointerEvents:!0},{children:s}),"middleContent")}))}}t.CallEventStreamItem=p,t.default=p},4325:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(244770),r=i(889391),l=i(994224),c=i(471727),d=i(746096),u=i(436237),h=i(136400),p=i(915877),g=i(733754),C=i(581760),S=i(311010),m=i(619675),y=i(24576),f=i(853374),b=i(702301),_=i(567977),T=(0,p.lazyProperties)({bingBackgroundsContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginRight:16,width:void 0}),bingBackgroundsIcon:()=>o.Styles.createViewStyle({width:16,height:16}),bingBackgroundsIconSmall:()=>o.Styles.createViewStyle({width:12,height:12}),bingBackgroundsIconMargin:()=>o.Styles.createViewStyle({marginRight:5}),bingBackgroundsText:()=>o.Styles.createTextStyle({backgroundColor:C.Color.transparent,textAlign:"center",textAlignVertical:"center",marginRight:5,paddingBottom:1}),bingBackgroundsFont:()=>o.Styles.createTextStyle({fontSize:S.default.fontSize.size13Deprecated,font:S.default.font.uiDisplayRegular}),bingBackgroundsFontColor:()=>o.Styles.createTextStyle({color:C.Color.white}),bingBackgroundsFontColorLight:()=>o.Styles.createTextStyle({color:C.Color.gray400}),bingBackgroundsUserIcon:()=>o.Styles.createViewStyle({marginRight:1}),plusCountContainer:()=>o.Styles.createTextStyle({height:20,minWidth:20,textAlign:"center"})});class v extends y.default{constructor(){super(...arguments),this._onBingBackgroundsPressed=()=>{const e=f.default.newCauseId();u.log(d.LogTraceArea.CallingUI,"CallPanelHeaderV2._onBingBackgroundsPressed, causeId: "+e),this.props.onBingBackgroundsPressed&&this.props.onBingBackgroundsPressed(e)}}_buildState(e,t){const i=l.default.CallParticipantBackgroundInfoStore.getBackgroundInfos(e.callId),a=r.default.getS4LCMCFeatures().bingBackgrounds;return{captions:i,bingBackgroundsUsers:this._getUserIconList(i),showIconCount:a.iconCountInHeader,compactView:c.default.isDesktopMinCallPanelHeaderV2(this._getRootViewId())}}_getUserIconList(e){const t=[];for(const i of n.values(e))""!==i.isoDate&&t.push(i.userId);return t}render(){var e;const t=null!==(e=this.props.textStyleOverride)&&void 0!==e?e:T.bingBackgroundsFont,i=this.props.useLightTheme?T.bingBackgroundsFontColorLight:T.bingBackgroundsFontColor;let n,r,l=_.UserIconSize.Size20,c=20,d=14;this.props.v1&&(l=_.UserIconSize.Size14,c=14,d=void 0,n=4,r=2);const u=o.Styles.createViewStyle({height:c,width:c}),p=o.Styles.createViewStyle({marginTop:r}),C=this.props.v1?T.bingBackgroundsIconSmall:T.bingBackgroundsIcon,S=o.Styles.createViewStyle({height:this.props.height,marginLeft:n,marginRight:d}),y=[];if(this.state.bingBackgroundsUsers&&this.state.bingBackgroundsUsers.length>0&&this.state.showIconCount&&this.state.showIconCount>0){const e=this.state.bingBackgroundsUsers.length>this.state.showIconCount?this.state.showIconCount:this.state.bingBackgroundsUsers.length;for(let t=0;t<e;t++){const e=this.state.bingBackgroundsUsers[t];y.push((0,a.jsx)(b.UserIcon,{userMri:e,size:l,useCircleForAgentMask:!0,statusBorderColor:this._themeColors.primaryBackgroundColor,style:[T.bingBackgroundsUserIcon,p]},"userIcon-"+t))}const n=this.state.bingBackgroundsUsers.length-this.state.showIconCount;n>0&&y.push((0,a.jsx)(m.BodyText,Object.assign({style:[T.bingBackgroundsUserIcon,T.plusCountContainer,i,t,u,p]},{children:`+${n}`}),"userIcon-hidden"))}const f=g.getString("CallControls.BingBackgrounds");let v;return this.state.compactView||(v=(0,a.jsx)(m.BodyText,Object.assign({style:[T.bingBackgroundsText,t]},{children:f}))),(0,a.jsxs)(h.HoverableButton,Object.assign({style:[T.bingBackgroundsContainer,S],title:f,accessibilityLabel:f,onPress:this._onBingBackgroundsPressed},{children:[(0,a.jsx)(o.Image,{source:s.Collection.BING_LOGO_SMALL,style:[C,T.bingBackgroundsIconMargin],resizeMode:"cover"}),v,y]}))}}t.default=v},69339:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BackButton=void 0;const a=i(785893),n=i(667294),o=i(919640),s=i(733754),r=i(436237),l=i(516283),c=i(853374),d=i(293055),u=i(238280);t.BackButton=e=>{const t=(i=e.onBackButtonPress,n.useCallback((()=>{const e=c.default.newCauseId();r.log(l.LogTraceArea.CallingUI,`useBackButtonPress, causeId: ${e}`),i(e)}),[i]));var i;const{textColorPrimary:h}=(0,d.useThemeColors)();return(0,a.jsx)(o.HeaderBackButton,{style:u.styles.backButton,tintColor:h,onPress:t,accessibilityLabel:s.getString("Global.BackButtonTitle")})}},457754:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallInfo=void 0;const a=i(785893),n=i(667294),o=i(705465),s=i(660198),r=i(436237),l=i(647176),c=i(441953),d=i(293055),u=i(749680),h=i(238280),p=i(104735),g=i(853374),C=i(258187),S=i(516283);t.CallInfo=(0,s.WithResub)((e=>{const{textColorSecondary:t}=(0,d.useThemeColors)(),i=(0,C.useCommonContext)(),s=n.useMemo((()=>[h.styles.textSecondary,{color:t}]),[t]),l=e.participantCount>0,y=e.isCallActive,f=l&&y,b=n.useCallback((()=>{const t=g.default.newCauseId();r.log(S.LogTraceArea.CallingUI,`CallInfoView onParticipantCountPress, callId ${e.callId}, causeId: ${t}`),p.default.openCallRoster(e.conversationMri,e.callId,t,i)}),[e.conversationMri,e.callId,i]);return(0,a.jsxs)(o.View,Object.assign({style:h.styles.defaultContainer},{children:[l?(0,a.jsx)(c.ParticipantsCount,{onPress:b,participantCount:e.participantCount,style:s}):null,f?(0,a.jsx)(m,{style:s}):null,y?(0,a.jsx)(u.CallTimer,{style:s,callId:e.callId,isCallActive:e.isCallActive}):null]}))}),(e=>{var t;return{participantCount:null!==(t=l.default.getActiveParticipants(e.callId,e.conversationMri).length)&&void 0!==t?t:0,callId:e.callId,conversationMri:e.conversationMri,isCallActive:e.isCallActive}}));const m=e=>(0,a.jsx)(o.View,Object.assign({style:h.styles.separator},{children:(0,a.jsx)(o.Text,Object.assign({style:e.style},{children:"|"}))}))},749680:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallTimer=void 0;const a=i(785893),n=i(667294),o=i(705465),s=i(912770),r=i(816402),l=i(994224);t.CallTimer=e=>{const t=((e,t)=>{var i;const[a,o]=n.useState(Date.now()),r=n.useRef(0),c=null!==(i=l.default.OngoingCallService.getCallConnectedTime(e))&&void 0!==i?i:Date.now();return n.useEffect((()=>(t&&(r.current=s.default.setInterval((()=>{o(Date.now())}),1e3)),()=>{s.default.clearInterval(r.current)})),[t]),a-c})(e.callId,e.isCallActive);return(0,a.jsx)(o.Text,Object.assign({style:e.style,numberOfLines:1,accessibilityLabel:r.default.getFormattedDuration(t/1e3,!0)},{children:r.default.getElapsedTimeStringFromMs(t)}))}},682360:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EndCallButton=void 0;const a=i(785893),n=i(667294),o=i(516283),s=i(220187),r=i(436237),l=i(733754),c=i(22222),d=i(898278),u=i(711828),h=i(581760),p=i(853374),g=i(258187);t.EndCallButton=e=>{const t=(i=e.callId,n.useCallback((()=>{const e=p.default.newCauseId();r.log(o.LogTraceArea.CallingUI,`EndCallButton useEndCallAction called for ${i}, ${e}`);const t=new s.EndCallCommand(i,e,(e=>{r.error(o.LogTraceArea.CallingUI,`EndCallButton useEndCallAction failed for ${i}, causeId: ${e}`)}));t.execute()}),[i]));var i;const C=(()=>{const{themeColors:e,mode:t}=(0,g.useCommonContext)();return n.useMemo((()=>({backgroundColor:t.isAccessible?e.secondaryTextColor:h.Color.red,textColor:e.coloredBackgroundTextColor})),[e,t])})();return(0,a.jsx)(c.default,{title:l.getString("CallControls.CallButtonEndCall"),accessibilityLabel:l.getString("CallControls.CallButtonEndCall"),buttonSize:d.SXButtonSize.Small,icon:u.SkypeIcon.CallEnd,buttonStyle:d.SXButtonStyle.ColorFill,buttonConfig:C,onPress:t})}},388633:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MobileCallPanelHeader=void 0;const a=i(785893),n=i(667294),o=i(705465),s=i(660198),r=i(952262),l=i(733754),c=i(682360),d=i(293055),u=i(69339),h=i(457754),p=i(238280);t.MobileCallPanelHeader=({isLandscape:e,conversationTitle:t,callId:i,isCallActive:s,onBackButtonPress:r,conversationId:l,style:g})=>{const{textColorPrimary:C}=(0,d.useThemeColors)(),S=(0,a.jsx)(o.Text,Object.assign({numberOfLines:1,style:[e?p.styles.textPrimaryAlt:p.styles.textPrimary,{color:C}]},{children:t}));return(0,a.jsx)(o.View,Object.assign({style:[p.styles.defaultContainer,p.styles.headerContainer,g]},{children:(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)(o.View,Object.assign({style:e?[p.styles.containerSideCommonLandscape,p.styles.containerLeftLandscape]:void 0},{children:[(0,a.jsx)(u.BackButton,{onBackButtonPress:r}),e?S:null]})),(0,a.jsxs)(o.View,Object.assign({style:e?p.styles.containerCenterLandscape:p.styles.containerCenterPortrait},{children:[e?null:S,(0,a.jsx)(h.CallInfo,{callId:i,conversationMri:l,isCallActive:s})]})),(0,a.jsx)(o.View,Object.assign({style:e?[p.styles.containerSideCommonLandscape,p.styles.containerRightLandscape]:void 0},{children:(0,a.jsx)(c.EndCallButton,{callId:i})}))]})}))},t.default=(0,s.WithResub)(n.memo(t.MobileCallPanelHeader),(e=>{var t;const i=null!==(t=r.default.getDisplayName(e.conversationId))&&void 0!==t?t:l.getString("Notifications.UnknownUserShort");return Object.assign(Object.assign({},e),{conversationTitle:i})}))},441953:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantsCount=void 0;const a=i(785893),n=i(705465),o=i(733754);t.ParticipantsCount=e=>(0,a.jsx)(n.Text,Object.assign({style:e.style,numberOfLines:1,onPress:e.onPress,accessibilityRole:e.onPress?"button":"text",accessibilityHint:e.onPress?o.getString("ContentPanelHeaderTitle.ManageGroup"):void 0,accessible:!0},{children:o.getString("ContentPanelHeaderTitle.ParticipantsLowercase",{count:e.participantCount})}))},293055:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useActionButtonColorConfig=t.useThemeColors=void 0;const a=i(600212);t.useThemeColors=()=>{const{themeColors:e}=(0,a.useSkypeTheme)();return{textColorPrimary:e.headerTextColor,textColorSecondary:e.secondaryTextColor}};t.useActionButtonColorConfig=e=>{const{themeColors:t}=(0,a.useSkypeTheme)();if(e)return;return{iconColor:t.headerIconColor,backgroundColor:t.buttonBackgroundColor}}},125705:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MobileCallPanelHeader=void 0;var a=i(388633);Object.defineProperty(t,"MobileCallPanelHeader",{enumerable:!0,get:function(){return a.default}})},238280:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.styles=void 0;const a=i(705465);t.styles=a.StyleSheet.create({defaultContainer:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start"},headerContainer:{justifyContent:"space-between",paddingHorizontal:12},textPrimary:{lineHeight:22,fontSize:18,fontWeight:"600",letterSpacing:-.408},textPrimaryAlt:{lineHeight:20,fontSize:15,fontWeight:"400",letterSpacing:-.24},textSecondary:{fontSize:13,lineHeight:18,fontWeight:"400",letterSpacing:-.078},separator:{marginHorizontal:4},backButton:{marginHorizontal:0},containerCenterPortrait:{marginRight:"auto",flexGrow:1,display:"flex",flexDirection:"column",justifyContent:"flex-start",paddingHorizontal:4},containerSideCommonLandscape:{flexGrow:1,flexShrink:1,flexBasis:"50%",alignItems:"center",flexDirection:"row"},containerLeftLandscape:{justifyContent:"flex-start"},containerRightLandscape:{justifyContent:"flex-end"},containerCenterLandscape:{display:"flex",alignItems:"center",flexDirection:"row",flexShrink:0,flexGrow:0,paddingHorizontal:4}})},981783:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallItemLayoutController=void 0;const a=i(496486),n=i(516778),o=i(974634),s=i(890295),r=i(480200),l=i(923413),c=i(471727),d=i(915877),u=i(330124),h=i(581760),p=i(640363),g=i(680837),C=i(853374),S=(0,d.lazyProperties)({elementBase:()=>n.Styles.createViewStyle({position:"absolute",overflow:"visible"}),stageElementBase:()=>n.Styles.createViewStyle({position:"relative",overflow:"visible",flexGrow:0,flexShrink:1}),stageBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:h.Color.callStageLight}),lightThemeBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:h.Color.gray50,borderColor:h.Color.gray200}),lightThemeVideoBorderStyle:()=>n.Styles.createViewStyle({backgroundColor:h.Color.gray100Overlay80})});class m{constructor(e,t,i,a,s){this._isCallStageV2=s,this._isHidden=!1,this._isDragging=!1,this._isTopRowElement=!1,this._currentBorderRadius=r.RibbonSizes.ribbonItemSizeSmall/2,this._currentRibbonRightInset=0,this._currentRibbonVerticalOffset=0,this._ribbonExpandedMultiplier=1,this._currentBackgroundOffset=0,this._useApproachValue=!1,this._panningThrottle=0,this._panEventCount=0,this._hasPositionedView=!1,this._globalResizeFactor=1,this._sessionStartResizeFactor=1,this._fullStageRect={x:0,y:0,width:0,height:0},this._currentRect={x:0,y:0,width:r.RibbonSizes.ribbonItemSizeSmall,height:r.RibbonSizes.ribbonItemSizeSmall},this._isResizing=!1,this._rawRibbonRect={x:0,y:0,width:r.RibbonSizes.ribbonItemSizeSmall,height:r.RibbonSizes.ribbonItemSizeSmall},this._animatedHorizontalValue=new n.Animated.Value(this._currentRect.x),this._animatedVerticalValue=new n.Animated.Value(this._currentRect.y),this._animatedWidthValue=new n.Animated.Value(this._currentRect.width),this._animatedHeightValue=new n.Animated.Value(this._currentRect.height),this._animatedBorderRadiusValue=new n.Animated.Value(this._currentBorderRadius),this._animatedBackgroundValue=new n.Animated.Value(this._currentBackgroundOffset),this._rectChangedEvent=new o.default,this._topRowChangedEvent=new o.default,this._isRTL=p.default.isRTL(),this._animatedStageHeightValue=new n.Animated.Value(1),this._animatedStageWidthValue=new n.Animated.Value(1),this._baseAnimatedStyle=n.Styles.createAnimatedViewStyle({width:this._animatedWidthValue,height:this._animatedHeightValue,top:this._animatedVerticalValue}),this._animatedStyleLTR=n.Styles.createAnimatedViewStyle({right:this._animatedHorizontalValue}),this._animatedStyleRTL=n.Styles.createAnimatedViewStyle({left:this._animatedHorizontalValue}),this._animatedInnerStyle=n.Styles.createAnimatedViewStyle({borderRadius:this._animatedBorderRadiusValue}),this._animatedBackgroundStyle=n.Styles.createAnimatedViewStyle({backgroundColor:this._animatedBackgroundValue.interpolate({inputRange:[0,1],outputRange:[h.Color.callStageDark,h.Color.callStageLight]})}),this._animatedStageContainerStyle=n.Styles.createAnimatedViewStyle({height:this._animatedStageHeightValue.interpolate({inputRange:[0,1],outputRange:["0%","100%"]}),width:this._animatedStageWidthValue.interpolate({inputRange:[0,1],outputRange:["0%","100%"]})}),this._key=e,this._currentRibbonRightInset=i,this._currentRibbonVerticalOffset=t,this._ribbonExpandedMultiplier=a}setHidden(e){this._isHidden!==e&&(this._isHidden=e,this._hiddenChangedCallback&&this._hiddenChangedCallback(e))}setResizeFactor(e){this._globalResizeFactor=e}getResizeFactor(){return this._globalResizeFactor}setUIPosition(e){this._uiPosition=e}getUIPosition(){return this._uiPosition}setFullStageRect(e){this._fullStageRect=e}setViewCanAnimateState(e,t){a.isUndefined(this._latestView)?(this._latestView=e,this._latestViewCanAnimate=t):this._latestView===e?(this._latestViewCanAnimate=t,t||(this._latestView=void 0)):this._latestView!==e&&t&&(this._latestView=e,this._latestViewCanAnimate=t)}onPan(e,t,i){if(!this._isDragging&&!e.isComplete&&(this._isDragging=!0,this._useApproachValue)){const e=i||this._currentRect,t={x:e.x+e.width/2,y:e.y+e.height/2};this._startApproach(t,(e=>{const t=this._centerRectAroundPoint(e);this._updateAnimatedValues(t,this._currentBorderRadius,!1,void 0,0,!0)}))}if(!e.isComplete&&this._panningThrottle>0&&this._panEventCount%this._panningThrottle>0)return void this._panEventCount++;const a=Math.max(Math.min(e.pageX-t.x,t.width),0),n=Math.max(Math.min(e.pageY-t.y,t.height),0),o=c.default.translatePoint({x:a,y:n},t.width);if(o)if(this._useApproachValue)this._approachValue&&this._approachValue.updateTarget(o);else{const e=this._centerRectAroundPoint(o);this._updateAnimatedValues(e,this._currentBorderRadius,!1,void 0,0,!0)}e.isComplete?(this._stopApproach(),this._isDragging=!1,this._panEventCount=0):this._panEventCount++}updateRibbonVerticalOffset(e,t,i=!1,a=r.CallStageConfig.animationDuration){if(this._currentRibbonVerticalOffset=e,this.isCompact()&&!this._isDragging){const e=this._ribbonViewRectFromRect(this._rawRibbonRect);this._updateAnimatedValues(e,this._currentBorderRadius,i,void 0,a)}}updateRibbonRightInset(e,t,i=!1,a=r.CallStageConfig.animationDuration){if(this._currentRibbonRightInset=e,this.isCompact()&&!this._isDragging){const e=this._ribbonViewRectFromRect(this._rawRibbonRect);this._updateAnimatedValues(e,this._currentBorderRadius,i,void 0,a)}}updateRibbonExpandedMultiplier(e,t,i=!1,a=r.CallStageConfig.animationDuration){if(this._ribbonExpandedMultiplier=e,this.isCompact()&&!this._isDragging){const e=this._ribbonViewRectFromRect(this._rawRibbonRect);this._updateAnimatedValues(e,this._currentBorderRadius,i,void 0,a)}}ribbonViewRect(){return this._ribbonViewRectFromRect(this._rawRibbonRect)}setRibbonPosition(e,t,i,a,n=!1){if(this._positionedInRibbon=!0,this._fullStageRect=i,this._rawRibbonRect=e,!this._isDragging){const i=this._ribbonViewRectFromRect(e);this._updateAnimatedValues(i,this._borderRadius(!1,t,a),n)}}resizeRect(e,t,i,n){if(!this._isDragging){if(this._isResizing||(this._sessionStartResizeFactor=this._globalResizeFactor,this._isResizing=!0),this._uiPosition===r.CallingViewUIPostion.FloatingOnTop){a.isUndefined(this._currentRectForResizingSession)&&(this._currentRectForResizingSession=this._currentRect),this._currentRectForResizingSession.height*e<r.RibbonSizes.ribbonItemSizeSmall&&(e=r.RibbonSizes.ribbonItemSizeSmall/this._currentRectForResizingSession.height),this._currentRectForResizingSession.width*e>this._fullStageRect.width/2&&(e=this._fullStageRect.width/2/this._currentRectForResizingSession.width);let t=this._currentRectForResizingSession;switch(i){case r.CallingViewCornerPostion.BottomLeft:t={x:this._currentRectForResizingSession.x,y:this._currentRectForResizingSession.y,width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e};break;case r.CallingViewCornerPostion.BottomRight:t={x:this._currentRectForResizingSession.x-this._currentRectForResizingSession.width*(e-1),y:this._currentRectForResizingSession.y,width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e};break;case r.CallingViewCornerPostion.UpperLeft:t={x:this._currentRectForResizingSession.x,y:this._currentRectForResizingSession.y-this._currentRectForResizingSession.height*(e-1),width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e};break;case r.CallingViewCornerPostion.UpperRight:t={x:this._currentRectForResizingSession.x-this._currentRectForResizingSession.width*(e-1),y:this._currentRectForResizingSession.y-this._currentRectForResizingSession.height*(e-1),width:this._currentRectForResizingSession.width*e,height:this._currentRectForResizingSession.height*e}}this._updateAnimatedValues(t,r.RibbonSizes.ribbonItemRectBorderRadius,!0),n&&(this._currentRectForResizingSession=void 0)}else this._uiPosition===r.CallingViewUIPostion.Ribbon&&(this._globalResizeFactor=Math.min(Math.max(this._sessionStartResizeFactor*e,1),4));n&&(this._isResizing=!1)}}setIsTopRowElement(e){this._isTopRowElement=e,this._topRowChangedEvent.fire(e)}getIsTopRowElement(){return this._isTopRowElement}setStagePosition(e,t,i,a,n,o=!1,s){this._positionedInRibbon=!1,this._fullStageRect=n,this._isDragging||this._updateAnimatedValues(t,this._borderRadius(!0,a,0),o,void 0,void 0,void 0,s),this._animatedBackgroundValue.setValue(i/e)}getStyles(e){return e?this._getStageStyles():[S.elementBase,this._baseAnimatedStyle,this._isRTL&&this._key===r.CallStageElementKeys.localUserKey?this._animatedStyleRTL:this._animatedStyleLTR]}getInnerStyles(){return[g.default.flexOne,this._animatedInnerStyle]}getBackgroundColorStyle(e){const t=e?S.lightThemeBackgroundStyle:S.stageBackgroundStyle;return this._isCallStageV2?t:this._animatedBackgroundStyle}getVideoBorderColorStyle(e){const t=e?S.lightThemeVideoBorderStyle:S.stageBackgroundStyle;return this._isCallStageV2?t:void 0}onDimensionsChanged(e){this._dimensionsChangedCallback=e}onRectChanged(e){return this._rectChangedEvent.subscribe(e)}onHiddenChanged(e){this._hiddenChangedCallback=e}onTopRowChanged(e){return this._topRowChangedEvent.subscribe(e)}isCompact(){return this._positionedInRibbon}isHidden(){return this._isHidden}viewRect(e){if(e){const e=c.default.translateRect(this._currentRect,this._fullStageRect.width);return Object.assign(Object.assign({},e),{x:e.x+this._fullStageRect.x,y:e.y})}return this._currentRect}setCallHeaderPanelLayout(e){this._callPanelHeaderLayout=e}bgInfoCaptionOffset(e,t){let i;const a=t||16;{i=a;const t=this._callPanelHeaderLayout===r.CallPanelHeaderLayout.Float;this._isTopRowElement&&t&&(i+=l.DesktopMinTopMargin);const n=c.default.isDesktopMinCallPanelHeader(e);!this._isCallStageV2&&this._isTopRowElement&&n&&(u.default.isUsingStackNavigationContextNoSubscription()?i+=r.CallPanelHeaderHeight.mobile:i+=r.CallPanelHeaderHeight.window)}return{x:a,y:i,width:0,height:0}}_getStageStyles(){return[S.stageElementBase,this._animatedStageContainerStyle]}_centerRectAroundPoint(e){const t=this._currentRect.width,i=this._currentRect.height;return{x:e.x-t/2,y:e.y-i/2,width:t,height:i}}_stopApproach(){this._approachValue&&(this._approachValue.stop(),this._approachValue=void 0)}_startApproach(e,t){this._useApproachValue&&(this._stopApproach(),this._approachValue=new s.default(e,t),this._approachValue.start())}_borderRadius(e,t,i){return e?0:t?r.RibbonSizes.ribbonItemRectBorderRadius:i/2}_ribbonViewRect(e,t,i,a){const n=C.default.clampValue(this._ribbonExpandedMultiplier,0,1),o=e+this._currentRibbonRightInset,s=(this._maxY(this._rawRibbonRect)+this._currentRibbonVerticalOffset+30)*(1-n),r={x:o,y:t+this._currentRibbonVerticalOffset-s,width:i,height:a};return this._isRTL?c.default.translateRect(r,this._fullStageRect.width):r}_ribbonViewRectFromRect(e){return this._ribbonViewRect(e.x,e.y,e.width,e.height)}_maxY(e){return e.y+e.height}_updateAnimatedValues(e,t,i,o,s,l,d){if(!a.isUndefined(this._latestViewCanAnimate)&&!this._latestViewCanAnimate)return;if(i&&this._hasPositionedView&&c.default.enableLayoutAnimation()){const i=s||r.CallStageConfig.animationDuration,a=o||n.Animated.Easing.InOut(),c=[];c.push(n.Animated.timing(this._animatedVerticalValue,{toValue:e.y,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedHorizontalValue,{toValue:e.x,duration:i,easing:a})),d&&(c.push(n.Animated.timing(this._animatedStageWidthValue,{toValue:d.width,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedStageHeightValue,{toValue:d.height,duration:i,easing:a}))),l||(c.push(n.Animated.timing(this._animatedWidthValue,{toValue:e.width,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedHeightValue,{toValue:e.height,duration:i,easing:a})),c.push(n.Animated.timing(this._animatedBorderRadiusValue,{toValue:t,duration:i,easing:a}))),c.length&&n.Animated.parallel(c).start()}else this._animatedVerticalValue.setValue(e.y),this._animatedHorizontalValue.setValue(e.x),d&&(this._animatedStageWidthValue.setValue(d.width),this._animatedStageHeightValue.setValue(d.height)),l||(this._animatedWidthValue.setValue(e.width),this._animatedHeightValue.setValue(e.height),this._animatedBorderRadiusValue.setValue(t));!this._dimensionsChangedCallback||this._currentRect.height===e.height&&this._currentRect.width===e.width?this._currentRect.x===e.x&&this._currentRect.y===e.y||this._rectChangedEvent.fire(e):(this._dimensionsChangedCallback(e),this._rectChangedEvent.fire(e)),this._currentRect=e,this._currentBorderRadius=t,this._hasPositionedView=!0}}t.CallItemLayoutController=m,t.default=m},292387:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(889391),s=i(739119),r=i(325489),l=i(796096),c=i(898278),d=i(834672),u=i(816402),h=i(952262),p=i(904604),g=i(436237),C=i(915877),S=i(733754),m=i(18078),y=i(104735),f=i(330124),b=i(359433),_=i(619675),T=i(24576),v=i(853374),w=(0,C.lazyProperties)({textStyle:()=>n.Styles.createTextStyle({justifyContent:"center",alignItems:"center",paddingHorizontal:10}),textStyleSelected:()=>n.Styles.createTextStyle({justifyContent:"center",alignItems:"center"}),markerTextPadding:()=>n.Styles.createViewStyle({paddingTop:4}),container:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",marginLeft:10,marginRight:10,paddingTop:10}),containerComposite:()=>n.Styles.createViewStyle({marginLeft:50,marginRight:0})});class I extends T.default{constructor(){super(...arguments),this._getCallForwardingActionLink=()=>(0,a.jsx)(b.default,Object.assign({style:[w.textStyle,w.markerTextPadding],onPress:this._onCallForwardingButtonPress,url:"#",blue:!0,linkTextStyle:c.LinkTextStyle.Caption},{children:S.getString("CallCard.SetupCallForwardingLink")}),"callForwardingCTALinkId"),this._onCallForwardingButtonPress=()=>{g.track(new d.SetUpCallForwardingClicked),y.default.navigateToCallingSettingsPanel(!1,this._getContext())}}_buildState(e,t){const i=p.default.getCreditEntitlement(),a=!!s.getPositiveCreditBalance(i)||p.default.userHasSubscriptions(),n=r.default.getCallLog(e.callId),c=l.default.calculateCallMarkerInfoFromPath(n,e.callId,e.conversationId,e.markerType,e.duration);return{isUsingStackNavigationContext:f.default.isUsingStackNavigationContext(),callerFirstName:h.default.getMemberShortNameForConversation(e.conversationId,e.callerMri),isCallerTheCurrentUser:m.default.isMyMri(e.callerMri),isPayingUser:a,enablePaidUsersCallForwardingUpsell:o.default.getS4LCommerceFeatures().creditUpsell.enablePaidUsersCallForwardingUpsell,enableAllUsersCallForwardingUpsell:o.default.getS4LCommerceFeatures().creditUpsell.enableAllUsersCallForwardingUpsell,markerType:c.type,duration:c.duration}}render(){let e,t,i,o;const s=this.state.markerType;switch(s){case l.CallMarkerType.Started:e=S.getString("CallCard.CallStartedMarker");break;case l.CallMarkerType.Missed:this.state.isCallerTheCurrentUser?e=S.getString("CallCard.MissedCallMarker"):(e=S.getString("CallCard.MissedCallFromCallerMarker",{caller:this.state.callerFirstName}),(this.state.enablePaidUsersCallForwardingUpsell&&this.state.isPayingUser||this.state.enableAllUsersCallForwardingUpsell)&&(o=this._getCallForwardingActionLink()));break;case l.CallMarkerType.Ended:e=this.props.messagesSentDuringCall?S.getString("CallCard.CallEndedMarker"):S.getString("CallCard.CallMarker"),this.state.duration&&(t=u.default.getFormattedDuration(this.state.duration,!1),i=u.default.getFormattedDuration(this.state.duration,!0));break;case l.CallMarkerType.Declined:e=S.getString("CallCard.CallDeclinedStatusMessage");break;case l.CallMarkerType.NoAnswer:e=S.getString("CallCard.CallNoAnswerStatusMessage");break;case l.CallMarkerType.Failed:e=S.getString("CallCard.CallFailedStatusMessage");break;default:v.default.switchStatementExhaustiveChecking(s)}const r=(0,a.jsx)(_.Caption,Object.assign({selected:!0,style:[w.textStyleSelected,this.props.style]},{children:e}),"callMarkerText"),c=t?S.getParts("CallCard.Marker",{markerText:r,markerValue:t}):r;let d=e;e&&i&&(d=S.getString("AccessibilityLabel.CallMarker",{markerText:e,duration:i}));const h=(0,a.jsx)(n.View,Object.assign({accessibilityLabel:d,accessibilityTraits:n.Types.AccessibilityTrait.Text},{children:(0,a.jsx)(_.Caption,Object.assign({style:[w.textStyle,w.markerTextPadding,this.props.style],textThemeColor:_.TextThemeColor.Secondary,accessibilityHidden:!0},{children:c}))})),p=[w.container];this.state.isUsingStackNavigationContext||this._getContext().isPresentedInDesktopSubview||p.push(w.containerComposite);const g=(0,a.jsx)(_.Caption,Object.assign({style:[w.textStyle,this.props.style]},{children:u.default.getDisplayTimeString(this.props.timestamp)}));return(0,a.jsxs)(n.View,Object.assign({style:p},{children:[g,h,o]}),`callMarker-${this.props.callId}`)}}t.default=I},884965:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(705465),o=i(967593),s=i(701025),r=i(581760),l=i(680837),c=[r.Color.gray400Overlay70,r.Color.transparent];t.default=({direction:e=o.GradientDirection.BOTTOM,hidden:t=!1,style:i})=>{const{top:r,bottom:d,left:u,right:h}=(0,s.useSafeAreaInsets)(),p=n.PixelRatio.get();if(t)return null;const g=[e===o.GradientDirection.BOTTOM?{top:-p*r}:{bottom:-p*d},{left:-p*u,right:-p*h}];return(0,a.jsx)(o.GradientView,{ignorePointerEvents:!0,style:[l.default.absoluteFill,g,i],colors:c,direction:e})}},923413:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DesktopMinTopMargin=void 0;const a=i(785893),n=i(496486),o=i(285788),s=i(516778),r=i(148540),l=i(583367),c=i(889391),d=i(379231),u=i(220187),h=i(994224),p=i(884965),g=i(553376),C=i(136850),S=i(480200),m=i(471727),y=i(905531),f=i(671830),b=i(898278),_=i(824490),T=i(757139),v=i(746096),w=i(913944),I=i(436237),P=(i(134896),i(924907)),M=i(915877),k=i(733754),A=i(143786),R=i(827357),x=i(536150),L=i(581760),V=i(711828),O=i(734528),B=i(680837),D=i(24576),E=i(163841),N=i(912770),F=i(853374);var j;!function(e){e[e.Closed=0]="Closed",e[e.Opening=1]="Opening",e[e.Open=2]="Open"}(j||(j={})),t.DesktopMinTopMargin=S.RibbonSizes.ribbonItemSizeSmall+S.RibbonSizes.ribbonItemModernStageTopMargin;const U=(0,M.lazyProperties)({callPanelHeader:()=>s.Styles.createViewStyle({appRegion:"drag",flexDirection:"row",alignSelf:"stretch",height:S.CallPanelHeaderHeight.mobile,overflow:"visible"}),callPanelHeaderDesktop:()=>s.Styles.createViewStyle({backgroundColor:L.Color.transparent,alignItems:"center",height:S.CallPanelHeaderHeight.window}),callPanelHeaderDesktopMin:()=>s.Styles.createViewStyle({marginTop:t.DesktopMinTopMargin,justifyContent:"center"}),leftControl:()=>s.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",paddingHorizontal:16,paddingTop:17,height:52,backgroundColor:L.Color.transparent}),leftControlDesktop:()=>s.Styles.createViewStyle({paddingTop:0,paddingLeft:16,paddingRight:0}),leftControlDesktopMin:()=>s.Styles.createViewStyle({position:"absolute",left:0,transform:[{translateY:-1*t.DesktopMinTopMargin}]}),recentsButton:()=>s.Styles.createViewStyle({width:V.IconSize.default,height:V.IconSize.default,borderRadius:V.IconSize.default/2,backgroundColor:L.Color.white,paddingLeft:0,marginLeft:16}),rightControls:()=>s.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-end",paddingTop:10}),rightControlsButton:()=>s.Styles.createButtonStyle({alignSelf:"stretch",alignItems:"center",marginRight:16,height:52}),titleContainerInner:()=>s.Styles.createViewStyle({flex:-1,justifyContent:"center",paddingHorizontal:20}),titleContainer:()=>s.Styles.createViewStyle({alignItems:"stretch",justifyContent:"flex-start",backgroundColor:L.Color.transparent,overflow:"visible",marginRight:16}),titleContainerStackNav:()=>s.Styles.createViewStyle({flex:1,height:S.CallPanelHeaderHeight.mobile}),titleContainerTablet:()=>B.default.flexOne,titleContainerDesktopMin:()=>s.Styles.createViewStyle({justifyContent:"center"}),undraggableRegion:()=>s.Styles.createViewStyle({appRegion:"no-drag"}),backButtonSpacer:()=>s.Styles.createViewStyle({width:64})});class H extends D.default{constructor(){super(...arguments),this._handleBackButtonClick=e=>{e.stopPropagation();const t=F.default.newCauseId();I.log(v.LogTraceArea.CallingUI,"CallPanelHeader._handleBackButtonClick, causeId: "+t),this.props.onBackButtonPressed(t)},this._handleRecentsButtonPress=e=>{e.stopPropagation();const t=F.default.newCauseId();I.log(v.LogTraceArea.CallingUI,"CallPanelHeader._handleRecentsButtonPress, causeId: "+t),this.props.onRecentsButtonPressed(t)},this._onTitleLayout=e=>{if(this.props.onTitleLayout){const t={x:e.x,y:e.y,width:e.width+60,height:e.height};this.props.onTitleLayout(t)}},this._onTitlePress=(e,t)=>{I.log(v.LogTraceArea.CallingUI,"CallPanelHeader._onTitlePress, causeId: "+e),this.props.onTitlePress&&this.props.onTitlePress(e,t)},this._onOpenRoster=()=>{const e=F.default.newCauseId();I.log(v.LogTraceArea.CallingUI,"CallPanelHeader._onOpenRoster, causeId: "+e),this.props.onRosterPressed&&this.props.onRosterPressed(e,S.CallRosterOrigin.FromParticipantCount)},this._onDynamicAudioChoice=e=>{this.props.onDynamicAudioChoice&&this.props.onDynamicAudioChoice(e,(()=>this._audioOutputButton))},this._onAudioOutputButtonRef=e=>{this._audioOutputButton=e||void 0},this._onLayoutButtonRef=e=>{this._layoutButton=e||void 0},this._onNewPickerPress=()=>{const e=()=>this._layoutButton,t=this._getRootViewId();l.default.isFullScreenMode(this._getRootViewId()).then((i=>{T.default.showWithContent({menuId:T.default.menuId(),anchor:e,rootViewId:t,menuHeight:P.default.getLayoutPickerHeight(this.state.availableMenuItems),content:(0,a.jsx)(P.default,{anchor:e,rootViewId:t,useMobileControls:this.props.useMobileControls,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,callId:this.props.callId,conversationMri:this.props.conversationId,availableItems:this.state.availableMenuItems,isInFullscreenMode:i,itemColor:this.props.isUsingSkypeTheme?this._themeColors.primaryTextColor:void 0,dividerColor:this.props.isUsingSkypeTheme?this._themeColors.dividerColor:void 0}),useBlurredBackground:!this.props.isUsingSkypeTheme,colorThemeOverride:this.props.isUsingSkypeTheme?void 0:E.Theme.DelphiDark,backgroundColor:this.props.isUsingSkypeTheme?this._themeColors.primaryBackgroundColor:void 0,headerConfig:{headerType:this.props.isUsingSkypeTheme?_.HeaderType.Default:_.HeaderType.Slim},staticContent:!0,useTransparentShim:!this.props.isUsingSkypeTheme,hidePopupArrow:!0,getTitle:()=>{},onCloseMenu:e=>T.default.close(t,e),onMenuClosed:this._onMenuClosed},F.default.newCauseId())}))},this._toggleGridFocusView=()=>{const e=this.state.hasIncomingScreenshare?S.StageMode.FocusedScreenShare:S.StageMode.Speaker,t=m.default.isInGridStageMode(this.state.stageMode)?e:S.StageMode.Grid;this._changeCallLayoutCommand.execute(t)},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach((e=>{e.markAsSeen&&e.markAsSeen()}))}}_buildState(e,t){const i=C.default.getStageMode(e.callId),a=h.default.CallScreenShareStore.hasIncomingScreensharing(e.callId),o={isPSTNCall:h.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:f.isEncryptedThread(e.conversationId),conversationMri:e.conversationId,callId:e.callId};this._changeCallLayoutCommand=new u.ChangeCallLayoutCommand(o,e.incomingOrOutgoingRing,i);const s=h.default.CallingStore.isProvidingVideo(e.callId),l=h.default.OngoingCallService.getStageParticipants(e.callId),p=x.default.isMobileScreenReaderEnabled(),g=c.default.getS4LCMCFeatures().newCallScreenEnabledByDefault,b=e.useMobileControls&&s&&(!(!p&&!g)||n.includes(l,S.CallStageElementKeys.localUserKey));let _=r.CameraPosition.Unknown;if(b){const e=h.default.DeviceStore.getSelectedCamera();_=e?e.position:r.CameraPosition.Unknown}const T=c.default.getS4LCMCFeatures().enableFullScreenOnWeb,v=m.default.getAvailableMenuItems(e.callId,T,e.useMobileControls,e.conversationId),w={showCameraToggle:b,cameraPosition:_,showRecentsButton:!e.isUsingStackNavigationContext&&y.default.navigation().canAccessRecentsList,isDesktopMin:m.default.isDesktopMinCallPanelHeader(this._getRootViewId()),isGalleryShowing:R.default.isGalleryShowing(),outputRoute:h.default.CallControlsStore.getAudioOutput(),useiOSRoutePicker:d.AudioOutputRouteHelper.useiOSRoutePicker(),stageMode:i,hasIncomingScreenshare:a,changeCallLayoutEnabled:e.useMobileControls&&this._changeCallLayoutCommand.canExecute(),moreOutputRoutesAvailable:!1,newLayoutPickerEnabled:c.default.getS4LCMCFeatures().enableNewLayoutPicker,isOneOnOneCall:h.default.CallingStore.isOneOnOneCall(e.callId),availableMenuItems:v};return!t&&e.isRecentsOpen&&this.state?e.isRecentsOpen&&this.state.recentsOpenState===j.Closed&&(w.recentsOpenState=j.Opening,this._clearIsRecentsOpenTimeout(),this._isRecentsOpeUpEdgeTimeout=N.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({recentsOpenState:j.Open}),this._isRecentsOpeUpEdgeTimeout=void 0}),300)):(w.recentsOpenState=e.isRecentsOpen?j.Open:j.Closed,this._clearIsRecentsOpenTimeout()),w}_areMoreAudioOutputsAvailable(e){if(!c.default.getS4LCMCFeatures().earpieceHiddenForVideoCalls)return I.log(v.LogTraceArea.CallingUI,"CallPanelHeader.areMoreAudioRoutesAvailable - ECS disabled.  Showing all audio routes."),!0;const t=h.default.CallControlsStore.getAvailableAudioRoutes();I.log(v.LogTraceArea.CallingUI,`CallPanelHeader.areMoreAudioRoutesAvailable video: ${e} availableRoutes: ${t}`);let i=n.size(t);return e&&n.includes(t,o.default.AudioOutputEarpiece)&&i--,i>1}_clearIsRecentsOpenTimeout(){this._isRecentsOpeUpEdgeTimeout&&(N.default.clearTimeout(this._isRecentsOpeUpEdgeTimeout),this._isRecentsOpeUpEdgeTimeout=void 0)}render(){const e=this.props.isUsingSkypeTheme?this._themeColors.primaryIconColor:L.Color.white,t=this.props.isUsingSkypeTheme?this._themeColors.iconHoverColor:L.Color.gray200,i=this._renderNavigationButton(e,t),n=this._renderTitleView(),o=this._renderFlipCameraButton(e,t),r=this._renderSpeakerButton(e,t),l=this._renderGridFocusToggleButton(e,t),c=[U.titleContainer,U.undraggableRegion];this.props.useMobileControls&&(this.props.isUsingStackNavigationContext?c.push(U.titleContainerStackNav):c.push(U.titleContainerTablet)),this.state.isDesktopMin&&c.push(U.titleContainerDesktopMin);const d=[(0,a.jsx)(s.Animated.View,Object.assign({style:c,ignorePointerEvents:!0},{children:n}),"titleControls"),(0,a.jsxs)(s.View,Object.assign({style:[U.rightControls,U.undraggableRegion]},{children:[l,r,o]}),"rightControls")],u=[U.callPanelHeader];return this.props.isUsingStackNavigationContext||(u.push(U.callPanelHeaderDesktop),this.state.isDesktopMin&&u.push(U.callPanelHeaderDesktopMin)),(0,a.jsxs)(s.View,Object.assign({style:u,ignorePointerEvents:!0},{children:[this.props.hideGradient||!this.props.isNewMobileStage?null:(0,a.jsx)(p.default,{}),i,d]}))}_renderNavigationButton(e,t){let i,n;if(!this.props.hideBackButton){const n=[U.leftControl];if(this.props.isUsingStackNavigationContext||n.push(U.leftControlDesktop),this.state.showRecentsButton){let o,s=e;this._getRootViewType()===b.RootViewType.SplitViewContent?o=k.getString("CallPanel.ShowRecentsButtonTitle"):(o=this.state.recentsOpenState===j.Open?k.getString("CallPanel.CloseRecentsButtonTitle"):k.getString("CallPanel.OpenRecentsButtonTitle"),this.state.recentsOpenState!==j.Closed&&(n.push(U.recentsButton),s=L.Color.gray400)),i=(0,a.jsx)(w.default,{style:n,size:V.IconSize.size24,onPress:this._handleRecentsButtonPress,color:s,hoverColor:t,icon:V.SkypeIcon.Menu,title:o},"recents")}else{const o=this.props.isUsingStackNavigationContext?V.SkypeIcon.Message:O.backIcon(),s=this.props.isUsingStackNavigationContext?k.getString("CallPanel.OpenConversation"):k.getString("Global.BackButtonTitle");i=(0,a.jsx)(w.default,{style:n,size:V.IconSize.size24,onPress:this._handleBackButtonClick,color:e,hoverColor:t,icon:o,title:s},"back")}}if(this.props.isUsingStackNavigationContext||i){const e=[U.undraggableRegion];this.props.isUsingStackNavigationContext?e.push(U.backButtonSpacer):this.state.isDesktopMin&&e.push(U.leftControlDesktopMin),n=(0,a.jsx)(s.View,Object.assign({style:e},{children:i}),"leftControl")}return n}_renderTitleView(){if(this.props.isUsingStackNavigationContext)return(0,a.jsx)(A.default,{callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,isLandscape:this.props.isLandscape,isUsingSkypeTheme:this.props.isUsingSkypeTheme});const e=this.state.isGalleryShowing?k.getString("CallReactionsBar.CloseGallery"):k.getString("CallReactionsBar.OpenGallery");return(0,a.jsx)(g.default,{onLayout:this.props.onTitleLayout?this._onTitleLayout:void 0,callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,onOpenRoster:this._onOpenRoster,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,maxTitleWidth:this.props.maxTitleWidth,containerStyle:U.titleContainerInner,onGalleryPress:this.props.onGalleryPress,isDesktopMin:this.state.isDesktopMin,useLightTheme:!1,renderGalleryIfAllowed:!0,galleryButtonAccessibilityLabel:e})}_renderSpeakerButton(e,t){}_renderFlipCameraButton(e,t){if(this.props.useMobileControls&&this.state.showCameraToggle){let i;return i=this.state.cameraPosition===r.CameraPosition.Front?k.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):k.getString("CallControls.CallButtonSwitchCameraForwardLabel"),(0,a.jsx)(w.default,{style:U.rightControlsButton,size:V.IconSize.size24,onPress:this.props.onToggleCameraDirection,color:e,hoverColor:t,icon:V.SkypeIcon.SwitchCamera,title:k.getString("CapturePanel.SwitchCameraButtonTitle"),accessibilityLabel:i},"camera")}}_renderGridFocusToggleButton(e,t){if(this.state.changeCallLayoutEnabled)return(0,a.jsx)(w.default,{ref:this._onLayoutButtonRef,icon:this._getIcon(),title:this._getTitle(),size:V.IconSize.size24,hoverColor:t,onPress:this.state.newLayoutPickerEnabled?this._onNewPickerPress:this._toggleGridFocusView,accessibilityLabel:this._getTitle(),color:e,style:U.rightControlsButton},"changeLayoutButton")}_getTitle(){if(this.state.newLayoutPickerEnabled)return m.default.getStageModeItemTitle(this.state.stageMode,!1);return m.default.isInGridStageMode(this.state.stageMode)?this.state.hasIncomingScreenshare?k.getString("CallControls.CallButtonSwitchToContentView"):k.getString("CallControls.CallButtonSwitchToSpeakerView"):k.getString("CallControls.CallButtonSwitchToGridView")}_getIcon(){if(this.state.newLayoutPickerEnabled)return m.default.getIconForStageMode(this.state.stageMode,!1);return m.default.isInGridStageMode(this.state.stageMode)?V.SkypeIcon.GridView:V.SkypeIcon.FocusedView3}}t.default=H},655481:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(994224),s=i(816402),r=i(136400),l=i(619675),c=i(24576);class d extends c.default{_buildState(e){return{elapsedTimeSec:o.default.CallDurationStore.getCallDurationInSeconds(e.callId)}}_shouldRender(){return this.props.participantCountText||this.state.elapsedTimeSec||this.props.isTimerActive}render(){if(this._shouldRender()){const e=this.state.elapsedTimeSec||this.props.isTimerActive,t=this.state.elapsedTimeSec||0;let i=e?s.default.getElapsedTimeStringFromS(t):void 0,o=e?s.default.getFormattedDuration(Math.floor(t),!0):void 0;return this.props.participantCountText&&(o=this.props.participantCountText+(o?", "+o:""),i=this.props.participantCountText+(i?" | "+i:"")),(0,a.jsx)(r.HoverableView,Object.assign({accessibilityLabel:o,accessibilityTraits:n.Types.AccessibilityTrait.Text,importantForAccessibility:n.Types.ImportantForAccessibility.Auto,onPress:this.props.onPress},{children:(0,a.jsx)(l.Subtitle,Object.assign({style:this.props.baseSubtitleStyle,accessibilityHidden:!0,numberOfLines:1,v2:this.props.subtitleV2},{children:i}))}))}return null}}t.default=d},553376:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(994224),s=i(4325),r=i(136850),l=i(655481),c=i(647176),d=i(480200),u=i(671830),h=i(952262),p=i(746096),g=i(211375),C=i(946239),S=i(136400),m=i(436237),y=i(915877),f=i(733754),b=i(581760),_=i(311010),T=i(496755),v=i(619675),w=i(24576),I=i(853374),P=i(889391),M=i(853703),k=i(905531),A=b.Color.gray400,R=(0,y.lazyProperties)({headerContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"stretch"}),alignDesktopMin:()=>n.Styles.createViewStyle({justifyContent:"center"}),firstRow:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",marginBottom:0}),conversationNameText:()=>n.Styles.createTextStyle({flex:-1,color:b.Color.white}),conversationNameTextLightTheme:()=>n.Styles.createTextStyle({color:A}),divider:()=>n.Styles.createTextStyle({marginLeft:5}),timerRowContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),timerRowContainerV2:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"flex-start"}),galleryButtonText:()=>n.Styles.createTextInputStyle({marginTop:2}),baseSubtitleStyleV1:()=>n.Styles.createTextStyle({color:b.Color.whiteOverlay50}),baseSubtitleStyleLightTheme:()=>n.Styles.createTextStyle({color:b.Color.blackOverlay60})});class x extends w.default{constructor(){super(...arguments),this.handleFocusEvent=e=>!(e!==g.FocusEvent.CloseRightPanel||!this._galleryButton)&&(this._galleryButton.requestFocus(),!0),this._onTitlePress=()=>{if(this.props.onTitlePress){const e=I.default.newCauseId();m.log(p.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onTitlePress, causeId: "+e),this.props.onTitlePress(e,d.CallRosterOrigin.FromGroupTitle)}},this._onOpenRoster=()=>{if(this.props.onOpenRoster){const e=I.default.newCauseId();m.log(p.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onOpenRoster, causeId: "+e),this.props.onOpenRoster(e,d.CallRosterOrigin.FromParticipantCount)}},this._onGalleryPress=e=>{m.log(p.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onGalleryPress"),this.props.onGalleryPress&&this.props.onGalleryPress()},this._onGalleryButtonRef=e=>{this._galleryButton=e||void 0},this._onManageGroupPress=e=>{const t=I.default.newCauseId();m.log(p.LogTraceArea.CallingUI,"CallPanelHeaderTitle._onManageGroupPress, causeId: "+t),this.props.onTitlePress&&this.props.onTitlePress(t,d.CallRosterOrigin.FromManageGroupButton)},this._getIconColor=e=>this.props.useLightTheme?A:e}_buildState(e,t){const i=P.default.getS4LCMCFeatures().bingBackgrounds,a=o.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(e.callId),n=r.default.getStageMode(e.callId);return{conversationName:h.default.getDisplayName(e.conversationMri)||f.getString("Notifications.UnknownUserShort"),activeParticipantCount:e.showParticipantCount?c.default.getActiveParticipants(e.callId,e.conversationMri).length:0,totalParticipantCount:e.showParticipantCount?c.default.getRosterForConversation(e.conversationMri).length:0,allowCallGallery:e.renderGalleryIfAllowed&&o.default.CallingFeaturesHelper.allowCallGallery({isEncryptedCall:u.isEncryptedThread(e.conversationMri),isPSTNCall:o.default.CallingStore.isPSTNCall(e.callId),conversationMri:e.conversationMri,callId:e.callId}),allowManageGroup:P.default.getS4LCMCFeatures().enableLockMeeting&&!!e.onTitlePress&&u.isGroupConversation(e.conversationMri)&&k.default.navigation().canAccessConversationDetails,stageMode:n,allowBingBackgrounds:!e.v2&&a>0&&(n===d.StageMode.LargeGrid||n!==d.StageMode.TogetherMode&&n!==d.StageMode.FocusedScreenShare&&i.showInCallHeader)}}componentDidMount(){super.componentDidMount(),g.register(g.FocusEvent.CloseRightPanel,this)}componentWillUnMount(){super.componentWillUnmount(),g.unregister(g.FocusEvent.CloseRightPanel,this)}render(){const e=!!this.props.onTitlePress,t=e?S.HoverableButton:n.View,i=[R.firstRow];let o;this.props.isDesktopMin&&i.push(R.alignDesktopMin),e&&(o=u.isOneOnOneConversation(this.props.conversationMri)?this.state.conversationName:f.getString("CallPanel.CallRosterHeaderEntryButtonAccessibilityLabel",{groupName:this.state.conversationName}));const r=[this.props.v2?_.default.fontStyle.callHeaderTitleV2:_.default.fontStyle.messagingHeader,[R.conversationNameText,this.props.useLightTheme?R.conversationNameTextLightTheme:void 0]],c=this.state.allowManageGroup?(0,a.jsx)(M.default,{iconColorOverride:this._getIconColor(b.Color.white),hoverColor:this._getIconColor(b.Color.whiteOverlay80),onPress:this._onManageGroupPress,accessibilityLabel:f.getString("CallPanel.ManageGroupAccessibilityLabel"),isCompact:!!this.props.showCompactManageGroup},`manageGroupButton-${this.props.conversationMri}`):void 0,d=(0,a.jsxs)(n.View,Object.assign({style:i},{children:[(0,a.jsx)(t,Object.assign({onPress:e?this._onTitlePress:void 0,title:o,accessibilityLabel:o,accessibilityTraits:e?n.Types.AccessibilityTrait.Button:n.Types.AccessibilityTrait.Header,tabIndex:e?void 0:-1,disableHoverOpacityStyles:!e,disableCursor:!e},{children:(0,a.jsx)(n.Text,Object.assign({style:r,numberOfLines:1},{children:this.state.conversationName}))})),c]}));let h;this.props.showParticipantCount&&this.state.activeParticipantCount&&this.state.totalParticipantCount&&(h=f.getString("CallPanel.CallRosterTitle",{count:this.state.activeParticipantCount,total:this.state.totalParticipantCount}));const p=[_.default.fontStyle.callHeaderSubtitleV2,this.props.useLightTheme?R.baseSubtitleStyleLightTheme:void 0],g=this.props.v2?p:[_.default.fontStyle.subtitle,R.baseSubtitleStyleV1];let m,y=(0,a.jsx)(l.default,{callId:this.props.callId,isTimerActive:!!this.props.isCallActive&&!!this.props.isSeen,participantCountText:h,baseSubtitleStyle:g,subtitleV2:this.props.v2,onPress:this.props.onOpenRoster?this._onOpenRoster:void 0});if(this.props.outgoingRingStatus&&this.props.outgoingRingStatus.length){const e=[g,this.props.isDesktopMin?R.alignDesktopMin:void 0];m=(0,a.jsx)(v.Subtitle,Object.assign({style:e,numberOfLines:1,v2:this.props.v2},{children:this.props.outgoingRingStatus}))}const w=[this.props.containerStyle];if(this.props.maxTitleWidth&&w.push(n.Styles.createViewStyle({maxWidth:this.props.maxTitleWidth},!1)),this.props.isCallActive){const e=[g,this.props.v2?R.timerRowContainerV2:R.timerRowContainer];this.props.isDesktopMin&&e.push(R.alignDesktopMin);const t=[g,R.divider],i=this.state.allowCallGallery?[(0,a.jsx)(T.default,{style:t},`galleryDivider-${this.props.conversationMri}`),(0,a.jsx)(C.default,{ref:this._onGalleryButtonRef,textStyle:[g,R.galleryButtonText],iconColorOverride:this._getIconColor(b.Color.whiteOverlay50),onPress:this._onGalleryPress,accessibilityLabel:this.props.galleryButtonAccessibilityLabel},`galleryButton-${this.props.conversationMri}`)]:void 0,o=this.state.allowBingBackgrounds?[(0,a.jsx)(T.default,{style:t},`bing-Divider-${this.props.conversationMri}`),(0,a.jsx)(s.default,{callId:this.props.callId,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,textStyleOverride:[g,R.galleryButtonText],v1:!0,useLightTheme:this.props.useLightTheme},`bingBackgroundsButton-${this.props.conversationMri}`)]:void 0;y=(0,a.jsxs)(n.View,Object.assign({style:e},{children:[y,i,o]}))}return(0,a.jsx)(n.View,Object.assign({style:w,ignorePointerEvents:!0,onLayout:this.props.onLayout},{children:(0,a.jsxs)(n.View,Object.assign({style:R.headerContainer,ignorePointerEvents:!0},{children:[d,m,y]}))}))}}t.default=x},557011:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(285788),s=i(516778),r=i(148540),l=i(583367),c=i(889391),d=i(379231),u=i(220187),h=i(994224),p=i(4325),g=i(553376),C=i(136850),S=i(480200),m=i(471727),y=i(905531),f=i(671830),b=i(898278),_=i(824490),T=i(757139),v=i(746096),w=i(913944),I=i(436237),P=(i(134896),i(924907)),M=i(915877),k=i(733754),A=i(536150),R=i(581760),x=i(311010),L=i(711828),V=i(734528),O=i(680837),B=i(24576),D=i(163841),E=i(912770),N=i(296229),F=i(853374),j=i(822854),U=i(567977),H=i(74074),z=i(952262);var G;!function(e){e[e.Closed=0]="Closed",e[e.Opening=1]="Opening",e[e.Open=2]="Open"}(G||(G={}));const W=(0,M.lazyProperties)({callPanelHeaderDesktop:()=>s.Styles.createViewStyle({appRegion:"drag",flexDirection:"row",alignSelf:"stretch",overflow:"visible",backgroundColor:R.Color.transparent,alignItems:"center",height:S.DesktopNewHeaderHeight}),leftControlDesktop:()=>s.Styles.createViewStyle({width:L.IconSize.size28,height:L.IconSize.size28,flexDirection:"row",justifyContent:"center",alignItems:"center",backgroundColor:R.Color.transparent,paddingTop:0,paddingLeft:10,paddingRight:0}),recentsButton:()=>s.Styles.createViewStyle({borderRadius:L.IconSize.size28/2,backgroundColor:R.Color.white,paddingLeft:0,marginLeft:10}),rightControls:()=>s.Styles.createViewStyle({flexGrow:1,flexDirection:"row",justifyContent:"flex-end",marginRight:10}),rightControlsButton:()=>s.Styles.createButtonStyle({alignSelf:"stretch",alignItems:"center",marginRight:16,height:30}),conversationIcon:()=>s.Styles.createViewStyle({marginLeft:6,marginRight:4}),titleContainerInner:()=>s.Styles.createViewStyle({flex:-1,justifyContent:"center",paddingRight:20}),titleContainer:()=>s.Styles.createViewStyle({alignItems:"stretch",justifyContent:"flex-start",backgroundColor:R.Color.transparent,overflow:"visible",marginRight:16}),titleContainerTablet:()=>O.default.flexOne,undraggableRegion:()=>s.Styles.createViewStyle({appRegion:"no-drag"}),backButtonSpacer:()=>s.Styles.createViewStyle({width:64}),bingBackgroundsFontLightTheme:()=>s.Styles.createTextStyle({color:R.Color.gray400,fontSize:x.default.fontSize.size13Deprecated,font:x.default.font.uiDisplayRegular})});class K extends B.default{constructor(){super(...arguments),this._handleBackButtonClick=e=>{e.stopPropagation();const t=F.default.newCauseId();I.log(v.LogTraceArea.CallingUI,"CallPanelHeaderV2._handleBackButtonClick, causeId: "+t),this.props.onBackButtonPressed(t)},this._handleRecentsButtonPress=e=>{e.stopPropagation();const t=F.default.newCauseId();I.log(v.LogTraceArea.CallingUI,"CallPanelHeaderV2._handleRecentsButtonPress, causeId: "+t),this.props.onRecentsButtonPressed(t)},this._onTitleLayout=e=>{if(this.props.onTitleLayout){const t={x:e.x,y:e.y,width:e.width+60,height:e.height};this.props.onTitleLayout(t)}},this._onTitlePress=()=>{const e=F.default.newCauseId();I.log(v.LogTraceArea.CallingUI,"CallPanelHeaderV2._onTitlePress, causeId: "+e),this.props.onTitlePress&&this.props.onTitlePress(e,S.CallRosterOrigin.FromGroupTitle)},this._onOpenRosterFromConversationIcon=()=>{const e=F.default.newCauseId();this._onOpenRoster(e,S.CallRosterOrigin.FromConversationIcon)},this._onOpenRoster=(e,t)=>{I.log(v.LogTraceArea.CallingUI,"CallPanelHeaderV2._onOpenRoster, causeId: "+e),this.props.onRosterPressed&&this.props.onRosterPressed(e,t)},this._onDynamicAudioChoice=e=>{this.props.onDynamicAudioChoice&&this.props.onDynamicAudioChoice(e,(()=>this._audioOutputButton))},this._onAudioOutputButtonRef=e=>{this._audioOutputButton=e||void 0},this._onLayoutButtonRef=e=>{this._layoutButton=e||void 0},this._onNewPickerPress=()=>{const e=()=>this._layoutButton,t=this._getRootViewId();l.default.isFullScreenMode(this._getRootViewId()).then((i=>{T.default.showWithContent({menuId:T.default.menuId(),anchor:e,rootViewId:t,menuHeight:P.default.getLayoutPickerHeight(this.state.availableMenuItems),content:(0,a.jsx)(P.default,{anchor:e,rootViewId:t,useMobileControls:this.props.useMobileControls,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,callId:this.props.callId,conversationMri:this.props.conversationId,availableItems:this.state.availableMenuItems,isInFullscreenMode:i}),useBlurredBackground:!0,colorThemeOverride:D.Theme.DelphiDark,headerConfig:{headerType:_.HeaderType.Slim},staticContent:!0,useTransparentShim:!0,hidePopupArrow:!0,getTitle:()=>{},onCloseMenu:e=>T.default.close(t,e),onMenuClosed:this._onMenuClosed},F.default.newCauseId())}))},this._toggleGridFocusView=()=>{const e=this.state.hasIncomingScreenshare?S.StageMode.FocusedScreenShare:S.StageMode.Speaker,t=m.default.isInGridStageMode(this.state.stageMode)?e:S.StageMode.Grid;this._changeCallLayoutCommand.execute(t)},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach((e=>{e.markAsSeen&&e.markAsSeen()}))}}_buildState(e,t){const i=C.default.getStageMode(e.callId),a=h.default.CallScreenShareStore.hasIncomingScreensharing(e.callId),o={isPSTNCall:h.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:f.isEncryptedThread(e.conversationId),conversationMri:e.conversationId,callId:e.callId};this._changeCallLayoutCommand=new u.ChangeCallLayoutCommand(o,e.incomingOrOutgoingRing,i);const s=h.default.CallingStore.isProvidingVideo(e.callId),l=h.default.OngoingCallService.getStageParticipants(e.callId),p=A.default.isMobileScreenReaderEnabled(),g=c.default.getS4LCMCFeatures().newCallScreenEnabledByDefault,b=e.useMobileControls&&s&&(!(!p&&!g)||n.includes(l,S.CallStageElementKeys.localUserKey));let _=r.CameraPosition.Unknown;if(b){const e=h.default.DeviceStore.getSelectedCamera();_=e?e.position:r.CameraPosition.Unknown}const T=c.default.getS4LCMCFeatures().enableFullScreenOnWeb,v=m.default.getAvailableMenuItemsV2(e.callId,T,e.useMobileControls,e.conversationId),w={showCameraToggle:b,cameraPosition:_,showRecentsButton:y.default.navigation().canAccessRecentsList,outputRoute:h.default.CallControlsStore.getAudioOutput(),useiOSRoutePicker:d.AudioOutputRouteHelper.useiOSRoutePicker(),stageMode:i,hasIncomingScreenshare:a,changeCallLayoutEnabled:e.useMobileControls&&this._changeCallLayoutCommand.canExecute(),moreOutputRoutesAvailable:!1,newLayoutPickerEnabled:c.default.getS4LCMCFeatures().enableNewLayoutPicker,isOneOnOneCall:h.default.CallingStore.isOneOnOneCall(e.callId),availableMenuItems:v,isOneOnOneConversation:f.isOneOnOneConversation(e.conversationId),conversationName:z.default.getDisplayName(e.conversationId)||k.getString("Notifications.UnknownUserShort")};!t&&e.isRecentsOpen&&this.state?e.isRecentsOpen&&this.state.recentsOpenState===G.Closed&&(w.recentsOpenState=G.Opening,this._clearIsRecentsOpenTimeout(),this._isRecentsOpeUpEdgeTimeout=E.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({recentsOpenState:G.Open}),this._isRecentsOpeUpEdgeTimeout=void 0}),300)):(w.recentsOpenState=e.isRecentsOpen?G.Open:G.Closed,this._clearIsRecentsOpenTimeout());const I=c.default.getS4LCMCFeatures().bingBackgrounds,P=h.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(e.callId);return w.shouldShowBingBackgrounds=P>0&&(i===S.StageMode.LargeGrid||i!==S.StageMode.TogetherMode&&i!==S.StageMode.FocusedScreenShare&&I.showInCallHeader),w}_areMoreAudioOutputsAvailable(e){if(!c.default.getS4LCMCFeatures().earpieceHiddenForVideoCalls)return I.log(v.LogTraceArea.CallingUI,"CallPanelHeaderV2.areMoreAudioRoutesAvailable - ECS disabled.  Showing all audio routes."),!0;const t=h.default.CallControlsStore.getAvailableAudioRoutes();I.log(v.LogTraceArea.CallingUI,`CallPanelHeaderV2.areMoreAudioRoutesAvailable video: ${e} availableRoutes: ${t}`);let i=n.size(t);return e&&n.includes(t,o.default.AudioOutputEarpiece)&&i--,i>1}_clearIsRecentsOpenTimeout(){this._isRecentsOpeUpEdgeTimeout&&(E.default.clearTimeout(this._isRecentsOpeUpEdgeTimeout),this._isRecentsOpeUpEdgeTimeout=void 0)}render(){const e=this.props.useLightTheme,t=e?this._themeColors.headerIconColor:R.Color.white,i=e?this._themeColors.iconHoverColor:R.Color.gray200,n=this._renderNavigationButton(t,e),o=this._renderConversationIcon(),r=this._renderTitleView(),l=this._renderLayoutButton(),c=this._renderTogetherModeBackgroundChangeButton(t),d=this._renderFlipCameraButton(t,i),u=this._renderSpeakerButton(t,i),h=this._renderGridFocusToggleButton(t,i),p=this._renderBingBackgroundsButton(),g=[W.titleContainer,W.undraggableRegion];this.props.useMobileControls&&g.push(W.titleContainerTablet);const C=[o,(0,a.jsx)(s.Animated.View,Object.assign({style:g,ignorePointerEvents:!0},{children:r}),"titleControls"),(0,a.jsxs)(s.View,Object.assign({style:[W.rightControls,W.undraggableRegion]},{children:[p,h,u,d,c,l]}),"rightControls")];return(0,a.jsxs)(s.View,Object.assign({style:W.callPanelHeaderDesktop,ignorePointerEvents:!0},{children:[n,C]}))}_renderNavigationButton(e,t){if(this.props.hideBackButton)return null;let i;const n=this._getRootViewType()===b.RootViewType.SplitViewContent,o=this.state.recentsOpenState===G.Closed,r=t?this._themeColors.iconHoverColor:n||o?R.Color.gray200:R.Color.gray300,l=[W.leftControlDesktop];if(this.state.showRecentsButton){let n,o=e,s=r;this._getRootViewType()===b.RootViewType.SplitViewContent?n=k.getString("CallPanel.ShowRecentsButtonTitle"):(n=this.state.recentsOpenState===G.Open?k.getString("CallPanel.CloseRecentsButtonTitle"):k.getString("CallPanel.OpenRecentsButtonTitle"),this.state.recentsOpenState!==G.Closed&&(l.push(W.recentsButton),t?(l.push(this._themeStyles.primaryViewColorStyle),o=this._themeColors.primaryBackgroundColor,s=o):o=R.Color.gray400)),i=(0,a.jsx)(w.default,{style:l,size:L.IconSize.size15,onPress:this._handleRecentsButtonPress,color:o,hoverColor:s,icon:L.SkypeIcon.Menu,title:n},"recents")}else i=(0,a.jsx)(w.default,{style:l,size:L.IconSize.size15,onPress:this._handleBackButtonClick,color:e,hoverColor:r,icon:V.backIcon(),title:k.getString("Global.BackButtonTitle")},"back");const c=[W.undraggableRegion];return(0,a.jsx)(s.View,Object.assign({style:c},{children:i}),"leftControl")}_renderConversationIcon(){const e=this.state.isOneOnOneConversation?this.state.conversationName:k.getString("CallPanel.CallRosterHeaderEntryButtonAccessibilityLabel",{groupName:this.state.conversationName});return(0,a.jsx)(s.View,Object.assign({style:W.conversationIcon},{children:(0,a.jsx)(j.default,{conversationId:this.props.conversationId,size:U.ConversationIconSize.Size28,onPress:this._onOpenRosterFromConversationIcon,accessibilityLabel:e})}))}_renderTitleView(){return(0,a.jsx)(g.default,{onLayout:this.props.onTitleLayout?this._onTitleLayout:void 0,callId:this.props.callId,conversationMri:this.props.conversationId,isCallActive:this.props.isCallActive,outgoingRingStatus:this.props.outgoingRingStatus,onTitlePress:this.props.onTitlePress?this._onTitlePress:void 0,onOpenRoster:this._onOpenRoster,isSeen:!this.props.minimized,showParticipantCount:this.props.showParticipantCount,maxTitleWidth:this.props.maxTitleWidth,containerStyle:W.titleContainerInner,v2:!0,useLightTheme:this.props.useLightTheme,renderGalleryIfAllowed:!1,showCompactManageGroup:!0})}_renderLayoutButton(){return(0,a.jsx)(H.default,{availableLayoutModes:m.default.getAvailableHeaderModes(this.props.useMobileControls,this.state.isOneOnOneConversation),callId:this.props.callId,conversationMri:this.props.conversationId,useLightTheme:this.props.useLightTheme,isIncomingOrOutGoingRing:this.props.incomingOrOutgoingRing,useMobileCallControls:this.props.useMobileControls,height:S.DesktopNewHeaderHeight})}_renderTogetherModeBackgroundChangeButton(e){return(0,a.jsx)(N.default,{callId:this.props.callId,conversationMri:this.props.conversationId,labelColor:e})}_renderSpeakerButton(e,t){return null}_renderFlipCameraButton(e,t){if(!this.props.useMobileControls||!this.state.showCameraToggle)return null;const i=this.state.cameraPosition===r.CameraPosition.Front?k.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):k.getString("CallControls.CallButtonSwitchCameraForwardLabel");return(0,a.jsx)(w.default,{style:W.rightControlsButton,size:L.IconSize.size24,onPress:this.props.onToggleCameraDirection,color:e,hoverColor:t,icon:L.SkypeIcon.SwitchCamera,title:k.getString("CapturePanel.SwitchCameraButtonTitle"),accessibilityLabel:i},"camera")}_renderGridFocusToggleButton(e,t){return this.state.changeCallLayoutEnabled?(0,a.jsx)(w.default,{ref:this._onLayoutButtonRef,icon:this._getIcon(),title:this._getTitle(),size:L.IconSize.size24,hoverColor:t,onPress:this.state.newLayoutPickerEnabled?this._onNewPickerPress:this._toggleGridFocusView,accessibilityLabel:this._getTitle(),color:e,style:W.rightControlsButton},"changeLayoutButton"):null}_getTitle(){if(this.state.newLayoutPickerEnabled)return m.default.getStageModeItemTitle(this.state.stageMode,!0);return m.default.isInGridStageMode(this.state.stageMode)?this.state.hasIncomingScreenshare?k.getString("CallControls.CallButtonSwitchToContentView"):k.getString("CallControls.CallButtonSwitchToSpeakerView"):k.getString("CallControls.CallButtonSwitchToGridView")}_getIcon(){if(this.state.newLayoutPickerEnabled)return m.default.getIconForStageMode(this.state.stageMode,!0);return m.default.isInGridStageMode(this.state.stageMode)?L.SkypeIcon.GridView:L.SkypeIcon.FocusedView3}_renderBingBackgroundsButton(){return this.state.shouldShowBingBackgrounds?(0,a.jsx)(p.default,{callId:this.props.callId,height:S.DesktopNewHeaderHeight,textStyleOverride:this.props.useLightTheme?W.bingBackgroundsFontLightTheme:void 0,onBingBackgroundsPressed:this.props.onBingBackgroundsPressed,useLightTheme:this.props.useLightTheme}):null}}t.default=K},994463:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(705465),s=i(701025),r=i(496486),l=i(285788),c=i(77354),d=i(583367),u=i(216934),h=i(823113),p=i(665768),g=i(516778),C=i(398861),S=i(148540),m=i(269521),y=i(967593),f=i(219784),b=i(715602),_=i(300060),T=i(889391),v=i(332143),w=i(841789),I=i(996074),P=i(220187),M=i(3287),k=i(775492),A=i(379857),R=(i(178816),i(163979)),x=i(934256),L=i(994224),V=i(568580),O=i(598925),B=i(32057),D=i(923413),E=i(899734),N=i(278968),F=i(647176),j=i(372667),U=i(136850),H=i(647112),z=i(657033),G=i(109520),W=i(502278),K=(i(500091),i(518154)),$=i(785107),q=i(440584),Q=i(843355),X=i(480200),Z=i(471727),J=i(346565),Y=i(47447),ee=i(632827),te=i(314920),ie=i(614980),ae=i(671830),ne=i(496418),oe=i(911009),se=i(803056),re=i(898278),le=i(953143),ce=i(539549),de=i(824490),ue=i(757139),he=i(168934),pe=i(437490),ge=i(952262),Ce=i(762490),Se=i(746096),me=i(211375),ye=i(110117),fe=i(805581),be=i(420279),_e=i(658722),Te=i(283706),ve=i(503989),we=i(436237),Ie=i(710400),Pe=i(648638),Me=i(172490),ke=i(915877),Ae=i(733754),Re=i(268080),xe=i(844285),Le=i(257538),Ve=i(10909),Oe=i(652251),Be=i(167354),De=i(499201),Ee=i(844972),Ne=i(178735),Fe=i(46929),je=i(104735),Ue=i(217093),He=i(330124),ze=i(827357),Ge=i(833348),We=i(581736),Ke=i(157876),$e=i(502557),qe=i(29130),Qe=i(914976),Xe=i(451070),Ze=i(681115),Je=i(536150),Ye=i(886045),et=i(126978),tt=i(262232),it=i(309399),at=i(428493),nt=i(333778),ot=i(690089),st=i(376835),rt=i(254594),lt=i(424431),ct=i(191018),dt=i(884449),ut=i(297016),ht=i(699948),pt=i(404057),gt=i(581760),Ct=i(640363),St=i(711828),mt=i(478262),yt=i(680837),ft=i(794050),bt=i(790970),_t=i(163841),Tt=i(912770),vt=i(853374),wt=i(557011),It=i(499342),Pt=i(156018),Mt=i(18078),kt=i(905531),At=i(250646),Rt=i(438891),xt=i(115340),Lt=i(342046),Vt=i(389088),Ot=i(884965),Bt=i(340395),Dt=i(246065),Et=i(518967),Nt=i(125705),Ft=i(106068),jt=i(660289),Ut=i(95292),Ht=i(134296),zt=390,Gt="callToast",Wt=(0,ke.lazyProperties)({callPanel:()=>g.Styles.createViewStyle({flex:1,alignItems:"center",alignSelf:"stretch",backgroundColor:gt.Color.gray400}),callPanelCallStageV2:()=>g.Styles.createViewStyle({backgroundColor:gt.Color.callStageDark}),callPanelLightTheme:()=>g.Styles.createViewStyle({backgroundColor:gt.Color.gray200Overlay20}),headerContainer:()=>g.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:120,overflow:"visible"}),headerContainerV2:()=>g.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:X.DesktopNewHeaderHeight,overflow:"visible"}),buttonsContainer:()=>g.Styles.createViewStyle({position:"absolute",bottom:0,left:0,right:0,overflow:"visible"}),mobileButtonsContainer:()=>g.Styles.createViewStyle({paddingBottom:20}),buttonsWithNotificationContainer:()=>g.Styles.createViewStyle({bottom:X.AudioNotificationOffset}),modernStageButtonsContainer:()=>g.Styles.createViewStyle({height:X.DesktopCallControlsHeight,backgroundColor:gt.Color.callStageDark,justifyContent:"flex-end"}),lightThemeButtonsContainer:()=>g.Styles.createViewStyle({backgroundColor:gt.Color.transparent}),callingAnimationContainer:()=>g.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),fullScreenView:()=>g.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:gt.Color.transparent,overflow:"visible"}),innerViewBase:()=>g.Styles.createViewStyle({position:"absolute",top:0,left:0,backgroundColor:gt.Color.transparent,overflow:"visible"}),mobileInnerViewBase:()=>g.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:gt.Color.transparent,overflow:"visible"}),reactionsBar:()=>g.Styles.createViewStyle({overflow:"visible",position:"absolute",left:0,right:0,bottom:0,backgroundColor:gt.Color.transparent,height:360,alignItems:"stretch"}),reactionsBarCompositeInner:()=>g.Styles.createViewStyle({overflow:"visible",minHeight:360,backgroundColor:gt.Color.transparent}),dialpadContainer:()=>g.Styles.createViewStyle({position:"absolute",right:0,bottom:0,left:0,top:0,alignItems:"center",justifyContent:"center",backgroundColor:gt.Color.transparent}),dialpadInnerContainer:()=>g.Styles.createViewStyle({position:"absolute",bottom:0,alignItems:"stretch",justifyContent:"center",backgroundColor:gt.Color.gray400}),dialpadShim:()=>g.Styles.createViewStyle({backgroundColor:gt.Color.blackOverlay50}),topBanner:()=>g.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,height:150}),skypeLogo:()=>g.Styles.createViewStyle({position:"absolute",left:20,bottom:20,opacity:.2}),skypeLogoWithAudioBar:()=>g.Styles.createViewStyle({bottom:X.AudioNotificationOffset+X.DesktopCallControlsHeight-10}),skypeLogoV2:()=>g.Styles.createViewStyle({bottom:X.AudioNotificationOffset+X.DesktopCallControlsHeight+10}),hiddenControls:()=>g.Styles.createViewStyle({opacity:0}),callControlsContainerNewStage:()=>g.Styles.createViewStyle({paddingHorizontal:8})}),Kt=o.StyleSheet.create({safeAreaContainer:{position:"absolute",top:0,bottom:0,left:0,right:0},safeAreaContentWrapper:{height:"100%",width:"100%",overflow:"visible"}});class $t extends I.BaseNavigationView{constructor(e){super(e),this._orientationLockKey=r.uniqueId("CallPanel:"),this._hasConnected=!1,this._coachMarkContext={coachMarkArea:oe.CoachMarkAreaType.CallPanel},this._callReactionsDisplayHelper=new jt.default,this._reactionsBarHeight=90,this._subscriptions=[],this._endCallNavigationRequested=!1,this._shouldDelayCameraToggle=!0,this._callSnapshotSound=tt.default.SkypeCameraCapture,this._callHeaderAnimatedOpacityValue=new g.Animated.Value(1),this._callHeaderAnimatedTranslateYValue=new g.Animated.Value(0),this._callHeaderAnimatedStyle=g.Styles.createAnimatedViewStyle({opacity:this._callHeaderAnimatedOpacityValue,transform:[{translateY:this._callHeaderAnimatedTranslateYValue}]}),this._callControlsAnimatedTranslateYValue=new g.Animated.Value(-10),this._callControlsAnimatedTranslateYStyle=g.Styles.createAnimatedViewStyle({transform:[{translateY:this._callControlsAnimatedTranslateYValue}]}),this._callControlsAnimatedOpacityValue=new g.Animated.Value(1),this._callControlsOpacityAnimatedStyle=g.Styles.createAnimatedViewStyle({opacity:this._callControlsAnimatedOpacityValue}),this._callStageOverlayOpacityValue=new g.Animated.Value(1),this._callStageOverlayOpacityStyle=g.Styles.createAnimatedViewStyle({opacity:this._callStageOverlayOpacityValue}),this._callParticipantTooltipOpacityValue=new g.Animated.Value(1),this._callParticipantNameTooltipStyle=g.Styles.createAnimatedViewStyle({opacity:this._callParticipantTooltipOpacityValue}),this._callParticipantAccessoryOpacityValue=new g.Animated.Value(1),this._callParticipantAccessoryOpacityStyle=g.Styles.createAnimatedViewStyle({opacity:this._callParticipantAccessoryOpacityValue}),this._newCompositeReactionsAnimatedOpacityValue=new g.Animated.Value(1),this._newCompositeReactionsAnimatedOpacityStyle=g.Styles.createAnimatedViewStyle({opacity:this._newCompositeReactionsAnimatedOpacityValue}),this._reactionsPanelAnimatedBottomValue=new g.Animated.Value(90),this._reactionsPanelAnimatedBottomStyle=g.Styles.createAnimatedViewStyle({bottom:this._reactionsPanelAnimatedBottomValue}),this._dialpadAnimatedOpacityValue=new g.Animated.Value(0),this._dialpadAnimatedOpacityStyle=g.Styles.createAnimatedViewStyle({opacity:this._dialpadAnimatedOpacityValue}),this._dialpadAnimatedTransformValue=new g.Animated.Value(zt),this._dialpadAnimatedTransformStyle=g.Styles.createAnimatedViewStyle({transform:[{translateY:this._dialpadAnimatedTransformValue}]}),this._topBannerAnimatedOpacityValue=new g.Animated.Value(0),this._leftNoneStateOnce=!1,this._isInteractingWithCallControls=!1,this._hasShownNoMicrophoneConnectedToast=!1,this._hasShownNoSpeakerConnectedToast=!1,this._deviceErrorToasts={},this._hasShownCameraDeniedToast=!1,this._hasShownTeamsInteropBanner=!1,this._hasShownTogetherModeNoticeBannerForCallId=!1,this._hasShownMusicModeNoticeBannerForCallId=!1,this._KEY_METHOD_MAP={ZStack:null,Column:null,LayoutAnimationContainer:null,AloneInTheCallInformation:this._renderOptionalAloneInTheCallInformationView,AudioNotifications:this._renderAudioNotification,CallControls:this._renderCallControls,CallingAnimation:this._renderCallingAnimation,CallPanelHeader:this._renderCallPanelHeader,CallPanelHeaderFlex:this._renderCallPanelHeaderFlex,CallStage:this._renderCallStage,Dialpad:this._renderDialpad,InCallPstnTranslatorButton:this._renderFooterPstnTranslatorButton,FlexCallControls:this._intRenderCallControls,LocalParticipantView:this._renderLocalParticipantView,MobileTopBanner:this._renderMobileTopBanner,OptionalNetworkInCallWarning:this._renderOptionalNetworkInCallWarning,ReactionsPanel:this._renderReactionsPanel,TranscriptionView:this._renderTranscriptionViewMobileCallPanel,TranscriptionNotifications:this._renderTranscriptionNotificationsMobileCallPanel,TransientView:this._renderTransientView,Tray:this._renderTray},this._getCallReactionsDisplayHelper=()=>this._callReactionsDisplayHelper,this._onKeyUp=e=>{const t=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onKeyUp causeId:"+t),this._showOrHideControls(!0,t),!1},this._onEscape=()=>this._toggleFullScreenMode(!1),this._toggleFullScreenMode=e=>!!this.state.showFullScreenOptionInRibbonSettings&&(d.default.isFullScreenMode(this._getRootViewId()).then((t=>{const i=void 0!==e?e:!t;i!==t?i?d.default.tryEnterFullScreenMode(this._getRootViewId()).then((e=>{e?(we.track(new G.RibbonSettingsMenuActionEvent(G.RibbonSettingsMenuActions.EnterFullScreen)),W.default.trackCallViewMenuActions(G.CallViewMenuActions.EnterFullScreen)):we.error(Se.LogTraceArea.CallingUI,"_toggleFullScreenMode Failed to enter full screen mode")})):d.default.exitFullScreenMode(this._getRootViewId()).catch((e=>{we.error(Se.LogTraceArea.CallingUI,"_toggleFullScreenMode Failed to exit full screen mode")})):we.log(Se.LogTraceArea.CallingUI,"_toggleFullScreenMode to "+i+" abort, fullScreenMode is already",t)})),!0),this._closeCameraDeniedToast=()=>{this._hasShownCameraDeniedToast=!0,this.setState({hideCameraDeniedToast:!0})},this._onPstnTranslationNoticeDismiss=()=>{this.setState({pstnTranslationBannerBeenDismissed:!0})},this._onPstnParticipantRingNoticeDismiss=()=>{this.setState({pstnParticipantRingBeenDismissed:!0})},this._closeTeamsInteropToast=()=>{this._hasShownTeamsInteropBanner=!0,this.setState({hideTeamsInteropToast:!0})},this._closeVideoRestrictedToast=()=>{this.setState({hideVideoRestrictedToast:!0})},this._closeTogetherModeNoticeToast=()=>{this._hasShownTogetherModeNoticeBannerForCallId=!0,this.setState({hideTogetherModeNoticeToastForCallId:this.props.route.params.callId}),Ne.default.setTogetherModeNoticePresentedForCallId(this.props.route.params.callId)},this._closeMusicModeNoticeToast=()=>{this._hasShownMusicModeNoticeBannerForCallId=!0,this.setState({hideMusicModeNoticeToastForCallId:this.props.route.params.callId}),Ne.default.setMusicModeNoticePresentedForCallId(this.props.route.params.callId)},this._updateServerMutedState=e=>{if(e.callId===this.props.route.params.callId){if(this.isComponentMounted()&&e.serverMuted)if(we.log(Se.LogTraceArea.CallingUI,"_updateServerMutedState: Received serverMuted event for call ID "+e.callId+" causeId: "+e.causeId),$t._useMobileControls(this.state.controlsType))this.setState({showServerMutedToastOnMobile:!0}),Tt.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({showServerMutedToastOnMobile:!1,serverMuteNotificationBannerHeight:0})}),Z.ServerMutedToastTimeout);else{const t=X.DeviceStatusToastType.MicrophoneServerMuted;this._showDeviceErrorToast(t,e.causeId)}}else we.warn(Se.LogTraceArea.CallingUI,"_updateServerMutedState: Received event for unexpected call ID "+e.callId+" causeId: "+e.causeId)},this._updateDeviceQualityState=e=>{if(e.callId===this.props.route.params.callId){if(we.log(Se.LogTraceArea.CallingUI,"_updateDeviceQualityState device: "+e.eventType+" state: "+O.CallDeviceState[e.deviceState]+" causeId: "+e.causeId),this.isComponentMounted()){if(e.eventType===O.CallDeviceQualityEventType.AudioDeviceMuted&&e.deviceState===O.CallDeviceState.NotWorking)return void this._showMicrophoneMutedPill();const t=Z.default.getErrorToastType(e.eventType),i=[];switch(t){case X.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS:case X.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS:i.push({labelKey:"NotificationsPrompt.ButtonLabel",callback:()=>{L.default.DeviceStore.setMusicMode(!0),this._hideDeviceErrorToastOfType(X.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS),this._hideDeviceErrorToastOfType(X.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS)}})}t&&(e.deviceState===O.CallDeviceState.NotWorking?this._showDeviceErrorToast(t,e.causeId,void 0,i):e.deviceState===O.CallDeviceState.Working&&(V.default.isEventTypeTriggeringMuteAction(e.eventType)||this._hideDeviceErrorToastOfType(t)))}}else we.warn(Se.LogTraceArea.CallingUI,"_updateDeviceQualityState: Received event for unexpected call ID "+e.callId+" causeId: "+e.causeId)},this._showMicrophoneMutedPill=()=>{(L.default.CallingStore.isMutedNoSubscription(this.props.route.params.callId)||L.default.CallingStore.isServerMuted(this.props.route.params.callId))&&(this.setState({isMicrophoneMutedWhileSpeaking:!0}),r.isUndefined(this._microphoneMutedTimeout)||Tt.default.clearTimeout(this._microphoneMutedTimeout),this._microphoneMutedTimeout=Tt.default.setTimeout((()=>{this._microphoneMutedTimeout=void 0,this.isComponentMounted()&&this.setState({isMicrophoneMutedWhileSpeaking:!1})}),5e3))},this._updateDeviceNearEndQuality=(e,t,i)=>{e===this.props.route.params.callId?(t===S.QualityLevel.Bad&&L.default.CallingStore.isSharingSound(e)?this._showDeviceErrorToast(X.DeviceStatusToastType.SoundSharingStopped,i):t===S.QualityLevel.Good&&this._hideDeviceErrorToastOfType(X.DeviceStatusToastType.SoundSharingStopped),we.log(Se.LogTraceArea.CallingUI,"_updateDeviceNearEndQuality level: "+t+" causeId: "+i)):we.warn(Se.LogTraceArea.CallingUI,"_updateDeviceNearEndQualityState: Received event for unexpected call ID "+e+" causeId: "+i)},this._selectedDevicesChanged=(e,t,i)=>{this._devicesChanged(e,t,!0,i)},this._availableDevicesChanged=(e,t)=>{this._devicesChanged(e,!1,!1,t)},this._onVideoEffectsQualityChangedEvent=(e,t,i)=>{this._showDeviceErrorToast(X.DeviceStatusToastType.VideoEffectsQualityChange,i,{deviceName:e})},this._devicesChanged=(e,t,i,a)=>{t||(this._showDeviceChangeToast(e,i,a),we.log(Se.LogTraceArea.CallingUI,"_devicesChanged selected "+i+":"+Qe.trustMeThisJsonIsSafe(e)+" causeId: "+a))},this._navigateToChatNotBack=e=>{we.log(Se.LogTraceArea.CallingUI,"_navigateToChatNotBack, causeId: "+e),this._navigateToChat(!1,!0,e)},this._toggleChatPanel=e=>{we.log(Se.LogTraceArea.CallingUI,"_toggleChatPanel causeId: "+e);const t=()=>{je.default.closeConversationInCall(e,this._getContext())};!this.state.isChatOpen?(()=>{W.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.chatOpened())),this._onNavigatedAwayFromCall(e),je.default.openConversationInCall(e,this.state.conversationMri,this.props.route.params.callId,this._getContext(),this._toggleChatPanel),this.state.isGalleryPanelOpen?Ye.default.maybeAnnounceForAccessibility(Ae.getString("AccessibilityLabel.GalleryClosed")):L.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)&&Ye.default.maybeAnnounceForAccessibility(Ae.getString("AccessibilityLabel.SubtitlesClosed"))})():this._closeRightPanel(t,e)},this._currentLeftPanelWidth=()=>this.state.isLeftPanelOpen?et.default.getWidthNoSubscription():0,this._toggleGalleryPanel=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_toggleGalleryPanel causeId: "+e),this._intToggleGalleryPanel(e)},this._intToggleGalleryPanel=e=>{we.log(Se.LogTraceArea.CallingUI,"_intToggleGalleryPanel causeId: "+e),this.state.isGalleryPanelOpen?(this._closeRightPanel((()=>je.default.closeGalleryPanel(e,this._getContext())),e),Ye.default.maybeAnnounceForAccessibility(Ae.getString("AccessibilityLabel.GalleryClosed"))):(this.state.isChatOpen?Ye.default.maybeAnnounceForAccessibility(Ae.getString("AccessibilityLabel.ChatClosed")):L.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)&&Ye.default.maybeAnnounceForAccessibility(Ae.getString("AccessibilityLabel.SubtitlesClosed")),W.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.galleryOpened())),this._onNavigatedAwayFromCall(e),this._showOrHideControls(!1,e),je.default.navigateToGallery(this.state.conversationMri,Ue.GalleryViewMode.All,this._getContext(),this.props.route.params.callId,this.state.conversationMri,this._intToggleGalleryPanel),Ye.default.maybeAnnounceForAccessibility(Ae.getString("AccessibilityLabel.GalleryOpened")))},this._showReactionsDrawerOnHover=()=>{this._reactionsBar&&this._reactionsBar.toggleReactionsPickerHovered()},this._showOrHideReactionsDrawer=e=>{e=r.isUndefined(e)?this._reactionsBar&&!this._reactionsBar.isDrawerOpen():e;const t=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_showOrHideReactionsDrawer show: "+e+" causeId: "+t),e?this._reactionsBar&&this._reactionsBar.openReactionsDrawer(t):this._reactionsBar&&this._reactionsBar.close(),this._callControls&&this._callControls.toggleReactionsPickerButton(!!e,!0)},this._onAppStateChange=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onAppStateChange, causeId: "+e),this._updateAudioState(e);const t=g.App.getActivationState();t===g.Types.AppActivationState.Background?W.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.backgroundAppInCall())):t===g.Types.AppActivationState.Active&&this._showOrHideControls(!0,e)},this._callParticipantActionsMenuOpened=()=>{if(this.isComponentMounted()){const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"[CallPanel]_callParticipantActionsMenuOpened causeId: "+e),this.setState({isCallParticipantActionsMenuOpened:!0}),this._clearHideControlsTimer()}},this._callParticipantActionsMenuClosed=()=>{if(this.isComponentMounted()){const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"[CallPanel]_callParticipantActionsMenuClosed causeId: "+e),this.setState({isCallParticipantActionsMenuOpened:!1}),this._startHideControlsTimer(!0,this._callControlShortTimeoutMs,e)}},this._onVideoPreviewFloating=(e,t)=>{this.isComponentMounted()&&this.setState({shouldRenderFloatingVideoPreview:e,floatingVideoPreviewView:t})},this._onInCallWarningViewRef=e=>{this._inCallWarningView=e||void 0},this._onAudioNotificationViewRef=e=>{this._audioNotificationView=e||void 0},this._onShowHideDisableOutgoingVideoToast=(e,t)=>{e?(we.log(Se.LogTraceArea.CallingUI,`CallPanel._onShowHideDisableOutgoingVideoToast: show causeId ${t}`),this._showDeviceErrorToast(X.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing,t)):(we.log(Se.LogTraceArea.CallingUI,`CallPanel._onShowHideDisableOutgoingVideoToast: hide causeId ${t}`),this._hideDeviceErrorToastOfType(X.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing))},this._renderSkypeLogo=()=>{const e=[Wt.skypeLogo,this.state.isNewCallScreen?Wt.skypeLogoV2:Wt.skypeLogoWithAudioBar];this.state.userCaptionsLeftViewWidth&&this.state.userCaptionsLeftViewWidth>0&&e.push(g.Styles.createViewStyle({left:this.state.userCaptionsLeftViewWidth+20},!1));const t=this.state.isLightTheme?gt.Color.gray300:gt.Color.white;return(0,a.jsx)(ye.default,{icon:St.SkypeIcon.SkypeIcon,size:St.IconSize.size48,color:t,style:e},"skypeLogo")},this._onLocalUnmute=()=>{this.isComponentMounted()&&$t._useMobileControls(this.state.controlsType)&&this.setState({showServerMutedToastOnMobile:!1,serverMuteNotificationBannerHeight:0})},this._onReactionsDrawerOpen=e=>{const t=vt.default.newCauseId();if(we.log(Se.LogTraceArea.CallingUI,"_onReactionsDrawerOpen open: "+e+" causeId: "+t),!this.isComponentMounted())return;if($t._useMobileControls(this.state.controlsType)){const i=e&&this.state.isUsingStackNavigationContext,a=i!==this.state.hideCallControlsForActivity?{hideCallControlsForActivity:i}:void 0;this._showOrHideControls(!1,t,a)}else this._inCallWarningView&&this._inCallWarningView.showOrHideWarningView(!e),this._callControls&&this._callControls.toggleReactionsPickerButton(e,!0)},this._onEndCallFailure=e=>{this._exitCall(!0,!1,e)},this._onCallTitleLayout=e=>{this.isComponentMounted()&&e.width!==this.state.titleWidth&&this.setState({titleWidth:e.width})},this._onUseImmersiveModeChange=e=>{e!==this.state.useImmersiveMode&&this.setState({useImmersiveMode:e})},this._onHeaderBackButtonPressed=e=>{we.log(Se.LogTraceArea.CallingUI,`_onHeaderBackButtonPressed causedId: ${e}`),this._navigateToChat(this._isIncomingOrOutgoingRing(),!1,e)},this._onRecentsButtonPressed=e=>{if(we.log(Se.LogTraceArea.CallingUI,"_onRecentsButtonPressed causeId: "+e),this.state.isSplitNavCollapsed&&this._getRootViewType()!==re.RootViewType.SplitViewContent)je.default.mainStageContextPopToRoot(!1,e);else{const t=this.state.isRecentsOpen,i=()=>{const i=je.default.toggleRecentsInCall(!t,e,this._getContext());return W.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>t?e.navBarClosed():e.navBarOpened())),{willToggle:i.willToggle,completeAction:()=>{i.completeAction(),!t&&i.willToggle&&(me.setFocusWithDelay(me.FocusEvent.OpenCallSideBar,100),me.setFocusWithDelay(me.FocusEvent.Recent,100))}}};this._toggleLeftPanelForAction(i,!t,e)}},this._onShowOrHideProfile=e=>{this.isComponentMounted()&&je.default.showDetailsPanelWithParams({mri:this.state.conversationMri,showConversationSettings:!0,rootViewId:this._getRootViewId(),causeId:e})},this._onShowParticipants=(e,t,i)=>{this._onShowOrHideRoster(e,t,i)},this._onShowOrHideRoster=(e,t,i)=>{if(!this._isIncomingOrOutgoingRing()&&this.state.rosterAvailble&&this.isComponentMounted()){const{callId:a}=this.props.route.params;we.log(Se.LogTraceArea.CallingUI,`CallPanel._onShowOrHideRoster, callId ${a}, causeId: ${e}`),je.default.openCallRoster(this.state.conversationMri,a,e,this._getContext()),bt.default.createSession(a,t||X.CallRosterOrigin.FromGroupTitle,!!i),W.default.updateCallTelemetry(a,e,(e=>e.callRosterOpenedCount()))}},this._toggleMobileOverflowMenu=(e,t)=>{const i=vt.default.newCauseId();if(we.log(Se.LogTraceArea.CallingUI,`_toggleMobileOverflowMenu causeId: ${i}`),e){const n={callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,reactionsConversationMri:this.state.reactionsConversationMri,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,callerContext:()=>this._getContext(),callUIState:this.state.callUIState},o=t?void 0:_t.Theme.DelphiDark,s=(0,a.jsx)(M.default,Object.assign({colorThemeOverride:o},n)),r=this._getRootViewId(),l=M.default.menuHeight(n);ue.default.showWithContent({menuId:ue.default.menuId(),anchor:e,rootViewId:this._getRootViewId(),menuHeight:l,content:s,useBlurredBackground:!t,colorThemeOverride:o,backgroundColor:t?this._getContext().themeColors.primaryBackgroundColor:void 0,headerConfig:{headerType:t?de.HeaderType.Default:de.HeaderType.Slim},staticContent:!0,useTransparentShim:!t,hidePopupArrow:!0,useDesktopPopup:!this.state.isUsingStackNavigationContext&&!this.state.isMobileScreenReaderEnabled,getTitle:()=>{},onCloseMenu:e=>{we.log(Se.LogTraceArea.CallingUI,"onCloseMenu causeId: "+e),ue.default.close(r,e)}},i);const c=!this.state.isUsingStackNavigationContext;this._showOrHideControls(c,i),pe.dismissAll()}},this._onAddToCallKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId()||this.state.isS4BCall)return!1;const i=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onAddToCallKeyboardShortcut causeId: "+i),this._onAddToCallPressed(i,Se.NavigationAddToCallOrigin.KeyboardShortcut),!0},this._onAddToCallPressed=(e,t)=>{we.log(Se.LogTraceArea.CallingUI,"_onAddToCallPressed causeId: "+e),this._onNavigatedAwayFromCall(e),je.default.openAddToCall(this.state.conversationMri,this.props.route.params.callId,t,this._getContext(),e),bt.default.updateCallRosterTelemetry(this.props.route.params.callId,e,(e=>e.callRosterAddToCall()))},this._onBingBackgroundsPressed=e=>{we.log(Se.LogTraceArea.CallingUI,"_onBingBackgroundsPressed causeId: "+e),this._onNavigatedAwayFromCall(e),je.default.openBingBackgroundsOverview(this.props.route.params.callId,this._getContext())},this._onOpenDialpad=()=>{const e=vt.default.newCauseId();if(we.log(Se.LogTraceArea.CallingUI,`CallPanel._onOpenDialpad causeId: ${e}`),!this.state.enableDialpadOnPSTNSubtitlesCalls&&L.default.CallingStore.isTranslating(this.props.route.params.callId))return W.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.displayedDtmfWarning())),void f.default.showOKAlert(Ae.getString("CallPanel.DialpadUnavailableTitle"),Ae.getString("CallPanel.DialpadUnavailableMessage"),this._getRootViewId());this._onShowOrHideDialpad(!0,e)},this._onCloseDialpad=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,`CallPanel._onCloseDialpad causeId: ${e}`),this._onShowOrHideDialpad(!1,e)},this._onShowOrHideDialpad=(e,t)=>{e!==this.state.showDialpad&&(e?(W.default.updateCallTelemetry(this.props.route.params.callId,t,(e=>e.accessedDialpad())),this.setState({showDialpad:!0})):this._animateDialpad(!1,t,(()=>{this.isComponentMounted()&&this.setState({showDialpad:!1})})))},this._onLayoutChange=e=>{this.setState({panelLayout:{x:e.x,y:e.y,width:e.width,height:e.height}})},this._onToggleLocalVideoSource=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onToggleLocalVideoSource causeId: "+e),this._startHideControlsTimer(!0,0,e),this._shouldDelayCameraToggle?Tt.default.setTimeout((()=>{this.isComponentMounted()&&this._updateVideoSource()}),500):this._updateVideoSource()},this._updateVideoSource=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_updateVideoSource causeId: "+e);const t=this.state.selectedCamera&&this.state.selectedCamera.position,i=this.state.selectedCamera&&this.state.selectedCamera.id,a=r.find(this.state.cameras,(e=>e.id!==i&&e.position!==t)),n=a&&a.id,o=a&&a.position;L.default.DeviceStore.choosePreferredDevices({camera:n},e),we.log(Se.LogTraceArea.CallingUI,"_updateVideoSource "+i+" position "+t+" -> "+n+" position "+o+" causeId: "+e),W.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.toggleCamera()))},this._onMouseMove=()=>{if(this.state.callUIState===X.CallUIState.Default||this.state.callUIState===X.CallUIState.Voicemail){const e=vt.default.newCauseId();this.state.buttonsAndInfoHidden?this._showOrHideControls(!0,e):this._startHideControlsTimer(!0,this._callControlShortTimeoutMs,e)}},this._onCallPanelHeaderLayoutChange=e=>{U.default.setCallHeaderLayoutMode(this.props.route.params.callId,e)},this._onStageTapped=e=>{const t=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onStageTapped causeId: "+t),this.state.isGalleryPanelOpen&&this._intToggleGalleryPanel(t),!(this.state.callUIState!==X.CallUIState.Default&&this.state.callUIState!==X.CallUIState.Voicemail||this._shouldKeepControlsVisible())&&(this._showOrHideControls(this.state.buttonsAndInfoHidden,t,void 0,!1,e),!0)},this._onCallControls=e=>{this._callControls=e||void 0},this._onStageChange=e=>{this._shouldDelayCameraToggle!==!e&&(this._shouldDelayCameraToggle=!e)},this._onParticipantDragChange=e=>{!e||this.state.callUIState!==X.CallUIState.Default&&this.state.callUIState!==X.CallUIState.Voicemail||this._showOrHideReactionsDrawer(!1)},this._onCallControlsInteracting=e=>{const t=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onCallControlsInteracting causeId: "+t),this._isInteractingWithCallControls=e,this._isInteractingWithCallControls?this._clearHideControlsTimer():this._startHideControlsTimer(!0,this._callControlTimeoutMs,t)},this._onReactionsBarDesiredHeight=e=>{this._reactionsBarHeight=e;const t=this.state&&$t._useMobileControls(this.state.controlsType)?this._callControlsVisualHeight():this._reactionsBarHeight;this._reactionsPanelAnimatedBottomValue.setValue(t)},this._onToggleVideo=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onToggleVideo causeId: "+e),L.default.CallControlsStore.toggleVideo(this.props.route.params.callId,e),this._startHideControlsTimer(!0,this._callControlExtraShortTimeoutMs,e)},this._onDynamicAudioChoice=(e,t)=>{const i=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"CallPanel._onDynamicAudioChoice causeId: "+i);const a=new w.AudioRouteSelectionPresenter(i);a.setUserProvidingVideo(L.default.CallingStore.isProvidingVideo(this.props.route.params.callId)),a.setControlTimerHandlers((()=>{this._clearHideControlsTimer()}),(()=>{this._startHideControlsTimer(!0,this._callControlTimeoutMs,i)})),a.show(this._getRootViewId(),e,t)},this._onCaptureMomentKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId()||this.state.isS4BCall)return!1;const i=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"CallPanel._onCaptureMomentKeyboardShortcut causeId: "+i),this._intOnCaptureMomentPress(i),!0},this._callControlsOnCaptureMomentPress=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"CallPanel._callControlsOnCaptureMomentPress causeId: "+e),this._intOnCaptureMomentPress(e)},this._intOnCaptureMomentPress=e=>{we.log(Se.LogTraceArea.CallingUI,"CallPanel._intOnCaptureMomentPress causeId: "+e);const t=[this._galleryMri()],i=this.props.route.params.callId,a=this.state.conversationMri,n=this.state.reactionsConversationMri;if(Y.CallingCapabilities.callSnapshotSupported()){const o=L.default.CallingStore.getRankedSpeakerMris(this.props.route.params.callId);this._callSnapshotSound.playOnce(e),j.default.takeSnapshot(e,i,a,n,o,t),Ye.default.maybeAnnounceForAccessibility(Ae.getString("CallPanel.SnapshotPosted")),W.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.postPhotoSnapshot()))}},this._onEmptyCallGalleryViewPhotoButtonPress=()=>{this._onPhotoButtonPress(G.CallAddPhotosEntryPoint.CallGalleryEmptyView)},this._onPhotoButtonPress=e=>{const t=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onPhotoButtonPress causeId: "+t);const i=$t._useMobileControls(this.state.controlsType),a={capturedContentHandler:new te.CapturedContentHandlerForPosting(this._galleryMri(),this.props.route.params.callId),conversationId:this._galleryMri(),callId:this.props.route.params.callId,allowVideo:!1,allowMultiple:!0,defaultToAlbums:!1,mediaPickerOnly:!0,disableMarkup:!0,onSendFlowComplete:this._onReactionsPhotoSendComplete};W.default.initCallAddPhotosEvent(this.props.route.params.callId,this.state.conversationMri,e),i&&this._onNavigatedAwayFromCall(t),this.state.isUsingStackNavigationContext?ie.navigateToCaptureComboWithParams(a,this._getContext(),(()=>{je.default.reduceNavStack([Ue.ConversationMediaViewerPanelNavigationId])})):i?ie.navigateToCaptureComboModalWithParams(a,this._getContext(),this._setAsVideoTargetWithDelay):this._intToggleGalleryPanel(t)},this._setAsVideoTargetWithDelay=()=>{we.log(Se.LogTraceArea.CallingUI,"CallPanel._setAsVideoTargetWithDelay, isCallPanelVisible before update: "+this.state.isCallPanelVisible),this.isComponentMounted()&&!this.state.isCallPanelVisible&&(we.log(Se.LogTraceArea.CallingUI,"Setting isCallPanelVisible: true"),this.setState({isCallPanelVisible:!0,isInCallGalleryOpenOnMobile:!1}))},this._onCallRecordingPress=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"CallPanel._onCallRecordingPress causeId: "+e),this._intOnCallRecordingPress(e)},this._intOnCallRecordingPress=e=>{we.log(Se.LogTraceArea.CallingUI,"CallPanel._intOnCallRecordingPress causeId: "+e),this.state.isRecording?L.default.InCallBotService.stopRecording(this.props.route.params.callId,e):L.default.InCallBotService.startRecording(this.props.route.params.callId,e)},this._onOpenGallery=(e,t,i)=>{if(we.log(Se.LogTraceArea.CallingUI,"onOpenGallery causeId: "+i),this.state.isUsingStackNavigationContext){const t=e?e.conversationId:this._galleryMri();this.state.isUsingStackNavigationContext&&J.default.setCallViewVisible(this.props.route.params.callId,!1,i),W.default.updateCallTelemetry(this.props.route.params.callId,i,(e=>e.galleryOpened())),je.default.navigateToConversationMediaViewer({conversationMri:t,initialMessage:e,defaultToLastItem:!0,useOpaqueBackground:!0,emptyMediaDescriptor:{mediaType:R.CallGalleryEmptyViewer.MediaType,launchCamera:this._onEmptyCallGalleryViewPhotoButtonPress},onClose:this._onGalleryClosed,origin:Se.NavigationMediaViewerOrigin.CallSharedPhoto},i,this._getRootViewId()),this.setState({isInCallGalleryOpenOnMobile:!0})}else e?(W.default.updateCallTelemetry(this.props.route.params.callId,i,(e=>e.galleryOpened())),this._onNavigatedAwayFromCall(i),Re.default.showWithMessageConfig({initialMessage:e,defaultToLastItem:!0,rootViewId:this._getRootViewId(),initFromComponent:t,closeToComponent:this._getChatButtonRef,animateOpenClose:!0,onClose:this._onMediaViewerClosed,emptyMediaDescriptor:{mediaType:R.CallGalleryEmptyViewer.MediaType,launchCamera:this._onEmptyCallGalleryViewPhotoButtonPress},origin:Se.NavigationMediaViewerOrigin.CallSharedPhoto})):this._intToggleGalleryPanel(i)},this._onMediaViewerClosed=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"onGalleryClosed causeId: "+e),this.state.isUsingStackNavigationContext||$t._useMobileControls(this.state.controlsType)||this._showOrHideControls(!0,e)},this._onChatButtonRef=e=>{this._chatButton=e||void 0},this._getChatButtonRef=()=>this.isComponentMounted()?this._chatButton:void 0,this._onGalleryClosed=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"onGalleryClosed causeId: "+e),J.default.setCallViewVisible(this.props.route.params.callId,!0,e),je.default.closeConversationMediaViewer(e,this._getContext())},this._onReactionsPhotoSendComplete=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onReactionsPhotoSendComplete, causeId: "+e),W.default.markPhotosSentCallAddPhotosEvent(this.props.route.params.callId,!0),W.default.completeCallAddPhotosEvent(this.props.route.params.callId),this.state.isUsingStackNavigationContext?ie.closeCaptureCombo(e,this._getContext()):$t._useMobileControls(this.state.controlsType)&&ee.default.close()},this._onReactionsBarRef=e=>{this._reactionsBar=e||void 0},this._goBack=e=>(we.log(Se.LogTraceArea.CallingUI,"_goBack causeId: "+e),this.state.callUIState===X.CallUIState.IncomingRing?(L.default.CallingStore.rejectCall(this.props.route.params.callId,e),!0):this.state.isChatOpen?(this._toggleChatPanel(e),!0):(this._exitCall(this._isIncomingOrOutgoingRing(),!1,e),!0)),this._requestEndInterruption=()=>l.default.requestEndToInterruption(),this._requestResumeCall=()=>{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_requestResumeCall, causeId: "+e),c.default.requestResumeCall(this.props.route.params.callId,e)},this._onToggleVideoKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onToggleVideoKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),this._onToggleVideo(),!0},this._onToggleMicrophoneKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onToggleMicrophoneKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i);return new P.ToggleMuteCommand(this.props.route.params.callId,L.default.CallingStore.isMuted(this.props.route.params.callId),L.default.CallingStore.isServerMuted(this.props.route.params.callId),this.state.microphonePermissionStatus!==h.PermissionStatus.Granted,this._getRootViewId(),void 0,i).execute(),!0},this._onAnnounceMuteStatusKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onAnnounceMuteStatusKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),L.default.CallingStore.isMuted(this.props.route.params.callId)?Z.default.announceMicrophoneState(!0):Z.default.announceMicrophoneState(!1),!0},this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut=(e,t)=>{if(t!==this._getRootViewId())return!1;const i=vt.default.newCauseId();return we.log(Se.LogTraceArea.CallingUI,"_onAnnounceSelfVideoOnOffStatusKeyboardShortcut, causeId: "+i),this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,i),L.default.CallingStore.isProvidingVideo(this.props.route.params.callId)?Z.default.announceVideoState(!0):Z.default.announceVideoState(!1),!0},this._hangupCallShortcut=(e,t)=>t===this._getRootViewId()&&(this._hangupCall("CallPanel._hangupCallShortcut"),!0),this._hangupCall=e=>{const t=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_hangupCall: "+e+t),this.state.callUIState===X.CallUIState.IncomingRing?L.default.CallingStore.rejectCall(this.props.route.params.callId,t):this._endCall(!1,t)},this._closeSubtitleHistory=()=>{{const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onPressCloseSubtitleHistory, close subtitles panel causeId: "+e),this.state.isUsingStackNavigationContext?this.isComponentMounted()&&this.setState({isInCallSubtitleHistoryModeOnMobile:!1}):this._closeRightPanel((()=>je.default.closeSubtitlesPanel(e,this._getContext())),e)}},this._openSubtitleHistory=()=>{if(this.state.isTranslating){const e=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"_onPressOpenSubtitleHistory, open subtitles panel causeId: "+e),je.default.openSubtitles(this.state.reactionsConversationMri,this.state.conversationMri,this.props.route.params.callId,this._getContext(),e),this.state.isUsingStackNavigationContext&&this.isComponentMounted()&&this.setState({isInCallSubtitleHistoryModeOnMobile:!0}),this.forceUpdate()}},this._onCameraDeniedToastHeightChanged=e=>{this._onToastHeightChanged(e,"cameraDeniedBannerHeight")},this._onRecordingBannerHeightChanged=e=>{this._onToastHeightChanged(e,"recordingBannerHeight")},this._onNdiUsedBannerHeightChanged=e=>{this._onToastHeightChanged(e,"ndiUsedBannerHeight")},this._onCallMediaCapturedBannerHeightChanged=e=>{this._onToastHeightChanged(e,"callMediaCapturedBannerHeight")},this._onIncomingVideoDisabledBannerHeightChanged=e=>{this._onToastHeightChanged(e,"incomingVideoDisabledBannerHeight")},this._onCallConnectionQualityBannerHeightChanged=e=>{this._onToastHeightChanged(e,"callConnectionQualityBannerHeight")},this._onServerMuteNotificationBannerHeightChanged=e=>{this._onToastHeightChanged(e,"serverMuteNotificationBannerHeight")},this._onMobileScreenShareBannerHeightChanged=e=>{this._onToastHeightChanged(e,"mobileScreenShareBannerHeight")},this._onMobileTeamsInteropBannerHeightChanged=e=>{this._onToastHeightChanged(e,"mobileTeamsInteropBannerHeight")},this._onMobileTogetherModeNoticeBannerHeightChanged=e=>{this._onToastHeightChanged(e,"mobileTogetherModeNoticeBannerHeight")},this._onPstnTranslationNoticeBannerHeightChanged=e=>{this._onToastHeightChanged(e,"pstnTranslationNoticeBannerHeight")},this._onVideoRestrictedBannerHeightChanged=e=>{this._onToastHeightChanged(e,"videoRestrictedBannerHeight")},this._onPstnParticipantRingNoticeBannerHeightChanged=e=>{const t=e?e+10:0;this._shouldUpdateBannerHeight(t,this.state.pstnParticipantRingNoticeBannerHeight||0)&&this.setState({pstnParticipantRingNoticeBannerHeight:t})},this._onMobileTranslationBannerHeightChanged=e=>{this._onToastHeightChanged(e,"mobileTranslationBannerHeight")},this._onMobileMusicModeNoticeBannerHeightChanged=e=>{this._onToastHeightChanged(e,"mobileMusicModeNoticeBannerHeight")},this._closeCallCreatorShareOverlayPopup=()=>{this.setState({hasCallCreatorShareOverlayPopup:!1})},Ne.default.canEnableNewCallScreenDesignByDefaultNoSubscription()&&Ne.default.setNewCallScreenDesignEnabled(!0)}_buildState(e,t){const i=He.default.isUsingStackNavigationContextNoSubscription(),{callId:a,initialConversationMri:n,navigationReason:o}=e.route.params,s=T.default.getS4LCMCFeatures();let l=X.CallUIState.Default,c=!1,u=!1;const h="user"===L.default.CallingStore.getForwardingDestinationType(a),p=L.default.CallingStore.getCallConversationMri(a)||(t?n:this.state.conversationMri),g=ae.isOneOnOneConversation(p),C=L.default.CallingStore.isPSTNCall(a),m=ae.isEncryptedThread(p),y=ae.isS4BBridgeMri(p),f=L.default.CallingStore.hasStartedCallLocallyGoLive(a),b=L.default.CallingStore.getCallState(a),_=!!b&&V.default.isCallStateActive(b),v=L.default.CallingStore.isProvidingVideo(a),w=this._getRootViewId(),I=!t&&this.state.isCallCreator||L.default.CallingStore.isCallCreator(a),P=!(t||!this.state.hasBeenPresented)||!Ge.default.isAnimationPending(),M=L.default.CallingStore.hasRejectedCallLocally(a);let A,R=!t&&(this.state.exitingCall||M);switch(b){case S.CallState.None:if(L.default.CallingStore.isCallIncoming(a)&&o!==Ue.CallNavigationReason.AutoAnsweredRing)l=X.CallUIState.IncomingRing;else{const e=this._leftNoneStateOnce||L.default.CallingStore.callDidExist(a);l=e?X.CallUIState.Disconnected:X.CallUIState.None,R=R||e&&P,e&&!R&&we.log(Se.LogTraceArea.CallingUI,"_buildState: CallState.None, waiting for hasBeenPresented to exit")}c=!0;break;case S.CallState.Connected:case S.CallState.LocalHold:case S.CallState.RemoteHold:u=V.default.isCallStateOnHold(b),"voicemail"===L.default.CallingStore.getForwardingDestinationType(a)?l=X.CallUIState.Voicemail:L.default.CallingStore.hasConnectedParticipants(a)?l=X.CallUIState.Default:(l=t?X.CallUIState.None:this.state.callUIState,f&&(l=X.CallUIState.GoLiveSinglePlayer),c=!t&&this.state.skipRenderingParticipants);break;case S.CallState.Disconnecting:l=t?X.CallUIState.None:this.state.callUIState,c=!0,R=R||P,P||we.log(Se.LogTraceArea.CallingUI,"_buildState: CallState.Disconnecting, waiting for hasBeenPresented to exit");break;case S.CallState.Disconnected:l=X.CallUIState.Disconnected,c=!0,R=R||P,P||we.log(Se.LogTraceArea.CallingUI,"_buildState: CallState.Disconnected, waiting for hasBeenPresented to exit");break;case S.CallState.Connecting:case S.CallState.EarlyMedia:I&&(c=!g&&!v,l=f?X.CallUIState.GoLiveSinglePlayer:X.CallUIState.OutgoingRing);break;case S.CallState.Notified:o===Ue.CallNavigationReason.AnsweredRing||o===Ue.CallNavigationReason.AutoAnsweredRing?l=X.CallUIState.Default:(l=X.CallUIState.IncomingRing,c=!0)}const x=()=>m?Ae.getString("CallPanel.EncryptedConnectingStatusMessage"):Ae.getString("CallPanel.ConnectingStatusMessage");l===X.CallUIState.OutgoingRing&&(A=b===S.CallState.EarlyMedia?!t&&this.state.outgoingRingStatus?this.state.outgoingRingStatus:x():b!==S.CallState.Connecting||L.default.CallingStore.hasRingingParticipants(a,!1)||L.default.CallingStore.hasConnectedParticipants(a)?Ae.getString("CallPanel.RingingStatusMessage"):x());const O=ae.getReactionsThreadMriForCallId(a),D=L.default.DeviceStore.getCameras(),E=L.default.DeviceStore.getSelectedCamera();let N;if(g&&C){const e=ae.getPhoneNumberFromMri(p);e&&(N=Ke.default.getConversationMri(e))}const j=t?{x:0,y:0,width:0,height:0}:this.state.panelLayout,H=qe.default.getDeviceOrientation(w)===d.DeviceOrientation.Landscape,z=Xe.default.statusBarHeight(),G=T.default.getS4LCMCFeatures().enableFullScreenOnWeb,W=Z.default.isLeftPanelOpen(),K=Z.default.isRightPanelOpen(),$=Z.default.isGalleryPanelOpen(),q=Z.default.isSubtitlesPanelOpen(),Q=Z.default.getControlsType(w),ee=Je.default.isMobileScreenReaderEnabled(),te=!i&&ze.default.isDesktopSplitNavStackCollapsed(),ie=!i&&K&&ze.default.isCallChatShowing(),ne=!s.enableTapToMoveCallParticipant&&Q===X.CallControlsType.Mobile,oe=L.default.InCallBotService.isTranslating(a),se=L.default.InCallBotService.isPstnTranslationEnabled(a),le=L.default.InCallBotService.isVoiceTranslationEnabled(a),de=L.default.InCallBotService.isSkypeTranslationEnabled(a),ue=L.default.InCallBotService.isSkypeTranslationPaused(a),he=s.enableMobileSubtitlesRightPanel,pe=L.default.InCallBotUtils.isCallTranslatorBotTranslationEnabled(p)&&fe.default.isConversationTranslated(p),ge=L.default.InCallBotService.isCaptioningEnabled(a),Ce=L.default.CallingFeaturesHelper.allowReactions({isPSTNCall:C,isEncryptedCall:m,conversationMri:p,callId:a}),me=l===X.CallUIState.Default||l===X.CallUIState.OutgoingRing||l===X.CallUIState.GoLiveSinglePlayer,ye=l===X.CallUIState.Default,be=Ce&&s.enableAllCallButtonsVisible?me:ye,_e=(0,B.default)(),Te=s.enableNewCallScreen&&Ne.default.getNewCallScreenDesignEnabled(),ve=(0,ce.default)().getConversation(p),Ie=L.default.CallingStore.getRemoteCallMemberMris(a),Me=ve&&ve.isGroupConversation()?[...ve.getThreadMembers()]:[],ke=(0,Lt.countInactivePstnParticipantInThread)(Ie,Me),Re=[],Le=U.default.getStageMode(a),Ve={conversationMri:p,isProvidingVideo:v,cameras:D,selectedCamera:E,isCallCreator:I,microphonePermissionStatus:We.default.permissionStatus(mt.PermissionType.Microphone),isRecording:L.default.CallingStore.isRecording(a),isVideoRestricted:L.default.CallingStore.getListOfBlockedVideoFeedParticipantsIds(a,!t&&!this.state.isVideoRestricted).length>0,remoteParticipantsThatAreCapturingCallMedia:L.default.CallingStore.getRemoteMembersCapturingCallMedia(a),isNdiBeingUsed:L.default.NdiHookupService.isInUse(),isTranslating:oe,isIncomingVideoDisabled:Z.default.isIncomingVideoDisabled(a),audioOnlyEnabled:L.default.CallingStore.isAudioOnly(a),isMobileScreenShareActive:!1,callUIState:l,outgoingRingStatus:A,terminatedReason:L.default.CallingStore.getCallTerminatedReason(a),skipRenderingParticipants:c,rosterAvailble:!g,isCallOnHold:u,isCallBeingForwarded:h&&l===X.CallUIState.OutgoingRing,isUsingStackNavigationContext:i,reactionsConversationMri:O,exitingCall:R,isCallActive:_,isLandscape:H,panelLayout:j,hasBeenPresented:P,isMobileScreenReaderEnabled:ee,knownPSTNContactMri:N,isPSTNCall:C,isS4BCall:y,isEncryptedCall:m,statusBarHeight:z,hasMicrophones:L.default.DeviceStore.hasMicrophones(),hasSpeakers:L.default.DeviceStore.hasSpeakers(),isAudioOutputSelectionSupported:L.default.DeviceStore.getIsAudioOutputSelectionSupported(),topSafeAreaHeight:ne||Xe.default.keepStatusBarVisible()?Xe.default.statusBarPadding():0,bottomSafeAreaInset:Xe.default.bottomSafeAreaInset(re.BottomInsetDefault),isSpeakerMuted:!!Y.CallingCapabilities.speakerVolumeControlSupported()&&(L.default.CallingStore.isSpeakerMuted(a)||0===L.default.DeviceStore.getSpeakerVolume()),callAudioOutputRoute:L.default.CallControlsStore.getAudioOutput(),isNavigatingWithKeyboard:Pe.default.isNavigatingWithKeyboard(),isRecentsOpen:!te&&ze.default.isLeftPanelShowing(),isChatOpen:ie,isRightPanelOpen:K,isGalleryPanelOpen:$,isSubtitlesPanelOpen:q,isLeftPanelOpen:W,isSplitNavCollapsed:te,isRinglessCall:f,controlsType:Q,lockOrientationForIncomingRing:l===X.CallUIState.IncomingRing&&i,isDesktopMin:Z.default.isDesktopMinCallPanelHeader(w),isDesktopMinCallRibbon:Z.default.isDesktopMinCallRibbon(w),isLightTheme:Te&&Z.default.isLightTheme(),isTranscriptionEnabled:L.default.InCallBotUtils.isCallTranslatorBotEnabled(p),isInCallGalleryOpenOnMobile:!t&&this.state.isInCallGalleryOpenOnMobile,shouldShowReactions:be,showFullScreenOptionInRibbonSettings:G,callNetworkQualityPoor:_e.isCallQualityPoor(a),callReconnectionState:_e.getCallReconnectionState(a),newMobileOverflowOpen:k.default.isOverflowMenuVisible(),mobileSubtitlesRightPanelEnabled:he,isInCallSubtitleHistoryModeOnMobile:!t&&this.state.isInCallSubtitleHistoryModeOnMobile&&!J.default.isCallVisible(a),showAloneInCall:f&&I&&F.default.getActiveParticipants(a,p).length+Re.length===1,isTranslated:pe,translationBannerBeenDismissed:Fe.default.getInCallTranslationBannerDismissState(p),enableDoubleTapToFullScreen:G&&s.enableDoubleTapToFullScreen,enableDialpadOnPSTNSubtitlesCalls:s.enableDialpadOnPSTNSubtitlesCalls,isOutgoingVideoDisabled:L.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),isNewCallScreen:Te,wasNewCallScreenRevertNoticeDismissed:Ne.default.getWasNewCallScreenRevertNoticeDismissed(),enableParticipantsButtonInCallControls:s.enableParticipantsButtonInCallControls&&!g,stageLayoutMode:Le,activeCallsCount:L.default.CallingStore.getCallIds().filter((e=>L.default.CallingStore.isCallActive(e))).length,hideTogetherModeNoticeToastForCallId:Ne.default.getTogetherModeNoticePresentedForCallId(),isPossiblyNotConnectedAudienceBotInCall:L.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(a),renderHeaderV2:Te&&Q!==X.CallControlsType.Mobile,shouldShowTray:Te&&!U.default.isTopTrayHidden(a)&&Pt.default.trayHasParticipants(a),showMyselfInTheGrid:U.default.getSelfInTheGrid(a),isOneOnOneConversation:g,enableMusicMode:L.default.DeviceStore.getMusicMode(),canAccessConversationDetails:kt.default.navigation().canAccessConversationDetails,pstnTranslationEnabled:se,voiceTranslationEnabled:le,skypeTranslationEnabled:de,skypeTranslationPaused:ue,captioningEnabled:ge,countInactivePstnParticipantsInCall:ke,enableVisitor:s.enableNewCallPanel.enableVisitor,enableExperimentalHeader:s.enableNewCallPanel.enableExperimentalHeader,enableExperimentalCallControls:s.enableNewCallPanel.enableExperimentalCallControls,traySizeMultiplier:$t._useMobileControls(Q)&&H?X.MobileTopTraySizeMultiplier:1,enableTouchBarControls:s.enableTouchBarControls};Ve.isCallMediaBeingCaptured=!!Ve.remoteParticipantsThatAreCapturingCallMedia&&Ve.remoteParticipantsThatAreCapturingCallMedia.length>0,Ve.callPanelHeaderLayout=U.default.getCallHeaderLayoutMode(a);const Oe=Fe.default.getCallTranslatorCaptionsPositionMode();if(Ve.userCaptionPositionMode=this._getDefaultCaptionPositionMode(s,se,i,qe.default.getDeviceOrientation(w)===d.DeviceOrientation.Landscape,Oe),t)if(this._callControlTimeoutMs=s.callControlTimeoutMs,this._callControlShortTimeoutMs=s.callControlShortTimeoutMs,this._callControlExtraShortTimeoutMs=500,Ve.recordingBannerHeight=0,Ve.cameraDeniedBannerHeight=0,Ve.ndiUsedBannerHeight=0,Ve.incomingVideoDisabledBannerHeight=0,Ve.serverMuteNotificationBannerHeight=0,Ve.callMediaCapturedBannerHeight=0,Ve.callConnectionQualityBannerHeight=0,Ve.mobileScreenShareBannerHeight=0,Ve.mobileTeamsInteropBannerHeight=0,Ve.mobileMusicModeNoticeBannerHeight=0,Ve.mobileTogetherModeNoticeBannerHeight=0,Ve.mobileTranslationBannerHeight=0,Ve.pstnTranslationNoticeBannerHeight=0,Ve.videoRestrictedBannerHeight=0,Ve.pstnParticipantRingNoticeBannerHeight=0,Ve.hideCameraDeniedToast=!1,Ve.hideCallControlsForActivity=!1,Ve.useImmersiveMode=!1,Ve.showDialpad=!1,Ve.buttonsAndInfoHidden=!1,Ve.suppressParticipantAnimation=!1,Ve.titleWidth=0,Ve.isMicrophoneMutedWhileSpeaking=!1,Ve.showSpeakerOnWarning=!1,Ve.showServerMutedToastOnMobile=!1,Ve.isCallParticipantActionsMenuOpened=!1,Ve.shouldRenderFloatingVideoPreview=!1,Ve.hideTeamsInteropToast=!1,Ve.hideVideoRestrictedToast=!1,Ve.hasCallCreatorShareOverlayPopup=!0,i){const e=this._getContext().componentVisibilityStatus;e&&(Ve.isCallPanelVisible=e.isVisible(),this._visibilitySubscriptionToken=e.isVisibleEvent().subscribe((e=>{we.log(Se.LogTraceArea.CallingUI,"visibility changed, isVisible: "+e+", isCallPanelVisible: "+this.state.isCallPanelVisible),this.isComponentMounted()&&e!==this.state.isCallPanelVisible&&(e?this._setAsVideoTargetWithDelay():(we.log(Se.LogTraceArea.CallingUI,"Setting isCallPanelVisible: "+e),this.setState({isCallPanelVisible:e})))})))}else Ve.isCallPanelVisible=!0;else Ve.isRecording||(Ve.recordingBannerHeight=0),Ve.isNdiBeingUsed||(Ve.ndiUsedBannerHeight=0),Ve.isCallMediaBeingCaptured||(Ve.callMediaCapturedBannerHeight=0),Ve.isIncomingVideoDisabled||(Ve.incomingVideoDisabledBannerHeight=0),this._showMobileServerMutedToast(Ve)||(Ve.serverMuteNotificationBannerHeight=0),this._showCallConnectionQualityToast(Ve)||(Ve.callConnectionQualityBannerHeight=0),Ve.isMobileScreenShareActive||(Ve.mobileScreenShareBannerHeight=0),Ve.isTranslated&&!Ve.translationBannerBeenDismissed||(Ve.mobileTranslationBannerHeight=0);this._callState=b,this._mustUpdateSpeakerMutedAsync(a,Ve)&&r.defer((()=>{this._updateSpeakerMutedAsync(a).then((e=>{this.isComponentMounted()&&this.setState({isSpeakerMuted:e})}))}));return!(null==ve?void 0:ve.isJoinEnabled())&&!xe.MeetNowHelpers.isGuestFlow()&&(Ve.hasCallCreatorShareOverlayPopup=!1),Ve.isConversationCreator=Mt.default.getSkypeMri()===(null==ve?void 0:ve.creator()),Ve.isMobileEnvironmentWithStackNavigation=He.default.isMobileEnvironmentWithStackNavigation(),Ve}render(){const e=$t._useMobileControls(this.state.controlsType),t=this.state.isLightTheme?Wt.callPanelLightTheme:Wt.callPanelCallStageV2,i=[Wt.callPanel,this.state.isNewCallScreen?t:void 0];g.StatusBar.isOverlay()&&i.push(Ze.default.paddingTopStyle(this.state.statusBarHeight));const r=this._getCallStageViewRect(e),l=g.Styles.createViewStyle({width:r.width,height:r.height},!1);let c;if(e&&this.state.callUIState===X.CallUIState.IncomingRing)c=[(0,a.jsxs)(g.View,Object.assign({style:[Wt.innerViewBase,l]},{children:[this.state.isNewCallScreen&&(0,a.jsx)(Et.default,{}),this._renderCallingAnimation(r,{top:240}),(0,a.jsx)(Be.default,{conversationMri:this.state.conversationMri,callId:this.props.route.params.callId,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,useLightTheme:this.state.isLightTheme})]}),"controlscontainer")];else if(e)c=this.state.enableVisitor?this._visitLayout(this.props.layout,r):[(0,a.jsxs)(g.View,Object.assign({style:Wt.mobileInnerViewBase},{children:[this._renderCallStage(r),this._renderTray(r),this._renderReactionsPanel(),this._renderCallingAnimation(r,{top:0,bottom:0}),this._renderTranscriptionView(r),this._renderTranscriptionNotifications(r),this._renderOptionalAloneInTheCallInformationView(),this._renderTransientView(),this._renderCallControls(r),this._renderMobileTopBanner(r)]}),"controlscontainer"),(0,a.jsx)(s.SafeAreaView,Object.assign({edges:["top"],style:Kt.safeAreaContainer,pointerEvents:"box-none"},{children:(0,a.jsxs)(o.View,Object.assign({style:Kt.safeAreaContentWrapper,pointerEvents:"box-none"},{children:[this._renderCallPanelHeader(r),this._renderDialpad(r),this._renderAudioNotification()]}))}),"safe-area-view")];else{const e=this.state.enableDoubleTapToFullScreen?g.GestureView:g.View,t={};this.state.enableDoubleTapToFullScreen&&(t.onDoubleTap=()=>this._toggleFullScreenMode()),c=[(0,a.jsxs)(e,Object.assign({style:[Wt.innerViewBase,l]},t,{children:[this._renderCallStage(r),Y.CallingCapabilities.floatableResizableVideoPreviewSupported()?this._renderFloatingVideoPreview():void 0,this._renderCallingAnimation(r,{top:0,bottom:0}),this._renderCallPanelHeader(r),this._renderTray(r),this._renderSkypeLogo(),this._renderOptionalAloneInTheCallInformationView(),this._renderTransientView(),this._renderTranscriptionView(r),this._renderTranscriptionNotifications(r),this._renderAudioNotification(),this._renderReactionsBar(r),this._renderReactionsPanel(),this._renderCallControls(r),this._renderDialpad(r),this._renderCallCreatorShareOverlayPopup()]}),"controlscontainer")]}return(0,a.jsxs)(n.Fragment,{children:[this.state.enableTouchBarControls?(0,a.jsx)(Ut.TouchBar,{callId:this.props.route.params.callId,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,conversationMri:this.state.conversationMri}):null,(0,a.jsxs)(se.default,Object.assign({goBack:this._goBack},{children:[(0,a.jsx)(Bt.default,{statusBarKey:"CallPanel",backgroundColor:gt.Color.black,barStyle:Bt.BarStyle.LIGHT_CONTENT,hidden:!!this.state.hideStatusBarPadding,animated:!0}),(0,a.jsx)(xt.KeyboardAvoidingView,{children:(0,a.jsx)(g.View,Object.assign({style:i,onLayout:this._onLayoutChange,onMouseMove:this._onMouseMove},{children:(0,a.jsx)(oe.CoachMarkContext.Provider,Object.assign({value:this._coachMarkContext},{children:c}))}))})]}))]})}_renderCallPanelHeaderFlex(e,t){const i=this.state.isPSTNCall&&this.state.knownPSTNContactMri||this.state.conversationMri;return this.state.enableExperimentalHeader?(0,a.jsx)(Nt.MobileCallPanelHeader,{isLandscape:null==t?void 0:t.isLandscape,callId:this.props.route.params.callId,conversationId:i,isCallActive:this.state.callUIState===X.CallUIState.Default||this.state.callUIState===X.CallUIState.Voicemail,onBackButtonPress:this._onHeaderBackButtonPressed,style:null==t?void 0:t.style}):this._renderCallPanelHeaderV1(i,e,!0,!0,void 0,void 0,void 0,!0,t)}_renderLocalParticipantView(e,t){return!this.state.isOneOnOneConversation||this.state.stageLayoutMode!==X.StageMode.Grid||this.state.showMyselfInTheGrid||this.state.pstnTranslationEnabled||this._isIncomingOrOutgoingRing()&&!this.state.isProvidingVideo?null:(0,a.jsx)(Ft.default,{callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,isLightTheme:this.state.isLightTheme,style:null==t?void 0:t.style,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,isProvidingVideo:this.state.isProvidingVideo})}_visitLayout(e,t,i=0){return e.map((e=>{var n;const s=e.key||i++;switch(e.name){case"Column":return(0,a.jsx)(o.View,Object.assign({},e.props,{children:this._visitLayout(e.children,t,i)}),s);case"ZStack":return(0,a.jsx)(o.View,Object.assign({},e.props,{children:this._visitLayout(null!==(n=e.children)&&void 0!==n?n:[],t,i)}),s);case"LayoutAnimationContainer":return(0,a.jsx)(Vt.default,Object.assign({style:e.props.style,hidden:e.props.hidden},{children:this._visitLayout(e.children,t,i)}),s);default:const r=this._KEY_METHOD_MAP[e.name],l=(null==e?void 0:e.props)||{};return null==r?void 0:r.apply(this,[t,l])}}))}_renderDialpad(e){if(this.state.showDialpad){const t=[Wt.dialpadContainer,Wt.dialpadShim,this._dialpadAnimatedOpacityStyle],i=[Wt.dialpadInnerContainer],n=Math.min(414,e.width),o=this.state.bottomSafeAreaInset+X.AudioNotificationOffset;return i.push(g.Styles.createViewStyle({height:Math.min(zt+o,e.height),width:n,left:(e.width-n)/2,paddingBottom:o},!1)),i.push(this._dialpadAnimatedTransformStyle),(0,a.jsxs)(g.View,Object.assign({style:Wt.dialpadContainer},{children:[(0,a.jsx)(g.Animated.View,Object.assign({style:t},{children:(0,a.jsx)(g.GestureView,{style:Wt.dialpadContainer,onTap:this._onCloseDialpad})}),"shim"),(0,a.jsx)(g.Animated.View,Object.assign({style:i},{children:(0,a.jsx)(Ce.default,{callId:this.props.route.params.callId,onClose:this._onCloseDialpad})}),"dialpad")]}),"dialpadcontainer")}}componentDidMount(){var e,t,i,a;super.componentDidMount(),null===(t=(e=this.props).onFocusModeChange)||void 0===t||t.call(e,this.state.buttonsAndInfoHidden);const{callId:n}=this.props.route.params,o=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,`[CallPanel][componentDidMount][${o}]`,`callUIState: ${X.CallUIState[this.state.callUIState]}`),d.default.enableLowProfileMode().catch((e=>{we.warn(Se.LogTraceArea.CallingUI,"enableLowProfileMode failed: "+pt.default.errorAsString(e))})),J.default.setCallViewVisible(n,!0,o),null===(i=L.default.CallingStore.getVideoOverrides(n))||void 0===i||i.clearRemoteStreamOverride(O.VideoOverrideReason.InBackground),null===(a=L.default.CallingStore.getLocalVideoState(n))||void 0===a||a.clearLocalVideoOverride(O.VideoOverrideReason.InBackground),this.state.isIncomingVideoDisabled&&Z.default.disableIncomingVideo(n,o),this.state.buttonsAndInfoHidden||this._callControlsAnimatedTranslateYValue.setValue(this._controlsTranslateY()),this._subscriptions.push(_.default.subscribeForChanges("CallPanel",this._onAppStateChange)),this._updateAudioState(o),L.default.OngoingCallService.updateVideoState(n,g.App.getActivationState()),this._updateLeftNoneStateOnce(o),this.state.callUIState!==X.CallUIState.Default&&this.state.callUIState!==X.CallUIState.Voicemail||this._startParticipantAnimationSuppressionTimeout(),this.state.lockOrientationForIncomingRing&&(we.log(Se.LogTraceArea.CallingUI,"componentDidMount, entered IncomingRing state, locking orientation causeId: "+o),this._lockOrientationForIncomingRing()),this._callParticipantAccessoryOpacityValue.setValue(this.state.buttonsAndInfoHidden?1:0),this.state.isUsingStackNavigationContext&&(we.log(Se.LogTraceArea.CallingUI,"componentDidMount, setting keyboard resize mode to None causeId: "+o),Ie.default.setResizeMode(u.KeyboardAwareResizeMode.None)),this._subscriptions.push(L.default.CallingStore.callDeviceQualityEvent().subscribe(this._updateDeviceQualityState)),this._subscriptions.push(L.default.CallingStore.serverMutedEvent().subscribe(this._updateServerMutedState)),this._subscriptions.push(L.default.CallingStore.deviceNearEndQualityEvent().subscribe(this._updateDeviceNearEndQuality)),this._subscriptions.push(L.default.DeviceStore.selectedDevicesChangedEvent().subscribe(this._selectedDevicesChanged)),this._subscriptions.push(L.default.DeviceStore.availableDevicesChangedEvent().subscribe(this._availableDevicesChanged)),this._subscriptions.push(L.default.DeviceStore.onVideoEffectsQualityChangedEvent().subscribe(this._onVideoEffectsQualityChangedEvent)),pe.dismissAll(),this._startOrStopOrientationListener(!0),this._registerKeyboardHandlers(),this.state.isChatOpen||N.default.assignOuterThread(this.state.reactionsConversationMri,this.state.conversationMri);const s=$t._useMobileControls(this.state.controlsType);s||g.Input.keyUpEvent.subscribe(this._onKeyUp),Ve.default.addOrUpdateBottomMargin(Gt,s?82:100),this._maybeShowOrHideDeviceErrorToast(!0,!0,o),this._maybeShowCompositeCallRecordingToast(!1),this._maybeShowCompositeIncomingVideoDisabledToast(!1,o),this._maybeShowCompositeCallConnectionQualityToast(!1,o),this._maybeShowCompositeCameraDeniedToast(),this._maybeShowCompositeTeamsInteropInCallToast(o),this._maybeShowCompositeTogetherModeNoticeInCallToast(o),this._maybeShowCompositeMusicModeNoticeInCallToast(o),this._maybeShowCompositePstnTranslationInCallToast(o),this._maybeShowCompositePstnParticipantRingInCallToast(o),this._maybeShowCompositeTranslationInCallToast(o),this.state.controlsType===X.CallControlsType.DesktopMin&&W.default.updateCallTelemetry(n,o,(e=>e.setEnterMinWidth())),L.default.OngoingCallService.getIsChatSidebarOpen(n)&&!this.state.isChatOpen&&this._toggleChatPanel(o),ht.default.callPanelRendered(),W.default.onCallPanelRendered(this.props.route.params.callId),m.PushNotifications.onCallScreenRendered(n)}componentWillUnmount(){super.componentWillUnmount();const{callId:e}=this.props.route.params;this._hideAllDeviceErrorToasts(),ne.default.closeCoachMark({});const t=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"componentWillUnmount causeId: "+t),d.default.disableLowProfileMode().catch((e=>{we.warn(Se.LogTraceArea.CallingUI,"enableLowProfileMode failed: "+pt.default.errorAsString(e))})),L.default.CallingStore.isCallConnected(e)&&W.default.updateCallTelemetry(e,t,(e=>e.sideNavigateInCall())),N.default.setHasPostedReactions(this.state.reactionsConversationMri,!1),this._subscriptions.forEach((e=>e.unsubscribe())),this._subscriptions=[],J.default.setCallViewVisible(e,!1,t),k.default.resetAllVisibility(t),Ie.default.setResizeMode(u.KeyboardAwareResizeMode.Default),De.default.removeOrientationLock(this._orientationLockKey),this._startOrStopOrientationListener(!1),this._unregisterKeyboardHandlers(),this._visibilitySubscriptionToken&&(this._visibilitySubscriptionToken.unsubscribe(),this._visibilitySubscriptionToken=void 0),$t._useMobileControls(this.state.controlsType)||g.Input.keyUpEvent.unsubscribe(this._onKeyUp),Ve.default.removeBottomMargin(Gt),this.state.newMobileOverflowOpen&&ue.default.closeIfNeeded(this._getRootViewId(),t)}componentDidUpdate(e,t,i){var a,n;super.componentDidUpdate(e,t,i),null===(n=(a=this.props).onFocusModeChange)||void 0===n||n.call(a,this.state.buttonsAndInfoHidden);const{callId:o}=this.props.route.params,s=vt.default.newCauseId();we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate causeId: "+s);const c=$t._useMobileControls(this.state.controlsType);if(t.callReconnectionState!==O.NetworkConnectionState.Connecting&&this.state.callReconnectionState===O.NetworkConnectionState.Connecting?(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, Call started to reconnect"),W.default.updateCallTelemetry(o,s,(e=>e.setCallReconnectStart()))):t.callReconnectionState===O.NetworkConnectionState.Connecting&&this.state.callReconnectionState===O.NetworkConnectionState.Connected&&(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, Call reconnected successfully"),W.default.updateCallTelemetry(o,s,(e=>e.setCallReconnectEnd()))),!t.hasBeenPresented&&this.state.hasBeenPresented&&(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, hasBeenPresented: true"),Tt.default.setTimeout((()=>{pe.dismissAll()}),1e3)),t.callUIState!==this.state.callUIState&&(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, callUIState changed: "+X.CallUIState[t.callUIState]+" -> "+X.CallUIState[this.state.callUIState]+" causeId: "+s),this._updateLeftNoneStateOnce(s),t.callUIState===X.CallUIState.GoLiveSinglePlayer&&this.state.callUIState===X.CallUIState.Default)){const e=r.filter(L.default.CallingStore.getRemoteCallMembers(o),(e=>V.default.isParticipantConnected(e)));if(!r.isEmpty(e)){const t=e[0],i=L.default.CallingStore.getRemoteCallMemberMri(o,t),a=ge.default.getDisplayName(i)||"";Ye.default.maybeAnnounceForAccessibility(Ae.getString("CallPanel.FirstParticipantJoinAccessibility",{name:a}))}}if(t.lockOrientationForIncomingRing!==this.state.lockOrientationForIncomingRing&&(this.state.lockOrientationForIncomingRing?(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, entered IncomingRing state, locking orientation causeId: "+s),this._lockOrientationForIncomingRing()):(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, left IncomingRing state, unlocking orientation causeId: "+s),De.default.removeOrientationLock(this._orientationLockKey))),t.outgoingRingStatus!==this.state.outgoingRingStatus&&we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, outgoingRingStatus changed: "+t.outgoingRingStatus+" -> "+this.state.outgoingRingStatus+" causeId: "+s),this.state.exitingCall&&!t.exitingCall&&(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, call disconnected, callState = "+this._callState+" terminatedReason = "+this.state.terminatedReason+" endCallNavigationRequested = "+this._endCallNavigationRequested),this._onEscape(),!this._endCallNavigationRequested)){this._endCallNavigationRequested=!0;const e=vt.default.newCauseId();if(this.state.terminatedReason===S.TerminatedReason.PstnInvalidNumber)we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, exit call with invalid number causeId: "+e),this.state.isUsingStackNavigationContext?je.default.navigateToHub(e):je.default.navigateToWelcomeScreen(e);else{we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate, exit call causeId: "+e);const t=this.state.activeCallsCount>1||this.state.terminatedReason===S.TerminatedReason.Declined||this.state.terminatedReason===S.TerminatedReason.Missed||this.state.terminatedReason===S.TerminatedReason.Cancelled&&!this.state.isCallCreator;this._exitCall(t,!1,e)}}const d=this.state.callUIState===X.CallUIState.Default||this.state.callUIState===X.CallUIState.Voicemail,u=d&&!this._hasConnected,h=!this.state.newMobileOverflowOpen&&t.newMobileOverflowOpen;if(d&&(this.state.buttonsAndInfoHidden!==t.buttonsAndInfoHidden||u||h)&&!this._shouldKeepControlsVisible()){const e=$t._useMobileControls(this.state.controlsType)&&!u?this._callControlTimeoutMs:this._callControlShortTimeoutMs;this._startHideControlsTimer(u||!this.state.buttonsAndInfoHidden,e,s),this._hasConnected=!0}if(t.callUIState!==X.CallUIState.Default&&t.callUIState!==X.CallUIState.Voicemail&&d&&(this.state.isCallCreator&&ae.isOneOnOneConversation(this.state.conversationMri)&&L.default.CallPostMessageService.postOneOnOneCallStartedPartListMessage(this.state.conversationMri,o),this._startParticipantAnimationSuppressionTimeout()),!this.state.isCallParticipantActionsMenuOpened&&(t.buttonsAndInfoHidden!==this.state.buttonsAndInfoHidden||this.state.isMobileScreenReaderEnabled!==t.isMobileScreenReaderEnabled||this.state.useImmersiveMode!==t.useImmersiveMode||this.state.hideCallControlsForActivity!==t.hideCallControlsForActivity)){const e=this._areControlsVisible()||this.state.isMobileScreenReaderEnabled;this._animateShowOrHideControls(e,!0,s),this.setState({hideStatusBarPadding:!Xe.default.keepStatusBarVisible()&&!e}),he.default.clearToolTip()}this.state.isLandscape===t.isLandscape&&this.state.bottomSafeAreaInset===t.bottomSafeAreaInset||this.state.buttonsAndInfoHidden||(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate updating call controls bottom, causeId: "+s),this._callControlsAnimatedTranslateYValue.setValue(this._controlsTranslateY())),this.state.showDialpad&&!t.showDialpad&&this._animateDialpad(!0,s),(this._isIncomingOrOutgoingRing()||this.state.callUIState===X.CallUIState.GoLiveSinglePlayer)&&this.state.buttonsAndInfoHidden&&this._showOrHideControls(!0,s),$t._useMobileControls(this.state.controlsType)||this._areControlsVisible()||this._showOrHideControls(!0,s,{},!0),this.state.conversationMri===t.conversationMri&&this.state.isChatOpen===t.isChatOpen||(this.state.conversationMri!==t.conversationMri&&this.state.isChatOpen&&(je.default.closeConversationInCall(s,this._getContext()),je.default.openConversationInCall(s,this.state.conversationMri,o,this._getContext(),this._toggleChatPanel)),this.state.isChatOpen?N.default.clearOuterThreadAssignment(this.state.reactionsConversationMri,this.state.conversationMri):N.default.assignOuterThread(this.state.reactionsConversationMri,this.state.conversationMri)),this.state.isTranslating!==t.isTranslating&&(this.state.isTranslating?K.default.assignCallId(this.state.reactionsConversationMri,o):(this.state.pstnTranslationEnabled||K.default.clearCallIdAssignment(this.state.reactionsConversationMri),L.default.OngoingCallService.setIsSubtitleHistoryOpen(o,!1))),this._maybeShowOrHideDeviceErrorToast(t.hasMicrophones,t.hasSpeakers,s),this._maybeShowCompositeCallRecordingToast(t.isRecording),this._maybeShowCompositeIncomingVideoDisabledToast(t.isIncomingVideoDisabled,s),this._maybeShowCompositeCallConnectionQualityToast(t.callNetworkQualityPoor,s),this._maybeShowCompositeCameraDeniedToast(),this._maybeShowCompositeTeamsInteropInCallToast(s),this._maybeShowCompositeTogetherModeNoticeInCallToast(s),this._maybeShowCompositeMusicModeNoticeInCallToast(s),this._maybeShowCompositeTranslationInCallToast(s),this._maybeShowCompositePstnTranslationInCallToast(s),this._maybeShowCompositePstnParticipantRingInCallToast(s),this._maybeShowCompositeVideoRestrictedToast(o,s),t.controlsType!==this.state.controlsType&&this.state.controlsType===X.CallControlsType.DesktopMin&&W.default.updateCallTelemetry(o,s,(e=>e.setEnterMinWidth())),this.state.isProvidingVideo!==t.isProvidingVideo&&Z.default.announceVideoState(this.state.isProvidingVideo),this.state.isCallOnHold!==t.isCallOnHold&&(Z.default.announceHoldState(this.state.isCallOnHold),!this.state.isCallOnHold&&this._callControls&&this._callControls.toggleReactionsPickerButton(!1,!1));const p=t.selectedCamera&&t.selectedCamera.position,g=this.state.selectedCamera&&this.state.selectedCamera.position;p!==S.CameraPosition.Unknown&&g!==S.CameraPosition.Unknown&&p!==g&&Z.default.announceCameraDirectionState(g),this.state.callAudioOutputRoute!==l.default.AudioOutputEarpiece&&t.callAudioOutputRoute===l.default.AudioOutputEarpiece&&(this.setState({showSpeakerOnWarning:!0}),r.isUndefined(this._speakerOnWarningTimeout)||Tt.default.clearTimeout(this._speakerOnWarningTimeout),this._speakerOnWarningTimeout=Tt.default.setTimeout((()=>{this._speakerOnWarningTimeout=void 0,this.isComponentMounted()&&this.setState({showSpeakerOnWarning:!1})}),5e3)),this.state.isNavigatingWithKeyboard!==t.isNavigatingWithKeyboard&&this._showOrHideControls(this.state.isNavigatingWithKeyboard,s),this.state.isChatOpen!==t.isChatOpen&&L.default.OngoingCallService.setIsChatSidebarOpen(o,this.state.isChatOpen);const C=this._getCallStageViewRect(c);if(this.state.userCaptionPositionMode!==Rt.CaptionsPositionMode.bottom&&this.state.userCaptionPositionMode!==Rt.CaptionsPositionMode.float||this.state.enableVisitor)this.setState({userCaptionsBottomViewHeight:0});else{const e=this._innerViewStyleHeight(C,c),t=this._getTransciptionBottomViewHeight(e);this.setState({userCaptionsBottomViewHeight:t})}if(this.state.userCaptionPositionMode!==Rt.CaptionsPositionMode.left||this.state.enableVisitor)this.setState({userCaptionsLeftViewWidth:0});else{const e=C.width,t=this._getTransciptionLeftViewWidth(e);this.setState({userCaptionsLeftViewWidth:t})}L.default.InCallBotService.subscribe((()=>{L.default.InCallBotService.getCaptionHistoryOpen(this.props.route.params.callId)?(this._openSubtitleHistory(),this.setState({userCaptionPositionMode:Rt.CaptionsPositionMode.float})):(this._closeSubtitleHistory(),this.setState({userCaptionPositionMode:Fe.default.getCallTranslatorCaptionsPositionMode()||this.state.userCaptionPositionMode}))}),Rt.TriggerKeys.TranslatorHistory)}_getDefaultCaptionPositionMode(e,t,i,a,n){if(t)return Rt.CaptionsPositionMode.float;if(i)return n!==Rt.CaptionsPositionMode.float?a?Rt.CaptionsPositionMode.left:Rt.CaptionsPositionMode.bottom:Rt.CaptionsPositionMode.float;{const t=e.callCaptionsPositionModeDefault?e.callCaptionsPositionModeDefault:Rt.CaptionsPositionMode.float;return n||t}}_lockOrientationForIncomingRing(){De.default.addOrUpdateOrientationLock(this._orientationLockKey,d.DeviceOrientation.Portrait),this.setState({isLandscape:!1})}_exitCall(e,t,i){we.log(Se.LogTraceArea.CallingUI,"_exitCall shouldNavigateBack: "+e+" causeId: "+i),this._onNavigatedAwayFromCall(i);const a=this.state.isPSTNCall&&this.state.knownPSTNContactMri||this.props.route.params.initialConversationMri;je.default.navigateCallComplete(a,e,t,this._getContext(),i)}_maybeShowCompositeCameraDeniedToast(){!$t._useMobileControls(this.state.controlsType)&&this._shouldShowCameraDeniedToast()&&(we.log(Se.LogTraceArea.CallingUI,"CallPanel._maybeShowCompositeCameraDeniedToast, showing toast"),this._hasShownCameraDeniedToast=!0,L.default.CallNavigationHelper.showCameraDeniedToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri}))}_shouldShowCameraDeniedToast(){return!!this.props.route.params.convertedVideoToAudio&&!this._hasShownCameraDeniedToast&&!this.state.hideCameraDeniedToast&&this.state.isCallActive}_maybeShowCompositeCallRecordingToast(e){$t._useMobileControls(this.state.controlsType)||!this.state.isRecording||e||(we.log(Se.LogTraceArea.CallingUI,"CallPanel._maybeShowCallRecordingToast, showing toast"),L.default.CallNavigationHelper.showCallRecorderToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,action:(e,t)=>{t&&this._callControls&&this._callControls.focusCallEndButton()}}))}_maybeShowCompositeVideoRestrictedToast(e,t){$t._useMobileControls(this.state.controlsType)||!this.state.isVideoRestricted||this.state.hideVideoRestrictedToast||(we.log(Se.LogTraceArea.CallingUI,`[CallPanel][_maybeShowCallRecordingToast][${t}] showing video restricted toast callId: ${e}`),L.default.CallNavigationHelper.showVideoRestrictedToast({callId:e,conversationMri:this.state.conversationMri,onDismiss:this._closeVideoRestrictedToast},t))}_maybeShowCompositeIncomingVideoDisabledToast(e,t){$t._useMobileControls(this.state.controlsType)||!this.state.isIncomingVideoDisabled||e||(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowIncomingVideoDisabledToast.  causeId ${t}`),L.default.CallNavigationHelper.showIncomingVideoDisabledToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},t))}_maybeShowCompositeTeamsInteropInCallToast(e){!$t._useMobileControls(this.state.controlsType)&&this._shouldShowTeamsInteropToast()&&(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositeTeamsInteropInCallToast.  causeId ${e}`),this._hasShownTeamsInteropBanner=!0,L.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:le.ToastType.TeamsInterop,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},e))}_maybeShowCompositeTogetherModeNoticeInCallToast(e){!$t._useMobileControls(this.state.controlsType)&&this._shouldShowTogetherModeNoticeToast()&&(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositeTogetherModeNoticeInCallToast.  causeId ${e}`),this._hasShownTogetherModeNoticeBannerForCallId=!0,Ne.default.setTogetherModeNoticePresentedForCallId(this.props.route.params.callId),L.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:le.ToastType.TogetherModeNotice,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},e))}_maybeShowCompositeMusicModeNoticeInCallToast(e){!$t._useMobileControls(this.state.controlsType)&&this._shouldShowMusicModeNoticeToast()?(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositeMusicModeNoticeInCallToast.  causeId ${e}`),this._hasShownMusicModeNoticeBannerForCallId=!0,Ne.default.setMusicModeNoticePresentedForCallId(this.props.route.params.callId),L.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:le.ToastType.MusicModeEnabled,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},e)):!this.state.enableMusicMode&&this._hasShownMusicModeNoticeBannerForCallId&&this._closeMusicModeNoticeToast()}_maybeShowCompositePstnTranslationInCallToast(e){!$t._useMobileControls(this.state.controlsType)&&this.state.pstnTranslationEnabled&&!this.state.pstnTranslationBannerBeenDismissed&&T.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.showToast&&(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositePstnTranslationInCallToast.  causeId ${e}`),L.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:le.ToastType.PstnTranslation,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,onDismiss:this._onPstnTranslationNoticeDismiss},e))}_maybeShowCompositePstnParticipantRingInCallToast(e){!$t._useMobileControls(this.state.controlsType)&&!this.state.pstnParticipantRingBeenDismissed&&this.state.countInactivePstnParticipantsInCall>0&&T.default.getS4LCMCFeaturesNoSubscription().enableParticipantsButtonPstnMobile&&(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositePstnParticipantRingInCallToast. causeId ${e}`),L.default.CallNavigationHelper.showGeneralPurposeInCallToast({toastType:le.ToastType.PstnParticipantRing,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,onDismiss:this._onPstnParticipantRingNoticeDismiss},e))}_shouldShowTeamsInteropToast(){return ae.isS4BBridgeMri(this.state.conversationMri)&&!this._hasShownTeamsInteropBanner&&!this.state.hideTeamsInteropToast&&this.state.isCallActive}_shouldShowVideoRestrictedToast(){return this.state.isVideoRestricted&&!this.state.hideVideoRestrictedToast&&this.state.isCallActive}_shouldShowTogetherModeNoticeToast(){return this.state.isPossiblyNotConnectedAudienceBotInCall&&!this._hasShownTogetherModeNoticeBannerForCallId&&this.state.hideTogetherModeNoticeToastForCallId!==this.props.route.params.callId&&this.state.isCallActive}_shouldShowMusicModeNoticeToast(){return this.state.enableMusicMode&&!this._hasShownMusicModeNoticeBannerForCallId&&this.state.hideMusicModeNoticeToastForCallId!==this.props.route.params.callId&&this.state.isCallActive}_maybeShowCompositeTranslationInCallToast(e){$t._useMobileControls(this.state.controlsType)||!this.state.isTranslated||this.state.translationBannerBeenDismissed||(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCompositeTranslationInCallToast.  causeId ${e}`),L.default.CallNavigationHelper.showTranslationInCallToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},e))}_maybeShowCompositeCallConnectionQualityToast(e,t){$t._useMobileControls(this.state.controlsType)||!this.state.callNetworkQualityPoor||e||(we.log(Se.LogTraceArea.CallingUI,`CallPanel._maybeShowCallConnectionQualityToast.  causeId ${t}`),L.default.CallNavigationHelper.showCallConnectionQualityToast({callId:this.props.route.params.callId,conversationMri:this.state.conversationMri},t))}_maybeShowOrHideDeviceErrorToast(e,t,i){this.state.callUIState!==X.CallUIState.Default&&this.state.callUIState!==X.CallUIState.Voicemail||(this.state.hasMicrophones||!e&&this._hasShownNoMicrophoneConnectedToast?this.state.hasSpeakers||!this.state.isAudioOutputSelectionSupported||!t&&this._hasShownNoSpeakerConnectedToast||(this._showDeviceErrorToast(X.DeviceStatusToastType.SpeakerDisconnected,i),this._hasShownNoSpeakerConnectedToast||(this._hasShownNoSpeakerConnectedToast=!0)):(this._showDeviceErrorToast(X.DeviceStatusToastType.MicrophoneDisconnected,i),this._hasShownNoMicrophoneConnectedToast||(this._hasShownNoMicrophoneConnectedToast=!0))),this.state.hasSpeakers&&!t&&this._hideDeviceErrorToastOfType(X.DeviceStatusToastType.SpeakerDisconnected),this.state.hasMicrophones&&!e&&this._hideDeviceErrorToastOfType(X.DeviceStatusToastType.MicrophoneDisconnected)}_hideAllDeviceErrorToasts(){r.each(this._deviceErrorToasts,(e=>L.default.CallNavigationHelper.hideToast(e))),this._deviceErrorToasts={}}_hideDeviceErrorToastOfType(e){this._deviceErrorToasts[e]&&(L.default.CallNavigationHelper.hideToast(this._deviceErrorToasts[e]),delete this._deviceErrorToasts[e])}_showDeviceErrorToast(e,t,i,a){const n=Z.default.getToastInformation(e,i,a,(i=>{W.default.trackInCallUFD(this.props.route.params.callId,e,i),W.default.updateCallTelemetry(this.props.route.params.callId,t,(e=>e.ufdDisplayed(i)))}));if(n){this._hideDeviceErrorToastOfType(e);const t=L.default.CallNavigationHelper.showNotificationToast(n);t&&(this._deviceErrorToasts[e]=t)}}_showDeviceChangeToast(e,t,i){const a=L.default.DeviceStore.isSelectedCompositeAudioDevice(e);a&&e.push(a),r.isEmpty(r.filter(e,(e=>e.kind!==S.DeviceType.Camera)))||(we.log(Se.LogTraceArea.CallingUI,"_showDeviceChangeToast: remove composite audio device toast if presented"),this._hideDeviceErrorToastOfType(X.DeviceStatusToastType.CompositeAudioAvailable)),e.forEach((e=>{switch(e.kind){case S.DeviceType.Camera:this._showDeviceErrorToast(X.DeviceStatusToastType.CameraChanged,i,{deviceName:e.label});break;case S.DeviceType.Microphone:a||this._showDeviceErrorToast(X.DeviceStatusToastType.MicrophoneChanged,i,{deviceName:e.label});break;case S.DeviceType.Speaker:a||this._showDeviceErrorToast(X.DeviceStatusToastType.SpeakerChanged,i,{deviceName:e.label});break;case S.DeviceType.CompositeAudioDevice:if(a)this._hideDeviceErrorToastOfType(X.DeviceStatusToastType.MicrophoneChanged),this._hideDeviceErrorToastOfType(X.DeviceStatusToastType.SpeakerChanged),this._showDeviceErrorToast(X.DeviceStatusToastType.CompositeAudioAvailable,i,{deviceName:a.label});else if(!t){const t=e,a=()=>this._hideDeviceErrorToastOfType(X.DeviceStatusToastType.CompositeAudioAvailable),n=[{labelKey:"StartCallUtils.ConfirmButtonText",callback:()=>{L.default.DeviceStore.choosePreferredDevices({microphone:t.microphoneId,speaker:t.speakerId},i),a()}},{labelKey:"StartCallUtils.CancelButtonText",callback:a}];this._showDeviceErrorToast(X.DeviceStatusToastType.CompositeAudioAvailable,i,{deviceName:t.label},n)}}}))}_navigateToChat(e,t,i){we.log(Se.LogTraceArea.CallingUI,"_navigateToChat, causeId: "+i),this.state.isUsingStackNavigationContext?(we.log(Se.LogTraceArea.CallingUI,"_navigateToChat, exit to conversation, causeId: "+i),W.default.updateCallTelemetry(this.props.route.params.callId,i,(e=>e.chatOpened())),this._exitCall(e,t,i)):this._toggleChatPanel(i)}_toggleLeftPanelForAction(e,t,i){we.log(Se.LogTraceArea.CallingUI,"_toggleLeftPanelForAction causeId: "+i);e().completeAction()}_closeRightPanel(e,t){we.log(Se.LogTraceArea.CallingUI,"_closeRightPanel causeId: "+t),e()}_animateShowOrHideControls(e,t,i){const a=e?1:0,n=e?0:-1e3,o=e?0:1,s=this._isIncomingOrOutgoingRing()?0:1-o,r=$t._useMobileControls(this.state.controlsType);let l,c;if(r||e||r&&!this.state.hideCallControlsForActivity&&!this.state.useImmersiveMode?(l=!0,c=this._controlsTranslateY()):(l=!1,c=r?55+X.AudioNotificationOffset:X.DesktopCallControlsHeight+X.AudioNotificationOffset),we.log(Se.LogTraceArea.CallingUI,"_animateShowOrHideControls showControls:"+e+" adjustedShowControls: "+l+" hideCallControlsForActivity "+this.state.hideCallControlsForActivity+" useImmersiveMode: "+this.state.useImmersiveMode+" animated: "+t+" causeId: "+i),r||this._newCompositeReactionsAnimatedOpacityValue.setValue(e?1:0),e&&(this._callHeaderAnimatedTranslateYValue.setValue(n),this._callControlsAnimatedTranslateYValue.setValue(c)),this._controlsAnimation&&this._controlsAnimation.stop(),t){this._controlsAnimation=g.Animated.parallel([p.timing.easeOut({value:this._callHeaderAnimatedOpacityValue,toValue:a}),p.timing.easeOut({value:this._callControlsAnimatedOpacityValue,toValue:s}),p.timing.easeOut({value:this._topBannerAnimatedOpacityValue,toValue:o}),p.timing.easeOut({value:this._callStageOverlayOpacityValue,toValue:s}),p.timing.easeOut({value:this._callParticipantAccessoryOpacityValue,toValue:o}),p.timing.easeOut({value:this._callParticipantTooltipOpacityValue,toValue:s})]),this._controlsAnimation.start((t=>{this._maybeCompleteRenderCallControlsScenario(),t.finished?(delete this._controlsAnimation,this._callHeaderAnimatedTranslateYValue.setValue(n),this._callControlsAnimatedTranslateYValue.setValue(c)):(we.log(Se.LogTraceArea.CallingUI,"componentDidUpdate buttonsAndInfoHidden animation did not complete, causeId "+i),e===this._areControlsVisible()&&this._animateShowOrHideControls(!this.state.buttonsAndInfoHidden,!1,i))}));const t=this._renderCallControlsScenario;t&&t.markStepCompleted("StartedAnimation")}else this._topBannerAnimatedOpacityValue.setValue(o),this._callHeaderAnimatedOpacityValue.setValue(a),this._callHeaderAnimatedTranslateYValue.setValue(n),this._callControlsAnimatedTranslateYValue.setValue(c),this._callParticipantAccessoryOpacityValue.setValue(o),this._callParticipantTooltipOpacityValue.setValue(s),this._callStageOverlayOpacityValue.setValue(s),this._maybeCompleteRenderCallControlsScenario()}_maybeCompleteRenderCallControlsScenario(){const e=this._renderCallControlsScenario;e&&(e.markStepCompleted("MadeOpaque"),this._renderCallControlsScenario=void 0,r.defer((()=>{e.markStepCompleted("backOnJSThread"),e.finish()})))}_areControlsVisible(){return!this.state.buttonsAndInfoHidden}_coachMarksBeingShown(){return ne.default.isCoachMarkBeingShown({areaType:oe.CoachMarkAreaType.CallPanel})}_clearHideControlsTimer(){this._hideControlsTimer&&(Tt.default.clearTimeout(this._hideControlsTimer),this._hideControlsTimer=void 0)}_startHideControlsTimer(e,t,i){this._isIncomingOrOutgoingRing()||!this.isComponentMounted()||this.state.isCallParticipantActionsMenuOpened||(this._clearHideControlsTimer(),e&&!this.state.buttonsAndInfoHidden&&(this._hideControlsTimer=Tt.default.setTimeout((()=>{this.isComponentMounted()&&!this._isIncomingOrOutgoingRing()&&this._showOrHideControls(!1,i)}),t)))}_renderTranscriptionNotificationsMobileCallPanel(e,t){return(0,a.jsx)(g.View,Object.assign({style:[null==t?void 0:t.style,yt.default.overflowVisible]},{children:(0,a.jsx)(Dt.default,{callId:this.props.route.params.callId,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,callStageV2:this.state.isNewCallScreen,useLightTheme:this.state.isLightTheme,rootViewId:this._getRootViewId(),paddingTop:0,maxHeight:e.height,headerHeight:null==t?void 0:t.headerHeight})}))}_renderTranscriptionNotifications(e){const t=e.width,i=q.default.getHorizontalPadding(t,this.state.isUsingStackNavigationContext,this.state.userCaptionPositionMode,this.state.pstnTranslationEnabled),n=this._getTranscriptionLeftViewTop(),o=this._getTranscriptionBottomPadding()+(this.state.isUsingStackNavigationContext?0:X.DesktopCallControlsHeight),s=(this.state.isUsingStackNavigationContext?this._getTopInset():0)+10,r=e.height-n-o-s,l=g.Styles.createViewStyle({position:"absolute",left:i,right:i,top:n},!1);return(0,a.jsx)(g.View,Object.assign({style:[l,yt.default.overflowVisible]},{children:(0,a.jsx)(Dt.default,{callId:this.props.route.params.callId,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,callStageV2:this.state.isNewCallScreen,useLightTheme:this.state.isLightTheme,rootViewId:this._getRootViewId(),paddingTop:s,maxHeight:r})}))}_renderTranscriptionViewMobileCallPanel(e,t){if(!("float"===(null==t?void 0:t.position)&&this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.float||"bottom"===(null==t?void 0:t.position)&&this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.bottom||"left"===(null==t?void 0:t.position)&&this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.left)||this.state.isSubtitlesPanelOpen||!this._canShowTranscription())return;const i=null==t?void 0:t.paddingTop;let n=(null==t?void 0:t.paddingBottom)||0;this.state.pstnTranslationEnabled||"float"!==(null==t?void 0:t.position)||(n+=q.SettingsBarSafezone);let o=null==t?void 0:t.style;if(this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.bottom){const t=this._getTransciptionBottomViewHeight(e.height,!0);o=g.Styles.combine([o,g.Styles.createViewStyle({height:t},!1)])}else if(this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.left){const t=this._getTransciptionLeftViewWidth(e.width);o=g.Styles.combine([o,g.Styles.createViewStyle({width:t},!1)])}else if(this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.float){const t=this.state.pstnTranslationEnabled?e.height:this._getTransciptionBottomViewHeight(e.height);o=g.Styles.combine([o,g.Styles.createViewStyle({height:t},!1)])}return(0,a.jsx)(q.default,{style:o,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,reactionsMri:this.state.reactionsConversationMri,topPadding:i,bottomPadding:n,showControls:!this.state.buttonsAndInfoHidden,callStageV2:this.state.isNewCallScreen,useLightTheme:!!this.state.pstnTranslationEnabled&&this.state.isLightTheme,captionPositionMode:this.state.userCaptionPositionMode,callUIState:this.state.callUIState,isPstnCall:this.state.isPSTNCall,rootViewId:this._getRootViewId(),onStageTap:this._onStageTapped},"callTranscriptionView")}_renderTranscriptionView(e){if(this.state.isSubtitlesPanelOpen||!this._canShowTranscription())return;const t=this._transcriptionLayout(false,$t._useMobileControls(this.state.controlsType)),i=$.default.getTranscriptionLayoutRects(e,t),n=this._getTranscriptionBottomPadding();let o=this.state.isUsingStackNavigationContext?this._getTopInset():0;const s=this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.left?this._getTransciptionLeftViewWidth(e.width):e.width,r=q.default.getHorizontalPadding(s,this.state.isUsingStackNavigationContext,this.state.userCaptionPositionMode,this.state.pstnTranslationEnabled),l=2*r;let c=g.Styles.createViewStyle({position:"absolute",left:i.isHorizontal?r:i.stage.width,right:r,top:i.isHorizontal?i.stage.height:i.subtitles.y,bottom:0},!1);if(this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.float)o=10,c=g.Styles.createViewStyle({position:"absolute",height:this.state.userCaptionsBottomViewHeight,left:r,right:r,bottom:this.state.isUsingStackNavigationContext?0:X.DesktopCallControlsHeight,paddingTop:o},!1);else if(this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.bottom)o=10,c=g.Styles.createViewStyle({position:"absolute",left:r,right:r,height:this.state.userCaptionsBottomViewHeight,bottom:this.state.isUsingStackNavigationContext?0:X.DesktopCallControlsHeight,paddingTop:o},!1);else if(this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.left){const t=this._getTransciptionLeftViewWidth(e.width);o=10,c=g.Styles.createViewStyle({position:"absolute",left:r,width:t-l,top:this._getTranscriptionLeftViewTop(),bottom:0,paddingTop:o},!1)}return(0,a.jsx)(q.default,{style:c,callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,reactionsMri:this.state.reactionsConversationMri,topPadding:o,bottomPadding:n,showControls:!this.state.buttonsAndInfoHidden,callStageV2:this.state.isNewCallScreen,useLightTheme:this.state.isLightTheme,captionPositionMode:this.state.userCaptionPositionMode,callUIState:this.state.callUIState,isPstnCall:this.state.isPSTNCall,rootViewId:this._getRootViewId(),onStageTap:this._onStageTapped},"callTranscriptionView")}_renderTransientView(){let e;const{callId:t}=this.props.route.params;if(this.state.isCallOnHold){const i=L.default.OngoingCallService.getOnHoldForInterruption(t)?()=>{L.default.CallingStore.isCallKitCall(t).then((e=>{e?this._requestResumeCall():this._requestEndInterruption}))}:void 0;e=(0,a.jsx)(Q.default,{type:Q.CallTransientStateViewType.Hold,header:Ae.getString("CallPanel.OnHoldHeader"),onPress:i,ignorePointerEvents:!0},"callTransientStateView")}else this.state.callReconnectionState===O.NetworkConnectionState.Connecting?e=(0,a.jsx)(Q.default,{type:Q.CallTransientStateViewType.Reconnect,header:Ae.getString("CallPanel.ReconnectingHeader"),body:T.default.getS4LCMCFeaturesNoSubscription().showSimpleReconnectingLostMessage?"":Ae.getString("CallPanel.ReconnectingBody"),blockPointerEvents:!0},"callTransientStateView"):this.state.callReconnectionState===O.NetworkConnectionState.LostConnection&&(e=(0,a.jsx)(Q.default,{type:Q.CallTransientStateViewType.Reconnect,header:Ae.getString("CallPanel.NoNetworkHeader"),body:T.default.getS4LCMCFeaturesNoSubscription().showSimpleReconnectingLostMessage?"":Ae.getString("CallPanel.NoNetworkBody"),blockPointerEvents:!0},"callTransientStateView"));return e}_renderMobileTopBanner(e,t){var i;const{callId:n}=this.props.route.params;if(!$t._useMobileControls(this.state.controlsType))return;let o,s,l,c,d,u,h,p,C,S=this.state.hideStatusBarPadding?0:this.state.topSafeAreaHeight;if(this._shouldShowCameraDeniedToast()&&(s=(0,a.jsx)(ot.default,{closeToast:this._closeCameraDeniedToast,onDesiredHeightChanged:this._onCameraDeniedToastHeightChanged,topInset:S,style:null==t?void 0:t.bannerStyle}),S=0),this.state.isRecording&&(o=(0,a.jsx)(nt.default,{callId:n,conversationMri:this.state.conversationMri,topInset:S,viewWidth:e.width,onDesiredHeightChanged:this._onRecordingBannerHeightChanged,onPress:this._onCallRecordingPress,style:null==t?void 0:t.bannerStyle}),S=0),this.state.isNdiBeingUsed&&(l=(0,a.jsx)(at.LocalStackNavCallMediaCapturerToast,{topInset:S,viewWidth:e.width,onDesiredHeightChanged:this._onNdiUsedBannerHeightChanged,style:null==t?void 0:t.bannerStyle}),S=0),this.state.isCallMediaBeingCaptured&&!this.state.isCallOnHold){const i=this.state.remoteParticipantsThatAreCapturingCallMedia[0];c=(0,a.jsx)(at.RemoteStackNavCallMediaCapturerToast,{callId:n,conversationMri:this.state.conversationMri,initiatorMri:i,topInset:S,viewWidth:e.width,onDesiredHeightChanged:this._onCallMediaCapturedBannerHeightChanged,style:null==t?void 0:t.bannerStyle}),S=0}this.state.isIncomingVideoDisabled&&!this.state.isCallOnHold&&(d=(0,a.jsx)(rt.default,{callId:n,conversationMri:this.state.conversationMri,topInset:S,onDesiredHeightChanged:this._onIncomingVideoDisabledBannerHeightChanged,style:null==t?void 0:t.bannerStyle}),S=0),this._showCallConnectionQualityToast(this.state)&&(u=(0,a.jsx)(it.default,{callId:n,conversationMri:this.state.conversationMri,topInset:S,onDesiredHeightChanged:this._onCallConnectionQualityBannerHeightChanged,style:null==t?void 0:t.bannerStyle}),S=0),this._showMobileServerMutedToast(this.state)&&(h=(0,a.jsx)(ct.default,{callId:n,conversationMri:this.state.conversationMri,topInset:S,onDesiredHeightChanged:this._onServerMuteNotificationBannerHeightChanged,style:null==t?void 0:t.bannerStyle}),S=0),this.state.isMobileScreenShareActive&&!this.state.isCallOnHold&&(p=(0,a.jsx)(lt.default,{callId:n,conversationMri:this.state.conversationMri,isEncryptedCall:this.state.isEncryptedCall,isPSTNCall:this.state.isPSTNCall,topInset:S,onDesiredHeightChanged:this._onMobileScreenShareBannerHeightChanged,style:null==t?void 0:t.bannerStyle}),S=0),this._shouldShowTeamsInteropToast()&&(C=(0,a.jsx)(dt.default,{closeToast:this._closeTeamsInteropToast,onDesiredHeightChanged:this._onMobileTeamsInteropBannerHeightChanged,topInset:S,conversationMri:this.state.conversationMri,style:null==t?void 0:t.bannerStyle}),S=0);const m=[];let y;if(this._shouldShowTogetherModeNoticeToast()&&(m.push((0,a.jsx)(st.default,{type:le.ToastType.TogetherModeNotice,closeToast:this._closeTogetherModeNoticeToast,onDesiredHeightChanged:this._onMobileTogetherModeNoticeBannerHeightChanged,topInset:S,conversationMri:this.state.conversationMri,style:null==t?void 0:t.bannerStyle})),S=0),this.state.isTranslated&&!this.state.translationBannerBeenDismissed&&this.state.isCallActive&&(y=(0,a.jsx)(ut.default,{callId:n,onDesiredHeightChanged:this._onMobileTranslationBannerHeightChanged,topInset:S,conversationMri:this.state.conversationMri,style:null==t?void 0:t.bannerStyle}),S=0),this._shouldShowMusicModeNoticeToast()&&(m.push((0,a.jsx)(st.default,{type:le.ToastType.MusicModeEnabled,closeToast:this._closeMusicModeNoticeToast,onDesiredHeightChanged:this._onMobileMusicModeNoticeBannerHeightChanged,topInset:S,conversationMri:this.state.conversationMri,style:null==t?void 0:t.bannerStyle})),S=0),this.state.pstnTranslationEnabled&&!this.state.pstnTranslationBannerBeenDismissed&&T.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.showToast&&(m.push((0,a.jsx)(st.default,{type:le.ToastType.PstnTranslation,closeToast:this._onPstnTranslationNoticeDismiss,onDesiredHeightChanged:this._onPstnTranslationNoticeBannerHeightChanged,topInset:S,conversationMri:this.state.conversationMri,style:null==t?void 0:t.bannerStyle})),S=0),!this.state.pstnParticipantRingBeenDismissed&&this.state.countInactivePstnParticipantsInCall>0&&T.default.getS4LCMCFeaturesNoSubscription().enableParticipantsButtonPstnMobile&&(m.push((0,a.jsx)(st.default,{type:le.ToastType.PstnParticipantRing,closeToast:this._onPstnParticipantRingNoticeDismiss,onDesiredHeightChanged:this._onPstnParticipantRingNoticeBannerHeightChanged,topInset:S,conversationMri:this.state.conversationMri,callId:this.props.route.params.callId,style:null==t?void 0:t.bannerStyle})),S=0),this._shouldShowVideoRestrictedToast()&&(m.push((0,a.jsx)(st.default,{type:le.ToastType.VideoRestricted,closeToast:this._closeVideoRestrictedToast,onDesiredHeightChanged:this._onVideoRestrictedBannerHeightChanged,topInset:S,conversationMri:this.state.conversationMri,style:null==t?void 0:t.bannerStyle})),S=0),o||l||c||d||s||h||u||p||y||C||!r.isEmpty(m)){const e=null!==(i=null==t?void 0:t.style)&&void 0!==i?i:Wt.topBanner;return(0,a.jsxs)(g.Animated.View,Object.assign({style:e,ignorePointerEvents:!0},{children:[o,d,h,l,c,u,s,p,y,C,m]}))}}_renderReactionsBar(e){if(!this.state.shouldShowReactions)return;const t=[Wt.reactionsBar,this._newCompositeReactionsAnimatedOpacityStyle,yt.default.floatingStyle];return(0,a.jsx)(g.Animated.View,Object.assign({style:t,ignorePointerEvents:!0},{children:(0,a.jsx)(E.default,{ref:this._onReactionsBarRef,style:Wt.reactionsBarCompositeInner,ignorePointerEvents:!0,conversationMri:this.state.conversationMri,reactionsConversationId:this.state.reactionsConversationMri,callId:this.props.route.params.callId,minDrawerHeight:360,controlsType:this.state.controlsType,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,viewDimensions:e,bottomSafeAreaInset:this.state.isLandscape?0:this.state.bottomSafeAreaInset,audioNotificationOffset:X.AudioNotificationOffset,onDesiredHeightChanged:this.state.isUsingStackNavigationContext?this._onReactionsBarDesiredHeight:void 0,onReactionsDrawerOpen:this._onReactionsDrawerOpen,useDesktopCallControls:!$t._useMobileControls(this.state.controlsType)})}),"reactionsBar")}_renderReactionsPanel(e,t){if(!this.state.shouldShowReactions)return;const i=$t._useMobileControls(this.state.controlsType),n=this.state.isUsingStackNavigationContext&&i?void 0:85,o=this.state.isUsingStackNavigationContext&&i?void 0:70;return(0,a.jsx)(g.Animated.View,Object.assign({style:Wt.fullScreenView,ignorePointerEvents:!0},{children:(0,a.jsx)($e.default,{callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,bottomStyle:this._reactionsPanelAnimatedBottomStyle,reactionsConversationMri:this.state.reactionsConversationMri,isDesktop:!this.state.isUsingStackNavigationContext,desktopBottomMargin:n,desktopSideMargin:o,sizePhotosToFit:!this.state.isUsingStackNavigationContext&&i,photoTapDelay:this.state.isUsingStackNavigationContext||i?0:500,onPhotoTap:this._onOpenGallery,areMobileCallControlsVisible:i&&this._areControlsVisible(),style:null==t?void 0:t.style})}),"reactionsPanel")}_getCallStageViewRect(e){const t=this._getTanscriptionRects(e);return t&&this._canShowTranscription()&&!e&&this._canShowTranscriptionPanel(t),this.state.panelLayout}_innerViewStyleHeight(e,t){return this.state.isNewCallScreen?t?e.height-(this.state.shouldShowTray?X.DesktopTopTrayHeight*this.state.traySizeMultiplier:0):e.height-X.DesktopCallControlsHeight-X.DesktopNewHeaderHeight-(this.state.shouldShowTray?X.DesktopTopTrayHeight:0):t?e.height:e.height-X.DesktopCallControlsHeight}_getTransciptionBottomViewHeight(e,t=!1){const i=this.state.isUsingStackNavigationContext?this._getTopInset():0,a=t?0:i;if(this.state.pstnTranslationEnabled){if(this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.float)return e-a}else if(this.state.isTranslating||this.state.skypeTranslationPaused){let t=0;this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.bottom?t=T.default.getS4LCMCFeaturesNoSubscription().callCaptionsBottomPanel.desktopSizePercentage:this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.float&&(t=T.default.getS4LCMCFeaturesNoSubscription().callCaptionsFloatPanel.desktopSizePercentage);return Math.max(X.CallTranscriptionBottomViewMinHeight,e*t)-a}return 0}_getTransciptionLeftViewWidth(e){if((this.state.isTranslating||this.state.skypeTranslationPaused)&&this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.left){const t=T.default.getS4LCMCFeaturesNoSubscription().callCaptionsBottomPanel.desktopSizePercentage;return Math.max(X.CallTranscriptionLeftViewMinWidth,e*t)}return 0}_getCallStageHeight(e,t){const i=this._innerViewStyleHeight(e,t);if(this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.bottom){return i-(this.state.userCaptionsBottomViewHeight||0)}return i}_getCallStageWidth(e){return e.width-(this.state.userCaptionsLeftViewWidth||0)}_getCallStageLeft(){return this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.left&&this.state.userCaptionsLeftViewWidth||0}_getCallStageTop(){return $t._useMobileControls(this.state.controlsType)?X.MobileNewHeaderHeight+(this.state.shouldShowTray?X.DesktopTopTrayHeight*this.state.traySizeMultiplier:0):X.DesktopNewHeaderHeight+(this.state.shouldShowTray?X.DesktopTopTrayHeight:0)}_getTranscriptionLeftViewTop(){return this.state.isNewCallScreen?this._getCallStageTop():this.state.isUsingStackNavigationContext?this._areControlsVisible()?this.state.isUsingStackNavigationContext?X.CallPanelHeaderHeight.mobile:X.CallPanelHeaderHeight.window:0:X.DesktopTopTrayHeight}_renderTray(e,t){const i=(null==t?void 0:t.style)?g.Styles.createViewStyle(t.style,!1):void 0;return this.state.shouldShowTray?(0,a.jsx)(It.CallTrayView,{conversationMri:this.state.conversationMri,callId:this.props.route.params.callId,callParticipantTooltipStyle:this._callParticipantNameTooltipStyle,hideNameTag:this.state.callUIState===X.CallUIState.GoLiveSinglePlayer,onCallParticipantContextMenuOpened:this._callParticipantActionsMenuOpened,onCallParticipantContextMenuDismissed:this._callParticipantActionsMenuClosed,isOneOnOneConversation:this.state.isOneOnOneConversation,disableReactions:this.state.isEncryptedCall,reactionsConversationId:this.state.reactionsConversationMri,onTextReactionPressed:this._navigateToChatNotBack,viewRect:e,onOverflowButtonPress:this._onShowParticipants,stageMode:this.state.stageLayoutMode,useLightTheme:this.state.isLightTheme,useMobileControls:$t._useMobileControls(this.state.controlsType),isLandscape:this.state.isLandscape,style:i,onTrayTap:this._onStageTapped,traySizeMultiplier:(null==t?void 0:t.traySizeMultiplier)||this.state.traySizeMultiplier,showTrayVertically:null==t?void 0:t.showTrayVertically,showCompactReactions:null==t?void 0:t.showCompactReactions,participantsAccessoryPosition:null==t?void 0:t.participantsAccessoryPosition,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper},"callTrayView"):void 0}_renderCallStage(e,t){var i;const{callId:n}=this.props.route.params,o=$t._useMobileControls(this.state.controlsType),s=[Wt.fullScreenView],r=this.state.mobileSubtitlesRightPanelEnabled?e:(null===(i=this._getTanscriptionRects(o))||void 0===i?void 0:i.stage)||e;if(this.state.isNewCallScreen){const e=this._getCallStageTop();s.push(g.Styles.createViewStyle({top:e},!1))}const c=g.Styles.createViewStyle({left:this._getCallStageLeft(),width:this._getCallStageWidth(r),height:this._getCallStageHeight(r,o)},!1);s.push(c),(null==t?void 0:t.style)&&s.push(g.Styles.createViewStyle(t.style,!1));let d=this.state.skipRenderingParticipants||this.state.exitingCall?X.CallStageViewMode.None:this.state.callUIState!==X.CallUIState.Default?X.CallStageViewMode.StageOnly:X.CallStageViewMode.StageAndRibbon;this.state.callUIState===X.CallUIState.GoLiveSinglePlayer&&(d=X.CallStageViewMode.StageAndRibbon);const u=!(this.state.isInCallGalleryOpenOnMobile||this.state.isInCallSubtitleHistoryModeOnMobile);let h=r.width-(this.state.isDesktopMin?60:this.state.titleWidth);this.state.buttonsAndInfoHidden&&!o&&(h=r.width-20),this.state.isUsingStackNavigationContext&&this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.left&&(h-=this.state.userCaptionsLeftViewWidth||0);const p=this._getTopInset(),C=this._isIncomingOrOutgoingRing()&&!this.state.isProvidingVideo;return this.state.isNewCallScreen?(0,a.jsx)(z.CallStageViewV2,{style:s,conversationMri:this.state.conversationMri,callId:n,viewRect:r,hideNameTag:this.state.callUIState===X.CallUIState.GoLiveSinglePlayer||this.state.pstnTranslationEnabled,onCallParticipantContextMenuOpened:this._callParticipantActionsMenuOpened,onCallParticipantContextMenuDismissed:this._callParticipantActionsMenuClosed,isOneOnOneConversation:this.state.isOneOnOneConversation,disableReactions:this.state.isEncryptedCall,reactionsConversationId:this.state.reactionsConversationMri,onTextReactionPressed:this._navigateToChatNotBack,isLandscape:this.state.isLandscape,stageLayoutMode:this.state.stageLayoutMode,useLightTheme:this.state.isLightTheme,hideLocalVideo:(null==t?void 0:t.hideLocalVideo)||this.state.pstnTranslationEnabled||C,hideParticipantBackground:this.state.pstnTranslationEnabled,hideParticipantIcon:this.state.pstnTranslationEnabled||C,onStageTap:this._onStageTapped,isCompactView:$t._useMobileControls(this.state.controlsType),isVideoFullScreenMode:this.state.buttonsAndInfoHidden,participantsAccessoryPosition:null==t?void 0:t.participantsAccessoryPosition,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,forceVideoToCrop:null==t?void 0:t.forceVideoToCrop},"callStageView"):(0,a.jsx)(H.default,{style:s,conversationMri:this.state.conversationMri,isEncryptedCall:this.state.isEncryptedCall,isPSTNCall:this.state.isPSTNCall,callId:n,disableReactions:this.state.isEncryptedCall,viewRect:r,availableRibbonWidth:h,callControlsType:this.state.controlsType,callParticipantOpacityStyle:this._callParticipantAccessoryOpacityStyle,callParticipantTooltipStyle:this._callParticipantNameTooltipStyle,callStageOverlayOpacityStyle:this._callStageOverlayOpacityStyle,callHeaderOpacityStyle:this._callHeaderAnimatedStyle,reactionsConversationId:this.state.reactionsConversationMri,baseStageMode:d,useMobileControls:o,isLandscape:this.state.isLandscape,hideFullscreenIcon:this._isIncomingOrOutgoingRing(),layoutAnimationEnabled:!this.state.suppressParticipantAnimation,callPanelHeaderLayout:this.state.callPanelHeaderLayout,showRibbonExtras:!o&&!this.state.buttonsAndInfoHidden,isRoutedToEarpiece:this.state.callAudioOutputRoute===l.default.AudioOutputEarpiece,topInset:p,isVideoTarget:u,isDesktopMin:this.state.isDesktopMinCallRibbon,onStageTap:this._onStageTapped,onDragChange:this._onParticipantDragChange,onStageChange:this._onStageChange,onRemainderViewPressed:this._onShowOrHideRoster,onAddToCallPressed:this._onAddToCallPressed,onCallPanelHeaderLayoutChange:o?void 0:this._onCallPanelHeaderLayoutChange,onTextReactionPressed:this._navigateToChatNotBack,onUseImmersiveModeChange:this._onUseImmersiveModeChange,isIncomingOrOutgoingRing:this._isIncomingOrOutgoingRing(),onParticipantViewTapped:this._onToggleLocalVideoSource,showFullScreenOptionInRibbonSettings:this.state.showFullScreenOptionInRibbonSettings,hideNameTag:this.state.callUIState===X.CallUIState.GoLiveSinglePlayer,onCallParticipantContextMenuOpened:this._callParticipantActionsMenuOpened,onCallParticipantContextMenuDismissed:this._callParticipantActionsMenuClosed,onVideoPreviewFloating:Y.CallingCapabilities.floatableResizableVideoPreviewSupported()?this._onVideoPreviewFloating:void 0,enableFloatableResizableVideoPreview:Y.CallingCapabilities.floatableResizableVideoPreviewSupported(),containerOffsetX:this._currentLeftPanelWidth(),areCallControlsVisible:!this.state.buttonsAndInfoHidden,enableNewCallScreen:this.state.isNewCallScreen,showParticipantsButton:!0,stageLayoutMode:this.state.stageLayoutMode,isPstnTranslationEnabled:this.state.pstnTranslationEnabled},"callStageView")}_shouldShowParticipantsButtonInCallControls(){return this.state.isNewCallScreen||this.state.enableParticipantsButtonInCallControls||Z.default.isInPresentationMode(this.state.stageLayoutMode)}_renderFloatingVideoPreview(){return!this.state.isNewCallScreen&&this.state.shouldRenderFloatingVideoPreview&&this.state.floatingVideoPreviewView?this.state.floatingVideoPreviewView:void 0}_renderCallingAnimation(e,{top:t,bottom:i}){if(!this._isIncomingOrOutgoingRing()||this.state.isProvidingVideo||!e.width||!e.height)return;const n=[Wt.callingAnimationContainer,g.Styles.createViewStyle({top:t,bottom:i},!1)];return(0,a.jsx)(g.View,Object.assign({style:n},{children:(0,a.jsx)(x.default,{conversationId:this.state.conversationMri})}),"callAnimation")}_renderCallPanelHeader(e){const t=$t._useMobileControls(this.state.controlsType),i=!this._isIncomingOrOutgoingRing()&&!this.state.isUsingStackNavigationContext&&ae.isThread(this.state.conversationMri)&&!this.state.isEncryptedCall,n=[this.state.renderHeaderV2?Wt.headerContainerV2:Wt.headerContainer,this._callHeaderAnimatedStyle];let o,s;t&&n.push(Ze.default.marginTopStyle(this._getBannersHeight())),this.state.isUsingStackNavigationContext||(o=this._onShowOrHideRoster,s=this._onCallTitleLayout);const r=this.state.isPSTNCall&&this.state.knownPSTNContactMri||this.state.conversationMri,l=this.state.canAccessConversationDetails?this._onShowOrHideProfile:void 0;return(0,a.jsx)(g.Animated.View,Object.assign({style:n,ignorePointerEvents:!0},{children:this.state.renderHeaderV2?this._renderCallPanelHeaderV2(r,e,i,t,l,o,s):this._renderCallPanelHeaderV1(r,e,i,t,l,o,s)}),"callpanelheader"+this.state.callPanelHeaderLayout)}_renderCallPanelHeaderV1(e,t,i,n,o,s,r,l,c){return(0,a.jsx)(D.default,{callId:this.props.route.params.callId,conversationId:e,maxTitleWidth:this._maxTitleWidth(t),minimized:this.state.buttonsAndInfoHidden,isCallActive:this.state.callUIState===X.CallUIState.Default||this.state.callUIState===X.CallUIState.Voicemail,outgoingRingStatus:this.state.outgoingRingStatus,showParticipantCount:i,hideBackButton:this.state.callUIState===X.CallUIState.IncomingRing,incomingOrOutgoingRing:this._isIncomingOrOutgoingRing(),isDialPadShowing:this.state.showDialpad,isLandscape:this.state.isLandscape,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,useMobileControls:n,onTitlePress:o,onRosterPressed:s,onBingBackgroundsPressed:this._onBingBackgroundsPressed,onBackButtonPressed:this._onHeaderBackButtonPressed,onRecentsButtonPressed:this._onRecentsButtonPressed,isRecentsOpen:this.state.isRecentsOpen,onTitleLayout:r,onToggleCameraDirection:this._onToggleLocalVideoSource,onGalleryPress:this._toggleGalleryPanel,isNewMobileStage:this.state.isNewCallScreen&&n,callPanelHeaderLayout:this.state.callPanelHeaderLayout,onDynamicAudioChoice:this._onDynamicAudioChoice,hideGradient:l,isUsingSkypeTheme:null==c?void 0:c.isUsingSkypeTheme})}_renderCallPanelHeaderV2(e,t,i,n,o,s,r){return(0,a.jsx)(wt.default,{callId:this.props.route.params.callId,conversationId:e,maxTitleWidth:this._maxTitleWidth(t),minimized:this.state.buttonsAndInfoHidden,isCallActive:this.state.callUIState===X.CallUIState.Default||this.state.callUIState===X.CallUIState.Voicemail,outgoingRingStatus:this.state.outgoingRingStatus,showParticipantCount:i,hideBackButton:this.state.callUIState===X.CallUIState.IncomingRing,incomingOrOutgoingRing:this._isIncomingOrOutgoingRing(),isDialPadShowing:this.state.showDialpad,isLandscape:this.state.isLandscape,useMobileControls:n,onTitlePress:o,onRosterPressed:s,onBingBackgroundsPressed:this._onBingBackgroundsPressed,onBackButtonPressed:this._onHeaderBackButtonPressed,onRecentsButtonPressed:this._onRecentsButtonPressed,isRecentsOpen:this.state.isRecentsOpen,onTitleLayout:r,onToggleCameraDirection:this._onToggleLocalVideoSource,useLightTheme:this.state.isLightTheme,callPanelHeaderLayout:this.state.callPanelHeaderLayout,onDynamicAudioChoice:this._onDynamicAudioChoice})}_maxTitleWidth(e){if(this.state.callPanelHeaderLayout===X.CallPanelHeaderLayout.Window||this.state.callPanelHeaderLayout===X.CallPanelHeaderLayout.Float)return this.state.renderHeaderV2?Math.max(e.width/2,180):Math.max(e.width/2,350)}_renderOptionalNetworkInCallWarning(e,t){let i;return this.state.callUIState===X.CallUIState.Voicemail?i=Te.default.getViewInformationForVoicemail():this.state.isCallBeingForwarded&&(i=Te.default.getViewInformationForForwarding()),i?(0,a.jsx)(_e.default,{viewInformation:i,ref:this._onInCallWarningViewRef,style:null==t?void 0:t.style}):void 0}_renderFooterPstnTranslatorButton(e,t){return(0,a.jsx)(be.default,{callId:this.props.route.params.callId,conversationMri:this.state.conversationMri,callUIState:this.state.callUIState,isPstnCall:this.state.isPSTNCall,marginBottom:this._getPstnTranslationButtonsBottomPadding(),useLightTheme:this.state.isLightTheme,callStageV2:this.state.isNewCallScreen,style:null==t?void 0:t.style})}_renderOptionalAloneInTheCallInformationView(e,t){if(this.state.showAloneInCall)return(0,a.jsx)(b.default,{conversationMri:this.state.conversationMri,isCallCreator:this.state.isCallCreator,callId:this.props.route.params.callId,isProvidingVideo:this.state.isProvidingVideo,isRinglessCall:this.state.isRinglessCall,callControlsType:this.state.controlsType,isLandscape:this.state.isLandscape,useLightTheme:this.state.isLightTheme,useDesktopCallControls:!$t._useMobileControls(this.state.controlsType),style:null==t?void 0:t.style,isNewCallScreen:this.state.isNewCallScreen},"goliveinfo")}_shouldShowCallCreatorShareOverlayPopup(){var e;const t=!0===(null===(e=this.props.route.params.meetNowParameters)||void 0===e?void 0:e.call),i=xe.MeetNowHelpers.isGuestFlow()&&this.state.isConversationCreator;return this.state.hasCallCreatorShareOverlayPopup&&!this.state.isMobileEnvironmentWithStackNavigation&&(t||i)}_renderCallCreatorShareOverlayPopup(){if(this._shouldShowCallCreatorShareOverlayPopup())return(0,a.jsx)(A.default,{conversationMri:this.state.conversationMri,meetNowParameters:this.props.route.params.meetNowParameters||{origin:Le.MeetNowOrigin.CallPanel},callId:this.props.route.params.callId,isProvidingVideo:this.state.isProvidingVideo,onClose:this._closeCallCreatorShareOverlayPopup})}_intRenderCallControls(e,t){const{callId:i}=this.props.route.params;if(this.state.callUIState===X.CallUIState.IncomingRing)return(0,a.jsx)(ve.default,{conversationMri:this.state.conversationMri,callId:i,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,forMobile:this.state.controlsType===X.CallControlsType.Mobile});if($t._useMobileControls(this.state.controlsType)){const e=this.state.buttonsAndInfoHidden;let n;return(null==t?void 0:t.style)&&(n=g.Styles.createViewStyle(t.style,!1)),n=g.Styles.combine(e?Wt.hiddenControls:void 0,n),this.state.enableExperimentalCallControls?(0,a.jsx)(Ht.default,{conversationMri:this.state.conversationMri,reactionsConversationMri:this.state.reactionsConversationMri,callId:i,callUIState:this.state.callUIState,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,disableMic:this.state.microphonePermissionStatus!==h.PermissionStatus.Granted,onOpenDialpad:this._onOpenDialpad,onOverflowPressed:this._toggleMobileOverflowMenu,onLocalUnmute:this._onLocalUnmute,onInteracting:this._onCallControlsInteracting,showCallControlsVertically:null==t?void 0:t.showCallControlsVertically}):(0,a.jsx)(Oe.default,{style:n,conversationMri:this.state.conversationMri,reactionsConversationMri:this.state.reactionsConversationMri,callId:i,callUIState:this.state.callUIState,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,disableMic:this.state.microphonePermissionStatus!==h.PermissionStatus.Granted,onOpenDialpad:this._onOpenDialpad,onOverflowPressed:this._toggleMobileOverflowMenu,onEndCallFailure:this._onEndCallFailure,onLocalUnmute:this._onLocalUnmute,onInteracting:this._onCallControlsInteracting,blockPointerEvents:e,isShowingChat:this.state.isChatOpen,onChatPanelButtonPress:this._toggleChatPanel,enableNewButtons:this.state.isNewCallScreen,showCallControlsVertically:null==t?void 0:t.showCallControlsVertically,hideEndCallButton:this.state.enableExperimentalHeader,isUsingSkypeTheme:null==t?void 0:t.isUsingSkypeTheme})}return e.width===this.state.panelLayout.width&&(e=this.state.panelLayout),(0,a.jsx)(At.default,{ref:this._onCallControls,conversationMri:this.state.conversationMri,callId:i,callUIState:this.state.callUIState,isPSTNCall:this.state.isPSTNCall,isEncryptedCall:this.state.isEncryptedCall,disableMic:this.state.microphonePermissionStatus!==h.PermissionStatus.Granted,opacityStyle:this._callControlsOpacityAnimatedStyle,isShowingChat:this.state.isChatOpen,isShowingRecents:this.state.isRecentsOpen,shouldShowReactions:this.state.shouldShowReactions,isHidden:this.state.buttonsAndInfoHidden,onOpenDialpad:this._onOpenDialpad,onInteracting:this._onCallControlsInteracting,onAddToCall:this._onAddToCallPressed,onShowParticipants:this._onShowParticipants,onChatPanelButtonPress:this._toggleChatPanel,onReactionsPickerButtonPress:this._showOrHideReactionsDrawer,onReactionPickerButtonHover:this._showReactionsDrawerOnHover,onChatButtonRef:this._onChatButtonRef,onEndCallFailure:this._onEndCallFailure,onMomentsPress:this._callControlsOnCaptureMomentPress,onRecordCallPress:this._onCallRecordingPress,controlsType:this.state.controlsType,showHideOutgoingVideoDisabledToast:this._onShowHideDisableOutgoingVideoToast,isShowingAloneInCall:this.state.showAloneInCall,isOutgoingVideoDisabled:this.state.isOutgoingVideoDisabled,showParticipantsButton:this._shouldShowParticipantsButtonInCallControls(),isNewCallScreen:this.state.isNewCallScreen,useLightTheme:this.state.isLightTheme})}_renderCallControls(e){const t=$t._useMobileControls(this.state.controlsType),i=[Wt.buttonsContainer];if(t){i.push(this._callControlsAnimatedTranslateYStyle),i.push(Wt.mobileButtonsContainer);this._audioNotificationView&&this.state.callUIState===X.CallUIState.IncomingRing&&i.push(Wt.buttonsWithNotificationContainer)}else i.push(Wt.modernStageButtonsContainer),this.state.isLightTheme&&i.push(Wt.lightThemeButtonsContainer);return this.state.isNewCallScreen&&this.state.isUsingStackNavigationContext&&i.push(Wt.callControlsContainerNewStage),(0,a.jsxs)(g.Animated.View,Object.assign({style:i,ignorePointerEvents:!0,importantForAccessibility:t&&this.state.showDialpad?C.ImportantForAccessibility.NoHideDescendants:void 0},{children:[this.state.buttonsAndInfoHidden?null:(0,a.jsx)(Ot.default,{hidden:!this.state.isNewCallScreen||!$t._useMobileControls(this.state.controlsType),direction:y.GradientDirection.TOP}),this._renderOptionalNetworkInCallWarning(),this._renderFooterPstnTranslatorButton(),this._intRenderCallControls(e)]}),"callControls")}_renderAudioNotification(e,t){let i=this.state.bottomSafeAreaInset;$t._useMobileControls(this.state.controlsType)&&this._areControlsVisible()&&(i+=60);const n=this.state.hideCallControlsForActivity||this.state.showDialpad||this._isIncomingOrOutgoingRing();return(0,a.jsx)(g.Animated.View,Object.assign({style:Wt.buttonsContainer,ignorePointerEvents:!0},{children:(0,a.jsx)(v.default,{ref:this._onAudioNotificationViewRef,bottomPadding:i,callId:this.props.route.params.callId,showSpeakerOnWarning:this.state.showSpeakerOnWarning,isMicrophoneMutedWhileSpeaking:this.state.isMicrophoneMutedWhileSpeaking,hideNotification:n,useDesktopCallControls:!$t._useMobileControls(this.state.controlsType),isNewCallScreen:this.state.isNewCallScreen,style:null==t?void 0:t.style})}),"audioNotification")}_animateDialpad(e,t,i){we.log(Se.LogTraceArea.CallingUI,`_showOrHideDialpad causeId: ${t}`);const a=e?1:0,n=this.state.isUsingStackNavigationContext?0:-150,o=this.state.isUsingStackNavigationContext?zt:540;let s;if(e){const e=this.state.isUsingStackNavigationContext?0:(this.state.panelLayout.height-zt)/2*-1;s=Math.max(e,n)}else s=o;let r=!0;!this.state.isUsingStackNavigationContext&&e&&(r=!1),r?g.Animated.parallel([p.timing.easeOut({value:this._dialpadAnimatedOpacityValue,toValue:a,useNativeDriver:!0}),p.timing.easeOut({value:this._dialpadAnimatedTransformValue,toValue:s,useNativeDriver:!0})]).start(i):(this._dialpadAnimatedOpacityValue.setValue(a),this._dialpadAnimatedTransformValue.setValue(s),i&&i())}_showOrHideControls(e,t,i={},a,n){if(!$t._useMobileControls(this.state.controlsType)&&!a)return;this._reactionsBar&&this._reactionsBar.setOverflowCoachMarksEnabled(!e);const o=this._shouldKeepControlsVisible(),s=()=>` showControls: ${e} buttonsAndInfoHidden: ${i.buttonsAndInfoHidden} shouldKeepControlsVisible: ${o}`;a||this.state.buttonsAndInfoHidden!==!e&&!o?(i.buttonsAndInfoHidden=!e,e&&n&&(this._renderCallControlsScenario=new ft.default(ft.ScenarioName.RenderCallControls),this._renderCallControlsScenario.start(void 0,n),this._renderCallControlsScenario.markStepCompleted("ShowControls")),this.setState(i),we.log(Se.LogTraceArea.CallingUI,"_showOrHideControls "+s()+" causeId: "+t)):(o&&(i.buttonsAndInfoHidden=!1),this.setState(i),we.log(Se.LogTraceArea.CallingUI,"_showOrHideControls "+s()+" causeId: "+t)),k.default.setCallControlsVisible(e,t)}_shouldKeepControlsVisible(){const e=this._coachMarksBeingShown(),t=this.state.callUIState===X.CallUIState.OutgoingRing||this.state.callUIState===X.CallUIState.GoLiveSinglePlayer,i=$t._useMobileControls(this.state.controlsType)&&this.state.newMobileOverflowOpen&&!this.state.isUsingStackNavigationContext,a=e||this._isInteractingWithCallControls||this._endCallNavigationRequested||this.state.isPSTNCall||this.state.isMobileScreenReaderEnabled||this.state.isNavigatingWithKeyboard||t||i;return a&&we.log(Se.LogTraceArea.CallingUI,"_shouldKeepControlsVisible isInteractingWithCallControls: "+this._isInteractingWithCallControls+" endCallNavigationRequested: "+this._endCallNavigationRequested+" isPSTNCall: "+this.state.isPSTNCall+" isMobileScreenReaderEnabled: "+this.state.isMobileScreenReaderEnabled+" isNavigatingWithKeyboard: "+this.state.isNavigatingWithKeyboard+" coachMarksBeingShown: "+e+" isInOutgoingRingOrWaitState: "+t+" overflowMenuOpenOnTablet: "+i),a}_startParticipantAnimationSuppressionTimeout(){this.state.suppressParticipantAnimation&&Tt.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({suppressParticipantAnimation:!1})}),2e3)}_updateLeftNoneStateOnce(e){we.log(Se.LogTraceArea.CallingUI,"_updateLeftNoneStateOnce callUIState: "+X.CallUIState[this.state.callUIState]+" causeId: "+e),this._leftNoneStateOnce||this.state.callUIState===X.CallUIState.None||(this._leftNoneStateOnce=!0)}_updateAudioState(e){this.isComponentMounted()?(we.log(Se.LogTraceArea.CallingUI,"_updateAudioState causeId: "+e),L.default.CallControlsStore.updateAudioState(this.props.route.params.callId,e)):we.log(Se.LogTraceArea.CallingUI,"_updateAudioState - component no longer mounted, causeId: "+e)}_callControlsVisualHeight(){const e=$t._useMobileControls(this.state.controlsType)?55:X.DesktopCallControlsHeight;return Math.max(this._reactionsBarHeight,e+40+-1*this._controlsTranslateY())}_componentId(){return"CapturePanel"}_galleryMri(){return this.state.conversationMri}_isIncomingOrOutgoingRing(){const{callUIState:e}=this.state;return e===X.CallUIState.IncomingRing||e===X.CallUIState.OutgoingRing}_startOrStopOrientationListener(e){}_endCall(e,t){we.log(Se.LogTraceArea.CallingUI,"_endCall forEveryone: "+e+" causeId: "+t);(e?L.default.CallingStore.endCallForEveryone(this.props.route.params.callId,t):L.default.CallingStore.endCall(this.props.route.params.callId,t)).catch((e=>{we.log(Se.LogTraceArea.CallingUI,"_endCall failed: "+pt.default.errorAsString(e)+" causeId: "+t),this._onEndCallFailure(t)}))}_controlsTranslateY(){return $t._useMobileControls(this.state.controlsType)?10-this.state.bottomSafeAreaInset:this.state.bottomSafeAreaInset}_registerKeyboardHandlers(){const e=(0,ce.default)().getConversation(this.state.conversationMri);(0,Ee.isRegularMemberInModeratedGroup)(e)||(Me.default.addHandler(Se.KeyboardShortcut.AddPeopleToCall,this._onAddToCallKeyboardShortcut),Me.default.addHandler(Se.KeyboardShortcut.TakeCallSnapshot,this._onCaptureMomentKeyboardShortcut)),Me.default.addHandler(Se.KeyboardShortcut.ToggleMicrophone,this._onToggleMicrophoneKeyboardShortcut),this.state.isOutgoingVideoDisabled||Me.default.addHandler(Se.KeyboardShortcut.ToggleCamera,this._onToggleVideoKeyboardShortcut),Me.default.addHandler(Se.KeyboardShortcut.HangupOrRejectCall,this._hangupCallShortcut),Me.default.addHandler(Se.KeyboardShortcut.AnnounceMuteStatus,this._onAnnounceMuteStatusKeyboardShortcut),Me.default.addHandler(Se.KeyboardShortcut.AnnounceSelfVideoOnOffStatus,this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut)}_unregisterKeyboardHandlers(){const e=(0,ce.default)().getConversation(this.state.conversationMri);(0,Ee.isRegularMemberInModeratedGroup)(e)||(Me.default.removeHandler(Se.KeyboardShortcut.AddPeopleToCall,this._onAddToCallKeyboardShortcut),Me.default.removeHandler(Se.KeyboardShortcut.TakeCallSnapshot,this._onCaptureMomentKeyboardShortcut)),Me.default.removeHandler(Se.KeyboardShortcut.ToggleMicrophone,this._onToggleMicrophoneKeyboardShortcut),this.state.isOutgoingVideoDisabled||Me.default.removeHandler(Se.KeyboardShortcut.ToggleCamera,this._onToggleVideoKeyboardShortcut),Me.default.removeHandler(Se.KeyboardShortcut.HangupOrRejectCall,this._hangupCallShortcut),Me.default.removeHandler(Se.KeyboardShortcut.AnnounceMuteStatus,this._onAnnounceMuteStatusKeyboardShortcut),Me.default.removeHandler(Se.KeyboardShortcut.AnnounceSelfVideoOnOffStatus,this._onAnnounceSelfVideoOnOffStatusKeyboardShortcut)}_mustUpdateSpeakerMutedAsync(e,t){return Ct.default.isElectronOsx()&&"true"!==T.default.getSkypeAudioLibraryFeatures().ECS_ADSP_VirtualSessionVolume&&t.isSpeakerMuted!==L.default.CallingStore.isSpeakerMuted(e)}_updateSpeakerMutedAsync(e){return L.default.DeviceStore.getSpeakerVolumeAsync(!0).then((t=>0===t||L.default.CallingStore.isSpeakerMuted(e)))}_onNavigatedAwayFromCall(e){var t;we.log(Se.LogTraceArea.CallingUI,"onNavigateAwayFrom Call onCallScreenClose, causeId: "+e),this.state.isDesktopMin&&(null===(t=this._reactionsBar)||void 0===t?void 0:t.isDrawerOpen())&&this._showOrHideReactionsDrawer(!1),m.PushNotifications.onCallScreenClose()}_transcriptionLayout(e,t){return $.default.getTranscriptionLayout(e,!!t,this.state.isLandscape)}_getTanscriptionRects(e){const t=L.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)||!1;if(this.state.isTranslating&&t&&!this.state.isRightPanelOpen){const i=this._transcriptionLayout(t,e);return $.default.getTranscriptionLayoutRects(this.state.panelLayout,i)}}_canShowTranscriptionPanel(e){return!!L.default.OngoingCallService.getIsSubtitleHistoryOpen(this.props.route.params.callId)&&(!e||!e.isHorizontal)}_canShowTranscription(){return!(!this.state.pstnTranslationEnabled&&!this.state.skypeTranslationEnabled)||!(!this.state.isTranscriptionEnabled||!this.state.isTranslating)}_getTranscriptionBottomPadding(){let e=0;if($t._useMobileControls(this.state.controlsType))this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.bottom||this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.left?e+=this.state.bottomSafeAreaInset+X.AudioNotificationOffset:e+=90,this._areControlsVisible()&&(e+=45),this.state.pstnTranslationEnabled&&(this._areControlsVisible()?e+=40:e+=60);else if(this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.bottom)e=20;else if(this.state.userCaptionPositionMode===Rt.CaptionsPositionMode.float)e=85;else if(this._areControlsVisible()){const t=0;e=this._callControlsVisualHeight()+t}else e=this._audioNotificationView?40:20;return!$t._useMobileControls(this.state.controlsType)&&this.state.pstnTranslationEnabled&&(e+=25),e}_getPstnTranslationButtonsBottomPadding(){let e=0;return this.state.isUsingStackNavigationContext?this._areControlsVisible()&&(e+=40):e=this.state.isNewCallScreen?X.AudioNotificationOffset+X.DesktopCallControlsHeight+10:X.AudioNotificationOffset+X.DesktopCallControlsHeight-10,e}_showMobileServerMutedToast(e){return!!e.showServerMutedToastOnMobile&&!e.isCallOnHold}_showCallConnectionQualityToast(e){return(e.callNetworkQualityPoor||e.audioOnlyEnabled)&&!e.isCallOnHold}_onToastHeightChanged(e,t){const i=e?e+this._getBannerHeightAdjustment():0;this._shouldUpdateBannerHeight(i,this.state[t]||0)&&this.setState({[t]:i})}_shouldUpdateBannerHeight(e,t){return this.isComponentMounted()&&e!==t}_getBannersHeight(){return this.state.recordingBannerHeight+this.state.cameraDeniedBannerHeight+this.state.ndiUsedBannerHeight+this.state.callMediaCapturedBannerHeight+this.state.incomingVideoDisabledBannerHeight+this.state.callConnectionQualityBannerHeight+this.state.serverMuteNotificationBannerHeight+this.state.mobileScreenShareBannerHeight+this.state.mobileTeamsInteropBannerHeight+this.state.mobileTranslationBannerHeight+this.state.mobileTogetherModeNoticeBannerHeight+this.state.mobileMusicModeNoticeBannerHeight+this.state.pstnTranslationNoticeBannerHeight+this.state.pstnParticipantRingNoticeBannerHeight+this.state.videoRestrictedBannerHeight}_getBannerHeightAdjustment(){return this.state.isNewCallScreen&&this.state.isUsingStackNavigationContext?20:10}_getTopInset(){let e=this.state.hideStatusBarPadding?0:this.state.topSafeAreaHeight;const t=this._getBannersHeight();return this._areControlsVisible()?$t._useMobileControls(this.state.controlsType)?(e+=this.state.renderHeaderV2?X.DesktopNewHeaderHeight:X.CallPanelHeaderHeight.mobile,e+=t):Xe.default.keepStatusBarVisibleNoSubscription()||(e+=17):e+=t,e}}$t._useMobileControls=e=>e===X.CallControlsType.Mobile,t.default=$t},839818:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(994463),o=i(231564);function s(e){const t=(0,o.useCallPanelContext)();return(0,a.jsx)(n.default,Object.assign({},e,{layout:t.layout,onFocusModeChange:t.setFocusModeOn}))}t.default=function(e){return(0,a.jsx)(o.default,{children:(0,a.jsx)(s,Object.assign({},e))})}},389088:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(705465);"android"===o.Platform.OS&&o.UIManager.setLayoutAnimationEnabledExperimental&&o.UIManager.setLayoutAnimationEnabledExperimental(!0),t.default=function({hidden:e,style:t,children:i,duration:s=250}){const[r,l]=n.useState(e);return n.useEffect((()=>{o.LayoutAnimation.configureNext(Object.assign(Object.assign({},o.LayoutAnimation.Presets.easeInEaseOut),{duration:s})),l(e)}),[e,s]),r?null:(0,a.jsx)(o.View,Object.assign({style:Object.assign({},t||{})},{children:i}))}},231564:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useCallPanelContext=void 0;const a=i(785893),n=i(217041),o=i(667294),s=i(258187),r=i(600212),l=i(889391),c=i(29130),d=i(581760),u=i(480200),h=o.createContext({}),p="#444444";var g;!function(e){e[e.Portrait=0]="Portrait",e[e.Landscape=1]="Landscape"}(g||(g={}));t.useCallPanelContext=()=>o.useContext(h),t.default=(0,n.withResubAutoSubscriptions)((function({children:e}){const t=(()=>{const e=(0,s.useCommonContext)();return c.default.getWidth(e.rootViewId)/c.default.getHeight(e.rootViewId)>1.7?g.Landscape:g.Portrait})(),[i,n]=o.useState(!1),{enableNewCallPanel:{enablePortraitFlex:C,enableLandscapeFlex:S}}=l.default.getS4LCMCFeatures(),m=(0,r.useSkypeTheme)(),y=o.useMemo((()=>{let e;switch(t){case g.Landscape:e=S?(({isFocusModeOn:e,skypeTheme:t})=>[{name:"Column",key:"root-column",props:{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",backgroundColor:t.themeColors.surfacePrimary}},children:[{name:"LayoutAnimationContainer",key:"call-header-container",props:{hidden:e,style:{}},children:[{name:"CallPanelHeaderFlex",props:{isLandscape:!0,style:{height:44},isUsingSkypeTheme:!0}}]},{name:"Column",key:"call-panel-and-controls-wrapper",props:{style:{flex:1,flexDirection:"row",backgroundColor:d.Color.transparent}},children:[{name:"ZStack",key:"call-stage-wrapper",props:{style:{flex:1,position:"relative",backgroundColor:d.Color.transparent,margin:e?0:12,borderRadius:e?0:8,overflow:"hidden"}},children:[{name:"CallStage",props:{style:{height:void 0,width:void 0,top:0},hideLocalVideo:!0,forceVideoToCrop:!0,participantsAccessoryPosition:u.CallAccessoryPosition.BottomLeft}},{name:"LocalParticipantView",props:{style:{position:"absolute",bottom:16,right:16}}},{name:"CallingAnimation",props:{top:0,bottom:0}},{name:"Column",key:"optional-in-call-buttons",props:{style:{position:"absolute",bottom:0,left:0,right:0,padding:16,paddingBottom:42}},children:[{name:"TranscriptionView",props:{position:"float",paddingBottom:4,paddingTop:4,style:{marginTop:16,marginLeft:0,marginRight:0,marginBottom:0,bottom:0,position:"relative",backgroundColor:d.Color.transparent}}},{name:"InCallPstnTranslatorButton",props:{style:{position:"relative",marginTop:0,marginLeft:0,marginRight:0,marginBottom:4,bottom:0}}},{name:"AloneInTheCallInformation",props:{style:{position:"relative",backgroundColor:d.Color.transparent,paddingTop:0,paddingLeft:0,paddingRight:0,paddingBottom:4}}},{name:"OptionalNetworkInCallWarning",props:{style:{position:"relative",marginTop:0,marginLeft:0,marginRight:0,marginBottom:2,height:void 0}}},{name:"AudioNotifications",props:{style:{bottom:0,paddingTop:0,paddingLeft:0,paddingRight:0,paddingBottom:12,height:void 0,margin:0}}}]},{name:"MobileTopBanner",props:{style:{position:"absolute",top:0,width:364,paddingTop:8,paddingLeft:0,paddingRight:0,paddingBottom:0,alignSelf:"center"},bannerStyle:{margin:2,borderRadius:8,backgroundColor:d.Color.gray400overlay95}}},{name:"ReactionsPanel",props:{style:{paddingBottom:0}}},{name:"TransientView"}]},{name:"Tray",props:{showTrayVertically:!0,traySizeMultiplier:.8,showCompactReactions:!1,style:{flex:0,marginVertical:e?8:12,marginLeft:e?8:0,marginRight:e?8:16},participantsAccessoryPosition:u.CallAccessoryPosition.BottomLeftSmallPadding}},{name:"TranscriptionView",props:{position:"left",paddingBottom:8,paddingTop:0,style:{paddingLeft:4,paddingRight:4,marginRight:e?0:16,marginTop:e?0:12,marginBottom:e?0:12,borderRadius:e?0:8,backgroundColor:p}}},{name:"TranscriptionNotifications",props:{headerHeight:e?0:96,style:{position:"absolute",top:e?8:12,left:e?8:12,right:e?8:84}}},{name:"LayoutAnimationContainer",key:"call-controls-container",props:{hidden:e,style:{paddingVertical:8,paddingRight:12}},children:[{name:"FlexCallControls",props:{style:{opacity:1},showCallControlsVertically:!0,isUsingSkypeTheme:!0}}]}]},{name:"Dialpad"}]}])({isFocusModeOn:i,skypeTheme:m}):[{name:"ZStack",props:{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"}},children:[{name:"CallStage"},{name:"Tray"},{name:"ReactionsPanel"},{name:"CallingAnimation",props:{top:0,bottom:0}},{name:"TranscriptionView"},{name:"AloneInTheCallInformation"},{name:"TransientView"},{name:"CallControls"},{name:"MobileTopBanner"}]},{name:"CallPanelHeader"},{name:"Dialpad"},{name:"AudioNotifications"}];break;case g.Portrait:default:e=C?(({isFocusModeOn:e,skypeTheme:t})=>[{name:"Column",key:"root-column",props:{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",backgroundColor:t.themeColors.surfacePrimary}},children:[{name:"LayoutAnimationContainer",key:"call-header-container",props:{hidden:e,style:{}},children:[{name:"CallPanelHeaderFlex",props:{style:{height:56},isUsingSkypeTheme:!0}}]},{name:"Column",key:"call-panel-wrapper",props:{style:{flex:1,backgroundColor:d.Color.transparent}},children:[{name:"ZStack",key:"call-stage-wrapper",props:{style:{flex:1,position:"relative",margin:e?0:16,borderRadius:e?0:8,overflow:"hidden",backgroundColor:d.Color.transparent}},children:[{name:"CallStage",props:{style:{height:void 0,width:void 0,top:0},hideLocalVideo:!0,forceVideoToCrop:!0,participantsAccessoryPosition:u.CallAccessoryPosition.BottomLeft}},{name:"LocalParticipantView",props:{style:{position:"absolute",bottom:16,right:16}}},{name:"CallingAnimation",props:{top:0,bottom:0}},{name:"Column",key:"optional-in-call-buttons",props:{style:{position:"absolute",bottom:0,left:0,right:0,padding:16,paddingBottom:48}},children:[{name:"TranscriptionView",props:{position:"float",paddingBottom:4,paddingTop:4,style:{marginTop:16,marginLeft:0,marginRight:0,marginBottom:0,bottom:0,position:"relative",backgroundColor:d.Color.transparent}}},{name:"InCallPstnTranslatorButton",props:{style:{marginTop:16,marginLeft:0,marginRight:0,marginBottom:0,bottom:0,position:"relative"}}},{name:"AudioNotifications",props:{style:{position:"relative",paddingTop:8,paddingLeft:8,paddingRight:8,paddingBottom:8,height:void 0,bottom:0,margin:0}}},{name:"AloneInTheCallInformation",props:{style:{position:"relative",backgroundColor:d.Color.transparent,paddingTop:0,paddingLeft:0,paddingRight:0,paddingBottom:16}}},{name:"OptionalNetworkInCallWarning",props:{style:{marginTop:0,marginLeft:0,marginRight:0,marginBottom:0,height:void 0}}}]},{name:"MobileTopBanner",props:{style:{position:"relative",top:0,left:0,right:0,padding:8},bannerStyle:{margin:2,borderRadius:8,backgroundColor:d.Color.gray400overlay95}}}]},{name:"Tray",props:{showTrayVertically:!1,traySizeMultiplier:.8,showCompactReactions:!1,style:{flex:0,position:"relative",alignSelf:"auto",borderTopWidth:0,borderBottomWidth:0,borderLeftWidth:0,borderRightWidth:0,marginHorizontal:e?8:16,marginTop:e?8:0,marginBottom:e?8:16,top:0},participantsAccessoryPosition:u.CallAccessoryPosition.BottomLeftSmallPadding}},{name:"TranscriptionView",props:{position:"bottom",paddingBottom:4,paddingTop:0,style:{paddingLeft:4,paddingRight:4,marginBottom:e?0:16,marginLeft:e?0:16,marginRight:e?0:16,borderRadius:e?0:8,backgroundColor:p}}},{name:"TranscriptionNotifications",props:{headerHeight:e?0:192,style:{position:"absolute",top:e?8:16,left:e?8:16,right:e?8:16,marginBottom:e?0:70,padding:12}}},{name:"ReactionsPanel"},{name:"TransientView"}]},{name:"Column",key:"call-controls-wrapper",props:{style:{backgroundColor:d.Color.transparent}},children:[{name:"LayoutAnimationContainer",key:"call-controls-container",props:{hidden:e,style:{paddingTop:0,paddingBottom:16,paddingLeft:16,paddingRight:16}},children:[{name:"FlexCallControls",props:{style:{opacity:1,paddingVertical:0,paddingHorizontal:0},isUsingSkypeTheme:!0}}]}]},{name:"Dialpad"}]}])({isFocusModeOn:i,skypeTheme:m}):[{name:"ZStack",props:{style:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"}},children:[{name:"CallStage"},{name:"Tray"},{name:"ReactionsPanel"},{name:"CallingAnimation",props:{top:0,bottom:0}},{name:"TranscriptionView"},{name:"AloneInTheCallInformation"},{name:"TransientView"},{name:"CallControls"},{name:"MobileTopBanner"}]},{name:"CallPanelHeader"},{name:"Dialpad"},{name:"AudioNotifications"}]}return{layout:e,setFocusModeOn:n}}),[t,i,C,S,m]);return(0,a.jsx)(h.Provider,Object.assign({value:y},{children:e}))}))},106068:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(667294),s=i(705465),r=i(537103),l=i(480200),c=i(471727),d=i(915877),u=i(581760),h=i(680837),p=i(711828),g=i(498053),C=(0,d.lazyProperties)({participantView:()=>n.Styles.createViewStyle({borderRadius:p.IconSize.size8,overflow:"hidden",shadowOffset:{width:0,height:4},shadowRadius:4,shadowColor:u.Color.blackOverlay70}),participantViewDark:()=>n.Styles.createViewStyle({backgroundColor:u.Color.callStageLight}),participantViewLight:()=>n.Styles.createViewStyle({backgroundColor:u.Color.gray50})});t.default=o.memo((({callId:e,conversationMri:t,isLightTheme:i,style:n,isProvidingVideo:d,getCallReactionsDisplayHelper:u})=>{const[p]=o.useState((()=>({getStyles:(e,t,i)=>[h.default.flexOne,C.participantView,c.default.getLocalPreviewMobilesShape(t)],getInnerStyles:()=>[h.default.flexOne],getBackgroundColorStyle:e=>e?C.participantViewLight:C.participantViewDark,isHidden:()=>!1}))),S=o.useCallback(((t,i)=>{const a=new g.SwitchCameraCommand(e,!!d);a.canExecute()&&a.execute()}),[e,d]);return(0,a.jsx)(s.View,Object.assign({style:n},{children:(0,a.jsx)(r.CallParticipantView,{renderKey:l.CallStageElementKeys.localUserKey,parentViewId:"LocalParticipantView",getCallReactionsDisplayHelper:u,callId:e,conversationMri:t,useDarkBackground:!0,desktopNameTag:!0,isCallStageV2:!0,showContextMenu:!0,layoutController:()=>p,iconSize:64,iconOpacity:1,isGroupCall:!1,useLightTheme:i,onTap:S},l.CallStageElementKeys.localUserKey)}))}))},934256:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(705465),s=i(671830),r=i(822854),l=i(89808),c=i(702301),d=i(567977),u=o.StyleSheet.create({container:{flex:1,paddingHorizontal:50,alignItems:"center",justifyContent:"center",overflow:"visible"},fullWidthAndHeight:{width:"100%",height:"100%"},circlePosition:{position:"absolute",top:8,right:8,bottom:8,left:8},roundContainer:{borderRadius:99999999},overflowHidden:{overflow:"hidden"}});t.default=n.memo((({conversationId:e})=>{const t=n.useRef(new o.Animated.Value(0)),i=n.useRef(new o.Animated.Value(0)),h=n.useRef();n.useEffect((()=>(h.current=o.Animated.sequence([o.Animated.timing(t.current,{toValue:1,duration:200,delay:50,useNativeDriver:!0}),o.Animated.loop(o.Animated.sequence([o.Animated.timing(i.current,{easing:o.Easing.cubic,toValue:1,duration:2e3,useNativeDriver:!0}),o.Animated.spring(i.current,{toValue:0,stiffness:200,useNativeDriver:!0})]))]),h.current.start(),h.current.stop)),[]);const p=s.isOneOnOneConversation(e)?(0,a.jsx)(c.UserIcon,{userMri:e,forceMediumAvatarSize:!0,size:d.UserIconSize.Size160}):(0,a.jsx)(r.ConversationIcon,{conversationId:e,size:d.ConversationIconSize.Size160});return(0,a.jsx)(o.View,Object.assign({style:[u.container,u.fullWidthAndHeight]},{children:(0,a.jsxs)(o.Animated.View,Object.assign({style:{opacity:t.current}},{children:[(0,a.jsx)(o.Animated.View,{style:[u.circlePosition,u.roundContainer,u.overflowHidden,{borderColor:l.default.getPrimaryColorNoSubscription(),borderWidth:4,transform:[{scale:i.current.interpolate({inputRange:[0,1],outputRange:[1,1.5]})}]}]}),(0,a.jsx)(o.Animated.View,Object.assign({style:[u.roundContainer,u.overflowHidden,{transform:[{scale:i.current.interpolate({inputRange:[0,1],outputRange:[1,.8]})}]}]},{children:p}))]}))}))}))},904812:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallPanel=void 0;var a=i(839818);Object.defineProperty(t,"CallPanel",{enumerable:!0,get:function(){return a.default}})},615526:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(480200),r=i(110117),l=i(915877),c=i(451070),d=i(681115),u=i(581760),h=i(711828),p=i(853374),g=16,C=(0,l.lazyProperties)({accessory:()=>n.Styles.createViewStyle({position:"absolute",width:24,height:24,borderRadius:12,backgroundColor:u.Color.blackOverlay50,alignItems:"center",justifyContent:"center"}),accessoryTopLeft:()=>n.Styles.createViewStyle({left:g,top:g}),accessoryTopRight:()=>n.Styles.createViewStyle({position:"absolute",right:g,top:g}),accessoryBottomLeft:()=>n.Styles.createViewStyle({position:"absolute",left:g,bottom:g}),accessoryBottomLeftSmallPadding:()=>n.Styles.createViewStyle({position:"absolute",left:8,bottom:8}),accessoryBottomRight:()=>n.Styles.createViewStyle({position:"absolute",right:g,bottom:g}),accessoryBottomRightSmallPadding:()=>n.Styles.createViewStyle({position:"absolute",right:8,bottom:8}),accessoryCenterContainer:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:100,height:24,alignItems:"center",justifyContent:"center"})});class S extends o.ComponentBase{_buildState(e,t){return{safeAreaHorizontalInsets:c.default.horizontalInsets({left:g,right:30})}}_styleForAccessoryPosition(e){switch(e){case s.CallAccessoryPosition.BottomLeft:return C.accessoryBottomLeft;case s.CallAccessoryPosition.BottomRight:return C.accessoryBottomRight;case s.CallAccessoryPosition.BottomLeftSmallPadding:return C.accessoryBottomLeftSmallPadding;case s.CallAccessoryPosition.BottomRightSmallPadding:return C.accessoryBottomRightSmallPadding;case s.CallAccessoryPosition.TopLeft:return C.accessoryTopLeft;case s.CallAccessoryPosition.TopRight:return C.accessoryTopRight}}render(){const e=this.props.position===s.CallAccessoryPosition.Center,t=[C.accessory];if(!e&&this.props.position){const e=this._styleForAccessoryPosition(this.props.position);if(e&&t.push(e),this.props.position===s.CallAccessoryPosition.BottomRight||this.props.position===s.CallAccessoryPosition.TopRight){!!this.state.safeAreaHorizontalInsets&&d.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)&&t.push(d.default.horizontalMarginStyle(this.state.safeAreaHorizontalInsets))}}let i;switch(this.props.type){case s.CallAccessoryType.Mute:i=h.SkypeIcon.MicrophoneOff;break;case s.CallAccessoryType.OnHold:i=h.SkypeIcon.Pause;break;case s.CallAccessoryType.Screensharing:i=h.SkypeIcon.ScreenShare;break;default:i=p.default.switchStatementExhaustiveChecking(this.props.type)}let o=(0,a.jsx)(n.View,Object.assign({style:t,blockPointerEvents:!0,ignorePointerEvents:!0},{children:(0,a.jsx)(r.default,{icon:i,size:h.IconSize.size12,color:u.Color.white})}));return e&&(o=(0,a.jsx)(n.View,Object.assign({style:C.accessoryCenterContainer,blockPointerEvents:!0,ignorePointerEvents:!0},{children:o}))),o}}t.default=S},413805:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantBackgroundReplaceCaption=void 0;const a=i(785893),n=i(174958),o=i(516778),s=i(148540),r=i(244770),l=i(889391),c=i(719061),d=i(329675),u=i(994224),h=i(568580),p=i(109520),g=i(502278),C=i(662602),S=i(746096),m=i(110117),y=i(436237),f=i(540522),b=i(733754),_=i(915877),T=i(18078),v=i(711828),w=i(619675),I=i(24576),P=i(581760),M=i(853374),k=i(680837),A=i(626712),R=(0,_.lazyProperties)({modernStageBackgroundInfo:()=>o.Styles.createViewStyle({position:"absolute",overflow:"hidden",alignItems:"flex-start",justifyContent:"flex-start"}),bgInfoContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start"}),topContainer:()=>o.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch",borderRadius:4,paddingHorizontal:8,paddingVertical:8,marginRight:6}),topContainerBg:()=>o.Styles.createViewStyle({backgroundColor:P.Color.blackOverlay70}),topContainerBgLight:()=>o.Styles.createViewStyle({backgroundColor:P.Color.whiteOverlay80}),topContainerBgLightTray:()=>o.Styles.createViewStyle({backgroundColor:P.Color.gray50overlay95}),topLineContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start"}),bottomLineContainer:()=>o.Styles.createViewStyle({paddingTop:0,flexDirection:"column-reverse",alignItems:"flex-start",height:16}),bingLineContainer:()=>o.Styles.createViewStyle({paddingTop:4,marginTop:6,flexDirection:"column-reverse",alignItems:"flex-start",borderTopWidth:1,flexGrow:1,borderColor:P.Color.whiteOverlay50}),bingLineText:()=>o.Styles.createTextStyle({color:P.Color.whiteOverlay70}),bingLineTextLight:()=>o.Styles.createTextStyle({color:P.Color.gray400}),nameText:()=>o.Styles.createTextStyle({color:P.Color.white}),nameTextLight:()=>o.Styles.createTextStyle({color:P.Color.gray400}),nameTextHover:()=>o.Styles.createTextStyle({textDecorationLine:"underline"}),iconLeft:()=>o.Styles.createViewStyle({margin:0}),iconLeftAlone:()=>o.Styles.createViewStyle({margin:0}),bingIconLeft:()=>o.Styles.createViewStyle({height:16,width:16})});class x extends I.default{constructor(e){super(e),this._onClick=()=>{if(this.state.backgroundEffectImageInfo){const e=this.state.backgroundEffectImageInfo,t=e.link;if(y.log(S.LogTraceArea.CallingUI,`Clicking other user Bing background effect info. IsoDate: ${e.isoDate}, Info exists: ${!!t}, IsCollapsed: ${this.state.isCollapsed}, EffectUser: ${n.pii.Mri(this.state.mri)}`),this.props.callId){const t=M.default.newCauseId();g.default.updateCallTelemetry(this.props.callId,t,(e=>e.bingBackgroundEffectCaptionClick())),y.track(new p.BackgroundEffectsBingInfoClickEvent(this.props.callId,e.isoDate,this.state.mri,e.market,this.state.isCollapsed))}if(t){const e=l.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds;let i=`${e.host}${t}`;e.clickLinkPartnerCode&&""!==e.clickLinkPartnerCode&&A.default.isUrlValid(i)&&(i=A.default.addUrlParameter(i,"pc",e.clickLinkPartnerCode));const a={browserTitle:b.getString("AudioVideoSettings.BackgroundEffectCategoryBing"),preventInAppNavigationForGuest:!c.default.canNavigateInApp(),conversationId:this.props.conversationMri,openInExternalBrowser:!e.tryOpenInAppBrowser,useBingMiniCanvas:!0};f.openUrlWithParams({origin:S.BrowserOrigin.LinkNode,url:i,options:a,rootViewId:this._getRootViewId()})}}},this._onMouseEnter=e=>{this.props.onMouseEnter&&this.props.onMouseEnter(e),this.setState({hover:!0})},this._onMouseLeave=e=>{this.props.onMouseLeave&&this.props.onMouseLeave(e),this.setState({hover:!1})},this._onKeyPress=e=>C.default.maybeHandleKeyPress(e,(()=>{this._onClick()}));const t=this._layoutController();t.onRectChanged&&t.onRectChanged((e=>{this._findSizeAndOffset()})),t.onTopRowChanged&&t.onTopRowChanged((()=>{if(this.isComponentMounted()){let i=!1;t.getIsTopRowElement&&(i=t.getIsTopRowElement());let a=this.state.captionOffsets;t.bgInfoCaptionOffset&&(a=t.bgInfoCaptionOffset(this._getRootViewId(),e.isCallStageV2?e.isInTray?10:12:16)),this.setState({isTopRow:i,captionOffsets:a})}}))}_buildState(e,t){let i=e.renderInfo;e.callId&&!e.renderInfo&&(i=u.default.CallParticipantStore.getParticipantRenderInfo(e.renderKey,e.callId));const a=(null==i?void 0:i.mri)||this._extractMriForKey(i,e.renderKey,!1),n={renderInfo:i,mri:a,streamType:(null==i?void 0:i.renderScreenShare)?s.StreamType.ScreenSharing:s.StreamType.Video,backgroundEffectId:u.default.DeviceStore.getBackgroundEffectType()};e.callId&&(n.backgroundEffectImageInfo=u.default.CallParticipantBackgroundInfoStore.getBackgroundInfo(e.callId,a),n.backgroundEffectImageInfo||u.default.CallingStore.isCallConnected(e.callId)||!n.backgroundEffectId||(n.backgroundEffectImageInfo=d.default.getBingBackgroundImageInfoFromId(n.backgroundEffectId,e.callId,a)));const o=this._layoutController();if(o.viewRect){const e=o.viewRect();n.width=e.width,n.height=e.height}return o.bgInfoCaptionOffset&&(n.captionOffsets=o.bgInfoCaptionOffset(this._getRootViewId(),e.isCallStageV2?e.isInTray?10:12:16)),n.isTopRow=!1,o.getIsTopRowElement&&(n.isTopRow=o.getIsTopRowElement()),n.isCollapsed=this._isCollapsed(n.width,e.noExpand),n}componentDidMount(){super.componentDidMount(),this._findSizeAndOffset()}_isCollapsed(e,t){return l.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.captionAlwaysCollapsed||e&&e<500||!!t}_getOptionalBackgroundEffectInfo(){if(!this.state.backgroundEffectImageInfo)return;const e=this.state.backgroundEffectImageInfo,t=e.caption,i=e.copyright;if(!t)return;const n=this._getCaptionOffset(),s=this.state.width?Math.round(this.state.width-2*n.left):void 0,r=o.Styles.createViewStyle({top:n.top,left:n.left,maxWidth:s},!1),l=s?Math.round(s-16+44):void 0,c=o.Styles.createViewStyle({maxWidth:l},!1),d=[R.modernStageBackgroundInfo,r];this.props.nametagOpacityStyle&&d.push(this.props.nametagOpacityStyle);const u=[this.props.useLightTheme?R.nameTextLight:R.nameText,c,k.default.pointerCursor];this.state.hover&&u.push(R.nameTextHover);const h=v.SkypeIcon.Search,p=this.state.isCollapsed&&(!this.state.hover||this.props.noExpand),g=this._iconView(h,p?R.iconLeftAlone:R.iconLeft),C=this.props.useLightTheme?this.props.isInTray?R.topContainerBgLightTray:R.topContainerBgLight:R.topContainerBg,S=this.props.useLightTheme?R.bingLineTextLight:R.bingLineText,m=(0,a.jsx)(o.Animated.View,Object.assign({style:[R.topContainer,C,k.default.pointerCursor]},{children:g}));let y;if(p)y=(0,a.jsx)(o.Animated.View,Object.assign({style:R.bgInfoContainer},{children:m}));else{const e=(0,a.jsxs)(o.Animated.View,Object.assign({style:[R.topContainer,C]},{children:[(0,a.jsx)(o.Animated.View,Object.assign({style:[R.topLineContainer]},{children:(0,a.jsx)(w.Caption,Object.assign({style:u,numberOfLines:1},{children:t}))})),(0,a.jsx)(o.Animated.View,Object.assign({style:R.bottomLineContainer},{children:(0,a.jsx)(w.Caption,Object.assign({small:!0,numberOfLines:1,style:c},{children:i}))})),(0,a.jsx)(o.Animated.View,Object.assign({style:R.bingLineContainer},{children:(0,a.jsx)(w.Caption,Object.assign({small:!0,numberOfLines:1,style:[c,S]},{children:b.getString("AudioVideoSettings.BackgroundEffectCategoryBing")}))}))]}));y=(0,a.jsxs)(o.Animated.View,Object.assign({style:R.bgInfoContainer},{children:[m,e]}))}return(0,a.jsx)(o.Animated.View,Object.assign({style:d,ignorePointerEvents:!0,onPress:this._onClick,onKeyPress:this._onKeyPress,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,accessibilityTraits:o.Types.AccessibilityTrait.Button,blockPointerEvents:!1,tabIndex:0},{children:y}),"BingCaptionWrapper-"+this.state.mri)}render(){var e,t,i,a;const n=l.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds,o=0===(null===(t=null===(e=this.state.renderInfo)||void 0===e?void 0:e.videoDimensions)||void 0===t?void 0:t.height)||0===(null===(a=null===(i=this.state.renderInfo)||void 0===i?void 0:i.videoDimensions)||void 0===a?void 0:a.width);return this.props.hideCaption||!n.showBackgroundCaptions||this.state.streamType!==s.StreamType.Video||o?[void 0]:[this._getOptionalBackgroundEffectInfo()]}_getCaptionOffset(){let e=16,t=16;if(this.props.isCallStageV2){const i=this.props.isInTray?10:12;e=i,t=i}return this.state.captionOffsets&&(e=this.state.captionOffsets.y,t=this.state.captionOffsets.x),{top:e,left:t}}_extractMriForKey(e,t,i=!1){return(null==e?void 0:e.isLocal)?T.default.getSkypeMri():h.default.extractMriFromKey(t,i)}_layoutController(){var e,t;return this.props.layoutController(this.props.renderKey,!!(null===(t=null===(e=this.state)||void 0===e?void 0:e.renderInfo)||void 0===t?void 0:t.renderScreenShare))}_findSizeAndOffset(){if(this.isComponentMounted()){const e=this._layoutController();if(e.viewRect){const t=e.viewRect();this.setState({width:t.width,height:t.height,isCollapsed:this._isCollapsed(t.width,this.props.noExpand)})}}}_iconView(e,t){return l.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.useBingLogoInsteadOfSearchIcon?(0,a.jsx)(o.Image,{source:r.Collection.BING_LOGO_SMALL,style:[t,R.bingIconLeft],resizeMode:"cover"}):e?(0,a.jsx)(m.default,{icon:e,color:P.Color.white,size:v.IconSize.size16,style:t}):void 0}}t.CallParticipantBackgroundReplaceCaption=x,t.default=x},939193:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(148540),s=i(496486),r=i(680837),l=i(581760),c=i(711828),d=i(915877),u=i(912770),h=i(502278),p=i(733754),g=i(436237),C=i(480200),S=i(471727),m=i(110117),y=i(109520),f=i(853374),b=i(746096),_=i(24576),T=i(796625),v=i(380306),w=(0,d.lazyProperties)({gestureButton:()=>n.Styles.createButtonStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",backgroundColor:l.Color.transparent}),gestureButtonInsets:()=>n.Styles.createViewStyle({left:-20,right:-20,top:0,bottom:-40}),innerContainer:()=>r.default.absoluteFill,innerContainerCentered:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"flex-end",paddingBottom:5})});class I extends _.default{constructor(){super(...arguments),this._isPressed=!1,this._isPanning=!1,this._isResizing=!1,this._handleMouseCursorChange=e=>{this.setState({mouseCursor:e})},this._handleZoomLevelChange=e=>{this.setState({zoomLevel:e})},this._setZoomLevelFromUIControls=e=>{var t;null===(t=this._zoomController)||void 0===t||t.handleUIControlsZoom(e)},this._handleLayoutChange=e=>{var t;null===(t=this._zoomController)||void 0===t||t.updateScreenShareElementSizes(e)},this._onLongPressHandler=()=>this.props.showContextMenu||this._shouldShowContextMenuForNewStage()?this.props.getContextMenuHandler(!1):this._onLongPress,this._onMultiTouchGesture=e=>{if(this.isComponentMounted()&&this.props.zoomEnabled){if(!this._isPanning){Math.abs(e.initialCenterPageX-e.centerPageX)>20&&(this._isPanning=!0)}if(this._isPanning){const t=this._panPosition||{x:e.centerPageX,y:e.initialCenterPageY},i={x:e.centerPageX,y:e.centerPageY},a=i.x-t.x,n=i.y-t.y,o=this.props.getCallParticipantVideoViews();s.each(o,(e=>{var t;return null===(t=e.getVideoElement())||void 0===t?void 0:t.panVideo({x:a,y:n})})),this._panPosition=i}else{const t=e.distance/e.initialDistance;this.props.sizeToFit?t>=1.3&&(h.default.onZoomIn(this.props.callId||""),g.track(new y.Zoom),this.props.setSizeToFit(!1)):t<=.7&&(h.default.onZoomOut(this.props.callId||""),g.track(new y.Zoom),this.props.setSizeToFit(!0))}}e.isComplete&&(this._panPosition=void 0,this._isPanning=!1)},this._onPressIn=()=>{this._isPressed=!0,this.props.onPressInOrOut&&(this._pressedTimerToken=u.default.setTimeout((()=>{this.isComponentMounted()&&this._isPressed&&this.props.onPressInOrOut&&this.props.onPressInOrOut(this.props.renderKey,!!this.props.isCompact,!0)}),350))},this._onPressOut=()=>{this._isPressed=!1,void 0!==this._pressedTimerToken&&(u.default.clearTimeout(this._pressedTimerToken),this._pressedTimerToken=void 0),this.props.onPressInOrOut&&this.props.onPressInOrOut(this.props.renderKey,!!this.props.isCompact,!1)},this._onLongPress=()=>{},this._onScrollWheel=e=>{var t;null===(t=this._zoomController)||void 0===t||t.handleScrollZoom(e)},this._onPan=e=>{if(this._zoomController)return void this._zoomController.handleDragging(e);const t=this._getViewClientRect();if(this.props.zoomEnabled&&!this.props.isCompact){const t=this._panPosition||{x:e.pageX,y:e.initialPageY},i={x:e.pageX,y:e.pageY},a=i.x-t.x,n=i.y-t.y,o=this.props.getCallParticipantVideoViews();s.each(o,(e=>{var t;return null===(t=e.getVideoElement())||void 0===t?void 0:t.panVideo({x:a,y:n})})),this._panPosition=i,e.isComplete&&(this._panPosition=void 0)}const i=S.default.shouldStartSimulateViewResizing(!!this.props.enableFloatableResizableVideoPreview,this.props.isLocal,this.props.shouldRenderVideo,!this.props.isDragging,this._mousePosition!==C.CallingViewCornerPostion.NotAtCorner);if(this.props.onResize&&(i||this._isResizing)){const i=this._resizePosition||{x:e.pageX,y:e.initialPageY},a={x:e.pageX,y:e.pageY},n=a.x-i.x,o=a.y-i.y;if(this._isResizing=!0,void 0===this._resizePosition&&(this._lastViewLayoutBeforeResizing=t,this._resizePosition=a,this._mouseResizeSessionStartPosition=this._mousePosition),t&&this._lastViewLayoutBeforeResizing&&void 0!==this._resizePosition){let i=1,s=this._lastViewLayoutBeforeResizing.y,r=0;switch(this._mouseResizeSessionStartPosition){case C.CallingViewCornerPostion.UpperLeft:i=n>0&&o>0||n>0&&0===o||0===n&&o<0?-1:1,s=this._lastViewLayoutBeforeResizing.y,r=s-a.y;break;case C.CallingViewCornerPostion.UpperRight:i=n<0&&o>0||n<0&&0===o||0===n&&o>0?-1:1,s=this._lastViewLayoutBeforeResizing.y,r=s-a.y;break;case C.CallingViewCornerPostion.BottomLeft:i=n>0&&o<0||n>0&&0===o||0===n&&o<0?-1:1,s=this._lastViewLayoutBeforeResizing.y+this._lastViewLayoutBeforeResizing.height,r=a.y-s;break;case C.CallingViewCornerPostion.BottomRight:i=n<0&&o<0||n<0&&0===o||0===n&&o<0?-1:1,s=this._lastViewLayoutBeforeResizing.y+this._lastViewLayoutBeforeResizing.height,r=a.y-s}r=1===i?r>=0?r:0:r<=0?r:0;const l=Math.abs(r)/this._lastViewLayoutBeforeResizing.height*i+1;if(void 0!==this._mouseResizeSessionStartPosition){const i=this.isComponentMounted()?this.props.getLayoutController():void 0;i&&i.resizeRect&&i.resizeRect(l,t.height,this._mouseResizeSessionStartPosition,e.isComplete),this.props.onResize(this.props.renderKey)}if(e.isComplete){const e=f.default.newCauseId();g.log(b.LogTraceArea.CallingUI,this.props.parentViewId+"._onPan, causeId: "+e),this.props.callId&&h.default.updateCallTelemetry(this.props.callId,e,(e=>e.resizeOwnPreview())),this._resizePosition=void 0,this._isResizing=!1,this._mouseResizeSessionStartPosition=void 0}}}else if(this.props.onPan){if(this.props.isLocal&&!this.props.shouldRenderVideo)return;!this.props.isDragging||e.isComplete?t?this.props.onPan(this.props.renderKey,e,t):this.props.onPan(this.props.renderKey,e):this.props.onPan(this.props.renderKey,e,t)}},this._onTap=e=>{this.props.isCompact&&this.props.onMouseOverOrOut&&this.props.onMouseOverOrOut(this.props.renderKey,!0,!1);const t=this._getNormalizedTimestamp(e);this.props.onDoubleTap?this._isDoubleTap(e)?(this._cancelDoubleTapTimer(),this._sendDoubleTapEvent(),this._lastTapEvent=void 0):(this._reportDelayedTap(t),this._startDoubleTapTimer(e)):this._sendTapEvent(t)},this._sendTapEvent=e=>{this.props.onTap&&this.props.onTap(this.props.renderKey,e)},this._onMouseMove=e=>{this._setMouseOver(),this._mayChangeMouseCursor(e)},this._onMouseEnter=e=>{e.stopPropagation(),this._setMouseOver(),this._mayChangeMouseCursor(e)},this._onMouseLeave=e=>{this.props.onMouseOverOrOut&&(this.props.enableFloatableResizableVideoPreview?u.default.sleep(1e3).then((()=>{this.props.onMouseOverOrOut&&this.props.onMouseOverOrOut(this.props.renderKey,!!this.props.isCompact,!1)})):this.props.onMouseOverOrOut(this.props.renderKey,!!this.props.isCompact,!1)),this.props.isCallStageV2||this.props.setHovering(!1),this._setApplyGestureInsets(!1)}}_buildState(e,t){const i={};return t&&(i.applyGestureButtonInsets=!1,i.mouseCursor=void 0,i.zoomLevel=0),i}componentDidMount(){super.componentDidMount(),this.props.isScreenShareZoomEnabled&&(this._zoomController=new T.default({getVideoElement:this.props.getScreenShareVideoElement,onMouseCursorChange:this._handleMouseCursorChange,onZoomLevelChange:this._handleZoomLevelChange,callId:this.props.callId||""}))}componentWillUnmount(){super.componentWillUnmount(),this._stopZoomController()}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),!this.props.zoomEnabled&&e.zoomEnabled&&(this._isPanning=!1,this._panPosition=void 0),!this.props.enableVideoGestures&&e.enableVideoGestures&&this.props.zoomEnabled){const e=this.props.getCallParticipantVideoViews();s.each(e,(e=>{var t;return null===(t=e.getVideoElement())||void 0===t?void 0:t.resetPan()}))}}render(){const e=this.props.isCompact&&this.state.applyGestureButtonInsets&&!this.props.enableFloatableResizableVideoPreview,t=[w.gestureButton,e?w.gestureButtonInsets:void 0],i=(this.props.enableFloatableResizableVideoPreview||!this.props.enableFloatableResizableVideoPreview)&&!0,o=i?[w.innerContainer,r.default.overflowVisible,n.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1)]:[w.innerContainerCentered,r.default.overflowVisible];return(0,a.jsxs)(n.View,Object.assign({style:{flex:1},onLayout:this._handleLayoutChange},{children:[(0,a.jsxs)(n.GestureView,Object.assign({style:o,onPan:this._onPan,onPinchZoom:this.props.zoomEnabled?this._onMultiTouchGesture:void 0,onScrollWheel:this._onScrollWheel,panPixelThreshold:this.props.isCompact?void 0:25,mouseOverCursor:this.state.mouseCursor,importantForAccessibility:this._getImportantForAccessibility(i)},{children:[this.props.contentView,i?this._getOptionalFlipIcon():void 0,this.props.accessoryView,this.props.optionalRaiseHandAccessory,i?(0,a.jsx)(n.View,{style:t,onPress:this.props.onTap?this._onTap:void 0,onLongPress:this.props.onTap?this._onLongPress:void 0,onMouseMove:this.props.onMouseOverOrOut?this._onMouseMove:void 0,onMouseEnter:this.props.onMouseOverOrOut?this._onMouseEnter:void 0,onMouseLeave:this.props.onMouseOverOrOut?this._onMouseLeave:void 0,accessibilityLabel:this.props.displayName,accessibilityTraits:n.Types.AccessibilityTrait.Button,onContextMenu:this.props.showContextMenu||this._shouldShowContextMenuForNewStage()?this.props.getContextMenuHandler(!1):void 0}):(0,a.jsx)(n.Button,{style:t,onPress:this.props.onTap?this._onTap:void 0,onPressOut:this._onPressOut,onPressIn:this._onPressIn,onLongPress:this.props.enableActionMenuOnMobile&&this.props.onTap?this._onLongPressHandler():void 0,onHoverStart:this.props.onMouseOverOrOut?this._onMouseEnter:void 0,onHoverEnd:this.props.onMouseOverOrOut?this._onMouseLeave:void 0,accessibilityLabel:this._getAccessibilityLabel(),onContextMenu:this.props.showContextMenu?this.props.getContextMenuHandler(!1):void 0,tabIndex:this.props.isCompact?void 0:-1}),this.props.optionalNameTagLine,this.props.optionalBackgroundInfo]}),"gestureView"),this._renderScreenShareZoomControls()]}))}_stopZoomController(){this._zoomController&&(this._zoomController.stop(),this._zoomController=void 0)}_renderScreenShareZoomControls(){return this.props.isScreenShareZoomEnabled?(0,a.jsx)(v.default,{setZoomLevel:this._setZoomLevelFromUIControls,currentZoomLevel:this.state.zoomLevel,isNavigatingWithKeyboard:this.props.isNavigatingWithKeyboard}):void 0}_getImportantForAccessibility(e){return this.props.isNavigatingWithKeyboard&&this.props.isCompact?n.Types.ImportantForAccessibility.NoHideDescendants:n.Types.ImportantForAccessibility.No}_getOptionalFlipIcon(){if(this.props.allowCameraFlip&&this.props.camera&&this.props.showControls)return(0,a.jsx)(m.default,{color:l.Color.white,size:c.IconSize.size18,icon:c.SkypeIcon.SwitchCamera})}_getAccessibilityLabel(){if(this.props.isCompact){if(this.props.allowCameraFlip&&this.props.camera){if(this.props.camera.position===o.CameraPosition.Front)return p.getString("CallControls.CallButtonSwitchCameraBackwardLabel");if(this.props.camera.position===o.CameraPosition.Back)return p.getString("CallControls.CallButtonSwitchCameraForwardLabel")}return this.props.displayName}}_shouldShowContextMenuForNewStage(){return!!this.props.isCallStageV2&&(!this.props.isLargeGridBot&&!this.props.isAScreensharing&&(!this.props.isTogetherModeBot||this.props.showChangeTogetherModeBackgroundOption))}_isDoubleTap(e){if(!this._lastTapEvent)return!1;return this._getEventTimestamp(e)-this._getEventTimestamp(this._lastTapEvent)<=200}_startDoubleTapTimer(e){this._lastTapEvent=e;const t=this._getNormalizedTimestamp(e);this._doubleTapTimer=u.default.setTimeout((()=>{this.isComponentMounted()&&(this._reportDelayedTap(t),this._doubleTapTimer=void 0)}),200)}_cancelDoubleTapTimer(){this._doubleTapTimer&&(u.default.clearTimeout(this._doubleTapTimer),this._doubleTapTimer=void 0)}_reportDelayedTap(e){this._lastTapEvent&&this.props.onTap&&(this._sendTapEvent(e),this._lastTapEvent=void 0)}_sendDoubleTapEvent(){this.props.onDoubleTap&&this.props.onDoubleTap(this.props.renderKey)}_getEventTimestamp(e){return e.timeStamp?e.timeStamp.valueOf():0}_getNormalizedTimestamp(e){return Date.now()}_setApplyGestureInsets(e){this.isComponentMounted()&&this.state.applyGestureButtonInsets!==e&&this.setState({applyGestureButtonInsets:e})}_mayChangeMouseCursor(e){const t=this._getViewCallUIPosition(),i=!!t&&(t===C.CallingViewUIPostion.Ribbon||t===C.CallingViewUIPostion.FloatingOnTop);if(this.isComponentMounted()&&this.props.enableFloatableResizableVideoPreview&&this.props.isLocal&&i&&this.props.shouldRenderVideo){const t=e.clientX,i=e.clientY,a=this._getViewClientRect();this._mousePosition=S.default.getMouseCornerPosition(t,i,a);let o=n.Types.GestureMouseCursor.Default;this.props.isDragging||this._mousePosition===C.CallingViewCornerPostion.NotAtCorner&&!this._isResizing||(this._mousePosition!==C.CallingViewCornerPostion.BottomLeft&&this._mousePosition!==C.CallingViewCornerPostion.UpperRight||(o=n.Types.GestureMouseCursor.NESWResize),this._mousePosition!==C.CallingViewCornerPostion.UpperLeft&&this._mousePosition!==C.CallingViewCornerPostion.BottomRight||(o=n.Types.GestureMouseCursor.NWSEResize)),this.setState({mouseCursor:o})}}_getViewClientRect(){const e=this.props.getLayoutController();return e&&e.viewRect?e.viewRect(!0):void 0}_getViewCallUIPosition(){const e=this.props.getLayoutController();return e&&e.getUIPosition?e.getUIPosition():void 0}_setMouseOver(){this.props.isDragging||(this.props.onMouseOverOrOut&&this.props.onMouseOverOrOut(this.props.renderKey,!!this.props.isCompact,!0),this.isComponentMounted()&&(this.props.isCompact?this.state.applyGestureButtonInsets||this.setState({applyGestureButtonInsets:!0}):this.props.isCallStageV2||this.props.setHovering(!0)))}}t.default=I},653514:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(24576),s=i(581760),r=i(915877),l=i(471727),c=i(30098),d=(0,r.lazyProperties)({nameTag:()=>n.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:10,alignItems:"center",justifyContent:"center",overflow:"visible"}),nametagAndAccessoriesLine:()=>n.Styles.createViewStyle({position:"absolute",flexDirection:"row",justifyContent:"space-between",bottom:12,left:12,right:12,alignSelf:"stretch",flexBasis:0,flexGrow:1,overflow:"hidden",alignItems:"flex-end"}),nametagAndAccessoriesLineTray:()=>n.Styles.createViewStyle({bottom:10,left:10,right:10}),presenterAccessory:()=>n.Styles.createViewStyle({width:24,height:24,borderRadius:12,backgroundColor:s.Color.white,alignItems:"center",justifyContent:"center",marginLeft:8,overflow:"hidden"}),smallAccessoryInnerView:()=>n.Styles.createViewStyle({width:20,height:20,borderRadius:10,backgroundColor:s.Color.white,alignItems:"center",justifyContent:"center"}),smallAccessoryInnerScreenshareView:()=>n.Styles.createViewStyle({backgroundColor:s.Color.white}),desktopNameTag:()=>n.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),desktopNameTagLeft:()=>n.Styles.createViewStyle({position:"relative",alignItems:"flex-end",alignSelf:"stretch",flexDirection:"row",flexShrink:1,left:0,right:0,overflow:"hidden"})});class u extends o.default{render(){if(this.props.isCallStageV2){let e;if(this.props.isPresenter){const t=l.default.getShareScreenIcon(!0),i=[d.smallAccessoryInnerView,d.smallAccessoryInnerScreenshareView];e=(0,a.jsx)(n.Animated.View,Object.assign({style:d.presenterAccessory,ignorePointerEvents:!0},{children:this.props.getDesktopAccessory(i,t)}))}const t=[d.nametagAndAccessoriesLine,this.props.isInTray?d.nametagAndAccessoriesLineTray:void 0];return(0,a.jsxs)(n.View,Object.assign({style:t},{children:[this._getOptionalNameTag(),e]}))}return this._getOptionalNameTag()}_getOptionalNameTag(){var e;const t=[this.props.desktopNameTag?d.desktopNameTag:d.nameTag,this.props.isCallStageV2?d.desktopNameTagLeft:void 0];this.props.nametagOpacityStyle&&t.push(this.props.nametagOpacityStyle);const i=null===(e=this.props.nametagPosition)||void 0===e?void 0:e.offset;if(i&&t.push(n.Styles.createViewStyle({bottom:i},!1)),this.props.callId&&this.props.conversationMri)return(0,a.jsx)(n.Animated.View,Object.assign({style:t,ignorePointerEvents:!0},{children:(0,a.jsx)(c.CallParticipantNametagView,{hoveringKey:this.props.renderScreenShare?void 0:this.props.renderKey,callId:this.props.callId,isLocal:this.props.isLocal,conversationMri:this.props.conversationMri,onToggleCropVideoClicked:this.props.toggleCropUncropVideo,sizeToFit:this.props.sizeToFit,isRenderingVideo:this.props.isRenderingVideo,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,isCallStageV2:this.props.isCallStageV2,showMoreIcon:this.props.hovering,isOnHold:this.props.isOnHold,useLightTheme:this.props.useLightTheme,isInTray:this.props.isInTray})}))}}t.default=u},30098:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantNametagView=t.CallParticipantNametag=void 0;const a=i(785893),n=i(516778),o=i(781770),s=i(994224),r=i(488717),l=i(480200),c=i(471727),d=i(905531),u=i(671830),h=i(911009),p=i(677381),g=i(952262),C=i(915877),S=i(18078),m=i(216582),y=i(390244),f=i(581760),b=i(711828),_=i(849776),T=i(871499),v=i(662602),w=(0,C.lazyProperties)({floatingNameTag:()=>n.Styles.createViewStyle({marginTop:10}),toolTipContainer:()=>n.Styles.createViewStyle({height:24}),toolTipContainerRaiseHand:()=>n.Styles.createViewStyle({overflow:"visible",paddingLeft:5}),toolTipContainerRaiseHandV2:()=>n.Styles.createViewStyle({overflow:"hidden",paddingLeft:35}),nametagBgColorStyle:()=>n.Styles.createViewStyle({backgroundColor:f.Color.blackOverlay50}),nametagBgColorStyleLightThemeStage:()=>n.Styles.createViewStyle({backgroundColor:f.Color.whiteOverlay80}),nametagBgColorStyleLightThemeTray:()=>n.Styles.createViewStyle({backgroundColor:f.Color.gray50overlay95}),nametagBgColorStyleHover:()=>n.Styles.createViewStyle({backgroundColor:f.Color.blackOverlay80}),nametagBgColorStyleHoverLightTheme:()=>n.Styles.createViewStyle({backgroundColor:f.Color.whiteOverlay90}),raisedHandIconV2:()=>n.Styles.createViewStyle({position:"absolute",left:0,bottom:-6}),wrapperStageV2:()=>n.Styles.createViewStyle({height:36,justifyContent:"flex-end",flexGrow:0,flexShrink:1})});class I extends p.default{constructor(){super(...arguments),this._updateAnchorRect=e=>{!e&&this.state.hoveringKey&&this.props.getAnchorInfo&&(e=this.props.getAnchorInfo(this.state.hoveringKey)),this._popupView&&e&&this._popupView.updatePosition(e)},this._onPopupViewRef=e=>{this._popupView=e||void 0},this._getPopUpPositions=e=>[h.PopupAnchorPositon.Bottom],this._getAnchorInfo=()=>{if(this.props.getAnchorInfo&&this.state.hoveringKey)return this.props.getAnchorInfo(this.state.hoveringKey)},this._renderPopupContent=()=>(0,a.jsx)(P,{style:w.floatingNameTag,opacityStyle:this.props.opacityStyle,hoveringKey:this.state.hoveringKey,callId:this.props.callId,conversationMri:this.props.conversationMri,isLocal:this.state.hoveringKey===l.CallStageElementKeys.localUserKey,isRenderingVideo:!1,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,onNametagMouseEnter:this.props.onNametagMouseEnter,onNametagMouseLeave:this.props.onNametagMouseLeave,isCompact:!0,isOnHold:this.props.isOnHold})}_buildState(e,t){const i=o.default.getCurrentHoveringParticipantConfig();return{hoveringKey:i?i.key:void 0}}componentDidMount(){super.componentDidMount(),this._updateAnchorRect(),this.state.hoveringKey&&this._updateAnchorRectAndSubscribeForChanges(this.state.hoveringKey)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.hoveringKey===t.hoveringKey&&this.props.parentDimensions===e.parentDimensions||(this.state.hoveringKey?this._updateAnchorRectAndSubscribeForChanges(this.state.hoveringKey):this._unsubscribeFromAnchorRectChanges())}componentWillUnmount(){super.componentWillUnmount(),this._unsubscribeFromAnchorRectChanges()}_updateAnchorRectAndSubscribeForChanges(e){this._updateAnchorRect(),this._unsubscribeFromAnchorRectChanges(),this.props.getAnchorInfoChanges&&(this._rectChangeSubscriptionToken=this.props.getAnchorInfoChanges(e,this._updateAnchorRect))}_unsubscribeFromAnchorRectChanges(){this._rectChangeSubscriptionToken&&(this._rectChangeSubscriptionToken.unsubscribe(),this._rectChangeSubscriptionToken=void 0)}render(){return this.state.hoveringKey?(0,a.jsx)(m.default,{ref:this._onPopupViewRef,disablePositionAnimation:!0,getAnchorInfo:this._getAnchorInfo,getPopupPositions:this._getPopUpPositions,renderPopup:this._renderPopupContent,allowTaps:!0,ignorePointerEvents:!0},this.state.hoveringKey):null}}t.CallParticipantNametag=I;class P extends p.default{constructor(){super(...arguments),this._onUserNameChevronOverflowPress=e=>{"key"in e?v.default.measureLayoutRelativeToWindow((()=>this._nametagRef)).then((({x:e,y:t})=>{this.props.isLocal?r.default.showLocalVideoActionsContextMenuOnPosition({x:e,y:t},this._getRootViewId(),this._getCallLocalVideoContextMenuOptions(),this.props.onToggleCropVideoClicked):r.default.showParticipantActionsContextMenuOnPosition({x:e,y:t},this._getRootViewId(),this._getCallParticipantContextMenuOptions(),this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this.props.onToggleCropVideoClicked)})):this.props.isLocal?r.default.showLocalVideoActionsContextMenu(e,this._getRootViewId(),this._getCallLocalVideoContextMenuOptions(),this.props.onToggleCropVideoClicked):r.default.showParticipantActionsContextMenu(e,this._getRootViewId(),this._getCallParticipantContextMenuOptions(),this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this.props.onToggleCropVideoClicked)},this._onMouseEnter=e=>{this.props.onNametagMouseEnter&&this.props.hoveringKey&&this.props.onNametagMouseEnter(e,this.props.hoveringKey)},this._onMouseLeave=e=>{this.props.onNametagMouseEnter&&this.props.hoveringKey&&this.props.onNametagMouseEnter(e,this.props.hoveringKey)},this._setNametagRef=e=>{this._nametagRef=e||void 0}}_buildState(e,t){const i=!e.isLocal&&e.hoveringKey?u.asMriMaybe(e.hoveringKey):void 0,a=!e.isLocal;let n,o,r;if(a&&e.hoveringKey&&(n=s.default.CallingStore.findRemoteCallMember(e.callId,e.hoveringKey)),e.isLocal){const e=S.default.getSkypeMri();o=g.default.getDisplayName(e),r=e}else i&&(o=g.default.getDisplayName(i),r=i);const d=!!r&&!!e.callId&&s.default.CallingStore.isHandRaisedForMri(r,e.callId),h=u.isGroupConversation(e.conversationMri),p={displayName:o,participantViewMuteIconEnabled:a,isServerMutedSupported:!!n&&s.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(e.callId,n),isLocalMuteSupported:s.default.CallingStore.getLocalMuteSupported(e.callId),isMuted:e.isLocal?c.default.isLocalOrServerMuted(e.callId):!!n&&n.isServerMuted,isGroupCall:h,isCallConnected:s.default.CallingStore.isCallConnected(e.callId),isHandRaised:d};{const t=s.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:s.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:s.default.CallingStore.isEncryptedCall(e.callId),conversationMri:e.conversationMri,callId:e.callId});p.participantViewActionsEnabled=!e.isLocal,p.tooltipsShowing=T.default.getToolTipConfig(this._getRootViewId()).displayText.length>0,p.localVideoActionsEnabled=e.isLocal&&t,p.isPinned=c.default.isCallParticipantPinned(e.isLocal?l.CallStageElementKeys.localUserKey:r,e.callId)}return p}_getCallParticipantContextMenuOptions(){const e=this.props.hoveringKey;return{callId:this.props.callId,conversationMri:this.props.conversationMri,userMri:e,isLocal:this.props.isLocal,isGroupCall:this.state.isGroupCall,isLocalMuteSupported:this.state.isLocalMuteSupported,isMuted:this.state.isMuted,isServerMutedSupported:this.state.isServerMutedSupported,sizeToFit:this.props.sizeToFit,isCompact:!!this.props.isCompact,isRenderingVideo:this.props.isRenderingVideo,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showMute:!1,showMuteEveryone:!1,isMuteOptionDisabled:!1,showRemoveCall:!1,showSendMessageMenuOption:d.default.call().canSendMessageToParticipant,showCropVideoOption:!1,showFullVideoOption:!1,showViewProfile:d.default.navigation().canAccessUserDetails,showLowerHandOption:this.state.isHandRaised,showChangeTogetherModeBackgroundOption:!1,showPinOption:c.default.shouldShowCallParticipantPinOption(e,this.props.callId),showUnpinOption:c.default.shouldShowCallParticipantUnpinOption(e,this.props.callId)}}_getCallLocalVideoContextMenuOptions(){return r.default.getCallLocalVideoContextMenuOptions(this.props.callId,this.props.conversationMri,!!this.props.isCompact,this.props.isRenderingVideo,this.props.sizeToFit,this.state.isHandRaised)}_getToolTipStyleV2(){return this.props.useLightTheme?this.props.isInTray?w.nametagBgColorStyleLightThemeTray:w.nametagBgColorStyleLightThemeStage:w.nametagBgColorStyle}render(){const e=this.state.displayName?this.state.displayName:void 0,t=!this.props.isCompact&&this.state.isMuted?b.SkypeIcon.MicrophoneOff:void 0;!this.props.isCompact&&this.props.isOnHold?b.SkypeIcon.Pause:this.state.isMuted&&b.SkypeIcon.MicrophoneOff;if(!this.state.isCallConnected||!e||!this.props.isCallStageV2&&!this.state.isGroupCall&&!this.state.isMuted)return null;const i=c.default.getUserOptionsAccessibilityLabel(e,this.state.isMuted,this.state.isHandRaised),o=[this.props.style,this.props.opacityStyle,w.toolTipContainer,this.props.isCallStageV2?this._getToolTipStyleV2():void 0];let s,r;this.state.isHandRaised&&!this.props.isCompact&&(this.props.isCallStageV2?(o.push(w.toolTipContainerRaiseHandV2),r=(0,a.jsx)(n.View,Object.assign({style:w.raisedHandIconV2},{children:(0,a.jsx)(y.default,{type:y.RaiseHandImageType.MediumSizeCenterAligned})}))):(o.push(w.toolTipContainerRaiseHand),s=(0,a.jsx)(y.default,{type:y.RaiseHandImageType.MediumSizeCenterAligned})));const l=[];this.state.isPinned&&l.push(b.SkypeIcon.Pin);let d=this.props.isCallStageV2?t:void 0;this.props.isOnHold&&(d=b.SkypeIcon.Pause),l.push(d);let u=b.SkypeIcon.More;this.props.isCallStageV2&&(this.props.showMoreIcon?o.push(this.props.useLightTheme?w.nametagBgColorStyleHoverLightTheme:w.nametagBgColorStyleHover):u=void 0),l.push(u);const h=this.props.useLightTheme?f.Color.gray400:void 0,p=(0,a.jsx)(_.default,{style:o,displayText:e,leftIcon:this.props.isCallStageV2?void 0:t,leftElement:s,rightIcons:l,onPress:this._onUserNameChevronOverflowPress,accessibilityLabel:i,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,ellipseCaption:this.props.isCallStageV2,textColor:h,ref:this._setNametagRef});if(this.props.isCallStageV2)return(0,a.jsxs)(n.View,Object.assign({style:w.wrapperStageV2},{children:[p,r]}));const g=(0,a.jsx)(_.default,{style:o,displayText:e,leftElement:s,textColor:h}),C=(0,a.jsx)(_.default,{style:o,displayText:e,leftIcon:t,leftElement:s,textColor:h});(0,a.jsx)(_.default,{style:o,displayText:e,leftIcon:this.props.isOnHold?b.SkypeIcon.Pause:t,leftElement:s,textColor:h});return this.state.participantViewMuteIconEnabled||this.state.participantViewActionsEnabled||this.state.localVideoActionsEnabled?!this.state.isGroupCall&&t?C:this.state.participantViewMuteIconEnabled&&this.state.participantViewActionsEnabled||this.state.localVideoActionsEnabled?p:g:g}}t.CallParticipantNametagView=P,t.default=I},892831:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(889391),r=i(278968),l=i(676455),c=i(696104),d=i(746096),u=i(436237),h=i(915877),p=i(478262),g=i(626712),C=i(351077),S=(0,h.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center"})});class m extends o.ComponentBase{constructor(){super(...arguments),this._onMaybeHandleReaction=e=>{if(u.log(d.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid),!this.isComponentMounted())return u.log(d.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (not mounted)"),!1;const t=!e.reaction.isEmoticonCallReaction()&&e.reactionsTextStyle===p.ReactionsTextStyle.Default;return this.state.enableSimpleTextReactions?(u.log(d.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (simple text reactions enabled)"),!1):t&&this.props.isCompact?(u.log(d.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" NOT handled (compact text reaction)"),!1):(this.setState({reactionInfo:e}),u.log(d.LogTraceArea.CallReactions,"CallParticipantReactionView._onMaybeHandleReaction cuid: "+e.reaction.cuid+" handled"),!0)}}_buildState(e,t){const i=s.default.getS4LCMCFeatures(),a={enableSimpleTextReactions:i.enableSimpleTextReactions};return t&&(a.reactionInfo=void 0),a.newAnimatedReaction=i.callAnimatedReactionsConfig.callAnimatedReactionsKeys,a}componentDidMount(){if(super.componentDidMount(),this.props.getCallReactionsDisplayHelper){this.props.getCallReactionsDisplayHelper().registerParticipantReactionCallback(this.props.participantMri,this._onMaybeHandleReaction)}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),t.reactionInfo&&t.reactionInfo.isLocal){const e=r.default.maybeGetAndClearReactionPressedScenario();e&&(e.markPerfTargetStepCompleted("componentDidUpdate"),Promise.resolve().then((()=>{e.markStepCompleted("backOnJSThread"),e.finish()})))}}componentWillUnmount(){if(super.componentWillUnmount(),this.props.getCallReactionsDisplayHelper){const e=this.props.getCallReactionsDisplayHelper();e.unregisterParticipantReactionCallback(this.props.participantMri),e.dismissReaction(this.props.participantMri)}}render(){let e;if(this.state.reactionInfo){let t,i=this.state.reactionInfo.content;if(this.state.reactionInfo.reaction.isEmoticonCallReaction())t=c.CallReactionType.Emoji,i=this.state.reactionInfo.reaction.getEmoticonCallReactionKey();else if(C.hasQuote(this.state.reactionInfo.reaction.content))t=c.CallReactionType.Quote;else if(g.default.isUrlValid(this.state.reactionInfo.content))t=c.CallReactionType.Link;else if(this.state.reactionInfo.reactionsTextStyle===p.ReactionsTextStyle.Sticker)t=c.CallReactionType.Sticker;else if(this.state.reactionInfo.reactionsTextStyle===p.ReactionsTextStyle.Snapshot)t=c.CallReactionType.Snapshot;else{if(this.state.reactionInfo.reactionsTextStyle===p.ReactionsTextStyle.Animation)return null;if(this.state.reactionInfo.isLocal)return null;t=c.CallReactionType.Text}const o=[];this.props.borderRadius&&o.push(n.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1)),i&&(e=(0,a.jsx)(l.default,{style:o,reactionType:t,cuid:this.state.reactionInfo.reaction.cuid,callId:this.props.callId,content:i,reaction:this.state.reactionInfo.reaction,showBackgroundGradient:this.state.reactionInfo.reactionsTextStyle!==p.ReactionsTextStyle.Animation,gradientColors:this.state.reactionInfo.gradientColors,isCompact:this.props.isCompact,borderRadius:this.props.borderRadius,ignorePointerEvents:!0}))}return(0,a.jsx)(n.View,Object.assign({style:S.container,ignorePointerEvents:!0},{children:e}))}}t.default=m},154174:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantTalkingView=t.CallParticipantTalkingViewSize=void 0;const a=i(785893),n=i(516778),o=i(217041),s=i(889391),r=i(915877),l=i(445026),c=i(581760),d=120;var u;!function(e){e[e.CompactSmall=60]="CompactSmall",e[e.CompactLarge=100]="CompactLarge",e[e.Large=120]="Large"}(u=t.CallParticipantTalkingViewSize||(t.CallParticipantTalkingViewSize={}));const h=(0,r.lazyProperties)({compactSmall:()=>(0,r.lazyProperties)({container:()=>n.Styles.createViewStyle({height:60,width:60,overflow:"visible"}),ring:()=>n.Styles.createViewStyle({position:"absolute",top:-0,left:-0,width:60,height:60,borderRadius:30})}),compactLarge:()=>(0,r.lazyProperties)({container:()=>n.Styles.createViewStyle({height:100,width:100,overflow:"visible"}),ring:()=>n.Styles.createViewStyle({position:"absolute",top:-0,left:-0,width:100,height:100,borderRadius:50})}),large:()=>(0,r.lazyProperties)({container:()=>n.Styles.createViewStyle({height:d,width:d,overflow:"visible"}),ring:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,width:d,height:d,borderRadius:60})}),roundedRect:()=>n.Styles.createViewStyle({borderRadius:12}),videoContainer:()=>n.Styles.createViewStyle({position:"absolute",top:-0,left:-0,bottom:-0,right:-0}),videoInnerContainer:()=>n.Styles.createViewStyle({flex:1,borderRadius:12})});class p extends o.ComponentBase{constructor(){super(...arguments),this._isTalking=!1,this._ringScaleAnimatedValue=new n.Animated.Value(1),this._ringScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._ringScaleAnimatedValue}]}),this._defaultAnimatedColorValue=new n.Animated.Value(0),this._defaultAnimatedColorStyle=n.Styles.createAnimatedViewStyle({backgroundColor:this._defaultAnimatedColorValue.interpolate({inputRange:[0,1],outputRange:[c.Color.blackOverlay20,c.Color.white]})})}_buildState(e,t){const i={disableParticipantTalkingAnimation:s.default.getS4LCMCFeatures().disableParticipantTalkingAnimation};return t&&(i.isAnimating=!1),i}componentDidMount(){super.componentDidMount(),this._updateTalkingRing()}updateTalking(e){this._isTalking!==e&&(this._isTalking=e,this._updateTalkingRing())}_updateTalkingRing(){this._isTalking&&!this.state.isAnimating&&this._startLoopingAnimation()}_startLoopingAnimation(){this.state.disableParticipantTalkingAnimation||(this._loop(),this._updateRingColor(!0))}_loop(){this._ringScaleAnimation||(this._ringScaleAnimation=n.Animated.sequence([l.default.timing(this._ringScaleAnimatedValue,{toValue:1.12,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:2100,isInteraction:!1,useNativeDriver:!0}),l.default.timing(this._ringScaleAnimatedValue,{toValue:1.04,easing:n.Animated.Easing.CubicBezier(.5,0,1,1),duration:1400,isInteraction:!1,useNativeDriver:!0})])),this._ringScaleAnimation.start((e=>{this.isComponentMounted()&&e.finished&&(this._isTalking?this._loop():this._resetTalkingRing())})),this.setState({isAnimating:!0})}_updateRingColor(e){n.Animated.timing(this._defaultAnimatedColorValue,{toValue:e?1:0,easing:n.Animated.Easing.Linear(),duration:300,isInteraction:!1}).start()}_resetTalkingRing(){this._ringScaleAnimation=l.default.timing(this._ringScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.InOut(),duration:300,isInteraction:!1,useNativeDriver:!0}),this._ringScaleAnimation.start((e=>{this.isComponentMounted()&&(this._ringScaleAnimation=void 0,this._isTalking?this._startLoopingAnimation():this.setState({isAnimating:!1}))})),this._updateRingColor(!1)}render(){if(this.props.isVideo){const e=[h.videoInnerContainer];return this.props.talkingTintColor?e.push(n.Styles.createViewStyle({backgroundColor:this.props.talkingTintColor,opacity:.8},!1)):e.push(this._defaultAnimatedColorStyle),(0,a.jsx)(n.Animated.View,Object.assign({style:[h.videoContainer,this._ringScaleAnimatedStyle]},{children:(0,a.jsx)(n.Animated.View,{style:e})}))}let e;e=this.props.size<=u.CompactSmall?{container:h.compactSmall.container,ring:h.compactSmall.ring}:this.props.size<=u.CompactLarge?{container:h.compactLarge.container,ring:h.compactLarge.ring}:{container:h.large.container,ring:h.large.ring};const t=[e.container,this._ringScaleAnimatedStyle],i=[e.ring];this.props.talkingTintColor?i.push(n.Styles.createViewStyle({backgroundColor:this.props.talkingTintColor,opacity:.8},!1)):i.push(this._defaultAnimatedColorStyle),this.props.useRoundedRect&&i.push(h.roundedRect);const o=[e.container];return(0,a.jsx)(n.View,Object.assign({style:o},{children:(0,a.jsx)(n.Animated.View,Object.assign({style:t},{children:(0,a.jsx)(n.Animated.View,{style:i})}))}))}}t.CallParticipantTalkingView=p,t.default=p},197079:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(421832),s=i(513890),r=i(148540),l=i(994224),c=i(502278),d=i(63060),u=i(23293),h=i(680837),p=i(436237),g=i(853374),C=i(824430),S=i(89808),m=i(24576),y=i(581760),f=i(366355),b=i(915877),_=i(211595),T=i(914976),v=(0,b.lazyProperties)({innerContainer:()=>h.default.absoluteFill,hiddenContainer:()=>n.Styles.createViewStyle({opacity:0}),mainContainer:()=>n.Styles.createViewStyle({position:"relative",flex:1})});class w extends d.default{constructor(e){super(),this.value=e}isImmutable(){return!0}equals(e){return e instanceof w&&this.value===e.value}}class I extends m.default{constructor(){super(...arguments),this._useNewVideoView=!1,this._onFullScreenUserIcon=e=>{this._fullScreenUserIcon=e||void 0},this._onCallingVideoView=e=>{this._resetRenderer(e);const t=g.default.newCauseId(),i=e||void 0;p.log(f.LogTraceArea.CallingUI,this._componentTag+"._onCallingVideoView "+T.mriOrId(this.props.mri)+" has video view: "+!!i+" causeId: "+t),this._callingVideoView!==i&&(this._callingVideoView=i,this.props.onCallingVideoView&&this.props.onCallingVideoView(this._callingVideoView,t))},this._rendererPromise=null}_buildState(e,t){let i;if(t&&(this._componentTag=I._generateComponentTag(e)),!e.isLocal&&!e.showOnlyAvatar&&e.mri){const t=e.renderScreenShare?r.StreamType.ScreenSharing:r.StreamType.Video;i=l.default.CallingStore.getBestStreamForMri(e.callId,e.mri,t,e.endpointId)}return{gradientColors:I._getGradientColors(e),remoteStream:i&&new w(i),isRendering:!t&&this.state.isRendering}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=g.default.newCauseId();p.log(f.LogTraceArea.CallingUI,this._componentTag+".componentDidUpdate:  causeId: "+a),!this.props.isLocal&&this.state.isRendering>t.isRendering&&c.default.updateCallTelemetry(this.props.callId,a,(e=>{e.didRenderRemoteVideo()})),this._rendererPromise&&this.props.scalingMode!==e.scalingMode&&this._rendererPromise.then((e=>{e.setScalingMode(this.props.scalingMode,a)}))}componentWillUnmount(){super.componentWillUnmount()}updateTalkingView(e){!this.props.isCompact&&this._fullScreenUserIcon&&this._fullScreenUserIcon.updateTalking(e)}getVideoElement(){return this._callingVideoView}getEndpointId(){return this.props.streamType!==r.StreamType.Video||this.props.isLocal?void 0:this.props.endpointId}render(){const e=this.props.showOnlyAvatar?"icon_":"video_",t=e+this.props.renderKey,i=e+this._getVideoKey(!0);let o,s;if(this.props.showOnlyAvatar)this.props.renderScreenShare||(o=this._renderStaticSurface(!0));else if(this.state.isRendering){const e=this.props.shouldWaitForVideoSize&&(!this.props.videoDimensions||!this.props.videoDimensions.width);s=this._renderVideoSurface(t,i,e)}else this.props.renderScreenShare?s=this._renderVideoSurface(t,i,!1):(s=this._renderVideoSurface(t,i,!0),o=this._renderStaticSurface(!1));return(0,a.jsxs)(n.View,Object.assign({style:[v.innerContainer,v.mainContainer,this.props.videoBorderColorStyle]},{children:[s,o,!1]}))}_renderVideoSurface(e,t,i){var n;p.log(f.LogTraceArea.CallingUI,this._componentTag+"._renderVideoSurface "+t+" hidden "+i+" local:"+this.props.isLocal);const o=`video${(null===(n=this.state.remoteStream)||void 0===n?void 0:n.value.id)||""}_${e}`;return this._useNewVideoView&&s.VideoView?(0,a.jsx)(s.VideoView,{ref:this._onCallingVideoView},o):s.default&&(0,a.jsx)(s.default,{ref:this._onCallingVideoView,nametag:e,style:[v.innerContainer].concat(i?[v.hiddenContainer]:[]),isLocal:this.props.isLocal,videoBorderRadius:this.props.videoBorderRadius,parentView:this._componentTag,renderScreenShare:this.props.renderScreenShare},o)}static _getGradientColors(e){if(e.useDarkBackground){const t=e.useLightTheme?y.Color.gray50:y.Color.callStageLight;return e.isCallStageV2?[t,t]:[y.Color.callStageDark,y.Color.gray400]}return e.isLocal||e.renderScreenShare?S.default.getGradientColors():u.default.getGradientColors(e.mri)}_renderStaticSurface(e){const t=this.props.mri?(0,a.jsx)(C.default,{ref:this._onFullScreenUserIcon,style:v.innerContainer,backgroundColorStyle:this.props.backgroundColorStyle,userMri:this.props.mri,iconOpacity:this.props.iconOpacity||0,backgroundOpacity:this.props.isCompact?0:1,isConnecting:this.props.isRinging,size:this.props.iconSize,animateChanges:this.props.animateIconChanges,gradientColors:this.state.gradientColors,showAudioParticipantBackground:this.props.showAudioParticipantBackground&&e,hideIcon:this.props.hideIcon}):void 0;return(0,a.jsx)(n.View,Object.assign({style:v.innerContainer},{children:t}))}_resetRenderer(e){var t;if(this._rendererPromise){const e=this._rendererPromise;e.cancel(),e.then((t=>{var i;e.remoteStream?l.default.CallingStore.updateRemoteVideoRenderInfoForCall(e.callId,e.participantMri,e.remoteStream,e.renderTarget,null):l.default.CallingStore.updateLocalPreviewRenderInfoForCall(e.callId,e.renderTarget,null),null===(i=e.rendererSubscription)||void 0===i||i.dispose(),t.dispose()})),this._rendererPromise=null,this.setState({isRendering:!1})}if(e){const i=e.getVideoContainer(),a={scalingMode:this.props.scalingMode,transparent:this.props.enableTransparentVideoStream},n=this._getRendererPromise(i,a);n&&(this._rendererPromise=Object.assign(n,{renderTarget:i,callId:this.props.callId,participantMri:this.props.mri,remoteStream:null===(t=this.state.remoteStream)||void 0===t?void 0:t.value}),n.then((e=>{this._rendererPromise===n&&(this.setState({rendererDiagnostic:"Renderer created",isRendering:e.isRendering}),this._rendererPromise.rendererSubscription=e.changed((()=>{this.setState({isRendering:e.isRendering})})),this._rendererPromise.remoteStream?l.default.CallingStore.updateRemoteVideoRenderInfoForCall(this._rendererPromise.callId,this._rendererPromise.participantMri,this._rendererPromise.remoteStream,this._rendererPromise.renderTarget,e):l.default.CallingStore.updateLocalPreviewRenderInfoForCall(this._rendererPromise.callId,this._rendererPromise.renderTarget,e))}),(e=>this._setRendererDiagnostic(e))))}}_createRendererFactory(e,t){var i;if(this.props.isLocal)return()=>o.default.getStack().getDeviceManager().createPreviewRenderer(e,t);const a=null===(i=this.state.remoteStream)||void 0===i?void 0:i.value;if(a){const i=l.default.CallingStore.getRemoteStreamStarter(this.props.callId,a.type);if(i)return()=>i.startStream((e=>this.setState({rendererDiagnostic:e})),a,e,t)}return null}_setRendererDiagnostic(e,t){let i="Failed to create renderer.";void 0!==t&&(i+=` Retry in ${t} s...`),i+=`\n${e}`,this.setState({rendererDiagnostic:i})}_getRendererPromise(e,t){const i=this._createRendererFactory(e,t);if(!i)return null;const a=(0,_.progressiveDelayTrigger)(((e,t)=>{this._setRendererDiagnostic(e,t)}));let n;const o=(0,_.retry)((()=>(this.setState({rendererDiagnostic:"Creating renderer..."}),n=i())),a);return Object.assign(o,{cancel:()=>{var e;a.cancel(),null===(e=n.cancel)||void 0===e||e.call(n)}})}_getVideoKey(e=!1){return this.props.endpointId&&this.props.streamType===r.StreamType.Video&&!this.props.isLocal?(e?T.mriOrId(this.props.renderKey):this.props.renderKey)+"_"+this.props.endpointId:e?T.mriOrId(this.props.renderKey):this.props.renderKey}static _generateComponentTag(e){return e.parentViewId?e.parentViewId+"#CallParticipantVideoView":"CallParticipantVideoView"}}t.default=I},537103:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallParticipantView=void 0;const a=i(785893),n=i(667294),o=i(496486),s=i(967593),r=i(516778),l=i(148540),c=i(889391),d=i(775492),u=i(197079),h=i(178816),p=i(994224),g=i(568580),C=(i(615526),i(488717)),S=i(892831),m=i(154174),y=i(413805),f=i(109520),b=i(480200),_=i(471727),T=i(905531),v=i(662602),w=i(952262),I=i(746096),P=i(110117),M=i(436237),k=i(648638),A=i(915877),R=i(733754),x=i(330124),L=i(390244),V=i(914976),O=i(536150),B=i(404057),D=i(581760),E=i(711828),N=i(680837),F=i(24576),j=i(853374),U=i(939193),H=i(653514),z=(i(178735),(0,A.lazyProperties)({innerContainer:()=>N.default.absoluteFill,participantViewSpacingTray:()=>r.Styles.createViewStyle({margin:2}),hiddenContainer:()=>r.Styles.createViewStyle({opacity:0}),ringingContainer:()=>r.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",backgroundColor:D.Color.blackOverlay50}),backgroundActivityContainer:()=>r.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,alignItems:"center",justifyContent:"center",overflow:"visible"}),keyboardNavigatorPosition:()=>r.Styles.createViewStyle({bottom:0,left:0}),smallAccessory:()=>r.Styles.createViewStyle({position:"absolute",width:24,height:24,borderRadius:12,backgroundColor:D.Color.white,alignItems:"center",justifyContent:"center"}),smallAccessoryPosition:()=>r.Styles.createViewStyle({bottom:0,right:0}),smallAccessoryLocalVideo:()=>r.Styles.createViewStyle({backgroundColor:D.Color.transparent}),smallAccessoryLocalVideoPosition:()=>r.Styles.createViewStyle({bottom:-8,right:-8}),smallAccessoryInnerView:()=>r.Styles.createViewStyle({width:20,height:20,borderRadius:10,backgroundColor:D.Color.white,alignItems:"center",justifyContent:"center"}),smallAccessoryInnerScreenshareView:()=>r.Styles.createViewStyle({backgroundColor:D.Color.white}),smallAccessoryInnerLocalVideoView:()=>r.Styles.createViewStyle({backgroundColor:D.Color.white}),debugContainer:()=>r.Styles.createViewStyle({padding:10}),debugTextStyle:()=>r.Styles.createTextStyle({color:D.Color.greenIOS}),raiseHandInnerBorderStyle:()=>r.Styles.createViewStyle({borderColor:D.Color.raiseHandOrange,borderWidth:2}),activeTalkingInnerBorderStyle:()=>r.Styles.createViewStyle({borderWidth:2}),activeTalkingOuterBorderStyle:()=>r.Styles.createViewStyle({borderWidth:3}),raisedHandOuterBorderStyle:()=>r.Styles.createViewStyle({borderColor:D.Color.raiseHandOrange,borderWidth:3}),nametagAndAccessoriesLine:()=>r.Styles.createViewStyle({position:"absolute",flexDirection:"row",justifyContent:"space-between",bottom:12,left:12,right:12,alignSelf:"stretch",flexBasis:0,flexGrow:1,overflow:"hidden",alignItems:"flex-end"}),nametagAndAccessoriesLineTray:()=>r.Styles.createViewStyle({bottom:10,left:10,right:10}),horizontalMultipleStreamsLayout:()=>r.Styles.createViewStyle({flexDirection:"row"}),gestureViewWrapper:()=>r.Styles.createViewStyle({flex:1})}));class G extends F.default{constructor(){super(...arguments),this._callParticipantVideoViews={},this._containerId=0,this._isTalking=!1,this._animatedAccessoryOpacityValue=new r.Animated.Value(1),this._animatedAccessoryOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._animatedAccessoryOpacityValue}),this._fetchRendererStats=o.throttle((()=>h.default.fetchRendererStats(this.props.callId,this.state.renderKey,this.state.streamType)),5e3),this._setKeyboardNavigatorRef=e=>{this._keyboardNavigatorRef=e||void 0},this._onDimensionsChanged=e=>{e!==this._renderedDimensions&&(this._renderedDimensions=e,this.state.useSizeToFitV2?this._updateSizeToFitV2():this._updateSizeToFit())},this._onHiddenChanged=e=>{this.isComponentMounted()&&this.setState({hidden:e})},this._onCallParticipantTalkingView=e=>{this._callParticipantTalkingView=e||void 0},this._onCallParticipantVideoView=(e,t)=>{e?(this._callParticipantVideoViews[t]=e,e.props.renderScreenShare&&(this._screenShareVideoViewKey=t)):(delete this._callParticipantVideoViews[t],this._screenShareVideoViewKey===t&&(this._screenShareVideoViewKey=void 0))},this._toggleCropUncropVideo=e=>{this.isComponentMounted()&&this.setState({isSizeToFitExplicitlySet:!0},(()=>{M.log(I.LogTraceArea.CallingUI,this._componentTag+"._toggleCropUncropVideo isSizeToFitExplicitlySet="+this.state.isSizeToFitExplicitlySet),this._updateSizeToFitByConextMenuOption(e)}))},this._setSizeToFit=(e,t)=>{this.setState({sizeToFit:e},t)},this._onParticipantContextMenuFromKeyboard=()=>{const e=this._getCallParticipantContextMenuOptions();this.props.callId&&this.props.conversationMri&&this._keyboardNavigatorRef&&e&&v.default.measureLayoutRelativeToWindow((()=>this._keyboardNavigatorRef)).then((({x:t,y:i})=>C.default.showParticipantActionsContextMenuOnPosition({x:t,y:i},this._getRootViewId(),e,this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this._toggleCropUncropVideo)))},this._onParticipantContextMenuHandler=e=>{if(this.props.callId&&this.props.conversationMri){const t=this._getCallParticipantContextMenuOptions();C.default.showParticipantActionsContextMenu(e,this._getRootViewId(),t,this.props.onCallParticipantContextMenuOpened,this.props.onCallParticipantContextMenuDismissed,this._toggleCropUncropVideo)}},this._onLocalVideoContextMenuFromKeyboard=()=>{const e=this._getCallLocalVideoContextMenuOptions();this.props.callId&&this.props.conversationMri&&this._keyboardNavigatorRef&&e&&v.default.measureLayoutRelativeToWindow((()=>this._keyboardNavigatorRef)).then((({x:t,y:i})=>C.default.showLocalVideoActionsContextMenuOnPosition({x:t,y:i},this._getRootViewId(),e,this._toggleCropUncropVideo)))},this._onLocalVideoContextMenuHandler=e=>{if(this.props.callId&&this.props.conversationMri){const t=this._getCallLocalVideoContextMenuOptions();t&&C.default.showLocalVideoActionsContextMenu(e,this._getRootViewId(),t,this._toggleCropUncropVideo)}},this._getContextMenuHandler=e=>e?this.state.isLocal?this._onLocalVideoContextMenuFromKeyboard:this._onParticipantContextMenuFromKeyboard:this.state.isLocal?this._onLocalVideoContextMenuHandler:this._onParticipantContextMenuHandler,this._renderOptionalNameTagLine=e=>{if(this._shouldShowOptionalNameTag(e))return(0,a.jsx)(H.default,{isCallStageV2:this.props.isCallStageV2,isPresenter:this.state.isPresenter,isInTray:this.props.isInTray,desktopNameTag:this.props.desktopNameTag,nametagPosition:this.props.nametagPosition,callId:this.props.callId,conversationMri:this.props.conversationMri,renderScreenShare:this.state.renderScreenShare,renderKey:this.state.renderKey,isLocal:!!this.state.isLocal,sizeToFit:this.state.sizeToFit,isRenderingVideo:this.state.shouldRenderVideo,isOnHold:this.state.isOnHold,useLightTheme:this.props.useLightTheme,nametagOpacityStyle:this.props.nametagOpacityStyle,getDesktopAccessory:(e,t)=>this._getDesktopAccessory(e,t),onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,toggleCropUncropVideo:this._toggleCropUncropVideo,hovering:this.state.hovering})}}static _generateComponentTag(e){return e.parentViewId?e.parentViewId+"#CallParticipantView":"CallParticipantView"}_buildState(e,t){const{autoLetterBoxThresholdRatioForNewStage:i,enableAudioParticipantsBackground:a,enableAudioParticipantsBackgroundInTray:n,enableMultipleStreamSupport:o,enableScreenShareZoom:s,enableTransparentVideoStream:r,modernCallStage:u}=c.default.getS4LCMCFeatures(),{enableRefreshedPalette:h}=c.default.getS4LUiFeatures();let g,C=e.renderInfo;e.callId&&!e.renderInfo&&(C=p.default.CallParticipantStore.getParticipantRenderInfo(e.renderKey,e.callId));const S=(null==C?void 0:C.mri)||this._extractMriForKey(e.renderKey,!1),m=(null==C?void 0:C.isLocal)||e.renderKey===b.CallStageElementKeys.localUserKey,y=p.default.CallingStore.getLocalVideoStreamSize(e.callId),f=(null==C?void 0:C.videoDimensions)||y;m?g=R.getString("DisplayInfoStore.ListMyName"):(g=w.default.getDisplayName(S),(null==C?void 0:C.renderScreenShare)&&(g=R.getString("CallPanel.CallParticipantScreenshareLabel",{displayName:g||""})));const T=m?p.default.DeviceStore.getSelectedCamera():void 0,v=l.CameraPosition.Unknown,P=(null==C?void 0:C.renderScreenShare)?l.StreamType.ScreenSharing:l.StreamType.Video,A=_.CallUIUtils.isFullScreenBot(S),L=e.isFullscreenBotCall||(null==C?void 0:C.renderScreenShare)||(null==C?void 0:C.streamsStatus)===b.CallParticipantStreamsStatus.Multiple||A,V=s&&(null==C?void 0:C.isAScreensharing)&&!0,B=e.isCallStageV2&&a,D=B&&n,E=e.isInTray?D:B,N=Object.assign(Object.assign({zoomEnabled:L||e.enableVideoGestures,isScreenShareZoomEnabled:V,isMobileScreenReaderEnabled:O.default.isMobileScreenReaderEnabled(),isNavigatingWithKeyboard:k.default.isNavigatingWithKeyboard(),isUsingStackNavigationContext:x.default.isUsingStackNavigationContext(),hideNameTag:e.hideNameTag||p.default.CallControlsStore.isSettingsPopupVisible()||A,displayName:g,camera:T,cameraPosition:v,showControls:e.allowCameraFlip?d.default.areCallControlsVisible():void 0,streamType:P,metricEnabled:!1,rendererMetrics:void 0,enableTransparentVideoStream:!!e.isCallStageV2&&r,enableMultipleStreamSupport:o,autoLetterBoxThresholdRatio:e.isCallStageV2?i:u.autoLetterBoxThresholdRatio,isFullScreenBot:A},C),{renderKey:e.renderKey,mri:S,isLocal:m,forceSizeToFit:L,showAudioParticipantBackground:E,videoDimensions:f,useSizeToFitV2:!0,enableRefreshedPalette:h});return t?(N.sizeToFit=N.zoomEnabled,N.isSizeToFitExplicitlySet=!1,N.hidden=e.layoutController(e.renderKey,!!(null==C?void 0:C.renderScreenShare),null==C?void 0:C.shouldRenderVideo).isHidden(),N.applyGestureButtonInsets=!1,this._componentTag=G._generateComponentTag(e)):(null==C?void 0:C.videoDimensions)?C.videoDimensions.width||(N.sizeToFit=N.zoomEnabled&&this._sizeToFit(e,N.zoomEnabled)):N.sizeToFit=(this.state.isSizeToFitExplicitlySet||N.zoomEnabled)&&this.state.sizeToFit,(t||e.isCompact||e.isDragging)&&(M.log(I.LogTraceArea.CallingUI,"## setting hovering to false"),N.hovering=!1),N}componentDidMount(){super.componentDidMount(),this._updateBadgeOpacity();const e=this._layoutController();e.onDimensionsChanged&&e.onDimensionsChanged(this._onDimensionsChanged),e.onHiddenChanged&&e.onHiddenChanged(this._onHiddenChanged),this.props.enableFloatableResizableVideoPreview&&e.setViewCanAnimateState&&e.setViewCanAnimateState(this,!0)}componentWillUnmount(){super.componentWillUnmount();const e=this._layoutController();e.onDimensionsChanged&&e.onDimensionsChanged(void 0),e.onHiddenChanged&&e.onHiddenChanged(void 0),this.props.enableFloatableResizableVideoPreview&&e.setViewCanAnimateState&&e.setViewCanAnimateState(this,!1),M.log(I.LogTraceArea.CallingUI,this._componentTag+".componentWillUnmount "+this._participantKeyForLogging())}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const a=j.default.newCauseId();if(t.isLocal||t.shouldRenderVideo||!this.state.shouldRenderVideo||this._containerId++,o.each(this._callParticipantVideoViews,(i=>{var n;e.callId&&e.conversationMri&&this.state.shouldRenderVideo!==t.shouldRenderVideo&&(M.log(I.LogTraceArea.CallingUI,this._componentTag+".UNSAFE_componentWillUpdate: shouldRenderVideo from "+this.state.shouldRenderVideo+" to "+t.shouldRenderVideo+" causeId: "+a),p.default.RemoteStreamHelper.logStreamAndRendererStatus(e.callId,e.conversationMri,this.state.streamType,null===(n=i.getVideoElement())||void 0===n?void 0:n.getVideoContainer(),a))})),this.props.enableFloatableResizableVideoPreview&&t.hidden!==this.state.hidden&&t.hidden){const e=this._layoutController();e.setViewCanAnimateState&&e.setViewCanAnimateState(this,!1)}if(this.state.shouldRenderVideo!==t.shouldRenderVideo||this.props.shouldWaitForVideoSize!==e.shouldWaitForVideoSize||this.state.videoDimensions!==t.videoDimensions){const i=t.shouldRenderVideo?"video_":"icon_"+this._participantKeyForLogging();M.log(I.LogTraceArea.CallingUI,this._componentTag+"._renderContentView key:"+i+" shouldRenderVideo: "+t.shouldRenderVideo+" shouldWaitforVideoSize: "+e.shouldWaitForVideoSize+" videoDimensions:"+B.default.asString(t.videoDimensions))}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),(this.props.isCompact!==e.isCompact||this.props.allowCameraFlip&&this.state.showControls!==t.showControls)&&this._updateBadgeOpacity(!0),this._updateTalkingView(),(this.state.shouldRenderVideo&&!t.shouldRenderVideo||this.state.videoDimensions&&t.videoDimensions&&this.state.videoDimensions.width!==t.videoDimensions.width)&&(this.state.isSizeToFitExplicitlySet?this.setState({isSizeToFitExplicitlySet:!1}):this.state.useSizeToFitV2?this._updateSizeToFitV2():this._updateSizeToFit()),this.props.enableFloatableResizableVideoPreview&&t.hidden&&!this.state.hidden){const e=this._layoutController();e.setViewCanAnimateState&&e.setViewCanAnimateState(this,!0)}}updateTalking(e){this._isTalking!==e&&(this._isTalking=e,this._updateTalkingView())}_updateTalkingView(){this.props.isCompact&&this._callParticipantTalkingView&&this._callParticipantTalkingView.updateTalking(this._isTalking),o.each(this._callParticipantVideoViews,(e=>e.updateTalkingView(this._isTalking)))}_updateBadgeOpacity(e=!1){const t=this._currentBadgeOpacity();e&&t>0?r.Animated.timing(this._animatedAccessoryOpacityValue,{toValue:t,duration:250,delay:250,easing:r.Animated.Easing.InOut()}).start((e=>{e.finished||t===this._currentBadgeOpacity()&&this._animatedAccessoryOpacityValue.setValue(t)})):this._animatedAccessoryOpacityValue.setValue(t)}_currentBadgeOpacity(){let e;return e=this.props.isCompact?this.props.allowCameraFlip&&this.state.showControls?0:1:0,e}getVideoElement(e){var t,i;return!e&&o.size(this._callParticipantVideoViews)>0||!this.state.enableMultipleStreamSupport?null===(t=o.first(o.values(this._callParticipantVideoViews)))||void 0===t?void 0:t.getVideoElement():e?null===(i=this._callParticipantVideoViews[e])||void 0===i?void 0:i.getVideoElement():void 0}_getScreenShareVideoElement(){var e;return this._screenShareVideoViewKey&&(null===(e=this._callParticipantVideoViews[this._screenShareVideoViewKey])||void 0===e?void 0:e.getVideoElement())||null}_participantKeyForLogging(){return this._extractMriForKey(this.props.renderKey,!0)}_extractMriForKey(e,t=!1){return g.default.extractMriFromKey(e,t)}_renderContentView(){const e=this.state.renderKey,t=this.state.enableMultipleStreamSupport&&this.state.streamsStatus===b.CallParticipantStreamsStatus.Multiple;let i=!1;const n=[],o=this.state.streams||[];!this.state.isFullScreenBot&&this.state.enableMultipleStreamSupport&&void 0!==this.state.streams?this.state.streamsStatus===b.CallParticipantStreamsStatus.None?n.push(this._renderVideoView(e,{isStreamAvailable:!1,videoDimensions:_.DummyVideoSize})):o.forEach((a=>{o.length>1&&!a.isStreamAvailable||(_.CallUIUtils.isPortraitVideo(a.videoDimensions)&&(i=!0),n.push(this._renderVideoView(e,a,t?0:void 0)))})):n.push(this._renderVideoView(e,{isStreamAvailable:this.state.shouldRenderVideo,videoDimensions:this.state.videoDimensions}));const l=[z.innerContainer,this._getOptionalRaisedHandStyles(),t?this._getOptionalMultipleStreamsStylesForCompactView():void 0,i?z.horizontalMultipleStreamsLayout:void 0,this.props.borderRadius&&r.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1)];let c,d=(0,a.jsx)(r.View,Object.assign({style:l},{children:n}),"contentcontainer"+this._containerId);if(this.state.isRinging&&this.props.isCompact){const e=[z.ringingContainer,r.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1)];c=(0,a.jsx)(r.View,Object.assign({style:e},{children:(0,a.jsx)(P.default,{icon:E.SkypeIcon.CallAnimSmall4,color:D.Color.white,size:E.IconSize.size20})}))}const u=this.state.isLocal&&this.state.shouldRenderVideo,h=u||this.state.renderScreenShare,p=!this.props.isCompact||this.props.suppressTalkingRing||this.props.hideBackground?void 0:(0,a.jsx)(r.View,Object.assign({style:z.backgroundActivityContainer},{children:(0,a.jsx)(m.default,{ref:this._onCallParticipantTalkingView,size:this.props.iconSize,useRoundedRect:h,isVideo:u})})),g=this._layoutController().getInnerStyles();g&&(d=(0,a.jsx)(r.Animated.View,Object.assign({style:g},{children:d})));const C=(0,a.jsx)(S.default,{ignorePointerEvents:!0,callId:this.props.callId,participantMri:this.state.renderKey,borderRadius:this.props.videoBorderRadius,isCompact:!!this.props.isCompact||!!this.props.forceCompactReactions,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper});let y;if(this.props.allowCameraFlip){const e=r.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1);y=(0,a.jsx)(s.GradientView,{style:[N.default.overflowVisible,z.innerContainer,e],direction:s.GradientDirection.TOP_RIGHT,colors:[D.Color.blackOverlay50,D.Color.transparent]})}return(0,a.jsxs)(r.View,Object.assign({style:[z.innerContainer,this._getNewCallStageParticipantSpacing(),N.default.overflowVisible,this.props.contentViewStyles]},{children:[p,d,this._getActivityIndicationView(),C,c,y]}))}_getOptionalRaisedHandStyles(){const e=this.props.isCallStageV2||!this.state.isHandRaised||this.state.renderScreenShare?void 0:[z.raiseHandInnerBorderStyle];return this.props.isCompact&&e&&e.push(r.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius},!1)),e}_getOptionalMultipleStreamsStylesForCompactView(){return this.props.isCompact?r.Styles.createViewStyle({borderRadius:this.props.videoBorderRadius,overflow:"hidden"},!1):void 0}_getNewCallStageParticipantSpacing(){if(this.props.isCallStageV2&&this.props.isGroupCall&&this.props.isInTray)return z.participantViewSpacingTray}_getActivityIndicationView(){const e=this.props.borderRadius&&r.Styles.createViewStyle({borderRadius:this.props.borderRadius},!1),t=this._isRaisedHandNewCallStageUI(),i=this._isActiveTalkingNewCallStageUI();if(!t&&!i)return;const n=[z.backgroundActivityContainer,this._getActiveCallFrameColorStyles(!0),e],o=[z.backgroundActivityContainer,z.activeTalkingOuterBorderStyle,this._getActiveCallFrameColorStyles(),e];return t&&(o.push(z.raisedHandOuterBorderStyle),n.push(z.raiseHandInnerBorderStyle)),t&&i&&o.push(z.activeTalkingOuterBorderStyle),(0,a.jsx)(r.View,Object.assign({style:o},{children:(0,a.jsx)(r.View,{style:n})}))}_getActiveCallFrameColorStyles(e){const t=this.props.useLightTheme?D.Color.blue:D.Color.white,i=this.props.useLightTheme?D.Color.white:D.Color.black,a=e?i:t,n=this.state.enableRefreshedPalette?this._themeColors.surfaceInteractive:a;return r.Styles.createViewStyle({borderColor:n},!1)}_renderVideoView(e,t,i){var n;const s=t.endpointId||e,r=this.props.layoutController(e),c=!this.props.hideBackground&&this.state.showAudioParticipantBackground;return(0,a.jsx)(u.default,{ref:e=>this._onCallParticipantVideoView(e,s),renderKey:e,mri:this.state.mri,showOnlyAvatar:!t.isStreamAvailable,videoDimensions:t.videoDimensions,isRinging:this.state.isRinging,renderScreenShare:this.state.renderScreenShare,parentViewId:this._componentTag,videoBorderRadius:o.isUndefined(i)?this.props.videoBorderRadius:i,isCompact:this.props.isCompact,iconOpacity:this.props.iconOpacity,animateIconChanges:this.props.animateIconChanges,useDarkBackground:this.props.useDarkBackground,isCallStageV2:this.props.isCallStageV2,iconSize:this.props.iconSize,isLocal:s===b.CallStageElementKeys.localUserKey,useLightTheme:this.props.useLightTheme,showAudioParticipantBackground:c,backgroundColorStyle:r.getBackgroundColorStyle(this.props.useLightTheme),videoBorderColorStyle:null===(n=r.getVideoBorderColorStyle)||void 0===n?void 0:n.call(r,this.props.useLightTheme),enableTransparentVideoStream:this.state.enableTransparentVideoStream,onCallingVideoView:this.props.onCallingVideoView,shouldWaitForVideoSize:!!this.props.shouldWaitForVideoSize,streamType:this.state.streamType,callId:this.props.callId,endpointId:t.endpointId,hideIcon:this.props.hideIcon,scalingMode:this.state.sizeToFit?l.ScalingMode.Fit:l.ScalingMode.Crop},s)}_isActiveTalkingNewCallStageUI(){return this.props.isCallStageV2&&this.props.isGroupCall&&this.state.isTalking&&!this.state.isAScreensharing}_isRaisedHandNewCallStageUI(){return this.props.isCallStageV2&&this.state.isHandRaised&&!this.state.isAScreensharing}_isPresenterScreenSharing(){return Boolean(this.state.isAScreensharing||this.state.isPresenter)}_hasToShowKeyboardNavigator(){return this.state.isNavigatingWithKeyboard&&!(this.state.isLocal&&this.props.isScreenSharing)}_renderAccessoryView(){if(!this.state.renderScreenShare&&(this.state.isMuted||this.state.isOnHold||this.state.isAScreensharing||this.state.isPresenter||this.state.isNavigatingWithKeyboard)&&this.props.isCompact){const e=this.state.isLocal&&this.state.shouldRenderVideo;let t;const i=[z.smallAccessoryInnerView];this.state.isOnHold?t=E.SkypeIcon.Pause:this.state.isMuted&&!this._showOptionalNameTagForMobile()?t=E.SkypeIcon.MicrophoneOff:this._isPresenterScreenSharing()&&(t=_.CallUIUtils.getShareScreenIcon(!0),i.push(z.smallAccessoryInnerScreenshareView)),e&&i.push(z.smallAccessoryInnerLocalVideoView);const o=[z.smallAccessory,z.smallAccessoryPosition,this._animatedAccessoryOpacityStyle];e&&(o.push(z.smallAccessoryLocalVideo),this.props.allowCameraFlip&&o.push(z.smallAccessoryLocalVideoPosition));const s=_.CallUIUtils.getUserOptionsAccessibilityLabel(this.state.displayName,this.state.isMuted,this.state.isHandRaised);return(0,a.jsxs)(n.Fragment,{children:[this._hasToShowKeyboardNavigator()&&(0,a.jsx)(r.Button,Object.assign({style:[z.smallAccessory,z.keyboardNavigatorPosition],onPress:this._getContextMenuHandler(!0),title:s,ref:this._setKeyboardNavigatorRef},{children:"..."})),t&&(0,a.jsx)(r.Animated.View,Object.assign({style:o,ignorePointerEvents:!0},{children:this._getDesktopAccessory(i,t)}))]})}}_getDesktopAccessory(e,t){return(0,a.jsx)(r.View,Object.assign({style:e},{children:(0,a.jsx)(P.default,{icon:t,size:E.IconSize.size12,color:D.Color.gray400})}))}_renderRaisedHandOnRibbonParticipant(){if(this.state.isHandRaised&&this.props.isCompact&&!this.state.renderScreenShare)return(0,a.jsx)(L.default,{type:L.RaiseHandImageType.SmallSizeTopLeftAligned})}_setHovering(e){this.isComponentMounted()&&this.state.hovering!==e&&this.setState({hovering:e})}_isLandscape(e){return e.width>=e.height}_sizeToFit(e,t){if(!this._renderedDimensions||!this.state.videoDimensions||!this.state.videoDimensions.width||this.state.renderScreenShare||e.isFullscreenBotCall||this.state.streamsStatus===b.CallParticipantStreamsStatus.Multiple)return t;const i=this._isLandscape(this._renderedDimensions),a=this._isLandscape(this.state.videoDimensions),n=i!==a;const o=this.state.videoDimensions.width/this.state.videoDimensions.height,s=Math.floor(this._renderedDimensions.height*o),r=this._renderedDimensions.width/s,l=Math.abs(1-r)>this.state.autoLetterBoxThresholdRatio,c=!a,d=c||n||l;return M.log(I.LogTraceArea.CallingUI,this._componentTag+" _sizeToFit::isPortrait="+c+" isDifferentOrientation="+n+" forceUncrop="+l+" resizingFactor="+r+" incoming video width="+this.state.videoDimensions.width+" container width="+this._renderedDimensions.width+" sizeToFitRet="+d),d}_canUpdateSizeToFit(){return!(!this.isComponentMounted()||!this.state.shouldRenderVideo||this.props.isFullscreenBotCall||this.state.isFullScreenBot)&&(!this.props.isCompact&&!this.props.isInTray||(M.log(I.LogTraceArea.CallingUI,this._componentTag+"._canUpdateSizeToFit "+this._participantKeyForLogging()+" sizeToFit=false in ribbon view user="+V.mriOrId(this.state.renderKey)),this.setState({sizeToFit:!1}),!1))}_updateSizeToFitByConextMenuOption(e){this._canUpdateSizeToFit()&&!o.isUndefined(e)&&e!==this.state.sizeToFit&&this.state.isSizeToFitExplicitlySet&&(M.log(I.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitByConextMenuOption sizeToFitSelected="+e+" user="+V.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e},(()=>{this.props.callId&&p.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,e),e?M.track(new f.CanvasAndRibbonActionsEvent(f.CanvasAndRibbonActions.FullVideo)):M.track(new f.CanvasAndRibbonActionsEvent(f.CanvasAndRibbonActions.CropVideo))})))}_updateSizeToFitV2(){if(!this._canUpdateSizeToFit())return;let e;if(this.props.callId&&(e=p.default.OngoingCallService.getSizeToFitValue(this.props.callId,this.state.renderKey)),o.isUndefined(e))if(this.props.forceVideoToCrop&&!this.state.isAScreensharing)this.setState({sizeToFit:!1,isSizeToFitExplicitlySet:!1});else{const e=this.state.forceSizeToFit||this._sizeToFit(this.props,this.state.zoomEnabled);this.state.sizeToFit!==e&&(M.log(I.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitV2 "+this._participantKeyForLogging()+" "+e+" user="+V.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e,isSizeToFitExplicitlySet:!1}),this.props.callId&&p.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,void 0))}else M.log(I.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFitV2 sizeToFitPersistence="+e+" user="+V.mriOrId(this.state.renderKey)),this.setState({sizeToFit:e})}_updateSizeToFit(e){if(!this.isComponentMounted()||!this.state.shouldRenderVideo)return;if(this.props.isCompact)return M.log(I.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit "+this._participantKeyForLogging()+" sizeToFit=false in ribbon view user="+V.mriOrId(this.state.renderKey)),void this.setState({sizeToFit:!1});if(!o.isUndefined(e)&&e!==this.state.sizeToFit&&this.state.isSizeToFitExplicitlySet)return M.log(I.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit sizeToFitSelected="+e+" user="+V.mriOrId(this.state.renderKey)),void this.setState({sizeToFit:e},(()=>{this.props.callId&&p.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,e),e?M.track(new f.CanvasAndRibbonActionsEvent(f.CanvasAndRibbonActions.FullVideo)):M.track(new f.CanvasAndRibbonActionsEvent(f.CanvasAndRibbonActions.CropVideo))}));let t;if(this.props.callId&&(t=p.default.OngoingCallService.getSizeToFitValue(this.props.callId,this.state.renderKey)),!o.isUndefined(t))return M.log(I.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit sizeToFitPersistence="+t+" user="+V.mriOrId(this.state.renderKey)),void this.setState({sizeToFit:t});const i=this.state.forceSizeToFit||this.state.zoomEnabled&&this._sizeToFit(this.props,this.state.zoomEnabled);this.state.sizeToFit!==i&&(M.log(I.LogTraceArea.CallingUI,this._componentTag+"._updateSizeToFit "+this._participantKeyForLogging()+" "+i+" user="+V.mriOrId(this.state.renderKey)),this.setState({sizeToFit:i,isSizeToFitExplicitlySet:!1}),this.props.callId&&p.default.OngoingCallService.setSizeToFitValue(this.props.callId,this.state.renderKey,void 0))}_layoutController(){return this.props.layoutController(this.state.renderKey,!!this.state.renderScreenShare,this.state.shouldRenderVideo)}_getOptionalBackgroundEffectInfo(){return(0,a.jsx)(y.default,{renderKey:this.props.renderKey,renderInfo:this.props.renderInfo,callId:this.props.callId,conversationMri:this.props.conversationMri,isCallStageV2:this.props.isCallStageV2,nametagOpacityStyle:this.props.nametagOpacityStyle,hideCaption:this.props.isCompact&&!this.props.isCallStageV2||this.state.streamsStatus===b.CallParticipantStreamsStatus.None,noExpand:(this.props.isCompact||this.props.isInTray)&&this.props.isCallStageV2,sizeToFit:this.state.sizeToFit,useLightTheme:this.props.useLightTheme,isInTray:this.props.isInTray,callParticipantView:this,layoutController:this.props.layoutController})}_isLocalMuteSupported(){return!!this.props.callId&&p.default.CallingStore.getLocalMuteSupported(this.props.callId)}_isServerMuteSupported(){let e;return this.props.callId&&(e=p.default.CallingStore.findRemoteCallMember(this.props.callId,this.state.renderKey)),!(!e||!this.props.callId)&&p.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(this.props.callId,e)}_getCallParticipantContextMenuOptions(){var e,t;const i=this.state.renderKey,a=null!==(e=this.props.callId)&&void 0!==e?e:"";return{callId:a,conversationMri:null!==(t=this.props.conversationMri)&&void 0!==t?t:"",userMri:i,isLocal:this.state.isLocal,isGroupCall:!!this.props.isGroupCall,isLocalMuteSupported:this._isLocalMuteSupported(),isMuted:!!this.state.isMuted&&this.state.isMuted,isServerMutedSupported:this._isServerMuteSupported(),sizeToFit:this.state.sizeToFit,isCompact:!!this.props.isCompact,isRenderingVideo:this.state.shouldRenderVideo,displayName:void 0,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showMute:!1,showMuteEveryone:!1,isMuteOptionDisabled:!1,showRemoveCall:!1,showSendMessageMenuOption:T.default.call().canSendMessageToParticipant&&!this.props.showChangeTogetherModeBackgroundOption,showCropVideoOption:!1,showFullVideoOption:!1,showViewProfile:T.default.navigation().canAccessUserDetails&&!this.props.showChangeTogetherModeBackgroundOption,showLowerHandOption:!!this.state.isHandRaised,showChangeTogetherModeBackgroundOption:!!this.props.showChangeTogetherModeBackgroundOption,showPinOption:_.CallUIUtils.shouldShowCallParticipantPinOption(i,a),showUnpinOption:_.CallUIUtils.shouldShowCallParticipantUnpinOption(i,a)}}_getCallLocalVideoContextMenuOptions(){if(this.props.callId&&this.props.conversationMri)return C.default.getCallLocalVideoContextMenuOptions(this.props.callId,this.props.conversationMri,!!this.props.isCompact,this.state.shouldRenderVideo,this.state.sizeToFit,!!this.state.isHandRaised)}_showOptionalNameTagForDesktop(){return!this.props.isCompact&&!this.state.hideNameTag&&!this.props.hideNameTag}_showOptionalNameTagForMobile(){return!1}_renderDebugInfo(){var e,t,i,n,o;if(this.state.metricEnabled&&void 0!==this.state.rendererMetrics)return(0,a.jsxs)(r.View,Object.assign({style:[N.default.absoluteFill,z.debugContainer]},{children:[(0,a.jsxs)(r.Text,Object.assign({style:z.debugTextStyle},{children:["FrameType: ",null===(e=this.state.rendererMetrics)||void 0===e?void 0:e.frameType]})),(0,a.jsxs)(r.Text,Object.assign({style:z.debugTextStyle},{children:["RendererType: ",null===(t=this.state.rendererMetrics)||void 0===t?void 0:t.rendererType]})),(0,a.jsxs)(r.Text,Object.assign({style:z.debugTextStyle},{children:["StreamSize: ",null===(i=this.state.rendererMetrics)||void 0===i?void 0:i.streamSize]})),(0,a.jsxs)(r.Text,Object.assign({style:z.debugTextStyle},{children:["FramesDropped: ",null===(n=this.state.rendererMetrics)||void 0===n?void 0:n.framesDropped]})),(0,a.jsxs)(r.Text,Object.assign({style:z.debugTextStyle},{children:["FramesTotal: ",null===(o=this.state.rendererMetrics)||void 0===o?void 0:o.framesTotal]}))]}))}_shouldShowOptionalNameTag(e){return!!(this._showOptionalNameTagForDesktop()||(o.isUndefined(e)||this.state.isHandRaised&&!this.props.isCompact)&&this._showOptionalNameTagForMobile())}render(){if(this.state.hidden)return null;const e=this._renderAccessoryView(),t=this._renderRaisedHandOnRibbonParticipant(),i=!this.props.isCompact&&!this.props.isDragging,n=[this.props.style,this._layoutController().getStyles(i,this.state.videoDimensions,this.props.renderKey)];return this.props.isCompact&&this.props.ribbonOpacityStyle&&n.push(this.props.ribbonOpacityStyle),(0,a.jsxs)(r.Animated.View,Object.assign({style:n,onLayout:this.state.useSizeToFitV2?this._onDimensionsChanged:void 0,onMouseEnter:this.props.isCallStageV2?()=>{this._setHovering(!0)}:void 0,onMouseLeave:this.props.isCallStageV2?()=>{this._setHovering(!1)}:void 0},{children:[this._renderCallParticipantGestureView(e,t),void 0,void 0,this._renderDebugInfo()]}))}_renderCallParticipantGestureView(e,t){const i=this._renderContentView(),n=this._getOptionalBackgroundEffectInfo();return(0,a.jsx)(U.default,{isCompact:this.props.isCompact,enableFloatableResizableVideoPreview:this.props.enableFloatableResizableVideoPreview,enableActionMenuOnMobile:!1,isLocal:this.state.isLocal,shouldRenderVideo:this.state.shouldRenderVideo,videoBorderRadius:this.props.videoBorderRadius,camera:this.state.camera,allowCameraFlip:this.props.allowCameraFlip,isDragging:this.props.isDragging,renderKey:this.state.renderKey,isCallStageV2:this.props.isCallStageV2,showContextMenu:this.props.showContextMenu,callId:this.props.callId,parentViewId:this._componentTag,displayName:this.state.displayName,isLargeGridBot:this.state.isLargeGridBot,isAScreensharing:this.state.isAScreensharing,isTogetherModeBot:this.state.isTogetherModeBot,showChangeTogetherModeBackgroundOption:this.props.showChangeTogetherModeBackgroundOption,showControls:this.state.showControls,enableVideoGestures:this.props.enableVideoGestures,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,isMobileScreenReaderEnabled:this.state.isMobileScreenReaderEnabled,zoomEnabled:this.state.zoomEnabled,isScreenShareZoomEnabled:this.state.isScreenShareZoomEnabled,sizeToFit:this.state.sizeToFit,onTap:this.props.onTap,onPan:this.props.onPan,onMouseOverOrOut:this.props.onMouseOverOrOut,onPressInOrOut:this.props.onPressInOrOut,onResize:this.props.onResize,setHovering:e=>this._setHovering(e),getContextMenuHandler:this._getContextMenuHandler,getLayoutController:()=>this._layoutController(),setSizeToFit:this._setSizeToFit,getScreenShareVideoElement:()=>this._getScreenShareVideoElement(),getCallParticipantVideoViews:()=>this._callParticipantVideoViews,optionalNameTagLine:this._renderOptionalNameTagLine(e),accessoryView:e,contentView:i,optionalRaiseHandAccessory:t,optionalBackgroundInfo:n})}}t.CallParticipantView=G,t.default=G},845092:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maybePresentCallPreviewPanel=t.HandOffCommand=void 0;const a=i(785893),n=i(516778),o=i(496486),s=i(583367),r=i(823113),l=i(148540),c=i(397691),d=i(809206),u=i(994224),h=i(536699),p=i(257538),g=i(67930),C=i(781110),S=i(787720),m=i(913944),y=i(22222),f=i(619675),b=i(342961),_=i(680837),T=i(914976),v=i(199401),w=i(172490),I=i(18078),P=i(104735),M=i(109520),k=i(70665),A=i(364956),R=i(681115),x=i(311010),L=i(734528),V=i(889391),O=i(978547),B=i(952262),D=i(178735),E=i(330124),N=i(581736),F=i(29130),j=i(451070),U=i(436237),H=i(733754),z=i(898278),G=i(746096),W=i(581760),K=i(711828),$=i(478262),q=i(702301),Q=i(567977),X=i(437490),Z=i(915877),J=(i(912770),i(853374)),Y=i(502278),ee=i(471727),te=i(346565),ie=i(480200),ae=i(560787),ne=i(773773),oe=i(948310),se=i(340395);var re;!function(e){e.addDevice="addDevice",e.transferCall="transferCall"}(t.HandOffCommand||(t.HandOffCommand={})),function(e){e[e.None=0]="None",e[e.Join=1]="Join",e[e.TwinCamAvailable=2]="TwinCamAvailable",e[e.TwinCamConnected=3]="TwinCamConnected"}(re||(re={}));const le=(0,Z.lazyProperties)({dialog:()=>n.Styles.createViewStyle({flex:1,overflow:"visible"}),videoShadow:()=>n.Styles.createViewStyle({backgroundColor:W.Color.blackOverlay20}),dialogHeaderContainer:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between"}),controlsWrapper:()=>n.Styles.createViewStyle({flexDirection:"column",overflow:"visible",flex:1,justifyContent:"flex-end"}),previewControl:()=>n.Styles.createViewStyle({alignItems:"center",alignSelf:"center",paddingVertical:20}),previewControlOnMobile:()=>n.Styles.createViewStyle({maxWidth:300,marginBottom:10}),previewControlOnMobileLandscape:()=>n.Styles.createViewStyle({maxWidth:500,marginBottom:10}),previewControlLandscape:()=>n.Styles.createViewStyle({paddingVertical:10}),iconTogglesContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),iconStyle:()=>n.Styles.createViewStyle({marginRight:20}),accessibleToggleSwitchStyle:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",minHeight:40}),convIcon:()=>n.Styles.createTextStyle({alignItems:"center",justifyContent:"center",backgroundColor:W.Color.black}),cameraControlContainer:()=>n.Styles.createViewStyle({paddingRight:10}),previewCameraControlSmallScreen:()=>n.Styles.createViewStyle({bottom:100}),newCameraControlContainer:()=>n.Styles.createViewStyle({position:"absolute",bottom:0,left:0,paddingLeft:15,paddingBottom:10}),cameraPickerTopRightCornerNonModal:()=>n.Styles.createViewStyle({minHeight:void 0,marginTop:8}),closeButton:()=>n.Styles.createViewStyle({justifyContent:"center",height:50,paddingLeft:15,paddingRight:15}),conversationHeader:()=>n.Styles.createViewStyle({flex:1,backgroundColor:"transparent"}),conversationTitle:()=>n.Styles.createTextStyle({color:W.Color.white,font:x.default.font.uiDisplayBold,fontSize:x.default.controlFontSize.messagingHeaderSmall,flexShrink:1}),conversationTitleMargin:()=>n.Styles.createTextStyle({marginRight:15}),conversationSubtitle:()=>n.Styles.createTextStyle({color:W.Color.white,flexShrink:1,lineHeight:25,height:25}),cameraToggleButton:()=>n.Styles.createViewStyle({paddingHorizontal:15}),footer:()=>n.Styles.createViewStyle({height:60,alignSelf:"stretch"}),footerLandscape:()=>n.Styles.createViewStyle({height:70,alignSelf:"stretch"}),wideFooter:()=>n.Styles.createViewStyle({height:120,alignSelf:"stretch"}),footerWideLandscape:()=>n.Styles.createViewStyle({height:70,alignSelf:"stretch",flexDirection:"row",justifyContent:"center"}),wideButtonStyle:()=>n.Styles.createViewStyle({margin:10}),mediumButtonStyle:()=>n.Styles.createViewStyle({paddingLeft:65,paddingRight:65,margin:10}),toggleText:()=>n.Styles.createTextStyle({color:W.Color.white,paddingRight:10,backgroundColor:"transparent"}),blurToggleStyleOnDesktop:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",position:"absolute",bottom:0,right:0,paddingRight:15,paddingBottom:10}),blurToggleStyleOnSmallWindow:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",paddingBottom:10}),settingsButtonStyleOnDesktop:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",position:"absolute",top:0,right:0,paddingRight:15}),videoCanvasWrapper:()=>n.Styles.createViewStyle({backgroundColor:W.Color.black}),videoBorderRadius:()=>n.Styles.createViewStyle({borderRadius:10}),pickersUnderVideoCanvas:()=>n.Styles.createViewStyle({bottom:-60}),videoBoxShadow:()=>n.Styles.createViewStyle({shadowColor:W.Color.blackOverlay40,shadowOffset:{width:0,height:2},shadowOpacity:.8,shadowRadius:10}),cameraAndMicrophoneDetails:()=>n.Styles.createTextStyle({color:W.Color.white,fontSize:12,backgroundColor:"transparent",marginBottom:12}),backgroundReplacementButtonStyles:()=>n.Styles.createViewStyle({marginVertical:8}),backgroundReplacementButtonLabelStyles:()=>n.Styles.createTextStyle({color:W.Color.white,paddingLeft:5}),iconTogglesModernContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:32}),iconTogglesModernContainerLandscape:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:32,marginLeft:100,marginRight:100}),emptyView:()=>n.Styles.createViewStyle({height:0})});t.maybePresentCallPreviewPanel=function(e,t){J.default.newCauseId();const i=()=>P.default.navigateToCallPreviewViewModal({callOrigin:e.callOrigin,conversationMri:e.conversationMri,activeCallId:e.activeCallId,isGoLive:e.isGoLive,isTwinCam:e.isTwinCam,skipPermissionPanel:e.skipPermissionPanel},J.default.newCauseId());V.default.getS4LCMCFeatures().enableCallPreviewPermissionOnLoad?u.default.CallPermissionsUtils.checkPermissionBrowserAndContinue(i,i,e.conversationMri):i()};class ce extends g.default{constructor(){super(...arguments),this._isCameraChanged=!1,this._isStartOrJoinCallBtnPressed=!1,this._wasToggleBackgroundBlurChanged=!1,this._wasToggleCameraChanged=!1,this._wasToggleMicrophoneChanged=!1,this._wasTwinCamEnabled=!1,this._maybeCloseModal=(e=!1)=>{if(!this.props.isModal&&!e&&!this.props.isNewCallPreviewStyle)return;const t=J.default.newCauseId();U.log(G.LogTraceArea.CallingUI,"CallPreview _closeModal, causeId: "+t),E.default.isUsingStackNavigationContextNoSubscription()?P.default.goBack(t,this._getContext()):P.default.closeGenericDesktopModal(t,this._getRootViewId())},this._onLocalVideoPreviewRef=e=>{this.props.onVideoRenderingChange&&this.props.onVideoRenderingChange(!!e)},this._isLightAccessibleThemeUnderCamera=()=>this.props.displayControlsUnderVideoCanvas&&this._useAccessibleTheme()&&!this._useDarkTheme(),this._renderIconButtonWithSubtitle=(e,t,i,n,o)=>{let s=le.backgroundReplacementButtonLabelStyles,r=W.Color.white,l=W.Color.whiteOverlay70;this._isLightAccessibleThemeUnderCamera()&&(r=p.MeetNowColors.getButtonColors(!0).backgroundColor,l=W.Color.blackOverlay70,s=p.MeetNowStyle.getStyle(!0).background);const c=(0,a.jsx)(f.Subtitle,Object.assign({numberOfLines:1,style:s},{children:t}));return(0,a.jsx)(m.default,{icon:n,size:K.IconSize.size24,title:i,color:r,hoverColor:l,onPress:o,style:[...e,le.backgroundReplacementButtonStyles],accessoryView:c})},this._renderBackgroundReplacementButton=e=>this._renderIconButtonWithSubtitle(e,H.getString("AudioVideoSettings.CameraBackgroundReplacementLabel"),H.getString("AudioVideoSettings.CameraBackgroundReplacementLabel"),K.SkypeIcon.BackgroundReplacement,this._showAVSettings),this._renderAvSettingsButton=e=>this._renderIconButtonWithSubtitle(e,H.getString("AudioVideoSettings.Title"),H.getString("AudioVideoSettings.Title"),K.SkypeIcon.Settings,this._showAVSettings),this._switchCameraButtonPressed=()=>{this.isComponentMounted()&&this._updateVideoSource()},this._updateVideoSource=()=>{const e=J.default.newCauseId(),t=this.state.selectedCamera,i=o.find(this.state.cameras,(e=>e.id!==(null==t?void 0:t.id)&&e.position!==(null==t?void 0:t.position)));i?(u.default.DeviceStore.choosePreferredDevices({camera:i.id},e),U.log(G.LogTraceArea.CallingUI,"CallPreview _updateVideoSource "+t+" -> "+i+" causeId: "+e),this._isCameraChanged=!0):U.error(G.LogTraceArea.CallingUI,"CallPreview _updateVideoSource new camera not found causeId: "+e)},this._closeButtonPressed=()=>{this.props.conversationMri&&!this.props.isTwinCam&&h.default.trackLobbyClosed(this.props.conversationMri),U.log(G.LogTraceArea.CallingUI,"CallPreview closeButtonPressed"),this._maybeCloseModal()},this._onCameraSelected=e=>{var t,i;const a=J.default.newCauseId();U.log(G.LogTraceArea.CallingUI,"CallPreview _onCameraSelected "+e+"current deviceId"+(null===(t=this.state.selectedCamera)||void 0===t?void 0:t.id)+" causeId: "+a),e!==(null===(i=this.state.selectedCamera)||void 0===i?void 0:i.id)&&(u.default.DeviceStore.choosePreferredDevices({camera:e},a),this._isCameraChanged=!0)},this.onStartOrJoinCall=e=>{var t;const i=J.default.newCauseId();U.log(G.LogTraceArea.CallingUI,"CallPreview.onStartOrJoinCall activeCallId: "+this.props.activeCallId+" conversationMri: "+this.props.conversationMri+" isMicrophoneOn: "+this.state.isMicrophoneOn+" isCameraOn: "+this.state.isCameraOn+" transferCall: "+e+" activeEndpoints: "+this.state.activeUserEndpoints+" causeId: "+i);const a=this.props.callOrigin===G.NavigationCallOrigin.LegacyJoinLobby||this.props.callOrigin===G.NavigationCallOrigin.LegacyCreateLobby||this.props.callOrigin===G.NavigationCallOrigin.JoinLobby||this.props.callOrigin===G.NavigationCallOrigin.CreateLobby||this.props.callOrigin===G.NavigationCallOrigin.DeeplinkWithCallTrue;if(D.default.setCallPreviewSettings(this.state.isMicrophoneOn,this.state.isCameraOn,this.state.isBackgroundBlurred),this.props.conversationMri){this.props.hideActionButton||h.default.trackStartOrJoinMeetNowButtonClicked(this.props.conversationMri);let n=this.state.isMicrophoneOn?void 0:l.MuteFlags.MuteMicrophone;const o={conversationMri:this.props.conversationMri,withVideo:this.state.isCameraOn,origin:this.props.callOrigin,callId:this._getCallId(),muteFlag:n,isCameraSelected:this.state.isCameraOn&&!!(null===(t=this.state.selectedCamera)||void 0===t?void 0:t.id),permissionsAlreadyChecked:this.state.shouldAskPermissionOnLoad||this.props.permissionAlreadyAsked};if(!this.state.isProtocolLaunchCallPreview&&this.props.isGoLive||this.props.activeCallId)if(this.props.activeCallId){const t=!e&&this.state.screenMode===re.TwinCamAvailable;t&&(n=l.MuteFlags.MuteAll),e?oe.default.trackCallTransfered(this.props.conversationMri):t&&oe.default.trackStartTwinCamClicked(this.props.conversationMri);const a={conversationMri:this.props.conversationMri,callId:this.props.activeCallId,withVideo:this.state.isCameraOn,origin:this.props.callOrigin,isGoLive:this.props.isGoLive,muteFlag:n,isCameraSelected:!0,transferCall:e,skipNavigation:t,isTwinCam:t,permissionsAlreadyChecked:this.state.shouldAskPermissionOnLoad||this.props.permissionAlreadyAsked};let o;if(a.isTwinCam||this._maybeCloseModal(!0),u.default.ActiveCallUIHelper.getActiveCallId(this.props.conversationMri,t)===this.props.activeCallId){o=u.default.CallNavigationHelper.answerOrJoinCall(a,i);const e=this.state.isCameraOn?M.CallPreviewActions.JoinWithVideo:M.CallPreviewActions.JoinWithoutVideo;Y.default.trackCallPreview(e,this._isCameraChanged,!this.state.isMicrophoneOn,this.state.isBackgroundBlurred,this._getCallId())}else U.log(G.LogTraceArea.CallingUI,"CallPreview answerOrJoinCall call is already ended causeId: "+i),o=c.Rejected();o.then((()=>{this._wasTwinCamEnabled=t})),o.catch((()=>{a.isTwinCam?this.props.conversationMri&&oe.default.trackStartTwinCamClicked(this.props.conversationMri):this._maybeCloseModal(!0)}))}else(this.props.isNewCallPreviewStyle||a)&&this._maybeCloseModal(),u.default.CallNavigationHelper.startGoLiveCall(o,i);else(this.props.isNewCallPreviewStyle||a||this.props.callOrigin===G.NavigationCallOrigin.DeepLink)&&this._maybeCloseModal(),u.default.CallNavigationHelper.startCall(o,i)}else U.log(G.LogTraceArea.CallingUI,"CallPreview.onStartOrJoinCall stopped, conversationMri is undefined causeId: "+i);this._isStartOrJoinCallBtnPressed=!0},this.onEndCall=()=>{const e=J.default.newCauseId(),t=this.props.activeCallId,i=this.props.conversationMri;t&&i&&u.default.CallingStore.endCall(t,e).then((()=>{var t,a;U.log(G.LogTraceArea.CallingUI,"CallPreview onEndCall call is ended causeId: "+e),this.props.isTwinCam?(oe.default.trackTwinCamStopped(i),null===(a=(t=this.props).onTwinCamStopped)||void 0===a||a.call(t)):this._updateCallState(e)}))},this._onCallEnded=e=>{e.isTwinCam&&!u.default.CallingStore.hasEndedCallLocally(e.callId)&&(this._maybeCloseModal(!0),oe.default.trackCallEnded(e.conversationMri))},this._focusOn=e=>{0},this._onToggleMic=(e,t)=>{const i=J.default.newCauseId();if(U.log(G.LogTraceArea.CallingUI,"CallPreview._onToggleMic causeId: "+i),t)u.default.CallPermissionsUtils.requestPermissionStatus($.PermissionType.Microphone,i).then((e=>{if(e){const e=!0;this.setState({isMicrophoneOn:e},(()=>this._focusOn(this._microphoneToggleRef))),this._wasToggleMicrophoneChanged=!0,this.props.activeCallId&&this.state.callState===l.CallState.Connected?u.default.CallingStore.unmute(this.props.activeCallId,i):D.default.setCallPreviewMicSettings(e)}else U.log(G.LogTraceArea.CallingUI,"CallPreview._onToggleMic cannot obtain microphone permission current state: "+N.default.permissionStatus($.PermissionType.Microphone)+" causeId: "+i),A.default.showDeniedPromptWithSettingsOption($.PermissionType.Microphone,z.MainRootViewId)}));else{const e=!1;this.setState({isMicrophoneOn:e},(()=>this._focusOn(this._microphoneToggleRef))),this._wasToggleMicrophoneChanged=!0,this.props.activeCallId&&this.state.callState===l.CallState.Connected?u.default.CallingStore.mute(this.props.activeCallId,i):D.default.setCallPreviewMicSettings(e)}},this._onToggleVideo=(e,t)=>{var i,a,n;const o=J.default.newCauseId();if(U.log(G.LogTraceArea.CallingUI,"CallPreview._onToggleVideo causeId: "+o),t)u.default.CallPermissionsUtils.requestPermissionStatus($.PermissionType.Camera,o).then((e=>{var t;if(e){const e=!0;this.setState({isCameraOn:e},(()=>this._focusOn(this._cameraToggleRef))),this._wasToggleCameraChanged=!0,this.props.activeCallId&&this.state.callState===l.CallState.Connected?null===(t=u.default.CallingStore.getLocalVideoState(this.props.activeCallId))||void 0===t||t.setLocalVideoEnabled(!0):D.default.setCallPreviewCameraSettings(e)}else U.log(G.LogTraceArea.CallingUI,"CallPreview._onToggleVideo cannot obtain camera permission current state: "+N.default.permissionStatus($.PermissionType.Camera)+" causeId: "+o),A.default.showDeniedPromptWithSettingsOption($.PermissionType.Camera,z.MainRootViewId)}));else if(this.isComponentMounted()){const e=!1;this.setState({isCameraOn:e},(()=>this._focusOn(this._cameraToggleRef))),this._wasToggleCameraChanged=!0,this.props.activeCallId&&this.state.callState===l.CallState.Connected?null===(i=u.default.CallingStore.getLocalVideoState(this.props.activeCallId))||void 0===i||i.setLocalVideoEnabled(!1):D.default.setCallPreviewCameraSettings(e)}null===(n=(a=this.props).onVideoStateChanged)||void 0===n||n.call(a,t)},this._onToggleBlur=(e,t)=>{const i=J.default.newCauseId();this._wasToggleBackgroundBlurChanged=!0,U.log(G.LogTraceArea.CallingUI,"CallPreview blur toggle isBackgroundBlurred"+t+" activeCallId: "+this._getCallId()+" causeId: "+i),u.default.DeviceStore.setBackgroundBlurred(t),this.state.isCameraOn||this.state.isBackgroundBlurred?this.setState({isBackgroundBlurred:t},(()=>this._focusOn(this._backgroundBlurToggleRef))):this.setState({isBackgroundBlurred:t,isCameraOn:!0},(()=>this._focusOn(this._backgroundBlurToggleRef)))},this._showAVSettings=()=>{const e=J.default.newCauseId();U.log(G.LogTraceArea.CallingUI,"CallPreviewView._showAVSettings causeId: "+e),u.default.CallNavigationHelper.navigateToAVDesktopSettings(this._getRootViewId(),e)},this._canObserveActiveCall=()=>this.state.enableObservingCall&&this.props.conversationMri&&this.props.activeCallId,this._canDisposeObservingCall=()=>!this._isStartOrJoinCallBtnPressed&&this.state.enableObservingCall&&this.state.callState===l.CallState.Observing,this._canPreheatActiveCall=()=>this.state.enablePreHeatCall&&this.props.conversationMri&&this.props.activeCallId,this._canDisposePreheatedCall=e=>!this._isStartOrJoinCallBtnPressed&&this.state.callState!==l.CallState.Connected&&u.default.CallingStore.isPreheated(e),this._onMicrophoneToggleRef=e=>{this._microphoneToggleRef=e||void 0},this._onCameraToggleRef=e=>{this._cameraToggleRef=e||void 0},this._onBackgroundBlurToggleRef=e=>{this._backgroundBlurToggleRef=e||void 0},this._onSwitchCameraRef=e=>{this._switchCameraToggleRef=e||void 0}}_buildState(e,t){const i=this._getRootViewId(),a=e.conversationMri?B.default.getDisplayName(e.conversationMri):void 0,c=V.default.getS4LCMCFeatures(),d=D.default.getUserPreferencesLocal(),h=O.default.getAppState()===n.Types.AppActivationState.Background||E.default.isUsingStackNavigationContext()&&!1===e.currentScreenIsFocused,p={isLandscape:!this._getContext().isPresentedInDesktopSubview&&F.default.getDeviceOrientation(i)===s.DeviceOrientation.Landscape,isMobileScreenSize:F.default.isMobileScreenSize(i)||E.default.isUsingStackNavigationContext(),isCameraDisabled:!u.default.DeviceStore.hasCameras()&&!u.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),isMicrophoneDisabled:!u.default.DeviceStore.hasMicrophones(),selectedCamera:u.default.DeviceStore.getSelectedCamera(),cameras:u.default.DeviceStore.getCameras(),statusBarHeight:j.default.leavePaddingForStatusBar()?j.default.statusBarHeight():0,userMri:I.default.getSkypeMri(),conversationName:a,isProtocolLaunchCallPreview:e.callOrigin===G.NavigationCallOrigin.DeepLink,enableBlurBackgroundCallPreview:u.default.DeviceStore.isBackgroundBlurEnabled(),isSmallDesktopWindow:F.default.getWidth(i)<640,enableBackgroundReplacement:u.default.DeviceStore.isBackgroundReplacementEnabled(),enablePreHeatCall:c.enablePreHeatCall,enableObservingCall:c.enableObservingCall,enableCallHandoff:c.enableCallHandoff,enableTwinCam:c.twinCamEnabled,multipleEndpoints:!!e.activeCallId&&u.default.CallingStore.getConnectedEndpoints(e.activeCallId).length>0,callState:e.activeCallId?u.default.CallingStore.getCallState(e.activeCallId):void 0,isOutgoingVideoDisabled:u.default.CallingFeaturesHelper.isOutgoingVideoDisabled(),shouldAskPermissionOnLoad:!e.permissionAlreadyAsked&&c.enableCallPreviewPermissionOnLoad,isAwaitingCameraConfirmation:u.default.CallControlsStore.isAwaitingCameraConfirmation(),noPreview:h};if(o.includes([l.CallState.Preheated,l.CallState.Observing],p.callState)&&!p.multipleEndpoints&&(this._wasTwinCamEnabled=!1),o.includes([l.CallState.Disconnecting,l.CallState.Disconnected,l.CallState.Connecting],p.callState)||(p.screenMode=re.Join),!this._wasToggleCameraChanged){const e=!0;p.isCameraOn=!p.isOutgoingVideoDisabled&&!p.isCameraDisabled&&e&&N.default.permissionStatus($.PermissionType.Camera)===r.PermissionStatus.Granted&&(o.isUndefined(d.callPreviewCameraSetting)||!!d.callPreviewCameraSetting)}if(p.callState===l.CallState.Connected&&e.activeCallId?p.isMicrophoneOn=!ee.default.isLocalOrServerMuted(e.activeCallId):this._wasToggleMicrophoneChanged||(p.isMicrophoneOn=!p.isMicrophoneDisabled&&N.default.permissionStatus($.PermissionType.Microphone)===r.PermissionStatus.Granted&&(o.isUndefined(d.callPreviewMicSetting)||!!d.callPreviewMicSetting)),!this._wasToggleBackgroundBlurChanged){const e=!0;p.isBackgroundBlurred=e||!!d.callPreviewBlurSetting}return p}componentDidMount(){var e,t;super.componentDidMount();const i=J.default.newCauseId();U.log(G.LogTraceArea.CallingUI,"CallPreview componentDidMount causeId: "+i),X.dismissAll(),te.default.setCallPreviewViewSeen(this._getCallId()),k.registerModalDialogDismissalException(this.props.dialogId),this._callEndedEvent=u.default.CallingStore.callEndedEvent().subscribe(this._onCallEnded),this.state.enableBackgroundReplacement||this._setBlurBackground(i),this._updateCallState(i),this.state.shouldAskPermissionOnLoad&&u.default.CallPermissionsUtils.checkPermissionBrowserAndContinue(o.noop,o.noop,this.props.conversationMri,this.props.skipPermissionPanel),this.props.conversationMri&&!this.props.isTwinCam?h.default.trackLobbyOpen(this.props.conversationMri):this.props.conversationMri&&this.props.isTwinCam&&oe.default.trackLobbyOpen(this.props.conversationMri),null===(t=(e=this.props).onVideoStateChanged)||void 0===t||t.call(e,this.state.isCameraOn)}componentDidUpdate(e,t,i){var a;super.componentDidUpdate(e,t,i);const n=J.default.newCauseId();t.enableBlurBackgroundCallPreview===this.state.enableBlurBackgroundCallPreview&&e.activeCallId===this.props.activeCallId&&t.enableBackgroundReplacement===this.state.enableBackgroundReplacement||(U.log(G.LogTraceArea.CallingUI,"CallPreview componentDidUpdate causeId: "+n),this.state.enableBackgroundReplacement||this._setBlurBackground(n)),e.activeCallId!==this.props.activeCallId?(e.activeCallId&&this._canDisposePreheatedCall(e.activeCallId)&&this._disposePreheatedCall(e.activeCallId),this._updateCallState(n)):this.state.callState!==t.callState&&this.state.callState===l.CallState.Observing&&this._updateCallState(n);this.state.screenMode===re.TwinCamAvailable&&!this.props.isTwinCam&&!this._wasTwinCamEnabled&&this.props.conversationMri&&(oe.default.beginTrackingTwinCam(G.NavigationCallOrigin.TwinCamJoin),oe.default.trackJoinNavigationStarted(this.props.conversationMri),oe.default.trackLobbyOpen(this.props.conversationMri)),this._isCameraChanged&&(null===(a=this._switchCameraToggleRef)||void 0===a||a.requestFocus())}componentWillUnmount(){var e;super.componentWillUnmount();const t=J.default.newCauseId();U.log(G.LogTraceArea.CallingUI,"CallPreview componentWillUnmount causeId: "+t),te.default.setCallPreviewViewNotSeen(this._getCallId()),null===(e=this._callEndedEvent)||void 0===e||e.unsubscribe(),this.props.activeCallId&&this._canDisposePreheatedCall(this.props.activeCallId)&&this._disposePreheatedCall(this.props.activeCallId),this._canDisposeObservingCall()&&u.default.CallingStore.disposeObservingCalls(t),this._isStartOrJoinCallBtnPressed||Y.default.trackCallPreview(M.CallPreviewActions.Cancel,this._isCameraChanged,!this.state.isMicrophoneOn,this.state.isBackgroundBlurred,this._getCallId()),this._isStartOrJoinCallBtnPressed||h.default.finishScenario(),D.default.setCallPreviewSettings(this.state.isMicrophoneOn,this.state.isCameraOn,this.state.isBackgroundBlurred)}_updateCallState(e){!this.state.enableObservingCall||this._canDisposeObservingCall()?this._canPreheatActiveCall()&&!this._preheatedCallCauseId&&this._startPreheatingActiveCall():this._canObserveActiveCall()&&this._startObservingActiveCall(e)}render(){var e,t;const i=this.props.isModal?(0,a.jsx)(m.default,{style:le.closeButton,icon:L.closeIcon(),size:K.IconSize.size24,title:H.getString("Global.CloseButtonTitle"),onPress:this._closeButtonPressed,color:W.Color.white,hoverColor:W.Color.whiteOverlay70}):this._renderEmptyForFlexboxView();let o,s,r,l,c;const u=v.formatDevicesForPicker(this.state.cameras),h=this._renderConversationTitle(),{isSmallDesktopWindow:p}=this.state;if(this.props.isNewCallPreviewStyle&&!d.default.isMobile()){const e=[le.settingsButtonStyleOnDesktop];r=this._renderAvSettingsButton(e)}if(this.state.isCameraOn&&!this.state.isCameraDisabled){this.state.noPreview||(o=(0,a.jsx)(ne.default,{ref:this._onLocalVideoPreviewRef,nametag:"video_local_preview",options:this.props.videoPreviewOptions}));{const i=[le.cameraControlContainer];if(this.props.isNewCallPreviewStyle)s=void 0;else if(this.state.isProtocolLaunchCallPreview||!this.state.enableBlurBackgroundCallPreview||p){const e=this.props.displayControlsUnderVideoCanvas&&this.state.enableBlurBackgroundCallPreview,o=this.props.fullScreenMode&&(p?2:3);s=(0,a.jsx)(n.View,Object.assign({style:i},{children:(0,a.jsx)(b.default,{tabIndex:o||void 0,items:u,onValueChange:this._onCameraSelected,selectedValue:(null===(t=this.state.selectedCamera)||void 0===t?void 0:t.id)||"",labelColor:e?void 0:W.Color.white,style:this.props.isModal?void 0:le.cameraPickerTopRightCornerNonModal})}))}else i.push(le.newCameraControlContainer),this.props.displayControlsUnderVideoCanvas&&i.push(le.pickersUnderVideoCanvas),this.props.fullScreenMode&&i.push(le.previewCameraControlSmallScreen),r=(0,a.jsx)(n.View,Object.assign({style:i},{children:(0,a.jsx)(b.default,{items:u,onValueChange:this._onCameraSelected,selectedValue:(null===(e=this.state.selectedCamera)||void 0===e?void 0:e.id)||"",labelColor:this.props.displayControlsUnderVideoCanvas?void 0:W.Color.white})}))}}else this.props.fullScreenMode||(l=(0,a.jsx)(n.View,Object.assign({style:[le.convIcon,_.default.absoluteFill]},{children:(0,a.jsx)(q.UserIcon,{userMri:this.state.userMri,placeholderIcon:this.props.useAvatarPlaceholderIcon?K.SkypeIcon.Contact:void 0,size:this.props.avatarSize?this.props.avatarSize:this.state.isLandscape?Q.UserIconSize.Size100:Q.UserIconSize.Size160})})));const g=!this.state.isCameraDisabled&&!this.state.isProtocolLaunchCallPreview&&!p&&this.state.enableBackgroundReplacement&&!this.props.isNewCallPreviewStyle&&!0;if(g){const e=[le.blurToggleStyleOnDesktop];this.props.displayControlsUnderVideoCanvas&&e.push(le.pickersUnderVideoCanvas),this.props.fullScreenMode&&e.push(le.previewCameraControlSmallScreen),c=this.state.enableBackgroundReplacement?this._renderBackgroundReplacementButton(e):this._renderToggleWithText({styles:e,text:H.getString("CallPreview.CallPreviewBlurToggleLabel"),key:"blur",accessibilityLabel:H.getString("CallPreview.CallPreviewBlurToggleLabel"),value:this.state.isBackgroundBlurred,onToggle:this._onToggleBlur})}const C=this._getCallPreviewControl(g),S=[le.dialogHeaderContainer],y=this._getHeaderTopMargin(!!h);y&&S.push(R.default.marginTopStyle(y));const f=[_.default.absoluteFill,le.videoCanvasWrapper];this.props.fullScreenMode||this.state.isMobileScreenSize||(f.push(le.videoBorderRadius),f.push(le.videoBoxShadow));return(0,a.jsxs)(n.View,Object.assign({style:le.dialog},{children:[(0,a.jsx)(se.default,{statusBarKey:"CallPreviewView",backgroundColor:W.Color.black,barStyle:se.BarStyle.LIGHT_CONTENT,animated:!0}),(0,a.jsxs)(n.View,Object.assign({style:f},{children:[o,(0,a.jsx)(n.View,{style:[le.videoShadow,_.default.absoluteFill]}),l]})),(0,a.jsxs)(n.View,Object.assign({style:S},{children:[i,h,s]})),this.props.displayControlsUnderVideoCanvas?(0,a.jsxs)(n.View,Object.assign({style:le.controlsWrapper},{children:[C,r]})):(0,a.jsxs)(n.View,Object.assign({style:le.controlsWrapper},{children:[r,C]})),c]}))}_renderEmptyForFlexboxView(){const e=[le.closeButton];return this.props.isNewCallPreviewStyle&&e.push(le.emptyView),(0,a.jsx)(n.View,{style:e},"emptyForFlexbox")}_getHeaderTopMargin(e){return this.state.isMobileScreenSize&&!this.state.isLandscape&&!this._getContext().isPresentedInDesktopSubview&&this.state.statusBarHeight>0?this.state.statusBarHeight:e&&!this.state.isMobileScreenSize&&this.state.isLandscape?15:5}_renderOptionalCameraAndMicrophoneDetails(){if(!this.props.showCameraAndMicrophoneDetails||this.state.isMicrophoneOn&&this.state.isCameraOn)return;let e;return e=!this.state.isMicrophoneOn&&this.state.isCameraOn?H.getString("CallPreview.MicrophoneOff"):this.state.isMicrophoneOn&&!this.state.isCameraOn?H.getString("CallPreview.CameraOff"):H.getString("CallPreview.CameraAndMicrophoneOff"),(0,a.jsx)(n.Text,Object.assign({style:le.cameraAndMicrophoneDetails},{children:e}))}_renderConversationTitle(){if(this.props.callOrigin&&G.NavigationCallOrigin[this.props.callOrigin]===G.NavigationCallOrigin[G.NavigationCallOrigin.InviteLink]){const e=[le.conversationTitle];return this.state.isCameraOn,(0,a.jsxs)(n.View,Object.assign({style:le.conversationHeader},{children:[(0,a.jsx)(n.Text,Object.assign({style:e,ellipsizeMode:"tail",numberOfLines:1},{children:this.state.conversationName})),(0,a.jsx)(f.Caption,Object.assign({style:le.conversationSubtitle},{children:H.getString("CallPreview.CallPreviewCallInProgressSubtitle")}))]}))}}_renderOptionalActionButton(){if(this.props.hideActionButton)return;const e=this.props.callOrigin===G.NavigationCallOrigin.LegacyJoinLobby||this.props.callOrigin===G.NavigationCallOrigin.LegacyCreateLobby||this.props.callOrigin===G.NavigationCallOrigin.JoinLobby||this.props.callOrigin===G.NavigationCallOrigin.CreateLobby||this.props.callOrigin===G.NavigationCallOrigin.DeeplinkWithCallTrue,t=e&&!this.props.activeCallId||this.state.isProtocolLaunchCallPreview,i={backgroundColor:t?W.Color.blue:W.Color.green,textColor:W.Color.white};if(this.state.screenMode===re.TwinCamConnected){const e={backgroundColor:W.Color.red,textColor:W.Color.white};return(0,a.jsx)(n.View,Object.assign({style:this.state.isLandscape?le.footerLandscape:le.footer},{children:(0,a.jsx)(y.default,{buttonSize:z.SXButtonSize.Medium,buttonStyle:z.SXButtonStyle.Custom,title:H.getString("CallPreview.StopTwinCam"),onPress:()=>this.onEndCall(),buttonConfig:e,autoFocus:!1,disabled:!this.props.conversationMri})}))}if(this.state.screenMode!==re.None){const o=this.state.screenMode===re.TwinCamAvailable;if(e&&o)return;let s;s=o?H.getString("CallPreview.StartTwinCam"):t?H.getString("CallPreview.StartCallButtonTitle"):H.getString("CallPreview.JoinButtonTitle");const r=o?{paddingTop:15,paddingBottom:15}:void 0,l=this.state.enableCallHandoff&&(this.state.multipleEndpoints||o),c=l&&!o,d=l&&!c?this.state.isLandscape?le.footerWideLandscape:le.wideFooter:this.state.isLandscape?le.footerLandscape:le.footer;return(0,a.jsxs)(n.View,Object.assign({style:d},{children:[!c&&(0,a.jsx)(y.default,{buttonSize:z.SXButtonSize.Medium,buttonStyle:o?void 0:z.SXButtonStyle.Custom,title:s,buttonConfig:o?void 0:i,onPress:()=>this.onStartOrJoinCall(!1),autoFocus:!1,disabled:!this.props.conversationMri,backgroundStyle:r,icon:o?K.SkypeIcon.TwinCamMid:void 0,style:void 0}),(l||c)&&(0,a.jsx)(y.default,{buttonSize:z.SXButtonSize.Medium,buttonStyle:z.SXButtonStyle.LightFill,title:H.getString("CallPreview.HandoffCallTransfer"),onPress:()=>this.onStartOrJoinCall(!0),icon:K.SkypeIcon.CallTransfer,disabled:!this.props.conversationMri,backgroundStyle:r,style:void 0})]}))}}_getCallPreviewControl(e){const t=[le.previewControl];this.state.isLandscape&&t.push(le.previewControlLandscape),this.props.previewControlStyle&&t.push(this.props.previewControlStyle);const i=!e&&this.state.enableBackgroundReplacement&&this.state.isSmallDesktopWindow&&!this.state.isCameraDisabled&&!this.state.isProtocolLaunchCallPreview&&!this.props.isNewCallPreviewStyle,o=i?this._renderBackgroundReplacementButton([le.blurToggleStyleOnSmallWindow]):void 0;return(0,a.jsxs)(n.View,Object.assign({style:t},{children:[this._renderOptionalCameraAndMicrophoneDetails(),this._renderControlSection(i||e),o,this._renderOptionalActionButton()]}))}_renderControlSection(e){const{isNewCallPreviewStyle:t}=this.props,i=this._getCallControlMicButton(),o=this._getCallControlVideoButton(),s=this._getCallControlBackgroundBlurButton(e),r=this.state.screenMode===re.TwinCamAvailable;if(d.default.isMobile()&&t){const e=this._getCallControlCameraReverseButton();return(0,a.jsxs)(n.View,Object.assign({style:this.state.isLandscape&&r?le.iconTogglesModernContainerLandscape:le.iconTogglesModernContainer},{children:[i,o,e,s]}))}return!0===this.props.isNewCallPreviewStyle?(0,a.jsxs)(n.View,Object.assign({style:le.iconTogglesContainer},{children:[i,o,s]})):(0,a.jsxs)(n.View,Object.assign({style:le.iconTogglesContainer},{children:[o,i,s]}))}_getCallControlCameraReverseButton(){const{isNewCallPreviewStyle:e,isTwinCam:t}=this.props,{isProtocolLaunchCallPreview:i}=this.state;if(i&&!t||!e)return;let n;return n=this.state.selectedCamera?this.state.selectedCamera.position===l.CameraPosition.Front?H.getString("CallControls.CallButtonSwitchCameraBackwardLabel"):H.getString("CallControls.CallButtonSwitchCameraForwardLabel"):H.getString("CallControls.CallButtonSwitchCameraLabel"),(0,a.jsx)(ae.CallButton,{ref:this._onSwitchCameraRef,icon:K.SkypeIcon.SwitchCamera,title:H.getString("CapturePanel.SwitchCameraButtonTitle"),size:ae.CallButtonSize.Large,onPress:this._switchCameraButtonPressed,accessibilityLabel:n,backgroundStyle:ae.CallButtonBackgroundStyle.Solid},ie.CallControlsKeys.VideoQuickSettings)}_getCallControlVideoButton(){const e=!this.state.isCameraDisabled&&this.state.isCameraOn;if(this.props.isNewCallPreviewStyle){let t,i;const n=d.default.isMobile()?ae.CallButtonSize.Large:ae.CallButtonSize.Small;return this.state.isOutgoingVideoDisabled?t=i=H.getString("AudioVideoSettings.OutgoingVideoDisabled"):(t=H.getString(e?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel"),i=w.default.generateTooltipLabelWithShortcutForCondition(t,G.KeyboardShortcut.ToggleCamera)),(0,a.jsx)(ae.CallButton,{ref:this._onCameraToggleRef,icon:this.state.isAwaitingCameraConfirmation?K.SkypeIcon.Ok:e?K.SkypeIcon.Video:K.SkypeIcon.VideoOff,title:i,size:n,isDisabled:this.state.isCameraDisabled,isToggledOn:e,onPress:t=>this._onToggleVideo(t,!e),accessibilityLabel:t,backgroundStyle:e?ae.CallButtonBackgroundStyle.Overlay:ae.CallButtonBackgroundStyle.Solid,colorConfig:this.state.isAwaitingCameraConfirmation?this._cameraConfirmColorConfig():void 0,doNotAddHorizontalMargin:!1},ie.CallControlsKeys.Video)}{const t=this.state.isOutgoingVideoDisabled?"AudioVideoSettings.OutgoingVideoDisabled":"CallPreview.ToggleVideoAccessibilityLabel";return(0,a.jsx)(C.default,{ref:this._onCameraToggleRef,icon:e?K.SkypeIcon.Video:K.SkypeIcon.VideoOff,accessibilityLabel:H.getString(t),iconSize:K.IconSize.size24,style:[le.iconTogglesContainer,le.iconStyle],isOn:e,onChange:this._onToggleVideo,disable:this.state.isOutgoingVideoDisabled||this.state.isCameraDisabled},"video")}}_getCallControlMicButton(){const e=!this.state.isMicrophoneDisabled&&this.state.isMicrophoneOn;if(this.props.isNewCallPreviewStyle){const t=d.default.isMobile()?ae.CallButtonSize.Large:ae.CallButtonSize.Small,i=H.getString(e?"CallControls.CallButtonMute":"CallControls.CallButtonUnmuteLabel"),n=w.default.generateTooltipLabelWithShortcutForCondition(i,G.KeyboardShortcut.ToggleMicrophone);return(0,a.jsx)(ae.CallButton,{ref:this._onMicrophoneToggleRef,icon:e?K.SkypeIcon.Microphone:K.SkypeIcon.MicrophoneOff,title:n,size:t,isToggledOn:e,onPress:t=>this._onToggleMic(t,!e),accessibilityLabel:i,backgroundStyle:e?ae.CallButtonBackgroundStyle.Overlay:ae.CallButtonBackgroundStyle.Solid,doNotAddHorizontalMargin:!1},ie.CallControlsKeys.Mic)}return this.state.isProtocolLaunchCallPreview?void 0:(0,a.jsx)(C.default,{ref:this._onMicrophoneToggleRef,icon:e?K.SkypeIcon.Microphone:K.SkypeIcon.MicrophoneOff,accessibilityLabel:H.getString("CallPreview.ToggleMicrophoneAccessibilityLabel"),iconSize:K.IconSize.size24,style:[le.iconTogglesContainer,le.iconStyle],isOn:e,onChange:this._onToggleMic,disable:this.state.isMicrophoneDisabled},"microphone")}_getCallControlBackgroundBlurButton(e){const t=this.state.enableBlurBackgroundCallPreview&&!e,i=!this.state.isCameraDisabled&&this.state.isCameraOn;if(!this.props.isNewCallPreviewStyle)return t?(0,a.jsx)(C.default,{ref:this._onBackgroundBlurToggleRef,icon:K.SkypeIcon.BackgroundReplacement,accessibilityLabel:H.getString("CallPreview.CallPreviewBlurToggleLabel"),iconSize:K.IconSize.size24,style:[le.iconTogglesContainer],isOn:i&&this.state.isBackgroundBlurred,onChange:this._onToggleBlur,disable:!i,disableInteraction:!i},"blur"):void 0;i&&this.state.isBackgroundBlurred,H.getString("CallPreview.CallPreviewBlurToggleLabel"),d.default.isMobile()?ae.CallButtonSize.Large:ae.CallButtonSize.Small}_renderToggleWithText(e){return(0,a.jsxs)(n.View,Object.assign({style:e.styles},{children:[(0,a.jsx)(f.BodyText,Object.assign({size:f.BodyTextSize.SmallDeprecated,style:le.toggleText,numberOfLines:1},{children:e.text})),(0,a.jsx)(S.default,{style:le.accessibleToggleSwitchStyle,isOn:e.value,accessibilityLabel:e.accessibilityLabel,onChange:e.onToggle,disable:e.disable,disableInteraction:e.disableInteraction},e.key)]}))}_getHeaderText(e){return ce.getHeaderText()}static getHeaderText(){return H.getString("CallPreview.CallPreviewViewLabel")}_setBlurBackground(e){U.log(G.LogTraceArea.CallingUI,"CallPreview _setBlurBackground causeId: "+e),!this.state.isCameraDisabled&&this.state.enableBlurBackgroundCallPreview&&(U.log(G.LogTraceArea.CallingUI,"CallPreview _setBlurBackground blur background as user preference, callId: "+this._getCallId()+" causeId: "+e),u.default.DeviceStore.setBackgroundBlurred(this.state.isBackgroundBlurred))}_cameraConfirmColorConfig(){return{iconColor:W.Color.white,backgroundColor:W.Color.blue,selectedIconColor:W.Color.white,selectedBackgroundColor:W.Color.blue}}_getCallId(){return this.props.activeCallId||this.props.fallbackCallId||J.default.newGuid()}_startObservingActiveCall(e){const{conversationMri:t,activeCallId:i,callOrigin:a}=this.props;if(U.log(G.LogTraceArea.CallingUI,"CallPreview._startObservingActiveCall conversationMri: "+T.mriOrId(t)+" activeCallId: "+i+" causeId: "+e),t&&i)this.state.callState!==l.CallState.Observing?u.default.CallingStore.subscribeToCall(t,i,a,e).then((()=>{!this.isComponentMounted()&&this._canDisposeObservingCall()&&this._disposeObservingCall(e)})):U.log(G.LogTraceArea.CallingUI,"CallPreview._startObservingActiveCall abort, call already observed activeCallId: "+i+" causeId: "+e);else{const a="CallPreview._startObservingActiveCall abort, conversationMri and activeCallId cannot be undefined conversationMri: "+T.mriOrId(t)+" activeCallId: "+i+" causeId: "+e;U.error(G.LogTraceArea.CallingUI,a)}}_disposeObservingCall(e=J.default.newCauseId()){U.log(G.LogTraceArea.CallingUI,`CallPreview._disposeObservingCalls causeId: ${e}`),u.default.CallingStore.disposeObservingCalls(e)}_startPreheatingActiveCall(){const e=J.default.newCauseId(),{conversationMri:t,activeCallId:i,callOrigin:a}=this.props;if(U.log(G.LogTraceArea.CallingUI,"CallPreview._startPreheatingActiveCall conversationMri: "+t+" activeCallId: "+i+" causeId: "+e),t&&i)u.default.CallingStore.isPreheatedNoSubscription(i)?U.log(G.LogTraceArea.CallingUI,"CallPreview._startPreheatingActiveCall abort, call already preheated activeCallId: "+i+" causeId: "+e):(u.default.CallingStore.startPreheating(t,i,{withVideo:this.state.isCameraOn,muteFlags:this.state.isMicrophoneOn?void 0:l.MuteFlags.MuteMicrophone},a,e).then((()=>{!this.isComponentMounted()&&this._canDisposePreheatedCall(i)&&this._disposePreheatedCall(i)})),this._preheatedCallCauseId=e);else{const a="CallPreview._startPreheatingActiveCall abort, conversationMri and activeCallId cannot be undefined conversationMri: "+t+" activeCallId: "+i+" causeId: "+e;U.error(G.LogTraceArea.CallingUI,a)}}_disposePreheatedCall(e){const t=this._preheatedCallCauseId||J.default.newCauseId();U.log(G.LogTraceArea.CallingUI,`CallPreview._disposePreheatedCall callId: ${e} causeId: ${t}`),u.default.CallingStore.stopPreheating(e,t)}}t.default=ce},911881:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.testableSubmitPressed=void 0;const a=i(785893),n=i(496486),o=i(421832),s=i(583367),r=i(516778),l=i(934339),c=i(651587),d=i(462033),u=i(67930),h=i(951638),p=i(109520),g=i(671830),C=i(711930),S=i(898278),m=i(822854),y=i(404336),f=i(437490),b=i(952262),_=i(746096),T=i(139285),v=i(136400),w=i(110117),I=i(436237),P=i(915877),M=i(374606),k=i(733754),A=i(178735),R=i(29130),x=i(451070),L=i(681115),V=i(910265),O=i(190631),B=i(22222),D=i(581760),E=i(640363),N=i(311010),F=i(711828),j=i(680837),U=i(619675),H=i(702301),z=i(567977),G=i(853374),W=(0,P.lazyProperties)({starsPage:()=>r.Styles.createViewStyle({flex:1,alignItems:"center"}),starsPageInnerContainer:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",paddingTop:20}),starsPageInner:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"space-around"}),starsContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignSelf:"stretch",justifyContent:"space-between"}),problemSectionContainer:()=>r.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch",paddingLeft:10}),problemSectionTitle:()=>r.Styles.createTextStyle({paddingTop:20,paddingBottom:10}),checkboxAndTextContainer:()=>r.Styles.createViewStyle({justifyContent:"center",paddingVertical:5,paddingRight:5,borderBottomWidth:1,minHeight:50}),checkbox:()=>r.Styles.createViewStyle({position:"absolute",right:0,top:12}),problem:()=>r.Styles.createTextStyle({marginRight:48}),starIconSmall:()=>r.Styles.createViewStyle({alignItems:"center"}),starIconDeselected:()=>r.Styles.createViewStyle({opacity:.7}),starText:()=>r.Styles.createTextStyle({textAlign:"center",width:200}),footer:()=>r.Styles.createViewStyle({height:120,alignSelf:"stretch"}),footerLandscape:()=>r.Styles.createViewStyle({height:60,alignSelf:"stretch"}),footerButton:()=>r.Styles.createViewStyle({height:60,alignSelf:"stretch",justifyContent:"center",alignItems:"center"}),titleContainer:()=>r.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",alignItems:"center",paddingTop:10}),title:()=>r.Styles.createTextStyle({alignSelf:"stretch",textAlign:"center",marginBottom:5,marginTop:10,marginHorizontal:15}),subtitle:()=>r.Styles.createTextStyle({alignSelf:"stretch",textAlign:"center",marginHorizontal:15}),body:()=>r.Styles.createTextStyle({marginVertical:20,marginHorizontal:10}),rateUsPage:()=>r.Styles.createViewStyle({flex:1,paddingVertical:10}),rateUsSectionContainer:()=>r.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"center",paddingHorizontal:10}),rateUsButton:()=>r.Styles.createButtonStyle({flex:1,alignSelf:"stretch"}),rateUsFooter:()=>r.Styles.createViewStyle({height:120,marginHorizontal:10,alignSelf:"stretch"}),rateUsFooterLandscape:()=>r.Styles.createViewStyle({height:60,marginHorizontal:10,alignSelf:"stretch",flexDirection:"row"}),rateUsText:()=>r.Styles.createTextStyle({marginTop:20,marginHorizontal:10,textAlign:"center"})}),K="CallQualityFeedback.";class $ extends u.default{constructor(){super(...arguments),this._submitPressedTrue=()=>this._submitPressed(!0),this._submitPressedFalse=()=>this._submitPressed(!1),this._toggleForStar1=e=>this._starToggled(e,1),this._toggleForStar2=e=>this._starToggled(e,2),this._toggleForStar3=e=>this._starToggled(e,3),this._toggleForStar4=e=>this._starToggled(e,4),this._toggleForStar5=e=>this._starToggled(e,5),this._contentForSection=e=>{const t=k.getStringUnsafe(K+e.title);return(0,a.jsxs)(r.View,Object.assign({style:W.problemSectionContainer},{children:[(0,a.jsx)(U.Subtitle,Object.assign({style:W.problemSectionTitle},{children:t})),n.map(e.problems,this._contentForProblem)]}),e.title)},this._contentForProblem=e=>{const t=K+e,i=k.getStringUnsafe(t),o=n.includes(this.state.checkedProblems,e),s=[r.Types.AccessibilityTrait.CheckBox];o&&s.push(r.Types.AccessibilityTrait.Checked);const l=i;return(0,a.jsx)(r.Button,Object.assign({accessibilityTraits:s,accessibilityLabel:l,onPress:t=>this._problemTokenToggled(t,e)},{children:(0,a.jsxs)(T.default,Object.assign({style:[W.checkboxAndTextContainer,this._themeStyles.dividerBorderColorStyle]},{children:[(0,a.jsx)(U.BodyText,Object.assign({style:W.problem},{children:i})),(0,a.jsx)(r.View,Object.assign({style:W.checkbox},{children:(0,a.jsx)(M.default,{isOn:o})}))]}))}),e)},this._onBack=()=>(this._submitPressedTrue(),I.log(_.LogTraceArea.HardwareBackButton,"goBack: true componentId: CallQualityFeedbackPanel"),!0)}_buildState(e,t){const i=Object.assign({top:x.default.statusBarPadding(),bottom:x.default.bottomSafeAreaInset(S.BottomInsetDefault)},x.default.horizontalInsets(S.HorizontalInsetDefault)),a=this._getRootViewId(),n={displayName:b.default.getDisplayName(e.conversationMri),isOneOnOne:g.isOneOnOneConversation(e.conversationMri),isLandscape:!this._getContext().isPresentedInDesktopSubview&&R.default.getDeviceOrientation(a)===s.DeviceOrientation.Landscape,isSmallDevice:R.default.isSmallDevice(a),isMobileScreenSize:R.default.isMobileScreenSize(a),safeAreaInsets:i};return t&&(n.stars=0,n.renderingProblems=!1,n.renderingRateUs=!1,n.checkedProblems=[]),n}componentDidMount(){super.componentDidMount(),f.dismissAll(),d.default.subscribe(this._onBack)}componentWillUnmount(){super.componentWillUnmount(),d.default.unsubscribe(this._onBack)}render(){const e=this.state.renderingProblems?this._contentForProblemsPage():this.state.renderingRateUs?this._contentForRateUsPage():this._contentForStarsPage();return(0,a.jsx)(V.default,Object.assign({dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:this.state.isMobileScreenSize?void 0:y.DefaultWidth,maxHeight:this.state.isMobileScreenSize?void 0:y.DefaultHeight,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:e.accessibilityLabel},{children:(0,a.jsx)(r.View,Object.assign({style:[j.default.flexOne,this._themeStyles.primaryBackgroundColorStyle]},{children:e.content}))}))}_headerCloseButton(){return{closeButtonType:O.CloseButtonType.Close,title:k.getString("Global.CloseButtonTitle"),onPress:this._submitPressedTrue,color:this._themeColors.primaryIconColor}}_contentForStarsPage(){let e;e=this.state.isOneOnOne?(0,a.jsx)(H.UserIcon,{userMri:this.props.conversationMri,size:this.state.isLandscape?z.UserIconSize.Size60:z.UserIconSize.Size120}):(0,a.jsx)(m.ConversationIcon,{conversationId:this.props.conversationMri,altName:this.state.displayName,size:this.state.isLandscape?z.ConversationIconSize.Size60:z.ConversationIconSize.Size120});const t=[N.default.messagingHeaderFontStyle(!!this.state.isLandscape),this._themeStyles.primaryTextColorStyle,W.title],i=[W.titleContainer];this.state.safeAreaInsets.top&&i.push(L.default.paddingTopStyle(this.state.safeAreaInsets.top));const n=(0,a.jsxs)(r.View,Object.assign({style:i},{children:[(0,a.jsx)(r.Text,Object.assign({style:t,numberOfLines:1},{children:this.state.displayName})),(0,a.jsx)(U.Subtitle,Object.assign({style:W.subtitle},{children:g.isEncryptedThread(this.props.conversationMri)?k.getString("CallQualityFeedback.SubtitleEncrypted"):k.getString("CallQualityFeedback.Subtitle")}))]})),o=k.getString("CallQualityFeedback.Title");return{content:(0,a.jsxs)(r.View,Object.assign({style:W.starsPage},{children:[n,(0,a.jsx)(r.View,Object.assign({style:W.starsPageInnerContainer},{children:(0,a.jsxs)(r.View,Object.assign({style:W.starsPageInner},{children:[e,(0,a.jsx)(U.BodyText,Object.assign({bold:!0,style:W.starText},{children:o})),(0,a.jsxs)(r.View,Object.assign({style:W.starsContainer},{children:[this._contentForStar(1,this._toggleForStar1),this._contentForStar(2,this._toggleForStar2),this._contentForStar(3,this._toggleForStar3),this._contentForStar(4,this._toggleForStar4),this._contentForStar(5,this._toggleForStar5)]}))]}))})),this._renderFooter()]})),accessibilityLabel:o}}_accessibilityLabelForStarNum(e){switch(e){case 1:return k.getString("CallQualityFeedback.1-StarAccessibilityLabel");case 2:return k.getString("CallQualityFeedback.2-StarAccessibilityLabel");case 3:return k.getString("CallQualityFeedback.3-StarAccessibilityLabel");case 4:return k.getString("CallQualityFeedback.4-StarAccessibilityLabel");default:return k.getString("CallQualityFeedback.5-StarAccessibilityLabel")}}_contentForStar(e,t){const i=this.state.stars||0,n=[W.starIconSmall],o=i<e;o&&n.push(W.starIconDeselected);let s=this._accessibilityLabelForStarNum(e);return i===e&&(s+=", "+k.getString("Global.SelectedAccessibilityLabel")),(0,a.jsx)(v.HoverableButton,Object.assign({onPress:t,accessibilityLabel:s},{children:(0,a.jsx)(w.default,{icon:o?F.SkypeIcon.Favourite:F.SkypeIcon.FavouriteFilled,size:F.IconSize.size32,color:D.Color.blue,style:n})}))}_contentForProblemsPage(){const e=this._headerCloseButton(),t={icon:F.SkypeIcon.Send,title:k.getString("Global.SendButtonTitle"),disabled:n.isEmpty(this.state.checkedProblems),onPress:this._submitPressedFalse,flipIcon:this._getContext().isRTL},i=(0,a.jsx)(O.SimplePanelHeader,{panelName:k.getString("CallQualityFeedback.ProblemsTitle"),leftButton:e,rightButtons:t});let o;o=1===n.size(this.props.problemSections)?this.props.problemSections[0].type===h.ProblemSectionType.Audio?k.getString("CallQualityFeedback.ProblemsAudioBody"):k.getString("CallQualityFeedback.ProblemsVideoBody"):k.getString("CallQualityFeedback.ProblemsAudioAndVideoBody");const s=[W.problemSectionContainer];L.default.hasHorizontalSafeAreas(this.state.safeAreaInsets)&&s.push(L.default.horizontalPaddingStyle(this.state.safeAreaInsets));return{content:(0,a.jsxs)(r.View,Object.assign({style:j.default.flexOne},{children:[i,(0,a.jsx)(r.ScrollView,Object.assign({style:j.default.flexOne},{children:(0,a.jsxs)(r.View,Object.assign({style:s},{children:[(0,a.jsx)(U.BodyText,Object.assign({style:W.body},{children:o})),n.map(this.props.problemSections,this._contentForSection)]}))}))]})),accessibilityLabel:o}}_contentForRateUsPage(){const e=[W.rateUsPage];this.state.safeAreaInsets.top&&e.push(L.default.paddingTopStyle(this.state.safeAreaInsets.top)),this.state.safeAreaInsets.bottom&&e.push(L.default.paddingBottomStyle(this.state.safeAreaInsets.bottom));const t=k.getString("CallQualityFeedback.RateTheAppBody");return{content:(0,a.jsxs)(r.View,Object.assign({style:e},{children:[(0,a.jsx)(U.PanelHeader,Object.assign({landscape:this.state.isLandscape,style:W.rateUsText},{children:k.getString("CallQualityFeedback.Thanks")})),(0,a.jsx)(U.BodyText,Object.assign({style:W.rateUsText},{children:t})),(0,a.jsx)(r.View,Object.assign({style:W.rateUsSectionContainer},{children:(0,a.jsx)(l.AnimatedEmoticon,{size:this.state.isLandscape?l.Size.ExtraLarge:l.Size.ExtraExtraLarge,innerText:"like",emoticonName:"like",showPlaceHolder:!0,standaloneAnimation:!0})})),(0,a.jsxs)(r.View,Object.assign({style:this.state.isLandscape?W.rateUsFooterLandscape:W.rateUsFooter},{children:[(0,a.jsx)(B.default,{style:W.rateUsButton,buttonStyle:S.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:D.AgnosticGradientFillButtonColors.blue,onPress:this._submitPressedFalse,title:k.getString("CallQualityFeedback.RateTheApp")}),(0,a.jsx)(B.default,{style:W.rateUsButton,buttonSize:S.SXButtonSize.Medium,buttonStyle:S.SXButtonStyle.ThemeNoBackground,title:k.getString("CapturePermissions.PrePromptCancelButtonTitle"),onPress:this._submitPressedTrue})]}))]})),accessibilityLabel:t}}_renderFooter(){let e;this.state.renderingProblems||this.state.renderingRateUs||(e={title:this.state.stars?k.getString("Global.SendButtonTitle"):k.getString("Global.CancelLabel"),onPress:this.state.stars?this._submitPressedFalse:this._submitPressedTrue});const t=e?(0,a.jsx)(B.default,{style:W.footerButton,buttonSize:S.SXButtonSize.Medium,buttonStyle:S.SXButtonStyle.ThemeNoBackground,title:e.title,onPress:e.onPress}):void 0;return(0,a.jsx)(r.View,Object.assign({style:this.state.isLandscape?W.footerLandscape:W.footer},{children:t}))}_submitPressed(e){const t=G.default.newCauseId();I.log(_.LogTraceArea.Navigation,"CallQualityFeedbackPanel._submitPressed,  causeId: "+t),this.isComponentMounted(),q(this.props,this.state,(e=>{this.isComponentMounted()&&this.setState(e)}),e)&&this._goBack(t)}_problemTokenToggled(e,t){e.stopPropagation();let i=!1;const a=this.state.checkedProblems?n.clone(this.state.checkedProblems):[];n.includes(a,t)?n.remove(a,(e=>e===t)):(a.push(t),i=!0);const o=K+t,s=k.getStringUnsafe(o)+", "+(i?k.getString("FeedbackMechanism.AccLabelCheckboxChecked"):k.getString("FeedbackMechanism.AccLabelCheckboxUnchecked"));r.Accessibility.announceForAccessibility(s),this.setState({checkedProblems:a})}_starToggled(e,t){e.stopPropagation();const i=C.default.combinedAccessibilityLabel(this._accessibilityLabelForStarNum(t),k.getString("Global.SelectedAccessibilityLabel"));i&&r.Accessibility.announceForAccessibility(i),this.setState({stars:t})}_getCheckboxAccessibilityLabel(e,t){const i=this._getCheckboxCheckedState(t);return k.getString("FeedbackMechanism.AccLabelCheckbox",{checkboxTitle:e,state:i})}_getCheckboxCheckedState(e){return e?k.getString("FeedbackMechanism.AccLabelCheckboxChecked"):k.getString("FeedbackMechanism.AccLabelCheckboxUnchecked")}_getHeaderText(e){return $.getHeaderText()}static getHeaderText(){return k.getString("CallQualityFeedback.Title")}}function q(e,t,i,a){if(t.renderingRateUs)return a||(c.openAppStore(),A.default.setUserPreferencesLocal({lastRateUsPromptInfo:{version:E.default.getAppVersion(),timestamp:Date.now()}})),!0;if(a||t.renderingProblems||5===t.stars){const i=t.stars?"random":"cancel",a=t.stars||void 0,n=t.stars&&t.stars<5?(0,h.tokensString)(t.checkedProblems||[]):void 0,s=new p.CQF(e.callId,e.endpointId,e.nodeId,e.participantId,a,n,105,i,e.pstnCdrId,e.maxConnectedParticipants);return I.log(_.LogTraceArea.CallQualityFeedback,"CQF: submitting event. reason: "+i+", stars: "+a+", problemTokens: "+n),I.track(s),o.default.provideCallQualityFeedback(e.callId,e.participantId,"105",i,a?a-1:0,n),!0}return i({renderingProblems:!0}),!1}t.default=$,t.testableSubmitPressed=q},780572:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(667294),s=i(967593),r=(0,i(915877).lazyProperties)({gradient:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,bottom:0,left:0,opacity:.8})});t.default=(0,o.memo)((({gradientColors:e,borderRadius:t,showBackgroundGradient:i})=>{if(!(null==e?void 0:e.length)||!i)return null;const o=[r.gradient];return t&&o.push(n.Styles.createViewStyle({borderRadius:t},!1)),(0,a.jsx)(s.GradientView,{style:o,direction:s.GradientDirection.BOTTOM,colors:e})}))},696104:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionType=void 0;const a=i(785893),n=i(516778),o=i(667294),s=i(934339),r=i(581760),l=i(109520),c=i(915877),d=i(746096),u=i(436237),h=i(898278),p=i(619675),g=i(104735),C=i(723752),S=i(311010),m=i(382677),y=i(853374);var f;!function(e){e[e.Text=0]="Text",e[e.Emoji=1]="Emoji",e[e.Sticker=2]="Sticker",e[e.Animation=3]="Animation",e[e.Snapshot=4]="Snapshot",e[e.Quote=5]="Quote",e[e.Link=6]="Link"}(f=t.CallReactionType||(t.CallReactionType={}));const b=(0,c.lazyProperties)({textReaction:()=>n.Styles.createTextStyle({color:r.Color.white,textAlign:"center",lineHeight:S.default.controlFontSize.h3})}),_={renderMedia:!1,textOverrideStyle:[S.default.fontStyle.h4,b.textReaction],allowTextFallbackEmoticons:!0,allowLargeEmoticons:!0,allowHugeEmoticons:!0,allowClickableLinks:!1};t.default=(0,o.memo)((({reactionType:e,callId:t,content:i,reaction:r,isCompact:c})=>{const S=(0,o.useCallback)((e=>{e.stopPropagation();const i=y.default.newCauseId();u.log(d.LogTraceArea.CallReactions,"CallReactionItemContent.onPressTextReaction, causeId: "+i),u.track(new l.CanvasAndRibbonActionsEvent(l.CanvasAndRibbonActions.OpenChat,t)),r.conversationId&&r.createdTime&&g.default.navigateToConversation({convId:r.conversationId,scrollToTimestamp:r.createdTime,forceRefreshFocus:!0,origin:d.NavigationConversationOrigin.Call,causeId:i})}),[r.conversationId,r.createdTime,t]);if(e===f.Emoji){const e=m.separateReactionNameAndTone(i);return(0,a.jsx)(s.AnimatedEmoticon,{size:c?s.Size.Large:s.Size.ExtraExtraLarge,innerText:i,emoticonName:e.reactionNameWithoutTone,standaloneAnimation:!0,tone:e.reactionTone})}if(!(e!==f.Text&&e!==f.Quote&&e!==f.Link||c)){let t;switch(e){case f.Text:t=(0,a.jsx)(C.default,{message:r,options:_});break;case f.Quote:case f.Link:t=(0,a.jsx)(p.Header,Object.assign({size:h.HeaderSize.h4,style:b.textReaction},{children:i}))}return(0,a.jsx)(n.Button,Object.assign({onPress:S},{children:t}))}return e!==f.Snapshot||c?null:(0,a.jsx)(p.Header,Object.assign({size:h.HeaderSize.h4,style:b.textReaction},{children:i}))}))},676455:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(667294),s=i(780572),r=i(696104),l=i(696104),c=i(660289),d=i(915877),u=i(18078),h=i(445026),p=i(680837),g=i(912770),C=350,S=n.Animated.Easing.CubicBezier(1,0,.78,1),m=n.Animated.Easing.CubicBezier(.33,0,0,1),y=(0,d.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute",top:0,bottom:0,left:0,right:0,paddingHorizontal:16,alignItems:"center",justifyContent:"center"}),containerCompact:()=>n.Styles.createViewStyle({paddingHorizontal:0,paddingVertical:0})});t.default=({reactionType:e,cuid:t,callId:i,content:d,reaction:f,isCompact:b,gradientColors:_,borderRadius:T,showBackgroundGradient:v})=>{const w=(0,o.useRef)(new n.Animated.Value(.25)),I=(0,o.useRef)(new n.Animated.Value(0)),P=(0,o.useRef)(n.Styles.createAnimatedViewStyle({opacity:I.current})),M=(0,o.useMemo)((()=>e!==l.CallReactionType.Text&&(b&&u.default.isMyMri(f.creator)||!b)?1.5:1.2),[b,f.creator,e]),k=(0,o.useRef)(0),A=[y.container,p.default.overflowVisible,P.current,b?y.containerCompact:void 0],R=(0,o.useRef)(),x=(0,o.useCallback)((()=>{const t=h.default.timing(w.current,{toValue:M,duration:C,easing:S,useNativeDriver:!0}),i=e===l.CallReactionType.Text?c.default.getTextTimeoutBasedOnContent(d):2e3;1!==I._value?R.current=n.Animated.parallel([h.default.timing(I.current,{toValue:1,duration:C,easing:S,useNativeDriver:!0}),t]):R.current=t,R.current.start((e=>{R.current=h.default.timing(w.current,{toValue:1,duration:C,easing:m,useNativeDriver:!0}),R.current.start((e=>{k.current=g.default.setTimeout((()=>{R.current=n.Animated.parallel([h.default.timing(I.current,{toValue:0,duration:C,easing:S,useNativeDriver:!0}),h.default.timing(w.current,{toValue:.25,duration:C,easing:S,useNativeDriver:!0})]),R.current.start((()=>{R.current=void 0}))}),i)}))}))}),[d,e,M]),L=(0,o.useCallback)((()=>{var e;null===(e=R.current)||void 0===e||e.stop(),g.default.clearTimeout(k.current),k.current=-1}),[]),V=(0,o.useRef)(t);return(0,o.useEffect)((()=>{V.current!==t&&(V.current=t,L(),x())}),[x,L,t]),(0,o.useEffect)((()=>(x(),()=>{L()})),[x,L]),(0,a.jsxs)(n.Animated.View,Object.assign({style:A,ignorePointerEvents:!0},{children:[(0,a.jsx)(s.default,{gradientColors:_,borderRadius:T,showBackgroundGradient:v}),(0,a.jsx)(r.default,{reactionType:e,callId:i,content:d,reaction:f,isCompact:b})]}))}},503936:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionsActionSheet=void 0;const a=i(496486),n=i(581400),o=i(746096),s=i(436237),r=i(33004),l=i(293194),c=i(853374);t.CallReactionsActionSheet=class{constructor(e){this._onActionButtonPress=(e,t)=>{if(t===l.SXActionMenuCancel)s.log(o.LogTraceArea.CallingUI,"Dismissing call reaction action sheet");else this._reactionPressed(t)},this._reactionSheetOptions=e,this._reactions=a.map(e.reactions,(e=>({key:e.key,info:e})))}showReactionActionSheet(e,t){a.isEmpty(this._reactions)?s.warn(o.LogTraceArea.CallingUI,"ReactionPack is empty, not showing action sheet"):(s.log(o.LogTraceArea.CallingUI,"showing reactions menu"),this._showReactionActionMenu(e,t))}_showReactionActionMenu(e,t){const i=a.map(this._reactions,(e=>({text:r.default.localizedAccessibilityTextForEmoticon(e.key)||e.key,command:e.key})));l.default.showWithActionMenuConfig({options:{anchor:e,buttons:i},callback:t=>this._onActionButtonPress(e,t),rootViewId:t,invokingEvent:void 0})}_reactionPressed(e){const t=c.default.newCauseId();s.log(o.LogTraceArea.CallingUI,"_onReactionPressed causeId: "+t);const i=a.find(this._reactions,(t=>t.key===e));if(i){const e={reactionInfo:i.info,causeId:t,timestamp:Date.now(),postSource:o.PostSource.CallReactionPressed,callId:this._reactionSheetOptions.callId,conversationMri:this._reactionSheetOptions.conversationMri,reactionsConversationMri:this._reactionSheetOptions.reactionsConversationMri,logTraceArea:o.LogTraceArea.CallingUI};n.CallReactionPostingHelpers.postReaction(e)}}}},899734:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(583367),s=i(516778),r=i(889391),l=i(503936),c=i(502278),d=i(480200),u=i(471727),h=i(803493),p=i(911009),g=i(898278),C=i(124338),S=i(677381),m=i(746096),y=i(436237),f=i(915877),b=i(445026),_=i(29130),T=i(451070),v=i(536150),w=i(76350),I=i(581760),P=i(853374),M=(0,f.lazyProperties)({barContainer:()=>s.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0,paddingLeft:8,flexDirection:"row",overflow:"visible",backgroundColor:I.Color.transparent}),tabletReactionsContainer:()=>s.Styles.createViewStyle({justifyContent:"flex-end",height:340})});class k extends S.default{constructor(){super(...arguments),this._coachMarkContext={coachMarkArea:p.CoachMarkAreaType.CallReactionsBar},this._menuAnimatedTansformValue=new s.Animated.Value(0),this.closeReactionsDrawer=()=>{this._reactionsDrawer&&this._reactionsDrawer.closeDrawer()},this.setOverflowCoachMarksEnabled=e=>{this.setState({overflowCoachMarksEnabled:e})},this._onOpenCloseAnimationCompleteForStackNav=e=>{b.default.timing(this._menuAnimatedTansformValue,{toValue:e?this.props.minDrawerHeight+(this.props.audioNotificationOffset||0):0,duration:150,easing:s.Animated.Easing.Out(),useNativeDriver:!0}).start(),y.log(m.LogTraceArea.CallReactions,"ReactionsBar._onToggleOpen open: "+e),this.props.onReactionsDrawerOpen&&this.props.onReactionsDrawerOpen(e)},this._onOpenCloseAnimationCompleteForComposite=e=>{this.state.compositeReactionsDrawerOpen!==e&&this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:e}),this.props.onReactionsDrawerOpen&&this.props.onReactionsDrawerOpen(e)},this._onLayoutChanged=e=>{var t,i;null===(i=(t=this.props).onDesiredHeightChanged)||void 0===i||i.call(t,Math.max(this.props.minDrawerHeight,e.height))},this._onReactionsDrawerRef=e=>{this._reactionsDrawer=e||void 0}}_buildState(e,t){var i,a;const n=r.default.getS4LCMCFeatures(),s=this._getRootViewId(),l=h.default.getCelebrationData(e.conversationMri,e.callId),c={horizontalInsets:e.isUsingStackNavigationContext?T.default.horizontalInsets(g.HorizontalInsetDefault):{left:15,right:15},emoticonReactionKey:u.default.getEmoticonReactionKey(l),isMobileScreenReaderEnabled:v.default.isMobileScreenReaderEnabled(),celebrationData:l,showCustomizeReactionsButton:(null===(i=n.customCallReactions)||void 0===i?void 0:i.enabled)&&(null===(a=n.customCallReactions)||void 0===a?void 0:a.useNewAddEmojiIcon)};return t&&(c.rootViewId=s,c.isLandscape=_.default.getDeviceOrientation(s)===o.DeviceOrientation.Landscape,c.compositeReactionsDrawerOpen=!1,c.overflowCoachMarksEnabled=!1),c}componentDidMount(){super.componentDidMount();const e=P.default.newCauseId();y.log(m.LogTraceArea.CallReactions,"CallReactionsBar.componentDidMount causeId: "+e),this._startOrStopOrientationListener(!0,e),this.props.controlsType===d.CallControlsType.Mobile&&b.default.markAnimatedValue(this._menuAnimatedTansformValue,0)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._reactionsDrawer&&this.state.compositeReactionsDrawerOpen!==t.compositeReactionsDrawerOpen&&(this.state.compositeReactionsDrawerOpen?this._reactionsDrawer.openDrawer():this._reactionsDrawer.closeDrawer())}componentWillUnmount(){super.componentWillUnmount();const e=P.default.newCauseId();y.log(m.LogTraceArea.CallReactions,"CallReactionsBar.componentWillUnmount causeId: "+e),this._startOrStopOrientationListener(!1,e)}close(){return!(!this._reactionsDrawer||this.props.controlsType===d.CallControlsType.Mobile)&&this._reactionsDrawer.closeDrawer()}openReactionsDrawer(e){y.log(m.LogTraceArea.CallReactions,"CallReactionsBar.openReactionsDrawer causeId: "+e);const t=()=>{};if(this.state.isMobileScreenReaderEnabled){new l.CallReactionsActionSheet({reactionsConversationMri:this.props.reactionsConversationId,conversationMri:this.props.conversationMri,callId:this.props.callId,reactions:u.default.getReactionItems(this.state.celebrationData)}).showReactionActionSheet(t,this._getRootViewId())}else this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:!0,openReactionsOnHover:!1})}toggleReactionsPickerHovered(){this.isComponentMounted()&&this.setState({compositeReactionsDrawerOpen:!0,openReactionsOnHover:!0})}isDrawerOpen(){return!!this._reactionsDrawer&&this._reactionsDrawer.isOpen()}_startOrStopOrientationListener(e,t){e?this._deviceOrientationKey||(this._deviceOrientationKey=n.uniqueId("ReactionsBar"),o.default.addOrientationEventListener(this._deviceOrientationKey,(e=>{const i=e===o.DeviceOrientation.Landscape;this.isComponentMounted()&&this.state.isLandscape!==i&&(this.setState({isLandscape:i}),c.default.updateCallTelemetry(this.props.callId,t,(e=>e.orientationChanged(i))))}))):this._deviceOrientationKey&&(o.default.removeOrientationEventListener(this._deviceOrientationKey),this._deviceOrientationKey=void 0)}_renderReactionsDrawer(){if(!this.state.compositeReactionsDrawerOpen&&!this.props.isUsingStackNavigationContext)return null;let e;const t=this.props.controlsType===d.CallControlsType.Mobile;e=this.props.isUsingStackNavigationContext?(0,a.jsx)(w.default,{ref:this._onReactionsDrawerRef,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationId,callId:this.props.callId,bottomSafeAreaInset:this.props.bottomSafeAreaInset,horizontalInsets:this.state.horizontalInsets,controlsType:this.props.controlsType,onOpenCloseAnimationComplete:this._onOpenCloseAnimationCompleteForStackNav,celebrationData:this.state.celebrationData,audioNotificationOffset:this.props.audioNotificationOffset}):(0,a.jsx)(C.default,{ref:this._onReactionsDrawerRef,conversationMri:this.props.conversationMri,reactionsConversationMri:this.props.reactionsConversationId,callId:this.props.callId,controlsType:this.props.controlsType,onOpenCloseAnimationComplete:this._onOpenCloseAnimationCompleteForComposite,drawerOpenedOnHover:this.state.openReactionsOnHover,celebrationData:this.state.celebrationData,showCustomizeReactionsButton:this.state.showCustomizeReactionsButton,rootViewId:this.state.rootViewId});const i=!this.props.isUsingStackNavigationContext&&t?[M.tabletReactionsContainer]:this._barContainerStyles();return(0,a.jsx)(s.View,Object.assign({style:i,ignorePointerEvents:!0},{children:e}))}_barContainerStyles(){return[M.barContainer,s.Styles.createViewStyle({height:this.props.minDrawerHeight+this.props.bottomSafeAreaInset,paddingBottom:this.props.bottomSafeAreaInset},!1)]}render(){return(0,a.jsx)(s.View,Object.assign({style:this.props.style,onLayout:this._onLayoutChanged,ignorePointerEvents:!0},{children:(0,a.jsx)(p.CoachMarkContext.Provider,Object.assign({value:this._coachMarkContext},{children:this._renderReactionsDrawer()}))}))}}t.default=k},912614:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stickerMargin=void 0;const a=i(785893),n=i(496486),o=i(516778),s=i(934339),r=i(889391),l=i(480200),c=i(677381),d=i(168934),u=i(915877),h=i(382677),p=i(33004),g=(i(29130),i(581760)),C=i(311010),S=i(680837);t.stickerMargin=4;const m=(0,u.lazyProperties)({sticker:()=>o.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible",marginHorizontal:t.stickerMargin}),stickerInnerView:()=>o.Styles.createViewStyle({flex:1,overflow:"visible"}),imageSticker:()=>o.Styles.createViewStyle({position:"absolute",top:3,left:3,height:38,width:38}),modernImageSticker:()=>o.Styles.createViewStyle({height:28,width:28}),menuItemPosition:()=>o.Styles.createViewStyle({height:40,padding:3}),scaledEmoticon:()=>o.Styles.createViewStyle({transform:[{scale:.8}]}),caption:()=>o.Styles.createTextStyle({textAlign:"center",fontSize:C.default.controlFontSize.actionButtonLabel,color:g.Color.white,height:15,paddingHorizontal:4,width:70}),captionLightTheme:()=>o.Styles.createTextStyle({color:g.Color.gray400}),hidden:()=>o.Styles.createTextStyle({opacity:0})});class y extends c.default{constructor(){super(...arguments),this._hovered=!1,this._onReactionButtonRef=e=>{this._reactionButton=e||void 0},this._onPress=e=>{this.props.onPress(this.props.info,e.timeStamp)},this._onHoverStart=e=>{this._onHover(!0)},this._onHoverEnd=e=>{this._onHover(!1)}}_buildState(e,t){return{isSmallDevice:!1}}componentWillUnmount(){super.componentWillUnmount(),this._hovered&&d.default.clearToolTip()}_stickerView(){const e=p.default.localizedAccessibilityTextForImageSticker(this.props.info.key),t=[m.imageSticker];return this.props.useDesktopCallControls&&t.push(m.modernImageSticker),(0,a.jsx)(o.Image,{style:t,source:p.default.imageForSticker(this.props.info.key),title:e,accessibilityLabel:e})}_emoticonView(){const e=h.separateReactionNameAndTone(this.props.info.key);let t=p.default.localizedAccessibilityTextForEmoticon(e.reactionNameWithoutTone);this.props.celebrationData&&this.props.info.key===r.default.getS4LCMCFeaturesNoSubscription().callCelebrationConfig.callCelebrateButtonKey&&(t=this.props.celebrationData.celebrationText);const i=this.state.isSmallDevice||this.props.useDesktopCallControls?s.Size.Medium:s.Size.Large,n=[m.scaledEmoticon];return this.props.hideIcon&&n.push(m.hidden),this.props.isCallMenuItem&&n.push(m.menuItemPosition),(0,a.jsx)(o.View,Object.assign({style:n,accessibilityLabel:t,title:t},{children:(0,a.jsx)(s.AnimatedEmoticon,{size:i,innerText:t,emoticonName:e.reactionNameWithoutTone,standaloneAnimation:!0,isStatic:!this.props.isAnimated,preventSelectable:!0,tone:e.reactionTone})}))}_getStickerDimesionStyles(){let e,t;return this.state.isSmallDevice||this.props.useDesktopCallControls?(e=34,t=34):(e=44,t=44),this.props.caption&&(t+=15),o.Styles.createViewStyle({width:e,height:t},!1)}requestFocus(){this._reactionButton&&this._reactionButton.requestFocus()}_onHover(e){this._hovered=e;const t=()=>!(!(this.isComponentMounted()&&this.props.title&&this.props.showToolTip&&this._hovered)||o.UserInterface.isNavigatingWithKeyboard());t()?n.delay((()=>{t()&&d.default.showToolTip((()=>this.isComponentMounted()?this:void 0),this._getRootViewId(),t,this.props.title||"")}),150):d.default.clearToolTip(),this.props.onHover&&this.props.onHover(e)}render(){const e=!!this.props.onPanHorizontal,t=[m.sticker,S.default.noncollapsibleView],i=e?[m.stickerInnerView]:[t,this._getStickerDimesionStyles()];let n,s;if(this.props.info.type===l.ReactionsItemType.Sticker?n=this._stickerView():this.props.info.type!==l.ReactionsItemType.Emoticon&&this.props.info.type!==l.ReactionsItemType.Animation||(n=this._emoticonView()),this.props.caption){const e=[m.caption];this.props.useLightTheme&&e.push(m.captionLightTheme),s=(0,a.jsx)(o.Text,Object.assign({style:e,ellipsizeMode:"tail",numberOfLines:1},{children:this.props.caption}))}let r=(0,a.jsxs)(o.Button,Object.assign({ref:this._onReactionButtonRef,style:i,activeOpacity:.5,tabIndex:this.props.tabIndex,importantForAccessibility:this.props.importantForAccessibility,accessibilityLabel:this.props.accessibilityLabel,onPress:this._onPress,onHoverStart:this._onHoverStart,onHoverEnd:this._onHoverEnd},{children:[n,s]}));return e&&(r=(0,a.jsx)(o.GestureView,Object.assign({style:[t,this._getStickerDimesionStyles()],onPanHorizontal:this.props.onPanHorizontal,releaseOnRequest:!1,importantForAccessibility:this.props.importantForAccessibility},{children:r}))),r}}y.stickerSize=44,y.stickerMargin=t.stickerMargin,t.default=y},866080:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(396265),s=i(148540),r=i(516778),l=i(994224),c=i(800719),d=i(647176),u=i(898278),h=i(587134),p=i(746096),g=i(791771),C=i(649770),S=i(436237),m=i(915877),y=i(733754),f=i(172425),b=i(451070),_=i(285683),T=i(581760),v=i(680837),w=i(790970),I=i(619675),P=i(24576),M=i(853374),k="groupShareButton",A="activeParticipantHeader",R="inactiveParticipantHeader",x=(0,m.lazyProperties)({itemDivider:()=>r.Styles.createViewStyle({height:1}),itemContainer:()=>r.Styles.createViewStyle({paddingHorizontal:20}),participantDividerPadding:()=>r.Styles.createViewStyle({marginLeft:50}),sectionTitle:()=>r.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"flex-start"}),sectionTitleWithButton:()=>r.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}),ringAllButton:()=>r.Styles.createTextStyle({color:T.Color.blue})});class L extends P.default{constructor(){super(...arguments),this._isParticipantOnHold=e=>{var t;const i=n.filter(this.state.activeParticipants,(t=>t.key===e));if(i.length>0)return(null===(t=n.first(i))||void 0===t?void 0:t.participantState)===s.ParticipantState.OnHold},this._handleRingAgain=e=>{l.default.CallParticipantUtils.addUsersToCallOrRing([e],this.props.callId,this.props.conversationMri,[e],p.NavigationAddToCallOrigin.RosterView);const t=M.default.newCauseId();S.log(p.LogTraceArea.CallingUI,`[CallRosterContent] _addParticipantsToCall, causeId: ${t}`),w.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRangUser())),n.every(this.state.inactiveParticipants,(t=>!0===t.isRinging||t.key===e))&&this.props.onCloseRoster&&this.props.onCloseRoster()},this._onRingTheGroupButtonPress=()=>{f.default.handleRingTheGroup(this.props.conversationMri,this.props.callId);const e=y.getString("CallPanel.GroupCallRingingStatusMessage");r.Accessibility.announceForAccessibility(e);const t=M.default.newCauseId();S.log(p.LogTraceArea.CallingUI,`[CallRosterContent] _onRingTheGroupButtonPress, causeId: ${t}`),w.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRingTheGroup())),this.props.onCloseRoster&&this.props.onCloseRoster()},this._renderItem=e=>{if(e.key===A){const t=y.getString("CallPanel.CallRosterPresentTitle");return(0,a.jsx)(r.View,Object.assign({style:[x.sectionTitle,x.itemContainer]},{children:(0,a.jsx)(_.SectionTitle,{title:t,titleStyles:v.default.flexOne},e.key)}),e.key)}const t=this._renderRingTheGroupButton();if(e.key===R){const i=y.getString("CallPanel.CallRosterAbsentTitle"),n=t?x.sectionTitleWithButton:x.sectionTitle;return(0,a.jsxs)(r.View,Object.assign({style:[n,x.itemContainer]},{children:[(0,a.jsx)(_.SectionTitle,{title:i,titleStyles:v.default.flexOne},e.key),t]}),e.key)}let i;const n=[x.itemDivider,this._themeStyles.dividerColorStyle];if(e.key===k)i=(0,a.jsx)(C.default,{conversationId:this.props.conversationMri,callId:this.props.callId,origin:g.ShareGroupButtonOrigin.CallRosterPanel,hideDivider:!0,renderAsListItem:!0},e.key);else{const t=this.state.allParticipants[e.key];i=(0,a.jsx)(c.default,{userMri:e.key,callId:this.props.callId,isPresent:t.isActive,isTalking:t.isTalking,isLocal:t.isLocal,isLocalMuteSupported:t.isLocalMuteSupported,isRinging:t.isRinging,isServerMuted:t.isServerMuted,isServerMutedSupported:t.isServerMutedSupported,isLocalMuted:t.isLocalMuted,isOnHold:this._isParticipantOnHold(e.key),onRingAgainClicked:this._handleRingAgain},e.key),n.push(x.participantDividerPadding)}return(0,a.jsxs)(r.View,Object.assign({style:x.itemContainer},{children:[i,(0,a.jsx)(h.default,{style:n},"itemDivider")]}))}}_buildState(e,t){const i=l.default.CallingStore.isCallConnected(e.callId),a=d.default.getAllMembersWithActiveAndInactiveParticipants(e.conversationMri,e.callId,t?{}:this.state.allParticipants),n=a.activeParticipants,o=a.inactiveParticipants;return{allParticipants:a.allParticipants,activeParticipants:n,inactiveParticipants:o,isCallConnected:i,safeAreaHorizontalInsets:b.default.horizontalInsets(u.HorizontalInsetDefault),ringlessCallType:f.default.getRinglessCallType(e.conversationMri,e.callId)}}render(){const e=[];e.push({key:k,height:70,template:"dcrp_action",accessibilityTrait:r.Types.AccessibilityTrait.Button});const t=[];this.state.activeParticipants.length&&(t.push({key:A,height:48,template:"crv_header"}),n.each(this.state.activeParticipants,(e=>{t.push({key:e.key,height:55,template:"crv_participant"})})));const i=[];return this.state.inactiveParticipants.length&&(i.push({key:R,height:48,template:"crv_header"}),n.each(this.state.inactiveParticipants,(e=>{i.push({key:e.key,height:55,template:"crv_participant"})}))),(0,a.jsx)(r.View,Object.assign({style:v.default.flexOne},{children:(0,a.jsx)(o.VirtualListView,{itemList:n.union(e,t,i),renderItem:this._renderItem,animateChanges:!0,keyboardShouldPersistTaps:!0,horizontalPadding:this.state.safeAreaHorizontalInsets})}))}_renderRingTheGroupButton(){if(!f.default.isLocallyStartedRinglessCall(this.props.conversationMri,this.props.callId)||!this.state.isCallConnected||l.default.CallingStore.hasRingingParticipants(this.props.callId,!0)||this.state.ringlessCallType!==f.LocallyStartedRinglessCallType.SmallGroup)return;const e=y.getString("CallPanel.GroupCallRingAllButtonTitle");return(0,a.jsx)(r.Button,Object.assign({accessibilityLabel:e,onPress:this._onRingTheGroupButtonPress},{children:(0,a.jsx)(I.Caption,Object.assign({style:x.ringAllButton,selected:!0},{children:e}))}))}}t.default=L},800719:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(994224),s=i(647176),r=i(471727),l=i(671830),c=i(539549),d=i(746096),u=i(139285),h=i(913944),p=i(110117),g=i(436237),C=i(915877),S=i(733754),m=i(451072),y=i(844972),f=i(399189),b=i(390244),_=i(754306),T=i(581760),v=i(711828),w=i(680837),I=i(790970),P=i(619675),M=i(24576),k=i(702301),A=i(567977),R=i(172758),x=i(286259),L=i(853374),V=i(613125),O=i(480200),B=A.UserIconSize.Size40,D=(0,C.lazyProperties)({listItem:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),userIconContainer:()=>n.Styles.createViewStyle({width:50,height:50,alignItems:"flex-start",justifyContent:"center",overflow:"visible"}),ringingView:()=>n.Styles.createViewStyle({position:"absolute",width:B,height:B,borderRadius:B/2,alignItems:"center",justifyContent:"center",backgroundColor:T.Color.blackOverlay50}),optionalIconButton:()=>n.Styles.createViewStyle({alignItems:"center",backgroundColor:T.Color.transparent,paddingLeft:25,paddingRight:10}),optionalButton:()=>n.Styles.createViewStyle({alignItems:"center",backgroundColor:T.Color.transparent,paddingLeft:25}),raiseHandBorderStyle:()=>n.Styles.createViewStyle({borderColor:T.Color.raiseHandOrange,borderWidth:2})});class E extends M.default{constructor(){super(...arguments),this._handleLocalHangup=e=>{const t=L.default.newCauseId();g.log(d.LogTraceArea.CallingUI,`[CallRosterListItem] _handleLocalHangup, causeId: ${t}`),o.default.CallingStore.endCall(this.props.callId,t),I.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRemovedUser()))},this._handleRemoteHangup=e=>{const t=L.default.newCauseId();g.log(d.LogTraceArea.CallingUI,`[CallRosterListItem] _handleRemoteHangup, causeId: ${t}`),s.default.handleRemoteHangup(e,this.props.callId,t),I.default.updateCallRosterTelemetry(this.props.callId,t,(e=>e.callRosterRemovedUser()))},this._onMuteOrUnMuteButtonPress=e=>{e.stopPropagation();const t=L.default.newCauseId();this.props.isLocal?(g.log(d.LogTraceArea.CallingUI,`[CallRosterListItem:_onMuteOrUnMuteButtonPress] handleLocalMuteOrUnmute, causeId: ${t}`),r.default.announceMicrophoneState(s.default.handleLocalMuteOrUnmute(this.props.callId,t))):(g.log(d.LogTraceArea.CallingUI,`[CallRosterListItem:_onMuteOrUnMuteButtonPress] _handleRemoteMute, causeId: ${t}`),s.default.handleRemoteMute(this.props.userMri,this.props.callId,t))},this._onRingAgainOrHangUpButtonPress=e=>{e.stopPropagation(),this.props.isPresent?this.props.isLocal?this._handleLocalHangup(this.props.userMri):this._handleRemoteHangup(this.props.userMri):this.props.onRingAgainClicked(this.props.userMri)},this._onPinUnpinPressed=()=>{this._pinUnpinCommand.execute()},this._onLowerHandPressed=()=>{this._lowerHandParticipantCommand.execute(),r.default.announceLoweredHandState(!!this.props.isLocal,this.state.displayName)},this._onHoverStart=e=>{this.setState({isHovering:!0})},this._onHoverEnd=e=>{this.setState({isHovering:!1})}}_buildState(e,t){const i=R.default.getDisplayableUserByMri(e.userMri),a=o.default.CallingStore.getCallConversationMri(e.callId),n=a&&(0,c.default)().getConversation(a),s=i?i.getDisplayName():S.getString("DisplayInfoStore.ListMyName"),d=e.isLocal?O.CallStageElementKeys.localUserKey:e.userMri;return t&&(this._lowerHandParticipantCommand=new f.LowerHandParticipantCommand(e.callId,e.userMri,_.LowerHandOrigin.ParticipantsPanel,!!e.isLocal,s),this._pinUnpinCommand=new V.PinUnpinCommand(d,e.callId)),{userProfile:l.isAgent(e.userMri)?void 0:i,displayName:s,hideMuteIcon:(0,y.isRegularMemberInModeratedGroup)(n)&&!e.isLocal,hideCallIcon:(0,y.isRegularMemberInModeratedGroup)(n),canHandBeLowered:this._lowerHandParticipantCommand.canExecute(),isHandRaised:this._lowerHandParticipantCommand.isHandRaised(),isPinned:r.default.isCallParticipantPinned(d,e.callId),isPinningFeatureAllowed:e.isPresent&&(r.default.shouldShowCallParticipantPinOption(d,e.callId)||r.default.shouldShowCallParticipantUnpinOption(d,e.callId))}}_renderRingAgainOrHangUpIcon(){let e;if(!this.props.isRinging&&!this.state.hideCallIcon){let t,i;this.props.isPresent?(t=v.SkypeIcon.CallEnd,i=S.getString("CallControls.CallButtonEndCall")):(t=v.SkypeIcon.CallStart,i=S.getString("SkypeUserListItem.RingButtonLabel")),e=this._renderIconButton(this._onRingAgainOrHangUpButtonPress,t,i)}return e}_renderOptionalRemoteMuteOrUnMuteIcon(){if(!this.state.hideMuteIcon&&!this.props.isRinging&&this.props.isPresent){const e=s.default.getIconTitleForMuteOrUnMute(this.props.isLocalMuteSupported,this.props.isLocal,this.props.isLocalMuted,this.props.isServerMutedSupported,this.props.isServerMuted);return this._renderIconButton(this._onMuteOrUnMuteButtonPress,e.icon,e.title,e.disableIcon)}}_renderOptionalLowerHandIcon(){if(!this.state.canHandBeLowered)return;const e=S.getString("CallControls.LowerHand");return this._renderIconButton(this._onLowerHandPressed,v.SkypeIcon.RaiseHandCrossed,e)}_renderOnHoldIcon(){return this.props.isOnHold?this._renderIconButton((()=>{}),v.SkypeIcon.Pause,S.getString("CallPanel.OnHoldHeader"),!0):void 0}_renderOptionalPinUnpinButton(){if(!this.state.isPinningFeatureAllowed)return;if(!this.state.isPinned&&!this.state.isHovering)return;const e=this.state.isPinned?S.getString("CallControls.UnpinParticipant"):S.getString("CallControls.PinParticipant"),t=this.state.isPinned?v.SkypeIcon.PinOff:v.SkypeIcon.Pin;return this._renderIconButton(this._onPinUnpinPressed,t,e)}_renderIconButton(e,t,i,n=!1){return(0,a.jsx)(h.default,{size:v.IconSize.size24,onPress:e,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:t,style:D.optionalIconButton,title:i,accessibilityLabel:this.state.displayName+","+i,disabled:n})}render(){const e=this.props.isRinging?(0,a.jsx)(n.View,Object.assign({style:D.ringingView},{children:(0,a.jsx)(p.default,{icon:v.SkypeIcon.CallAnimSmall4,color:T.Color.white,size:v.IconSize.size20})})):void 0,t=this.state.isHandRaised?(0,a.jsx)(b.default,{type:b.RaiseHandImageType.SmallSizeTopLeftAligned}):void 0;return(0,a.jsxs)(m.default.View,Object.assign({onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd,style:[D.listItem,w.default.defaultCursor],importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityLabel:this.state.displayName},{children:[(0,a.jsxs)(u.default,Object.assign({style:D.userIconContainer},{children:[(0,a.jsx)(k.UserIcon,{userMri:this.props.userMri,size:B,useCircleForAgentMask:!0,statusBorderColor:this._themeColors.primaryBackgroundColor,statusTypes:x.getAllowedStatuses(this.props.userMri),imageBorderStyleOverride:this.state.isHandRaised?D.raiseHandBorderStyle:void 0},"userIcon"),e,t]})),(0,a.jsx)(n.View,Object.assign({style:w.default.flexOne,importantForAccessibility:n.Types.ImportantForAccessibility.NoHideDescendants},{children:(0,a.jsx)(P.RowTitle,Object.assign({numberOfLines:1,textThemeColor:P.TextThemeColor.Primary},{children:this.state.displayName}))}),"text"),this._renderOptionalPinUnpinButton(),this._renderOnHoldIcon(),this._renderOptionalLowerHandIcon(),this._renderOptionalRemoteMuteOrUnMuteIcon(),this._renderRingAgainOrHangUpIcon()]}))}}t.default=E},796625:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(516778),n=i(496486),o=i(813598),s=i(502278),r=i(436237),l=i(746096),c=i(547126),d=i(640363);t.default=class{constructor(e){this._zoomLevel=o.ZoomLevelBoundaries.DefaultLevel,this._zoomPositionSizes={originalHeight:0,originalWidth:0,centerX:0,centerY:0,mouseX:0,mouseY:0,mouseCenterDistanceX:0,mouseCenterDistanceY:0},this._active=!1,this._callId="",this._isCtrlPressed=!1,this._isDragging=!1,this._dragInitCoords={x:0,y:0},this._dragFinalCoords={x:0,y:0},this._currentTopDragDifference=0,this._currentLeftDragDifference=0,this._currentTopPosition=0,this._currentLeftPosition=0,this._lastZoomTimestamp=0,this._minZoomDelay=o.ZoomDelayValues.MinDelay,this._zoomedStartTimestamp=0,this._hasDraggedOnce=!1,this._isZoomedIn=!1,this._onKeyDown=e=>(!this._isCtrlPressed&&this._isKeyCtrl(e)&&(r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController CtrlPressed ${e.keyCode}`),this._isCtrlPressed=e.keyCode),!1),this._onKeyUp=e=>this._isCtrlPressed===e.keyCode?(r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController CtrlReleased ${e.keyCode}`),this._isCtrlPressed=!1,!1):!(d.default.getPlatformType()!==l.PlatformType.OSX||e.keyCode!==c.default.MINUS&&e.keyCode!==c.default.PLUS||!e.ctrlKey)&&(this.handleKeyboardZoom(e.keyCode),!0),this.stop=()=>{this._active&&(this._active=!1,a.Input.keyDownEvent.unsubscribe(this._onKeyDown),a.Input.keyUpEvent.unsubscribe(this._onKeyUp),r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController stop"),this._resetZoom(!0),this._resetDragValues(!0),this._callId="",this._isZoomedIn=!1)},this.handleKeyboardZoom=e=>{const t=e===c.default.MINUS;r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController handleKeyboardZoom isZoomOut: ${t}`);const i=t?this._zoomLevel-1:this._zoomLevel+1;this._isZoomLevelAllowed(i)&&this._handleZoom(void 0,i,o.ScreenShareZoomType.Keyboard)},this.handleUIControlsZoom=e=>{r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController handleUIControlsZoom zoomLevel: ${e}`),this._handleZoom(void 0,e,o.ScreenShareZoomType.UIControls)},this.handleScrollZoom=e=>{if(this._isKeyCtrl(e)){const t=this._isCtrlPressed?o.ScreenShareZoomType.ScrollWheel:o.ScreenShareZoomType.TrackPad;this._handleZoom(e,void 0,t)}},this.updateScreenShareElementSizes=e=>{r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController updateScreenShareElementSizes resize"),this._setZoomPositionSizes(e)},this.handleDragging=e=>{if(this._zoomLevel){if(!this._isDragging)return void this._startDragging(e);if(e.isComplete)return void this._stopDragging();this._handleDragging(e)}},this._handleZoom=(e,t,i)=>{const a=this._getVideoElement();if(!a||this._isDragging||this._zoomLevel===t)return;r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController _handleZoom zoomLevelValue: ${t}, zoomType:${i}`);let n=t||o.ZoomLevelBoundaries.DefaultLevel;if(e&&void 0!==n){if(!this._isZoomAllowed(e.timeStamp,i===o.ScreenShareZoomType.TrackPad))return;const t=e.scrollAmount>0,a=t?-1:1;n=this._zoomLevel+a,r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController _handleZoom zoomLevel: ${n}, scrolledDown: ${t}`)}if(!this._isZoomLevelAllowed(n))return;const s=this._zoomLevel===o.ZoomLevelBoundaries.DefaultLevel;this._setZoomLevel(n,i);const c=-25*this._zoomLevel+"%";a.handleZoom(c),this._zoomLevel!==o.ZoomLevelBoundaries.DefaultLevel?this._repositionZoom(e,s,!1):this._resetZoom()},this._sendZoomChangeToTelemetry=(e,t,i,a)=>{const n=t>0&&!this._isZoomedIn,o=0===t&&this._isZoomedIn;void 0!==i&&s.default.onZoomChangeType(e,i),n?this._sendZoomInTelemetry(e,a):o&&this._sendZoomOutTelemetry(e,a)},this._sendZoomInTelemetry=(e,t)=>{this._zoomedStartTimestamp=t,this._isZoomedIn=!0,s.default.onZoomIn(e)},this._sendZoomOutTelemetry=(e,t,i)=>{const a=t-this._zoomedStartTimestamp;this._zoomedStartTimestamp=0,this._isZoomedIn=!1,s.default.onZoomOut(e,a,i)},this._sendZoomChangeToTelemetryDebounce=n.debounce(this._sendZoomChangeToTelemetry,1e3),this._resetZoom=e=>{this._zoomLevel!==o.ZoomLevelBoundaries.DefaultLevel&&this._setZoomLevel(o.ZoomLevelBoundaries.DefaultLevel),this._zoomPositionSizes.mouseCenterDistanceX=0,this._zoomPositionSizes.mouseCenterDistanceY=0,this._setPosition({x:0,y:0},void 0,e)},this._getCurrentSizes=()=>{const{originalHeight:e,originalWidth:t}=this._zoomPositionSizes,i=1+this._zoomLevel/2,a=e*i,n=t*i,o=(a-e)/2,s=(n-t)/2;return{currentHeight:a,currentWidth:n,minT:o,minL:-s,maxT:-o,maxL:s}},this._handleDragging=({clientX:e,clientY:t})=>{this._isDragging&&(this._currentTopDragDifference=t-this._dragInitCoords.y,this._currentLeftDragDifference=e-this._dragInitCoords.x,this._dragFinalCoords.y=this._currentTopPosition+this._currentTopDragDifference,this._dragFinalCoords.x=this._currentLeftPosition+this._currentLeftDragDifference,this._setPosition(this._dragFinalCoords,!0))},this._stopDragging=()=>{if(this._isDragging){this._isDragging=!1,r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController _stopDragging"),this._handleToggleZoomPositionAnimation(!0);const e=1+this._zoomLevel/2,t=this._zoomPositionSizes.mouseCenterDistanceX+this._currentLeftDragDifference/e,i=this._zoomPositionSizes.mouseCenterDistanceY+this._currentTopDragDifference/e;this._zoomPositionSizes.mouseCenterDistanceY=i,this._zoomPositionSizes.mouseCenterDistanceX=t,this._zoomPositionSizes.mouseX=this._zoomPositionSizes.centerX-this._zoomPositionSizes.mouseCenterDistanceX,this._zoomPositionSizes.mouseY=this._zoomPositionSizes.centerY-this._zoomPositionSizes.mouseCenterDistanceY,this._setPosition(this._dragFinalCoords),this._resetDragValues()}},this._onMouseCursorChange=e.onMouseCursorChange,this._onZoomLevelChange=e.onZoomLevelChange,this._getVideoElementCallback=e.getVideoElement,this._callId=e.callId,this._active=!0,a.Input.keyDownEvent.subscribe(this._onKeyDown),a.Input.keyUpEvent.subscribe(this._onKeyUp)}_isKeyCtrl(e){return e.ctrlKey||d.default.getPlatformType()===l.PlatformType.OSX&&e.metaKey}_isZoomLevelAllowed(e){return e>=o.ZoomLevelBoundaries.DefaultLevel&&e<=o.ZoomLevelBoundaries.MaxLevel}_isZoomAllowed(e,t){const i=e-this._lastZoomTimestamp;if(i<this._minZoomDelay){const e=t?o.ZoomDelayValues.TrackPadDelay:o.ZoomDelayValues.MaxDelay;return this._minZoomDelay!==e&&(this._minZoomDelay=e),r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController zoom rejected, durationSinceLastZoom: ${i}`),!1}return this._minZoomDelay!==o.ZoomDelayValues.MinDelay&&(this._minZoomDelay=o.ZoomDelayValues.MinDelay),this._lastZoomTimestamp=e,!0}_setZoomLevel(e,t){this._zoomLevel=e,this._onZoomLevelChange&&this._onZoomLevelChange(this._zoomLevel),r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController new zoom level  _zoomLevel: ${this._zoomLevel}, zoomType:${t}`);const i=Date.now();this._active?this._sendZoomChangeToTelemetryDebounce(this._callId,this._zoomLevel,t,i):this._isZoomedIn&&this._sendZoomOutTelemetry(this._callId,i,!0),this._toggleHandCursor()}_getVideoElement(){if(this._getVideoElementCallback){return this._getVideoElementCallback()}return null}_setZoomPositionSizes(e){const t=this._getVideoElement();if(!t)return;r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController _setZoomPositionSizes");const i=e||t.getZoomControllerRect();if(i){const[t,a]=[i.width,i.height];if(!t||!a)return r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController _setZoomPositionSizes width/height bug"),void this._resetZoom();const[n,o]=[t/2,a/2],s=this._zoomPositionSizes.centerX/n,c=this._zoomPositionSizes.centerY/o,d=this._zoomPositionSizes.mouseX/s,u=this._zoomPositionSizes.mouseY/c;this._zoomPositionSizes=Object.assign(Object.assign({},this._zoomPositionSizes),{originalHeight:a,originalWidth:t,centerX:n,centerY:o,mouseX:d,mouseY:u}),e&&(this._handleToggleZoomPositionAnimation(!1),this._isDragging||this._repositionZoom(void 0,!0,!0))}}_repositionZoom(e,t,i){const{centerX:a,centerY:o}=this._zoomPositionSizes;let{mouseX:s,mouseY:r}=this._zoomPositionSizes;t&&(i||([s,r]=e?[e.clientX,e.clientY]:[a,o],this._zoomPositionSizes.mouseX=s,this._zoomPositionSizes.mouseY=r),this._zoomPositionSizes.mouseCenterDistanceX=a-s,this._zoomPositionSizes.mouseCenterDistanceY=o-r);const{mouseCenterDistanceY:l,mouseCenterDistanceX:c}=this._zoomPositionSizes,d=l+this._zoomLevel/2*l,u=c+this._zoomLevel/2*c;this._setPosition({y:d,x:u}),i&&n.delay((()=>this._handleToggleZoomPositionAnimation(!0)),50)}_setPosition(e,t,i){if(i)return this._currentTopPosition=e.y,void(this._currentLeftPosition=e.x);const a=this._getVideoElement();if(a){const{minT:i,maxT:n,minL:o,maxL:s}=this._getCurrentSizes(),r=i<e.y?i:n>e.y?n:e.y,l=o<e.x?e.x>s?s:e.x:o;t||(this._currentTopPosition=r,this._currentLeftPosition=l),a.handleZoomPositionUpdate(l+"px",r+"px")}}_startDragging({clientX:e,clientY:t}){this._isDragging=!0,r.log(l.LogTraceArea.ScreenSharing,"ScreenShareZoomController _startDragging"),this._hasDraggedOnce||(s.default.onZoomDragUsed(this._callId),this._hasDraggedOnce=!0),this._dragInitCoords={x:e,y:t},this._toggleHandCursor(!0),this._handleToggleZoomPositionAnimation(!1)}_resetDragValues(e){this._isDragging=!1,this._hasDraggedOnce=!1,this._dragInitCoords={x:0,y:0},this._dragFinalCoords={x:0,y:0},this._currentTopDragDifference=0,this._currentLeftDragDifference=0,e||this._toggleHandCursor()}_toggleHandCursor(e){if(!this._onMouseCursorChange)return;let t=a.Types.GestureMouseCursor.Default;this._zoomLevel>o.ZoomLevelBoundaries.DefaultLevel&&(t=e?a.Types.GestureMouseCursor.Grabbing:a.Types.GestureMouseCursor.Grab),this._onMouseCursorChange(t),r.log(l.LogTraceArea.ScreenSharing,`ScreenShareZoomController apply cursor: ${t}`)}_handleToggleZoomPositionAnimation(e){const t=this._getVideoElement();t&&t.togglePositionChangeAnimation(e)}}},840565:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageDropTarget=t.CallStageDropTargetType=t.CallStageDropTargetAnimationStyle=void 0;const a=i(785893),n=i(496486),o=i(967593),s=i(516778),r=i(217041),l=i(781770),c=i(812854),d=i(110117),u=i(861253),h=i(915877),p=i(89808),g=i(681115),C=i(581760),S=i(711828),m=i(680837),y=(0,h.lazyProperties)({container:()=>s.Styles.createViewStyle({position:"absolute",justifyContent:"center",alignItems:"center"}),gradientContainer:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,opacity:.65}),gradientBorder:()=>s.Styles.createViewStyle({borderColor:C.Color.white,opacity:.2,borderWidth:10,top:0,left:0,borderStyle:"solid"}),gradientDashedBorder:()=>s.Styles.createViewStyle({borderColor:C.Color.white,opacity:.5,borderWidth:1,top:0,left:0,borderStyle:"dashed",borderRadius:10}),iconContainer:()=>s.Styles.createViewStyle({width:72,height:72,justifyContent:"center",alignItems:"center",overflow:"hidden"})});var f;!function(e){e[e.None=0]="None",e[e.SlideIn=1]="SlideIn",e[e.FadeIn=2]="FadeIn"}(t.CallStageDropTargetAnimationStyle||(t.CallStageDropTargetAnimationStyle={})),function(e){e[e.Foreground=0]="Foreground",e[e.Background=1]="Background"}(f=t.CallStageDropTargetType||(t.CallStageDropTargetType={}));class b extends r.ComponentBase{constructor(){super(...arguments),this._animatedTopValue=new s.Animated.Value(0),this._animatedHeightValue=new s.Animated.Value(0),this._animatedLeftValue=new s.Animated.Value(0),this._animatedWidthValue=new s.Animated.Value(0),this._animatedOpacityValue=new s.Animated.Value(0),this._animatedStyles=s.Styles.createAnimatedViewStyle({top:this._animatedTopValue,left:this._animatedLeftValue,height:this._animatedHeightValue,width:this._animatedWidthValue,opacity:this._animatedOpacityValue}),this._animatedScaleValue=new s.Animated.Value(1),this._animatedScaleStyle=s.Styles.createAnimatedViewStyle({transform:[{scale:this._animatedScaleValue}]})}_buildState(e,t){return{config:l.default.getCurrentDraggingParticipantConfig(),gradientColors:p.default.getGradientColors()}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),!this.state.config)return this._animatedScaleValue.setValue(1),void(t.config&&c.default.unprepareFeedback());if(this.state.config&&!t.config){const e=this.state.config.dropTargetViewRect;this._animatedHeightValue.setValue(e.height),this._animatedWidthValue.setValue(e.width),this._animatedLeftValue.setValue(e.x),this._animatedTopValue.setValue(e.y-e.height),this._animatedOpacityValue.setValue(0)}n.isUndefined(this.state.config.showDropTarget)||(this._showOrHide(),c.default.prepareFeedback()),b._selectDropTarget(this.state.config)&&!b._selectDropTarget(t.config)&&c.default.triggerFeedback();const a=!!t.config&&t.config.selectDropTarget,o=!!this.state.config&&this.state.config.selectDropTarget;if(a!==o&&this.props.type!==f.Background){const e=[];e.push(s.Animated.timing(this._animatedScaleValue,{toValue:o?1.2:1,duration:300,easing:s.Animated.Easing.OutBack()})),s.Animated.parallel(e).start()}const r=this.state.config?this.state.config.dropTargetViewRect:void 0,l=t.config?t.config.dropTargetViewRect:void 0;!(0,u.default)(l,r)&&r&&(this._animatedTopValue.setValue(r.y),this._animatedLeftValue.setValue(r.x),this._animatedHeightValue.setValue(r.height),this._animatedWidthValue.setValue(r.width))}_showOrHide(e){if(!this.state.config)return;const t=this.state.config.showDropTarget,i=t?this.state.config.dropTargetViewRect.y:this.state.config.dropTargetViewRect.y-this.state.config.dropTargetViewRect.height,a=t?1:0;this._animatedOpacityValue.setValue(a),this._animatedTopValue.setValue(i)}_containerStyles(){return[y.container,this._animatedStyles]}render(){if(!this.state.config)return null;const e=[this.props.style];let t;e.push(this._containerStyles()),this.props.type===f.Background||this.state.config.isVideoPreviewAndFloatingOnTop||(t=(0,a.jsx)(s.Animated.View,Object.assign({style:[y.iconContainer,this._animatedScaleStyle]},{children:(0,a.jsx)(d.default,{icon:this.state.config.selectDropTarget||this.state.config.confirmOnly?S.SkypeIcon.Ok:S.SkypeIcon.Plus,size:S.IconSize.size32,color:C.Color.white})})),this.state.config.topPadding&&e.push(g.default.paddingTopStyle(this.state.config.topPadding)));const i=this.state.config.isVideoPreviewAndFloatingOnTop?y.gradientDashedBorder:y.gradientBorder,n=this.props.type===f.Foreground&&this.state.config.selectDropTarget?(0,a.jsx)(s.View,{style:[y.gradientContainer,i]}):void 0,r=this.props.type!==f.Background||this.state.config.isVideoPreviewAndFloatingOnTop?void 0:(0,a.jsx)(s.View,Object.assign({style:y.gradientContainer},{children:(0,a.jsx)(o.GradientView,{style:m.default.flexOne,colors:this.state.gradientColors,direction:o.GradientDirection.BOTTOM_RIGHT})}));return(0,a.jsxs)(s.Animated.View,Object.assign({style:e,blockPointerEvents:!0,ignorePointerEvents:!0},{children:[r,t,n]}))}static _selectDropTarget(e){return!!e&&e.selectDropTarget}}t.CallStageDropTarget=b,t.default=b},475377:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageLayoutController=void 0;const a=i(496486),n=i(889391),o=i(981783),s=i(480200),r=i(480200),l=i(471727),c=i(861253),d=i(330124);i(360305);class u{constructor(e){this._isCallStageV2=e,this._controllers={},this._verticalOffset=r.RibbonSizes.defaultRibbonItemTopMargin,this._baseRightInset=r.RibbonSizes.ribbonItemMargin,this._ribbonScrollRightInset=0,this._ribbonContentWidth=0,this._ribbonExpandedMultiplier=1,this._participantDragState=r.ParticipantDragState.Unspecified,this._maxStageElements=4,this._maxElementsInRow=2,this._maxElementsInColumn=2,this._totalStageElements=0,this._videosDimensionsList=[],this._isStageLandscape=!0,this._isGridSquare=!1,this._narrowOrWide=!1}updateLayoutInfoForStage(e,t){const i=(0,c.default)(this._stageRect,t);this._updateStageElements(t.width,t.height,e.length),this._updateStageLayout(e,t,i),this._stageRect=t}updateLayoutInfo(e,t,i,n,o,l,d,u,h,p=!0,g=!1,C=0,S=!1,m=0){const y=a.filter(e,(e=>!!e.displayOnStage)),f=p&&(0,c.default)(this._stageRect,t);if(this._updateStageElements(t.width,t.height,y.length),this._updateStageLayout(y,t,f),this._stageRect=t,S)return 0;let b=C,_=C,T=C,v=-1;const w=a.filter(e,(e=>!e.displayOnStage&&!e.isHiddenBot)),I=w?w.length:0,P=m||i;let M=l-i*h-P,k=0;a.each(w,((e,t)=>{e.isLocal&&e.videoType!==s.LayoutInfoVideoType.None&&(M-=n);const a=e.ribbonPosition,l=a>v;let c=e.isLocal&&e.videoType!==s.LayoutInfoVideoType.None?n:i;const d=this.controllerForKey(e.key).getResizeFactor();d>1&&(c*=d);const u=e.key===r.CallStageElementKeys.ribbonModeViewKey?r.RibbonSizes.ribbonModeElementSize:c,h=c,p=this._positionElementInRibbon(e.key,e.videoType,e.videoAspectRatio,l?b:_,this._stageRect,{height:h,width:u},f,g);l&&(_=b,b=Math.max(b,p.x+p.width+r.RibbonSizes.ribbonItemInnerMargin),v=a,e.key===r.CallStageElementKeys.localUserKey&&(C=b));const S=this.controllerForKey(e.key);!o&&b>=M&&(k||t<I-1)||e.hidden?(S.setHidden(!0),k++):(S.setHidden(!1),T=b)}));const A=this.controllerForKey(r.CallStageElementKeys.remainderViewKey);if(k){const e=this._positionElementInRibbon(r.CallStageElementKeys.remainderViewKey,void 0,void 0,T,this._stageRect,{height:i,width:i},f);T+=e.width+r.RibbonSizes.ribbonItemInnerMargin,A.setHidden(!1)}else A.setHidden(!0);if(u!==r.RibbonExtraVisibility.None){const e=this.controllerForKey(r.CallStageElementKeys.addToCallViewKey),t=this._positionElementInRibbon(r.CallStageElementKeys.addToCallViewKey,void 0,void 0,T,this._stageRect,{height:i,width:i},f);T+=t.width+r.RibbonSizes.ribbonItemInnerMargin,e.setHidden(u===r.RibbonExtraVisibility.Hidden)}const R=this.controllerForKey(r.CallStageElementKeys.ribbonModeViewKey),x=this._positionElementInRibbon(r.CallStageElementKeys.ribbonModeViewKey,void 0,void 0,T,this._stageRect,{height:i,width:P},f);return T+=x.width+r.RibbonSizes.ribbonItemInnerMargin,R.setHidden(d===r.RibbonExtraVisibility.Hidden),this._ribbonContentWidth=T,this._updateRibbonScrollInset(this._ribbonScrollRightInset,t,f),k}updateRibbonExpandedMultiplier(e,t,i=!1){this._ribbonExpandedMultiplier!==e&&(a.each(this._controllers,(a=>a.updateRibbonExpandedMultiplier(e,t,i))),this._ribbonExpandedMultiplier=e)}updateRibbonVerticalOffset(e,t=!1,i=r.CallStageConfig.animationDuration){this._verticalOffset!==e&&(a.each(this._controllers,(a=>a.updateRibbonVerticalOffset(e,this._stageRect,t,i))),this._verticalOffset=e)}ribbonWidth(){return this._ribbonContentWidth+this._baseRightInset}setCallHeaderPanelLayout(e){this._callPanelHeaderLayout=e,a.each(this._controllers,(t=>t.setCallHeaderPanelLayout(e)))}controllerForKey(e){let t=this._controllers[e];return t||(t=new o.CallItemLayoutController(e,this._verticalOffset,this._totalRibbonRightInset(),this._ribbonExpandedMultiplier,this._isCallStageV2),t.setCallHeaderPanelLayout(this._callPanelHeaderLayout),this._controllers[e]=t),t}setParticipantDragState(e){this._participantDragState=e}resetParticipantDragState(){this._onGestureComplete()}getParticipantDragState(){return this._participantDragState}onPan(e,t,i,a,n,o){if(!e)return this._panRibbon(i,a),!1;const s=this.controllerForKey(e);if(this._participantDragState!==r.ParticipantDragState.Move){if(s.isCompact()&&this._panRibbon(i,a))return!1;t&&(this._participantDragState=r.ParticipantDragState.Move)}this._participantDragState===r.ParticipantDragState.Move&&s.onPan(i,a,n);const l=this._participantDragState===r.ParticipantDragState.Move;return i.isComplete&&this._onGestureComplete(),l}getMaxNumberOfStageElements(){return this._maxStageElements}isStageLandscape(){return this._isStageLandscape}isGridSquare(){return this._isGridSquare}shouldSwitchOrientation(){return this.isStageLandscape()&&!this._narrowOrWide&&!this.isGridSquare()||!this.isStageLandscape()&&(this._narrowOrWide||this.isGridSquare())}_updateStageElements(e,t,i){if(0===e||0===t)return;const a=e/t,o=n.default.getS4LCMCFeaturesNoSubscription().modernCallStage,s=d.default.isUsingStackNavigationContextNoSubscription(),r=s?o.mobileMinVideoSize.width:o.minVideoSize.width,c=s?o.mobileMinVideoSize.height:o.minVideoSize.height;if(0===r||0===c)return;let u,h;if(u=Math.round(e/r),h=Math.round(t/c),this._maxElementsInColumn!==h||this._maxElementsInRow!==u||this._totalStageElements!==i){this._maxElementsInRow=u,this._maxElementsInColumn=h;const e=this._maxElementsInRow*this._maxElementsInColumn;this._maxStageElements=Math.min(o.maxStageElements,e);const t=l.default.getStageVideoCount(i,this._maxElementsInRow,this._maxElementsInColumn,a>1);this._totalStageElements=i,this._isGridSquare=t.width===t.height,this._isStageLandscape=a>1,this._narrowOrWide=!this._isGridSquare&&(a>2||a<1),this._videosDimensionsList=l.default.getSizesForStageElements([],i,t,this._isGridSquare?!this._isStageLandscape:this._isStageLandscape,t,this._narrowOrWide)}}_panRibbon(e,t){const i=this._shouldScrollRibbon(t)?20:0;if(this._participantDragState===r.ParticipantDragState.Pan||Math.abs(e.pageY-e.initialPageY)<i){if(!a.isUndefined(this._lastPageX)){const i=this._lastPageX-e.pageX;this._updateRibbonScrollInset(this._ribbonScrollRightInset+i,t),this._participantDragState===r.ParticipantDragState.Unspecified&&Math.abs(e.pageX-e.initialPageX)>20&&(this._participantDragState=r.ParticipantDragState.Pan)}return this._lastPageX=e.pageX,e.isComplete&&this._onGestureComplete(),!0}return!1}_onGestureComplete(){this._participantDragState=r.ParticipantDragState.Unspecified,this._lastPageX=void 0}_shouldScrollRibbon(e){return this._ribbonContentWidth+this._baseRightInset>e.width}_updateRibbonScrollInset(e,t,i=!1,n=r.CallStageConfig.animationDuration){let o=Math.min(e,0);const s=this._shouldScrollRibbon(t)?t.width-(this._ribbonContentWidth+this._baseRightInset):0;o=Math.max(o,s),this._ribbonScrollRightInset!==o&&(this._ribbonScrollRightInset=o,a.each(this._controllers,(e=>e.updateRibbonRightInset(this._totalRibbonRightInset(),t,i,n))))}_totalRibbonRightInset(){return this._baseRightInset+this._ribbonScrollRightInset}_positionElementInRibbon(e,t,i,a,n,o,r=!1,c=!1){const d=this.controllerForKey(e),u=l.default.ribbonLayoutRect(t,i,a,o,c);return d.setRibbonPosition(u,!!t&&t!==s.LayoutInfoVideoType.None,n,o.width,r),u}_updateStageLayout(e,t,i=!1){a.each(e,(a=>{var n;const o=a.stagePosition,r=this.controllerForKey(a.key),c=this._videosDimensionsList[o],d=l.default.stageLayoutRect(t,c);a.isTopRow=l.default.isTopStageElement(e,this._currentElementKeyPositions,this._videosDimensionsList,o),r.setIsTopRowElement(null!==(n=a.isTopRow)&&void 0!==n&&n),r.setStagePosition(this._maxStageElements,d,o,a.videoType!==s.LayoutInfoVideoType.None,t,i,c),r.setHidden(!1)}))}setElementsPositions(e){const t={};for(let i=0;i<e.length;i++){const a=e[i];t[i]=a}this._currentElementKeyPositions=t}}t.CallStageLayoutController=u,t.default=u},647112:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageView=void 0;const a=i(785893),n=i(174958),o=i(496486),s=i(967593),r=i(516778),l=i(148540),c=i(889391),d=i(220187),u=(i(178816),i(781770)),h=i(994224),p=i(568580),g=i(30098),C=i(537103),S=i(660289),m=i(840565),y=i(475377),f=i(136850),b=i(502278),_=i(480200),T=i(471727),v=i(346565),w=i(886251),I=i(671830),P=i(911009),M=i(952262),k=i(746096),A=i(805581),R=i(3573),x=i(436237),L=i(861253),V=i(648638),O=i(172490),B=i(838817),D=i(915877),E=i(647662),N=i(733754),F=i(706250),j=i(18078),U=i(498053),H=i(885376),z=i(402952),G=i(677557),W=i(451070),K=i(536150),$=i(886045),q=i(262232),Q=i(581760),X=i(680837),Z=i(24576),J=i(912770),Y=i(567977),ee=i(172758),te=i(853374),ie=(0,D.lazyProperties)({backdropContainer:()=>r.Styles.createViewStyle({position:"absolute",top:0,right:0}),ribbonBackdrop:()=>r.Styles.createViewStyle({flex:1,backgroundColor:Q.Color.transparent}),reactionsView:()=>X.default.absoluteFill,overlayTopContainer:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0}),overlayBottomContainer:()=>r.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:0}),overlayContainer:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,alignItems:"stretch",overflow:"visible",backgroundColor:Q.Color.blackOverlay20}),mobileOverlayShim:()=>r.Styles.createViewStyle({backgroundColor:Q.Color.blackOverlay50}),stageContainerStyle:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:Q.Color.transparent,flex:1,flexDirection:"column",flexWrap:"wrap",justifyContent:"center",alignSelf:"center"}),windowTopOffsetStageContainerStyle:()=>r.Styles.createViewStyle({top:_.CallPanelHeaderHeight.window}),zeroTopOffsetStageContainerStyle:()=>r.Styles.createViewStyle({top:0}),modernStageLandscapeContainerStyle:()=>r.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap"})});class ae extends Z.default{constructor(){super(...arguments),this._layoutController=new y.default(!1),this._mountedRefsMap=new F.default,this._latestVisibleRibbonCallItemKeys=[],this._localUserParticipantInfo={key:_.CallStageElementKeys.localUserKey,mri:j.default.getSkypeMri(),ribbonAddTime:0,connectionSortKey:0,isStreamAvailable:!1,streamsStatus:_.CallParticipantStreamsStatus.None},this._ribbonAnimatedWidthValue=new r.Animated.Value(0),this._ribbonAnimatedWidthStyle=r.Styles.createAnimatedViewStyle({width:this._ribbonAnimatedWidthValue}),this._stageReactionsAnimatedOpacityValue=new r.Animated.Value(1),this._stageReactionsAnimatedStyle=r.Styles.createAnimatedViewStyle({opacity:this._stageReactionsAnimatedOpacityValue}),this._suppressElementAnimation=!1,this._isVideoPreviewFloatingOnTop=!1,this._ribbonRightSideOffSetForVideoPreview=0,this._callReactionsDisplayHelper=new S.default,this._getRenderTargetViaKey=(e,t)=>{var i;const a=this._mountedRefsMap.ref(e);return a?null===(i=a.getVideoElement(t))||void 0===i?void 0:i.getVideoContainer():void 0},this._maybeUpdateRibbonVisibleElements=()=>{if(this.isComponentMounted()){const e=h.default.CallingStore.getRankedSpeakerMris(this.props.callId);if(this._latestVisibleRibbonCallItemKeys.length>0&&T.CallUIUtils.shouldReRenderVisibleRibbonItems(e,this._latestVisibleRibbonCallItemKeys,T.CallUIUtils.shouldRenderStage(this.state)?this.state.stageElements:[])){const e=te.default.newCauseId();x.log(k.LogTraceArea.CallingUI,"CallStageView._maybeUpdateRibbonVisibleElements updating causeId: "+e),this._updateElementLayout(!1,this.state,this.props,e)}h.default.CallingStore.updateRankedVideoStreams(this.props.callId)}},this._resizeVideoPreviewFromKeyboard=(e,t)=>{const i=this._layoutControllerForLocalUser(),a=T.CallUIUtils.renderVideoPreview(this.state,this.props),n=this._ribbonItemHeight(this.state,!0,!0,!1);if(i&&i.getUIPosition&&this.props.enableFloatableResizableVideoPreview&&a&&i.getUIPosition()===_.CallingViewUIPostion.Ribbon){const e=Math.min(this.props.availableRibbonWidth-3*n,this.props.viewRect.width/2);if(i.viewRect&&i.setResizeFactor&&i.getResizeFactor){const t=i.viewRect(!0),a=e/n*t.height/t.width,o=T.CallUIUtils.getNextScaleFactor(i.getResizeFactor(),a,2);return i.setResizeFactor(o),this._updateElementLayout(!1,this.state,this.props,"_resizeVideoPreviewFromKeyBoard"),!0}}return!1},this._getCurrentCallPanelHeaderLayout=e=>e?e.callPanelHeaderLayout:this.props.callPanelHeaderLayout,this._shouldShowRibbonModeSelector=(e,t)=>{const i=t?t.showRibbonExtras:this.props.showRibbonExtras;return!(t?t.useMobileControls:this.props.useMobileControls)&&i},this._onStageElementTap=(e,t)=>{if(this._suppressElementAnimation)return void x.log(k.LogTraceArea.CallingUI,"CallStageView._onStageElementTap ignored, layout animations suppressed");const i=this.state.useImmersiveMode&&this.state.enableImmersiveMode;this.props.onStageTap?(this.props.onStageTap(t),i&&J.default.setTimeout((()=>{this.isComponentMounted()&&this.state.useImmersiveMode&&this._onToggleImmersiveMode()}),750)):i&&this._onToggleImmersiveMode()},this._onRibbonElementTap=e=>{if(this._suppressElementAnimation)return x.log(k.LogTraceArea.CallingUI,"CallStageView._onRibbonElementTap ignored, layout animations suppressed"),!1;const t=te.default.newCauseId();return x.log(k.LogTraceArea.CallingUI,"CallStageView._onRibbonElementTap causeId: "+t),!o.includes(this.state.stageElements,e)&&(f.default.setStageMode(this.props.callId,_.StageMode.Manual,t),this._moveCallElement(e,!0,this.state.stageElements.length),!0)},this._onScreenshareTap=e=>{if(this._suppressElementAnimation)return x.log(k.LogTraceArea.CallingUI,"CallStageView._onScreenshareTap ignored, layout animations suppressed"),!1;const t=te.default.newCauseId();return x.log(k.LogTraceArea.CallingUI,"CallStageView._onScreenshareTap causeId: "+t),!o.includes(this.state.stageElements,e)&&(this._changeCallLayoutCommand.execute(_.StageMode.FocusedScreenShare),!0)},this._onRemainderViewRef=e=>{this._remainderView=e||void 0},this._onRemainderViewPressed=()=>{const e=te.default.newCauseId();x.log(k.LogTraceArea.CallingUI,"CallStageView._onRemainderViewPressed causeId: "+e),this._suppressElementAnimation?x.log(k.LogTraceArea.CallingUI,"CallStageView._onRemainderViewPressed ignored, layout animations suppressed"):this.props.onRemainderViewPressed&&this.props.onRemainderViewPressed(e)},this._onAddToCallViewPressed=()=>{const e=te.default.newCauseId();x.log(k.LogTraceArea.CallingUI,"CallStageView._onAddToCallViewPressed causeId: "+e),this._suppressElementAnimation?x.log(k.LogTraceArea.CallingUI,"CallStageView._onAddToCallViewPressed ignored, layout animations suppressed"):this.props.onAddToCallPressed&&this.props.onAddToCallPressed(e,k.NavigationAddToCallOrigin.Ribbon)},this._onElementMouseOverOrOut=(e,t,i)=>{if(t&&i){if(!e)return void x.warn(k.LogTraceArea.Calling,"CallStageView._onElementMouseOverOrOut:key is empty");u.default.setHoveringParticipantConfig({key:e,source:_.HoveringParticipantSource.Participant})}else u.default.clearHoveringParticipantConfig(_.HoveringParticipantSource.Participant)},this._onDoubleTap=e=>{this.state.enableImmersiveMode?this._onToggleImmersiveMode():this.state.enableTapToMoveCallParticipant&&this._onToggleParticipantFocus(e)},this._onElementPressInOrOut=(e,t,i)=>{this.state.enableImmersiveMode||this._onPresentDropTargets(e,t,i)},this._onPresentDropTargets=(e,t,i)=>{if(i)if(t){const t=this._stageDropTarget(),i={key:e,dropTargetViewRect:t.rect,showDropTarget:!0,toStage:!0,targetStagePosition:t.targetPosition,confirmOnly:t.confirmOnly};u.default.setDraggingParticipantConfig(i)}else{const t=this.props.topInset||0,i={key:e,dropTargetViewRect:this._ribbonDropTarget(t),showDropTarget:!0,toStage:!1,topPadding:t};u.default.setDraggingParticipantConfig(i)}else this._layoutController.getParticipantDragState()!==_.ParticipantDragState.Move&&u.default.setDraggingParticipantConfig(void 0)},this._onToggleImmersiveMode=()=>{const e=!this.state.useImmersiveMode;this.setState({useImmersiveMode:e})},this._onToggleParticipantFocus=e=>{if(this._suppressElementAnimation)return void x.log(k.LogTraceArea.CallingUI,"CallStageView._onParticipantDoubleTap ignored");const t=te.default.newCauseId();x.log(k.LogTraceArea.CallingUI,"CallStageView._onToggleParticipantFocus causeId: "+t),this.state.focusedParticipant||h.default.OngoingCallService.setPreFocusStageParticipants(this.props.callId,o.clone(this.state.stageElements));const i=this.state.focusedParticipant!==e?e:void 0;let a;a=i?[i]:this.props.stageLayoutMode===_.StageMode.Manual?this._cleanseStageElements(h.default.OngoingCallService.getPreFocusStageParticipants(this.props.callId),this.state,t):this._getStageElementsForOnToggleParticipantUnfocus(),a&&!o.isEmpty(a)||(x.log(k.LogTraceArea.CallingUI,"CallStageView._onParticipantDoubleTap: No stageElements, falling back"),a=T.CallUIUtils.fallbackStageElements(this.state.renderedRemoteElementInfo,this.state.isProvidingVideo,this.props.baseStageMode)),this.setState({focusedParticipant:i,stageElements:a})},this._onRibbonBackdropPan=e=>{this._layoutController.onPan(void 0,!1,e,this.props.viewRect)},this._onStageElementPan=(e,t,i)=>{const a=this.state.stageElements.length>1;this._intOnElementPan(e,a,t,i)},this._onElementPan=(e,t,i)=>{o.includes([_.StageMode.Speaker,_.StageMode.TogetherMode,_.StageMode.LargeGrid],this.props.stageLayoutMode)&&e!==_.CallStageElementKeys.localUserKey||this._intOnElementPan(e,!0,t,i)},this._onElementResize=e=>{x.log(k.LogTraceArea.CallingUI,`CallStageView._onElementResize key ${e} `),this._updateElementLayout(!1,this.state,this.props,"onElementReSize")},this._intOnElementPan=(e,t,i,a)=>{if(i.isComplete&&!this.state.draggingElementKey)return;const n=this._draggingElementConfig(e,i,a),o=n.config,s=T.CallUIUtils.translateRect(a,this.props.viewRect.width),r={x:this.props.viewRect.x+(this.props.containerOffsetX||0),y:this.props.viewRect.y,width:this.props.viewRect.width,height:this.props.viewRect.height};let l=this._layoutController.onPan(e,t,i,r,s,this.state.useImmersiveMode);if(this.state.draggingElementKey===e&&(l=!0,this._layoutController.setParticipantDragState(_.ParticipantDragState.Move)),l)if(i.isComplete){const t=te.default.newCauseId();x.log(k.LogTraceArea.CallingUI,"CallStageView._intOnElementPan, causeId:"+t),e===_.CallStageElementKeys.localUserKey&&b.default.updateCallTelemetry(this.props.callId,t,(e=>e.moveOwnPreview())),0!==this._ribbonRightSideOffSetForVideoPreview&&(this._ribbonRightSideOffSetForVideoPreview=0,this._updateElementLayout(!1,this.state,this.props,"_draggingElementConfig")),o.selectDropTarget?(o.showDropTarget&&e===_.CallStageElementKeys.localUserKey&&b.default.updateCallTelemetry(this.props.callId,t,(e=>e.dockOwnPreview())),this._moveCallElement(e,!!o.toStage,o.targetStagePosition)):u.default.setDraggingParticipantConfig(void 0),this._layoutController.resetParticipantDragState()}else this._topElement=e,n.changed&&u.default.setDraggingParticipantConfig(o)},this._layoutControllerForKey=e=>this._layoutController.controllerForKey(e),this._layoutControllerForLocalUser=()=>this._layoutControllerForKey(_.CallStageElementKeys.localUserKey),this._onInlineCallStageReactionsViewRef=e=>{this._callReactionsView=e||void 0},this._getCallReactionsDisplayHelper=()=>this._callReactionsDisplayHelper,this._onTextReactionPressed=()=>{if(this.props.onTextReactionPressed){const e=te.default.newCauseId();x.log(k.LogTraceArea.CallingUI,"CallStageView._onTextReactionPressed, causeId: "+e),this.props.onTextReactionPressed(e)}},this._onCallParticipantNametagMouseEnter=(e,t)=>{u.default.setHoveringParticipantConfig({key:t,source:_.HoveringParticipantSource.Nametag})},this._onCallParticipantNametagMouseLeave=(e,t)=>{u.default.clearHoveringParticipantConfig(_.HoveringParticipantSource.Nametag)},this._onRibbonElementTapBinder=(e,t)=>this._onRibbonElementTap(e),this._onStageTapBinder=(e,t)=>this.props.onStageTap(t),this._getAnchorInfo=e=>{const t=j.default.isMyMri(e)?_.CallStageElementKeys.localUserKey:e;if(t!==_.CallStageElementKeys.localUserKey&&!o.has(this.state.allCallElements,t))return;const i=this._layoutControllerForKey(t);if(i){if(i.isHidden())return;if(i.viewRect)return this._anchorInfoForRect(i.viewRect(),i.isHidden())}},this._getAnchorInfoChanges=(e,t)=>{if(e!==_.CallStageElementKeys.localUserKey&&!o.has(this.state.allCallElements,e))return;const i=this._layoutControllerForKey(e);if(i&&i.onRectChanged){const e=e=>{t(this._anchorInfoForRect(e,i.isHidden()))};return i.onRectChanged(e)}},this._onElementStartDragging=e=>{this._callReactionsView&&this._callReactionsView.dismissReaction&&this._callReactionsView.dismissReaction(e)}}_buildState(e,t){t&&this._updateRibbonVerticalOffset(e.topInset||0,!1,e.stageLayoutMode);const i={},a=[_.CallStageElementKeys.localUserKey],n={},s=[],r=[],g=[],C=this.state?this.state.renderedRemoteElementInfo:{},S={};let m,y,b=!1,w=0;const P=e.stageLayoutMode,M=c.default.getS4LCMCFeatures(),k=T.CallUIUtils.isTogetherMode(P)||T.CallUIUtils.isLargeGrid(P),R=k?A.default.getNonVisibleInCallBotMris():A.default.getNonInteractiveInCallBotMris(),x=A.default.getCallAudienceBotMriFilter(),L=A.default.getCallGridViewBotMriFilter(),O=I.isThread(e.conversationMri);let B,D;if(i[_.CallStageElementKeys.localUserKey]={mri:j.default.getSkypeMri(),participantState:l.ParticipantState.Connected},o.each(h.default.CallingStore.getRemoteCallMembers(e.callId),(t=>{const l=h.default.CallingStore.getRemoteCallMemberMri(e.callId,t);if(k&&(T.CallUIUtils.isTogetherMode(P)&&o.includes(x,l)||T.CallUIUtils.isLargeGrid(P)&&o.includes(L,l))&&(B=l),T.CallUIUtils.shouldRenderParticipant(t,l,R)){w++;const i=T.CallUIUtils.elementInfoForParticipantOrScreenshare(l,l,e.callId,t,C[l],O,void 0);S[l]=i,a.push(l),n[l]=p.default.isParticipantTalking(t);const c=i.isStreamAvailable;b=b||!i.isScreensharing&&c||M.keepScreenShareWhenDisableVideo&&!!i.isScreensharing&&c,c&&s.push(l);const d=S[l].participantState;!o.isUndefined(d)&&p.default.isParticipantStateConnected(d)&&r.push(l)}p.default.isParticipantRinging(t)&&g.push(l),i[l]={mri:l,participantState:t.state}})),h.default.CallScreenShareStore.isActive(e.callId)){const t=h.default.CallScreenShareStore.getRemoteScreenShareParticipant(e.callId);if(t){const n=h.default.CallingStore.getRemoteCallMemberMri(e.callId,t);D=n,y="ss_"+n;const o=T.CallUIUtils.elementInfoForParticipantOrScreenshare(y,n,e.callId,t,C[y],!1,n);S[y]=o,a.push(y),i[y]={mri:n,participantState:t.state,isScreenShare:!0},m=o}else D=j.default.getSkypeMri()}const E={allCallElements:i,screenshareElementInfo:m,ringingParticipants:g,remoteCallMemberCount:w,renderedRemoteElementInfo:S,enableNewIncomingVideoSound:M.enableNewIncomingVideoSound,isOneOnOneConversation:I.isOneOnOneConversation(e.conversationMri),mobilePreviewPercentage:M.mobilePreviewPercentage,bottomSafeAreaInset:W.default.bottomSafeAreaInset(10),anyVideoOrScreensharing:!!m||b,enableImmersiveMode:e.useMobileControls,isProvidingVideo:h.default.CallingStore.isProvidingVideo(e.callId),isMuted:T.CallUIUtils.isLocalOrServerMuted(e.callId),isHandRaised:h.default.CallingStore.isHandRaisedForCurrentUserMri(e.callId),isCallCreator:h.default.CallingStore.isCallCreator(e.callId),callCreator:h.default.CallingStore.getCallCreator(e.callId),draggingElementKey:u.default.getCurrentDraggingParticipantKey(),enableLayoutAnimation:T.CallUIUtils.enableLayoutAnimation(),enableAddToCallRibbonItem:!e.useMobileControls&&h.default.CallingFeaturesHelper.allowAddToCall(e),enableAddToCallCoachmark:!e.useMobileControls&&M.enableAddToCallRibbonCoachMark,isFullscreenBotCall:k,showChangeTogetherModeBackgroundOption:U.ChangeTogetherModeBackgroundCommand.canExecute(e.callId,e.conversationMri),enableTapToMoveCallParticipant:M.enableTapToMoveCallParticipant,enableTapToFlipCamera:!M.enableTapToMoveCallParticipant&&e.useMobileControls&&!K.default.isMobileScreenReaderEnabled(),localVideoDimension:h.default.CallingStore.getLocalVideoStreamSize(e.callId),isCallVisible:v.default.isCallVisible(e.callId),isNavigatingWithKeyboard:V.default.isNavigatingWithKeyboard(),connectedParticipants:r,disableVideosInRibbon:M.disableVideosInRibbon,nonInteractiveInCallBotMris:A.default.getNonInteractiveInCallBotMris(),screensharingUserMri:D,enableNewLayoutPicker:M.enableNewLayoutPicker,onlyVideoParticipantsOnStage:f.default.getOnlyVideoOnTheStage(e.callId),localMediaStreams:T.CallUIUtils.getLocalMediaStreams(e.callId,l.StreamType.Video)},N={isPSTNCall:h.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:I.isEncryptedThread(e.conversationMri),conversationMri:e.conversationMri,callId:e.callId};if(this._changeCallLayoutCommand=new d.ChangeCallLayoutCommand(N,e.isIncomingOrOutgoingRing,P),t)E.useImmersiveMode=!1,E.ribbonHidden=!1,P===_.StageMode.Manual?E.stageElements=h.default.OngoingCallService.getStageParticipants(e.callId):E.stageElements=y?[y]:B?[B]:[],E.focusedParticipant=h.default.OngoingCallService.getFocusedParticipant(e.callId);else{let t;this._isVideoPreviewFloatingOnTop=e.enableFloatableResizableVideoPreview&&this._isVideoPreviewFloatingOnTop&&this.state.isProvidingVideo;const i=y&&!!this.state&&!T.CallUIUtils.screenShareKey(this.state);let n=i?void 0:this.state.focusedParticipant;const l=E.onlyVideoParticipantsOnStage?s:r;if(o.isEmpty(r)||h.default.OngoingCallService.getHasConnectedParticipantsEdge(e.callId)){const s=T.CallUIUtils.isInIncomingScreenshareMode(P)||i;if(n)o.includes(a,n)?t=this.state.stageElements:(n=void 0,t=P===_.StageMode.Manual?h.default.OngoingCallService.getPreFocusStageParticipants(e.callId):l);else if(s&&y)t=[y];else if(P===_.StageMode.Speaker){const i=this.state.stageElements[0],a=h.default.CallingStore.getTopSpeakerMri(e.callId);t=o.compact([a||i])}else if(k&&B)t=[B];else if(t=[],P===_.StageMode.Manual){t=h.default.OngoingCallService.getStagedParticipantsSelection(e.callId)||this.state.stageElements}else{const i=h.default.OngoingCallService.getStagedParticipantsSelection(e.callId);let n=[];o.isEmpty(i)||(n=o.filter(i,(e=>o.includes(a,e))),o.isEmpty(n)||(t=n)),o.isEmpty(t)&&(t=o.isEmpty(l)||y&&P!==_.StageMode.Grid?this.state.stageElements:l)}}else h.default.OngoingCallService.setHasConnectedParticipantsEdge(e.callId,!0),t=[];if(o.isEmpty(r)||(E.stageElements=this._cleanseStageElements(t,E,"buildState")),E.focusedParticipant=n,E.draggingElementKey&&E.draggingElementKey!==_.CallStageElementKeys.localUserKey){const e=o.keys(S);o.includes(e,E.draggingElementKey)||(E.draggingElementKey=void 0,this._topElement=void 0)}}o.isEmpty(r)&&(E.stageElements=T.CallUIUtils.fallbackStageElements(S,!!E.isProvidingVideo,e.baseStageMode)),o.each(n,((e,t)=>{const i=this._mountedRefsMap.ref(t);i&&i.updateTalking(e)}));const F=this._getCurrentCallPanelHeaderLayout(e);return this._layoutController.setCallHeaderPanelLayout(F),E.ribbonType=F!==_.CallPanelHeaderLayout.Float||e.isDesktopMin?_.RibbonType.Small:_.RibbonType.Large,E.stageMode=e.baseStageMode,E}componentDidMount(){super.componentDidMount();const e=te.default.newCauseId();x.log(k.LogTraceArea.CallingUI,"CallStageView.componentDidMount causeId: "+e),this._updateElementLayout(!1,this.state,this.props,e),this._callingStoreSubscriptionId=h.default.CallingStore.subscribe(this._maybeUpdateRibbonVisibleElements,this.props.callId),this.props.onStageChange&&this.props.onStageChange(this._localUserOnStage()),this.state.stageMode!==_.CallStageViewMode.None&&(x.log(k.LogTraceArea.CallingUI,"CallStageView.componentDidMount initiating startVideoSoundTimeout"),this._startVideoSoundTimeout=Date.now()),h.default.SpeakerViewTelemetryService.startTracking(this.props.callId),b.default.setHadOldCallStageEnabled(this.props.callId,e),this._layoutController.setElementsPositions(this.state.stageElements),this._registerKeyboardHandlers()}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this._suppressElementAnimation=!this.props.layoutAnimationEnabled,e.callId!==this.props.callId&&this._callingStoreSubscriptionId&&(h.default.CallingStore.unsubscribe(this._callingStoreSubscriptionId),this._callingStoreSubscriptionId=h.default.CallingStore.subscribe(this._maybeUpdateRibbonVisibleElements,e.callId)),this.state.ribbonHidden===t.ribbonHidden&&this.state.useImmersiveMode===t.useImmersiveMode||this._collapseOrExpandRibbon(t.ribbonHidden||t.useImmersiveMode,e.viewRect,!0);const a=this._layoutControllerForLocalUser(),n=this.props.viewRect.width!==e.viewRect.width||this.props.viewRect.x!==e.viewRect.x,s=this.state.isProvidingVideo!==t.isProvidingVideo;if(n||s){const i=te.default.newCauseId();if(s&&a&&a.setResizeFactor&&a.setResizeFactor(1),this.props.enableFloatableResizableVideoPreview&&this._isVideoPreviewFloatingOnTop){const t=this._layoutControllerForLocalUser();t&&t.setFullStageRect&&t.setFullStageRect(e.viewRect)}this._updateElementLayout(!1,t,e,i)}this.props.enableFloatableResizableVideoPreview&&(o.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey)&&this.props.onVideoPreviewFloating?(a&&a.setUIPosition&&a.setUIPosition(_.CallingViewUIPostion.Stage),this.props.onVideoPreviewFloating(!1,void 0),this._isVideoPreviewFloatingOnTop=!1):this._isVideoPreviewFloatingOnTop||a&&a.setUIPosition&&a.setResizeFactor&&(this.props.callPanelHeaderLayout===_.CallPanelHeaderLayout.Window?(a.setUIPosition(_.CallingViewUIPostion.RibbonWidowsMode),a.setResizeFactor(1)):a.setUIPosition(_.CallingViewUIPostion.Ribbon))),this.props.topInset!==e.topInset&&this._updateRibbonVerticalOffset(e.topInset||0,!1,e.stageLayoutMode);let r=h.default.OngoingCallService.getStagedParticipantsSelection(this.props.callId);if(r&&t.connectedParticipants.length!==this.state.connectedParticipants.length){const e=o.difference(t.connectedParticipants,this.state.connectedParticipants);t.connectedParticipants.length>this.state.connectedParticipants.length?r=r.concat(e):o.pullAll(r,e),h.default.OngoingCallService.setStagedParticipantsSelection(this.props.callId,r)}}_getRibbonBackdropContainerHeightStyle(e,t){return r.Styles.createViewStyle({height:this._getBackdropContainerHeight(e,t)},!1)}_getBackdropContainerHeight(e,t){return(t===_.RibbonType.Large?_.RibbonSizes.ribbonItemSizeLarge:_.RibbonSizes.ribbonItemSizeSmall)+T.CallUIUtils.getRibbonItemTopMargin(e)}_registerKeyboardHandlers(){O.default.addHandler(k.KeyboardShortcut.ResizeVideoPreview,this._resizeVideoPreviewFromKeyboard)}_unregisterKeyboardHandlers(){O.default.removeHandler(k.KeyboardShortcut.ResizeVideoPreview,this._resizeVideoPreviewFromKeyboard)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=te.default.newCauseId();x.log(k.LogTraceArea.CallingUI,"CallStageView.componentDidUpdate causeId: "+a),this._updateElementLayout(!this._suppressElementAnimation,this.state,this.props,a),this._startVideoSoundTimeout||t.stageMode!==_.CallStageViewMode.None||this.state.stageMode===_.CallStageViewMode.None||(x.log(k.LogTraceArea.CallingUI,"CallStageView: initiating startVideoSoundTimeout"),this._startVideoSoundTimeout=Date.now()),void 0===t.screenshareElementInfo&&this.state.screenshareElementInfo;const n=this._isDragging(this.state);n!==this._isDragging(t)&&(this.props.onDragChange&&this.props.onDragChange(n),this.state.draggingElementKey&&this._onElementStartDragging(this.state.draggingElementKey)),this.state.focusedParticipant!==t.focusedParticipant&&(this.state.focusedParticipant||h.default.OngoingCallService.setPreFocusStageParticipants(this.props.callId,[]),h.default.OngoingCallService.setFocusedParticipant(this.props.callId,this.state.focusedParticipant)),this.props.onStageChange&&this.props.onStageChange(this._localUserOnStage()),h.default.OngoingCallService.setStageParticipants(this.props.callId,this.state.stageElements),this.state.stageMode!==t.stageMode&&u.default.setDraggingParticipantConfig(void 0),this.state.useImmersiveMode!==t.useImmersiveMode&&this.props.onUseImmersiveModeChange(this.state.useImmersiveMode),this._suppressElementAnimation=!this.props.layoutAnimationEnabled,!t.anyVideoOrScreensharing&&this.state.anyVideoOrScreensharing&&this._maybePlayVideoAvailableSound(a);const s=!!this.state.screenshareElementInfo;if(s!==!!t.screenshareElementInfo){const e=this.state.screenshareElementInfo||t.screenshareElementInfo;this._announceScreensharingForAccessibility(s,e)}const r=T.CallUIUtils.shouldRenderStage(this.state)?this.state.stageElements:[],l=this._draggingElementKey();if(!o.includes(r,_.CallStageElementKeys.localUserKey)&&l!==_.CallStageElementKeys.localUserKey){const e=this._elementRenderInfo(_.CallStageElementKeys.localUserKey),t=!this.state.ribbonHidden;if(e&&this.props.enableFloatableResizableVideoPreview&&this.props.onVideoPreviewFloating){const i=this.state.isProvidingVideo,a=i&&!this.props.enableNewCallScreen?this._renderCallElementView(e,!0,this.state.enableTapToMoveCallParticipant,t):void 0;this.props.onVideoPreviewFloating(i,a)}}let c=this.state.stageElements;this._topElement&&o.includes(c,this._topElement)&&(c=o.without(c,this._topElement),c.push(this._topElement)),this._layoutController.setElementsPositions(c)}_announceScreensharingForAccessibility(e,t){if(!t)return;const i=p.default.extractMriFromKey(t.key),a=ee.default.getFullUserProfileByMriNoSubscription(i),n=e?"AccessibilityLabel.RemoteScreenShareStarted":"AccessibilityLabel.RemoteScreenShareStopped";$.default.maybeAnnounceForAccessibility(N.getString(n,{gender:E.getLocalizeParamForGender(a.gender),userName:M.default.getDisplayName(i)||""}))}_maybePlayVideoAvailableSound(e){const t=e=>{if(this.props.isRoutedToEarpiece&&this.isComponentMounted()){x.log(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound playing sound - causeId: "+e);(this.state.enableNewIncomingVideoSound?q.default.SkypeIncomingVideoAvailable:q.default.SkypeNotification).playOnce(e)}};if(!this._startVideoSoundTimeout)return void x.warn(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound requested to play sound too soon - causeId: "+e);const i=this._startVideoSoundTimeout+5e3-Date.now();i>0?this._soundDelayTimer?x.log(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound already pending - causeId: "+e):(this._soundDelayTimer=J.default.setTimeout((()=>t(e)),i),x.log(k.LogTraceArea.CallingUI,"CallStageView._maybePlayVideoAvailableSound delaying for "+i+"ms - causeId: "+e)):t(e)}componentWillUnmount(){super.componentWillUnmount();const e=te.default.newCauseId();x.log(k.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount causeId: "+e),this._callingStoreSubscriptionId&&(h.default.CallingStore.unsubscribe(this._callingStoreSubscriptionId),this._callingStoreSubscriptionId=void 0),h.default.SpeakerViewTelemetryService.stopTracking(this.props.callId),this._unregisterKeyboardHandlers()}_collapseOrExpandRibbon(e,t,i){const a=e?0:1;this._stageReactionsAnimatedOpacityValue.setValue(e?0:1),this._layoutController.updateRibbonExpandedMultiplier(a,t,!0)}_localUserOnStage(){return T.CallUIUtils.shouldRenderStage(this.state)&&o.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey)}_isDragging(e){return!!e.draggingElementKey}_updateElementLayout(e,t,i,a){if(x.log(k.LogTraceArea.CallingUI,"CallStageView._updateElementLayout causeId: "+a),0===i.viewRect.width||0===i.viewRect.height)return;const n=T.CallUIUtils.renderVideoPreview(t,i),s=T.CallUIUtils.shouldRenderStage(t)?t.stageElements:[],r=o.includes(s,_.CallStageElementKeys.localUserKey),d=o.size(s);let u;u=i.enableFloatableResizableVideoPreview?r||n&&this._isVideoPreviewFloatingOnTop?[]:[_.CallStageElementKeys.localUserKey]:r?[]:[_.CallStageElementKeys.localUserKey];const g=o.values(t.renderedRemoteElementInfo),C=h.default.CallingStore.getRankedSpeakerMris(i.callId);x.log(k.LogTraceArea.CallingUI,`CallStageView._updateElementLayout  causeId: ${a}`),o.each(g,(e=>{const t=o.findIndex(C,(t=>e.key===t));e.activeSpeakerRank=-1===t?Number.MAX_VALUE:t})),r&&g.push(this._localUserParticipantInfo);const S=g.sort(((e,t)=>T.CallUIUtils.compareElementInfo(e,t))),m=o.map(S,(e=>e.key));u=u.concat(m);const y=!!t.ringingParticipants&&1===t.ringingParticipants.length,f=[];let b=0,v=_.RibbonExtraVisibility.None,w=_.RibbonExtraVisibility.None,P=!1,M=!1,R=!1;t.enableAddToCallRibbonItem&&i.showParticipantsButton&&(w=i.showRibbonExtras?_.RibbonExtraVisibility.Visible:_.RibbonExtraVisibility.Hidden),f.push.apply(f,o.map(u,((e,a)=>{const n={key:e,isScreenshare:e===T.CallUIUtils.screenShareKey(t),videoType:T.CallUIUtils.videoTypeForKey(e,t,i),videoAspectRatio:T.CallUIUtils.videoAspectRatioForKey(e,t,i),isLocal:_.CallStageElementKeys.localUserKey===e,isHostOfScreenshare:!!t.renderedRemoteElementInfo[e]&&t.renderedRemoteElementInfo[e].isScreensharing},r=o.indexOf(s,n.key);if(r>=0)n.stagePosition=r,n.participantRank=r,n.displayOnStage=!0,n.hidden=!1;else{n.ribbonPosition=b,n.participantRank=d+b,n.isHiddenBot=o.includes(A.default.getNonInteractiveInCallBotMris(),n.key),P=!!n.isLocal,M=T.CallUIUtils.renderVideoPreview(this.state,i),R=!0;const a=t.allCallElements[e],s=a?a.participantState:l.ParticipantState.None;p.default.isParticipantStateRinging(s)?n.hidden=!y:n.hidden=!1,b++}return n}))),0!==this._latestVisibleRibbonCallItemKeys.length&&T.CallUIUtils.reorderLayoutInfoViaLeastVisibleItemSwaping(f,this._latestVisibleRibbonCallItemKeys);const L=this._ribbonItemHeight(t,P,M,R),V=this._shouldUseMobilePreviewPercentage(P,M,R)&&i.isLandscape,O=L,B=!!o.find(u,(e=>e===_.CallStageElementKeys.localUserKey));if(i.enableFloatableResizableVideoPreview&&n&&B){const e=i.availableRibbonWidth-3*L,t=this._layoutControllerForLocalUser();if(t&&t.viewRect&&t.setResizeFactor){const i=t.viewRect(!0);if(e<=i.width&&t.getResizeFactor){const a=t.getResizeFactor(),n=e/i.width*a;t.setResizeFactor(Math.max(n,1))}}}const D=this._layoutController.updateLayoutInfo(f,T.CallUIUtils.adjustedStageViewRect(i),L,O,!1,i.availableRibbonWidth,v,w,i.useMobileControls?1:2,e,V,this._ribbonRightSideOffSetForVideoPreview,!1,this._shouldShowRibbonModeSelector()&&this.state.enableNewLayoutPicker?_.LayoutPickerButtonWidth:void 0),E=o.filter(u,(e=>this._layoutController.controllerForKey(e).isHidden()));this._latestVisibleRibbonCallItemKeys=T.CallUIUtils.getVisibleSwapableRibbonItemKeys(f,E),x.log(k.LogTraceArea.CallingUI,`CallStageView._updateElementLayout   causeId: ' + ${a}`),f.push({key:_.CallStageElementKeys.remainderViewKey,ribbonPosition:b}),b++,t.enableAddToCallRibbonItem&&(f.push({key:_.CallStageElementKeys.addToCallViewKey,ribbonPosition:b}),b++),i.useMobileControls||(v=this._shouldShowRibbonModeSelector(t,i)?_.RibbonExtraVisibility.Visible:_.RibbonExtraVisibility.Hidden,f.push({key:_.CallStageElementKeys.ribbonModeViewKey,ribbonPosition:b}),b++),this._updateRibbonVerticalOffset(i.topInset||0,!0,i.stageLayoutMode);const N=t.ribbonHidden?0:Math.min(this._layoutController.ribbonWidth(),i.viewRect.width);this._ribbonAnimatedWidthValue.setValue(N);const F=o.sortBy(f,(e=>e.participantRank)),U=o.map(F,(e=>e.key));if(c.default.getS4LCMCFeaturesNoSubscription().twinCamEnabled){const e=h.default.CallingStore.getParticipantsWithTwinCam(i.callId);U.sort(((t,i)=>I.isMri(t)&&I.isMri(i)?o.includes(e,t)&&!o.includes(e,i)?-1:!o.includes(e,t)&&o.includes(e,i)?1:0:0)),U.unshift(j.default.getSkypeMri())}h.default.CallingStore.setRemoteVideoPriorityOrder(i.callId,o.without(U,_.CallStageElementKeys.localUserKey,_.CallStageElementKeys.remainderViewKey,_.CallStageElementKeys.ribbonModeViewKey,_.CallStageElementKeys.addToCallViewKey),a),this._remainderView&&this._remainderView.showRemainder(D,!o.isEmpty(t.ringingParticipants))}_updateRibbonVerticalOffset(e,t,i){const a=Math.max(T.CallUIUtils.getRibbonItemTopMargin(i),e);this._layoutController.updateRibbonVerticalOffset(a,t)}_getStageElementsForOnToggleParticipantUnfocus(){const e=o.keys(this.state.renderedRemoteElementInfo);return this.state.onlyVideoParticipantsOnStage?o.filter(e,(e=>e!==_.CallStageElementKeys.localUserKey&&h.default.RemoteStreamHelper.isStreamRenderingForTarget(this.props.callId,e,l.StreamType.Video,this._getRenderTargetViaKey(e)))):o.filter(e,(e=>e!==_.CallStageElementKeys.localUserKey))}_cleanseStageElements(e,t,i){const a=t||this.state,n=o.keys(a.renderedRemoteElementInfo);a.isFullscreenBotCall||n.push(_.CallStageElementKeys.localUserKey);let s=o.intersection(e,n);const r=this._layoutController.getMaxNumberOfStageElements();return s.length>r&&(s=o.takeRight(s,r)),s&&!o.isEmpty(s)||(x.log(k.LogTraceArea.CallingUI,"CallStageView._cleanseStageElements: No renderedStageElements, falling back (renderedElements:"+n.length+"; currentStageElements:"+e.length+")  causeId:"+i),s=T.CallUIUtils.fallbackStageElements(a.renderedRemoteElementInfo||{},!!a.isProvidingVideo,this.props.baseStageMode)),s||[]}_ribbonDropTargetHeight(){return this.state.ribbonType===_.RibbonType.Small?_.RibbonSizes.ribbonDropTargetSmallHeight:_.RibbonSizes.ribbonDropTargetLargeHeight}_draggingElementConfig(e,t,i){const a=u.default.dangerouslyGetCurrentDraggingParticipantConfig(),n=this.props.enableFloatableResizableVideoPreview,s=e===_.CallStageElementKeys.localUserKey,r=n&&s&&this._isVideoPreviewFloatingOnTop;let l=!o.includes(this.state.stageElements,e)&&!r;const c=this._ribbonRightSideOffSetForVideoPreview,d=this._ribbonDropTargetHeight()+(this.props.topInset||0);let h=!1;const p=t.pageX-this.props.viewRect.x,g=t.pageY-this.props.viewRect.y;let C;h=a&&a.showCancel||l&&g>d,h&&l&&g<d&&(l=!1);let S,m=-1,y=!1;if(l){const e=this._stageDropTarget();C=e.rect,m=e.targetPosition,y=e.confirmOnly}else C=n&&r&&i?this._ribbonDropTargetForVideoPreview(this.props.topInset||0,this._ribbonItemHeight(this.state),i):this._ribbonDropTarget(this.props.topInset||0);if(l)if(n&&s)S=g>=d;else{const e=p<=C.width&&p>=0,t=g<=C.height&&g>=0;S=e&&t}else S=n&&s&&i?g<i.height&&p>this.props.viewRect.width-i.width:g<d;const f=l?0:this.props.topInset||0,b=!(n&&s&&!o.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey))||r&&S;return x.log(k.LogTraceArea.CallingUI,"_draggingElementConfig showDropTarget "+b),n&&(this._ribbonRightSideOffSetForVideoPreview=i&&r&&S?C.width+_.RibbonSizes.ribbonItemMargin:0),c!==this._ribbonRightSideOffSetForVideoPreview&&(0!==this._ribbonRightSideOffSetForVideoPreview?this._updateElementLayout(!1,this.state,this.props,"_draggingElementConfig"):J.default.sleep(300).then((()=>this._updateElementLayout(!1,this.state,this.props,"_draggingElementConfig")))),a&&a.toStage===l&&a.showDropTarget===b&&a.selectDropTarget===S&&a.targetStagePosition===m&&a.showCancel===h&&a.confirmOnly===y&&a.topPadding===f&&(0,L.default)(a.dropTargetViewRect,C)&&a.isVideoPreviewAndFloatingOnTop===r?{config:a,changed:!1}:{config:{key:e,dropTargetViewRect:C,showDropTarget:b,selectDropTarget:S,toStage:l,targetStagePosition:m,showCancel:h,confirmOnly:y,topPadding:f,isVideoPreviewAndFloatingOnTop:r},changed:!0}}_stageDropTarget(){return{rect:T.CallUIUtils.adjustedStageViewBounds(this.props),targetPosition:this.state.stageElements.length,confirmOnly:0===this.state.stageElements.length}}_ribbonDropTarget(e){return{x:0,y:0,width:this.props.viewRect.width,height:this._ribbonDropTargetHeight()+e}}_ribbonDropTargetForVideoPreview(e,t,i){return{x:this.props.viewRect.width-t*i.width/i.height-_.RibbonSizes.ribbonItemMargin,y:T.CallUIUtils.getRibbonItemTopMargin(this.props.stageLayoutMode),width:t*i.width/i.height,height:t+e}}_moveCallElement(e,t,i){const a=te.default.newCauseId();x.log(k.LogTraceArea.CallingUI,"CallStageView._moveCallElement: "+n.pii.Omit(e)+" toStage: "+t+" causeId: "+a);const s=o.includes(this.state.stageElements,e),r=this.props.enableFloatableResizableVideoPreview;if(t===s&&e!==_.CallStageElementKeys.localUserKey)return void u.default.setDraggingParticipantConfig(void 0);let l=o.clone(this.state.stageElements);const c=this._layoutControllerForLocalUser(),d=this._layoutController.getMaxNumberOfStageElements();t?(r&&e===_.CallStageElementKeys.localUserKey?(this._isVideoPreviewFloatingOnTop=!0,c&&c.setUIPosition&&c.setUIPosition(_.CallingViewUIPostion.FloatingOnTop)):(l.length>=d&&(l=o.dropRight(l)),l.push(e)),x.log(k.LogTraceArea.CallingUI,"CallStageView._moveCallElement toStage success: "+n.pii.Omit(e)+" causeId: "+a),b.default.updateCallTelemetry(this.props.callId,a,(t=>e===_.CallStageElementKeys.localUserKey?t.moveSelfToStage():t.moveParticipantToStage()))):(r&&e===_.CallStageElementKeys.localUserKey&&!o.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey)?(this._isVideoPreviewFloatingOnTop=!1,c&&c.setUIPosition&&c.setResizeFactor&&(this.props.callPanelHeaderLayout===_.CallPanelHeaderLayout.Window?c.setUIPosition(_.CallingViewUIPostion.RibbonWidowsMode):c.setUIPosition(_.CallingViewUIPostion.Ribbon),c.setResizeFactor(1))):(l=o.without(l,e),this._updateRibbonAddTime(e,T.CallUIUtils.nextRibbonAddTime())),x.log(k.LogTraceArea.CallingUI,"CallStageView._moveCallElement toRibbon success: "+n.pii.Omit(e)+" causeId: "+a),b.default.updateCallTelemetry(this.props.callId,a,(t=>e===_.CallStageElementKeys.localUserKey?t.moveSelfToRibbon():t.moveParticipantToRibbon()))),this.props.enableFloatableResizableVideoPreview?e!==_.CallStageElementKeys.localUserKey&&(f.default.setStageMode(this.props.callId,_.StageMode.Manual,a),l=this._cleanseStageElements(l,this.state,a)):(f.default.setStageMode(this.props.callId,_.StageMode.Manual,a),l=this._cleanseStageElements(l,this.state,a)),h.default.OngoingCallService.setStagedParticipantsSelection(this.props.callId,l),this.setState({stageElements:l,focusedParticipant:void 0},(()=>{u.default.setDraggingParticipantConfig(void 0)}))}_updateRibbonAddTime(e,t){e!==_.CallStageElementKeys.localUserKey?this.state.renderedRemoteElementInfo[e]&&(this.state.renderedRemoteElementInfo[e].ribbonAddTime=t):this._localUserParticipantInfo.ribbonAddTime=t}_elementRenderInfo(e){if(e===_.CallStageElementKeys.localUserKey){const e=T.CallUIUtils.renderVideoPreview(this.state,this.props);return{renderKey:_.CallStageElementKeys.localUserKey,mri:j.default.getSkypeMri(),shouldRenderVideo:e,videoDimensions:e?this.props.viewRect:T.DummyVideoSize,isAScreensharing:!1,isLocal:!0,isMuted:this.state.isMuted,isHandRaised:this.state.isHandRaised,streamsStatus:e?_.CallParticipantStreamsStatus.Single:_.CallParticipantStreamsStatus.None,streams:this.state.localMediaStreams}}{const t=this.props.isVideoTarget,i=this.state.renderedRemoteElementInfo[e];if(i)return{renderKey:e,mri:i.mri,isLocal:!1,shouldRenderVideo:t&&i.isStreamAvailable,videoDimensions:t?i.videoDimensions:T.DummyVideoSize,isAScreensharing:i.isScreensharing,isScreenshareControlling:i.isScreenshareControlling,isRinging:i.isRinging,isOnHold:i.isOnHold,isMuted:i.isServerMuted,renderScreenShare:i.renderScreenShare,isPresenter:i.mri===this.state.screensharingUserMri,isHandRaised:i.isHandRaised,streamsStatus:i.streamsStatus,streams:i.streams}}}_getParticipantIconSize(e){const t=T.CallUIUtils.shouldRenderStage(this.state)&&o.includes(this.state.stageElements,e);let i=this._ribbonItemHeight(this.state);if(t)switch(this.state.stageElements.length){case 1:i=Y.UserIconSize.Size120;break;case 2:i=Y.UserIconSize.Size100}return i}_draggingElementKey(){return this.state.draggingElementKey}_getNameTagControlsHeight(){return 70}_renderStage(){const e=[],t=o.size(this.state.stageElements);let i=this.state.stageElements;this._topElement&&o.includes(i,this._topElement)&&(i=o.without(this.state.stageElements,this._topElement),i.push(this._topElement));const n=o.map(i,(e=>this._elementRenderInfo(e))),s=o.map(n,((e,i)=>this._renderStageParticipant(e,i,t)));e.push.apply(e,s);const l=[ie.stageContainerStyle];return this._getCurrentCallPanelHeaderLayout()===_.CallPanelHeaderLayout.Window&&l.push(ie.windowTopOffsetStageContainerStyle),this._layoutController.shouldSwitchOrientation()&&l.push(ie.modernStageLandscapeContainerStyle),(0,a.jsx)(r.View,Object.assign({style:l},{children:e}),"callStage")}_shouldShowParticipantContextMenu(e){if(e.renderScreenShare||e.isLocal)return!1;if(!this.state.isFullscreenBotCall)return!0;return!(this.props.stageLayoutMode!==_.StageMode.TogetherMode)&&this.state.showChangeTogetherModeBackgroundOption}_renderStageParticipant(e,t,i){if(!e)return null;const n=this._draggingElementKey(),s=this.state.enableLayoutAnimation&&!this._suppressElementAnimation,r=e.isLocal;let l;(e.isMuted||e.isOnHold||e.isAScreensharing)&&(l=T.CallUIUtils.accessoryPosition(t,i,!!this.props.isLandscape));const c=T.CallUIUtils.nametagOffset(i,this._getNameTagControlsHeight()),d=n===e.renderKey,u=o.includes(this.state.nonInteractiveInCallBotMris,e.renderKey),h=e.renderScreenShare||this.state.isFullscreenBotCall||e.streamsStatus===_.CallParticipantStreamsStatus.Multiple;return(0,a.jsx)(C.CallParticipantView,{ref:this._mountedRefsMap.onComponentRef(e.renderKey),callId:this.props.callId,conversationMri:this.props.conversationMri,nametagPosition:c,showContextMenu:this._shouldShowParticipantContextMenu(e)||r,showChangeTogetherModeBackgroundOption:this.state.showChangeTogetherModeBackgroundOption,renderKey:e.renderKey,renderInfo:e,isDragging:d,iconOpacity:this.props.hideFullscreenIcon?0:1,onPan:this._onStageElementPan,onTap:this._onStageElementTap,onDoubleTap:this._onDoubleTap,onPressInOrOut:this._onElementPressInOrOut,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,animateIconChanges:s,accessoryPosition:l,isGroupCall:!this.state.isOneOnOneConversation,accessoryOpacityStyle:this.props.callParticipantOpacityStyle,nametagOpacityStyle:this.props.callParticipantTooltipStyle,enableVideoGestures:1===i,forceSizeToFit:h,shouldWaitForVideoSize:!1,parentViewId:"CallStageView#StageView",onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,renderMobileNameTag:1===i,hideNameTag:this.props.hideNameTag||u||this.props.isPstnTranslationEnabled,useDarkBackground:!0,enableFloatableResizableVideoPreview:e.isLocal&&!e.isAScreensharing?this.props.enableFloatableResizableVideoPreview:void 0,isSpeakerMode:this.props.stageLayoutMode===_.StageMode.Speaker,desktopNameTag:!this.props.useMobileControls,isFullscreenBotCall:this.state.isFullscreenBotCall,layoutController:this._layoutControllerForKey,iconSize:this._getParticipantIconSize(e.renderKey),isScreenSharing:e.mri===this.state.screensharingUserMri,hideBackground:this.props.isPstnTranslationEnabled,hideIcon:this.props.isPstnTranslationEnabled},e.renderKey)}_renderCelebrationAnimationView(){return(0,a.jsx)(w.default,{conversationMri:this.props.reactionsConversationId,callId:this.props.callId,height:this.props.viewRect.height,width:this.props.viewRect.width,isLandscape:this.props.isLandscape},"celebrationAnimationView")}_renderContent(){if(this.state.stageMode===_.CallStageViewMode.None||!this.state.isCallVisible)return;const e=[];if(T.CallUIUtils.shouldRenderStage(this.state)&&e.push(this._renderStage()),!this.state.draggingElementKey||this.state.draggingElementKey===_.CallStageElementKeys.localUserKey&&this.props.enableFloatableResizableVideoPreview)if(this.props.callStageOverlayOpacityStyle){const t=this.props.useMobileControls?.45:.25,i=[Q.Color.transparent,Q.Color.blackOverlay40],n=[this.props.callStageOverlayOpacityStyle,r.Styles.createViewStyle({height:this.props.viewRect.height*t},!1)];this._getCurrentCallPanelHeaderLayout()!==_.CallPanelHeaderLayout.Window&&e.push((0,a.jsx)(r.Animated.View,Object.assign({blockPointerEvents:!0,ignorePointerEvents:!0,style:[n,ie.overlayTopContainer]},{children:(0,a.jsx)(s.GradientView,{style:X.default.flexOne,colors:i,direction:s.GradientDirection.TOP,ignorePointerEvents:!0})}),"callStageOverlayTop")),this.props.useMobileControls&&e.push((0,a.jsx)(r.Animated.View,Object.assign({blockPointerEvents:!0,ignorePointerEvents:!0,style:[n,ie.overlayBottomContainer]},{children:(0,a.jsx)(s.GradientView,{style:X.default.flexOne,colors:i,direction:s.GradientDirection.BOTTOM,ignorePointerEvents:!0})}),"callStageOverlayBottom"))}else if(this.props.useMobileControls){const t=[ie.overlayContainer,r.Styles.createViewStyle({top:T.CallUIUtils.getStageTopOffset(this.props)},!1)];this.props.callStageOverlayOpacityStyle&&t.push(this.props.callStageOverlayOpacityStyle),this.state.enableTapToFlipCamera&&t.push(ie.mobileOverlayShim),e.push((0,a.jsx)(r.Animated.View,{blockPointerEvents:!0,ignorePointerEvents:!0,style:t},"callStageOverlay"))}return e.push.apply(e,this._renderRibbon()),this.state.isNavigatingWithKeyboard||e.push((0,a.jsx)(g.default,{getAnchorInfo:this._getAnchorInfo,getAnchorInfoChanges:this._getAnchorInfoChanges,parentDimensions:this.props.viewRect,opacityStyle:this.props.callParticipantTooltipStyle,callId:this.props.callId,conversationMri:this.props.conversationMri,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,onNametagMouseEnter:this._onCallParticipantNametagMouseEnter,onNametagMouseLeave:this._onCallParticipantNametagMouseLeave},"nametag")),e}_renderRibbon(){if(this.state.stageMode===_.CallStageViewMode.StageOnly)return;const e=[],t=this._getRibbonBackdropContainerHeightStyle(this.props.stageLayoutMode,this.state.ribbonType),i=[ie.backdropContainer,t,this._ribbonAnimatedWidthStyle];e.push((0,a.jsx)(r.Animated.View,Object.assign({style:i,importantForAccessibility:r.Types.ImportantForAccessibility.NoHideDescendants},{children:(0,a.jsx)(r.GestureView,{style:ie.ribbonBackdrop,onPanHorizontal:this._onRibbonBackdropPan})}),"ribbon"));const n=T.CallUIUtils.shouldRenderStage(this.state)?this.state.stageElements:[],s=this._draggingElementKey(),l=!this.state.ribbonHidden;let c=!0;const d=[];if(!o.includes(n,_.CallStageElementKeys.localUserKey)&&s!==_.CallStageElementKeys.localUserKey){const e=this._elementRenderInfo(_.CallStageElementKeys.localUserKey);e&&d.push(e)}let u=o.keys(this.state.renderedRemoteElementInfo);if(u=o.difference(u,n),s){if(this.props.enableFloatableResizableVideoPreview){const e=s!==_.CallStageElementKeys.localUserKey,t=s===_.CallStageElementKeys.localUserKey&&o.includes(this.state.stageElements,_.CallStageElementKeys.localUserKey);c=e||t}u=o.without(u,s)}e.push(this._renderCelebrationAnimationView());const h=this._ribbonItemHeight(this.state);e.push((0,a.jsx)(z.default,{ref:this._onRemainderViewRef,layoutController:this._layoutControllerForKey(_.CallStageElementKeys.remainderViewKey),dimensions:{height:h,width:h},onPress:this._onRemainderViewPressed},"remainder")),this._shouldShowRibbonModeSelector()&&(this.state.enableNewLayoutPicker?e.push((0,a.jsx)(B.default,{availableLayoutModes:T.CallUIUtils.getAvailableHeaderModes(this.props.useMobileControls,this.state.isOneOnOneConversation),callId:this.props.callId,conversationMri:this.props.conversationMri,layoutController:this._layoutControllerForKey(_.CallStageElementKeys.ribbonModeViewKey),dimensions:{height:h,width:_.LayoutPickerButtonWidth},isIncomingOrOutGoingRing:this.props.isIncomingOrOutgoingRing,showChevron:!0,useMobileCallControls:this.props.useMobileControls},"ribbonMode")):e.push((0,a.jsx)(G.default,{availableLayoutModes:T.CallUIUtils.getAvailableHeaderModes(this.props.useMobileControls,this.state.isOneOnOneConversation),callId:this.props.callId,conversationMri:this.props.conversationMri,layoutController:this._layoutControllerForKey(_.CallStageElementKeys.ribbonModeViewKey),dimensions:{height:h,width:h},layoutMode:this._getCurrentCallPanelHeaderLayout(),onCallPanelHeaderLayoutChange:this.props.onCallPanelHeaderLayoutChange,showFullScreenOptionInRibbonSettings:this.props.showFullScreenOptionInRibbonSettings,isIncomingOrOutGoingRing:this.props.isIncomingOrOutgoingRing,showChevron:!0},"ribbonMode"))),this.state.enableAddToCallRibbonItem&&this.props.showParticipantsButton&&e.push((0,a.jsx)(H.default,{layoutController:this._layoutControllerForKey(_.CallStageElementKeys.addToCallViewKey),dimensions:{height:h,width:h},coachMarkType:this.state.enableAddToCallCoachmark?P.CoachMarkType.CallPanelAddToCallButton:void 0,accessibilityLabel:N.getString("CallControlsOverFlowMenu.AddPeopleToCall"),onPress:this._onAddToCallViewPressed},"addtocall")),this._topElement&&o.includes(u,this._topElement)&&(u=o.without(u,this._topElement),u.push(this._topElement)),u=o.without(u,...this.state.nonInteractiveInCallBotMris);const p=o.map(u,(e=>this._elementRenderInfo(e)));if(d.push.apply(d,p),!this.props.isPstnTranslationEnabled){const t=o.map(d,(e=>{const t=!o.includes(n,e.renderKey),i=this.props.enableFloatableResizableVideoPreview&&this.props.onVideoPreviewFloating&&this.state.isProvidingVideo;if(e.renderKey!==_.CallStageElementKeys.localUserKey||!i&&!this.props.enableNewCallScreen)return this._renderCallElementView(e,t,this.state.enableTapToMoveCallParticipant,l)}));e.push.apply(e,t)}if(e.push((0,a.jsx)(m.CallStageDropTarget,{type:m.CallStageDropTargetType.Background},"background")),s&&c){const t=this._elementRenderInfo(s);if(t){const i=!o.includes(n,t.renderKey);if(i){const a=this._renderCallElementView(t,i,!1,l);e.push(a)}}}if(e.push((0,a.jsx)(m.CallStageDropTarget,{type:m.CallStageDropTargetType.Foreground},"foreground")),!this.props.disableReactions){const t=(0,a.jsx)(R.default,{ref:this._onInlineCallStageReactionsViewRef,reactionsConversationMri:this.props.reactionsConversationId,ignorePointerEvents:!0,parentDimensions:this.props.viewRect,topOffsetForUnhandledReactions:h+(this.props.topInset||0)+20,alignRight:!0,getAnchorInfo:this._getAnchorInfo,getAnchorInfoChanges:this._getAnchorInfoChanges,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,onReactionTap:this._onTextReactionPressed});e.push((0,a.jsx)(r.Animated.View,Object.assign({style:[ie.reactionsView,this._stageReactionsAnimatedStyle],ignorePointerEvents:!0},{children:t}),_.CallStageElementKeys.callTextReactionViewKey))}return e}_renderCallElementView(e,t,i=!1,n=!1){const o=this.state.enableTapToFlipCamera&&e.isLocal&&e.shouldRenderVideo&&t,s=e.renderKey===T.CallUIUtils.screenShareKey(this.state),r=e.isLocal,l=!e.renderScreenShare&&!e.isLocal;let c;c=t&&e.isRinging?this._onRemainderViewPressed:s?this._onScreenshareTap:i?this._onRibbonElementTapBinder:o?this.props.onParticipantViewTapped:this._onStageTapBinder;const d=t&&!e.isRinging&&!this.state.enableImmersiveMode&&this.state.enableTapToMoveCallParticipant?this._onToggleParticipantFocus:void 0,u=this.state.enableLayoutAnimation&&!this._suppressElementAnimation;let h=0;if(t){const t=e.renderScreenShare||e.isLocal;h=e.shouldRenderVideo&&t?_.RibbonSizes.ribbonItemRectBorderRadius:this._ribbonItemHeight(this.state)/2}return(0,a.jsx)(C.CallParticipantView,{ref:this._mountedRefsMap.onComponentRef(e.renderKey),showContextMenu:l||r,renderInfo:e,renderKey:e.renderKey,isCompact:t,callId:this.props.callId,isGroupCall:!this.state.isOneOnOneConversation,conversationMri:this.props.conversationMri,isDragging:this._draggingElementKey()===e.renderKey,onPan:!e.isRinging&&n?this._onElementPan:void 0,onResize:e.renderKey===_.CallStageElementKeys.localUserKey&&this.props.enableFloatableResizableVideoPreview?this._onElementResize:void 0,onPressInOrOut:!e.isRinging&&n?this._onElementPressInOrOut:void 0,onMouseOverOrOut:this._onElementMouseOverOrOut,onTap:c,onDoubleTap:d,getCallReactionsDisplayHelper:this._getCallReactionsDisplayHelper,iconOpacity:1,videoBorderRadius:h,animateIconChanges:u,forceSizeToFit:e.renderScreenShare,parentViewId:"CallStageView#CallElementView",allowCameraFlip:o,onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,useDarkBackground:!0,enableFloatableResizableVideoPreview:e.isLocal&&!e.isAScreensharing?this.props.enableFloatableResizableVideoPreview:void 0,isSpeakerMode:this.props.stageLayoutMode===_.StageMode.Speaker,isFullscreenBotCall:this.state.isFullscreenBotCall,layoutController:this._layoutControllerForKey,iconSize:this._getParticipantIconSize(e.renderKey),isCallStageV2:!1,isScreenSharing:this.state.screensharingUserMri===e.mri,hideBackground:this.props.isPstnTranslationEnabled,hideIcon:this.props.isPstnTranslationEnabled,hideNameTag:this.props.isPstnTranslationEnabled},e.renderKey)}_ribbonItemHeight(e,t,i,a){return this._shouldUseMobilePreviewPercentage(!!t,!!i,!!a)?this._mobilePreviewPercentageSize():e.ribbonType===_.RibbonType.Large?_.RibbonSizes.ribbonItemSizeLarge:_.RibbonSizes.ribbonItemSizeSmall}_shouldUseMobilePreviewPercentage(e,t,i){return!1}_mobilePreviewPercentageSize(){return this.props.isLandscape?this.props.viewRect.width*this.state.mobilePreviewPercentage:this.props.viewRect.height*this.state.mobilePreviewPercentage}_anchorInfoForRect(e,t){const i=T.CallUIUtils.translateRect(e,this.props.viewRect.width);let a=t;return i&&(a||i.x<0)&&(i.x=0,a=!0),{rect:i,hidden:a}}render(){return(0,a.jsx)(r.View,Object.assign({style:this.props.style},{children:this._renderContent()}))}}t.CallStageView=ae,t.default=ae},657033:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallStageViewV2=void 0;const a=i(785893),n=i(496486),o=i(667294),s=i(516778),r=i(701025),l=i(705465),c=i(994224),d=i(598925),u=i(480200),h=i(746096),p=i(436237),g=i(915877),C=i(590678),S=i(581760),m=i(680837),y=i(24576),f=i(853374),b=i(475377),_=i(886251),T=i(334548),v=i(706250),w=i(537103),I=i(156018),P=i(498053),M=i(502278),k=i(136850),A=(0,g.lazyProperties)({reactionsView:()=>m.default.absoluteFill,stageContainerStyle:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:S.Color.transparent,flex:1,flexDirection:"column",flexWrap:"wrap",justifyContent:"center",alignSelf:"center"}),optionalPaddingStyle:()=>s.Styles.createViewStyle({padding:4}),modernStageLandscapeContainerStyle:()=>s.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap"})}),R=(0,g.lazyProperties)({contentView:()=>s.Styles.createViewStyle({margin:4,borderRadius:8,overflow:"hidden"})}),x=l.StyleSheet.create({localParticipantViewPosition:{position:"absolute",right:16},localParticipantViewFullScreen:{top:16},localParticipantViewWithControls:{top:64}});class L extends y.default{constructor(){super(...arguments),this._layoutController=new b.default(!0),this._mountedRefsMap=new v.default,this._onStageTapBinder=(e,t)=>this.props.onStageTap&&this.props.onStageTap(t),this._layoutControllerForKey=e=>this._layoutController.controllerForKey(e),this._getCallParticipantAccesoryPosition=()=>this.props.participantsAccessoryPosition?this.props.participantsAccessoryPosition:this.props.isCompactView?u.CallAccessoryPosition.BottomRight:void 0,this._onViewRef=e=>{this._parentViewRef=e||void 0},this._getParentRefForReactions=()=>this._parentViewRef,this._getChildRefForReactions=e=>this._mountedRefsMap.ref(e)}_buildState(e,t){return{stageElements:I.default.getStageElements(e.callId),showChangeTogetherModeBackgroundOption:P.ChangeTogetherModeBackgroundCommand.canExecute(e.callId,e.conversationMri),showMyselfInTheGrid:k.default.getSelfInTheGrid(e.callId)}}componentDidMount(){super.componentDidMount(),p.log(h.LogTraceArea.CallingUI,"CallStageView.componentDidMount"),c.default.SpeakerViewTelemetryService.startTracking(this.props.callId),M.default.setHadNewCallStageEnabled(this.props.callId,f.default.newCauseId())}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const a=f.default.newCauseId();p.log(h.LogTraceArea.CallingUI,"CallStageView.UNSAFE_componentWillUpdate causeId: "+a),this._updateElementLayout(t,e,a)}componentWillUnmount(){super.componentWillUnmount();const e=f.default.newCauseId();p.log(h.LogTraceArea.CallingUI,"CallStageView.componentWillUnmount causeId: "+e),c.default.SpeakerViewTelemetryService.stopTracking(this.props.callId)}_renderCelebrationAnimationView(){return(0,a.jsx)(_.default,{conversationMri:this.props.reactionsConversationId,callId:this.props.callId,height:this.props.viewRect.height,width:this.props.viewRect.width,isLandscape:this.props.isLandscape},"celebrationAnimationView")}_updateElementLayout(e,t,i){if(p.log(h.LogTraceArea.CallingUI,"CallStageView._updateElementLayout causeId: "+i),0===t.viewRect.width||0===t.viewRect.height)return;const a=n.map(e.stageElements,(t=>{const i=n.indexOf(e.stageElements,t);return{key:t,videoType:u.LayoutInfoVideoType.None,isLocal:u.CallStageElementKeys.localUserKey===t,isHostOfScreenshare:0===t.indexOf(d.ScreenSharingPrefix),stagePosition:i}}));this._layoutController.updateLayoutInfoForStage(a,this._adjustedStageViewRectV2(t.viewRect)),I.default.setStageCapacity(t.callId,this._layoutController.getMaxNumberOfStageElements())}_renderStageParticipant(e){return(0,a.jsx)(w.default,{renderKey:e,ref:t=>{this._onParticipantViewRef(t,e)},callId:this.props.callId,conversationMri:this.props.conversationMri,iconOpacity:1,isGroupCall:!this.props.isOneOnOneConversation,parentViewId:"CallStageView#StageView",onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,hideNameTag:this.props.hideNameTag,useDarkBackground:!0,desktopNameTag:!0,isCallStageV2:!0,useLightTheme:this.props.useLightTheme,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,layoutController:this._layoutControllerForKey,iconSize:120,showChangeTogetherModeBackgroundOption:this.state.showChangeTogetherModeBackgroundOption,contentViewStyles:this.state.stageElements.length>1?R.contentView:void 0,hideBackground:this.props.hideParticipantBackground,hideIcon:this.props.hideParticipantIcon,onTap:this._onStageTapBinder,accessoryPosition:this._getCallParticipantAccesoryPosition(),forceVideoToCrop:this.props.forceVideoToCrop},e)}_adjustedStageViewRectV2(e){return{x:e.x,y:e.y+(this.props.isCompactView?0:u.DesktopNewHeaderHeight),width:e.width,height:e.height-(this.props.isCompactView?0:u.DesktopCallControlsHeight+u.DesktopNewHeaderHeight)}}_onParticipantViewRef(e,t){this._mountedRefsMap.onComponentRef(t).call(this,e)}_renderStage(){const e=n.map(this.state.stageElements,(e=>this._renderStageParticipant(e))),t=[A.stageContainerStyle];return this._layoutController.shouldSwitchOrientation()&&t.push(A.modernStageLandscapeContainerStyle),e.length>1&&t.push(A.optionalPaddingStyle),(0,a.jsxs)(s.View,Object.assign({style:[t,this.props.style],ref:this._onViewRef},{children:[e,this._maybeRenderLocalVideoView()]}),"callStage")}_renderReactionsView(){return(0,a.jsx)(T.NewCallReactionsView,{reactionsConversationId:this.props.reactionsConversationId,parentDimensions:this.props.viewRect,getChildRef:this._getChildRefForReactions,getParentRef:this._getParentRefForReactions,onTextReactionPressed:this.props.onTextReactionPressed,disableReactions:this.props.disableReactions,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper})}_maybeRenderLocalVideoView(){if(!this.props.isOneOnOneConversation||this.props.stageLayoutMode!==u.StageMode.Grid||this.state.showMyselfInTheGrid||this.props.hideLocalVideo)return;const e=(0,a.jsx)(C.default,{getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,callId:this.props.callId,conversationMri:this.props.conversationMri,useLightTheme:this.props.useLightTheme,isCompactView:this.props.isCompactView},"localVideoView");return this.props.isCompactView?(0,a.jsx)(r.SafeAreaView,Object.assign({pointerEvents:"box-none",style:l.StyleSheet.flatten([x.localParticipantViewPosition,this.props.isVideoFullScreenMode?x.localParticipantViewFullScreen:x.localParticipantViewWithControls])},{children:(0,a.jsx)(l.View,{children:e})}),"localVideoViewPosition"):e}render(){return(0,a.jsxs)(o.Fragment,{children:[this._renderStage(),this._renderReactionsView(),this._renderCelebrationAnimationView()]})}}t.CallStageViewV2=L},154090:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(671830),r=i(952262),l=i(438891),c=i(915877),d=i(733754),u=i(18078),h=i(581760),p=i(619675),g=i(702301),C=i(567977),S=i(889391),m=i(640363),y=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({alignItems:"flex-start",marginBottom:2}),userIcon:()=>n.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,overflow:"visible"}),textSize20:()=>n.Styles.createTextStyle({fontSize:20})});class f extends o.ComponentBase{_buildState(e,t){let i=d.getString("Notifications.UnknownUserShort");if(e.transcription.senderMri){const t=s.sanitizeMri(e.transcription.senderMri,s.Namespaces.SkypeId);t&&(i=u.default.isMyMri(t)?d.getString("DisplayInfoStore.ListMyName"):r.default.getShortDisplayName(t)||d.getString("Notifications.UnknownUserShort"))}return{displayName:i}}render(){let e;if(this.props.transcription.messages&&this.props.transcription.messages.length>0&&this.props.transcription.payloads&&this.props.transcription.payloads.length>0&&this.props.transcription.sentences&&this.props.transcription.sentences.length>0){e="";for(let t=0;t<this.props.transcription.messages.length;t++){const i=this.props.isInterimCaptionConcatenated?this.props.transcription.sentences[t]:this.props.transcription.payloads[t].translation||this.props.transcription.payloads[t].message;i&&(e+=i+" ")}}else e=this.props.isInterimCaptionConcatenated?this.props.transcription.sentence:this.props.transcription.payload.translation||this.props.transcription.payload.message;if(!e)return null;const t=!(this.props.uiPstn&&this.props.callParticipantCount&&1===this.props.callParticipantCount),i=this.props.captionPositionMode===l.CaptionsPositionMode.left?C.UserIconSize.Size24:C.UserIconSize.Size40,o=t?i/2:0;let s,r=!this.props.isInterimCaptionHighlightEnabled||this.props.transcription.payload.isFinal?h.Color.white:h.Color.gray300,c=h.Color.blackOverlay80,d=h.Color.blackOverlay80;this.props.uiPstn?r=this.props.useLightTheme?h.Color.delphiPrimaryTextColor:h.Color.gray50:this.props.useLightTheme?(r=!this.props.isInterimCaptionHighlightEnabled||this.props.transcription.payload.isFinal?h.Color.black:h.Color.blackOverlay80,s=h.Color.blackOverlay50,c=h.Color.whiteOverlay80,d=h.Color.whiteOverlay80):(s=h.Color.gray50Overlay50,this.props.captionPositionMode===l.CaptionsPositionMode.float&&(s=h.Color.white,c=h.Color.gray600,d=h.Color.gray400));const u=[y.userIcon,n.Styles.createViewStyle({alignItems:this.props.isRTL?"flex-end":"flex-start"},!1)],f=[y.container,n.Styles.createViewStyle({alignItems:this.props.isRTL?"flex-end":"flex-start"},!1)],b=[n.Styles.createViewStyle({alignItems:this.props.isRTL?"flex-end":"flex-start",marginLeft:this.props.isRTL?void 0:o,marginRight:this.props.isRTL?o:void 0},!1)],_=[],T=[n.Styles.createTextStyle({paddingLeft:this.props.isRTL?10:o+10,paddingRight:this.props.isRTL?o+10:10,color:r},!1)];if(this.props.uiPstn)T.push(n.Styles.createTextStyle({fontSize:25,paddingVertical:6},!1));else{const e=i+16;if(this.props.captionPositionMode===l.CaptionsPositionMode.bottom)f.push(n.Styles.createViewStyle({marginTop:10,minHeight:e},!1)),this.props.isUsingStackNavigationContext||T.push(y.textSize20);else if(this.props.captionPositionMode===l.CaptionsPositionMode.left)f.push(n.Styles.createViewStyle({marginBottom:10,minHeight:e},!1));else{if(m.default.isElectronWindows()){const e=S.default.getS4LCMCFeaturesNoSubscription().callCaptionsFloatPanel.letterSpacingWindows;e>0&&T.push(n.Styles.createTextStyle({letterSpacing:e},!1))}const a=t?i+8:8;f.push(n.Styles.createViewStyle({paddingHorizontal:12,marginBottom:4,minHeight:e},!1)),b.push(n.Styles.createViewStyle({marginLeft:this.props.isRTL?void 0:a,marginRight:this.props.isRTL?a:void 0,marginBottom:2,borderRadius:8,paddingHorizontal:8,paddingVertical:4},!1)),_.push(n.Styles.createViewStyle({backgroundColor:c},!1)),T.push(n.Styles.createTextStyle({paddingLeft:0,paddingRight:0,color:r},!1)),T.push(y.textSize20),u.push(n.Styles.createViewStyle({marginLeft:this.props.isRTL?void 0:12,marginRight:this.props.isRTL?12:void 0,marginTop:8},!1))}}let v,w;if(t&&(v=(0,a.jsx)(n.View,Object.assign({style:u},{children:(0,a.jsx)(g.UserIcon,{userMri:this.props.transcription.senderMri,size:i})}),"icon")),this.props.uiPstn)w=void 0;else{const e=n.Styles.createViewStyle({backgroundColor:this.props.captionPositionMode===l.CaptionsPositionMode.bottom||this.props.captionPositionMode===l.CaptionsPositionMode.left?void 0:d},!1),t=n.Styles.createTextStyle({fontSize:12,paddingBottom:this.props.captionPositionMode===l.CaptionsPositionMode.bottom||this.props.captionPositionMode===l.CaptionsPositionMode.left?0:2,color:s||r},!1);w=(0,a.jsx)(n.View,Object.assign({style:[b,t,e]},{children:(0,a.jsx)(p.BodyText,Object.assign({style:[T,t]},{children:this.state.displayName}))}),"nametag")}return(0,a.jsxs)(n.View,Object.assign({style:f,disableTouchOpacityAnimation:!0},{children:[w,(0,a.jsx)(n.View,Object.assign({style:[b,_]},{children:(0,a.jsx)(p.BodyText,Object.assign({style:T},{children:e}))}),"text"),v]}))}}t.default=f},500091:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(889391),r=i(994224),l=i(154090),c=i(518154),d=i(785107),u=i(677381),h=i(77388),p=i(913944),g=i(861253),C=i(915877),S=i(733754),m=i(330124),y=i(864674),f=i(581760),b=i(711828),_=i(169015),T=i(104735),v=i(853374),w=b.IconSize.default,I=b.IconSize.size24,P=b.IconSize.size40,M=b.IconSize.size20,k=(0,C.lazyProperties)({scroll:()=>o.Styles.createViewStyle({flex:1,alignItems:"stretch",backgroundColor:f.Color.black}),buttonIconsContainer:()=>o.Styles.createViewStyle({height:w,alignItems:"flex-start",flexDirection:"row",justifyContent:"space-between"}),buttonIcon:()=>o.Styles.createViewStyle({width:w,height:w,justifyContent:"center",alignItems:"center",alignSelf:"flex-start",opacity:.9,overflow:"visible"}),buttonJumpContainer:()=>o.Styles.createViewStyle({position:"absolute",right:12,width:P,height:P,overflow:"visible"}),buttonJump:()=>o.Styles.createViewStyle({width:P,height:P,borderWidth:1,borderRadius:P/2,borderColor:f.Color.blackOverlay10,justifyContent:"center",alignItems:"center",opacity:.9,overflow:"visible",backgroundColor:f.Color.gray400}),buttonHovered:()=>o.Styles.createViewStyle({opacity:1})});class A{constructor(e,t,i){this.key=e,this.transcription=t,this.height=i,this.focusable=!1}}class R extends u.default{constructor(){super(...arguments),this._renderItem=(e,t)=>e instanceof A?(0,a.jsx)(l.default,{transcription:e.transcription,isInterimCaptionConcatenated:this.state.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:this.state.isInterimCaptionHighlightEnabled,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext},e.key):(0,a.jsx)(o.View,{}),this._onPressClose=e=>{if(e.stopPropagation(),this.state.canJumpToEnd||c.default.setConsumptionHorizon(this.props.reactionsMri,this.state.lastMessageTime+1),this.state.isUsingStackNavigationContext){const e=v.default.newCauseId();T.default.goBack(e,this._getContext())}r.default.OngoingCallService.setIsSubtitleHistoryOpen(this.props.callId,!1)},this._onPressClosedCaptionSettings=e=>{e.stopPropagation(),r.default.CallNavigationHelper.navigateToSubtitlesCallingSettingsPanel(!1,!1,this._getRootViewId())},this._onPressJump=e=>{e.stopPropagation(),this._listView&&this._listView.scrollToBottom()},this._onVisibleRangeChanged=(e,t,i,a)=>{if(!this._itemList)return;const o=a!==this._itemList.getItemList().length-1;n.defer((()=>{this.isComponentMounted()&&(this.state.canJumpToEnd!==o?this.setState({canJumpToEnd:o}):c.default.resetUnseenTranscriptionCount(this.props.reactionsMri))}))},this._equalsItemInfo=(e,t)=>e instanceof A&&t instanceof A?e.key===t.key&&e.transcription.payload.message===t.transcription.payload.message&&e.transcription.payload.translation===t.transcription.payload.translation&&e.transcription.payload.isFinal===t.transcription.payload.isFinal:(0,g.default)(e,t),this._shouldUpdateItem=(e,t)=>!this._equalsItemInfo(e,t),this._onListViewRef=e=>{this._listView=e||void 0}}_buildState(e,t){var i,a;const o=s.default.getS4LCMCFeatures(),r=c.default.getTranscriptions(e.reactionsMri),l=n.map(r,(e=>new A(e.payload.cid,e))),d=null!==(a=null===(i=n.maxBy(r.map((e=>e.message)),(e=>e.createdTime)))||void 0===i?void 0:i.createdTime)&&void 0!==a?a:0;if(t||!this._itemList)this._itemList=new y.default,this._itemList.addItems(0,l);else{const e=this._itemList.getItemList(),t=h.default.calculateModifications(e,l,!0,!1,this._equalsItemInfo),i=h.default.convertToListModifications(t);this._itemList.applyMany(i)}return{isInterimCaptionConcatenated:o.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:o.isInterimCaptionHighlightEnabled,lastMessageTime:d,isUsingStackNavigationContext:m.default.isUsingStackNavigationContext()}}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),c.default.assignCallId(this.props.reactionsMri,this.props.callId)}render(){if(!this._itemList)return null;const e=this.props.bottomPadding||10,t=this.props.topPadding,i=o.Styles.createViewStyle({paddingBottom:e,paddingTop:t},!1),n=this.state.canJumpToEnd?this._renderJumpButton():void 0;return(0,a.jsxs)(o.View,Object.assign({style:[this.props.style,k.scroll,i]},{children:[(0,a.jsxs)(o.View,Object.assign({style:k.buttonIconsContainer},{children:[(0,a.jsx)(p.default,{style:k.buttonIcon,size:I,color:f.Color.gray50,hoverColor:f.Color.white,hoverStyle:k.buttonHovered,icon:b.SkypeIcon.ClosePanel,onPress:this._onPressClose,title:S.getString("CallTranscription.Collapse")}),(0,a.jsx)(p.default,{style:k.buttonIcon,size:I,color:f.Color.gray50,hoverColor:f.Color.white,hoverStyle:k.buttonHovered,icon:b.SkypeIcon.ClosedCaptionSettings,onPress:this._onPressClosedCaptionSettings,title:S.getString("CallingSettingsPanel.SubtitlesButtonLabel")})]}),"buttonIconsContainer"),(0,a.jsx)(_.VirtualMessageView,{ref:this._onListViewRef,observableList:this._itemList,renderItem:this._renderItem,onVisibleRangeChanged:this._onVisibleRangeChanged,shouldUpdateItem:this._shouldUpdateItem,contentMaxWidth:d.SubtitleMaxWidth,horizontalPadding:{left:30,right:30},useWideLayout:!1,leftSpacerWidth:0,rightSpacerWidth:0,canShowSuggestions:!1}),n]}),"subtitleHistory")}_renderJumpButton(){const e=this.props.bottomPadding||10,t=o.Styles.createViewStyle({bottom:e},!1);return(0,a.jsx)(o.View,Object.assign({style:[k.buttonJumpContainer,t]},{children:(0,a.jsx)(p.default,{style:k.buttonJump,hoverStyle:k.buttonHovered,size:M,onPress:this._onPressJump,color:f.Color.gray100,hoverColor:f.Color.white,icon:b.SkypeIcon.DownChevron,title:S.getString("CallTranscription.JumpToLast")})}),"jumpToEnd")}}t.default=R},440584:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SettingsBarSafezone=void 0;const a=i(785893),n=i(496486),o=(i(967593),i(120692),i(516778)),s=i(705465),r=i(667294),l=i(889391),c=i(994224),d=i(154090),u=i(518154),h=i(785107),p=i(861253),g=i(458666),C=i(915877),S=i(733754),m=i(581760),y=i(680837),f=i(619675),b=i(912770),_=i(438891),T=i(330124),v=i(805581),w=i(502278),I=i(853374),P=i(46929),M=i(244570),k=i(31894),A=i(677381),R=i(129273),x=i(671830),L=i(536150);t.SettingsBarSafezone=45;m.Color.black,m.Color.black,m.Color.black,m.Color.transparent,m.Color.black,m.Color.black,m.Color.black,m.Color.black,m.Color.black,m.Color.black,m.Color.black,m.Color.black,m.Color.black,m.Color.transparent;const V=(0,C.lazyProperties)({container:()=>o.Styles.createViewStyle({alignItems:"stretch",overflow:"visible"}),captionsContainer:()=>o.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"stretch"}),captionsContainerUiV2:()=>o.Styles.createViewStyle({flex:1,justifyContent:"flex-end",alignItems:"stretch",overflow:"hidden"}),scrollInsideContainer:()=>o.Styles.createViewStyle({flexGrow:0,flexShrink:1,justifyContent:"flex-end",alignItems:"stretch"}),scrollInsideContainerDesktop:()=>o.Styles.createViewStyle({flexGrow:0,flexShrink:1,justifyContent:"flex-end",alignItems:"stretch"}),preview:()=>o.Styles.createViewStyle({position:"relative",flex:1,justifyContent:"flex-end",alignItems:"stretch"}),messageContainer:()=>o.Styles.createViewStyle({position:"absolute",bottom:0,borderRadius:15,alignItems:"center",alignSelf:"center",backgroundColor:m.Color.blackOverlay70,marginLeft:15,marginRight:15}),messageText:()=>o.Styles.createTextStyle({paddingHorizontal:16,paddingVertical:5,color:m.Color.white,textAlign:"center"}),gradientStyle:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row"}),maskedView:()=>o.Styles.createViewStyle({flex:1,justifyContent:"flex-end",alignItems:"stretch"}),settingsButtonIcon:()=>o.Styles.createViewStyle({width:24,height:24}),settingsButton:()=>o.Styles.createViewStyle({position:"absolute",flexDirection:"row",top:15,right:15,justifyContent:"center",alignItems:"flex-start",alignSelf:"flex-start",opacity:.8,overflow:"visible"}),settingsPanelContainer:()=>o.Styles.createViewStyle({position:"absolute",flex:1,flexDirection:"row",alignItems:"center",alignSelf:"flex-start",overflow:"visible",left:0,right:0}),settingsButtonIconHovered:()=>o.Styles.createViewStyle({opacity:1}),settingsButtonText:()=>o.Styles.createTextStyle({marginLeft:10}),settingsPanelPart:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"center",alignItems:"center",alignSelf:"flex-start"}),jumpToBottomButton:()=>o.Styles.createViewStyle({bottom:-4,right:8})});class O extends A.default{constructor(){super(...arguments),this._prefSubscriptions=[],this._contentPreviousScrollValue=0,this._contentPreviousHeightValue=0,this._captionsStopScroll=!1,this._contentScrollRef=r.createRef(),this._jumpToEndButtonRef=r.createRef(),this._setSpokenLanguage=()=>{let e;if(this.state.isCaptioning||this.state.isSkypeTranslation?e=v.default.getCallTranslatorSpokenLanguage(this.props.conversationMri):this.state.isVoiceTranslation?e=v.default.getLocalCallTranslatorBotSubtitleLanguageLocale():this.state.isPstnTranslation&&(e=v.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(this.props.conversationMri)),e){e&&this.state.spokenLocale&&S.isRTLLanguage(e)!==S.isRTLLanguage(this.state.spokenLocale)&&this._sendConsumptionHorizon();const t=g.getShortLanguageTitle(e);this.setState({spokenLocale:e,spokenLang:t})}},this._onJumpToBottom=e=>{this._captionsStopScroll=!1,this._scrollToBottom(),this._showHideJumpToBottomButton(!0)},this._resetCaptionsScroll=()=>{this._captionsStopScroll=!1,this._contentPreviousScrollValue=0,this._contentPreviousHeightValue=0,this._scrollToBottomAnimated(!1),this._showHideJumpToBottomButton(!0)},this._onScrollViewScroll=e=>{var t,i,a,n,o,s;const r=(null===(i=null===(t=e.nativeEvent)||void 0===t?void 0:t.contentOffset)||void 0===i?void 0:i.y)||0,l=(null===(n=null===(a=e.nativeEvent)||void 0===a?void 0:a.contentSize)||void 0===n?void 0:n.height)||0,c=(null===(s=null===(o=e.nativeEvent)||void 0===o?void 0:o.layoutMeasurement)||void 0===s?void 0:s.height)||0;let d=!0;this._shouldStopAutoScrolling(r,l)?this._captionsStopScroll=!0:this._shouldStartAutoScrolling(l,c,r)?this._captionsStopScroll=!1:d=!1,this._contentPreviousHeightValue=l,this._contentPreviousScrollValue=r,d&&this._showHideJumpToBottomButton()},this._onScrollViewScrollDebounced=n.debounce(this._onScrollViewScroll,l.default.getS4LCMCFeaturesNoSubscription().callCaptionsScrolling.scrollingCallbackDebounce),this._shouldStartAutoScrolling=(e,t,i)=>this._captionsStopScroll&&this._isScrollEndReached(e,t,i),this._shouldStopAutoScrolling=(e,t)=>!this._captionsStopScroll&&this._isCaptionsScrollUp(e)&&!this._isContentHeightReduced(t)&&this._isStopScrollThresholdReached(e),this._isContentHeightReduced=e=>e<this._contentPreviousHeightValue,this._isScrollEndReached=(e,t,i)=>e-t-i<=this.state.callCaptionsScrolling.stopScrollingThreshold,this._isStopScrollThresholdReached=e=>Math.abs(e-this._contentPreviousScrollValue)>this.state.callCaptionsScrolling.stopScrollingThreshold,this._isCaptionsScrollUp=e=>e<this._contentPreviousScrollValue,this._setJumpToEndButtonVisibilityAndClearTimer=e=>{var t,i;null===(i=null===(t=this._jumpToEndButtonRef)||void 0===t?void 0:t.current)||void 0===i||i.setVisible(e),this._showButtonTimer=void 0},this._onPress=e=>{!this.props.onStageTap||this.state.isPstnTranslation&&x.isPhoneMri(this.props.conversationMri)||this.props.onStageTap(Date.now())},this._renderItem=({item:e,index:t})=>(0,a.jsx)(d.default,{transcription:e,isInterimCaptionConcatenated:this.state.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:this.state.isInterimCaptionHighlightEnabled,uiPstn:this.state.uiPstn,callParticipantCount:this.state.callParticipantCount,useLightTheme:this.props.useLightTheme&&!this.state.uiv2AlwaysBlack,captionPositionMode:this.props.captionPositionMode,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isRTL:S.isRTLLanguage(this.state.spokenLocale)},"item"+t),this._onLayout=e=>{!(0,p.default)(e,this.state.viewRect)&&this.isComponentMounted()&&this.setState({viewRect:e})},this._onPressOpenSettings=e=>{this.props.rootViewId&&c.default.CallNavigationHelper.navigateToSubtitlesCallingSettingsPanel(!1,!1,this.props.rootViewId);const t=I.default.newCauseId();w.default.onCaptionsStartingMessageClick(this.props.callId,t)}}_buildState(e,t){var i,a;const n=l.default.getS4LCMCFeatures(),o=c.default.InCallBotService.isPstnTranslationEnabled(e.callId),s=c.default.InCallBotService.isCaptioningEnabled(e.callId),r=this._getLimit(e.captionPositionMode,n,o),d=s&&n.callCaptionsMerge?u.default.getTranscriptionsMerged(e.reactionsMri,r):u.default.getTranscriptions(e.reactionsMri,r),h=this._getTimeout(e.captionPositionMode,n,o);return{hasHistory:0!==u.default.transcriptionCount(e.reactionsMri),viewRect:t?{x:0,y:0,width:0,height:0}:this.state.viewRect,isInterimCaptionConcatenated:n.isInterimCaptionConcatenated,isInterimCaptionHighlightEnabled:n.isInterimCaptionHighlightEnabled,callParticipantCount:c.default.CallingStore.connectedParticipantsCount(e.callId),uiPstn:o,uiv2AlwaysBlack:!o&&e.captionPositionMode===_.CaptionsPositionMode.float,uiv2DynWidth:!o,contentHeight:null===(i=this.state)||void 0===i?void 0:i.contentHeight,contentVisibleHeight:null===(a=this.state)||void 0===a?void 0:a.contentVisibleHeight,transcriptionsCount:u.default.transcriptionCount(e.reactionsMri),captionsClearTimeout:h,transcriptions:d,isUsingStackNavigationContext:T.default.isUsingStackNavigationContext(),isCaptioning:s,isVoiceTranslation:c.default.InCallBotService.isVoiceTranslationEnabled(e.callId),isSkypeTranslation:c.default.InCallBotService.isSkypeTranslationEnabled(e.callId),isSkypeTranslationPaused:c.default.InCallBotService.isSkypeTranslationPaused(e.callId),isPstnTranslation:o,callCaptionsScrolling:n.callCaptionsScrolling,isTranslating:c.default.InCallBotService.isTranslating(e.callId),isMobileScreenReaderEnabled:L.default.isMobileScreenReaderEnabled()}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._setSpokenLanguage(),n.isEmpty(this.state.transcriptions)||(0,p.default)(this.state.transcriptions,t.transcriptions)||(u.default.resetUnseenTranscriptionCount(this.props.reactionsMri),this._scheduleCaptionsClearTimer()),e.captionPositionMode!==this.props.captionPositionMode?this._resetCaptionsScroll():!this.state.isPstnTranslation&&this._captionsStopScroll||this._scrollToBottom(),this._startMessage()}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),u.default.assignCallId(this.props.reactionsMri,this.props.callId)}componentDidMount(){super.componentDidMount(),this._scheduleCaptionsClearTimer(),this._prefSubscriptions.push(P.default.subscribe(this._setSpokenLanguage,P.TriggerKeys.PstnTranslationSettings)),this._prefSubscriptions.push(P.default.subscribe(this._setSpokenLanguage,P.TriggerKeys.CallTranslatorBotSubtitleLanguageLocale)),this._prefSubscriptions.push(P.default.subscribe(this._setSpokenLanguage,P.TriggerKeys.CallTranslatorSpokenLanguage)),n.isEmpty(this.state.transcriptions)||this._resetCaptionsScroll()}componentWillUnmount(){super.componentWillUnmount(),this._prefSubscriptions.forEach((e=>P.default.unsubscribe(e))),this._showButtonTimer&&b.default.clearTimeout(this._showButtonTimer),this._stopCaptionsClearTimer()}_getTimeout(e,t,i){if(i)return t.pstnTranslation.captionsTimeout;switch(e){case _.CaptionsPositionMode.bottom:return t.callCaptionsBottomPanel.timeout;case _.CaptionsPositionMode.left:return t.callCaptionsLeftPanel.timeout;case _.CaptionsPositionMode.float:default:return t.callCaptionsFloatPanel.timeout}}_getLimit(e,t,i){if(i)return t.pstnTranslation.captionsLimit;let a;switch(e){case _.CaptionsPositionMode.bottom:a=t.callCaptionsBottomPanel.limit;break;case _.CaptionsPositionMode.left:a=t.callCaptionsLeftPanel.limit;break;case _.CaptionsPositionMode.float:a=t.callCaptionsFloatPanel.limit}return a>0?a:void 0}_startMessage(){!this._startMessageSub&&this.state.isPstnTranslation?this._startMessageSub=R.addStartMessage(this.props.callId,this._getMessageText()):this.state.isPstnTranslation&&this._startMessageSub&&this.state.hasHistory&&(R.removeId(this._startMessageSub),this._startMessageSub=void 0)}_showHideJumpToBottomButton(e=!1){this._showButtonTimer&&b.default.clearTimeout(this._showButtonTimer),e?this._setJumpToEndButtonVisibilityAndClearTimer(!1):this._showButtonTimer=b.default.setTimeout((()=>{const e=this._captionsStopScroll;this._setJumpToEndButtonVisibilityAndClearTimer(e)}),this.state.callCaptionsScrolling.jumpToAndButtonDisplayDelay)}_scrollToBottom(){this._scrollToBottomAnimated(this.state.callCaptionsScrolling.allowScrollingAnimation)}_scrollToBottomAnimated(e){var t,i;null===(i=null===(t=this._contentScrollRef)||void 0===t?void 0:t.current)||void 0===i||i.scrollToEnd({animated:e})}render(){return(0,a.jsxs)(o.View,Object.assign({style:[V.container,this.props.style],onLayout:this._onLayout,onPress:this._onPress},{children:[this._renderPreviewList(),this._renderMessage(),this._renderSettingsButton()]}))}_renderSettingsButton(){if(this.state.isCaptioning||this.state.isVoiceTranslation||this.state.isSkypeTranslation){if(this.props.captionPositionMode===_.CaptionsPositionMode.float){const e=o.Styles.createViewStyle({bottom:this.props.bottomPadding,marginBottom:-t.SettingsBarSafezone,justifyContent:"center"},!1);return(0,a.jsx)(o.View,Object.assign({style:[V.settingsPanelContainer,e]},{children:(0,a.jsx)(M.default,Object.assign({},this.props,{isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isMobileScreenReaderEnabled:this.state.isMobileScreenReaderEnabled,isPstnTranslation:this.state.isPstnTranslation,isVoiceTranslation:this.state.isVoiceTranslation,isSkypeTranslation:this.state.isSkypeTranslation,isSkypeTranslationPaused:this.state.isSkypeTranslationPaused,isTranslating:this.state.isTranslating,spokenLang:this.state.spokenLang,showText:!0,showBg:!0}))}),"settings")}if(this.props.captionPositionMode===_.CaptionsPositionMode.bottom||this.props.captionPositionMode===_.CaptionsPositionMode.left){const e=this.state.isUsingStackNavigationContext||this.props.captionPositionMode===_.CaptionsPositionMode.left&&this.state.isVoiceTranslation,t=this.props.captionPositionMode===_.CaptionsPositionMode.bottom,i=o.Styles.createViewStyle({top:0,justifyContent:e?"flex-end":"center"},!1);return(0,a.jsx)(o.View,Object.assign({style:[V.settingsPanelContainer,i]},{children:(0,a.jsx)(M.default,Object.assign({},this.props,{isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isMobileScreenReaderEnabled:this.state.isMobileScreenReaderEnabled,isPstnTranslation:this.state.isPstnTranslation,isVoiceTranslation:this.state.isVoiceTranslation,isSkypeTranslation:this.state.isSkypeTranslation,isSkypeTranslationPaused:this.state.isSkypeTranslationPaused,isTranslating:this.state.isTranslating,spokenLang:this.state.spokenLang,showText:t,showBg:!1}))}),"settings")}}}_getMessageText(){let e;return e=this.state.spokenLang?S.getString("CallTranscription.StartSubtitlesV2Lang",{language:this.state.spokenLang}):S.getString("CallTranscription.StartSubtitlesV2"),e}_renderMessage(){if(!this.state.hasHistory&&!this.state.isPstnTranslation&&!this.state.isSkypeTranslation){const e=(0,a.jsx)(f.BodyText,Object.assign({style:V.messageText},{children:this._getMessageText()})),t=this.state.isCaptioning||this.state.isVoiceTranslation,i=[V.messageContainer,t?y.default.pointerCursor:void 0],n=this.props.captionPositionMode===_.CaptionsPositionMode.bottom&&!this.state.isUsingStackNavigationContext;if(this.props.bottomPadding){const e=this.state.uiPstn||n?this.props.bottomPadding+15:this.props.bottomPadding;i.push(o.Styles.createViewStyle({bottom:e},!1))}return(0,a.jsx)(o.View,Object.assign({style:i,onPress:t?this._onPressOpenSettings:void 0},{children:e}),"message")}}_renderPreviewList(){const e=this.props.captionPositionMode===_.CaptionsPositionMode.bottom||this.props.captionPositionMode===_.CaptionsPositionMode.left?40:0,t=o.Styles.createViewStyle({marginLeft:0,marginRight:0,marginBottom:this.props.bottomPadding,marginTop:e},!1);V.captionsContainer;let i;{const e=100*(1-(this.state.isPstnTranslation?.25:.1)),t={maskImage:`linear-gradient(0deg, black ${e}%, transparent 100%)`,WebkitMaskImage:`linear-gradient(0deg, black ${e}%, transparent 100%)`},r=this.state.callCaptionsScrolling.allowStopScrolling?(0,a.jsx)(k.default,{ref:this._jumpToEndButtonRef,onPressCallback:this._onJumpToBottom,style:V.jumpToBottomButton},"jumpToEndButton"):void 0,l=this.state.transcriptions.map(((e,t)=>this._renderItem({item:e,index:t}))),c=this.props.captionPositionMode===_.CaptionsPositionMode.left,d=this.state.isPstnTranslation||this.props.captionPositionMode===_.CaptionsPositionMode.left;i=(0,a.jsxs)(o.View,Object.assign({style:[V.captionsContainerUiV2,n.isEmpty(this.state.transcriptions)?void 0:t]},{children:[(0,a.jsx)(o.View,Object.assign({style:V.scrollInsideContainerDesktop},{children:(0,a.jsx)(s.ScrollView,Object.assign({ref:this._contentScrollRef,style:y.default.flexOne,onScroll:c?this._onScrollViewScrollDebounced:void 0,scrollEnabled:d,removeClippedSubviews:!0,showsVerticalScrollIndicator:!1,scrollsToTop:!1},{children:l}),"captionsList-"+this.props.captionPositionMode.toString())})),r]}),"captionsContainer"+this.props.captionPositionMode.toString())}return(0,a.jsx)(o.View,Object.assign({style:[V.preview,t]},{children:i}),"subtitlePreview")}static getHorizontalPadding(e,t,i,a){let n=h.SubtitleMaxWidth;const o=l.default.getS4LCMCFeaturesNoSubscription().callCaptionsBottomPanel.captionsWidthDesktopPercentage,s=l.default.getS4LCMCFeaturesNoSubscription().callCaptionsLeftPanel.captionsWidthDesktopPercentage;n=!t&&i===_.CaptionsPositionMode.bottom&&o>0?e*o:t||i!==_.CaptionsPositionMode.float?!t&&i===_.CaptionsPositionMode.left&&s>0?e*s:h.SubtitleMaxWidthV2:h.SubtitleMaxWidthV3;let r=30;return a||i!==_.CaptionsPositionMode.left?a||i!==_.CaptionsPositionMode.float?a&&t&&i===_.CaptionsPositionMode.float&&(r=16):r=60:r=20,Math.max((e-n)/2,r)}_sendConsumptionHorizon(){var e,t;const i=null!==(t=null===(e=n.maxBy(this.state.transcriptions.map((e=>e.message)),(e=>e.createdTime)))||void 0===e?void 0:e.createdTime)&&void 0!==t?t:0;u.default.setConsumptionHorizon(this.props.reactionsMri,i+1)}_scheduleCaptionsClearTimer(){this._stopCaptionsClearTimer(),this.state.captionsClearTimeout>0&&(this._onCaptionsClearTimer=b.default.setTimeout((()=>{this._sendConsumptionHorizon(),this._onCaptionsClearTimer=void 0}),this.state.captionsClearTimeout))}_stopCaptionsClearTimer(){this._onCaptionsClearTimer&&(b.default.clearTimeout(this._onCaptionsClearTimer),this._onCaptionsClearTimer=void 0)}}t.default=O},246065:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(217041),o=i(667294),s=i(705465),r=i(281878),l=i(583367),c=i(110117),d=i(22222),u=i(953143),h=i(89808),p=i(898278),g=i(711828),C=i(480200),S=i(600212),m=i(163841),y=i(619675),f=i(680837),b=i(267824),_=i(889391),T=i(29130),v=s.StyleSheet.create({notificationGeneralContainer:{flex:1,flexShrink:0,flexDirection:"column",alignSelf:"stretch",borderWidth:1,borderRadius:16,marginHorizontal:6,marginVertical:3,padding:16},notificationPanel:{position:"absolute",top:0,flexShrink:1,flexDirection:"column"},notificationPanelDesktop:{maxWidth:440,width:"100%",alignSelf:"center"},notificationPanelMobile:{left:0,right:0,alignSelf:"stretch"},notificationIcon:{alignItems:"center",alignSelf:"center",marginRight:16},notificationDismiss:{alignItems:"center",alignSelf:"flex-start",marginLeft:16},notificationButtonWrapper:{flex:1,flexDirection:"row"},notificationButtonMobileWrapper:{flexDirection:"row"},notificationInnerContainer:{flex:1,flexDirection:"row",alignSelf:"stretch"},notificationInnerButtonsContainer:{flex:1,flexDirection:"row",alignSelf:"center"},notificationInnerButtonsContainerMargin:{marginTop:8},notificationButton:{alignItems:"center"},notificationTextWrapper:{flex:1},notificationConsentContainer:{flex:1,flexShrink:1,flexDirection:"column",alignSelf:"stretch",borderWidth:1,borderRadius:24,marginHorizontal:6,marginVertical:3,minHeight:100},notificationConsentContainerPadding:{padding:35},notificationConsentContainerPaddingMobileLandscape:{padding:10},consentTextBox:{alignSelf:"center"},consentText:{textAlign:"center"},flexDirectionColumn:{flexDirection:"column"},bulletMargin:{marginRight:5},flexShrinkZero:{flexShrink:0},overflowHidden:{overflow:"hidden"}}),w=(e,t)=>o.useCallback((()=>{null==t||t(e),u.default.removeToast(e,C.ToastActionType.ManualDismissed)}),[e,t]),I=({toastId:e})=>{const t=w(e),{secondaryTextColor:i}=(0,S.useSkypeTheme)().themeColors;return(0,a.jsx)(c.default,{icon:g.SkypeIcon.ClosePanel,size:g.IconSize.size20,color:i,onPress:t})},P=({toastId:e,title:t,action:i,marginRight:n,marginLeft:o,marginTop:s,marginBottom:r,buttonStyle:l,buttonConfig:c,innerStyle:u})=>{const h=w(e,i);return(0,a.jsx)(d.default,Object.assign({buttonStyle:l,buttonSize:p.SXButtonSize.Small,buttonConfig:c,backgroundStyle:{marginRight:n,marginLeft:o,marginBottom:r,marginTop:s},title:t,innerContainerStyle:u,style:v.notificationButton,onPress:h},{children:t}))},M=(0,n.withResubAutoSubscriptions)((({toastItem:e,callStageV2:t,useLightTheme:i})=>{var n,o,l,d,u,h,C;const{themeColors:{iconInteractive:b}}=(0,S.useSkypeTheme)(),_=t&&i?m.Theme.Delphi:m.Theme.DelphiDark,{primaryBackgroundColor:T,secondaryBackgroundColor:w,secondaryTextColor:M}=S.default.themeColorsForTheme(_),k=S.default.themeStylesForTheme(_).primaryTextColorStyle,A=e.state,R=A.icon?(0,a.jsx)(r.Box,Object.assign({style:v.notificationIcon},{children:(0,a.jsx)(c.default,{icon:A.icon,size:g.IconSize.size20,color:A.iconColorOverride?A.iconColorOverride:b})})):void 0,x=A.dismissable?(0,a.jsx)(r.Box,Object.assign({style:v.notificationDismiss},{children:(0,a.jsx)(I,{toastId:e.id})})):void 0,L=(null===(n=A.buttons)||void 0===n?void 0:n[0])?(0,a.jsx)(P,{toastId:e.id,title:null===(o=A.buttons)||void 0===o?void 0:o[0].label,action:null===(l=A.buttons)||void 0===l?void 0:l[0].action,buttonStyle:p.SXButtonStyle.GradientFill,marginRight:(null===(d=A.buttons)||void 0===d?void 0:d.length)>1?8:0}):void 0,V=(null===(u=A.buttons)||void 0===u?void 0:u[1])?(0,a.jsx)(P,{toastId:e.id,title:null===(h=A.buttons)||void 0===h?void 0:h[1].label,action:null===(C=A.buttons)||void 0===C?void 0:C[1].action,buttonStyle:p.SXButtonStyle.ColorStroke,buttonConfig:{textColor:M,borderColor:M},marginLeft:8}):void 0,O=L||V?(0,a.jsxs)(r.Box,Object.assign({style:v.notificationButtonWrapper},{children:[L,V]})):void 0;return(0,a.jsxs)(r.Box,Object.assign({style:v.notificationGeneralContainer,backgroundColor:w,borderColor:T,accessibilityRole:"alert",accessibilityLabel:A.text,importantForAccessibility:"auto"},{children:[(0,a.jsxs)(r.Box,Object.assign({style:v.notificationInnerContainer},{children:[R,(0,a.jsx)(r.Box,Object.assign({style:v.notificationTextWrapper,importantForAccessibility:"no"},{children:(0,a.jsx)(y.BodyText,Object.assign({style:s.StyleSheet.flatten([f.default.flexOne,k])},{children:A.text}))})),x]})),(0,a.jsx)(r.Box,Object.assign({style:[v.notificationInnerButtonsContainer,L||V?v.notificationInnerButtonsContainerMargin:void 0]},{children:O}))]}),"CaptionsGenericToast"+e.id)})),k=(0,n.withResubAutoSubscriptions)((({toastItem:e,consentSameButton:t,callStageV2:i,useLightTheme:n,isMobileLandscape:o})=>{var l,d,u,C,_,T;const w=i&&n?m.Theme.Delphi:m.Theme.DelphiDark,{primaryBackgroundColor:I,secondaryBackgroundColor:M,secondaryTextColor:k}=S.default.themeColorsForTheme(w),A=h.default.getPrimaryColor(),R=S.default.themeStylesForTheme(w).primaryTextColorStyle,x=e.state,L=s.StyleSheet.flatten([v.notificationInnerContainer,v.consentTextBox]),V=s.StyleSheet.flatten([f.default.flexOne,f.default.textAlignCenter]),O=s.StyleSheet.flatten([V,R]);let B,D=4;o&&(D=2);const E=o?void 0:(0,a.jsx)(r.Box,Object.assign({style:L},{children:(0,a.jsx)(c.default,{icon:x.icon,size:g.IconSize.size20,color:A})})),N=x.text?(0,a.jsx)(r.Box,Object.assign({style:L,paddingTop:D},{children:(0,a.jsx)(y.Caption,Object.assign({style:V},{children:x.text}))})):void 0,F=x.subtitle?(0,a.jsx)(r.Box,Object.assign({style:L,paddingTop:D},{children:(0,a.jsx)(y.BodyText,Object.assign({bold:!0,style:O},{children:x.subtitle}))})):void 0;let j;if(x.subtext){const e=x.subtext.map((e=>(0,a.jsxs)(r.Box,Object.assign({flexDirection:"row"},{children:[(0,a.jsx)(y.Caption,Object.assign({style:v.bulletMargin},{children:"• "})),(0,a.jsx)(y.Caption,Object.assign({style:[f.default.flexOne]},{children:e}))]}))));j=(0,a.jsx)(r.Box,Object.assign({style:[v.notificationInnerContainer,v.consentTextBox,v.flexDirectionColumn],paddingTop:D,paddingLeft:B,paddingRight:B},{children:e}))}const U=x.link?(0,a.jsx)(r.Box,Object.assign({style:L,paddingTop:D,color:A},{children:(0,a.jsx)(y.Caption,Object.assign({style:V},{children:(0,a.jsx)(b.AccessibleLink,Object.assign({url:x.link.url,textElement:y.Caption},{children:x.link.text}))}))})):void 0;let H;if(x.buttons&&x.buttons.length>0){const i=(null===(l=x.buttons)||void 0===l?void 0:l[0])?(0,a.jsx)(P,{toastId:e.id,title:null===(d=x.buttons)||void 0===d?void 0:d[0].label,action:null===(u=x.buttons)||void 0===u?void 0:u[0].action,buttonStyle:p.SXButtonStyle.GradientFill,innerStyle:{},marginBottom:o?void 0:8,marginRight:o?8:void 0}):void 0,n=t?void 0:{textColor:k,borderColor:k},c=(null===(C=x.buttons)||void 0===C?void 0:C[1])?(0,a.jsx)(P,{toastId:e.id,title:null===(_=x.buttons)||void 0===_?void 0:_[1].label,action:null===(T=x.buttons)||void 0===T?void 0:T[1].action,buttonStyle:p.SXButtonStyle.ColorStroke,buttonConfig:n,innerStyle:{}}):void 0;H=o?(0,a.jsx)(r.Box,Object.assign({style:s.StyleSheet.flatten([v.notificationInnerButtonsContainer,v.flexShrinkZero]),paddingTop:D},{children:(0,a.jsxs)(r.Box,Object.assign({style:s.StyleSheet.flatten([v.notificationButtonWrapper])},{children:[i,c]}))})):(0,a.jsxs)(r.Box,Object.assign({style:s.StyleSheet.flatten([v.notificationInnerContainer,v.flexDirectionColumn,v.flexShrinkZero]),paddingTop:D},{children:[i,c]}))}const z=s.StyleSheet.flatten([v.notificationConsentContainer,v.overflowHidden,o?v.notificationConsentContainerPaddingMobileLandscape:v.notificationConsentContainerPadding]);return(0,a.jsxs)(r.Box,Object.assign({style:z,backgroundColor:M,borderColor:I,accessibilityRole:"alert",accessibilityLabel:x.title,importantForAccessibility:"auto"},{children:[(0,a.jsxs)(s.ScrollView,Object.assign({style:v.flexDirectionColumn,importantForAccessibility:"no"},{children:[E,(0,a.jsx)(r.Box,Object.assign({style:L,paddingTop:D},{children:(0,a.jsx)(y.Header,Object.assign({size:p.HeaderSize.h4,style:O},{children:x.title}))})),N,F,j,U]})),H]}),"CaptionsGenericConsentNotification"+e.id)}));var A;t.default=(A=({notifications:e,consentSameButtons:t,isUsingStackNavigationContext:i,callStageV2:n,useLightTheme:s,paddingTop:l,maxHeight:c,isMobileLandscape:d,headerHeight:h})=>{const p=o.useMemo((()=>((e,t,i,n,o)=>e.reverse().map((e=>e.type===u.ToastType.CaptionsTranslationConsent||e.type===u.ToastType.CaptionsTruVoiceConsent||e.type===u.ToastType.CaptionsTranslationConsentRequest||e.type===u.ToastType.CaptionsTruVoiceConsentRequest?(0,a.jsx)(k,{toastItem:e,consentSameButton:t,callStageV2:i,useLightTheme:n,isMobileLandscape:o},"ConsentNotification"+e.id):(0,a.jsx)(M,{toastItem:e,callStageV2:i,useLightTheme:n},"GenericNotification"+e.id))))(e,t,!!n,!!s,d)),[e,t,n,s,d]),g=[v.notificationPanel,i?v.notificationPanelMobile:v.notificationPanelDesktop],C=(c=c&&h?c-h:c)?`${c}px`:void 0;return(0,a.jsx)(r.Box,Object.assign({style:g,paddingTop:l+"px",maxHeight:C},{children:p}))},class extends n.ComponentBase{_buildState(e){const t=T.default.getDeviceOrientation(e.rootViewId)===l.DeviceOrientation.Landscape,i=e.isUsingStackNavigationContext&&t;return{notifications:u.default.getToasts(e.rootViewId,u.ToastCategory.Captions,e.callId),consentSameButtons:_.default.getS4LCMCFeatures().translationFeatures.consentButtonsSameColor,isLandscape:t,isMobileLandscape:i}}render(){return(0,a.jsx)(A,Object.assign({},this.props,{notifications:this.state.notifications,consentSameButtons:this.state.consentSameButtons,isMobileLandscape:this.state.isMobileLandscape}))}})},244570:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useAlertForDesktop=t.getMenuButtons=void 0;const a=i(785893),n=i(217041),o=i(516778),s=i(667294),r=i(889391),l=i(994224),c=i(913944),d=i(458666),u=i(915877),h=i(733754),p=i(581760),g=i(711828),C=i(438891),S=i(805581),m=i(46929),y=i(436237),f=i(293194),b=i(746096),_=i(853374),T=i(502278),v=i(193439),w=i(258187),I=i(962484),P=i(104735),M=(0,u.lazyProperties)({settingsIcon20:()=>o.Styles.createViewStyle({width:20,height:20}),settingsIcon16:()=>o.Styles.createViewStyle({width:16,height:16}),settingsButton20:()=>o.Styles.createViewStyle({width:30,height:40}),settingsButton16:()=>o.Styles.createViewStyle({width:24,height:32}),settingsIconMarginLeft:()=>o.Styles.createViewStyle({marginLeft:5}),settingsPanel:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",alignSelf:"flex-start",borderRadius:8,flexShrink:1}),settingsPanelPadding:()=>o.Styles.createViewStyle({paddingHorizontal:10}),settingsOpacity:()=>o.Styles.createViewStyle({opacity:.35}),settingsIcons20Paddings:()=>o.Styles.createViewStyle({paddingBottom:10,paddingTop:10,paddingLeft:5,paddingRight:5}),settingsIcons16Paddings:()=>o.Styles.createViewStyle({paddingBottom:8,paddingTop:8,paddingLeft:4,paddingRight:4}),settingsIcons20Margins:()=>o.Styles.createViewStyle({marginBottom:10,marginTop:10,marginLeft:5,marginRight:5}),settingsIcons16Margins:()=>o.Styles.createViewStyle({marginBottom:8,marginTop:8,marginLeft:4,marginRight:4}),settingsDivider:()=>o.Styles.createViewStyle({height:20,width:1}),settingsButtonIconHovered:()=>o.Styles.createViewStyle({opacity:1}),settingsButtonText:()=>o.Styles.createTextStyle({marginLeft:10}),settingsPanelPart:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",alignItems:"center",alignSelf:"flex-start"}),settingsLangButton:()=>o.Styles.createViewStyle({flex:1,maxWidth:150}),settingsLangText:()=>o.Styles.createViewStyle({flexGrow:1,maxWidth:130,minWidth:30,flexShrink:1}),justifyContentCenter:()=>o.Styles.createViewStyle({justifyContent:"center"}),menuPadding:()=>o.Styles.createViewStyle({paddingHorizontal:16})}),k=e=>d.getShortLanguageTitle(e)||e;t.getMenuButtons=e=>{const t=h.getLanguageFromLocale();return[...e].sort(((e,i)=>{const a=k(e),n=k(i);return a.localeCompare(n,t)})).map((e=>({text:k(e),command:e})))};t.useAlertForDesktop=()=>!0;t.default=(0,n.withResubAutoSubscriptions)((({callId:e,conversationMri:i,useLightTheme:n,isUsingStackNavigationContext:d,isMobileScreenReaderEnabled:u,isTranslating:k,isPstnTranslation:A,isVoiceTranslation:R,isSkypeTranslation:x,isSkypeTranslationPaused:L,captionPositionMode:V,spokenLang:O,rootViewId:B,callUIState:D,isPstnCall:E,showText:N,showBg:F})=>{const[j,U]=(0,s.useState)(!1),H=r.default.getS4LCMCFeatures().callTranslatorBotConfig.languageSupport.speech,z=(0,s.useMemo)((()=>(0,t.getMenuButtons)([...H])),[H]),G=!A&&V===C.CaptionsPositionMode.float,W=(0,w.useCommonContext)(),K=(0,s.useRef)(null),$=()=>{const t=_.default.newCauseId();k?l.default.InCallBotService.stopSkypeTranslationConsent(e,t):l.default.InCallBotService.startSkypeTranslationConsent(e,t)},q=t=>{l.default.InCallBotService.refreshConfig(e,t)},Q=()=>{const a={causeId:_.default.newCauseId(),rootViewId:B,callId:e,conversationMri:i,anchor:()=>(null==K?void 0:K.current)||void 0,isUsingStackNavigationContext:d,isMobileScreenReaderEnabled:u,useLightTheme:n,isPstnCall:E,callerContext:()=>W,callUIState:D,menuComponentStyle:M.menuPadding,update:q,useAlertForDesktop:t.useAlertForDesktop,changeLanguage:X,startTranslation:$,isPstnTranslation:!1,isSkypeTranslation:!0};(0,v.showTranslationMenu)(a)};x&&I.default.setUpMenu(Q);const X=(e,t,a)=>{H.includes(t)?S.default.setCallTranslatorSpokenLanguage(i,t):y.log(b.LogTraceArea.CallingUI,`_toggleCaptionsLanguageMenu newLocale ${t} not in supported langs list. causeId: ${a}`)},Z=t=>i=>{if(i.stopPropagation(),V!==t){const i=_.default.newCauseId();m.default.setCallTranslatorCaptionsPositionMode(t),T.default.onCaptionPositionModeChanged(e,t,i)}},J=d,Y=n&&!G?p.Color.blackOverlay80:p.Color.gray50;let ee;F&&(ee=p.Color.blackOverlay80,ee=n&&!G?p.Color.whiteOverlay80:p.Color.gray600);const te=V===C.CaptionsPositionMode.left?14:16,ie=V===C.CaptionsPositionMode.left?g.IconSize.size16:g.IconSize.size20,ae=V===C.CaptionsPositionMode.left?M.settingsIcon16:M.settingsIcon20,ne=V===C.CaptionsPositionMode.left?M.settingsButton16:M.settingsButton20,oe=V===C.CaptionsPositionMode.left?M.settingsIcons16Paddings:M.settingsIcons20Paddings,se=V===C.CaptionsPositionMode.left?M.settingsIcons16Margins:M.settingsIcons20Margins,re=M.justifyContentCenter,le=o.Styles.createViewStyle({backgroundColor:ee},!1),ce=o.Styles.createTextStyle({color:Y,fontSize:te},!1),de=o.Styles.createViewStyle({backgroundColor:Y},!1);let ue;V!==C.CaptionsPositionMode.left||R||(ue=1);const he=o.Styles.createViewStyle({flexGrow:ue},!1),pe=h.getString("CallControls.LiveCaptions"),ge=O,Ce=pe+", "+(ge?h.getString("CaptionsSettings.LanguageSelectedAccessibility",{language:null!=ge?ge:""}):h.getString("CaptionsSettings.SelectLanguageAccessibility")),Se=[o.Types.AccessibilityTrait.Button,o.Types.AccessibilityTrait.Selected],me=[o.Types.AccessibilityTrait.Button],ye=pe+", "+h.getString("CaptionsSettings.ShowFloat"),fe=!V||V===C.CaptionsPositionMode.float,be=fe?Se:me,_e=pe+", "+h.getString("CaptionsSettings.ShowOnBottom"),Te=V===C.CaptionsPositionMode.bottom,ve=Te?Se:me,we=pe+", "+h.getString("CaptionsSettings.ShowOnLeft"),Ie=V===C.CaptionsPositionMode.left,Pe=Ie?Se:me,Me=pe+", "+h.getString("LanguageAndTranslationSettingsPanel.TranslationPause"),ke=h.getString("CaptionsSettings.CaptionsSettingsSettingsText"),Ae=pe+", "+ke,Re=N?(0,a.jsx)(o.Text,Object.assign({style:[se,ce]},{children:h.getString("CaptionsSettings.CaptionsSettingsViewText")+": "}),"viewLabel"):void 0,xe=R?void 0:[(0,a.jsxs)(o.Button,Object.assign({style:o.Styles.combine([se,M.settingsPanelPart,M.settingsLangButton]),onPress:r.default.getS4LCMCFeaturesNoSubscription().enableNewLanguageSelectors?()=>{P.default.navigateToSpokenLanguagePicker(!1,B,!1,i,X)}:e=>{e.stopPropagation();const i=_.default.newCauseId();y.log(b.LogTraceArea.CallingUI,`_toggleCaptionsLanguageMenu causeId: ${i}`);const a=h.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguageTitle"),n={anchor:()=>{},buttons:z,title:a};f.default.showWithActionMenuConfig({options:n,callback:e=>X(!0,e,i),maintainAnchor:!1,rootViewId:B,useAlertForMobile:!0,useAlertForDesktop:(0,t.useAlertForDesktop)(),invokingEvent:void 0,allowScrolling:(0,t.useAlertForDesktop)()})},title:Ce,accessibilityLabel:Ce,accessibilityTraits:o.Types.AccessibilityTrait.Button,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,tabIndex:0},{children:[(0,a.jsx)(o.Text,Object.assign({style:[ce,M.settingsLangText,{textOverflow:"ellipsis",overflowWrap:"normal"}],numberOfLines:1},{children:O}),"langLabel"),(0,a.jsx)(c.default,{style:[ae,M.settingsIconMarginLeft],size:ie,color:Y,icon:g.SkypeIcon.DownChevron,title:ke},"langIcon")]}),"captionsSettingslangButton"),(0,a.jsx)(o.View,{style:[M.settingsDivider,se,de]})],Le=(0,a.jsx)(o.Button,Object.assign({style:[ne,oe],onPress:Z(C.CaptionsPositionMode.float),title:ye,accessibilityLabel:ye,accessibilityTraits:be,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,tabIndex:0},{children:(0,a.jsx)(c.default,{style:[ae],size:ie,color:fe?p.Color.blueLight:Y,icon:g.SkypeIcon.PanelFloatingFilled})}),"captionsSettingsFloatMode"),Ve=(0,a.jsx)(o.Button,Object.assign({style:[ne,oe],onPress:Z(C.CaptionsPositionMode.bottom),title:_e,accessibilityLabel:_e,accessibilityTraits:ve,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,tabIndex:0},{children:(0,a.jsx)(c.default,{style:[ae],size:ie,color:Te?p.Color.blueLight:Y,icon:g.SkypeIcon.PanelBottomFilled})}),"captionsSettingsBottomMode"),Oe=(0,a.jsx)(o.Button,Object.assign({style:[ne,oe],onPress:Z(C.CaptionsPositionMode.left),title:we,accessibilityLabel:we,accessibilityTraits:Pe,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,tabIndex:0},{children:(0,a.jsx)(c.default,{style:[ae],size:ie,color:Ie?p.Color.blueLight:Y,icon:g.SkypeIcon.PanelLeftFilled})}),"captionsSettingsLeftMode"),Be=(0,a.jsx)(o.View,{style:[M.settingsDivider,se,de]}),De=J?[Re,Le,Ve,Be]:[Re,Le,Oe,Ve,Be],Ee=x?(0,a.jsx)(o.Button,Object.assign({style:[ne,oe],onPress:t=>{if(x){const t=_.default.newCauseId();l.default.InCallBotService.setSkypeTranslationPause(e,!L,t)}},title:Me,accessibilityLabel:Me,accessibilityTraits:o.Types.AccessibilityTrait.Button,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,tabIndex:0},{children:(0,a.jsx)(c.default,{style:[ae],size:ie,color:L?p.Color.blueLight:Y,icon:g.SkypeIcon.Pause})}),"captionsPauseButton"):void 0,Ne=[M.settingsPanel,undefined,le,he,re];return V===C.CaptionsPositionMode.float&&Ne.push(M.settingsPanelPadding),(0,a.jsxs)(o.View,Object.assign({ref:K,style:o.Styles.combine(Ne),onMouseEnter:()=>U(!0),onMouseLeave:()=>U(!1)},{children:[xe,De,Ee,(0,a.jsx)(o.Button,Object.assign({style:[ne,oe],onPress:e=>{R?l.default.CallNavigationHelper.navigateToTranslationSettingsPanel(!1,B):x?Q():l.default.CallNavigationHelper.navigateToSubtitlesCallingSettingsPanel(!1,!0,B)},title:Ae,accessibilityLabel:Ae,accessibilityTraits:o.Types.AccessibilityTrait.Button,importantForAccessibility:o.Types.ImportantForAccessibility.Yes,tabIndex:0},{children:(0,a.jsx)(c.default,{style:[ae],size:ie,color:Y,icon:g.SkypeIcon.Settings})}),"captionsSettingsButton")]}))}))},843355:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallTransientStateViewType=void 0;const a=i(785893),n=(i(560464),i(516778)),o=i(217041),s=i(110117),r=i(915877),l=i(581760),c=i(711828),d=i(680837),u=i(619675);var h;!function(e){e[e.Hold=0]="Hold",e[e.Reconnect=1]="Reconnect"}(h=t.CallTransientStateViewType||(t.CallTransientStateViewType={}));const p=(0,r.lazyProperties)({container:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),innerContainer:()=>n.Styles.createViewStyle({height:160,width:160,borderRadius:10,paddingHorizontal:20,alignItems:"center",justifyContent:"center",backgroundColor:l.Color.blackOverlay50}),innerContainerIOS:()=>n.Styles.createViewStyle({backgroundColor:l.Color.transparent}),messageHeaderText:()=>n.Styles.createTextStyle({color:l.Color.white,textAlign:"center",backgroundColor:l.Color.transparent,marginTop:8}),messageText:()=>n.Styles.createTextStyle({color:l.Color.white,textAlign:"center",backgroundColor:l.Color.transparent,marginTop:4})});class g extends o.ComponentBase{constructor(){super(...arguments),this._opacityAnimationValue=new n.Animated.Value(0),this._opacityAnimationStyle=n.Styles.createAnimatedViewStyle({opacity:this._opacityAnimationValue})}componentDidMount(){super.componentDidMount(),n.Animated.timing(this._opacityAnimationValue,{duration:200,toValue:1,easing:n.Animated.Easing.Linear()}).start()}render(){const e=[d.default.absoluteFill,p.container,this._opacityAnimationStyle];this.props.style&&e.push(this.props.style);const t=[p.innerContainer,void 0],i=this.props.body?(0,a.jsx)(u.BodyText,Object.assign({style:p.messageText,allowFontScaling:!1},{children:this.props.body})):void 0,o=this.props.type===h.Reconnect?c.SkypeIcon.Connecting:c.SkypeIcon.Pause;let r=(0,a.jsxs)(n.View,Object.assign({style:t},{children:[undefined,(0,a.jsx)(s.default,{icon:o,size:c.IconSize.default,color:l.Color.white}),(0,a.jsx)(u.RowTitle,Object.assign({style:p.messageHeaderText,allowFontScaling:!1},{children:this.props.header})),i]}));return this.props.onPress&&(r=(0,a.jsx)(n.Button,Object.assign({onPress:this.props.onPress},{children:r}))),(0,a.jsx)(n.Animated.View,Object.assign({style:e,blockPointerEvents:this.props.blockPointerEvents,ignorePointerEvents:this.props.ignorePointerEvents},{children:r}))}}t.default=g},499342:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallTrayView=void 0;const a=i(785893),n=i(496486),o=i(516778),s=i(994224),r=i(537103),l=i(480200),c=i(915877),d=i(581760),u=i(680837),h=i(24576),p=i(706250),g=i(334548),C=i(454704),S=i(156018),m=i(471727),y=i(889391),f=(0,c.lazyProperties)({reactionsView:()=>u.default.absoluteFill,participantVideoContainer:()=>o.Styles.createViewStyle({width:l.BigTrayCallParticipantMainAxisSize.video,flexGrow:0,flexShrink:0}),participantAudioContainer:()=>o.Styles.createViewStyle({width:l.BigTrayCallParticipantMainAxisSize.audio,flexGrow:0,flexShrink:0}),trayContainer:()=>o.Styles.createViewStyle({position:"absolute",top:l.DesktopNewHeaderHeight,left:0,right:0,backgroundColor:d.Color.transparent,flex:1,flexDirection:"row-reverse",alignSelf:"center",justifyContent:"space-between",borderBottomWidth:8,borderLeftWidth:8,borderRightWidth:8,borderColor:d.Color.transparent,height:l.DesktopTopTrayHeight,alignItems:"stretch"}),trayContainerMobile:()=>o.Styles.createViewStyle({borderBottomWidth:0,borderLeftWidth:0,borderRightWidth:0,top:0}),trayContainerVertical:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column-reverse",justifyContent:"space-between",backgroundColor:d.Color.transparent,alignItems:"stretch"}),participantsContainer:()=>o.Styles.createViewStyle({flexDirection:"row-reverse",justifyContent:"flex-start",alignSelf:"stretch",flexBasis:0,flexGrow:1}),participantsContainerVertical:()=>o.Styles.createViewStyle({flexDirection:"column-reverse"}),presenterContainer:()=>o.Styles.createViewStyle({flexGrow:0,flexShrink:0,alignSelf:"stretch",flexDirection:"row"}),presenterContainerVertical:()=>o.Styles.createViewStyle({flexDirection:"column"}),participantBackgroundStyle:()=>o.Styles.createViewStyle({backgroundColor:d.Color.callStageLight}),participantBackgroundStyleLightTheme:()=>o.Styles.createViewStyle({backgroundColor:d.Color.gray100Overlay80})});class b extends h.default{constructor(){super(...arguments),this._mountedRefsMap=new p.default,this._onTrayTapBinder=(e,t)=>this.props.onTrayTap&&this.props.onTrayTap(t),this._videoParticipantLayoutController={getStyles:()=>[f.participantVideoContainer],getInnerStyles:()=>[u.default.flexOne],getBackgroundColorStyle:e=>e?f.participantBackgroundStyleLightTheme:f.participantBackgroundStyle,getVideoBorderColorStyle:e=>e?f.participantBackgroundStyleLightTheme:f.participantBackgroundStyle,isHidden:()=>!1},this._audioParticipantLayoutController={getStyles:()=>[f.participantAudioContainer],getInnerStyles:()=>[u.default.flexOne],getBackgroundColorStyle:e=>e?f.participantBackgroundStyleLightTheme:f.participantBackgroundStyle,getVideoBorderColorStyle:e=>e?f.participantBackgroundStyleLightTheme:f.participantBackgroundStyle,isHidden:()=>!1},this._audioParticipantLayoutControllerMobile=Object.assign(Object.assign({},this._audioParticipantLayoutController),{getStyles:()=>[f.participantAudioContainer,this._getParticipantSizeStyle()]}),this._videoParticipantLayoutControllerMobile=Object.assign(Object.assign({},this._audioParticipantLayoutControllerMobile),{getStyles:(e,t,i)=>{const{showTrayVertically:a=!1}=this.props,n=i===l.CallStageElementKeys.localUserKey;return[u.default.flexOne,f.participantAudioContainer,this._getParticipantSizeStyle(),n&&!a?this._getRatioStyleByVideoSize(t):void 0]}}),this._layoutController=(e,t,i)=>i?this._videoParticipantLayoutController:this._audioParticipantLayoutController,this._layoutControllerMobile=(e,t,i)=>i?this._videoParticipantLayoutControllerMobile:this._audioParticipantLayoutControllerMobile,this._getCallParticipantAccesoryPosition=()=>this.props.participantsAccessoryPosition?this.props.participantsAccessoryPosition:this.state.newCallScreenEnabledByDefault&&this.props.useMobileControls?l.CallAccessoryPosition.BottomRightSmallPadding:void 0,this._onViewRef=e=>{this._parentViewRef=e||void 0},this._getParentRefForReactions=()=>this._parentViewRef,this._getChildRefForReactions=e=>this._mountedRefsMap.ref(e),this._onTrayLayout=e=>{if(this.isComponentMounted()){const t=this.props.showTrayVertically?e.height:e.width;S.default.setTrayParameters(this.props.callId,t,this.props.traySizeMultiplier,this.props.showTrayVertically)}},this._onTrayLayoutDebounced=n.debounce(this._onTrayLayout,150)}_getRatioStyleByVideoSize(e){const{traySizeMultiplier:t=1}=this.props,i=e&&e.height?e.width/e.height:1;return{width:Math.round(l.BigTrayCallParticipantMainAxisSize.audio*t*i)}}_getParticipantSizeStyle(){const{traySizeMultiplier:e=1,showTrayVertically:t=!1}=this.props,i=l.BigTrayCallParticipantMainAxisSize.audio*e;return t?o.Styles.createViewStyle({width:i,height:i},!1):o.Styles.createViewStyle({width:i},!1)}_buildState(e,t){const i=S.default.getTrayElements(e.callId),a=m.default.isInIncomingScreenshareMode(e.stageMode)?s.default.CallScreenShareStore.getPresenter(e.callId):void 0,o=n.compact(n.without(i,a)),r=y.default.getS4LCMCFeatures().newCallScreenEnabledByDefault;return{presenter:a,nonPresentingParticipants:o,hiddenParticipantsNumber:S.default.getTrayRemainder(e.callId),newCallScreenEnabledByDefault:r}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i)}_renderTrayParticipant(e){var t;const{traySizeMultiplier:i=1}=this.props;return(0,a.jsx)(r.CallParticipantView,{ref:t=>this._onParticipantViewRef(t,e),callId:this.props.callId,conversationMri:this.props.conversationMri,nametagPosition:{offset:0},renderKey:e,isGroupCall:!this.props.isOneOnOneConversation,iconOpacity:1,nametagOpacityStyle:this.props.callParticipantTooltipStyle,parentViewId:"CallTrayView#TrayView",onCallParticipantContextMenuOpened:this.props.onCallParticipantContextMenuOpened,onCallParticipantContextMenuDismissed:this.props.onCallParticipantContextMenuDismissed,hideNameTag:this.props.hideNameTag||i<1,useDarkBackground:!0,desktopNameTag:!0,isCallStageV2:!0,useLightTheme:this.props.useLightTheme,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,layoutController:this.state.newCallScreenEnabledByDefault&&this.props.useMobileControls||1!==i||this.props.showTrayVertically?this._layoutControllerMobile:this._layoutController,iconSize:l.BigTrayCallParticipantAvatarSize*i,forceCompactReactions:null!==(t=this.props.showCompactReactions)&&void 0!==t?t:i<1,isInTray:!0,borderRadius:2,videoBorderRadius:2,onTap:this._onTrayTapBinder,accessoryPosition:this._getCallParticipantAccesoryPosition()},e)}_onParticipantViewRef(e,t){this._mountedRefsMap.onComponentRef(t).call(this,e)}_renderPresenterPart(){return this.state.presenter?(0,a.jsx)(o.View,Object.assign({style:this._getPresenterContainerStyle()},{children:this._renderTrayParticipant(this.state.presenter)}),"presenter"):void 0}_renderNonPresentingParticipants(){const e=n.map(this.state.nonPresentingParticipants,(e=>this._renderTrayParticipant(e)));return(0,a.jsxs)(o.View,Object.assign({style:this._getParticipantsContainerStyle()},{children:[e,(0,a.jsx)(C.TrayOverflowButton,{hiddenParticipantsNumber:this.state.hiddenParticipantsNumber,onOverflowButtonPress:this.props.onOverflowButtonPress,useLightTheme:this.props.useLightTheme,buttonSizeMultiplier:this.props.traySizeMultiplier,showTrayVertically:this.props.showTrayVertically})]}),"nonPresenters")}_renderTray(){const e=[this.props.showTrayVertically?f.trayContainerVertical:f.trayContainer,this._getMobileContainerStyle(),this._getContainerSizeStyle(),this.props.style];return(0,a.jsxs)(o.View,Object.assign({ref:this._onViewRef,style:e,onLayout:this._onTrayLayoutDebounced},{children:[this._renderNonPresentingParticipants(),this._renderPresenterPart()]}),"callTray")}_getMobileContainerStyle(){return this.props.useMobileControls?f.trayContainerMobile:void 0}_getContainerSizeStyle(){const{traySizeMultiplier:e=1,showTrayVertically:t=!1}=this.props;return 1===e||t?void 0:o.Styles.createViewStyle({height:l.DesktopTopTrayHeight*e},!1)}_renderReactionView(){return(0,a.jsx)(g.NewCallReactionsView,{reactionsConversationId:this.props.reactionsConversationId,parentDimensions:this.props.viewRect,getChildRef:this._getChildRefForReactions,getParentRef:this._getParentRefForReactions,onTextReactionPressed:this.props.onTextReactionPressed,disableReactions:this.props.disableReactions,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper},"reactionView")}_getPresenterContainerStyle(){return[f.presenterContainer,...this.props.showTrayVertically?[f.presenterContainerVertical]:[]]}_getParticipantsContainerStyle(){return[f.participantsContainer,...this.props.showTrayVertically?[f.participantsContainerVertical]:[]]}render(){return[this._renderTray(),this._renderReactionView()]}}t.CallTrayView=b},389324:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(480200),s=i(898278),r=i(913944),l=i(915877),c=i(733754),d=i(330124),u=i(364956),h=i(581760),p=i(711828),g=i(478262),C=i(619675),S=i(24576),m=i(267824),y=i(711930),f=(i(680837),i(590602)),b=i(374049),_=p.IconSize.size20,T=s.CompositeNotificationToastInfo.horizontal,v=(0,l.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:T,paddingVertical:s.CompositeNotificationToastInfo.vertical}),containerStack:()=>n.Styles.createViewStyle({backgroundColor:h.Color.transparent}),containerComposite:()=>n.Styles.createViewStyle({backgroundColor:h.Color.transparent,paddingRight:20}),textContainerComposite:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingHorizontal:10,alignItems:"center"}),textComposite:()=>n.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word"}),buttonTextComposite:()=>n.Styles.createTextStyle({marginLeft:4}),blueText:()=>n.Styles.createTextStyle({color:h.Color.sxBlue})});class w extends S.default{constructor(){super(...arguments),this._onLearnMorePress=()=>{u.default.showDeniedPromptWithSettingsOption(g.PermissionType.Camera,this._getRootViewId())},this._onClosePress=()=>{this.props.closeToast(o.ToastActionType.ManualDismissed)},this._onLayout=e=>{e.width!==this.state.containerWidth&&this.setState({containerWidth:e.width})}}_buildState(e,t){const i={isUsingStackNavigationContext:d.default.isUsingStackNavigationContext()};return t&&(i.containerWidth=0),i}render(){let e,t;const i=[this._themeStyles.primaryTextColorStyle],o=[this._useAccessibleTheme()?this._themeStyles.primaryTextColorStyle:v.blueText];this.state.isUsingStackNavigationContext?(e=n.Styles.createViewStyle({maxWidth:this.state.containerWidth-_-T-4},!1),t=v.containerStack,i.push(b.CommonToastStyles.titleStyle),o.push(b.CommonToastStyles.titleStyle)):(e=v.textContainerComposite,t=v.containerComposite,i.push(v.textComposite),o.push(v.textComposite,v.buttonTextComposite));const s=c.getString("AudioVideoSettings.LearnMore"),l=y.default.linkAccessibilityInfo(s);return(0,a.jsxs)(n.View,Object.assign({style:[v.container,t],onLayout:this._onLayout},{children:[(0,a.jsxs)(n.View,Object.assign({style:e},{children:[(0,a.jsx)(C.BodyText,Object.assign({style:i,bold:!1},{children:c.getString("AudioVideoSettings.CameraDeniedBannerSuggestion")})),(0,a.jsx)(n.View,Object.assign({accessibilityLabel:l.label,accessibilityTraits:l.traits,importantForAccessibility:void 0,style:o,onPress:void 0},{children:(0,a.jsx)(C.Caption,Object.assign({style:f.default.subtitleMediumSemiLarge},{children:this._getPrivacyLink(s)}))}))]})),(0,a.jsx)(r.default,{icon:p.SkypeIcon.ClosePanel,size:_,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,title:c.getString("Global.CloseButtonTitle"),onPress:this._onClosePress})]}))}_getPrivacyLink(e){return(0,a.jsx)(m.AccessibleLink,Object.assign({url:"#",textElement:C.Caption,correctiveMargin:-3},{children:e}),"videoLearnMore")}}t.default=w},886251:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(643789),o=i(516778),s=i(217041),r=i(889391),l=i(278968),c=i(746096),d=i(336801),u=i(436237),h=i(915877),p=i(33004),g=i(478262),C=i(680837),S=i(912770),m=(0,h.lazyProperties)({reactionContainer:()=>[C.default.absoluteFill,C.default.flexOne],animationStyle:()=>o.Styles.createViewStyle({position:"absolute",top:0,bottom:0,overflow:"visible",alignSelf:"center",alignContent:"center"})});class y extends s.ComponentBase{constructor(){super(...arguments),this._isAnimationPlaying=!1,this._reactionKey="",this._animationTimeout=0,this._onAEAnimationRef=e=>{this._aeAnimatedView=e||void 0},this._startAnimation=()=>{this._aeAnimatedView&&!this._isAnimationPlaying&&(u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView._startAnimation"),this._isAnimationPlaying=!0,this._aeAnimatedView.play(),l.default.setAnimationIsPlaying(this._isAnimationPlaying),this._animationTimeout=S.default.setTimeout((()=>{this.props.onAnimationOut&&this.props.onAnimationOut(),this._isAnimationPlaying=!1,l.default.setAnimationIsPlaying(this._isAnimationPlaying),this.isComponentMounted()&&this.setState({shouldRenderAEAnimationView:!1})}),this.state.animationTimeoutInMs))},this._resetAnimation=()=>{u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView._resetAnimation"),this._aeAnimatedView&&this._aeAnimatedView.reset()}}_buildState(e,t){const i=t?Date.now():this.state.reactionsCutOff;let a=t?void 0:this.state.animationReactionInfo,n=!t&&this.state.shouldRenderAEAnimationView,o=!1;const s=r.default.getS4LCMCFeatures().callAnimatedReactionsConfig.callAnimatedReactionsTimeoutsinMs;let c=s.default;const d=l.default.getLastReaction(e.conversationMri,i);if(!this._isAnimationPlaying&&d){const e=p.default.callReactionInfoForReaction(d);if(this._reactionKey=this._getReactionKey(e),(e.reactionsTextStyle===g.ReactionsTextStyle.Animation||this._isNewAnimatedReaction(e))&&(o=!0,t||this._didReceiveNewAnimation(a,e))){a=e;const t=this._reactionKey;n=r.default.getS4LUiFeatures().jsonAnimationEnabled,t&&s[t]&&(c=s[t])}}return{reactionsCutOff:i,animationTimeoutInMs:c,animationReactionInfo:a,shouldRenderAEAnimationView:n,isReactionNewAnimation:o}}_isNewAnimatedReaction(e){return(null==e?void 0:e.reactionsTextStyle)===g.ReactionsTextStyle.Default&&p.default.isSuperAnimationReaction(this._reactionKey)}_getReactionKey(e){return(null==e?void 0:e.reaction.getEmoticonCallReactionKey())||""}componentWillUnmount(){u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView.componentWillUnmount"),super.componentWillUnmount(),S.default.clearTimeout(this._animationTimeout),this._resetAnimation(),this.props.onAnimationOut&&this.props.onAnimationOut()}componentDidMount(){u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView.componentDidMount"),super.componentDidMount(),this.state.animationReactionInfo&&this._startAnimation()}_didReceiveNewAnimation(e,t){let i=!1;return t&&(e?t.reaction.createdTime>e.reaction.createdTime&&t.reaction.cuid!==e.reaction.cuid&&(i=!0):i=!0),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this._didReceiveNewAnimation(t.animationReactionInfo,this.state.animationReactionInfo);u.log(c.LogTraceArea.CallReactions,"CelebrationAnimationView.componentDidUpdate CallReactionsStore.isAnimationPlaying() "+l.default.isAnimationPlaying()+"; shouldUpdateAnimation "+a),a&&(this._resetAnimation(),this._startAnimation())}shouldComponentUpdate(){return!l.default.isAnimationPlaying()}render(){let e;if(this.state.shouldRenderAEAnimationView&&this.state.animationReactionInfo&&this.state.isReactionNewAnimation){const t=p.default.animationInfoForKey(this.state.animationReactionInfo.content||this._reactionKey,!0);if(t){let i=[C.default.absoluteFill,C.default.flexOne];{const e=o.Styles.createViewStyle({width:t.intrinsicSize.width,height:this.props.height},!1);i=[m.animationStyle,e]}const s=d.default.getAssetSourceWithColor(t);e=(0,a.jsx)(n.default,Object.assign({},s,{style:i,source:t.source,ref:this._onAEAnimationRef}))}}return(0,a.jsx)(o.Animated.View,Object.assign({style:m.reactionContainer,blockPointerEvents:!0,ignorePointerEvents:!0},{children:e}))}}t.default=y},300513:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(48777),s=i(994224),r=i(568580),l=i(32057),c=i(898278),d=i(953143),u=i(746096),h=i(436237),p=i(915877),g=i(581760),C=i(680837),S=i(24576),m=(0,p.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:c.CompositeNotificationToastInfo.vertical}),metadataContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),notificationTextStyle:()=>n.Styles.createTextStyle({flex:-1,wordBreak:"break-word",paddingRight:5}),linkStyle:()=>n.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:g.Color.blue})});class y extends S.default{_buildState(e,t){const i={},a=d.default.getToast(e.toastId);if(a&&a.state){const e=a.state,t=e.callId;i.callId=t,i.callState=s.default.CallingStore.getCallState(t),i.audioOnlyEnabled=s.default.CallingStore.isAudioOnly(t),i.callNetworkQualityPoor=(0,l.default)().isCallQualityPoor(t),i.conversationMri=e.conversationMri}return i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this.state.callState&&r.default.isCallStateActive(this.state.callState)&&!r.default.isCallStateOnHold(this.state.callState);(this.state.audioOnlyEnabled||this.state.callNetworkQualityPoor)&&a||(h.log(u.LogTraceArea.CallingUI,"CompositeCallConnectionQualityToast.componentDidUpdate removing toast"),d.default.removeToast(this.props.toastId))}render(){return(0,a.jsx)(n.View,Object.assign({style:m.container},{children:(0,a.jsx)(o.default,{callId:this.state.callId,conversationMri:this.state.conversationMri,containerStyle:[m.metadataContainer,C.default.flexNegativeOne],iconColor:this._themeColors.headerIconColor,textStyle:[m.notificationTextStyle,this._themeStyles.headerTextColorStyle],linkStyle:m.linkStyle})}))}}t.default=y},446509:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalCompositeCallMediaCapturerToast=t.RemoteCompositeCallMediaCapturerToast=void 0;const a=i(785893),n=i(217041),o=i(148540),s=i(994224),r=i(568580),l=i(953143),c=i(121936),d=i(7015),u=i(24576),h=i(711828);class p extends u.default{constructor(){super(...arguments),this._shouldToastBeRemoved=e=>!this.state.callId||e!==o.CallState.Connected||!this.state.initiatorMri||!s.default.CallingStore.isCallMediaCaptured(this.state.callId,this.state.initiatorMri)}_buildState(e,t){const i=l.default.getToast(e.toastId);let a,n;if(i&&i.state){const e=i.state;n=e.callId,a=e.initiatorMri}return{initiatorMri:a,callId:n}}render(){const e=[{icon:h.SkypeIcon.CallRemoteNdiRecord,color:this._themeColors.headerIconColor}];return(0,a.jsx)(d.RemotePrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,notificationTextPath:"CallMediaCapturerToast.NotificationText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedAccessibilityLabel",initiatorMri:this.state.initiatorMri,shouldToastBeRemoved:this._shouldToastBeRemoved,icons:e})}}t.RemoteCompositeCallMediaCapturerToast=p;class g extends n.ComponentBase{constructor(){super(...arguments),this._getTimeStamp=()=>{},this._onStopPress=(e,t)=>{c.default.setNdiEnabled(!1)},this._shouldToastBeRemoved=e=>{const t=r.default.isCallStateActive(e)&&!r.default.isCallStateOnHold(e);return!c.default.isNdiEnabled()||!t}}render(){return(0,a.jsx)(d.LocalPrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,stopLinkTextPath:"CallMediaCapturerToast.StopLinkText",privacyStatementTextPath:"CallMediaCapturerToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallMediaCapturerToast.MorePrivacyInfoLinkText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedInitiatorAccessibilityLabel",shouldToastBeRemoved:this._shouldToastBeRemoved,onStopPress:this._onStopPress,getTimestamp:this._getTimeStamp})}}t.LocalCompositeCallMediaCapturerToast=g},124338:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(260662),r=i(480200),l=i(581760),c=i(884912),d=i(346200),u=i(913944),h=i(711828),p=i(436237),g=i(547126),C=i(915877),S=i(733754),m=i(104735),y=34,f=12,b=(0,C.lazyProperties)({drawerContainer:()=>o.Styles.createViewStyle({flex:1,justifyContent:"flex-end",alignItems:"center"}),drawer:()=>o.Styles.createViewStyle({width:52,borderRadius:26,backgroundColor:l.Color.whiteOverlay70}),containerMobile:()=>o.Styles.createViewStyle({bottom:5,right:15}),innerContainer:()=>o.Styles.createViewStyle({flex:1,alignItems:"center",paddingTop:6,backgroundColor:l.Color.transparent}),closeButtonContainer:()=>o.Styles.createViewStyle({position:"relative"}),customizeReactionButtonContainer:()=>o.Styles.createViewStyle({position:"relative"}),closeButton:()=>o.Styles.createViewStyle({width:y,height:y,borderRadius:17,marginTop:6,marginHorizontal:9,alignItems:"center",backgroundColor:l.Color.gray400Overlay10}),customizeReactionButton:()=>o.Styles.createViewStyle({width:y,height:y,alignItems:"center",marginTop:6,marginHorizontal:9}),minContainer:()=>o.Styles.createViewStyle({position:"absolute",right:10,bottom:95}),container:()=>o.Styles.createViewStyle({position:"absolute",right:80,bottom:24}),divider:()=>o.Styles.createViewStyle({position:"relative",flex:1,marginVertical:6,marginHorizontal:10,height:1,flexDirection:"row",opacity:.3,backgroundColor:l.Color.blackOverlay35})});class _ extends s.default{constructor(){super(...arguments),this._animatedHeightValue=new o.Animated.Value(0),this._animatedOpacityValue=new o.Animated.Value(0),this._animatedContainerStyle=o.Styles.createAnimatedViewStyle({height:this._animatedHeightValue}),this._animatedInnerContainerStyle=o.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onCloseButtonPress=()=>{this.closeDrawer()},this._onCustomizeReactionsButton=()=>{m.default.navigateToCustomReactionsPanel(c.CustomReactionsType.Call,this.props.rootViewId),p.track(new d.CustomReactionsManipulationTelemetry(d.CustomReactionsManipulationAction.CustomReactionsPanelOpened,{customReactionsType:c.CustomReactionsType.Call}))},this._onMouseLeave=()=>{this.state.isOpen&&this.props.drawerOpenedOnHover&&this.closeDrawer()},this._onKeyPress=e=>!(!this.isComponentMounted()||e.keyCode!==g.default.ESCAPE||!this.state.isOpen)&&(this.closeDrawer(),!0),this._onContainerRef=e=>{this._container=e||void 0}}_positionDrawer(e,t){const i=t.isOpen,a=this._getDrawerHeight(t.reactions.length),n=i?a:0,s=i?1:0;if(this._onPositionDrawer(e,t),this._animatedHeightValue&&this._animatedOpacityValue)if(e){const e=o.Animated.timing(this._animatedHeightValue,{toValue:n,easing:o.Animated.Easing.Linear(),duration:i?_.heightAnimationDurationOnOpen:_.heightAnimationDurationOnClose}),t=o.Animated.timing(this._animatedOpacityValue,{toValue:s,easing:o.Animated.Easing.Linear(),duration:i?_.opacityAnimationDurationOnOpen:_.opacityAnimationDurationOnClose});let a,r;i?(a=e,r=t):(a=t,r=e),this._drawerAnimation=a,this._drawerAnimation.start((()=>{this._drawerAnimation=r,this._drawerAnimation.start((()=>{this._onPositionDrawerAnimationCompleted()}))}))}else this._animatedHeightValue.setValue(n),this._animatedOpacityValue.setValue(s)}_renderReactionViews(e){return n.compact(e)}_getDrawerHeight(e){let t=44*e+f;return this.props.showCustomizeReactionsButton&&(t+=53),this.props.drawerOpenedOnHover||(t+=46),t}_renderCloseButton(){if(this.props.controlsType!==r.CallControlsType.Mobile&&!this.props.drawerOpenedOnHover)return(0,a.jsx)(o.View,Object.assign({ignorePointerEvents:!0,style:b.closeButtonContainer},{children:(0,a.jsx)(u.default,{icon:h.SkypeIcon.DownChevron,style:b.closeButton,size:h.IconSize.size20,color:l.Color.gray400,hoverColor:l.Color.gray400,onPress:this._onCloseButtonPress,title:void 0,accessibilityLabel:S.getString("ReactionsStream.ReactionBarCloseDrawerTitle")})}))}_renderCustomizeReactionsButton(){if(this.props.showCustomizeReactionsButton)return(0,a.jsxs)(o.View,Object.assign({ignorePointerEvents:!0,style:b.customizeReactionButtonContainer},{children:[(0,a.jsx)(u.default,{icon:h.SkypeIcon.EmojiAdd,style:b.customizeReactionButton,size:h.IconSize.size32,color:l.Color.gray400,hoverColor:l.Color.gray400,onPress:this._onCustomizeReactionsButton,title:S.getString("ReactionsPanel.CustomCallReactionsTitle"),accessibilityLabel:S.getString("ReactionsPanel.CustomCallReactionsTitle")}),(0,a.jsx)(o.View,{style:b.divider})]}))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);this.state.isOpen!==t.isOpen&&this._resetFocus(this.state.isOpen)}_resetFocus(e){this._container&&this._container.setFocusRestricted(e)}componentDidMount(){super.componentDidMount(),this.state.isOpen||this._resetFocus(!1)}render(){const e=this.props.controlsType===r.CallControlsType.DesktopMinSmallest,t=[b.drawer];this._animatedContainerStyle&&t.push(this._animatedContainerStyle);const i=this._getDrawerHeight(this.state.reactions.length),n=o.Styles.createViewStyle({height:i},!1);let s;s=e?b.minContainer:b.container;const l=[n,s],c=[b.innerContainer];let d;this._animatedInnerContainerStyle&&c.push(this._animatedInnerContainerStyle),this.props.controlsType===r.CallControlsType.Mobile&&l.push(b.containerMobile),this.state.isOpen&&(d=this._renderCloseButton());const u=this._renderCustomizeReactionsButton();return(0,a.jsx)(o.View,Object.assign({style:l,onKeyPress:this._onKeyPress,onMouseLeave:this._onMouseLeave,restrictFocusWithin:!0,ref:this._onContainerRef},{children:(0,a.jsx)(o.View,Object.assign({style:b.drawerContainer,ignorePointerEvents:!0},{children:(0,a.jsx)(o.Animated.View,Object.assign({style:t,ignorePointerEvents:!0},{children:(0,a.jsxs)(o.Animated.View,Object.assign({style:c,ignorePointerEvents:!0},{children:[u,this._renderContent(),d]}))}))}))}))}}_.heightAnimationDurationOnOpen=150,_.opacityAnimationDurationOnOpen=150,_.heightAnimationDurationOnClose=50,_.opacityAnimationDurationOnClose=50,t.default=_},609554:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(994224),o=i(568580),s=i(953143),r=i(7015),l=i(24576),c=i(581760),d=i(711828);class u extends l.default{constructor(){super(...arguments),this._onStopPress=(e,t)=>{n.default.InCallBotService.stopRecording(e,t)},this._getTimeStamp=()=>n.default.CallingStore.getCallRecordingTimestamp(this.state.callId),this._shouldLocalToastBeRemoved=e=>!this.state.callId||!n.default.CallingStore.isRecording(this.state.callId)||!o.default.isCallStateActive(e),this._shouldRemoteToastBeRemoved=()=>!n.default.CallingStore.isRecording(this.state.callId)}_buildState(e,t){const i=s.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId,t=this.state&&this.state.initiatorMri?this.state.initiatorMri:n.default.CallingStore.getCallRecordingInitiator(e);return{initiatorMri:t,callId:e,isLocalInitiator:n.default.InCallBotUtils.isCallRecordingInitiator(t)}}return{}}render(){if(this.state.initiatorMri&&this.state.isLocalInitiator)return(0,a.jsx)(r.LocalPrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,stopLinkTextPath:"CallRecorderToast.StopRecordingLinkText",privacyStatementTextPath:"CallRecorderToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallRecorderToast.RecordingInitiatorMorePrivacyInfoLinkText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingInitiatorAccessibilityLable",shouldToastBeRemoved:this._shouldLocalToastBeRemoved,onStopPress:this._onStopPress,getTimestamp:this._getTimeStamp});const e=[{icon:d.SkypeIcon.CallRecordStroke,color:this._themeColors.headerIconColor},{icon:d.SkypeIcon.CallRecordDot,color:c.Color.red}];return(0,a.jsx)(r.RemotePrivacyToastComponent,{id:this.props.toastId,colorThemeOverride:this.props.colorThemeOverride,notificationTextPath:"CallRecorderToast.IsRecordingText",initialNotificationTextPath:"CallRecorderToast.StartingRecordingText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingAccessibilityLabel",initiatorMri:this.state.initiatorMri,shouldToastBeRemoved:this._shouldRemoteToastBeRemoved,icons:e})}}t.default=u},758262:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(994224),o=i(568580),s=i(480200),r=i(389324),l=i(953143),c=i(24576);class d extends c.default{constructor(){super(...arguments),this._closeToast=e=>{l.default.removeToast(this.props.toastId,e)}}_buildState(e,t){const i=l.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId;return{callId:e,callState:n.default.CallingStore.getCallState(e)}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);!!this.state.callState&&o.default.isCallStateActive(this.state.callState)||this._closeToast(s.ToastActionType.AutoDismissed)}render(){return(0,a.jsx)(r.default,{closeToast:this._closeToast,colorThemeOverride:this.props.colorThemeOverride})}}t.default=d},319310:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(994224),s=i(568580),r=i(480200),l=i(898278),c=i(953143),d=i(746096),u=i(934501),h=i(436237),p=i(915877),g=i(711828),C=i(24576),S=(0,p.lazyProperties)({metadataContainer:()=>n.Styles.createViewStyle({paddingHorizontal:l.CompositeNotificationToastInfo.horizontal}),notificationTextStyle:()=>n.Styles.createTextStyle({flex:-1,wordBreak:"break-word"})});class m extends C.default{constructor(){super(...arguments),this._dismiss=e=>{h.log(d.LogTraceArea.CallingUI,"CompositeGeneralPurposeInCallToast._dismiss type: "+this.props.toastType),c.default.removeToast(this.props.toastId,e),this.props.onDismiss&&e===r.ToastActionType.ManualDismissed&&this.props.onDismiss()},this._onManualDismiss=()=>{this._dismiss(r.ToastActionType.ManualDismissed)}}_buildState(e,t){const i=c.default.getToast(e.toastId);if(i&&i.state){const e=i.state,t=e.callId,a=e.conversationMri;return{callId:t,callState:o.default.CallingStore.getCallState(t),conversationMri:a}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);!!this.state.callState&&s.default.isCallStateActive(this.state.callState)||this._dismiss(r.ToastActionType.AutoDismissed)}render(){return(0,a.jsx)(u.default,{toastType:this.props.toastType,containerStyle:S.metadataContainer,textStyle:[S.notificationTextStyle,this._themeStyles.headerTextColorStyle],onDismiss:this._onManualDismiss,conversationMri:this.state.conversationMri,iconColor:this._themeColors.headerIconColor,iconSize:g.IconSize.size20,callId:this.state.callId})}}t.default=m},596223:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(560787),r=i(994224),l=i(47447),c=i(671830),d=i(898278),u=i(953143),h=i(822854),p=i(952262),g=i(746096),C=i(139285),S=i(503989),m=i(436237),y=i(172490),f=i(915877),b=i(733754),_=i(680837),T=i(600212),v=i(619675),w=i(163841),I=i(418037),P=i(567977),M=(0,f.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:d.CompositeNotificationToastInfo.horizontal,paddingVertical:d.CompositeNotificationToastInfo.vertical}),metadataContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),userIcon:()=>n.Styles.createViewStyle({marginRight:10}),callButtonsContainer:()=>n.Styles.createViewStyle({justifyContent:"center"})});class k extends o.ComponentBase{constructor(){super(...arguments),this._onComponentRef=e=>{this._view=e||void 0},this._getIncomingCallStrings=()=>{let e;e=this.state.isEncrypted?{message:b.getString("CallBanner.IncomingCallEncryptedCaption"),accessibilityLabel:b.getString("CallBanner.IncomingCallEncryptedAccessibilityLabel",{callerName:this.state.callerDisplayName})}:c.isGroupConversation(this.state.conversationMri)?{message:b.getString("CallBanner.IncomingCallGroupCaption",{callerName:this.state.callerDisplayName}),accessibilityLabel:b.getString("CallBanner.IncomingCallGroupAccessibilityLabel",{groupName:this.state.conversationDisplayName,callerName:this.state.callerDisplayName})}:{message:b.getString("CallBanner.IncomingCallOneOnOneCaption"),accessibilityLabel:b.getString("CallBanner.IncomingCallOneOnOneAccessibilityLabel",{callerName:this.state.callerDisplayName})};{const t=y.default.shortcutListItemForShortcut(g.KeyboardShortcut.AcceptIncomingCall),i=y.default.shortcutListItemForShortcut(g.KeyboardShortcut.HangupOrRejectCall);if(t&&i){const a=b.getString("CallBanner.KeyboardShortcutAccessibilityLabel",{acceptCall:t.command,rejectCall:i.accessibleCommand});e.accessibilityLabel=b.getString("CallBanner.IncomingCallAccessibilityLabelWithKeyboardShortcut",{incomingCall:e.accessibilityLabel,keyboardShortcut:a})}}return e}}_buildState(e){const t=u.default.getToast(e.id);if(t){let e;e=I.default.isDarkTheme()?w.Theme.Colorful:w.Theme.ColorfulDark;const i=r.default.CallingStore.getConnectedAndNotOnHoldCallId(),a=t.state,n=r.default.CallingStore.isEncryptedCall(a.callId),o=r.default.CallingStore.isPSTNCall(a.callId),s=r.default.CallingFeaturesHelper.allowMergeCall({isEncryptedCall:n,isPSTNCall:o,conversationMri:a.conversationMri,callId:a.callId,connectedCallId:i});return{callId:a.callId,conversationMri:a.conversationMri,callerMri:a.callerMri,isCallIncoming:r.default.CallingStore.isCallIncoming(a.callId),callerDisplayName:p.default.getDisplayName(a.callerMri),conversationDisplayName:p.default.getDisplayName(a.conversationMri),connectedToAnotherCall:!!i&&i!==a.callId,themeOverride:e,isEncrypted:n,isPSTN:o,hasAnsweredCallLocally:r.default.CallingStore.hasAnsweredCallLocally(a.callId),callDidExist:r.default.CallingStore.callDidExist(a.callId),isMergePossible:s,callMergeSupported:l.CallingCapabilities.callMergeSupported()}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._shouldIgnore()&&(m.log(g.LogTraceArea.CallingUI,"CompositeIncomingRingToast.componentDidUpdate removing toast for callId: "+this.state.callId),u.default.removeToast(this.props.id))}componentDidMount(){super.componentDidMount(),this._shouldIgnore()&&(m.log(g.LogTraceArea.CallingUI,"CompositeIncomingRingToast.componentDidMount removing toast for callId: "+this.state.callId),u.default.removeToast(this.props.id)),this._view&&this._view.requestFocus(),this.state.connectedToAnotherCall&&n.Accessibility.announceForAccessibility(this.state.isMergePossible?b.getString("CallBanner.IncomingCallMergeCallWarning"):b.getString("CallBanner.IncomingCallMultiCallWarning"))}_shouldIgnore(){return!this.state.isCallIncoming||this.state.hasAnsweredCallLocally||this.state.callDidExist}renderCallControls(){return(0,a.jsx)(S.default,{conversationMri:this.state.conversationMri,callId:this.state.callId,forMobile:!1,isEncryptedCall:!!this.state.isEncrypted,isPSTNCall:!!this.state.isPSTN,buttonSize:s.CallButtonSize.Small,colorThemeOverride:this.state.themeOverride,showMergeButton:this.state.connectedToAnotherCall&&this.state.callMergeSupported,isMergePossible:this.state.isMergePossible})}render(){if(this._shouldIgnore())return null;const e=T.default.themeStylesForTheme(this.state.themeOverride),t=this.state.isMergePossible?b.getString("CallBanner.IncomingCallMergeCallWarning"):b.getString("CallBanner.IncomingCallMultiCallWarning"),i=this.state.connectedToAnotherCall?(0,a.jsx)(v.Caption,Object.assign({style:e.headerTextColorStyle},{children:t})):void 0,o=this._getIncomingCallStrings();return(0,a.jsxs)(n.View,Object.assign({style:[M.container,e.buttonBackgroundColorStyle],ref:this._onComponentRef,tabIndex:0,accessibilityLabel:o.accessibilityLabel},{children:[(0,a.jsxs)(n.View,Object.assign({style:[M.metadataContainer,_.default.flexNegativeOne]},{children:[(0,a.jsx)(C.default,Object.assign({style:M.userIcon},{children:(0,a.jsx)(h.default,{size:P.ConversationIconSize.Size40,conversationId:this.state.conversationMri})})),(0,a.jsxs)(n.View,Object.assign({style:_.default.flexNegativeOne},{children:[(0,a.jsx)(v.BodyText,Object.assign({bold:!0,style:[_.default.flexNegativeOne,e.primaryTextColorStyle],numberOfLines:1},{children:this.state.conversationDisplayName})),(0,a.jsx)(v.Caption,Object.assign({style:[_.default.flexNegativeOne,e.secondaryTextColorStyle]},{children:o.message})),i]}))]})),(0,a.jsx)(n.View,Object.assign({style:M.callButtonsContainer},{children:this.renderCallControls()}))]}))}}t.default=k},490795:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ToastHeight=void 0;const a=i(785893),n=i(516778),o=i(994224),s=i(568580),r=i(898278),l=i(953143),c=i(746096),d=i(46767),u=i(436237),h=i(915877),p=i(581760),g=i(680837),C=i(24576),S=i(471727);t.ToastHeight=40;const m=(0,h.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:r.CompositeNotificationToastInfo.vertical,height:t.ToastHeight}),metadataContainer:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginVertical:3}),notificationTextStyle:()=>n.Styles.createTextStyle({flex:-1,wordBreak:"break-word",paddingRight:5}),linkStyle:()=>n.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:p.Color.blue})});class y extends C.default{_buildState(e,t){const i=l.default.getToast(e.toastId);if(i&&i.state){const e=i.state.callId;return{callId:e,callState:o.default.CallingStore.getCallState(e),shouldBeRemoved:!S.default.isIncomingVideoDisabled(e)}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=this.state.callState&&s.default.isCallStateActive(this.state.callState)&&s.default.isCallStateOnHold(this.state.callState);!this.state.shouldBeRemoved&&a||(u.log(c.LogTraceArea.CallingUI,"CompositeIncomingVideoDisabledToast.componentDidUpdate removing toast"),l.default.removeToast(this.props.toastId))}render(){return(0,a.jsx)(n.View,Object.assign({style:[m.container]},{children:(0,a.jsx)(d.default,{callId:this.state.callId,containerStyle:[m.metadataContainer,g.default.flexNegativeOne],textStyle:[m.notificationTextStyle,this._themeStyles.headerTextColorStyle],linkStyle:m.linkStyle})}))}}y.height=t.ToastHeight,t.default=y},442629:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(994224),s=i(418037),r=i(480200),l=i(898278),c=i(953143),d=i(746096),u=i(913944),h=i(110117),p=i(436237),g=i(915877),C=i(733754),S=i(22222),m=i(581760),y=i(711828),f=i(619675),b=i(24576),_=i(912770),T=i(853374),v=y.IconSize.size20,w=(0,g.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:20,paddingVertical:10}),contentContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingHorizontal:10,alignItems:"center"}),textComposite:()=>n.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word"}),avSettingsLinkStyle:()=>n.Styles.createTextStyle({flex:-1,lineHeight:24,alignSelf:"center",wordBreak:"break-word",marginLeft:4,color:m.Color.sxBlue}),buttonContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",paddingLeft:10}),buttonStyle:()=>n.Styles.createButtonStyle({paddingLeft:10})});class I extends b.default{constructor(){super(...arguments),this._onCloseButtonPress=e=>{c.default.removeToast(this.props.toastId,r.ToastActionType.ManualDismissed)},this._onAVSettingsLinkPress=e=>{const t=T.default.newCauseId();p.log(d.LogTraceArea.Navigation,"CompositeNotificationToast._onAVSettingsLinkPress causeId: "+t),o.default.CallNavigationHelper.navigateToAVDesktopSettings(this._getRootViewId(),t),c.default.removeToast(this.props.toastId,r.ToastActionType.Actioned)}}_buildState(e){const t=c.default.getToast(e.toastId);if(t&&t.state){const e=t.state;return{notificationText:e.notificationText,showAvSettingsLink:e.showAvSettingsLink,timeout:e.buttons?void 0:e.timeout,icon:e.icon,isDarkTheme:s.default.isDarkTheme(),buttons:e.buttons}}return{}}_getIcon(){if(this.state.icon)return(0,a.jsx)(h.default,{icon:this.state.icon,size:y.IconSize.size24,color:this._themeColors.headerIconColor})}render(){const e=this._getIcon(),t=this.state.notificationText,i=this.state.showAvSettingsLink?(0,a.jsx)(f.BodyText,Object.assign({style:w.avSettingsLinkStyle,onPress:this._onAVSettingsLinkPress},{children:C.getString("DesktopProfileMenu.AudioVideoSettingsTitle")})):void 0,o=this.state.buttons?(0,a.jsx)(n.View,Object.assign({style:w.buttonContainer},{children:this.state.buttons.map((e=>(0,a.jsx)(S.default,{style:w.buttonStyle,buttonStyle:this.state.isDarkTheme?l.SXButtonStyle.LightFill:void 0,buttonSize:l.SXButtonSize.Small,title:C.getString(e.labelKey),onPress:e.callback})))})):void 0,s=[this._themeStyles.headerTextColorStyle,w.textComposite];return(0,a.jsxs)(n.View,Object.assign({style:w.container},{children:[e,(0,a.jsxs)(n.View,Object.assign({style:w.contentContainer},{children:[(0,a.jsx)(f.BodyText,Object.assign({style:s},{children:t})),i,o]})),(0,a.jsx)(u.default,{icon:y.SkypeIcon.ClosePanel,size:v,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.primaryIconColor,title:C.getString("Global.CloseButtonTitle"),onPress:this._onCloseButtonPress})]}))}componentDidMount(){super.componentDidMount(),this.state.timeout&&(this._timeoutId=_.default.setTimeout((()=>{c.default.removeToast(this.props.toastId,r.ToastActionType.AutoDismissed),this._timeoutId=void 0}),this.state.timeout))}componentWillUnmount(){super.componentWillUnmount(),this._timeoutId&&(_.default.clearTimeout(this._timeoutId),this._timeoutId=void 0)}}t.default=I},748222:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(994224),s=i(568580),r=i(898278),l=i(953143),c=i(746096),d=i(436237),u=i(915877),h=i(581760),p=i(711828),g=i(237191),C=i(24576),S=(0,u.lazyProperties)({metadataContainer:()=>n.Styles.createViewStyle({paddingHorizontal:r.CompositeNotificationToastInfo.horizontal}),notificationTextStyle:()=>n.Styles.createTextStyle({flex:-1,wordBreak:"break-word"}),linkStyle:()=>n.Styles.createTextStyle({flex:1,wordBreak:"break-word",color:h.Color.blue})});class m extends C.default{constructor(){super(...arguments),this._dismiss=()=>{d.log(c.LogTraceArea.CallingUI,"CompositeTranslationInCallToast._dismiss"),l.default.removeToast(this.props.toastId)}}_buildState(e,t){const i=l.default.getToast(e.toastId);if(i&&i.state){const e=i.state,t=e.callId,a=e.conversationMri;return{callId:t,callState:o.default.CallingStore.getCallState(t),conversationMri:a}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);this.state.callState&&s.default.isCallStateActive(this.state.callState)&&s.default.isCallStateOnHold(this.state.callState)||this._dismiss()}render(){return(0,a.jsx)(g.default,{containerStyle:S.metadataContainer,textStyle:[S.notificationTextStyle,this._themeStyles.headerTextColorStyle],callId:this.state.callId,linkStyle:S.linkStyle,iconColor:this._themeColors.headerIconColor,iconSize:p.IconSize.size20,onDismiss:this._dismiss,conversationMri:this.state.conversationMri})}}t.default=m},32937:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(148540),o=i(7015),s=i(581760),r=i(711828),l=i(994224),c=i(491632),d=i(516283),u=[{icon:r.SkypeIcon.VideoOff,color:s.Color.red}];t.default=function({toastId:e,callId:t,onDismiss:i}){return(0,a.jsx)(o.RemotePrivacyToastComponent,{id:e,notificationTextPath:"VideoDisabledToast.VideoDisabled",initialNotificationTextPath:"VideoDisabledToast.VideoDisabled",startedAccessibilityLabelTextPath:"VideoDisabledToast.VideoDisabled",stoppedAccessibilityLabelTextPath:"VideoDisabledToast.VideoDisabled",shouldToastBeRemoved:e=>{const i=l.default.CallingStore.getListOfBlockedVideoFeedParticipantsIds(t).length;return c.Instrumentation.log(d.LogTraceArea.CallingUI,`[CompositeVideoRestrictedToast][shouldToastBeRemoved] callState: ${e} blocked video feed participants count: ${i}`),e!==n.CallState.Connected||0===i},icons:u,onDismiss:i})}},762490:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DTMFDialpad=void 0;const a=i(785893),n=i(174958),o=i(496486),s=i(516778),r=i(217041),l=i(994224),c=i(651129),d=i(256586),u=i(269965),h=i(746096),p=i(913944),g=i(436237),C=i(861253),S=i(915877),m=i(733754),y=i(581760),f=i(640363),b=i(311010),_=i(711828),T=i(853374),v=(0,S.lazyProperties)({container:()=>s.Styles.createViewStyle({flex:1,alignItems:"stretch",backgroundColor:y.Color.transparent}),dialpadContainer:()=>s.Styles.createViewStyle({flex:1,backgroundColor:y.Color.transparent}),inputDisplayContainer:()=>s.Styles.createViewStyle({flexDirection:"row",height:60,alignSelf:"stretch",justifyContent:"center",paddingLeft:12}),inputDisplayContainerDesktop:()=>s.Styles.createViewStyle({alignSelf:"stretch"}),inputDisplayInnerContainer:()=>s.Styles.createScrollViewStyle({flex:1,backgroundColor:y.Color.transparent}),inputDisplayInnerContainerRTL:()=>s.Styles.createScrollViewStyle({flexDirection:"row-reverse",transform:[{scaleX:-1}]}),inputTextDisplay:()=>s.Styles.createTextStyle({color:y.Color.white,fontSize:b.default.controlFontSize.dialpadInput,font:b.default.font.uiDisplayRegular,backgroundColor:y.Color.transparent,textAlignVertical:"center",alignSelf:"center"}),inputTextDisplayDesktop:()=>s.Styles.createViewStyle({flex:1,borderWidth:0,height:32,alignSelf:"center"}),inputFieldButton:()=>s.Styles.createButtonStyle({flex:0,width:60,height:60}),gestureCatcher:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:y.Color.transparent}),flippedView:()=>s.Styles.createViewStyle({transform:[{scaleX:-1}]})});class w extends r.ComponentBase{constructor(){super(...arguments),this._onDialpadButtonPress=e=>{const t=T.default.newCauseId();g.log(h.LogTraceArea.DialerPanel,"DTMFDialpad._onDialpadButtonPress callId: "+this.props.callId+" input: "+n.pii.Omit(e)+" causeId: "+t),e&&this._sendDtmfTonesAndUpdateState(e,t)},this._onDialpadButtonLongPress=e=>{if("0"===e){const e=this.state.inputText+"+";this._setInputAndFocus(e),this.setState({inputText:e})}},this._onKeyPress=e=>{const t=e.keyCode,i=T.default.newCauseId();if(g.log(h.LogTraceArea.DialerPanel,"DTMFDialpad._onKeyPress callId: "+this.props.callId+" keyCode: "+n.pii.Omit(t)+" causeId: "+i),u.isDialPadKeyCode(t,e.shiftKey)){const i=u.getStringFromKeyCode(t,e.shiftKey),a=T.default.newCauseId();g.log(h.LogTraceArea.DialerPanel,"DTMFDialpad._onKeyPress callId: "+this.props.callId+" input: "+n.pii.Omit(i)+" causeId: "+a),this._sendDtmfTonesAndUpdateState(i,a)}},this._onPasteDesktop=e=>{if(!e.clipboardData||!e.clipboardData.items||0===e.clipboardData.items.length)return;const t=o.find(e.clipboardData.items,(e=>"text/plain"===e.type));t&&t.getAsString((e=>{this._onPaste(e)}))},this._onPasteNative=()=>{s.Clipboard.getText().then((e=>{e&&this._onPaste(e)}))},this._onScrollViewContentSizeChanged=(e,t)=>{if(!this.state.viewDimensions.width)return;const i=this.state.viewDimensions.width;this._scrollView&&e>i&&(f.default.isRTL()?this._scrollView.setScrollLeft(0):this._scrollView.setScrollLeft(e-i))},this._onScrollViewRef=e=>{this._scrollView=e||void 0},this._onDialpadInputRef=e=>{this._dialPadInput=e||void 0},this._onLayoutChange=e=>{const t={width:e.width,height:e.height};(0,C.default)(this.state.viewDimensions,t)||this.setState({viewDimensions:t})}}_buildState(e,t){const i={};return t&&(i.inputText="",i.viewDimensions={width:0,height:0}),i}componentDidMount(){super.componentDidMount(),this._setInputAndFocus(this.state.inputText,!0)}_sendDtmfTonesAndUpdateState(e,t){l.default.PstnUtils.sendDTMFTones(this.props.callId,e,t);const i=this.state.inputText+e;this._setInputAndFocus(i),this.setState({inputText:i})}_onPaste(e){const t=c.default.normalizePhoneNumber(e),i=T.default.newCauseId();g.log(h.LogTraceArea.DialerPanel,"DTMFDialpad._onPaste callId: "+this.props.callId+" pasted: "+n.pii.Omit(t)+" causeId: "+i),this._sendDtmfTonesAndUpdateState(t,i)}_setInputAndFocus(e,t){this._dialPadInput&&(this._dialPadInput.setValue(e),o.defer((()=>{if(this.isComponentMounted()&&this._dialPadInput){t||this._dialPadInput.requestFocus();const i=e.length;i>0&&this._dialPadInput.selectRange(i,i)}})))}render(){const e=f.default.isRTL(),t=[v.inputDisplayContainer],i=[v.inputTextDisplay],n=[v.inputDisplayInnerContainer];e&&(n.push(v.inputDisplayInnerContainerRTL),i.push(v.flippedView));let o=(0,a.jsx)(s.ScrollView,Object.assign({ref:this._onScrollViewRef,style:n,horizontal:!0,showsHorizontalScrollIndicator:!1,onLayout:this._onLayoutChange,onContentSizeChange:this._onScrollViewContentSizeChanged},{children:(0,a.jsx)(s.Text,Object.assign({style:i,numberOfLines:1},{children:this.state.inputText}))}));return t.push(v.inputDisplayContainerDesktop),i.push(v.inputTextDisplayDesktop),o=(0,a.jsx)(s.TextInput,{style:i,ref:this._onDialpadInputRef,autoFocus:!0,onKeyPress:this._onKeyPress,value:this.state.inputText,clearButtonMode:"never",blurOnSubmit:!0,onPaste:this._onPasteDesktop}),(0,a.jsxs)(s.View,Object.assign({style:v.container},{children:[(0,a.jsx)(s.GestureView,{style:v.gestureCatcher}),(0,a.jsxs)(s.View,Object.assign({style:t},{children:[o,undefined,(0,a.jsx)(p.default,{style:v.inputFieldButton,size:_.IconSize.size20,onPress:this.props.onClose,color:y.Color.white,hoverColor:y.Color.gray300,icon:_.SkypeIcon.Cancel,title:m.getString("Global.CloseButtonTitle")})]})),(0,a.jsx)(s.View,Object.assign({style:v.dialpadContainer},{children:(0,a.jsx)(d.default,{onKeyPress:this._onDialpadButtonPress,onKeyLongPress:this._onDialpadButtonLongPress,isDtmfDialpad:!0,disableFontScaling:!0,enableExtensionDialing:!0})}))]}))}}t.DTMFDialpad=w,t.default=w},626208:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(109520),n=i(144228),o=i(153211),s=i(746096),r=i(840138),l=i(436237),c=i(733754),d=i(581760);class u extends n.default{constructor(e){super(e),this._messages=[],this._onMessageBack=e=>{this.props.onClose(),this._rejectCommand.execute(),this._messageCommand.execute(this._messages[e],s.PostSource.DeclineAndMessageMenu),l.track(new a.MobileCallAnswerEvent(a.MobileCallAnswerActions.DeclinedWithMessage,e+1))},this._onDefaultOption=()=>{this.props.onClose(),this._rejectCommand.execute(),l.track(new a.MobileCallAnswerEvent(a.MobileCallAnswerActions.DeclinedWithMessage,this._messages.length+1))},this._messages.push(c.getString("MobileIncomingCallPanel.CantTalkMessage")),this._messages.push(c.getString("MobileIncomingCallPanel.CallRightBackMessage")),this._messages.push(c.getString("MobileIncomingCallPanel.CallLaterMessage")),this._messages.push(c.getString("MobileIncomingCallPanel.CallMeLaterMessage")),this._rejectCommand=new r.RejectIncomingCallCommand(e.callId,!1),this._messageCommand=new r.MessageConversationCommand(e.conversationMri)}_buildRows(e,t){const i=[];for(let e=0;e<this._messages.length;e++){const t=this._messages[e],a={key:"Message: "+t,titleText:t,accessibilityLabel:t,hideBorder:!0,onRowPress:this._onMessageBack.bind(this,e),titleTextColor:d.Color.white};i.push({props:a,builder:o.default.buildRow})}const a=c.getString("MobileIncomingCallPanel.DefaultOption"),n={key:"DefaultOption",titleText:a,accessibilityLabel:a,hideBorder:!0,onRowPress:this._onDefaultOption,titleTextColor:d.Color.blue};return i.push({props:n,builder:o.default.buildRow}),i}static getMenuHeight(){return 5*o.default.getMenuItemHeight()}}t.default=u},623497:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(174958),o=i(496486),s=i(516778),r=i(810701),l=i(994224),c=i(480200),d=i(471727),u=i(671830),h=i(952262),p=i(746096),g=i(436237),C=i(647662),S=i(733754),m=i(18078),y=i(451070),f=i(581760),b=i(912770),_=i(172758),T=i(677381),v=i(889391),w="FixedPositionItem";class I extends T.default{constructor(){super(...arguments),this._bottomOffset=0,this._renderItem=e=>{const t=e.id;if(e.item){const i=e.item,n=this.state.enableRefreshedPalette?this._getContext().themeColors.surfaceInteractive:f.Color.blue,o=i.eventType===c.ParticipantEventType.Join?n:f.Color.blackOverlay70;return(0,a.jsx)(r.default,{mri:i.mri,isLeaveEvent:i.eventType===c.ParticipantEventType.Leave||i.eventType===c.ParticipantEventType.Unavailable,isRaiseHandEvent:i.eventType===c.ParticipantEventType.HandRaised,useLightText:!0,displayString:this._getParticipantItemDisplayString(i),backgroundColor:o,layoutController:e.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets},t)}if(e.text)return(0,a.jsx)(r.default,{mri:e.text.mri,displayString:e.text.text,backgroundColor:f.Color.blackOverlay70,useLightText:!0,isTextEvent:!0,layoutController:e.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets},t)},this._onLayoutChange=e=>{this._layoutController.updateViewDimensions({width:e.width,height:e.height})}}_buildState(e,t){const i=v.default.getS4LUiFeatures().enableRefreshedPalette,a={horizontalSafeAreaInsets:y.default.horizontalInsets(),audienceBotMris:l.default.InCallBotMriUtils.getCallAudienceBotMriFilter(),gridViewBotMris:l.default.InCallBotMriUtils.getCallGridViewBotMriFilter(),enableRefreshedPalette:i};return t&&(this._eventCount=0,this._layoutController=new M,a.itemRenderInfos=[],this._layoutController.setCallbacks((e=>this._onRemoveItem(e)))),a}textEvent(e,t){this.setState(this._onTextEvent(e,t))}participantEvent(e,t){const i=u.sanitizeMri(e,u.Namespaces.SkypeId),a={mri:i,userName:h.default.getDisplayName(i)||S.getString("Notifications.UnknownUserShort"),eventType:t,gender:_.default.getFullUserProfileByMri(i).gender,isCurrentUser:m.default.isMyMri(i)};this.setState(this._onParticipantEvent(a))}participantActionEvent(e,t,i){const a=u.sanitizeMri(e,u.Namespaces.SkypeId),n=this._getUserNameForEvent(a),o=u.sanitizeMri(t,u.Namespaces.SkypeId),s={mri:a,userName:n,actionMri:o,actionUserName:h.default.getDisplayName(o)||S.getString("Notifications.UnknownUserShort"),eventType:i};this.setState(this._onParticipantEvent(s))}participantsRingingEvent(e){const t={displayString:d.default.getRingingItemDisplayString(e),mri:e[0],participantCount:e.length};this.setState(this._onParticipantsRingingEvent(t))}clearEvents(){this._layoutController.clearEvents()}_onRemoveItem(e){this.isComponentMounted()&&(this._layoutController.removeControllerForKey(e),e===w?this.setState({fixedPositionItem:void 0}):this.setState(this._removeStreamItemsAndReturnNewState(e,this.state)))}_onParticipantEvent(e){const t=o.clone(this.state.itemRenderInfos),i="participant_"+this._eventCount++;let a=this._bottomOffset;return e.eventType===c.ParticipantEventType.Unavailable&&(a=48),t.push({id:i,item:e,layoutController:this._layoutController.controllerForKey(i,!0,a)}),{itemRenderInfos:t}}_onParticipantsRingingEvent(e){const t=w,i=this._layoutController.getFixedPositionItemController(!0),a={id:t,ringingItem:e,layoutController:i};if(!this.state.fixedPositionItem&&e.participantCount>0)this._bottomOffset=48,null==i||i.setDismissTimerTimeout(3e4);else{if(0===e.participantCount)return null==i||i.dismissItem(!0),this._bottomOffset=0,this.state;null==i||i.restartDismissTimer()}return{fixedPositionItem:a}}_onTextEvent(e,t){const i=o.clone(this.state.itemRenderInfos),a="text_"+this._eventCount++;return i.push({id:a,text:{mri:t,text:e},layoutController:this._layoutController.controllerForKey(a,!0)}),{itemRenderInfos:i}}_removeStreamItemsAndReturnNewState(e,t){const i=o.clone(t.itemRenderInfos);return{itemRenderInfos:o.filter(i,(t=>t.id!==e))}}_getParticipantItemDisplayString(e){const{eventType:t,userName:i,actionUserName:a,gender:n,isCurrentUser:s}=e;let r;switch(t){case c.ParticipantEventType.Join:r=S.getString("ReactionsStream.ParticipantJoined",{participant:i});break;case c.ParticipantEventType.Leave:r=S.getString("ReactionsStream.ParticipantLeft",{participant:i});break;case c.ParticipantEventType.Muted:r=S.getString("CallPanel.MicrophoneServerMutedPersonalize",{initiator:i,person:a||""});break;case c.ParticipantEventType.HandRaised:r=s?S.getString("ReactionsStream.RaiseHandEventForCurrentUser"):S.getString("ReactionsStream.RaiseHandEvent",{gender:C.getLocalizeParamForGender(n),initiator:i||""});break;case c.ParticipantEventType.KickedOut:r=S.getString("CallPanel.RemoveFromCallPersonalize",{initiator:i,person:a||""});break;case c.ParticipantEventType.BotUnavailable:r=o.includes(this.state.audienceBotMris,e.mri)?S.getString("ReactionsStream.TogetherModeUnavailable"):o.includes(this.state.gridViewBotMris,e.mri)?S.getString("ReactionsStream.LargeGridUnavailable"):S.getString("ReactionsStream.ParticipantUnavailable",{participant:i});break;case c.ParticipantEventType.TogetherModeBackgroundChangeFailed:r=S.getString("ReactionsStream.TogetherModeBackgroundChangeFailed");break;case c.ParticipantEventType.TogetherModeDesiredBackgroundAlreadySet:r=S.getString("ReactionsStream.TogetherModeDesiredBackgroundAlreadySet");break;case c.ParticipantEventType.TogetherModeBackgroundChanged:r=S.getString("ReactionsStream.TogetherModeBackgroundChanged",{participant:i});break;case c.ParticipantEventType.Unavailable:default:r=S.getString("ReactionsStream.ParticipantUnavailable",{participant:i})}return r}_renderFixedPositionItem(){if(!this.state.fixedPositionItem)return;const e=this.state.enableRefreshedPalette?this._getContext().themeColors.surfaceInteractive:f.Color.blue,t=this.state.fixedPositionItem,i=t.id;return t.ringingItem?(0,a.jsx)(r.default,{mri:t.ringingItem.mri,isLeaveEvent:!1,useLightText:!0,displayString:t.ringingItem.displayString,backgroundColor:e,layoutController:t.layoutController,horizontalSafeAreaInsets:this.state.horizontalSafeAreaInsets},i):void 0}_getUserNameForEvent(e){const t=u.sanitizeMri(e,u.Namespaces.SkypeId);return h.default.getDisplayName(t)||S.getString("Notifications.UnknownUserShort")}render(){const e=o.map(this.state.itemRenderInfos,this._renderItem),t=this._renderFixedPositionItem();return(0,a.jsxs)(s.View,Object.assign({style:this.props.style,onLayout:this._onLayoutChange,ignorePointerEvents:!0},{children:[e,t]}))}}t.default=I;class P{constructor(e,t,i,a=0){this._hasBeenPresented=!1,this._hasBeenDismissed=!1,this._dismissTimerTimeout=5e3,this._currentHeight=0,this._currentBottomOffset=0,this._currentOpacity=0,this._animatedOpacityValue=new s.Animated.Value(this._currentOpacity),this._animatedVerticalValue=new s.Animated.Value(this._currentBottomOffset),this._animatedStyle=s.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue,bottom:this._animatedVerticalValue}),g.log(p.LogTraceArea.CallingUI,`EventItemLayoutController constructor ${n.pii.Omit(e)}`),this._id=e,this._onIntrinsicHeightChange=t,this._onRemoveItem=i,this._currentBottomOffset=a}getStyles(){return[this._animatedStyle]}setIntrinsicHeight(e){Math.abs(e-this._currentHeight)>1&&(this._currentHeight=e,this._onIntrinsicHeightChange(this._id,e,!this._hasBeenPresented))}presentItemIfNeeded(e=!1){return!this._hasBeenPresented&&(g.log(p.LogTraceArea.CallingUI,`EventItemLayoutController presentItemIfNeeded ${n.pii.Omit(this._id)}`),this._hasBeenPresented=!0,this._animatedVerticalValue.setValue(-1.2*this._currentHeight),this._updateAnimatedPosition(this._currentBottomOffset,this._currentOpacityValue(),e,!0,450,(()=>this._startDismissTimer())),!0)}setDismissTimerTimeout(e){this._dismissTimerTimeout=e}restartDismissTimer(){this._startDismissTimer()}dismissItem(e=!1){return!this._hasBeenDismissed&&(g.log(p.LogTraceArea.CallingUI,`EventItemLayoutController dismissItem ${n.pii.Omit(this._id)}`),this._clearDismissTimer(),this._updateAnimatedPosition(this._currentBottomOffset+40,0,e,!1,750,(()=>{this._onRemoveItem&&this._onRemoveItem(this._id)})),this._hasBeenDismissed=!0,!0)}addtoBottomOffset(e,t=!1){this._updateAnimatedPosition(this._currentBottomOffset+e,this._currentOpacityValue(),t)}_clearDismissTimer(){this._dismissTimer&&(b.default.clearTimeout(this._dismissTimer),this._dismissTimer=void 0)}_startDismissTimer(){this._clearDismissTimer(),this._dismissTimer=b.default.setTimeout((()=>this.dismissItem(!0)),this._dismissTimerTimeout)}_currentOpacityValue(){return this._hasBeenPresented&&!this._hasBeenDismissed?1:0}_updateAnimatedPosition(e,t=1,i=!1,a=!1,n=300,o,r){if(!this._hasBeenDismissed){if(this._animation&&(this._animation.stop(),this._animation=void 0),i){const i=r||[];0!==t&&i.push(s.Animated.timing(this._animatedVerticalValue,{toValue:e,duration:n,easing:a?s.Animated.Easing.CubicBezier(.87,-.41,.19,1.44):s.Animated.Easing.InOut()})),i.push(s.Animated.timing(this._animatedOpacityValue,{toValue:t,duration:n,easing:s.Animated.Easing.InOut()})),this._animation=s.Animated.parallel(i),this._animation.start((e=>{o&&o()}))}else this._animatedVerticalValue.setValue(e),this._animatedOpacityValue.setValue(t),o&&o();this._currentOpacity=t,this._currentBottomOffset=e}}}class M{constructor(){this._controllers={},this._orderedKeys=[],this._onIntrinsicHeightChange=(e,t,i)=>{let a=o.indexOf(this._orderedKeys,e);if(i)if(e===w){const e=this.getFixedPositionItemController(!1);null==e||e.presentItemIfNeeded()}else{const e=this.controllerForKey(this._orderedKeys[a],!1);e&&e.presentItemIfNeeded(!0)}for(a-=1;a>=0;a--){const e=this.controllerForKey(this._orderedKeys[a],!1);e&&e.addtoBottomOffset(t,!0)}}}updateViewDimensions(e){}setCallbacks(e){this._onRemoveItem=e}clearEvents(){o.each(this._controllers,(e=>e.dismissItem()))}controllerForKey(e,t,i=0){let a=this._controllers[e];return!a&&t&&(a=new P(e,this._onIntrinsicHeightChange,this._onRemoveItem,i),this._controllers[e]=a,this._orderedKeys.push(e)),a}getFixedPositionItemController(e){return!this._fixedPositionItemController&&e&&(this._fixedPositionItemController=new P(w,this._onIntrinsicHeightChange,this._onRemoveItem,0)),this._fixedPositionItemController}removeControllerForKey(e){e===w?delete this._fixedPositionItemController:(delete this._controllers[e],this._orderedKeys=o.without(this._orderedKeys,e))}}},95952:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(915877),r=i(680837),l=i(912770),c=(0,s.lazyProperties)({backFlippedHorizontal:()=>n.Styles.createViewStyle({transform:[{rotateY:"180deg"}]}),backFlippedVertical:()=>n.Styles.createViewStyle({transform:[{rotateX:"180deg"}]})});class d extends o.ComponentBase{constructor(){super(...arguments),this._rotationYValue=new n.Animated.Value(0),this._rotationYStyle=n.Styles.createAnimatedViewStyle({transform:[{rotateY:this._rotationYValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._rotationXValue=new n.Animated.Value(0),this._rotationXStyle=n.Styles.createAnimatedViewStyle({transform:[{rotateX:this._rotationXValue.interpolate({inputRange:[0,360],outputRange:["0deg","360deg"]})}]}),this._onToggle=()=>{this._flipAnimation(!this.state.isFlipped)}}_buildState(e,t){const i={};return t&&(i.isFlipped=!1),i}componentDidMount(){super.componentDidMount(),this.props.autoflipTimeout&&l.default.setTimeout((()=>{this.isComponentMounted()&&this._onToggle()}),this.props.autoflipTimeout)}_flipAnimation(e){const t=this.props.duration||1e3;this.props.flipHorizontal?n.Animated.timing(this._rotationYValue,{toValue:e?180:0,duration:t,easing:n.Animated.Easing.InOutBack()}).start():n.Animated.timing(this._rotationXValue,{toValue:e?180:0,duration:t,easing:n.Animated.Easing.InOutBack()}).start(),l.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({isFlipped:e})}),t/2)}render(){const e=this.props.children;let t;t=this.state.isFlipped?(0,a.jsx)(u,Object.assign({isBack:!0,flipHorizontal:this.props.flipHorizontal},{children:e[1]}),"back"):(0,a.jsx)(u,Object.assign({flipHorizontal:this.props.flipHorizontal},{children:e[0]}),"front");const i=[r.default.flexOne,this.props.flipHorizontal?this._rotationYStyle:this._rotationXStyle];return(0,a.jsx)(n.View,Object.assign({style:this.props.style},{children:(0,a.jsx)(n.Animated.View,Object.assign({style:i},{children:t}))}))}}t.default=d;class u extends o.ComponentBase{render(){const e=[r.default.flexOne];return this.props.isBack&&e.push(this.props.flipHorizontal?c.backFlippedHorizontal:c.backFlippedVertical),(0,a.jsx)(n.View,Object.assign({style:e},{children:this.props.children}))}}},974259:(e,t,i)=>{const a=i(785893),n=i(496486),o=i(516778),s=i(148540),r=i(890295),l=i(994224),c=i(537103),d=i(647176),u=i(502278),h=i(480200),p=i(471727),g=i(346565),C=i(677381),S=i(746096),m=i(110117),y=i(436237),f=i(861253),b=i(915877),_=i(733754),T=i(18078),v=i(914976),w=i(293194),I=i(581760),P=i(711828),M=i(680837),k=i(447017),A=i(853374),R=100,x=120,L="hangup",V="mute",O="unmute",B=(0,b.lazyProperties)({container:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"}),pipContainer:()=>o.Styles.createViewStyle({height:R,width:R,borderRadius:50,backgroundColor:I.Color.black}),gestureView:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:I.Color.transparent}),pip:()=>o.Styles.createViewStyle({position:"absolute",height:R,width:R,overflow:"visible"}),talkingAnimation:()=>o.Styles.createViewStyle({position:"absolute",top:-10,left:-10,width:x,height:x,overflow:"visible"}),muteIconContainer:()=>o.Styles.createViewStyle({position:"absolute",bottom:2,left:0,right:0,height:30,alignItems:"center",justifyContent:"center",backgroundColor:I.Color.transparent})});class D extends C.default{constructor(){super(...arguments),this._currentPoint={x:0,y:0},this._targetPoint={x:0,y:0},this._isDragging=!1,this._animatedTopValue=new o.Animated.Value(this._currentPoint.y),this._animatedLeftValue=new o.Animated.Value(this._currentPoint.x),this._animatedStyle=o.Styles.createAnimatedViewStyle({top:this._animatedTopValue,left:this._animatedLeftValue}),this._animatedScaleValue=new o.Animated.Value(1),this._animatedScaleStyle=o.Styles.createAnimatedViewStyle({transform:[{scale:this._animatedScaleValue}]}),this._participantLayoutController={getStyles:()=>[B.pipContainer],getInnerStyles:()=>[M.default.flexOne],getBackgroundColorStyle(){},isHidden:()=>!1},this._onPress=()=>{const e=A.default.newCauseId();y.log(S.LogTraceArea.CallingUI,"FloatingPipView._onPress causeId: "+e),this._updateScale(!1),this.state.callConversationMri&&this.state.callId&&l.default.CallNavigationHelper.rejoinCall(this.state.callConversationMri,this.state.callId,e,S.NavigationCallOrigin.PipView)},this._onLongPress=e=>{this._updateScale(!1,750);const t=this._getActionMenu(),i={anchor:()=>this._floatingPipView,buttons:t.menuItems,destructiveButtonIndex:t.destructiveIndex};w.default.showWithActionMenuConfig({options:i,callback:this._onHandleActionMenuCommand,maintainAnchor:!0,rootViewId:this._getRootViewId(),invokingEvent:e})},this._onPressIn=()=>{this._updateScale(!0)},this._onPan=e=>{const t=!e.isComplete;if(this._isDragging!==t&&this._startOrStopDragging(t),!this._approachValue){const e=this._centerPoint(this._currentPoint);this._startApproach(e,(e=>{const t={x:e.x-50,y:e.y-50};this._positionPip(t),!this._isDragging&&Math.abs(this._targetPoint.x-e.x)<1&&Math.abs(this._targetPoint.y-e.y)<1&&this._stopApproach()}))}if(this._approachValue&&this._isDragging&&(this._targetPoint={x:e.pageX,y:e.pageY},this._approachValue.updateTarget(this._targetPoint)),e.isComplete){let t,i;if(Math.abs(e.velocityY)<.25)Math.abs(e.velocityX)<.25?(t=e.pageX>this.state.viewDimensions.width/2?this.state.viewDimensions.width:0,i=this._currentPoint.y+50):(t=e.velocityX>0?this.state.viewDimensions.width:0,i=this._currentPoint.y+50);else{const a=e.velocityY/e.velocityX;t=e.velocityX>0?this.state.viewDimensions.width:0,i=a*(t-e.pageX)+e.pageY}t=Math.max(Math.min(t,this._maxX()),40),i=Math.max(Math.min(i,this._maxY()),114),this._targetPoint={x:t,y:i},this._approachValue&&this._approachValue.updateTarget(this._targetPoint)}},this._onLayoutChange=e=>{const t={width:e.width,height:e.height};this.setState({viewDimensions:t})},this._onHandleActionMenuCommand=e=>{const t=A.default.newCauseId();if(y.log(S.LogTraceArea.CallingUI,"FloatingPipView._onHandleActionMenuCommand "+e+" causeId: "+t),this.state.callId)switch(e){case L:l.default.CallingStore.endCall(this.state.callId,t);break;case V:u.default.updateCallTelemetry(this.state.callId,t,(e=>e.muteFloatingPipPress())),l.default.CallingStore.mute(this.state.callId,t);break;case O:u.default.updateCallTelemetry(this.state.callId,t,(e=>e.muteFloatingPipPress())),l.default.CallingStore.unmute(this.state.callId,t);case w.SXActionMenuCancel:}},this._layoutController=()=>this._participantLayoutController,this._onFloatingPipRef=e=>{this._floatingPipView=e||void 0},this._onCallingVideoView=(e,t)=>{y.log(S.LogTraceArea.CallingUI,"FloatingPipView._onCallingVideoView causeId"+t),this._callingVideoView!==e&&(this._callingVideoView=e)}}_buildState(e,t){const i={};t&&(i.viewDimensions={width:0,height:0});const a=l.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId();if(!a||g.default.isCallVisible(a))return i.showPip=!1,i.callState=s.CallState.None,i.videoAvailable=!1,i.videoStreaming=!1,i.screenshareAvailable=!1,i.screenshareStreaming=!1,i.isMuted=!1,i.callId=void 0,i.callConversationMri=void 0,i.speakerMri=void 0,i;const o=l.default.CallingStore.getCallConversationMri(a);if(l.default.CallingStore.isCallCreator(a)&&o&&1===d.default.getActiveParticipants(a,o).length)i.speakerMri=n.first(T.default.getMyMris());else{const e=l.default.CallingStore.getTopSpeakerMri(a);if(e)i.speakerMri=e;else{const e=l.default.CallingStore.getRemoteCallMemberMris(a);i.speakerMri=this._fallbackSpeakerParticipantKey(a,e)}}if(i.isCallJoinedAsTwinCam=l.default.CallingStore.isCallJoinedAsTwinCam(a),i.isCallJoinedAsTwinCam){const e=g.default.hasCallPreviewViewBeenSeen(a),t=l.default.CallingStore.isProvidingVideo(a);i.showPip=!e,i.callId=a,i.callConversationMri=o,i.callState=l.default.CallingStore.getCallState(a),i.videoAvailable=t,i.screenshareAvailable=!1,i.videoStreaming=t&&!e,i.screenshareStreaming=!1,i.isMuted=p.default.isLocalOrServerMuted(a)}else i.speakerMri?(i.showPip=!0,i.callId=a,i.callConversationMri=o,i.callState=l.default.CallingStore.getCallState(a),i.videoAvailable=l.default.RemoteStreamHelper.isStreamAvailable(a,i.speakerMri,s.StreamType.Video),i.screenshareAvailable=l.default.RemoteStreamHelper.isStreamAvailable(a,i.speakerMri,s.StreamType.ScreenSharing),i.videoStreaming=l.default.RemoteStreamHelper.isStreamRenderingForTarget(a,i.speakerMri,s.StreamType.Video,this._callingVideoView?this._callingVideoView.getVideoContainer():void 0),i.screenshareStreaming=l.default.RemoteStreamHelper.isStreamRenderingForTarget(a,i.speakerMri,s.StreamType.ScreenSharing,this._callingVideoView?this._callingVideoView.getVideoContainer():void 0),i.isMuted=p.default.isLocalOrServerMuted(a)):(i.showPip=!1,i.callState=s.CallState.None,i.videoAvailable=!1,i.videoStreaming=!1,i.screenshareAvailable=!1,i.screenshareStreaming=!1,i.isMuted=!1,i.callId=void 0,i.callConversationMri=void 0);return i}componentDidMount(){super.componentDidMount(),this.state.showPip&&this.state.viewDimensions.width&&this._presentPip();const e=this.state.showPip?"Showing":"Hiding";y.log(S.LogTraceArea.CallingUI,"FloatingPipView.componentDidMount: "+e+" PiP")}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=A.default.newCauseId();if(y.log(S.LogTraceArea.CallingUI,"FloatingPipView.componentDidUpdate causeId: "+a),this.state.showPip!==t.showPip&&(this.state.showPip&&this._presentPip(),this.state.showPip!==t.showPip)){const e=this.state.showPip?"Showing":"Hiding";y.log(S.LogTraceArea.CallingUI,"FloatingPipView.componentDidUpdate: "+e+" PiP")}(0,f.default)(this.state.viewDimensions,t.viewDimensions)||(t.viewDimensions.width?this._updatePipPosition():this.state.showPip&&this._presentPip())}requestFocus(){}_presentPip(){y.log(S.LogTraceArea.CallingUI,"FloatingPipView._presentPip");const e={x:this.state.viewDimensions.width,y:84};this._positionPip(e),this._positionPip({x:e.x-90,y:e.y},!0,200)}_stopApproach(){this._approachValue&&(this._approachValue.stop(),this._approachValue=void 0)}_startApproach(e,t){this._stopApproach(),this._approachValue=new r.default(e,t),this._approachValue.start()}_startOrStopDragging(e){this._isDragging=e,this._updateScale(e)}_updateScale(e,t=250){o.Animated.timing(this._animatedScaleValue,{toValue:e?.9:1,easing:o.Animated.Easing.OutBack(),duration:t}).start()}_fallbackSpeakerParticipantKey(e,t){if(!t||n.isEmpty(t))return;const i=n.find(t,(t=>l.default.RemoteStreamHelper.isStreamAvailable(e,t,s.StreamType.ScreenSharing)));if(i)return i;const a=n.find(t,(t=>l.default.RemoteStreamHelper.isStreamAvailable(e,t,s.StreamType.Video)));return a||t[0]}_updatePipPosition(){if(this._isDragging)return;let e=this._currentPoint.x,t=this._currentPoint.y;e>0&&(e=this._maxX()-50);const i=this._maxY()-50;t>i&&(t=i),this._positionPip({x:e,y:t})}_maxX(){return this.state.viewDimensions.width-50+10}_maxY(){return this.state.viewDimensions.height-50+10}_centerPoint(e){return{x:e.x+50,y:e.y+50}}_positionPip(e,t=!1,i=0){t?o.Animated.parallel([o.Animated.timing(this._animatedTopValue,{toValue:e.y,easing:o.Animated.Easing.Out(),duration:250,delay:i}),o.Animated.timing(this._animatedLeftValue,{toValue:e.x,easing:o.Animated.Easing.Out(),duration:250,delay:i})]).start():(this._animatedTopValue.setValue(e.y),this._animatedLeftValue.setValue(e.x)),this._currentPoint=e}_getActionMenu(){const e=[];return e.push({text:_.getString("FloatingPipView.HangupAction"),command:L}),this.state.isMuted?e.push({text:_.getString("FloatingPipView.UnmuteAction"),command:O}):e.push({text:_.getString("FloatingPipView.MuteAction"),command:V}),{menuItems:e,destructiveIndex:0}}_getRenderInfo(){return{renderKey:this.state.speakerMri||"",mri:this.state.speakerMri||"",isLocal:!1,shouldRenderVideo:this.state.videoAvailable||this.state.screenshareAvailable||this.state.videoStreaming||this.state.screenshareStreaming,renderScreenShare:this.state.screenshareAvailable}}_getLocalRenderInfo(){return{renderKey:h.CallStageElementKeys.localUserKey,mri:T.default.getSkypeMri(),isLocal:!0,shouldRenderVideo:this.state.videoStreaming,renderScreenShare:!1}}render(){if(!this.state.showPip||!this.state.viewDimensions.width)return(0,a.jsx)(o.View,{style:B.container,onLayout:this._onLayoutChange,ignorePointerEvents:!0});y.log(S.LogTraceArea.CallingUI,"FloatingPipView: Showing PiP for call user "+v.mriOrId(this.state.speakerMri)+", videoAvailable "+this.state.videoAvailable+", videoStreaming "+this.state.videoStreaming+", videoDimension "+this.state.viewDimensions.width+" "+this.state.viewDimensions.height+", threadId: "+v.mriOrId(this.state.callConversationMri)+", callId: "+this.state.callId);const e=this.state.isCallJoinedAsTwinCam?this._getLocalRenderInfo():this._getRenderInfo(),t=this.state.isMuted?(0,a.jsx)(o.View,Object.assign({style:B.muteIconContainer},{children:(0,a.jsx)(m.default,{icon:P.SkypeIcon.MicrophoneOff,size:P.IconSize.size16,color:I.Color.white})})):void 0;return(0,a.jsx)(o.View,Object.assign({style:B.container,onLayout:this._onLayoutChange,ignorePointerEvents:!0},{children:(0,a.jsxs)(o.Animated.View,Object.assign({ref:this._onFloatingPipRef,style:[B.pip,this._animatedStyle,this._animatedScaleStyle],ignorePointerEvents:!0},{children:[(0,a.jsx)(k.default,{style:B.talkingAnimation,animate:!0,size:x}),this.state.callId&&(0,a.jsx)(c.CallParticipantView,{callId:this.state.callId,renderInfo:e,renderKey:e.renderKey,isCompact:!0,iconOpacity:1,videoBorderRadius:50,suppressTalkingRing:!0,parentViewId:"FloatingPipView",onCallingVideoView:this._onCallingVideoView,layoutController:this._layoutController,iconSize:100}),t,(0,a.jsx)(o.GestureView,Object.assign({style:B.gestureView,onPan:this.state.showPip?this._onPan:void 0,releaseOnRequest:!1,importantForAccessibility:o.Types.ImportantForAccessibility.No},{children:(0,a.jsx)(o.Button,{style:B.gestureView,onPress:this.state.showPip?this._onPress:void 0,onPressIn:this._onPressIn,onLongPress:this._onLongPress,delayLongPress:500,disableTouchOpacityAnimation:!0,accessibilityLabel:_.getString("FloatingPipView.ReturnToCallButtonAccessibilityLabel"),accessibilityTraits:o.Types.AccessibilityTrait.Button})}))]}))}))}}t.Z=D},422003:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(217041),o=i(994224),s=i(346565);class r extends n.ComponentBase{_buildState(e,t){if(!t&&this.state.renderPipView)return{};{const e=o.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId();return{renderPipView:!!e&&!s.default.isCallVisible(e)}}}render(){if(this.state.renderPipView){const e=i(974259).Z;return(0,a.jsx)(e,{})}return null}}t.default=r},824430:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(967593),s=i(518967),r=i(154174),l=i(471727),c=i(898278),d=i(915877),u=i(915415),h=i(581760),p=i(680837),g=i(24576),C=i(702301),S=i(567977).UserIconSize.Size120,m=(0,d.lazyProperties)({container:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center"}),containerAndroid:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible"}),innerView:()=>p.default.absoluteFill,backgroundContainerView:()=>n.Styles.createViewStyle({backgroundColor:h.Color.transparent}),icon:()=>n.Styles.createViewStyle({width:S,height:S,overflow:"visible"}),connecting:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",position:"absolute",top:0,left:0,height:S,width:S,borderRadius:S/2,backgroundColor:h.Color.blackOverlay20,overflow:"hidden"}),talkingViewContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",overflow:"visible"})});class y extends g.default{constructor(){super(...arguments),this._isTalking=!1,this._animatedBackgroundOpacityValue=new n.Animated.Value(0),this._animatedBackgroundOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedBackgroundOpacityValue}),this._animatedIconOpacityValue=new n.Animated.Value(0),this._animatedIconScaleValue=new n.Animated.Value(1),this._animatedIconStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedIconOpacityValue,transform:[{scale:this._animatedIconScaleValue}]}),this._onCallParticipantTalkingViewRef=e=>{this._callParticipantTalkingView=e||void 0}}componentDidMount(){super.componentDidMount(),this._updateIconOpacity(),this._updateBackgroundIconOpacity(!1),this._updateIconScale()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.iconOpacity!==e.iconOpacity&&this._updateIconOpacity(this.props.animateChanges),this.props.isConnecting===e.isConnecting&&this.props.backgroundOpacity===e.backgroundOpacity||this._updateBackgroundIconOpacity(l.default.enableLayoutAnimation()),this.props.size!==e.size&&this._updateIconScale(this.props.animateChanges),this._updateTalkingView()}updateTalking(e){this._isTalking!==e&&(this._isTalking=e,this._updateTalkingView())}_updateTalkingView(){this._callParticipantTalkingView&&this._callParticipantTalkingView.updateTalking(this._isTalking)}_updateIconScale(e=!1){const t=this.props.size/S;e?n.Animated.timing(this._animatedIconScaleValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedIconScaleValue.setValue(t)}_updateIconOpacity(e=!1){const t=this.props.iconOpacity||0;e?n.Animated.timing(this._animatedIconOpacityValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedIconOpacityValue.setValue(t)}_updateBackgroundIconOpacity(e){let t=this.props.isConnecting||!this.props.backgroundOpacity?0:this.props.backgroundOpacity;this.props.showAudioParticipantBackground&&(t=1),e?n.Animated.timing(this._animatedBackgroundOpacityValue,{duration:250,toValue:t,easing:n.Animated.Easing.InOut()}).start():this._animatedBackgroundOpacityValue.setValue(t)}render(){const e=this.props.isConnecting?(0,a.jsx)(n.View,Object.assign({style:m.connecting},{children:(0,a.jsx)(u.default,{size:c.SXActivityIndicatorSize.Medium,tintColor:h.Color.whiteOverlay80})})):void 0,t=this.props.backgroundOpacity&&this.props.backgroundOpacity>0?(0,a.jsx)(n.View,Object.assign({style:[m.innerView,m.talkingViewContainer]},{children:(0,a.jsx)(r.default,{ref:this._onCallParticipantTalkingViewRef,size:r.CallParticipantTalkingViewSize.Large})})):void 0,i=[this.props.style];i.push(m.container);const l=[m.innerView,m.backgroundContainerView];this.props.backgroundColorStyle&&l.push(this.props.backgroundColorStyle),this._animatedBackgroundOpacityStyle&&l.push(this._animatedBackgroundOpacityStyle);const d=this.props.gradientColors?(0,a.jsx)(o.GradientView,{style:m.innerView,direction:o.GradientDirection.BOTTOM,colors:this.props.gradientColors}):void 0,g=this.props.showAudioParticipantBackground?(0,a.jsx)(s.default,{}):void 0,y=this.props.hideIcon?void 0:(0,a.jsx)(n.View,Object.assign({style:m.icon},{children:(0,a.jsxs)(n.Animated.View,Object.assign({style:[p.default.overflowVisible,this._animatedIconStyle]},{children:[t,(0,a.jsx)(C.UserIcon,{userMri:this.props.userMri,size:S,forceMediumAvatarSize:!0,useCircleForAgentMask:!0}),e]}))}));return(0,a.jsxs)(n.View,Object.assign({style:i},{children:[(0,a.jsxs)(n.Animated.View,Object.assign({style:l},{children:[d,g]})),y]}))}}t.default=y},934501:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(889391),s=i(953143),r=i(952262),l=i(746096),c=i(110117),d=i(436237),u=i(915877),h=i(540522),p=i(733754),g=i(104735),C=i(581760),S=i(311010),m=i(711828),y=i(359433),f=i(619675),b=i(24576),_=i(853374),T=(0,u.lazyProperties)({contentContainer:()=>n.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center"}),textContentContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>n.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>n.Styles.createTextStyle({fontSize:S.default.controlFontSize.caption}),container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),dismissButtonDesktop:()=>n.Styles.createViewStyle({margin:12}),dismissButtonMobile:()=>n.Styles.createViewStyle({marginTop:0,marginBottom:0}),translationIconDesktop:()=>n.Styles.createViewStyle({marginLeft:10}),linkBlue:()=>n.Styles.createTextStyle({color:C.Color.blue})});class v extends b.default{constructor(){super(...arguments),this._onPressMusicModeNoticeLearnMore=()=>{h.openUrlWithParams({origin:l.BrowserOrigin.CallPanel,url:o.default.getConfigSettingsNoSubscription().musicMode.learnMoreUrl,rootViewId:this._getRootViewId()})},this._onPressTogetherModeNoticeLearnMore=()=>{h.openUrlWithParams({origin:l.BrowserOrigin.CallPanel,url:o.default.getConfigSettingsNoSubscription().togetherModeNotice.learnMoreUrl,rootViewId:this._getRootViewId()})},this._onPressPstnTranslatorNoticeLearnMore=()=>{h.openUrlWithParams({origin:l.BrowserOrigin.CallPanel,url:o.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.privacyLink,rootViewId:this._getRootViewId()})},this._onPressPstnParticipantRingButton=()=>{if(this.props.callId){const e=_.default.newCauseId();d.log(l.LogTraceArea.CallingUI,`GeneralPurposeInCallBanner._onPressPstnParticipantRingButton callId: ${this.props.callId} causeId: ${e}`),g.default.openCallRoster(this.props.conversationMri,this.props.callId,e,this._getContext())}},this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss()}}_buildState(e,t){return{conversationName:r.default.getDisplayName(e.conversationMri)||""}}render(){return(0,a.jsxs)(n.View,Object.assign({style:[this.props.containerStyle,T.container]},{children:[(0,a.jsxs)(n.View,Object.assign({style:T.contentContainer},{children:[this._renderTeamsIcon(),this._renderTextContent()]})),this._renderDismissButton()]}))}_renderTeamsIcon(){var e,t;const i=this._getIconForType();if(i)return(0,a.jsx)(c.default,{style:this.props.isUsingStackNavigation?void 0:T.translationIconDesktop,icon:i,color:null!==(e=this.props.iconColor)&&void 0!==e?e:C.Color.white,size:null!==(t=this.props.iconSize)&&void 0!==t?t:m.IconSize.size16},"teamsIcon")}_getIconForType(){switch(this.props.toastType){case s.ToastType.TogetherModeNotice:return m.SkypeIcon.Audience;case s.ToastType.TeamsInterop:return m.SkypeIcon.MSTeams;case s.ToastType.PstnTranslation:return m.SkypeIcon.Warning;case s.ToastType.PstnParticipantRing:return m.SkypeIcon.ContactGroupCall;case s.ToastType.MusicModeEnabled:return m.SkypeIcon.PersonVoice;case s.ToastType.VideoRestricted:return m.SkypeIcon.VideoOff}}_renderTextContent(){switch(this.props.toastType){case s.ToastType.TogetherModeNotice:return this._renderTogetherModeNoticeTextContent();case s.ToastType.MusicModeEnabled:return this._renderMusicModeNoticeTextContent();case s.ToastType.TeamsInterop:return this._renderTeamsInteropContent();case s.ToastType.PstnTranslation:return this._renderPstnTranslatorContent();case s.ToastType.PstnParticipantRing:return this._renderPstnParticipantRingContent();case s.ToastType.VideoRestricted:return this._renderVideoRestrictedContent()}}_renderVideoRestrictedContent(){return(0,a.jsx)(n.View,Object.assign({style:T.textContentContainer},{children:(0,a.jsx)(f.BodyText,Object.assign({style:this._getTextStyles()},{children:p.getString("VideoDisabledToast.VideoDisabled")}))}),"textContentContainer")}_renderMusicModeNoticeTextContent(){const e=this._getAudioModeLearnMoreLink();return(0,a.jsx)(n.View,Object.assign({style:T.textContentContainer},{children:(0,a.jsx)(f.BodyText,Object.assign({style:this._getTextStyles()},{children:p.getParts("MusicModeNoticeBanner.MusicModeNoticeInCallBannerText",{learnMoreLink:e})}))}),"textContentContainer")}_renderPstnTranslatorContent(){return(0,a.jsx)(n.View,Object.assign({style:T.textContentContainer},{children:(0,a.jsxs)(f.BodyText,Object.assign({style:this._getTextStyles()},{children:[p.getString("LanguageAndTranslationSettingsPanel.TranslationBannerText")+" ",(0,a.jsx)(y.default,Object.assign({url:o.default.getS4LCMCFeaturesNoSubscription().pstnTranslation.privacyLink,onPress:this._onPressPstnTranslatorNoticeLearnMore,blue:!0},{children:p.getString("LanguageAndTranslationSettingsPanel.TranslationBannerMorePrivacyInfoText")}),"pstnTranslatorNoticeLearnMoreLink ")]}))}),"textContentContainer")}_renderPstnParticipantRingContent(){if(this.props.callId)return(0,a.jsx)(n.View,Object.assign({style:T.textContentContainer},{children:(0,a.jsxs)(f.BodyText,Object.assign({style:this._getTextStyles()},{children:[p.getString("CallPanel.PstnParticipantRingToastText")+" ",(0,a.jsx)(n.Text,Object.assign({onPress:this._onPressPstnParticipantRingButton,style:T.linkBlue},{children:p.getString("CallPanel.PstnParticipantRingToastButton")}),"pstnParticipantsRingLink")]}))}),"textContentContainer")}_renderTeamsInteropContent(){return(0,a.jsx)(n.View,Object.assign({style:T.textContentContainer},{children:(0,a.jsx)(f.BodyText,Object.assign({style:this._getTextStyles()},{children:p.getString("TeamsInteropBanner.TeamsInteropInCallBannerText",{userName:this.state.conversationName})}))}),"textContentContainer")}_renderTogetherModeNoticeTextContent(){const e=this._getTogetherModeLearnMoreLink();return(0,a.jsx)(n.View,Object.assign({style:T.textContentContainer},{children:(0,a.jsx)(f.BodyText,Object.assign({style:this._getTextStyles()},{children:p.getParts("TogetherModeNoticeBanner.TogetherModeNoticeInCallBannerText",{learnMoreLink:e})}))}),"textContentContainer")}_getTogetherModeLearnMoreLink(){return(0,a.jsx)(y.default,Object.assign({url:o.default.getConfigSettingsNoSubscription().togetherModeNotice.learnMoreUrl,onPress:this._onPressTogetherModeNoticeLearnMore,blue:!0},{children:p.getString("Global.LearnMore")}),"togetherModeNoticeLearnMoreLink ")}_getAudioModeLearnMoreLink(){return(0,a.jsx)(y.default,Object.assign({url:o.default.getConfigSettingsNoSubscription().musicMode.learnMoreUrl,onPress:this._onPressMusicModeNoticeLearnMore,blue:!0},{children:p.getString("Global.LearnMore")}),"musicModeNoticeLearnMoreLink ")}_renderDismissButton(){var e,t;return(0,a.jsx)(c.default,{style:this.props.isUsingStackNavigation?T.dismissButtonMobile:T.dismissButtonDesktop,color:null!==(e=this.props.iconColor)&&void 0!==e?e:C.Color.white,onPress:this._onDismiss,size:null!==(t=this.props.iconSize)&&void 0!==t?t:m.IconSize.size24,icon:m.SkypeIcon.Cancel},"dismissButton")}_getTextStyles(){const e=[this.props.textStyle,T.textContent];return this.props.isUsingStackNavigation&&e.push(T.textContentMobile),e}}t.default=v},285043:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HoverPopup=void 0;const a=i(785893),n=i(665768),o=i(516778),s=i(462033),r=i(147204),l=i(746096),c=i(436237),d=i(915877),u=i(581760),h=i(24576),p=i(912770),g=i(662038),C=(0,d.lazyProperties)({transparentWrapper:()=>o.Styles.createViewStyle({padding:65})});class S extends h.default{constructor(){super(...arguments),this._isPopupHovered=!1,this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this._onBack=()=>(this._dismissSticky(),!0),this._dismissSticky=()=>{this.props.isSticky&&r.default.dismissPopup(this.props.popupId,this._getRootViewId()),this._onClosed()},this._showPopup=()=>{p.default.setTimeout((()=>{this._allowShowPopup()&&this.isComponentMounted()&&this.showImmediately()}),1e3)},this._renderPopup=(e,t,i,n)=>(0,a.jsx)(g.default,{anchorPosition:e,anchorOffset:t,popupWidth:i,popupHeight:n,fillColor:u.Color.transparent,strokeColor:u.Color.transparent,popupAccessibilityTitle:this.popupDescription(),offset:{x:-5,y:-18},onContentDimensionsChanged:this._reconstructPopup,renderContent:()=>this.renderContent()}),this._reconstructPopup=()=>{this.hideImmediately(),this.showImmediately()},this.showImmediately=()=>{c.log(l.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].showImmediately, executed`),this.setState({shouldShowPopup:!0},(()=>{if(this._animatedPopupRef&&this._animatedPopupRef.fadeIn(),this.props.isSticky){const e={getAnchor:this.props.anchor,renderPopup:this._renderPopup,rootViewId:this._getRootViewId(),positionPriorities:["top"],onDismiss:this._onClosed,dismissIfShown:!0};r.default.showPopup(e,this.props.popupId)}this._onOpened(this._isAnchorLongPressed)}))},this.hideImmediately=()=>{c.log(l.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].hideImmediately, executed`),this.setState({shouldShowPopup:!1}),this.props.isSticky?this._dismissSticky():this._onClosed()},this._hidePopup=e=>{c.log(l.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, settingTimeout`),p.default.setTimeout((()=>{c.log(l.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, shouldFade: ${e}`),this._allowHidePopup()?e?this._animatedPopupRef&&this._animatedPopupRef.fadeOut((e=>{e.finished&&this.isComponentMounted()&&this.hideImmediately()})):this.isComponentMounted()&&this.hideImmediately():c.log(l.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._hidePopup, notAllowed`)}),50)},this.onAnchorEnter=()=>{this._isAnchorHovered=!0,this.props.isSticky||this._showPopup()},this.onAnchorLeave=()=>{this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this.props.isSticky||this._hidePopup(!0)},this.onAnchorLongPress=()=>{c.log(l.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorLongPress`),this._isAnchorHovered=!1,this._isAnchorLongPressed=!0,this.props.isSticky?this.showImmediately():this._showPopup()},this.onAnchorPress=()=>{c.log(l.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}].onAnchorPress`),this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this.props.isSticky?this.hideImmediately():this._hidePopup(!1)},this._defaultAllowShowPopupConditions=()=>(this._isAnchorHovered||this._isAnchorLongPressed)&&!this.state.shouldShowPopup,this._defaultAllowHidePopupConditions=()=>!this._isAnchorHovered&&!this._isAnchorLongPressed&&!this._isPopupHovered&&this.state.shouldShowPopup,this._allowShowPopup=()=>this._defaultAllowShowPopupConditions(),this._allowHidePopup=()=>this._defaultAllowHidePopupConditions(),this._onOpened=e=>{this.onOpened(e),this.props.onOpened&&this.props.onOpened()},this._onClosed=()=>{this.onClosed(),this.props.onClosed&&this.props.onClosed()},this._onPopupEnter=()=>{c.log(l.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._onPopupEnter`),this._isPopupHovered=!0},this._onPopupLeave=()=>{c.log(l.LogTraceArea.CallingUI,`HoverPopup[${this.popupDescription()}]._onPopupLeave`),this._isPopupHovered=!1,this.props.isSticky||this._hidePopup(!0)},this._onAnimatedPopupRef=e=>{this._animatedPopupRef=e||void 0}}_buildState(e,t){const i={};return t&&(i.shouldShowPopup=!1),i}render(){return!this.state.shouldShowPopup||this.props.isSticky?null:(0,a.jsx)(n.View,Object.assign({ref:this._onAnimatedPopupRef,style:[C.transparentWrapper,this.props.style],opacity:0,onMouseEnter:this._onPopupEnter,onMouseLeave:this._onPopupLeave},{children:this.renderContent()}))}componentDidMount(){super.componentDidMount(),this.props.isSticky&&(this._getContext().isPresentedInGenericDesktopModal||s.default.subscribe(this._onBack))}componentWillUnmount(){super.componentWillUnmount(),s.default.unsubscribe(this._onBack)}}t.HoverPopup=S},420279:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(281878),r=i(4736),l=i(889391),c=i(994224),d=i(502278),u=i(671830),h=i(677381),p=i(757139),g=i(746096),C=i(805581),S=i(436237),m=i(458666),y=i(915877),f=i(733754),b=i(46929),_=i(89808),T=i(330124),v=i(29130),w=i(536150),I=i(22222),P=i(898278),M=i(711828),k=i(311010),A=i(912770),R=i(853374),x=i(962484),L=i(193439),V=(0,y.lazyProperties)({translateButtonText:()=>o.Styles.createTextStyle({font:k.default.font.uiDisplayRegular}),translateButton:()=>o.Styles.createViewStyle({minWidth:210}),translBtnContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"center",marginBottom:30}),containerDesktop:()=>o.Styles.createViewStyle({position:"absolute",flexDirection:"row",alignItems:"center",justifyContent:"space-between",alignSelf:"center"}),containerMobile:()=>o.Styles.createViewStyle({flexDirection:"row",flexWrap:"nowrap",alignItems:"center",justifyContent:"space-between",alignSelf:"center"}),absolute:()=>o.Styles.createViewStyle({position:"absolute"}),actionBtnsContainer:()=>o.Styles.createViewStyle({flexGrow:1,flexShrink:1,borderRadius:16,paddingVertical:5,paddingHorizontal:16,marginHorizontal:12,flexWrap:"nowrap"}),minWidthContainer:()=>o.Styles.createViewStyle({minWidth:440}),langDetected:()=>o.Styles.createTextStyle({fontSize:k.default.fontSize.size14,marginRight:10,flexWrap:"wrap",flexGrow:1,flexShrink:1}),settingsContainer:()=>o.Styles.createViewStyle({flexDirection:"column",alignItems:"center",justifyContent:"center",alignSelf:"center"}),pauseContainer:()=>o.Styles.createViewStyle({flexDirection:"column",alignItems:"center",justifyContent:"center",alignSelf:"center",marginRight:8}),menuPadding:()=>o.Styles.createViewStyle({paddingLeft:16,paddingRight:16}),anchor:()=>o.Styles.createViewStyle({position:"absolute",bottom:0,left:0,right:0,height:0})});class O extends h.default{constructor(){super(...arguments),this._onMobileAnchorRef=e=>{this._mobileAnchorRef=e||void 0},this._onDesktopAnchorRef=e=>{this._desktopAnchorRef=e||void 0},this._pressPause=e=>{e.stopPropagation();const t=R.default.newCauseId();S.log(g.LogTraceArea.CallingUI,`_togglePstnTranslationPause causeId: ${t}`),this.state.isPaused?c.default.InCallBotService.setPstnTranslationPause(this.props.callId,!1,t):c.default.InCallBotService.setPstnTranslationPause(this.props.callId,!0,t)},this._pressTranslateButton=()=>{const e=R.default.newCauseId();d.default.onStartPstnTranslationClicked(this.props.callId,e),this._canTranslateNow()?this._startTranslateCall(!1):(c.default.InCallBotService.preheatTranslator(this.props.callId,e),this._toggleSettingsMenu())},this._toggleSettingsMenu=()=>{const e=R.default.newCauseId(),t=this._getRootViewId(),i=()=>this._desktopAnchorRef;A.default.clearTimeout(this._hideMenuTimeout);const a={causeId:e,rootViewId:t,callId:this.props.callId,conversationMri:this.state.conversationMri||this.props.conversationMri,anchor:i,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isMobileScreenReaderEnabled:this.state.isMobileScreenReaderEnabled,useLightTheme:this.props.useLightTheme,onClose:()=>{A.default.clearTimeout(this._hideMenuTimeout)},isPstnCall:this.props.isPstnCall,callerContext:()=>this._getContext(),callUIState:this.props.callUIState,menuComponentStyle:V.menuPadding,update:this._updateTranslationSettings.bind(this),useAlertForDesktop:this._useAlertForDesktop.bind(this),changeLanguage:this._actuallyChangeLanguage.bind(this),startTranslation:this._startTranslationAndHideSettings.bind(this),isPstnTranslation:!0,isSkypeTranslation:!1};(0,L.showTranslationMenu)(a)},this._hideTranslationSettingsMenu=()=>{p.default.closeIfNeeded(this._getRootViewId(),R.default.newCauseId())},this._startTranslationAndHideSettings=()=>{this._startTranslateCall(this.state.settings.hideSettingsOnTranslationStart)},this._startTranslateCall=e=>{const t=R.default.newCauseId();this._canTranslateNow()?this.state.isTranslating?(S.log(g.LogTraceArea.CallingUI,`_togglePstnTranslationTranslateCall stopPstnTranslation causeId: ${t}`),c.default.InCallBotService.stopPstnTranslation(this.props.callId,t)):(S.log(g.LogTraceArea.CallingUI,`_togglePstnTranslationTranslateCall startPstnTranslation causeId: ${t}`),c.default.InCallBotService.startPstnTranslation(this.props.callId,t).then((()=>{e&&(A.default.clearTimeout(this._hideMenuTimeout),this._hideMenuTimeout=A.default.setTimeout((()=>this._hideTranslationSettingsMenu()),this.state.settings.translationSettingsHideTimeout))}))):S.log(g.LogTraceArea.CallingUI,`_togglePstnTranslationTranslateCall pressed but info missing. causeId: ${t}`)},this._actuallyChangeLanguage=(e,t,i)=>{const a=l.default.getS4LCMCFeaturesNoSubscription().callTranslatorBotConfig.languageSupport.speech;if(n.includes(a,t)){let a={};const n=this.state.conversationMri||this.props.conversationMri;let o;e?(o=C.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(n),C.default.setLocalPstnCallTranlatorBotSpokenLanguageLocale(n,t),a={localLanguageLocale:t}):(o=C.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(n),C.default.setOtherPstnCallTranlatorBotSpokenLanguageLocale(n,t),a={otherLanguageLocale:t});const s=c.default.InCallBotService.getPstnTranslationSessionId(this.props.callId);d.default.onPstnTranslationLanguageChange(this.props.callId,s,e,null!=o?o:"",t,i),this.setState(a,(()=>{this._updateTranslationSettings(i)}))}else S.log(g.LogTraceArea.CallingUI,`_togglePstnTranslationLanguageMenu newLocale ${t} not in supported langs list. causeId: ${i}`);this._maybeToggleSettingsMenu()}}_buildState(e,t){return{settings:l.default.getS4LCMCFeatures().pstnTranslation,conversationMri:c.default.CallingStore.getCallConversationMri(e.callId),isTranslating:c.default.InCallBotService.isPstnTranslationEnabled(e.callId),translationVoice:b.default.getCallTranslatorBotTranslationVoice(),isUsingStackNavigationContext:T.default.isUsingStackNavigationContext(),isMobileScreenReaderEnabled:w.default.isMobileScreenReaderEnabled(),localLanguageLocale:C.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri),otherLanguageLocale:C.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri),callParticipantCount:c.default.CallingStore.connectedParticipantsCount(e.callId),isCaptioning:c.default.InCallBotService.isCaptioningEnabled(e.callId),isVoiceTranslating:c.default.InCallBotService.isVoiceTranslationEnabled(e.callId),isSkypeTranslating:c.default.InCallBotService.isSkypeTranslationEnabled(e.callId),userPrimaryColor:_.default.getPrimaryColor(),availableWidth:v.default.getWidth(this._getRootViewId()),isPaused:c.default.InCallBotService.isPstnTranslationPaused(e.callId)}}componentDidMount(){if(super.componentDidMount(),!this.state.localLanguageLocale&&this._isEnabled()){const e=C.default.getLocalCallTranslatorBotSpokenLanguageLocale();if(e){const t=R.default.newCauseId();this._actuallyChangeLanguage(!0,e,t)}}}componentWillUnmount(){super.componentWillUnmount(),A.default.clearTimeout(this._hideMenuTimeout)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),x.default.setUpMenu(this._toggleSettingsMenu)}_canTranslateNow(){return this.state.translationVoice&&this.state.localLanguageLocale&&this.state.otherLanguageLocale}_updateTranslationSettings(e){this.state.isTranslating&&!this.state.isPaused?(S.log(g.LogTraceArea.CallingUI,"_updatePstnTranslationSettings requesting update of translation settings"),c.default.InCallBotService.startPstnTranslation(this.props.callId,e)):!this.state.isTranslating&&this._canTranslateNow()&&this._startTranslationAndHideSettings()}_getLanguageNameFromLocale(e){const t=m.getShortLanguageTitle(e);return n.isEmpty(t)?e:t}_maybeToggleSettingsMenu(){this._useAlertForDesktop()&&this._toggleSettingsMenu()}_isEnabled(){return this.state.settings.enabled&&!this.state.isCaptioning&&!this.state.isVoiceTranslating&&!this.state.isSkypeTranslating&&this.state.conversationMri&&u.isPhoneMri(this.state.conversationMri)&&1===this.state.callParticipantCount}_useAlertForDesktop(){return!0}_getDetectedLangs(e){if(this.state.localLanguageLocale&&this.state.otherLanguageLocale){const t=this._getLanguageNameFromLocale(this.state.localLanguageLocale),i=this._getLanguageNameFromLocale(this.state.otherLanguageLocale),n=f.getParts("CallTranscription.DetectedLanguages",{language1:t,language2:i});return(0,a.jsx)(o.Text,Object.assign({style:o.Styles.combine(V.langDetected,e.themeStyles.primaryTextColorStyle)},{children:n}))}}render(){var e,t;if(!this._isEnabled())return null;const i=o.Styles.createViewStyle({marginBottom:null!==(e=this.props.marginBottom)&&void 0!==e?e:30},!1),n=o.Styles.createViewStyle({bottom:null!==(t=this.props.marginBottom)&&void 0!==t?t:110},!1),l=o.Styles.createViewStyle({maxWidth:this.state.availableWidth-30},!1),c=this.state.isUsingStackNavigationContext?void 0:(0,a.jsx)(o.View,{style:V.anchor,ref:this._onDesktopAnchorRef}),d=this._getContext();if(this.state.isTranslating){const e=this.state.isPaused?f.getString("LanguageAndTranslationSettingsPanel.TranslationResume"):f.getString("LanguageAndTranslationSettingsPanel.TranslationPause"),t=d.themeStyles.primaryBackgroundColorStyle,u=this.state.availableWidth<=440,h=this.state.isUsingStackNavigationContext||u?[V.containerMobile,V.actionBtnsContainer,i,l,t,this.props.style]:[V.containerDesktop,V.actionBtnsContainer,V.minWidthContainer,n,t,this.props.style];u&&!this.state.isUsingStackNavigationContext&&h.push(V.absolute);const p=d.themeColors.buttonTextColor,g=d.themeColors.buttonBackgroundColor;return(0,a.jsxs)(o.View,Object.assign({ref:this._onMobileAnchorRef,style:o.Styles.combine(h),onPress:this._toggleSettingsMenu},{children:[this._getDetectedLangs(d),(0,a.jsxs)(s.Row,{children:[(0,a.jsx)(r.default,{style:[V.pauseContainer],icon:this.state.isPaused?M.SkypeIcon.PauseGradient:M.SkypeIcon.Pause,iconColor:this.state.isPaused?this.state.userPrimaryColor:p,iconSize:M.IconSize.size20,size:r.ActionButtonSize.Small,backgroundColor:g,title:e,onPress:this._pressPause,accessibilityTraits:o.Types.AccessibilityTrait.Button,accessibilityLabel:e,importantForAccessibility:o.Types.ImportantForAccessibility.Auto}),(0,a.jsx)(r.default,{style:[V.settingsContainer],icon:M.SkypeIcon.Settings,iconColor:p,iconSize:M.IconSize.size20,size:r.ActionButtonSize.Small,backgroundColor:g,title:e,onPress:this._toggleSettingsMenu,accessibilityTraits:o.Types.AccessibilityTrait.Button,accessibilityLabel:f.getString("LanguageAndTranslationSettingsPanel.TranslationSettings"),importantForAccessibility:o.Types.ImportantForAccessibility.Auto})]}),c]}))}const u=this.state.isUsingStackNavigationContext?[V.translBtnContainer,i]:[V.containerDesktop,n];this.props.style&&u.push(o.Styles.createViewStyle(this.props.style,!1));const h=f.getString("LanguageAndTranslationSettingsPanel.TranslateThisCall");return(0,a.jsxs)(o.View,Object.assign({ref:this._onMobileAnchorRef,style:u},{children:[(0,a.jsx)(I.default,{hoverText:h,title:h,accessibilityLabel:h,icon:M.SkypeIcon.SkypeTranslatorNew,iconSize:M.IconSize.size20,iconPositon:P.SXButtonIconPosition.Start,onPress:this._pressTranslateButton,buttonSize:P.SXButtonSize.Medium,style:V.translateButton,textStyleOverride:[V.translateButtonText]},"open-chat-button"),c]}))}}t.default=O},658722:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(110117),s=i(915877),r=i(886045),l=i(581760),c=i(711828),d=i(619675),u=i(24576),h=(0,s.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"center",backgroundColor:l.Color.white,minHeight:40,borderRadius:20,marginBottom:20,paddingHorizontal:20,paddingVertical:5,marginTop:-55}),statusText:()=>n.Styles.createTextStyle({color:l.Color.gray300}),statusTextAccessible:()=>n.Styles.createTextStyle({color:l.Color.gray400}),iconPadding:()=>n.Styles.createViewStyle({paddingRight:10}),iconPaddingRTL:()=>n.Styles.createViewStyle({paddingLeft:10}),warningAnimatedView:()=>n.Styles.createViewStyle({overflow:"visible",height:0})});class p extends u.default{constructor(){super(...arguments),this._warningViewAnimatedOpacityValue=new n.Animated.Value(1),this._warningViewAnimatedOpacityStyle=n.Styles.createAnimatedViewStyle({opacity:this._warningViewAnimatedOpacityValue})}componentDidMount(){super.componentDidMount(),r.default.maybeAnnounceForAccessibility(this.props.viewInformation.warningText)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.viewInformation.warningText!==this.props.viewInformation.warningText&&r.default.maybeAnnounceForAccessibility(this.props.viewInformation.warningText)}showOrHideWarningView(e,t=!0,i=0){if(this.isComponentMounted()){const a=e?1:0;t?n.Animated.timing(this._warningViewAnimatedOpacityValue,{toValue:a,duration:200,delay:i,easing:n.Animated.Easing.Out()}).start():this._warningViewAnimatedOpacityValue.setValue(a)}}render(){const e=this.props.style?n.Styles.createViewStyle(this.props.style,!1):void 0,t=[h.container];this.props.viewInformation.opacityStyle&&t.push(this.props.viewInformation.opacityStyle);const i=this.props.viewInformation.icon?this._getWarningIcon(this.props.viewInformation.icon):void 0,o=this.props.viewInformation.warningText?this._getWarningText(this.props.viewInformation.warningText):void 0;return(0,a.jsx)(n.Animated.View,Object.assign({style:[this._warningViewAnimatedOpacityStyle,h.warningAnimatedView,e],blockPointerEvents:!0,ignorePointerEvents:!0},{children:(0,a.jsxs)(n.Animated.View,Object.assign({style:[t,e]},{children:[i,o]}))}))}_getWarningText(e){return(0,a.jsx)(d.BodyText,Object.assign({style:this._useAccessibleTheme()?h.statusTextAccessible:h.statusText},{children:e}))}_getWarningIcon(e){return(0,a.jsx)(o.default,{icon:e,size:c.IconSize.size15,color:this.props.viewInformation.optionalIconColor||l.Color.gray300,style:this._getContext().isRTL?h.iconPaddingRTL:h.iconPadding})}}t.default=p},840138:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MessageConversationCommand=t.MergeIncomingCallCommand=t.AcceptIncomingCallCommand=t.RejectIncomingCallCommand=void 0;const a=i(994224),n=i(351077),o=i(746096),s=i(211375),r=i(923944),l=i(436237),c=i(785207),d=i(640363),u=i(853374),h=i(502278);t.RejectIncomingCallCommand=class{constructor(e,t){this._callId=e,this._setFocusAfterReject=t}execute(){const e=u.default.newCauseId();l.log(o.LogTraceArea.CallingUI,`RejectIncomingCallCommand callId: ${this._callId} causeId: ${e}`),a.default.CallingStore.rejectCall(this._callId,e),this._setFocusAfterReject&&s.setFocus(s.FocusEvent.DeclineCallFromCallBanner)}};t.AcceptIncomingCallCommand=class{constructor(e,t,i){this._callId=e,this._callInfo=t,this._skipNavigation=i,this._executed=!1}execute(e=!1){if(this._executed)return void l.warn(o.LogTraceArea.CallingUI,`Tried to execute AcceptIncomingCallCommand multiple times. withVideo:${e}; callId: ${this._callId}`);h.default.onCalleeAnsweredCall(this._callId,"incomingRingCommands"),this._executed=!0;const t=u.default.newCauseId();l.log(o.LogTraceArea.CallingUI,`AcceptIncomingCallCommand withVideo:${e}; callId: ${this._callId}; causeId: ${t}`);const i=!d.default.isWindows10Plus();a.default.CallNavigationHelper.answerOrJoinCall({conversationMri:this._callInfo.conversationMri,callId:this._callId,withVideo:e,skipNavigation:this._skipNavigation,knownToBeAnswer:i,origin:o.NavigationCallOrigin.CallControls},t)}canExecuteWithVideo(){return a.default.CallingFeaturesHelper.allowOutboundVideo(this._callInfo)}};t.MergeIncomingCallCommand=class{constructor(e){this._callId=e}execute(){const e=u.default.newCauseId();l.log(o.LogTraceArea.CallingUI,`MergeIncomingCallCommand callId: ${this._callId}; causeId: ${e}`),a.default.CallingStore.mergeCall(this._callId,e)}};t.MessageConversationCommand=class{constructor(e){this._conversationMri=e}execute(e,t){c.default.postMessageFromInput(this._conversationMri,t,r.convertRawTextToInputEntities(e),n.MessageTypes.RichText)}}},503989:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(4736),r=i(560787),l=i(109520),c=i(581760),d=i(952262),u=i(589667),h=i(746096),p=i(840138),g=i(680640),C=i(172490),S=i(915877),m=i(733754),y=i(711828),f=(0,S.lazyProperties)({buttonRow:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),buttonRowReversed:()=>o.Styles.createViewStyle({flexDirection:"row-reverse"}),buttonSpacing:()=>o.Styles.createViewStyle({marginHorizontal:6})}),b={key:"green-gradient",colors:(0,u.getButtonsAgnosticGradientFillColor)(c.AgnosticGradientFillButtonColors.green)},_=m.getString("CallControls.CallButtonDeclineLabel");class T extends g.IncomingRingControlsBase{constructor(e){super(l.CallControlContext.IncomingRingControls,e),this._onAnswerCallKeyboardShortcut=()=>(this._answerCommand.execute(),!0),this._onRejectCallKeyboardShortcut=()=>(this._rejectCommand.execute(),!0),this._onRejectCall=()=>{this._rejectCommand.execute()},this._onAnswerCallWithVideo=()=>{this.props.onPress&&this.props.onPress(),this._answerCommand.execute(!0)},this._onAnswerCall=()=>{this.props.onPress&&this.props.onPress(),this._answerCommand.execute()},this._onMergeCall=()=>{this.props.onPress&&this.props.onPress();new p.MergeIncomingCallCommand(this.props.callId).execute()}}_buildState(e,t){return this._initializeCommands(e,e.forMobile),{conversationName:d.default.getDisplayName(e.conversationMri)||m.getString("Notifications.UnknownUserShort"),allowVideoButton:this._answerCommand.canExecuteWithVideo()}}componentDidMount(){super.componentDidMount(),this._registerKeyboardHandlers()}componentWillUnmount(){super.componentWillUnmount(),this._unregisterKeyboardHandlers()}_buttonSize(){return n.isUndefined(this.props.buttonSize)?r.CallButtonSize.Large:this.props.buttonSize}_registerKeyboardHandlers(){C.default.addHandler(h.KeyboardShortcut.AcceptIncomingCall,this._onAnswerCallKeyboardShortcut),C.default.addHandler(h.KeyboardShortcut.HangupOrRejectCall,this._onRejectCallKeyboardShortcut)}_unregisterKeyboardHandlers(){C.default.removeHandler(h.KeyboardShortcut.AcceptIncomingCall,this._onAnswerCallKeyboardShortcut),C.default.removeHandler(h.KeyboardShortcut.HangupOrRejectCall,this._onRejectCallKeyboardShortcut)}render(){const e=this._buttonSize(),t=this.props.hasSmallerSpacing?r.CallButtonSpacing.Small:r.CallButtonSpacing.Default;let i,n;if(this.props.showMergeButton){const n=this.props.isMergePossible?m.getString("CallControls.CallButtonMergeLabel",{conversationName:this.state.conversationName}):m.getString("CallControls.CallButtonMergeDisabledLabel");i=(0,a.jsx)(r.CallButton,{icon:y.SkypeIcon.CallMerge,isToggledOn:!1,title:n,onPress:this._onMergeCall,isCallMergeButton:!0,size:e,accessibilityLabel:n,spacing:t,isDisabled:!this.props.isMergePossible})}if(this.state.allowVideoButton){const e=m.getString("CallControls.CallButtonVideoLabel",{conversationName:this.state.conversationName});n=(0,a.jsx)(s.default,{icon:y.SkypeIcon.Video,title:e,onPress:this._onAnswerCallWithVideo,size:s.ActionButtonSize.Small,accessibilityLabel:e,userColor:b,style:f.buttonSpacing})}const l=m.getString("CallControls.CallButtonAudioLabel",{conversationName:this.state.conversationName});return(0,a.jsxs)(o.View,Object.assign({style:[f.buttonRow,void 0,this.props.style]},{children:[i,n,(0,a.jsx)(s.default,{ref:this._onAnswerCallButtonRef,icon:y.SkypeIcon.CallStart,title:l,onPress:this._onAnswerCall,size:s.ActionButtonSize.Small,accessibilityLabel:l,userColor:b,style:f.buttonSpacing,autoFocus:!0}),(0,a.jsx)(s.default,{icon:y.SkypeIcon.CallEnd,title:_,onPress:this._onRejectCall,size:s.ActionButtonSize.Small,accessibilityLabel:_,backgroundColor:c.Color.red,style:f.buttonSpacing})]}))}}t.default=T},680640:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IncomingRingControlsBase=void 0;const a=i(496486),n=i(285788),o=i(994224),s=i(109520),r=i(746096),l=i(840138),c=i(436237),d=i(24576);class u extends d.default{constructor(e,t){super(t),this._instrumentationContext=e,this._mediaActionEvent=e=>{if(o.default.CallingStore.isCallIncoming(this.props.callId)){c.track(new s.MediaActionEvent(this._instrumentationContext,s.MediaActionEventResult.AnswerCall));const t=o.default.CallingStore.incomingCallHasVideo(this.props.callId);c.log(r.LogTraceArea.CallingUI,`${this._instrumentationContext}._mediaActionEvent answering call (video: ${t}); causeId: ${e}`),t&&this._answerCommand.canExecuteWithVideo()?this._answerCommand.execute(!0):this._answerCommand.execute()}else c.track(new s.MediaActionEvent(this._instrumentationContext,s.MediaActionEventResult.Ignore)),c.log(r.LogTraceArea.CallingUI,`${this._instrumentationContext}._mediaActionEvent no action; causeId: ${e}`)},this._onAnswerCallButtonRef=e=>{this._answerCallButton=e||void 0}}_initializeCommands(e,t){this._forMobile=t,this._rejectCommand=new l.RejectIncomingCallCommand(e.callId,!t),this._answerCommand=new l.AcceptIncomingCallCommand(e.callId,e,t)}componentDidMount(){super.componentDidMount(),this._forMobile&&a.delay((()=>{this.isComponentMounted()&&this._answerCallButton&&this._answerCallButton.requestFocus()}),100),this._mediaActionEventSub=n.default.mediaActionEvent.subscribe(this._mediaActionEvent),n.default.maybeEndCallFromAndroidBtScoDisconnectEvent&&(this._maybeEndCallFromAndroidBtScoDisconnectSub=n.default.maybeEndCallFromAndroidBtScoDisconnectEvent.subscribe((()=>{c.track(new s.MaybeEndCallFromAndroidBtScoDisconnectEvent(this._instrumentationContext))})))}componentWillUnmount(){super.componentWillUnmount(),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0),this._maybeEndCallFromAndroidBtScoDisconnectSub&&(this._maybeEndCallFromAndroidBtScoDisconnectSub.unsubscribe(),this._maybeEndCallFromAndroidBtScoDisconnectSub=void 0)}}t.IncomingRingControlsBase=u},46767:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(471727),r=i(746096),l=i(436237),c=i(733754),d=i(619675),u=i(853374);class h extends o.ComponentBase{constructor(){super(...arguments),this._onStopPress=e=>{const t=u.default.newCauseId();l.log(r.LogTraceArea.CallingUI,"StackNavAudioOnlyToast disable audio only clicked. causeId:"+t),s.default.enableIncomingVideo(this.props.callId,t)}}componentDidMount(){super.componentDidMount(),n.Accessibility.announceForAccessibility(c.getString("CallControlsOverFlowMenu.AllowIncomingVideoStartStateAnnouncement"))}componentWillUnmount(){super.componentWillUnmount(),n.Accessibility.announceForAccessibility(c.getString("CallControlsOverFlowMenu.AllowIncomingVideoStopStateAnnouncement"))}render(){return(0,a.jsxs)(n.View,Object.assign({style:this.props.containerStyle},{children:[(0,a.jsx)(d.BodyText,Object.assign({style:this.props.textStyle,numberOfLines:1},{children:c.getString("IncomingVideoDisabledToast.BannerTitle")})),(0,a.jsx)(n.Button,Object.assign({onPress:this._onStopPress},{children:(0,a.jsx)(d.BodyText,Object.assign({style:this.props.linkStyle},{children:c.getString("IncomingVideoDisabledToast.ResumeLinkText")}))}))]}))}}t.default=h},417287:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(660289),r=i(911009),l=i(218330),c=i(915877),d=i(216582),u=i(581760),h=i(79669),p=i(815362),g=(0,c.lazyProperties)({unhandledBubbleContainer:()=>n.Styles.createViewStyle({backgroundColor:u.Color.white,borderRadius:10,paddingVertical:5})});class C extends o.ComponentBase{constructor(){super(...arguments),this._animationConfig={presentOffset:{x:200,y:15},dismissOffset:{x:200,y:15},duration:350,easing:n.Animated.Easing.OutBack()},this.updateAnchorInfo=e=>{const t=e||this.props.getAnchorInfo(this.props.creatorKey);this._popupView&&t&&this._popupView.updatePosition(t)},this._onPopupViewRef=e=>{this._popupView=e||void 0},this._getAnchorInfo=()=>this.props.getAnchorInfo(this.props.creatorKey),this._getPopUpPositions=e=>[r.PopupAnchorPositon.Bottom],this._getAnimationDirection=e=>e?this.props.alignRight?r.PopupAnchorPositon.Right:r.PopupAnchorPositon.Left:r.PopupAnchorPositon.Bottom,this._renderPopupContent=(e,t,i,n,o)=>{const r=this.props.callParticipantReaction.reaction,c=(0,a.jsx)(p.default,{id:r.cuid,mri:r.creator,content:this.props.callParticipantReaction.content,reaction:this.props.callParticipantReaction.reaction,gradientColors:this.props.callParticipantReaction.gradientColors,textTimeoutMs:s.default.getTextTimeoutBasedOnContent(r.content),hideBackground:!0,hideUserIcon:!o,style:o?g.unhandledBubbleContainer:void 0,onPress:this.props.onReactionTap?this._onPress:void 0},"reaction"+r.cuid);return o?c:(0,a.jsx)(h.default,Object.assign({anchorPosition:l.default.popupAnchorPositionToString(e),anchorOffset:t,popupWidth:i,popupHeight:n,borderRadius:10,strokeColor:u.Color.white,fillColor:u.Color.white,shadow:"0px 2px 4px rgba(0, 0, 0, 0.25)",skipPopupAutoFocus:!0},{children:c}))},this._onPress=()=>{this.dismiss(!1),this.props.onReactionTap&&this.props.onReactionTap()}}componentDidMount(){super.componentDidMount(),this.props.callParticipantReaction&&this.updateAnchorInfo(),this._rectChangeSubscriptionToken=this.props.getAnchorRectChanges(this.props.creatorKey,this.updateAnchorInfo)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.callParticipantReaction&&this.updateAnchorInfo()}componentWillUnmount(){super.componentWillUnmount(),this._rectChangeSubscriptionToken&&(this._rectChangeSubscriptionToken.unsubscribe(),this._rectChangeSubscriptionToken=void 0)}dismiss(e=!1){this._popupView&&this._popupView.dismiss(e)}render(){if(!this.props.callParticipantReaction)return null;const e=this.props.callParticipantReaction;return(0,a.jsx)(d.default,{ref:this._onPopupViewRef,animateDismissal:!0,animationConfig:this._animationConfig,getAnchorInfo:this._getAnchorInfo,getPopupPositions:this._getPopUpPositions,getAnimationDirection:this._getAnimationDirection,renderPopup:this._renderPopupContent,timeoutMs:5e3,allowTaps:!0,onDismissPopup:()=>{this.props.onRemoveReaction&&this.props.onRemoveReaction(e)}},"reaction"+this.props.callParticipantReaction.reaction.cuid)}}t.default=C},3573:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(174958),o=i(496486),s=i(516778),r=i(217041),l=i(278968),c=i(480200),d=i(746096),u=i(417287),h=i(436237),p=i(915877),g=i(706250),C=i(18078),S=i(33004),m=(0,p.lazyProperties)({container:()=>s.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"visible"})});class y extends r.ComponentBase{constructor(){super(...arguments),this._mountedRefsMap=new g.default,this.showMessage=e=>{h.log(d.LogTraceArea.CallReactions,"InlineCallStageReactionsView.showMessage cuid: "+e.reaction.cuid);const t=this.state.callParticipantReactions,i=e.reaction.creator,a=C.default.isMyMri(i)?c.CallStageElementKeys.localUserKey:i;t[a]=e,o.each(o.keys(t),(e=>{if(e!==a){const t=this._mountedRefsMap.ref(e);t&&t.dismiss()}}));const n=this.state.sequence+1;return this.setState({callParticipantReactions:t,sequence:n}),!0},this.dismissReaction=e=>{h.log(d.LogTraceArea.CallReactions,"InlineCallStageReactionsView.dismissReaction, key: "+n.pii.Omit(e));const t=this.state.callParticipantReactions;if(t[e]){delete t[e];const i=this.state.sequence+1;this.setState({callParticipantReactions:t,sequence:i})}},this._onAnimationEnd=e=>{if(this.isComponentMounted()){const t=e.reaction.creator,i=C.default.isMyMri(t)?c.CallStageElementKeys.localUserKey:t,a=e.reaction.cuid,n=this.state.callParticipantReactions;if(n[i]&&n[i].reaction.cuid===a){delete n[i];const e=this.state.sequence+1;this.setState({callParticipantReactions:n,sequence:e})}}},this._getAnchorInfo=e=>this.props.getAnchorInfo(e)||{rect:{x:this.props.alignRight?this.props.parentDimensions.width:0,y:20,height:this.props.topOffsetForUnhandledReactions,width:this.props.topOffsetForUnhandledReactions/2},hidden:!0}}_buildState(e,t){const i=t?Date.now():this.state.reactionsCutoff,a=l.default.getLastReaction(e.reactionsConversationMri,i),n={lastReactionInfo:a&&S.default.callReactionInfoForReaction(a),reactionsCutoff:i};return t&&(n.callParticipantReactions={},n.sequence=0),n}componentDidMount(){super.componentDidMount();const e=this.props.getCallReactionsDisplayHelper();e.registerUnhandledReactionCallback(this.showMessage),e.registerUnhandledReactionDismissCallback(this.dismissReaction)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i);const a=t.lastReactionInfo?t.lastReactionInfo.reaction.cuid:void 0,n=this.state.lastReactionInfo?this.state.lastReactionInfo.reaction.cuid:void 0;this.state.lastReactionInfo&&a!==n&&this.props.getCallReactionsDisplayHelper().showReaction(this.state.lastReactionInfo)}componentWillUnmount(){super.componentWillUnmount(),this.props.getCallReactionsDisplayHelper().unregisterUnhandledReactionCallback(),this.props.getCallReactionsDisplayHelper().unregisterUnhandledReactionDismissCallback()}updateElementDimensions(e,t){const i=this._mountedRefsMap.ref(e);i&&i.updateAnchorInfo()}_renderReactionsFeed(e,t){return(0,a.jsx)(u.default,{ref:this._mountedRefsMap.onComponentRef(e),creatorKey:e,callParticipantReaction:t,alignRight:this.props.alignRight,onRemoveReaction:this._onAnimationEnd,getAnchorInfo:this._getAnchorInfo,getAnchorRectChanges:this.props.getAnchorInfoChanges,onReactionTap:this.props.onReactionTap},e+"feed")}render(){const e=o.map(this.state.callParticipantReactions,((e,t)=>e?this._renderReactionsFeed(t,e):void 0));return(0,a.jsx)(s.View,Object.assign({style:[m.container,this.props.style],blockPointerEvents:this.props.blockPointerEvents,ignorePointerEvents:this.props.ignorePointerEvents},{children:e}))}}t.default=y},134896:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IosRouteControlButton=void 0;const a=i(785893),n=i(285788),o=i(516778),s=i(677381),r=i(680837);class l extends s.default{render(){const e=n.default.routePickerView();return(0,a.jsxs)(o.View,Object.assign({style:this.props.style},{children:[this.props.children,(0,a.jsx)(e,{style:r.default.absoluteFill,accessibilityLabel:this.props.accessibilityLabel})]}))}}t.IosRouteControlButton=l,t.default=l},590678:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(537103),s=i(480200),r=i(677381),l=i(915877),c=i(581760),d=i(680837),u=i(711828),h=i(471727),p=(0,l.lazyProperties)({newLocalViewContainer:()=>n.Styles.createViewStyle({height:120,width:200,position:"absolute",right:0,top:0,overflow:"visible",shadowOffset:{width:0,height:4},shadowRadius:4,shadowColor:c.Color.blackOverlay70}),localParticipantBackgroundStyle:()=>n.Styles.createViewStyle({backgroundColor:c.Color.callStageLight}),backgroundStyleLightTheme:()=>n.Styles.createViewStyle({backgroundColor:c.Color.gray50})});class g extends r.default{constructor(){super(...arguments),this._getStylesBasedOnIsLandscape=e=>[d.default.flexOne,p.newLocalViewContainer,this.props.isCompactView?Object.assign({borderRadius:u.IconSize.size8,overflow:"hidden"},h.default.getLocalPreviewMobilesShape(e)):void 0],this._participantLayoutController={getStyles:(e,t,i)=>this._getStylesBasedOnIsLandscape(t),getInnerStyles:()=>[d.default.flexOne],getBackgroundColorStyle:e=>e?p.backgroundStyleLightTheme:p.localParticipantBackgroundStyle,isHidden:()=>!1},this._layoutController=()=>this._participantLayoutController}render(){return(0,a.jsx)(o.CallParticipantView,{renderKey:s.CallStageElementKeys.localUserKey,parentViewId:"LocalCallParticipantView",getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,callId:this.props.callId,conversationMri:this.props.conversationMri,useDarkBackground:!0,desktopNameTag:!0,isCallStageV2:!0,showContextMenu:!0,layoutController:this._layoutController,iconSize:64,iconOpacity:1,isGroupCall:!1,useLightTheme:this.props.useLightTheme},s.CallStageElementKeys.localUserKey)}}t.default=g},773773:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(513890),o=i(516778),s=i(994224),r=i(746096),l=i(436237),c=i(404057),d=i(680837);class u extends o.Component{constructor(){super(...arguments),this._callingVideoView=null,this._rendererPromise=null,this._useNewVideoView=!1,this._onCallingVideoView=e=>{this._callingVideoView=e,this._resetRenderer()}}render(){return this._useNewVideoView&&n.VideoView?(0,a.jsx)(n.VideoView,{ref:this._onCallingVideoView}):n.default&&(0,a.jsx)(n.default,{ref:this._onCallingVideoView,style:d.default.absoluteFill,isLocal:!0,parentView:u.name,nametag:this.props.nametag})}componentWillUnmount(){l.log(r.LogTraceArea.Calling,"LocalVideoPreview: componentWillUnmount"),this._clearRenderer()}componentDidUpdate(e){this.props.device!==e.device&&(l.log(r.LogTraceArea.Calling,"LocalVideoPreview: component change requiring new renderer"),this._resetRenderer())}_clearRenderer(){this._rendererPromise&&(this._rendererPromise.then((e=>e.dispose())),this._rendererPromise=null)}_resetRenderer(){this._clearRenderer(),this._callingVideoView&&(l.log(r.LogTraceArea.Calling,`LocalVideoPreview: create renderer { device: ${this.props.device} }`),this._rendererPromise=s.default.DeviceStore.createPreviewRenderer(this._callingVideoView.getVideoContainer(),this.props.options,this.props.device),this._rendererPromise.fail((e=>{l.warn(r.LogTraceArea.Calling,"LocalVideoPreview: DeviceStore.createPreviewRenderer failed. "+c.default.errorAsString(e))})))}}t.default=u},559479:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MicrophoneActivityIcon=void 0;const a=i(570655),n=i(785893),o=i(516778),s=i(667294),r=i(110117),l=i(445026),c=i(711828),d=i(614833),u=(0,i(915877).lazyProperties)({microphoneActivityIndicator:()=>o.Styles.createViewStyle({position:"absolute"})}),h=e=>{var{style:t}=e,i=a.__rest(e,["style"]);const h=(0,d.useMicrophoneLevel)(250)/.8,p=(0,s.useRef)(o.Animated.createValue(h)),g=(0,s.useRef)(o.Styles.createAnimatedViewStyle({opacity:p.current}));return(0,s.useEffect)((()=>{const e=l.default.timing(p.current,{toValue:h,duration:250,easing:o.Animated.Easing.Linear(),useNativeDriver:!0});return e.start(),()=>{e.stop()}}),[h]),(0,n.jsx)(r.AnimatedIconView,Object.assign({},i,{style:[...t,u.microphoneActivityIndicator,g.current],icon:c.SkypeIcon.MicrophoneActivity}))};t.MicrophoneActivityIcon=e=>{var{isMuted:t,legacy:i=!1}=e,o=a.__rest(e,["isMuted","legacy"]);return(0,n.jsxs)(s.Fragment,{children:[!t&&(0,n.jsx)(h,Object.assign({},o)),i?(0,r.simpleIcon)(o.icon,o.color,o.size,o.style):(0,n.jsx)(r.default,Object.assign({},o))]})}},652251:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(496486),s=i(285788),r=i(516778),l=i(148540),c=i(4736),d=i(889391),u=i(560787),h=i(220187),p=i(633289),g=i(994224),C=i(109520),S=i(480200),m=i(471727),y=i(746096),f=i(913944),b=i(436237),_=i(915877),T=i(733754),v=(i(178735),i(330124)),w=i(498053),I=i(536150),P=i(581760),M=i(711828),k=i(24576),A=i(853374),R=i(667024),x=i(415963),L=i(559479),V=i(403239),O=i(502278),B=(0,_.lazyProperties)({container:()=>r.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between",overflow:"visible",alignItems:"center",flexGrow:1,maxWidth:"100%"}),containerVertical:()=>r.Styles.createViewStyle({flexDirection:"column",justifyContent:"space-between",alignItems:"center",flexGrow:1,maxWidth:80,overflow:"visible",maxHeight:"100%"}),buttonsGap:()=>r.Styles.createViewStyle({marginHorizontal:8}),primaryControlsContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),primaryControlsContainerVertical:()=>r.Styles.createViewStyle({flexDirection:"column",alignItems:"center",justifyContent:"center",overflow:"visible"}),buttonControls:()=>r.Styles.createViewStyle({flexDirection:"row",minWidth:44,flexGrow:1,flexShrink:1,width:"50%"}),buttonControlsVertical:()=>r.Styles.createViewStyle({flexDirection:"column",minHeight:44,flexGrow:1,flexShrink:1,height:"50%"}),buttonControlsLeft:()=>r.Styles.createViewStyle({justifyContent:"flex-start",overflow:"visible"}),buttonControlsRight:()=>r.Styles.createViewStyle({justifyContent:"flex-end",overflow:"visible"}),iconControl:()=>r.Styles.createViewStyle({width:44,height:44})});class D extends k.default{constructor(){super(...arguments),this._onCallEndButtonRef=e=>{this._callEndButton=e||void 0,this._callEndButton&&this.isComponentMounted()&&this._maybeFocusCallEndButton()},this._onSnapshotPressed=()=>{this._snapshotCommand.execute(),this.props.onInteracting(!1)},this._onToggleVideoPressed=e=>{const t=A.default.newCauseId();O.default.trackVideoButtonClick(this.props.callId,t),R.default.createTrackerAndMarkPressTime(t,x.ScenarioName.ResponsivenessToggleVideoCall,e),this._videoCommand.execute(),this.props.onInteracting(!1),R.default.markActionDoneAndRemoveTracker(t)},this._onEndCallPressed=e=>{const t=A.default.newCauseId();R.default.createTrackerAndMarkPressTime(t,x.ScenarioName.ResponsivenessEndCall,e);const i=A.default.newCauseId();b.log(y.LogTraceArea.CallingUI,"MobileCallControls._onEndCallPressed "+i),this._endCall(!1,i),R.default.markActionDoneAndRemoveTracker(t)},this._onEndCallButtonLongPress=e=>{e.stopPropagation(),e.preventDefault(),p.default.showEndCallMenuPopup(this._getRootViewId(),e,this._getAnchorForEndCallMenu,this._selectEndCallMenuItem)},this._onChatPanelButtonPressed=e=>{const t=A.default.newCauseId();R.default.createTrackerAndMarkPressTime(t,x.ScenarioName.ResponsivenessChatPanelInCall,e);const i=A.default.newCauseId();b.log(y.LogTraceArea.CallingUI,"MobileCallControls._onChatPanelButtonPressed "+i),this.props.onChatPanelButtonPress(i),this.props.onInteracting(!1),R.default.markActionDoneAndRemoveTracker(t)},this._getAnchorForEndCallMenu=()=>this._callEndButton,this._selectEndCallMenuItem=e=>{p.default.selectEndCallMenuItem(e,this._getRootViewId(),this._endCall)},this._endCall=(e,t)=>{if(b.log(y.LogTraceArea.CallingUI,"MobileCallControls._endCall forEveryone: "+e+" causeId: "+t),e)this._endCallForAllCommand.execute();else{new h.EndCallCommand(this.props.callId,t,this.props.onEndCallFailure).execute()}},this._onToggleMicrophonePressed=e=>{const t=A.default.newCauseId();R.default.createTrackerAndMarkPressTime(t,x.ScenarioName.ResponsivenessMuteCall,e),O.default.trackMicButtonClick(this.props.callId,t);new h.ToggleMuteCommand(this.props.callId,this.state.isMuted,this.state.isServerMuted,!!this.props.disableMic,this._getRootViewId(),t).execute(),this.state.isMuted&&this.props.onLocalUnmute&&this.props.onLocalUnmute(),this.props.onInteracting(!1)},this._mediaActionEvent=e=>{g.default.CallingStore.getOutgoingCallIds().indexOf(this.props.callId)>=0?(b.track(new C.MediaActionEvent(C.CallControlContext.MobileCallControls,C.MediaActionEventResult.EndCall)),b.log(y.LogTraceArea.CallingUI,"MobileCallControls._mediaActionEvent ending call (causeId: "+e+")"),g.default.CallingStore.endCall(this.props.callId,e)):(b.track(new C.MediaActionEvent(C.CallControlContext.MobileCallControls,C.MediaActionEventResult.Ignore)),b.log(y.LogTraceArea.CallingUI,"MobileCallControls._mediaActionEvent no action (causeId: "+e+")"))},this._renderMicrophoneActivityIcon=e=>(0,a.jsx)(L.MicrophoneActivityIcon,Object.assign({},e,{isMuted:this.state.isMuted,legacy:!0})),this._showOverflowMenu=()=>{b.log(y.LogTraceArea.CallingUI,"MobileCallControls._showOverflowMenu"),this.props.onOverflowPressed((()=>this._overflowButtonRef.current),this.props.isUsingSkypeTheme),this.setState({showRedDot:!1})},this._overflowButtonRef=n.createRef()}_buildState(e,t){this._videoCommand=new h.ToggleVideoCommand(e.callId,e),this._snapshotCommand=new w.MomentCommand(e.callId,e,e.reactionsConversationMri),this._endCallForAllCommand=new h.EndCallForEveryoneCommand(e.callId,e,e.callUIState,e.onEndCallFailure);const i=g.default.CallingStore.isCallConnected(e.callId),a=e.callUIState!==S.CallUIState.None,n=g.default.CallingFeaturesHelper.allowReactionsInCallStageMobile();let o;this._reactionCommand=void 0,n&&(o=m.default.getReactionButtonType(e.conversationMri,e.callId),this._reactionCommand=m.default.getReactionCommand(o,e.callId,e,e.reactionsConversationMri));const s=n&&void 0!==this._reactionCommand&&a,r=!s&&this._snapshotCommand.canExecute()&&a;return{isMuted:m.default.isLocalOrServerMuted(e.callId),isServerMuted:g.default.CallingStore.isServerMuted(e.callId),isVideoActive:g.default.CallingStore.isProvidingVideo(e.callId),isMobileScreenReaderEnabled:I.default.isMobileScreenReaderEnabled(),isVideoButtonEnabled:this._videoCommand.canExecute(),hangupAllEnabled:this._endCallForAllCommand.canExecute(),isSnapshotButtonVisible:r,callState:g.default.CallingStore.getCallState(e.callId),isTablet:!v.default.isUsingStackNavigationContext(),isCallConnected:i,shouldMakeSecondaryActionsAvailable:a,showReactButton:s,reactionButtonType:o,enableMicSoundIndicator:d.default.getS4LCMCFeatures().enableMicSoundIndicator,showRedDot:!1}}componentDidMount(){super.componentDidMount(),this._maybeFocusCallEndButton(100),this._mediaActionEventSub=s.default.mediaActionEvent.subscribe(this._mediaActionEvent),s.default.maybeEndCallFromAndroidBtScoDisconnectEvent&&(this._maybeEndCallFromAndroidBtScoDisconnectSub=s.default.maybeEndCallFromAndroidBtScoDisconnectEvent.subscribe((()=>{b.track(new C.MaybeEndCallFromAndroidBtScoDisconnectEvent(C.CallControlContext.MobileCallControls))})))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isServerMuted||!this.state.isServerMuted||this.state.isMuted||m.default.announceMicrophoneState(!0,!0),this._logMuteStateChanges(t)}componentWillUnmount(){super.componentWillUnmount(),this._mediaActionEventSub&&(this._mediaActionEventSub.unsubscribe(),this._mediaActionEventSub=void 0),this._maybeEndCallFromAndroidBtScoDisconnectSub&&(this._maybeEndCallFromAndroidBtScoDisconnectSub.unsubscribe(),this._maybeEndCallFromAndroidBtScoDisconnectSub=void 0)}_logMuteStateChanges(e){this.state.isMuted!==e.isMuted&&b.log(y.LogTraceArea.CallMonitor,`MobileCallControls.componentDidUpdate, isMuted - ${e.isMuted} to ${this.state.isMuted}`),this.state.isServerMuted!==e.isServerMuted&&b.log(y.LogTraceArea.CallMonitor,`MobileCallControls.componentDidUpdate, isServerMuted - ${e.isServerMuted} to ${this.state.isServerMuted}`)}_maybeFocusCallEndButton(e=0){const t=()=>{this._callEndButton&&this.isComponentMounted()&&this.state.isMobileScreenReaderEnabled&&this._callEndButton.requestFocus()};e?o.delay(t,e):o.defer(t)}_getPrimaryControls(){let e;return this.props.isPSTNCall?e=this._getPSTNDialPadButton():this.props.isEncryptedCall||(e=this._getVideoButton()),(0,a.jsxs)(r.View,Object.assign({style:this._getPrimaryControlsStyle()},{children:[this._getMicButton(),e,this._getHangUpButton()]}))}_getHangUpButton(){if(this.props.hideEndCallButton)return null;const e=T.getString("CallControls.CallButtonEndCall");return this.props.enableNewButtons?(0,a.jsx)(c.default,{ref:this._onCallEndButtonRef,icon:M.SkypeIcon.CallEnd,title:e,accessibilityLabel:e,size:c.ActionButtonSize.Medium,backgroundColor:P.Color.red,onPress:this._onEndCallPressed,onLongPress:this.state.hangupAllEnabled?this._onEndCallButtonLongPress:void 0,reverseGradientColor:!0,style:this._getButtonsGapStyle()}):(0,a.jsx)(u.CallButton,{ref:this._onCallEndButtonRef,icon:M.SkypeIcon.CallEnd,title:e,size:u.CallButtonSize.Large,isToggledOn:!1,isCallEndButton:!0,onPress:this._onEndCallPressed,onLongPress:this.state.hangupAllEnabled?this._onEndCallButtonLongPress:void 0,accessibilityLabel:e,backgroundStyle:u.CallButtonBackgroundStyle.Solid})}static _getActionButtonColorConfig(e){if(e)return;return{iconColor:P.Color.gray400Overlay70,backgroundColor:P.Color.gray200}}_getMicButton(){const{enableMicSoundIndicator:e,isMuted:t}=this.state,i=T.getString(t?"CallControls.CallButtonUnmuteLabel":"CallControls.CallButtonMute");if(this.props.enableNewButtons){const n=D._getActionButtonColorConfig(!t);return(0,a.jsx)(c.default,{icon:t?M.SkypeIcon.MicrophoneOff:M.SkypeIcon.Microphone,accessibilityLabel:i,title:i,size:c.ActionButtonSize.Medium,backgroundColor:null==n?void 0:n.backgroundColor,iconColor:null==n?void 0:n.iconColor,onPress:this._onToggleMicrophonePressed,renderIcon:e?this._renderMicrophoneActivityIcon:void 0,reverseGradientColor:!0,style:this._getButtonsGapStyle()})}return(0,a.jsx)(u.CallButton,{icon:t?M.SkypeIcon.MicrophoneOff:M.SkypeIcon.Microphone,renderIcon:e?this._renderMicrophoneActivityIcon:void 0,title:i,size:u.CallButtonSize.Large,isToggledOn:!t,onPress:this._onToggleMicrophonePressed,accessibilityLabel:i,backgroundStyle:t?u.CallButtonBackgroundStyle.Solid:u.CallButtonBackgroundStyle.Overlay})}_getVideoButton(){const e=T.getString(this.state.isVideoActive?"CallControls.CallButtonTurnOffVideoLabel":"CallControls.CallButtonTurnOnVideoLabel"),t=D._getActionButtonColorConfig(this.state.isVideoActive);return this.props.enableNewButtons?(0,a.jsx)(c.default,{icon:this.state.isVideoActive?M.SkypeIcon.Video:M.SkypeIcon.VideoOff,accessibilityLabel:e,title:e,size:c.ActionButtonSize.Medium,backgroundColor:null==t?void 0:t.backgroundColor,iconColor:null==t?void 0:t.iconColor,onPress:this._onToggleVideoPressed,disabled:!this.state.isVideoButtonEnabled,reverseGradientColor:!0,style:this._getButtonsGapStyle()}):(0,a.jsx)(u.CallButton,{icon:this.state.isVideoActive?M.SkypeIcon.Video:M.SkypeIcon.VideoOff,title:e,size:u.CallButtonSize.Large,isDisabled:!this.state.isVideoButtonEnabled,isToggledOn:this.state.isVideoActive,onPress:this._onToggleVideoPressed,accessibilityLabel:e,backgroundStyle:this.state.isVideoActive?u.CallButtonBackgroundStyle.Overlay:u.CallButtonBackgroundStyle.Solid})}_getActionButton(e,t,i,n){return(0,a.jsx)(c.default,{icon:e,title:t,accessibilityLabel:t,ref:n,backgroundColor:P.Color.gray200,iconColor:P.Color.gray400Overlay70,size:c.ActionButtonSize.Medium,onPress:i})}_getPSTNDialPadButton(){const e=T.getString("CallPanel.DialpadTooltipTitle"),t=!(this.state.callState===l.CallState.Connected||this.state.callState===l.CallState.EarlyMedia);return this.props.enableNewButtons?(0,a.jsx)(c.default,{icon:M.SkypeIcon.Dialpad,accessibilityLabel:e,title:e,size:c.ActionButtonSize.Medium,onPress:this.props.onOpenDialpad,reverseGradientColor:!0,style:this._getButtonsGapStyle(),disabled:t}):(0,a.jsx)(u.CallButton,{icon:M.SkypeIcon.Dialpad,size:u.CallButtonSize.Large,isDisabled:!(this.state.callState===l.CallState.Connected||this.state.callState===l.CallState.EarlyMedia),isToggledOn:!0,onPress:this.props.onOpenDialpad,title:T.getString("CallPanel.DialpadTooltipTitle"),accessibilityLabel:T.getString("CallPanel.DialpadTooltipTitle"),backgroundStyle:u.CallButtonBackgroundStyle.Overlay})}_getSnapshotButton(){if(!this.state.isSnapshotButtonVisible)return;const e=T.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle");return this.props.enableNewButtons?this._getActionButton(M.SkypeIcon.Snapshot,e,this._onSnapshotPressed):(0,a.jsx)(f.default,{style:B.iconControl,icon:M.SkypeIcon.Snapshot,title:e,size:M.IconSize.size24,onPress:this._onSnapshotPressed,accessibilityLabel:e,color:P.Color.white,hoverColor:P.Color.whiteOverlay20})}_getReactionButton(){if(!this.state.showReactButton||!this._reactionCommand||void 0===this.state.reactionButtonType)return;const e=m.default.getReactionButtonDescriptors(this.state.reactionButtonType,this._reactionCommand);return this.props.enableNewButtons?this._getActionButton(e.icon,e.accessibilityLabel,e.onPress):(0,a.jsx)(f.default,Object.assign({style:B.iconControl,size:M.IconSize.size24,color:P.Color.white,hoverColor:P.Color.whiteOverlay20,disabled:!this.state.isCallConnected},e))}_getChatPanelButton(){if(!this.state.isTablet)return;const e=this.props.isShowingChat?T.getString("CallPanel.CloseConversation"):T.getString("CallPanel.OpenConversation"),t=this.props.isShowingChat?M.SkypeIcon.ChatsInverted:M.SkypeIcon.Message;return this.props.enableNewButtons?this._getActionButton(t,e,this._onChatPanelButtonPressed):(0,a.jsx)(f.default,{style:B.iconControl,icon:t,title:e,accessibilityLabel:e,size:M.IconSize.size24,onPress:this._onChatPanelButtonPressed,color:P.Color.white,hoverColor:P.Color.whiteOverlay20})}_getOverflowButton(){if(this.props.isEncryptedCall||!this.state.shouldMakeSecondaryActionsAvailable)return;const e=T.getString("CallControls.CallButtonOverflowMenu"),t=this.props.enableNewButtons?this._getActionButton(M.SkypeIcon.More,e,this._showOverflowMenu,this._overflowButtonRef):(0,a.jsx)(f.default,{ref:this._overflowButtonRef,icon:M.SkypeIcon.More,title:e,size:M.IconSize.size24,onPress:this._showOverflowMenu,accessibilityLabel:e,color:P.Color.white,hoverColor:P.Color.whiteOverlay20,style:B.iconControl});return(0,a.jsx)(V.default,Object.assign({showRedDot:this.state.showRedDot},{children:t}))}_getButtonsGapStyle(){return this.props.showCallControlsVertically?void 0:B.buttonsGap}_getPrimaryControlsStyle(){return this.props.showCallControlsVertically?B.primaryControlsContainerVertical:B.primaryControlsContainer}_getButtonControlsStyle(){return this.props.showCallControlsVertically?B.buttonControlsVertical:B.buttonControls}_getContainerStyle(){return this.props.showCallControlsVertically?[B.containerVertical,this.props.style]:[B.container,this.props.style]}render(){return(0,a.jsxs)(r.View,Object.assign({style:this._getContainerStyle(),ignorePointerEvents:this.props.ignorePointerEvents,blockPointerEvents:this.props.blockPointerEvents},{children:[(0,a.jsxs)(r.View,Object.assign({style:r.Styles.combine(this._getButtonControlsStyle(),B.buttonControlsLeft)},{children:[this._getChatPanelButton(),this._getSnapshotButton(),this._getReactionButton()]})),this._getPrimaryControls(),(0,a.jsx)(r.View,Object.assign({style:r.Styles.combine(this._getButtonControlsStyle(),B.buttonControlsRight)},{children:this._getOverflowButton()}))]}))}}t.default=D},143786:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(994224),s=i(647176),r=i(480200),l=i(711930),c=i(816402),d=i(952262),u=i(746096),h=i(436237),p=i(915877),g=i(733754),C=i(581760),S=i(619675),m=i(24576),y=i(912770),f=i(853374),b=(0,p.lazyProperties)({titleContainer:()=>n.Styles.createViewStyle({flex:-1,paddingTop:6,justifyContent:"center",backgroundColor:C.Color.transparent}),headerContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",justifyContent:"flex-start",height:r.CallPanelHeaderHeight.mobile}),headerContainerLeftAligned:()=>n.Styles.createViewStyle({alignItems:"flex-start"}),firstRow:()=>n.Styles.createViewStyle({paddingTop:16,justifyContent:"center",marginBottom:8}),firstRowLeftAligned:()=>n.Styles.createViewStyle({marginBottom:1}),conversationNameText:()=>n.Styles.createTextStyle({color:C.Color.white}),callInfo:()=>n.Styles.createTextStyle({color:C.Color.whiteOverlay70})});class _ extends m.default{constructor(){super(...arguments),this._onPress=()=>{if(this.props.onTitlePress){const e=f.default.newCauseId();h.log(u.LogTraceArea.CallingUI,"MobileCallPanelHeaderTitle._onPress, causeId: "+e),this.props.onTitlePress(e,r.CallRosterOrigin.FromGroupTitle)}}}_buildState(e,t){const i=o.default.CallingStore.getConnectedAndNotOnHoldCallId(),a=!!i&&i!==e.callId;return{conversationName:d.default.getDisplayName(e.conversationMri)||g.getString("Notifications.UnknownUserShort"),activeParticipantCount:e.showParticipantCount?s.default.getActiveParticipants(e.callId,e.conversationMri).length:void 0,totalParticipantCount:e.showParticipantCount?s.default.getRosterForConversation(e.conversationMri).length:void 0,multipleCallWarning:a?g.getString("CallBanner.IncomingCallMultiCallWarning"):void 0}}render(){const e=[b.firstRow],t=[b.headerContainer,b.headerContainerLeftAligned],i=[b.conversationNameText,b.firstRowLeftAligned],o=[b.callInfo];this.props.isUsingSkypeTheme&&(i.push(n.Styles.createTextStyle({color:this._themeColors.headerTextColor},!1)),o.push(n.Styles.createTextStyle({color:this._themeColors.secondaryTextColor},!1)));const s=(0,a.jsx)(n.View,Object.assign({style:e},{children:(0,a.jsx)(S.PanelHeader,Object.assign({landscape:this.props.isLandscape,style:i,numberOfLines:1},{children:this.state.conversationName}))}));let r,l;this.props.outgoingRingStatus&&this.props.outgoingRingStatus.length&&(r=(0,a.jsx)(S.Caption,Object.assign({style:o,numberOfLines:1},{children:this.props.outgoingRingStatus}))),this.props.showParticipantCount&&this.state.activeParticipantCount&&this.state.totalParticipantCount&&(l=g.getString("CallPanel.CallRosterTitleUpper",{count:this.state.activeParticipantCount,total:this.state.totalParticipantCount}));const c=(0,a.jsx)(T,{callId:this.props.callId,isActive:this.props.isCallActive&&this.props.isSeen,participantCountText:l,textStyle:o});let d;this.state.multipleCallWarning&&(d=(0,a.jsx)(S.Caption,Object.assign({style:o},{children:this.state.multipleCallWarning})));const u=!!this.props.onTitlePress;return(0,a.jsx)(n.Button,Object.assign({style:b.titleContainer,onPress:u?this._onPress:void 0,accessibilityTraits:u?n.Types.AccessibilityTrait.Button:n.Types.AccessibilityTrait.Text,disableTouchOpacityAnimation:!u},{children:(0,a.jsxs)(n.View,Object.assign({style:t},{children:[s,r,d,c]}))}))}_subscribeToThemeChanges(){return!1}}t.default=_;class T extends m.default{constructor(){super(...arguments),this._onTimerUpdate=()=>{const e=o.default.OngoingCallService.getCallConnectedTime(this.props.callId),t=e?Date.now()-e:0;this.setState({elapsedTimeMs:t})}}_buildState(e,t){const i={};return t&&(i.elapsedTimeMs=0),i}componentDidMount(){super.componentDidMount(),this.props.isActive&&this._maybeStartTimer()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.isActive!==this.props.isActive&&this._maybeStartTimer()}componentWillUnmount(){super.componentWillUnmount(),this._startOrStopCallTimer(!1)}_maybeStartTimer(){this._startOrStopCallTimer(!!this.props.isActive)}_startOrStopCallTimer(e){e?this._timerToken||(this._timerToken=y.default.setInterval(this._onTimerUpdate,1e3),this._onTimerUpdate()):this._timerToken&&(y.default.clearInterval(this._timerToken),this._timerToken=void 0)}render(){let e=null;if(this.props.participantCountText||this.state.elapsedTimeMs>0||this.props.isActive){const t=this.state.elapsedTimeMs||this.props.isActive,i=t?c.default.getElapsedTimeStringFromMs(this.state.elapsedTimeMs):void 0,o=t?c.default.getFormattedDuration(Math.floor(this.state.elapsedTimeMs/1e3),!0):void 0,s=this.props.participantCountText&&i?(0,a.jsx)(n.Text,{children:" | "}):void 0;let r;r=this.props.participantCountText&&o?l.default.combinedAccessibilityLabel(this.props.participantCountText,o):this.props.participantCountText||o,e=(0,a.jsx)(n.View,Object.assign({accessibilityLabel:r,importantForAccessibility:n.Types.ImportantForAccessibility.Yes,accessibilityTraits:n.Types.AccessibilityTrait.Text},{children:(0,a.jsxs)(S.Caption,Object.assign({style:this.props.textStyle,numberOfLines:1,accessibilityHidden:!0},{children:[this.props.participantCountText,s,i]}))}))}return e}_subscribeToThemeChanges(){return!1}}},167354:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(889391),s=i(560787),r=i(994224),l=i(109520),c=i(109520),d=i(671830),u=i(824490),h=i(757139),p=i(626208),g=i(952262),C=i(746096),S=i(680640),m=i(436237),y=i(915877),f=i(733754),b=i(581760),_=i(711828),T=i(619675),v=i(853374),w=(0,y.lazyProperties)({containerViewBase:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",alignSelf:"stretch",backgroundColor:b.Color.transparent}),titleStyle:()=>n.Styles.createTextStyle({marginTop:30,marginHorizontal:50,textAlign:"center",color:b.Color.white}),messageStyle:()=>n.Styles.createTextStyle({marginTop:10,marginHorizontal:50,textAlign:"center",color:b.Color.whiteOverlay70}),buttonInfoStyle:()=>n.Styles.createTextStyle({marginTop:10,marginHorizontal:5,textAlign:"center",color:b.Color.whiteOverlay70}),actionPane:()=>n.Styles.createViewStyle({position:"absolute",left:0,right:0,bottom:30,alignItems:"center",alignSelf:"stretch"}),minorButtonsRowOneItem:()=>n.Styles.createViewStyle({marginBottom:30,alignContent:"center",justifyContent:"center"}),minorButtonsRowMultiItem:()=>n.Styles.createViewStyle({marginBottom:30,marginHorizontal:100,flexDirection:"row",alignSelf:"stretch",alignContent:"center",justifyContent:"space-between"}),majorButtonsRow:()=>n.Styles.createViewStyle({marginVertical:20,marginHorizontal:60,flexDirection:"row",alignSelf:"stretch",alignContent:"center",justifyContent:"space-between"})});class I extends S.IncomingRingControlsBase{constructor(e){super(c.CallControlContext.MobileIncomingRingPanel,e),this._onMessageButtonRef=e=>{this._callMessageButton=e||void 0},this._onRejectCall=()=>{this._rejectCommand.execute(),m.track(new l.MobileCallAnswerEvent(l.MobileCallAnswerActions.Declined,0))},this._onAnswerCallWithVideo=()=>{this._answerCommand.execute(!0),m.track(new l.MobileCallAnswerEvent(l.MobileCallAnswerActions.AnsweredWithVideo,0))},this._onAnswerCall=()=>{this._answerCommand.execute(),m.track(new l.MobileCallAnswerEvent(l.MobileCallAnswerActions.AnsweredWithAudio,0))},this._onMesageBack=()=>{const e=v.default.newCauseId();r.default.OngoingCallService.stopCallSounds(this.props.callId,e);const t={callId:this.props.callId,conversationMri:this.props.conversationMri,onClose:this._closeMessagePrompt},i=(0,a.jsx)(p.default,Object.assign({},t)),n=p.default.getMenuHeight(),o={headerType:u.HeaderType.Slim,hideCloseButton:!0};h.default.showWithContent({menuId:h.default.menuId(),anchor:()=>this._callMessageButton,rootViewId:this._getRootViewId(),menuHeight:n,content:i,onCloseMenu:this._closeMessagePrompt,getTitle:()=>{},headerConfig:o,backgroundColor:b.Color.black},e)},this._closeMessagePrompt=()=>{const e=v.default.newCauseId();m.log(C.LogTraceArea.CallingUI,"MobileIncomingRingPanel._closeMessagePrompt causeId: "+e),h.default.close(this._getRootViewId(),e)}}_buildState(e,t){this._initializeCommands(e,!0);const i=r.default.CallingStore.getConnectedAndNotOnHoldCallId();return{conversationName:g.default.getDisplayName(e.conversationMri)||f.getString("Notifications.UnknownUserShort"),allowVideoButton:this._answerCommand.canExecuteWithVideo(),withVideo:r.default.CallingStore.incomingCallHasVideo(e.callId),isGroupCall:d.isGroupConversation(e.conversationMri),connectedToAnotherCall:!!i&&i!==e.callId,showMessageButton:o.default.getS4LCMCFeatures().enableDeclineAndMessageOnRingControls&&!r.default.CallingStore.isPSTNCall(e.callId)}}_colorConfig(e){return{iconColor:b.Color.white,backgroundColor:e,selectedIconColor:b.Color.white,selectedBackgroundColor:e}}render(){return(0,a.jsxs)(n.View,Object.assign({style:[w.containerViewBase,this.props.style]},{children:[this._renderTitle(),this._renderCallInfo(),(0,a.jsx)(n.View,Object.assign({style:w.actionPane},{children:this._renderCallButtons()}))]}))}_renderTitle(){const e=this.props.useLightTheme?[w.titleStyle,this._themeStyles.headerTextColorStyle]:[w.titleStyle];return(0,a.jsx)(T.PanelHeader,Object.assign({style:e,numberOfLines:1},{children:this.state.conversationName}))}_renderCaption(e,t){return(0,a.jsx)(T.Caption,Object.assign({style:t},{children:e}))}_renderCallInfo(){const e=this.props.useLightTheme?[w.messageStyle,this._themeStyles.headerTextColorStyle]:[w.messageStyle];return this._renderCaption(this._getIncomingCallStrings(),e)}_renderCallButtons(){let e;const t=this.props.useLightTheme?[w.buttonInfoStyle,this._themeStyles.headerTextColorStyle]:[w.buttonInfoStyle],i=this.props.useLightTheme?b.Color.gray300Overlay80:b.Color.gray200Overlay20;if(this.state.allowVideoButton){const i=f.getString("MobileIncomingCallPanel.CallButtonVideoLabel",{conversationName:this.state.conversationName});e=(0,a.jsxs)(n.View,{children:[(0,a.jsx)(s.CallButton,{icon:_.SkypeIcon.Video,isToggledOn:!1,title:i,onPress:this._onAnswerCallWithVideo,size:s.CallButtonSize.ExtraLarge,accessibilityLabel:i,colorConfig:this._colorConfig(b.Color.green)}),this._renderCaption(f.getString("MobileIncomingCallPanel.VideoButtonText"),t)]})}const o=f.getString("MobileIncomingCallPanel.CallButtonAudioLabel",{conversationName:this.state.conversationName}),r=f.getString("MobileIncomingCallPanel.CallButtonDeclineLabel"),l=f.getString("MobileIncomingCallPanel.CallButtonMessageBackLabel",{conversationName:this.state.conversationName}),c=(0,a.jsxs)(n.View,{children:[(0,a.jsx)(s.CallButton,{ref:this._onAnswerCallButtonRef,icon:_.SkypeIcon.CallStart,isToggledOn:!1,title:o,onPress:this._onAnswerCall,size:e?s.CallButtonSize.Small:s.CallButtonSize.ExtraLarge,accessibilityLabel:o,colorConfig:this._colorConfig(e?i:b.Color.green),isSquareButton:!!e}),this._renderCaption(f.getString("MobileIncomingCallPanel.AudioButtonText"),t)]}),d=(0,a.jsxs)(n.View,{children:[(0,a.jsx)(s.CallButton,{icon:_.SkypeIcon.CallEnd,isToggledOn:!1,title:r,onPress:this._onRejectCall,isCallEndButton:!0,size:s.CallButtonSize.ExtraLarge,accessibilityLabel:r,colorConfig:this._colorConfig(b.Color.red)}),this._renderCaption(f.getString("MobileIncomingCallPanel.DeclineButtonText"),t)]});let u;if(this.state.showMessageButton&&(u=(0,a.jsxs)(n.View,{children:[(0,a.jsx)(s.CallButton,{ref:this._onMessageButtonRef,icon:_.SkypeIcon.Message,isToggledOn:!1,title:l,onPress:this._onMesageBack,size:s.CallButtonSize.Small,accessibilityLabel:l,colorConfig:this._colorConfig(i),isSquareButton:!0}),this._renderCaption(f.getString("MobileIncomingCallPanel.MessageButtonText"),t)]})),e){const t=u?w.minorButtonsRowMultiItem:w.minorButtonsRowOneItem;return[(0,a.jsxs)(n.View,Object.assign({style:t},{children:[u,c]}),"minorRow"),(0,a.jsxs)(n.View,Object.assign({style:w.majorButtonsRow},{children:[d,e]}),"majorRow")]}return[(0,a.jsx)(n.View,Object.assign({style:w.minorButtonsRowOneItem},{children:u}),"minorRow"),(0,a.jsxs)(n.View,Object.assign({style:w.majorButtonsRow},{children:[d,c]}),"majorRow")]}_getIncomingCallStrings(){return this.state.connectedToAnotherCall?f.getString("CallBanner.IncomingCallMergeCallWarning"):this.state.isGroupCall?f.getString("MobileIncomingCallPanel.IncomingCall"):this.state.withVideo?f.getString("MobileIncomingCallPanel.IncomingVideoCall"):f.getString("MobileIncomingCallPanel.IncomingAudioCall")}}t.default=I},333643:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(746096),r=i(110117),l=i(436237),c=i(915877),d=i(733754),u=i(824932),h=i(581760),p=i(711828),g=i(619675),C=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),icon:()=>n.Styles.createViewStyle({marginRight:10})});class S extends o.ComponentBase{constructor(){super(...arguments),this._onStopPress=e=>{l.log(s.LogTraceArea.CallingUI,"MobileScreenShareBanner disable screen-share clicked");new u.MobileScreenShareToggleCommand(this.props).execute()}}render(){return(0,a.jsxs)(n.View,Object.assign({style:C.container},{children:[(0,a.jsx)(r.default,{style:C.icon,icon:p.SkypeIcon.ScreenShare,size:p.IconSize.size24,color:h.Color.white}),(0,a.jsxs)(n.View,Object.assign({style:this.props.containerStyle},{children:[(0,a.jsx)(g.BodyText,Object.assign({style:this.props.textStyle,numberOfLines:1},{children:d.getString("MobileScreenSharingToast.BannerTitle")})),(0,a.jsx)(n.Button,Object.assign({onPress:this._onStopPress},{children:(0,a.jsx)(g.BodyText,Object.assign({style:this.props.linkStyle},{children:d.getString("MobileScreenSharingToast.StopSharingLinkText")}))}))]}))]}))}}t.default=S},901838:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoEventsLayoutController=t.PhotoEventItemLayoutController=void 0;const a=i(496486),n=i(516778),o=i(889391),s=i(480200),r=i(746096),l=i(436237),c=i(262232),d=i(450795),u=i(912770),h=i(853374),p={width:300,height:300};class g{constructor(e,t,i,a,o,s,r,l,d=10,u=10){if(this._hasBeenPresented=!1,this._hasBeenDismissed=!1,this._isPanning=!1,this._viewRect={x:0,y:0,width:0,height:0},this._animatedVerticalValue=new n.Animated.Value(0),this._animatedHorizontalValue=new n.Animated.Value(0),this._animatedHeightValue=new n.Animated.Value(1),this._animatedWidthValue=new n.Animated.Value(1),this._animatedTransfromValueForScale=new n.Animated.Value(0),this._animatedTransformValueForX=new n.Animated.Value(0),this._animatedTransformValueForY=new n.Animated.Value(0),this._incomingPhotoSound=c.default.SkypeShutter,this._id=e,this._parentViewDimensions=t,this._onWillRemoveItem=a,this._onDidRemoveItem=o,this._onPanItem=i,this._isDesktop=s,this._animationDirection=r,this._bottomMargin=d,this._desktopSideMargin=u,l&&l.width&&l.height){let e,t;l.width>l.height?(e=p.width,t=p.width*(l.height/l.width)):(t=260,e=p.height*(l.width/l.height)),e=Math.max(e,260),t=Math.max(t,260),this._containerDimensions={width:e,height:t}}else this._containerDimensions=p;const h=this._animationOffset();this._animatedTransformValue=new n.Animated.Value(h),this._rectStyleForMobile=n.Styles.createAnimatedViewStyle({left:this._animatedHorizontalValue,bottom:this._animatedVerticalValue,height:this._animatedHeightValue,width:this._animatedWidthValue});const g={bottom:this._bottomMargin,height:this._containerDimensions.height,width:this._containerDimensions.width};g.right=this._desktopSideMargin,this._rectStyleForDesktop=n.Styles.createViewStyle(g,!1),this._setPositionStyle(),this._imageStyle=n.Styles.createImageStyle({width:this._containerDimensions.width,height:this._containerDimensions.height},!1)}_setPositionStyle(){switch(this._animationDirection){case s.PhotoAnimationDirection.Zoom:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateX:this._animatedTransformValueForX},{translateY:this._animatedTransformValueForY},{scale:this._animatedTransfromValueForScale}],opacity:this._animatedTransfromValueForScale});break;case s.PhotoAnimationDirection.Up:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._animatedTransformValue}]});break;default:this._positionStyle=n.Styles.createAnimatedViewStyle({transform:[{translateX:this._animatedTransformValue}]})}}getRectStyles(){return this._isDesktop?this._rectStyleForDesktop:this._rectStyleForMobile}getPositionStyles(){return this._positionStyle}getImageStyle(){return this._imageStyle}presentItemIfReady(e=!0){if(this._hasBeenPresented)return!1;this._hasBeenPresented=!0;const t=h.default.newCauseId();l.log(r.LogTraceArea.GenericUnsafe,"PhotoEventItemLayoutController.presentItemIfReady causeId: "+t),this._incomingPhotoSound.playOnce(t);const i=o.default.getS4LCMCFeaturesNoSubscription().photoEventTimeoutMs;return this._isDesktop?this._updateAnimatedPositionForDesktop(this._itemRect(),0,!0,1,!1,(()=>this._startDismissTimer(i))):this._updateAnimatedPosition(this._itemRect(),0,!1,e,(()=>this._startDismissTimer(i))),!0}_itemRect(){const e=this._containerDimensions;let t,i;return this._isDesktop?(t=this._desktopSideMargin,i=this._bottomMargin):(t=(this._parentViewDimensions.width-e.width)/2,i=(this._parentViewDimensions.height-e.height)/2),Object.assign({x:t,y:i},e)}dismissItem(e=!0){return!this._hasBeenDismissed&&!this._isPanning&&(this._onWillRemoveItem&&this._onWillRemoveItem(this._id),this._clearDismissTimer(),this._isDesktop?this._updateAnimatedPositionForDesktop({x:this._desktopSideMargin-this._desktopSideMargin/2,y:this._bottomMargin-this._bottomMargin/2,width:0,height:0},this._animationOffset(),e,0,e,(()=>{u.default.setTimeout((()=>{this._onDidRemoveItem&&this._onDidRemoveItem(this._id)}),1e3)})):this._updateAnimatedPosition(this._viewRect,this._animationOffset(),!1,e,(()=>{this._onDidRemoveItem&&this._onDidRemoveItem(this._id)})),this._hasBeenDismissed=!0,!0)}onPan(e){if(this._hasBeenDismissed||!this._hasBeenPresented||this._animationDirection===s.PhotoAnimationDirection.Up)return;let t=e.pageX-e.initialPageX;this._animationDirection===s.PhotoAnimationDirection.Left&&t<0?t=-1*Math.sqrt(Math.abs(t)):this._animationDirection===s.PhotoAnimationDirection.Right&&t>0&&(t=Math.sqrt(Math.abs(t))),this._animatedTransformValue.setValue(t),e.isComplete?this._isPanning&&(this._isPanning=!1,this._onPanItem(!1),this.dismissItem()):this._isPanning||(this._isPanning=!0,this._onPanItem(!0))}_animationOffset(){if(!this._parentViewDimensions)return 0;switch(this._animationDirection){case s.PhotoAnimationDirection.Left:return this._parentViewDimensions.width-this._viewRect.x;case s.PhotoAnimationDirection.Right:return-1*(this._parentViewDimensions.width-this._viewRect.x);case s.PhotoAnimationDirection.Up:return this._containerDimensions.height+300;case s.PhotoAnimationDirection.Zoom:return(this._containerDimensions.height+10)/2}return 0}_clearDismissTimer(){this._dismissTimer&&(u.default.clearTimeout(this._dismissTimer),this._dismissTimer=void 0)}_startDismissTimer(e){this._clearDismissTimer(),this._dismissTimer=u.default.setTimeout((()=>this.dismissItem(!0)),e)}updateViewDimensions(e){this._parentViewDimensions=e;const t=this._itemRect();this._animatedVerticalValue.setValue(t.y),this._animatedHorizontalValue.setValue(t.x),this._animatedWidthValue.setValue(t.width),this._animatedHeightValue.setValue(t.height)}_updateAnimatedPositionForDesktop(e,t,i=!0,o,s=!0,r,l){if(this._hasBeenDismissed)return;const c=l||[];i?c.push(d.default.easeOut({value:this._animatedTransfromValueForScale,toValue:o})):this._animatedTransfromValueForScale.setValue(o),s?(c.push(d.default.easeOut({value:this._animatedTransformValueForX,toValue:-1*t})),c.push(d.default.easeOut({value:this._animatedTransformValueForY,toValue:t}))):(this._animatedTransformValueForX.setValue(-1*t),this._animatedTransformValueForY.setValue(t)),a.isEmpty(c)?r&&r():n.Animated.parallel(c).start((e=>{r&&r()})),this._viewRect=e}_updateAnimatedPosition(e,t,i=!0,o=!0,s,r){if(this._hasBeenDismissed)return;const l=r||[];i?(l.push(d.default.easeOut({value:this._animatedVerticalValue,toValue:e.y})),l.push(d.default.easeOut({value:this._animatedHorizontalValue,toValue:e.x})),l.push(d.default.easeOut({value:this._animatedWidthValue,toValue:e.width})),l.push(d.default.easeOut({value:this._animatedHeightValue,toValue:e.height}))):(this._animatedVerticalValue.setValue(e.y),this._animatedHorizontalValue.setValue(e.x),this._animatedWidthValue.setValue(e.width),this._animatedHeightValue.setValue(e.height)),o?l.push(d.default.easeOut({value:this._animatedTransformValue,toValue:t})):this._animatedTransformValue.setValue(t),a.isEmpty(l)?s&&s():n.Animated.parallel(l).start((e=>{s&&s()})),this._viewRect=e}}t.PhotoEventItemLayoutController=g;t.PhotoEventsLayoutController=class{constructor(e,t,i,a){this._controllers={},this._orderedKeys=[],this._isDesktop=e,this._animationDirection=t,this._bottomMargin=i,this._desktopSideMargin=a}updateViewDimensions(e){this._viewDimensions=e,a.each(this._controllers,(t=>t.updateViewDimensions(e)))}setCallbacks(e,t,i){this._onWillRemoveItem=e,this._onDidRemoveItem=t,this._onPanItem=i}clearEvents(e){a.each(this._controllers,((t,i)=>{i!==e&&(this._isDesktop?t.dismissItem(!1):t.dismissItem())}))}dismissItem(e){const t=this.existingControllerForKey(e);t&&t.dismissItem()}presentItemIfReady(e,t=!0){const i=this.existingControllerForKey(e);i&&i.presentItemIfReady(t)}existingControllerForKey(e){return this._intControllerForKey(e,!1)}controllerForKey(e,t,i){return this._intControllerForKey(e,!0,t,i)}_intControllerForKey(e,t,i,a){let n=this._controllers[e];return!n&&t&&(n=new g(e,this._viewDimensions,this._onPanItem,this._onWillRemoveItem,this._onDidRemoveItem,this._isDesktop,i&&!this._isDesktop?s.PhotoAnimationDirection.Up:this._animationDirection,a,this._bottomMargin,this._desktopSideMargin),this._controllers[e]=n,this._orderedKeys.push(e)),n}removeControllerForKey(e){delete this._controllers[e],this._orderedKeys=a.without(this._orderedKeys,e)}}},109440:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(174958),o=i(496486),s=i(516778),r=i(217041),l=i(278968),c=i(480200),d=i(986374),u=i(746096),h=i(436237),p=i(915877),g=i(312762),C=i(18078),S=i(330124),m=i(901838),y=i(777554),f=i(581760),b=i(912770),_=i(853374),T=(0,p.lazyProperties)({container:()=>s.Styles.createViewStyle({backgroundColor:f.Color.transparent}),dismissalView:()=>s.Styles.createViewStyle({position:"absolute",left:0,top:0,right:0,bottom:0,backgroundColor:f.Color.transparent})});class v extends r.ComponentBase{constructor(){super(...arguments),this._backgroundColorValue=new s.Animated.Value(0),this._backgroundColorStyle=s.Styles.createAnimatedViewStyle({backgroundColor:this._backgroundColorValue.interpolate({inputRange:[0,1],outputRange:[f.Color.transparent,f.Color.blackOverlay50]})}),this._isPanning=!1,this._onWillRemoveItem=e=>{this.state.itemRenderInfo.length<=1&&this._toggleBackgroundColor(!1)},this._onDidRemoveItem=e=>{this.isComponentMounted()&&(this._layoutController.removeControllerForKey(e),this.setState(this._removeStreamItemsAndReturnNewState(e)))},this._onPanItem=e=>{this._isPanning=e},this._renderItem=e=>{const t=e.id,i=e.item;return(0,a.jsx)(y.default,{eventId:t,mri:i.mri,message:i.message,layoutController:e.layoutController,onPan:this._onPan,onTap:this._onTap,onLoad:this._onItemLoad,onClose:this._onClose},t)},this._onClose=e=>{this._layoutController.dismissItem(e),this.props.onPhotoDismissed&&this.props.onPhotoDismissed()},this._onPan=(e,t)=>{const i=this._layoutController.existingControllerForKey(e);i&&i.onPan(t)},this._onTap=(e,t)=>{const i=_.default.newCauseId(),a=o.findIndex(this.state.itemRenderInfo,(t=>t.id===e)),s=-1!==a?this.state.itemRenderInfo[a].item.message:void 0;h.log(u.LogTraceArea.CallReactions,"PhotoEventStream onTap "+n.pii.Omit(e)+" message: "+(s?s.cuid:"none")+" causeId: "+i),this.props.isDesktop||this._layoutController.clearEvents(),this.props.photoTapDelay?b.default.setTimeout((()=>{this.isComponentMounted()&&this.props.onPhotoTap&&this.props.onPhotoTap(s,t,i)}),this.props.photoTapDelay):this.props.onPhotoTap&&this.props.onPhotoTap(s,t,i),this.props.isDesktop&&b.default.setTimeout((()=>{this._layoutController.clearEvents()}),500),s&&!C.default.isMyMri(s.creator)&&l.default.markOneIncomingPhotoSeen(this.props.reactionsConversationMri)},this._onDismissalTap=()=>{this.clearEvents()},this._onItemLoad=e=>{this.isComponentMounted()&&(this.props.isDesktop||this._toggleBackgroundColor(!0),this._layoutController.clearEvents(e),this._layoutController.presentItemIfReady(e))},this._toggleBackgroundColor=(e,t)=>{s.Animated.timing(this._backgroundColorValue,{toValue:e?1:0,duration:200,easing:s.Animated.Easing.InOut()}).start(t)},this._onLayoutChange=e=>{this._layoutController.updateViewDimensions({width:e.width,height:e.height})}}_buildState(e,t){const i={};if(t){this._eventCount=0;const t=e.isDesktop?c.PhotoAnimationDirection.Zoom:S.default.isUsingStackNavigationContext()?c.PhotoAnimationDirection.Right:c.PhotoAnimationDirection.Left;this._layoutController=new m.PhotoEventsLayoutController(!!e.isDesktop,t,e.bottomMargin,e.desktopSideMargin),i.itemRenderInfo=[]}return i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._layoutController.setCallbacks((e=>this._onWillRemoveItem(e)),(e=>this._onDidRemoveItem(e)),(e=>this._onPanItem(e)))}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.itemRenderInfo.length&&!t.itemRenderInfo.length&&this._toggleBackgroundColor(!1)}photoEvent(e,t){if(this._isPanning)return;const i=o.clone(this.state.itemRenderInfo),a="photo_"+this._eventCount++,n=C.default.isMyMri(e.creator),s=d.decode(e);let r;if(this.props.sizePhotosToFit){const e=s.getFirstUriObjectChild(g.PictureNode);if(e){const t=e.getOriginalDimensions();t.width&&t.height&&(r=t)}}h.log(u.LogTraceArea.CallReactions,"PhotoEventStream photoEvent  intrinsicSize "+(r?r.width+", "+r.height:"none")+" message: "+e.cuid);const l=this._layoutController.controllerForKey(a,n,r);i.push({id:a,item:{mri:t,message:e},layoutController:l}),this.setState({itemRenderInfo:i})}clearEvents(){this._layoutController.clearEvents()}_removeStreamItemsAndReturnNewState(e){const t=o.clone(this.state.itemRenderInfo);return{itemRenderInfo:o.filter(t,(t=>t.id!==e))}}render(){const e=o.map(this.state.itemRenderInfo,this._renderItem),t=[T.container,this.props.isDesktop?void 0:this._backgroundColorStyle,this.props.style],i=!this.props.isDesktop&&e.length>0?(0,a.jsx)(s.View,{style:T.dismissalView,onPress:this._onDismissalTap}):void 0;return(0,a.jsxs)(s.Animated.View,Object.assign({style:t,onLayout:this._onLayoutChange,ignorePointerEvents:!0},{children:[i,e]}))}}t.default=v},777554:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhotoEventStreamItem=void 0;const a=i(785893),n=i(516778),o=i(217041),s=i(986374),r=i(139889),l=i(139285),c=i(136400),d=i(110117),u=i(915877),h=i(733754),p=i(312762),g=i(18078),C=i(581760),S=i(711828),m=i(680837),y=i(675865),f=i(702301),b=i(567977),_=(0,u.lazyProperties)({container:()=>n.Styles.createViewStyle({position:"absolute"}),innerContainer:()=>n.Styles.createViewStyle({borderRadius:10,backgroundColor:C.Color.white,justifyContent:"center",alignItems:"flex-end",flexDirection:"row"}),imageView:()=>n.Styles.createViewStyle({borderTopLeftRadius:10,borderTopRightRadius:10}),imageViewNoFooter:()=>n.Styles.createViewStyle({borderRadius:10}),attributionView:()=>n.Styles.createViewStyle({position:"absolute",top:10,left:10}),closeButtonContainer:()=>n.Styles.createViewStyle({position:"absolute",top:0,right:0,width:50,height:50,alignItems:"center",justifyContent:"center"}),closeButton:()=>n.Styles.createViewStyle({backgroundColor:C.Color.blackOverlay35,width:30,height:30,borderRadius:15,alignItems:"center",justifyContent:"center"})});class T extends o.ComponentBase{constructor(){super(...arguments),this._onPan=e=>{this.props.onPan&&this.props.onPan(this.props.eventId,e)},this._onComponentRef=e=>{this._viewRef=e||void 0},this._onTap=e=>{this.props.onTap&&this.props.onTap(this.props.eventId,this._getRef)},this._getRef=()=>this.isComponentMounted()?this._viewRef:void 0,this._onLoad=e=>{this.props.onLoad&&this.props.onLoad(this.props.eventId)},this._onClose=()=>{this.props.onClose&&this.props.onClose(this.props.eventId)}}_buildState(e,t){let i,a=!1;if(e.message){const t=s.decode(e.message).getFirstUriObjectChild(p.PictureNode);i=t&&t.getDisplayUrlAsThumbnailSanitized(),a=g.default.isMyMri(e.message.creator)}return{thumbnailUrl:i?y.default.getAuthenticatedUrl(i):void 0,postedByCurrentUser:a}}render(){const e=[_.container,m.default.overflowVisible],t=[m.default.absoluteFill,_.innerContainer],i=[this.state.postedByCurrentUser?_.imageViewNoFooter:_.imageView];this.props.layoutController&&(e.push(this.props.layoutController.getRectStyles()),i.push(this.props.layoutController.getImageStyle()),t.push(this.props.layoutController.getPositionStyles()));const o=(0,a.jsx)(l.default,Object.assign({style:_.attributionView},{children:(0,a.jsx)(f.UserIcon,{userMri:this.props.message.creator,size:b.UserIconSize.Size30})}),"attribution"),s=this.props.onClose?(0,a.jsx)(c.HoverableButton,Object.assign({style:_.closeButtonContainer,accessibilityLabel:h.getString("CallPanel.ClosePhoto"),onPress:this._onClose},{children:(0,a.jsx)(n.View,Object.assign({style:_.closeButton},{children:(0,a.jsx)(d.default,{icon:S.SkypeIcon.Cancel,size:S.IconSize.size16,color:C.Color.white})}))}),"closebutton"):void 0,u=[m.default.absoluteFill,m.default.pointerCursor],p=[(0,a.jsx)(n.GestureView,Object.assign({style:u,onPanHorizontal:this._onPan,onTap:this._onTap},{children:(0,a.jsx)(r.default,{origin:"PhotoEvent",containerStyle:m.default.absoluteFill,style:i,source:this.state.thumbnailUrl,resizeMode:"cover",onLoad:this._onLoad})}),"imagecontainer"),o,s],g=(0,a.jsx)(n.Animated.View,Object.assign({style:t,ignorePointerEvents:!0},{children:p}));return(0,a.jsx)(n.Animated.View,Object.assign({ref:this._onComponentRef,style:e,ignorePointerEvents:!0},{children:g}))}}t.PhotoEventStreamItem=T,t.default=T},7015:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalPrivacyToastComponent=t.RemotePrivacyToastComponent=void 0;const a=i(785893),n=i(516778),o=i(561541),s=i(994224),r=i(568580),l=i(480200),c=i(898278),d=i(944973),u=i(953143),h=i(952262),p=i(746096),g=i(913944),C=i(436237),S=i(915877),m=i(733754),y=i(581760),f=i(711828),b=i(359433),_=i(619675),T=i(418037),v=(0,S.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,justifyContent:"center",paddingHorizontal:c.CompositeNotificationToastInfo.horizontal,paddingVertical:10}),leftContentContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingHorizontal:10}),stopRecordingContentContainer:()=>n.Styles.createViewStyle({paddingHorizontal:5,flexDirection:"row"}),statusContentContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row"}),privacyStatementContainer:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row"}),privacyStatementTextStyle:()=>n.Styles.createTextStyle({flex:1,color:y.Color.white,wordBreak:"break-word",paddingRight:10,textAlign:"right"}),statusTextStyle:()=>n.Styles.createTextStyle({flex:1,wordBreak:"break-word",paddingLeft:10}),linkStyle:()=>n.Styles.createTextStyle({color:y.Color.sxBlue})});class w extends o.RemoteBaseCallRecorderToast{constructor(){super(...arguments),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss(),this._cleanToastMessage(!0)}}_buildState(e,t){const i=u.default.getToast(e.id);if(i&&i.state){const t=i.state,a=s.default.CallingStore.getCallState(t.callId);return{callId:t.callId,callState:a,shouldToastBeRemoved:e.shouldToastBeRemoved(a),initiatorDisplayName:e.initiatorMri?h.default.getMemberShortNameForConversation(t.conversationMri,e.initiatorMri):void 0}}return{}}render(){const e=(0,a.jsx)(d.default,{icons:this.props.icons});let t,i;this.state.initiatorDisplayName?t=m.getString(this.props.notificationTextPath,{name:this.state.initiatorDisplayName}):this.props.initialNotificationTextPath&&(t=m.getString(this.props.initialNotificationTextPath)),t&&(i=(0,a.jsx)(_.BodyText,Object.assign({style:[v.statusTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1},{children:t})));const o=this.props.onDismiss?this._renderCloseButton():void 0;return(0,a.jsx)(n.View,Object.assign({style:v.container},{children:(0,a.jsx)(n.View,Object.assign({style:v.leftContentContainer},{children:(0,a.jsxs)(n.View,Object.assign({style:v.statusContentContainer},{children:[e,i,o]}))}))}))}_cleanToastMessage(e){(this.state.shouldToastBeRemoved||!r.default.isCallStateActive(this.state.callState)||e)&&(C.log(p.LogTraceArea.CallingUI,`[RemotePrivacyToastComponent][_cleanToast] removing toast with toast id: ${this.props.id}}`),u.default.removeToast(this.props.id))}_renderCloseButton(){return(0,a.jsx)(g.default,{icon:f.SkypeIcon.ClosePanel,size:f.IconSize.size20,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,title:m.getString("Global.CloseButtonTitle"),onPress:this._onDismiss})}componentDidMount(){super.componentDidMount(),this._cleanToastMessage()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._cleanToastMessage()}componentWillUnmount(){super.componentWillUnmount(),this._cleanToastMessage()}}t.RemotePrivacyToastComponent=w;class I extends o.LocalBaseCallRecorderToast{_buildState(e,t){const i=u.default.getToast(e.id);if(i&&i.state){const a=i.state,n=s.default.CallingStore.getCallState(a.callId);return{callId:a.callId,showPrivacyLink:t||!(!this.state||!this.state.showPrivacyLink),callState:n,shouldToastBeRemoved:e.shouldToastBeRemoved(n),recordingTimestamp:e.getTimestamp(),isAccessibleTheme:T.default.isAccessibleTheme()}}return{}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.shouldToastBeRemoved&&(C.log(p.LogTraceArea.CallingUI,"LocalPrivacyToastComponent.componentDidUpdate removing toast"),u.default.removeToast(this.props.id,l.ToastActionType.Dismissed,!0))}render(){const e=[{icon:f.SkypeIcon.CallRecordStroke,color:this._themeColors.headerIconColor},{icon:f.SkypeIcon.CallRecordDot,color:y.Color.red}],t=(0,a.jsx)(n.Button,Object.assign({onPress:this._onStopPress,accessibilityLabel:m.getString(this.props.stopLinkTextPath)},{children:(0,a.jsx)(d.default,{icons:e})}));let i;this.state.recordingTimestamp&&(i=(0,a.jsx)(_.BodyText,Object.assign({style:[v.statusTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1},{children:this._getElapsedTime()})));const o=(0,a.jsxs)(n.View,Object.assign({style:v.stopRecordingContentContainer},{children:[i,(0,a.jsx)(_.BodyText,Object.assign({style:v.statusTextStyle,allowFontScaling:!1},{children:(0,a.jsx)(b.default,Object.assign({url:"#",style:this.state.isAccessibleTheme?this._themeStyles.headerTextColorStyle:v.linkStyle,allowFontScaling:!1,onPress:this._onStopPress},{children:m.getString(this.props.stopLinkTextPath)}))}))]}));let s;if(this.state.showPrivacyLink){const e=(0,a.jsx)(b.default,Object.assign({url:"#",style:this.state.isAccessibleTheme?this._themeStyles.headerTextColorStyle:v.linkStyle,allowFontScaling:!1,onPress:this._onMorePrivacyInfoPress},{children:m.getString(this.props.morePrivacyInfoLinkTextPath)}));s=(0,a.jsxs)(n.View,Object.assign({style:v.privacyStatementContainer},{children:[(0,a.jsx)(_.BodyText,Object.assign({style:[v.privacyStatementTextStyle,this._themeStyles.headerTextColorStyle],allowFontScaling:!1},{children:m.getParts(this.props.privacyStatementTextPath,{learnMoreLink:e})})),(0,a.jsx)(g.default,{icon:f.SkypeIcon.ClosePanel,size:f.IconSize.size20,color:this._themeColors.headerIconColor,hoverColor:this._themeColors.primaryIconColor,title:m.getString("Global.CloseButtonTitle"),onPress:this._onDismissPrivacyInfoPress})]}))}return(0,a.jsx)(n.View,Object.assign({style:v.container},{children:(0,a.jsx)(n.View,Object.assign({style:v.leftContentContainer},{children:(0,a.jsxs)(n.View,Object.assign({style:v.statusContentContainer},{children:[t,o,s]}))}))}))}}t.LocalPrivacyToastComponent=I},23680:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(680837),s=i(24576);class r extends s.default{constructor(){super(...arguments),this._isBalancePanelCollapsed=!1,this._balancePanelExpandedAnimatedHeight=new n.Animated.Value(0),this._balancePanelExpandedAnimatedStyles=n.Styles.createAnimatedViewStyle({height:this._balancePanelExpandedAnimatedHeight}),this._isBalancePanelCollapsedOnCompletion=!1,this._isCollapsed=()=>this._isBalancePanelCollapsed||this._isBalancePanelCollapsedOnCompletion,this.toggleBalancePanelVisibility=e=>{if(!this.state.balancePanelExpandedHeight||!this._balancePanelExpandedAnimatedHeight)return;if(this._isBalancePanelCollapsed===e)return;if(this.props.onCannotToggle&&this.props.onCannotToggle(e))return;if(this._balancePanelInProgressAnimation){if(this._isBalancePanelCollapsedOnCompletion===e)return;this._balancePanelInProgressAnimation.stop(),this._balancePanelInProgressAnimation=void 0}this._isBalancePanelCollapsedOnCompletion=e;const t=[];e?t.push(n.Animated.timing(this._balancePanelExpandedAnimatedHeight,{toValue:0,duration:10,easing:n.Animated.Easing.Out(),isInteraction:!1})):t.push(n.Animated.timing(this._balancePanelExpandedAnimatedHeight,{toValue:this.state.balancePanelExpandedHeight,duration:10,easing:n.Animated.Easing.In()}));const i=e=>{this._balancePanelInProgressAnimation=void 0,this._isBalancePanelCollapsed=e,this.forceUpdate()};this._balancePanelInProgressAnimation=n.Animated.parallel(t),this._balancePanelInProgressAnimation.start((()=>{i(e)}))},this._onLayout=e=>{this.state.balancePanelExpandedHeight||!this.isComponentMounted()||this.props.isInLandscape||this._isCollapsed()||(this._balancePanelExpandedAnimatedHeight.setValue(e.height),this.setState({balancePanelExpandedHeight:e.height,useAnimatedLayout:!0}))}}_buildState(e,t){return{balancePanelExpandedHeight:t?void 0:this.state.balancePanelExpandedHeight,useAnimatedLayout:!t&&this.state.useAnimatedLayout}}render(){let e;return n.UserInterface.isNavigatingWithKeyboard()&&this._isBalancePanelCollapsed&&(e=o.default.displayNone),!this.props.isInLandscape&&this.state.useAnimatedLayout?(0,a.jsx)(n.View,Object.assign({style:e,onLayout:this._onLayout},{children:(0,a.jsx)(n.Animated.View,Object.assign({style:this._balancePanelExpandedAnimatedStyles},{children:this.props.children}))})):(0,a.jsx)(n.View,Object.assign({style:e,onLayout:this._onLayout},{children:this.props.children}))}}t.default=r},745247:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(913944),s=i(915877),r=i(733754),l=i(29130),c=i(581760),d=i(711828),u=i(680837),h=i(24576),p=(0,s.lazyProperties)({dialerWrapper:()=>n.Styles.createViewStyle({backgroundColor:c.Color.darkThemeSecondaryBackground,flexDirection:"column",flexGrow:1,flexShrink:0,overflow:"visible"}),collapsedDialpadButtonContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center"}),dialpadIcon:()=>n.Styles.createButtonStyle({borderRadius:20,flexGrow:1,paddingVertical:15})});class g extends h.default{constructor(){super(...arguments),this._isDialpadCollapsed=!1,this._useAnimatedLayout=!1,this._dialpadExpandedAnimatedHeight=new n.Animated.Value(0),this._dialpadExpandedAnimatedStyles=n.Styles.createAnimatedViewStyle({height:this._dialpadExpandedAnimatedHeight}),this._dialpadCollapsedAnimatedHeight=new n.Animated.Value(0),this._dialpadCollapsedAnimatedStyles=n.Styles.createAnimatedViewStyle({height:this._dialpadCollapsedAnimatedHeight}),this._isDialpadCollapsedOnCompletion=!1,this.toggleDialpadToCollapsedState=e=>{this._isDialpadCollapsed!==e&&this._dialpadAnimation(e)},this.isCollapsed=()=>this._isDialpadCollapsed||this._isDialpadCollapsedOnCompletion,this._dialpadAnimation=e=>{if(!this.state.dialpadExpandedHeight||!this._useAnimatedLayout)return;if(this._dialpadInProgressAnimation){if(this._isDialpadCollapsedOnCompletion===e)return;this._dialpadInProgressAnimation.stop(),this._dialpadInProgressAnimation=void 0}this._isDialpadCollapsedOnCompletion=e,this.props.onToggleStart&&this.props.onToggleStart(e);const t=[];e?(t.push(n.Animated.timing(this._dialpadExpandedAnimatedHeight,{toValue:0,duration:210,easing:n.Animated.Easing.Out()})),t.push(n.Animated.timing(this._dialpadCollapsedAnimatedHeight,{toValue:54,duration:30,easing:n.Animated.Easing.In()}))):(t.push(n.Animated.timing(this._dialpadCollapsedAnimatedHeight,{toValue:0,duration:30,easing:n.Animated.Easing.Out()})),t.push(n.Animated.timing(this._dialpadExpandedAnimatedHeight,{toValue:this.state.dialpadExpandedHeight,duration:210,easing:n.Animated.Easing.In()})));const i=e=>{this._dialpadInProgressAnimation=void 0,this.isComponentMounted()&&(this._isDialpadCollapsed=e,this.props.onToggleCompletion&&this.props.onToggleCompletion(e),this.forceUpdate())};this._dialpadInProgressAnimation=n.Animated.sequence(t),this._dialpadInProgressAnimation.start((()=>{i(e)}))},this._onPanVertical=e=>{this.props.isInLandscape||e.isComplete&&Math.abs(e.velocityY)>.2&&(e.velocityY<0?this.toggleDialpadToCollapsedState(!1):this.toggleDialpadToCollapsedState(!0))},this._onPressDialpadViewCollapsed=e=>{e&&(e.stopPropagation(),e.preventDefault()),this.toggleDialpadToCollapsedState(!1)},this._onLayout=e=>{!this.isComponentMounted()||this.props.isInLandscape||this.isCollapsed()||this._useAnimatedLayout||(this._useAnimatedLayout=!0,this.setState({dialpadExpandedHeight:e.height}),this.props.onHeightsChanged&&this.props.onHeightsChanged(e.height,54))},this._renderDialpadViewCollapsed=()=>{const e=[p.dialerWrapper];this._useDarkTheme()||e.push(this._themeStyles.searchBoxColorStyle);const t=this._isDialpadCollapsed||!1,i=r.getString("PeopleList.PstnDialpadLabel");return(0,a.jsx)(n.Animated.View,Object.assign({style:[this._dialpadCollapsedAnimatedStyles,e]},{children:(0,a.jsx)(n.View,Object.assign({style:p.collapsedDialpadButtonContainer,importantForAccessibility:t?n.Types.ImportantForAccessibility.No:n.Types.ImportantForAccessibility.NoHideDescendants},{children:(0,a.jsx)(o.default,{icon:d.SkypeIcon.Dialpad,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,size:d.IconSize.size24,style:p.dialpadIcon,onPress:this._onPressDialpadViewCollapsed,tabIndex:t?void 0:-1,title:i,accessibilityLabel:i})}))}))}}_buildState(e,t){const i=this._getRootViewId();return{dialpadExpandedHeight:t?void 0:this.state.dialpadExpandedHeight,viewWidth:l.default.getWidth(i),viewHeight:l.default.getHeight(i)}}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),t.dialpadExpandedHeight&&this.state.dialpadExpandedHeight!==t.dialpadExpandedHeight?this._dialpadExpandedAnimatedHeight.setValue(t.dialpadExpandedHeight):this.props.isInLandscape||e.isInLandscape||this.state.viewWidth===t.viewWidth&&this.state.viewHeight===t.viewHeight||(this._useAnimatedLayout=!1,this.isCollapsed()&&(this._dialpadInProgressAnimation&&(this._dialpadInProgressAnimation.stop(),this._dialpadInProgressAnimation=void 0),this._dialpadCollapsedAnimatedHeight.setValue(0),this._isDialpadCollapsed=!1,this._isDialpadCollapsedOnCompletion=!1))}render(){if(this.props.isInLandscape)return(0,a.jsx)(n.View,Object.assign({style:u.default.flexOne},{children:this.props.children}));let e;if(this._useAnimatedLayout){const t=[this._dialpadExpandedAnimatedStyles];n.UserInterface.isNavigatingWithKeyboard()&&this._isDialpadCollapsed&&t.push(u.default.displayNone),e=(0,a.jsxs)(n.View,Object.assign({onLayout:this._onLayout},{children:[(0,a.jsx)(n.Animated.View,Object.assign({style:t},{children:this.props.children})),this._renderDialpadViewCollapsed()]}))}else e=(0,a.jsxs)(n.View,Object.assign({onLayout:this._onLayout},{children:[this.props.children,this._renderDialpadViewCollapsed()]}));return e}}t.default=g},255336:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(24576);class s extends o.default{constructor(){super(...arguments),this._animatedHeight=new n.Animated.Value(0),this._animatedStyles=n.Styles.createAnimatedViewStyle({height:this._animatedHeight})}toggleToCollapsedState(){this._animatedHeight.setValue(this.state.collapsedHeight)}toggleToExpandedState(){this._animatedHeight.setValue(this.state.expandedHeight)}toggleToHiddenState(){this._animatedHeight.setValue(0)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.expandedHeight!==t.expandedHeight&&this._animatedHeight.setValue(t.expandedHeight)}render(){return this.props.isInLandscape?null:(0,a.jsx)(n.Animated.View,{style:this._animatedStyles})}}t.default=s},897306:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(244770),s=i(862633),r=i(436237),l=i(861253),c=i(915877),d=i(735426),u=i(886045),h=i(581760),p=i(680837),g=i(619675),C=i(24576),S=(0,c.lazyProperties)({callRateStyle:()=>n.Styles.createTextStyle({paddingHorizontal:20,color:h.Color.white,backgroundColor:h.Color.transparent,marginBottom:10}),image:()=>n.Styles.createViewStyle({height:110,width:158})});class m extends C.default{_buildState(e,t){const i=s.default.getCallRate(),a=s.default.tasterImageEnabled();return{callRateMessage:i.message,isTasterEligible:i.isTasterEligible,tasterImageEnabled:a}}componentDidMount(){super.componentDidMount(),this.state.isTasterEligible&&this.state.tasterImageEnabled&&r.track(new d.TasterImageShown)}shouldComponentUpdate(e,t){return!(0,l.default)(this.state,t)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isTasterEligible&&t.tasterImageEnabled||!this.state.isTasterEligible||!this.state.tasterImageEnabled||r.track(new d.TasterImageShown),t.callRateMessage!==this.state.callRateMessage&&this.state.callRateMessage&&u.default.shouldAnnounceForAccessibility()&&n.Accessibility.announceForAccessibility(this.state.callRateMessage)}render(){if(void 0===this.state.callRateMessage)return null;const e=[S.callRateStyle];!this._useDarkTheme()&&this._useAccessibleTheme()&&e.push(this._themeStyles.primaryTextColorStyle);const t=(0,a.jsx)(g.Subtitle,Object.assign({style:e},{children:this.state.callRateMessage}));return this.state.isTasterEligible&&this.state.tasterImageEnabled?(0,a.jsxs)(n.View,Object.assign({style:p.default.alignItemsCenter},{children:[(0,a.jsx)(n.Image,{source:o.Collection.TASTER_POST_CALL_ILLUSTRATION,style:S.image,resizeMode:"contain"}),t]})):t}}t.default=m},817456:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CountryListItemKey=void 0;const a=i(785893),n=i(496486),o=i(396265),s=i(516778),r=i(898278),l=i(118432),c=i(915877),d=i(733754),u=i(330124),h=i(451070),p=i(886045),g=i(285683),C=i(680837),S=i(24576),m=i(912770),y=(0,c.lazyProperties)({sectionHeader:()=>s.Styles.createViewStyle({height:40,flexDirection:"row",alignItems:"center",paddingHorizontal:12})}),f="country",b="header";function _(e,t){return e===T.CountryCode?t.country:t.countryCode.toString()}var T;!function(e){e[e.CountryCode=0]="CountryCode",e[e.PhoneCountryCode=1]="PhoneCountryCode"}(T=t.CountryListItemKey||(t.CountryListItemKey={}));class v extends S.default{constructor(){super(...arguments),this._onCountrySelect=e=>{var t;const i=null!==(t=this.props.countryListItemKey)&&void 0!==t?t:T.CountryCode;this.props.onSelect(_(i,e))},this._renderCountryItem=e=>{const t=this.props.recentCountries&&this.props.recentCountries[e.key]||this.props.countries[e.key];return(0,a.jsx)(l.default,{filter:this.state.filter,country:t,rowTitleStyleOverride:this.props.rowTitleStyleOverride,onSelect:this._onCountrySelect,showFlag:this.props.showFlags})},this._renderHeaderItem=e=>(0,a.jsx)(s.View,Object.assign({style:y.sectionHeader},{children:(0,a.jsx)(g.SectionTitle,{title:e.key,titleStyles:C.default.flexOne},e.key)})),this._renderItem=e=>{switch(e.template){case b:return this._renderHeaderItem(e);case f:return this._renderCountryItem(e);default:return[]}},this._filterCountries=e=>{var t;return e&&n.includes(e.countryName.toLowerCase(),null===(t=this.state.filter)||void 0===t?void 0:t.toLowerCase())}}_buildState(e,t){return{isUsingStackNavigationContext:u.default.isUsingStackNavigationContext(),safeAreaPaddingStyle:h.default.horizontalPaddingStyle(r.HorizontalInsetDefault)}}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.filter&&this.state.filter!==t.filter){this._cancelAnnoncement();const e=d.getString("PSTNCountryList.SearchResult",{count:n.size(this._filteredCountries)});this._announceForAccessibility(e,500)}}render(){const e=[C.default.flexOne];return this.state.safeAreaPaddingStyle&&e.push(this.state.safeAreaPaddingStyle),(0,a.jsx)(s.View,Object.assign({style:e},{children:(0,a.jsx)(o.VirtualListView,{itemList:this._getCountriesListItems(),renderItem:this._renderItem,animateChanges:!1,keyboardShouldPersistTaps:!0,keyboardDismissMode:"on-drag"})}))}onFilterChange(e){this.isComponentMounted()&&this.setState({filter:e})}_getListHeader(e){return{key:e,height:40,template:b,isNavigable:!1,accessibilityGroup:o.Types.AccessibilityGroupMarker.Begin,accessibilityGroupLabel:e}}_getCountriesListItems(){this._filteredCountries=this.state.filter?n.filter(this.props.countries,this._filterCountries):n.values(this.props.countries);const e=(this.props.isSortedList?[...this._filteredCountries].sort(((e,t)=>e.countryName.localeCompare(t.countryName))):this._filteredCountries).map((e=>{var t;return((e,t)=>({key:_(t,e),height:60,template:f}))(e,null!==(t=this.props.countryListItemKey)&&void 0!==t?t:T.CountryCode)}));if(this.state.filter||n.isEmpty(this.props.recentCountries)){const t=[];return this.state.isUsingStackNavigationContext||t.push(this._getListHeader(d.getString("PSTNCountryList.Result"))),n.concat(t,e)}const t=Object.values(this.props.recentCountries||[]).filter((e=>!!e)).map((e=>{var t;return((e,t)=>({key:`recent_${_(t,e)}`,height:60,template:f}))(e,null!==(t=this.props.countryListItemKey)&&void 0!==t?t:T.CountryCode)})),i=[this._getListHeader(d.getString("PSTNCountryList.Recent"))],a=[this._getListHeader(d.getString("PSTNCountryList.All"))];return n.concat(i,t,a,e)}_announceForAccessibility(e,t=0){this._announcePromise=m.default.sleep(t).then((()=>p.default.maybeAnnounceForAccessibility(e)))}_cancelAnnoncement(){this._announcePromise&&(this._announcePromise.cancel(),this._announcePromise=void 0)}}t.default=v},118432:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(915877),s=i(451072),r=i(89808),l=i(311010),c=i(619675),d=i(24576),u=i(526424),h=i(594011),p=(0,o.lazyProperties)({countryListItemCode:()=>n.Styles.createTextStyle({flex:0,marginHorizontal:20,textAlign:"right"}),countryListItemName:()=>n.Styles.createTextStyle({flex:1,flexDirection:"row",marginHorizontal:20}),countryFlagItem:()=>n.Styles.createViewStyle({marginLeft:20}),countryListItem:()=>n.Styles.createViewStyle({alignItems:"center",borderBottomWidth:1,flexDirection:"row",height:60,justifyContent:"space-between"})});class g extends d.default{constructor(){super(...arguments),this._onPress=()=>{this.props.onSelect(this.props.country)}}render(){let e;const t=l.default.rowTitleFontStyle(this._currentTheme),i=[t,r.default.getTextColorStyleNoSubscription()],o=[t,this._themeStyles.secondaryTextColorStyle,p.countryListItemCode];if(this.props.filter){const o=this.props.country.countryName.toLowerCase().indexOf(this.props.filter.toLowerCase()),s=this.props.country.countryName.substring(0,o),r=this.props.country.countryName.substring(o,this.props.filter.length+o),l=this.props.country.countryName.substring(s.length+r.length);e=(0,a.jsxs)(n.Text,Object.assign({style:p.countryListItemName,numberOfLines:1},{children:[(0,a.jsx)(n.Text,Object.assign({style:t},{children:s})),(0,a.jsx)(n.Text,Object.assign({style:i},{children:r})),(0,a.jsx)(n.Text,Object.assign({style:t},{children:l}))]}))}else e=(0,a.jsx)(n.Text,Object.assign({style:p.countryListItemName,numberOfLines:1},{children:(0,a.jsx)(c.RowTitle,Object.assign({textStyle:this.props.rowTitleStyleOverride},{children:this.props.country.countryName}))}));const d={id:`flag_${this.props.country.country}`,firstFrame:0,frameCount:0};return(0,a.jsxs)(s.default.Button,Object.assign({style:[p.countryListItem,this._themeStyles.dividerBorderColorStyle],onPress:this._onPress,underlayColor:this._themeColors.rowHighlightColor,accessibilityLabel:`${this.props.country.countryName} +${this.props.country.countryCode}`,accessibilityTraits:n.Types.AccessibilityTrait.Button,importantForAccessibility:n.Types.ImportantForAccessibility.Yes},{children:[this.props.showFlag&&(0,a.jsx)(h.StaticEmoticon,{emoticonInfo:d,size:u.EmoticonSize.Medium,style:p.countryFlagItem},d.id),e,(0,a.jsxs)(n.Text,Object.assign({style:o},{children:["+",this.props.country.countryCode]}))]}))}}t.default=g},256586:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(850781),r=i(862633),l=i(390580),c=i(547126),d=i(915877),u=i(733754),h=i(161230),p=(0,d.lazyProperties)({dialpad:()=>o.Styles.createViewStyle({flexGrow:1,flexShrink:0,marginHorizontal:5}),row:()=>o.Styles.createViewStyle({flexDirection:"row",flexGrow:1,flexShrink:0}),rowReverse:()=>o.Styles.createViewStyle({flexDirection:"row-reverse",flexGrow:1,flexShrink:0})}),g={dialpad:(0,d.lazyProperties)({MobileSmall:()=>o.Styles.createViewStyle({marginVertical:5}),MobileMedium:()=>o.Styles.createTextStyle({marginVertical:10}),MobileDefaultLandscape:()=>o.Styles.createTextStyle({marginVertical:10}),MobileDefault:()=>o.Styles.createTextStyle({marginVertical:15}),DesktopDefault:()=>o.Styles.createTextStyle({marginVertical:5})})},C=/[\r\n]+/;class S extends h.ResponsiveComponentBase{constructor(e){super(e),this._focusedButtonIndex=0,this._dialpadButtons=[],this._dialpadButtonRefCallbacks={},this._dialpadButtonPressCallbacks={},this._getLocalizationLetters=e=>{let t;switch(e){default:case"ABC":t=u.getString("PSTNDialerPanel.DialpadLocalizationLetters_ABC");break;case"DEF":t=u.getString("PSTNDialerPanel.DialpadLocalizationLetters_DEF");break;case"GHI":t=u.getString("PSTNDialerPanel.DialpadLocalizationLetters_GHI");break;case"JKL":t=u.getString("PSTNDialerPanel.DialpadLocalizationLetters_JKL");break;case"MNO":t=u.getString("PSTNDialerPanel.DialpadLocalizationLetters_MNO");break;case"PQRS":t=u.getString("PSTNDialerPanel.DialpadLocalizationLetters_PQRS");break;case"TUV":t=u.getString("PSTNDialerPanel.DialpadLocalizationLetters_TUV");break;case"WXYZ":t=u.getString("PSTNDialerPanel.DialpadLocalizationLetters_WXYZ")}return n.split(t,C)},this._onKeyPress=e=>{let t=-1;if(e.keyCode===c.default.UP?t=0:e.keyCode===c.default.RIGHT?t=1:e.keyCode===c.default.DOWN?t=2:e.keyCode===c.default.LEFT&&(t=3),t>=0){let i=this._buttonsNavigationMap[this._focusedButtonIndex][t],a=this._dialpadButtons[i];for(;a&&a.props.buttonDisabled;)i=this._buttonsNavigationMap[i][t],a=this._dialpadButtons[i];this._focusButton(a),e.preventDefault(),e.stopPropagation()}},this._onKeyLongPress=e=>t=>{this.props.onKeyLongPress&&this.props.onKeyLongPress(e)},this._onButtonFocused=e=>{const t=this._focusedButtonIndex;if(this._focusedButtonIndex=n.findIndex(this._dialpadButtons,(t=>t&&t.props.value===e.props.title))||0,this._focusedButtonIndex!==t){const e=this._dialpadButtons[t];e&&e.resetFocus()}},this._buttons={1:void 0,2:this._getLocalizationLetters("ABC"),3:this._getLocalizationLetters("DEF"),4:this._getLocalizationLetters("GHI"),5:this._getLocalizationLetters("JKL"),6:this._getLocalizationLetters("MNO"),7:this._getLocalizationLetters("PQRS"),8:this._getLocalizationLetters("TUV"),9:this._getLocalizationLetters("WXYZ"),"*":e.isDtmfDialpad?void 0:[","],",":void 0,0:["+"],"#":void 0},this._buttonsNavigationMap={0:[9,1,3,2],1:[10,2,4,0],2:[11,0,5,1],3:[0,4,6,5],4:[1,5,7,3],5:[2,3,8,4],6:[3,7,9,8],7:[4,8,10,6],8:[5,6,11,7],9:[6,10,0,11],10:[7,11,1,9],11:[8,9,2,10]}}_buildState(e,t){const i=super._buildState(e,t);return i.isCollapsed=r.default.isDialpadCollapsed(),i.isDialingExtension=r.default.isDialingExtension(),i.showCommaButton=!r.default.isDialingExtension()&&!e.isDtmfDialpad,i.canDialComma=r.default.canDialComma(),i}componentDidMount(){super.componentDidMount(),s.default.isCallingBundleLoaded()||(this._dialpadButtons.forEach((e=>null==e?void 0:e.toggleDisabledState(!0))),s.default.getCallingBundleStartupable().performAfterInitialized().then((()=>{this._dialpadButtons.forEach((e=>null==e?void 0:e.toggleDisabledState(!1)))})))}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),!this.props.isDtmfDialpad&&t.showCommaButton!==this.state.showCommaButton){let e=this._dialpadButtons[this._focusedButtonIndex];e&&e.props.buttonDisabled&&(e.resetFocus(),e=this._dialpadButtons[0],e&&e.setLastFocused())}}_getRowsCount(){let e=0;return n.each(this._buttons,(t=>{const i=n.size(t);return!(e<i&&(e=i,2===e))})),e+1}focusFirst(){this._focusButton(this._dialpadButtons[0]),o.Accessibility.announceForAccessibility("1")}render(){const e=[p.dialpad,this._chooseResponsiveStyle(g.dialpad)],t=this._getContext().isRTL?p.rowReverse:p.row,i=this._getRowsCount(),n={onButtonFocused:this._onButtonFocused,isInLandscape:this.props.isInLandscape,isDtmfDialpad:this.props.isDtmfDialpad,disableFontScaling:this.props.disableFontScaling};return(0,a.jsxs)(o.View,Object.assign({style:e,onKeyPress:this._onKeyPress,importantForAccessibility:this.state.isCollapsed?o.Types.ImportantForAccessibility.NoHideDescendants:void 0},{children:[(0,a.jsxs)(o.View,Object.assign({style:t},{children:[(0,a.jsx)(l.default,Object.assign({value:"1",rowCount:i,letters:this._buttons[1],ref:this._getDialpadButtonRefCallback(0),onPress:this._getDialpadButtonPressCallback("1")},n)),(0,a.jsx)(l.default,Object.assign({value:"2",rowCount:i,letters:this._buttons[2],ref:this._getDialpadButtonRefCallback(1),onPress:this._getDialpadButtonPressCallback("2")},n)),(0,a.jsx)(l.default,Object.assign({value:"3",rowCount:i,letters:this._buttons[3],ref:this._getDialpadButtonRefCallback(2),onPress:this._getDialpadButtonPressCallback("3")},n))]})),(0,a.jsxs)(o.View,Object.assign({style:t},{children:[(0,a.jsx)(l.default,Object.assign({value:"4",rowCount:i,letters:this._buttons[4],ref:this._getDialpadButtonRefCallback(3),onPress:this._getDialpadButtonPressCallback("4")},n)),(0,a.jsx)(l.default,Object.assign({value:"5",rowCount:i,letters:this._buttons[5],ref:this._getDialpadButtonRefCallback(4),onPress:this._getDialpadButtonPressCallback("5")},n)),(0,a.jsx)(l.default,Object.assign({value:"6",rowCount:i,letters:this._buttons[6],ref:this._getDialpadButtonRefCallback(5),onPress:this._getDialpadButtonPressCallback("6")},n))]})),(0,a.jsxs)(o.View,Object.assign({style:t},{children:[(0,a.jsx)(l.default,Object.assign({value:"7",rowCount:i,letters:this._buttons[7],ref:this._getDialpadButtonRefCallback(6),onPress:this._getDialpadButtonPressCallback("7")},n)),(0,a.jsx)(l.default,Object.assign({value:"8",rowCount:i,letters:this._buttons[8],ref:this._getDialpadButtonRefCallback(7),onPress:this._getDialpadButtonPressCallback("8")},n)),(0,a.jsx)(l.default,Object.assign({value:"9",rowCount:i,letters:this._buttons[9],ref:this._getDialpadButtonRefCallback(8),onPress:this._getDialpadButtonPressCallback("9")},n))]})),(0,a.jsxs)(o.View,Object.assign({style:t},{children:[(0,a.jsx)(l.default,Object.assign({overrideKey:"buttonStarComma",value:this.state.showCommaButton?",":"*",accessibilityLabel:this.state.showCommaButton?u.getString("KeyboardShortcuts.CommaKey"):void 0,rowCount:i,letters:this._buttons[this.state.showCommaButton?",":"*"],longPressValue:this.props.isDtmfDialpad||this.state.showCommaButton?void 0:",",buttonDisabled:!this.props.isDtmfDialpad&&!this.state.canDialComma,ref:this._getDialpadButtonRefCallback(9),onPress:this._getDialpadButtonPressCallback(this.state.showCommaButton?",":"*"),onLongPress:this.props.isDtmfDialpad||this.state.showCommaButton?void 0:this._onKeyLongPress("*")},n)),(0,a.jsx)(l.default,Object.assign({value:"0",rowCount:i,letters:this._buttons[0],longPressValue:"+",ref:this._getDialpadButtonRefCallback(10),onPress:this._getDialpadButtonPressCallback("0"),onLongPress:this._onKeyLongPress("0")},n)),(0,a.jsx)(l.default,Object.assign({value:"#",rowCount:i,letters:this._buttons["#"],buttonDisabled:!this.props.isDtmfDialpad&&!this.state.isDialingExtension,ref:this._getDialpadButtonRefCallback(11),onPress:this._getDialpadButtonPressCallback("#")},n))]}))]}))}_getDialpadButtonRefCallback(e){return this._dialpadButtonRefCallbacks[e]||(this._dialpadButtonRefCallbacks[e]=t=>{this._dialpadButtons[e]=t||void 0}),this._dialpadButtonRefCallbacks[e]}_getDialpadButtonPressCallback(e){return this._dialpadButtonPressCallbacks[e]||(this._dialpadButtonPressCallbacks[e]=t=>{this.props.onKeyPress&&this.props.onKeyPress(e)}),this._dialpadButtonPressCallbacks[e]}_focusButton(e){e&&e.requestFocus()}}t.default=S},390580:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(994224),s=i(746096),r=i(436237),l=i(915877),c=(i(733754),i(667024)),d=i(789871),u=i(161230),h=i(415963),p=i(581760),g=i(311010),C=i(619675),S=i(853374),m=(0,l.lazyProperties)({dialpadButton:()=>n.Styles.createViewStyle({alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46}),dialpadButtonContent:()=>n.Styles.createViewStyle({alignSelf:"center",flexDirection:"column",flexGrow:1,flexShrink:0}),dialpadButtonContentLandscape:()=>n.Styles.createViewStyle({flexDirection:"row",flexGrow:0,width:50,overflow:"visible",flexWrap:"nowrap"}),buttonLettersContainer:()=>n.Styles.createViewStyle({alignSelf:"center",alignItems:"center"}),buttonLettersContainerLandsape:()=>n.Styles.createViewStyle({paddingLeft:7,alignItems:"flex-start"}),dialpadButtonNumber:()=>n.Styles.createTextStyle({font:g.default.font.uiDisplayBold,textAlign:"center"}),dialpadButtonLetters:()=>n.Styles.createTextStyle({lineHeight:16})}),y=(0,l.lazyProperties)({dialpadButtonNumber:()=>n.Styles.createTextStyle({color:p.Color.white,font:g.default.font.uiDisplayBold}),dialpadButtonLetters:()=>n.Styles.createTextStyle({color:p.Color.white})}),f={dialpadButton:(0,l.lazyProperties)({MobileDefaultLandscape:()=>n.Styles.createViewStyle({margin:void 0}),MobileDefault:()=>n.Styles.createViewStyle({margin:5}),DesktopSmall:()=>n.Styles.createTextStyle({margin:void 0}),DesktopDefault:()=>n.Styles.createTextStyle({margin:5})}),dialpadButtonNumber:(0,l.lazyProperties)({MobileSmall:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.h4,lineHeight:30}),MobileMedium:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.dialpadNumber,lineHeight:36}),MobileDefault:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.dialpadNumberLarge,lineHeight:42}),DesktopDefault:()=>n.Styles.createTextStyle({fontSize:g.default.controlFontSize.h4,lineHeight:30})})};class b extends u.ResponsiveComponentBase{constructor(){super(...arguments),this._onPress=e=>{if(this.props.buttonDisabled)return;const t=S.default.newCauseId();c.default.createTrackerAndMarkPressTime(t,h.ScenarioName.ResponsivenessPressDialpadButton,e),r.log(s.LogTraceArea.DialerStore,"DialpadButton._onPress causeId: "+t),this.props.isDtmfDialpad||(d.default.appendCharToPhoneNumberInput(this.props.value),o.default.PstnUtils.playDTMFSound(this.props.value,t)),this.props.onPress(e),c.default.markActionDoneAndRemoveTracker(t)},this._onLongPress=e=>{if(!this.props.buttonDisabled){if(!this.props.isDtmfDialpad){const e=S.default.newCauseId();r.log(s.LogTraceArea.DialerStore,"DialpadButton._onLongPress causeId: "+e),d.default.appendCharToPhoneNumberInput(this.props.longPressValue||this.props.value),o.default.PstnUtils.playDTMFSound(this.props.value,e)}this.props.onLongPress&&this.props.onLongPress(e)}},this._onButtonRef=e=>{this._buttonRef=e||void 0},this._onFocus=e=>{this.isComponentMounted()&&(this.props.onButtonFocused&&this._buttonRef&&!this.props.buttonDisabled&&this.props.onButtonFocused(this._buttonRef),this.setState({isLastFocusedBtn:!0}))}}_buildState(e,t){const i=super._buildState(e,t);return t&&(i.isLastFocusedBtn="1"===e.value),i}requestFocus(){this._buttonRef&&this._buttonRef.requestFocus()}resetFocus(){this.setState({isLastFocusedBtn:!1})}setLastFocused(){this.setState({isLastFocusedBtn:!0})}toggleDisabledState(e){this.setState({isDisabled:e})}render(){var e;const t=[m.dialpadButton,this._chooseResponsiveStyle(f.dialpadButton)],i=[m.dialpadButtonContent],o=[m.buttonLettersContainer];this.props.isInLandscape&&(i.push(m.dialpadButtonContentLandscape),o.push(m.buttonLettersContainerLandsape));const s=[n.Types.AccessibilityTrait.Button];let r=this.props.accessibilityLabel||this.props.value;return this.props.buttonDisabled&&s.push(n.Types.AccessibilityTrait.Disabled),(0,a.jsx)(n.Button,Object.assign({style:t,ref:this._onButtonRef,onPress:this._onPress,onFocus:this._onFocus,title:this.props.value,onLongPress:this._onLongPress,disabled:this.props.buttonDisabled||null!==(e=this.state.isDisabled)&&void 0!==e&&e,accessibilityTraits:s,accessibilityLabel:r,tabIndex:this.state.isLastFocusedBtn?0:-1},{children:(0,a.jsxs)(n.View,Object.assign({style:i},{children:[this._getValue(),(0,a.jsx)(n.View,Object.assign({style:o},{children:this._getLetters()}),"view_"+this.props.value+"letters")]}),"view_"+this.props.value+"button")}),this.props.overrideKey||"button"+this.props.value)}_getValue(){const e=[m.dialpadButtonNumber,this._themeStyles.primaryTextColorStyle,this._chooseResponsiveStyle(f.dialpadButtonNumber)];return this.props.isDtmfDialpad&&e.push(y.dialpadButtonNumber),(0,a.jsx)(n.Text,Object.assign({style:e,allowFontScaling:!this.props.disableFontScaling},{children:this.props.value}),"value"+this.props.value)}_getLetters(){const e=[m.dialpadButtonLetters,this._themeStyles.primaryTextColorStyle];this.props.isDtmfDialpad&&e.push(y.dialpadButtonLetters);const t=[];for(let i=0;i<this.props.rowCount-1;i++)this.props.letters&&i in this.props.letters?t.push((0,a.jsx)(C.Caption,Object.assign({style:e,allowFontScaling:!this.props.disableFontScaling,forceDirection:!0},{children:this.props.letters[i]}),"letters"+this.props.value+i)):this.props.isInLandscape||t.push((0,a.jsx)(C.Caption,Object.assign({style:e,allowFontScaling:!this.props.disableFontScaling},{children:" "}),"letters"+this.props.value+i));return t}}t.default=b},808113:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(850353),s=i(101866),r=i(862633),l=i(766649),c=i(915877),d=i(789871),u=i(369656),h=i(24576),p=(0,c.lazyProperties)({buttonsContainer:()=>n.Styles.createViewStyle({flex:0,flexDirection:"row",justifyContent:"center",marginBottom:15,minHeight:60,overflow:"visible",paddingLeft:5,paddingRight:5}),buttonWrapper:()=>n.Styles.createViewStyle({alignItems:"center",flex:1,flexBasis:0,flexDirection:"row",justifyContent:"center",minHeight:60})});class g extends h.default{constructor(){super(...arguments),this._callAllowed=()=>this.state.phoneNumber.callable&&!this.state.disableHighBandwidthOperations}shouldComponentUpdate(e,t){return!0}_buildState(e,t){return{isCollapsed:r.default.isDialpadCollapsed(),phoneNumber:d.default.getPhoneNumber(d.TriggerKeys.Callable),disableHighBandwidthOperations:l.default.isUsingGogoNetwork()}}render(){return(0,a.jsxs)(n.View,Object.assign({style:p.buttonsContainer,importantForAccessibility:this.state.isCollapsed?n.Types.ImportantForAccessibility.NoHideDescendants:n.Types.ImportantForAccessibility.No},{children:[(0,a.jsx)(n.View,Object.assign({style:p.buttonWrapper},{children:(0,a.jsx)(u.default,{phoneNumber:this.state.phoneNumber,canSendSms:this.state.phoneNumber.callable})})),(0,a.jsx)(n.View,Object.assign({style:p.buttonWrapper},{children:(0,a.jsx)(s.default,{phoneNumber:this.state.phoneNumber,canCall:this._callAllowed(),callId:this.props.callId,conversationMri:this.props.conversationId})})),(0,a.jsx)(n.View,Object.assign({style:p.buttonWrapper},{children:(0,a.jsx)(o.default,{})}))]}))}}t.default=g},850353:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(746096),s=i(913944),r=i(915877),l=i(733754),c=i(789871),d=i(886045),u=i(581760),h=i(640363),p=i(711828),g=i(24576),C=(0,r.lazyProperties)({backspaceButton:()=>n.Styles.createButtonStyle({width:60,height:60,alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46})});class S extends g.default{constructor(){super(...arguments),this._onBackspace=e=>{const[t,i]=c.default.eraseCharFromPhoneNumberInput();t&&i?d.default.maybeAnnounceForAccessibility(l.getString("PSTNPhoneNumberInput.OnBackspaceAnnouncement",{symbol:t})):d.default.maybeAnnounceForAccessibility(l.getString("PSTNPhoneNumberInput.OnLongBackspaceAnnouncement"))},this._onLongBackspace=e=>{c.default.cleanupPhoneNumberInput(),d.default.maybeAnnounceForAccessibility(l.getString("PSTNPhoneNumberInput.OnLongBackspaceAnnouncement"))}}render(){const e=this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:u.Color.black,t=l.getString("Pstn.RemoveNumberButton");return(0,a.jsx)(s.default,{icon:p.SkypeIcon.Backspace,color:e,hoverColor:e,size:p.IconSize.size24,style:C.backspaceButton,onPress:this._onBackspace,onLongPress:this._onLongBackspace,title:t,accessibilityLabel:t,flipIcon:this._getContext().isRTL&&h.default.getPlatformType()!==o.PlatformType.Android})}}t.default=S},101866:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(4736),s=i(994224),r=i(297775),l=i(911009),c=i(539549),d=i(936540),u=i(862633),h=i(746096),p=i(436237),g=i(915877),C=i(733754),S=i(104735),m=i(330124),y=i(789871),f=i(735426),b=i(581760),_=i(711828),T=i(24576),v=i(853374),w=(0,g.lazyProperties)({roundButton:()=>n.Styles.createButtonStyle({height:60,overflow:"visible",width:60})});class I extends T.default{constructor(){super(...arguments),this._coachMarkContext={coachMarkArea:l.CoachMarkAreaType.Dialer},this._startPstnCall=()=>{const e=v.default.newCauseId();p.log(h.LogTraceArea.CallingUI,"[action]: Start Call Button, causeId: "+e),p.track(new f.DialerPanelComponentClick(f.DialerPanelClickTarget.CallButton)),d.default.startOrAddPstnCall(this.props.phoneNumber.E164,this.props.phoneNumber.emergency,this.props.phoneNumber.countryCode,this.props.phoneNumber.suffix,this.props.callId,this.props.conversationMri,this.props.phoneNumber.extension),this._isJoinCallRequest()&&(this.state.isUsingStackNavigationContext?this.props.conversationMri&&this.props.callId&&(p.log(h.LogTraceArea.CallingUI,"CallControl._startPstnCall causeId: "+e),s.default.CallNavigationHelper.rejoinCall(this.props.conversationMri,this.props.callId,e,y.default.getPhoneNumberOrigin()||h.NavigationCallOrigin.PstnDialpad)):S.default.closeGenericDesktopModal(e,this._getRootViewId()))}}_buildState(e,t){const i={isUsingStackNavigationContext:m.default.isUsingStackNavigationContext(),conversationMembersMris:[],tasterCoachmarkEnabled:u.default.tasterCoachmarkEnabled(),tasterGreenCallButtonEnabled:u.default.tasterGreenCallButtonEnabled(),isTasterEligible:u.default.getCallRate().isTasterEligible};if(e.callId&&e.conversationMri){const t=(0,c.default)().getConversation(e.conversationMri);t&&(i.conversationMembersMris=t.getMemberMris())}return i}render(){const e=this.state.isTasterEligible&&this.state.tasterGreenCallButtonEnabled?b.Color.green:void 0,t=this.state.isTasterEligible&&this.state.tasterCoachmarkEnabled?(0,a.jsx)(r.default.ActionButton,{coachMarkType:l.CoachMarkType.PlaceTasterCall,anchorAccessibilityLabel:C.getString("PSTNDialerPanel.PlaceTasterCallCoachmarkTitle"),positions:[l.PopupAnchorPositon.Top],accessibilityLabel:C.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),accessibilityTraits:n.Types.AccessibilityTrait.Button,title:C.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),icon:_.SkypeIcon.CallStart,onPress:this._startPstnCall,disabled:!this.props.canCall,style:w.roundButton,backgroundColor:e}):(0,a.jsx)(o.default,{title:C.getString("PSTNDialerPanel.CallButtonAccessibilityLabel"),icon:_.SkypeIcon.CallStart,onPress:this._startPstnCall,disabled:!this.props.canCall,style:w.roundButton,backgroundColor:e});return(0,a.jsx)(l.CoachMarkContext.Provider,Object.assign({value:this._coachMarkContext},{children:t}))}_isJoinCallRequest(){return this.props.callId&&this.props.conversationMri}}t.default=I},369656:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(583367),o=i(516778),s=i(889391),r=i(739119),l=i(476621),c=i(651129),d=i(904604),u=i(746096),h=i(913944),p=i(436237),g=i(915877),C=i(733754),S=i(104735),m=i(789871),y=i(735426),f=i(615301),b=i(581760),_=i(640363),T=i(711828),v=i(24576),w=i(853374),I=(0,g.lazyProperties)({smsButtonDimensions:()=>o.Styles.createButtonStyle({width:60,height:60,alignItems:"center",flexBasis:0,flexDirection:"row",flexGrow:1,flexShrink:0,justifyContent:"center",minHeight:46})});class P extends v.default{constructor(){super(...arguments),this._onPress=()=>{if(!this.props.canSendSms)return;const e=w.default.newCauseId();p.log(u.LogTraceArea.DialerPanel,"[action]: Send SMS Button, causeId: "+e),this.props.phoneNumber.emergency?this._startEmergencySMS(e):this._startSkypeSMS(e)}}_buildState(e,t){const i=d.default.getCreditEntitlement(),a=d.default.getSubscriptions(),n={searchResult:m.default.getSearchResults().exactMatch,canShowSmsEntryPoint:s.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.SmsButtonEnabled,supportsEmergencySms:t?void 0:this.state.supportsEmergencySms,sendButtonEnabled:!t&&this.state.sendButtonEnabled,userEntitlementsSummary:r.getEntitlementCombination(i,a)};return e.canSendSms?e.phoneNumber.emergency&&!n.supportsEmergencySms?n.sendButtonEnabled=!1:n.sendButtonEnabled=!0:n.sendButtonEnabled=!1,n}render(){if(!this.state.canShowSmsEntryPoint)return null;const e=this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:b.Color.black;return(0,a.jsx)(h.default,{icon:T.SkypeIcon.MobileSmsNew,title:C.getString("SMSMessaging.ContactOptionsPopupSendSMSLabel"),disabled:!this.state.sendButtonEnabled,color:e,hoverColor:e,size:T.IconSize.size24,style:I.smsButtonDimensions,onPress:this._onPress,flipIcon:this._getContext().isRTL&&_.default.getPlatformType()!==u.PlatformType.Android})}componentDidMount(){super.componentDidMount(),void 0===this.state.supportsEmergencySms&&n.default.supportsNativeEmergencyCalling().catch((()=>!1)).then((e=>{this.isComponentMounted()&&this.setState({supportsEmergencySms:e})}))}_startEmergencySMS(e){p.log(u.LogTraceArea.DialerPanel,"SMSControl._startEmergencySMS, causeId: "+e);const t=this.props.phoneNumber.suffix;t?(p.log(u.LogTraceArea.GenericUnsafe,"Placing emergency SMS to "+c.default.maskPhoneNumber(t)+", destination country: "+this.props.phoneNumber.countryCode),n.default.makeNativeEmergencySMS(t).then((e=>{e||p.warn(u.LogTraceArea.GenericUnsafe,"Failed to place emergency SMS")}))):p.warn(u.LogTraceArea.GenericUnsafe,"Refusing to place emergency SMS, reason: no information about phone number suffix")}_startSkypeSMS(e){p.log(u.LogTraceArea.DialerPanel,"SMSControl._startSkypeSMS, causeId: "+e);const t=c.default.getPhoneNumberMri(this.props.phoneNumber);l.default.ensureConversationLoadedOrFaked(t).then((i=>{const a={convId:t,origin:u.NavigationConversationOrigin.SmsControl,isNewConversation:i,causeId:e};f.default.setNextFlowId(f.SmsFlowId.Dialer),p.track(new y.DialerPanelComponentClick(y.DialerPanelClickTarget.SmsButton,this.state.userEntitlementsSummary)),S.default.navigateToConversation(a)}))}}t.default=P},796613:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(147204),s=i(817456),r=i(587134),l=i(746096),c=i(139285),d=i(110117),u=i(436237),h=i(915877),p=i(733754),g=i(104735),C=i(772136),S=i(789871),m=i(735426),y=i(886045),f=i(223528),b=i(190631),_=i(581760),T=i(711828),v=i(79669),w=i(680837),I=i(619675),P=i(24576),M=i(853374),k=(0,h.lazyProperties)({headerControlWrap:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",justifyContent:"center",alignItems:"center",height:T.IconSize.default}),headerControlText:()=>n.Styles.createTextStyle({flexGrow:0,flexShrink:1,color:_.Color.white,marginRight:5}),dividerContainer:()=>n.Styles.createViewStyle({height:1}),divider:()=>n.Styles.createViewStyle({position:"absolute",left:10,right:10,bottom:0,height:1}),iconStyle:()=>n.Styles.createViewStyle({paddingLeft:3}),countrySelectorPopupContainer:()=>n.Styles.createViewStyle({height:350,width:300}),titleWrapperStyle:()=>n.Styles.createViewStyle({flexGrow:0,flexShrink:1,flexDirection:"row",alignItems:"center"}),filterInputControl:()=>n.Styles.createViewStyle({height:50,paddingTop:10})}),A="countrySelectorPopup";class R extends P.default{constructor(){super(...arguments),this._close=()=>{const e=M.default.newCauseId();u.log(l.LogTraceArea.Navigation,"DialpadHeader._close, causeId: "+e),g.default.goBack(e,this._getContext())},this._goCallSettings=()=>{u.track(new m.DialerPanelComponentClick(m.DialerPanelClickTarget.SettingsButton)),g.default.navigateToCallingSettingsPanel(!1,this._getContext())},this._onCenterControlsRef=e=>{this._centerControls=e||void 0},this._onCountryTitleRef=e=>{this._countryTitleRef=e||void 0},this._onCountryListRef=e=>{this._countryListRef=e||void 0},this._onCountrySelectorPress=e=>{this.props.isUsingStackNavigationContext?g.default.navigateToCountrySelector(this._getRootViewId()):this._openCountrySelectorModal()},this._openCountrySelectorModal=()=>{const e=e=>{const t=this.state.countries[e];S.default.setSelectedCountry(t,!0),o.default.dismissPopup(A,this._getRootViewId())},t={getAnchor:()=>this._countryTitleRef,renderPopup:(t,i,o,l)=>(0,a.jsx)(v.default,Object.assign({anchorPosition:t,anchorOffset:i,popupWidth:o,popupHeight:l,fillColor:this._themeColors.popoverBackgroundColor,strokeColor:this._useDarkTheme()?this._themeColors.popupBorderColor:void 0,skipPopupAutoFocus:!0,popupAccessibilityTitle:p.getString("PSTNCountryList.CountryList")},{children:(0,a.jsxs)(n.View,Object.assign({style:k.countrySelectorPopupContainer},{children:[(0,a.jsx)(n.View,Object.assign({style:w.default.flexZero},{children:(0,a.jsx)(f.default,{style:k.filterInputControl,placeholderText:p.getString("PSTNCountryList.SearchCountryPlaceholder"),onInputTextChange:this._onSearch,showSearchIcon:!0,hideBackground:!0,useBoldFont:!0})})),(0,a.jsx)(n.View,Object.assign({style:k.dividerContainer},{children:(0,a.jsx)(r.default,{style:k.divider})})),(0,a.jsx)(s.default,{ref:this._onCountryListRef,countries:this.state.countries,recentCountries:S.default.getLast5CalledCountriesNoSubscription(),onSelect:e})]}))})),positionPriorities:["top","bottom"],dismissIfShown:!0,rootViewId:this._getRootViewId()};o.default.showPopup(t,A)},this._onSearch=e=>{this.isComponentMounted()&&(this.setState({query:e}),this._countryListRef&&this._countryListRef.onFilterChange(e))}}requestFocus(){this._centerControls&&this._centerControls.requestFocus()}render(){return(0,a.jsx)(b.SimplePanelHeader,{useTransparentBackground:!0,hideBottomBorder:!0,leftButton:this._getCloseButton(),rightButtons:this._getCallingSettingseButton(),titleView:this._getHeaderCenterControls(),headerPosition:this.props.isInLandscape?b.HeaderPosition.Start:b.HeaderPosition.Default})}_buildState(e,t){const i={countries:C.default.getCountries(),selectedCountry:S.default.getSelectedCountry()};return t&&(i.selectedCountry&&(i.selectedCountry=C.default.getCountryByCode(i.selectedCountry.country)),this._titleWrapperStyle=[k.titleWrapperStyle,n.Styles.createViewStyle({maxWidth:e.maxWidth},!1)]),i}_getCloseButton(){return{closeButtonType:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?b.CloseButtonType.Close:b.CloseButtonType.Back,title:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?p.getString("Global.CloseButtonTitle"):p.getString("Global.BackButtonTitle"),onPress:this._close,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:_.Color.white,hoverColor:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.iconHoverColor:_.Color.whiteOverlay50,accessibilityLabel:this.props.isUsingStackNavigationContext||this.props.isAloneInNavStack?p.getString("Global.CloseButtonTitle"):p.getString("Global.BackButtonTitle")}}_getCallingSettingseButton(){const e=p.getString("UserSettingsPanel.CallSettingsTitle");return{icon:T.SkypeIcon.Settings,title:e,onPress:this._goCallSettings,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:_.Color.white,hoverColor:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.iconHoverColor:_.Color.whiteOverlay50,accessibilityLabel:e}}_getHeaderCenterControls(){let e=p.getString("PSTNCountrySelectorPanel.Title"),t=p.getString("PSTNCountrySelectorPanel.Title");const i=[k.headerControlText];return this.state.selectedCountry&&(e=this.state.selectedCountry.countryName,t=p.getString("PSTNDialerPanel.CountriesAndRegionsAccessibilityLabel",{countryTitle:e})),(this._useDarkTheme()||this._useAccessibleTheme())&&i.push(this._themeStyles.headerTextColorStyle),(0,a.jsx)(n.Button,Object.assign({ref:this._onCenterControlsRef,style:k.headerControlWrap,onPress:this._onCountrySelectorPress,accessibilityLabel:t,accessibilityTraits:[n.Types.AccessibilityTrait.Button,n.Types.AccessibilityTrait.HasPopup]},{children:(0,a.jsxs)(c.default,Object.assign({ref:this._onCountryTitleRef,style:this._titleWrapperStyle},{children:[(0,a.jsx)(I.PanelHeader,Object.assign({style:i,numberOfLines:1},{children:e})),(0,a.jsx)(d.default,{icon:T.SkypeIcon.DownChevron,size:T.IconSize.size12,color:this._useDarkTheme()||this._useAccessibleTheme()?this._themeColors.headerIconColor:_.Color.white,style:k.iconStyle})]}))}))}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),S.default.initializeCountrySelection()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.selectedCountry&&this._announceCountrySelectedForAccessibility(this.state.selectedCountry.countryName)}shouldComponentUpdate(e,t){return!!this.state.selectedCountry!=!!t.selectedCountry||!!this.state.selectedCountry&&!!t.selectedCountry&&this.state.selectedCountry.country!==t.selectedCountry.country||this.props.isInLandscape!==e.isInLandscape}_announceCountrySelectedForAccessibility(e){this._announceForAccessibility(p.getString("PSTNDialerPanel.CountryAnnouncement",{countryTitle:e}))}_announceForAccessibility(e){y.default.maybeAnnounceForAccessibility(e,1e3)}}t.default=R},208360:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(396265),s=i(516778),r=i(898278),l=i(101889),c=i(746096),d=i(436237),u=i(915877),h=i(733754),p=i(451072),g=i(45227),C=i(789871),S=i(735426),m=i(29130),y=i(170919),f=i(581760),b=i(311010),_=i(478262),T=i(680837),v=i(619675),w=i(24576),I=i(702301),P=i(567977),M=i(110996),k=i(269399),A=i(889391),R=(0,u.lazyProperties)({searchResultPanelStyle:()=>s.Styles.createViewStyle({flex:1,minHeight:100}),searchResultPanelDarkThemeStyle:()=>s.Styles.createViewStyle({backgroundColor:f.Color.gray400}),itemDivider:()=>s.Styles.createViewStyle({height:1,marginLeft:50,marginRight:10}),itemDividerDarkTheme:()=>s.Styles.createViewStyle({backgroundColor:f.Color.dialPadHoverDark}),itemDividerLightTheme:()=>s.Styles.createViewStyle({backgroundColor:f.Color.whiteOverlay20}),itemDividerSmallScreen:()=>s.Styles.createViewStyle({marginRight:16}),singleItemDivider:()=>s.Styles.createViewStyle({height:1,marginLeft:10,marginRight:10}),transparentBg:()=>s.Styles.createViewStyle({backgroundColor:f.Color.transparent}),textOnGradient:()=>s.Styles.createTextStyle({color:f.Color.white}),rowHighlightDarkStyle:()=>s.Styles.createViewStyle({backgroundColor:f.Color.dialPadHoverDark})});class x extends w.default{constructor(){super(...arguments),this._onScrollFlag=!1,this._renderItem=e=>{const t=(0,a.jsx)(L,{mri:e.profile.userMri,displayName:e.profile.displayName,phoneNumber:this.state.isSingleSelection?void 0:e.phone,itemHeight:e.height,textToHighlight:e.textToHighlight,onResultPress:this._onSearchItemPressed,searchIndex:e.searchIndex},e.key);if(e.isLastItem&&!this.state.isSingleSelection)return t;const i=[R.itemDivider];this._useDarkTheme()?i.push(R.itemDividerDarkTheme):i.push(this._themeStyles.dividerColorStyle),this.state.isMobileScreenSize&&i.push(R.itemDividerSmallScreen);const n=(0,a.jsx)(s.View,{style:i},"itemDivider");if(this.state.isSingleSelection){const e=[R.singleItemDivider];this._useDarkTheme()?e.push(R.itemDividerDarkTheme):e.push(R.itemDividerLightTheme);return[(0,a.jsx)(s.View,{style:e},"itemDivider"),t]}return[t,n]},this._onSearchItemPressed=(e,t)=>{d.log(c.LogTraceArea.DialerPanel,"[action]: Contact Selection"),d.track(new S.ContactSelected(C.default.getPhoneNumber(C.TriggerKeys.InputValue).E164.length)),C.default.selectSearchResultItem(t),this.props.onItemPressed&&this.props.onItemPressed()},this._onScroll=()=>{this.props.onScroll&&this._onScrollFlag?(this.props.onScroll(),this._onScrollFlag=!1):this._onScrollFlag=!0}}_buildState(e,t){const i=C.default.getSearchResults(),a=y.SearchItemHeights.baseListItemHeight+Math.round(y.SearchItemHeights.scaledListItemHeight*Math.min(m.default.getContentSizeMultiplier(),r.MaxContentSizeMultiplier)),o=this._getRootViewId(),s={isMobileScreenSize:m.default.isMobileScreenSize(o),searchQuery:i.query,sessionId:i.sessionId,profiles:[],isSingleSelection:!!i.selectedResult};return i.results.length>0&&!i.selectedResult&&(n.each(i.results,((e,t)=>{s.profiles.push({profile:e.contact,phone:e.phone.number,textToHighlight:e.matchedString,template:"profile",height:a,key:"ct_"+e.contact.uniqueId+t,searchIndex:t,isLastItem:!1})})),s.profiles[s.profiles.length-1].isLastItem=!0),s}render(){const e=[R.searchResultPanelStyle];return this.state.isSingleSelection||0===this.state.profiles.length?e.push(R.transparentBg):this._useDarkTheme()?e.push(R.searchResultPanelDarkThemeStyle):e.push(this._themeStyles.primaryBackgroundColorStyle),(0,a.jsx)(s.View,Object.assign({style:e,importantForAccessibility:this._accessibilityForSearchResultsView()},{children:(0,a.jsx)(o.VirtualListView,{itemList:this.state.profiles,renderItem:this._renderItem,animateChanges:!1,skipRenderIfItemUnchanged:!1,keyboardDismissMode:"on-drag",keyboardShouldPersistTaps:!0,horizontalPadding:this.props.safeAreaHorizontalInsets,hoveredItemStyle:this.state.isSingleSelection?void 0:this._themeStyles.rowHoverViewStyle,onScroll:this._onScroll,accessibilityLabel:h.getString("PSTNDialerPanel.FastContactsSearchList")})}))}componentDidMount(){super.componentDidMount(),C.default.initializeSearch()}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this._onScrollFlag=!1,this.state.profiles.length>0){const e=0===this.state.searchQuery.length;(0,M.searchResultsRendered)(k.ScenarioSearchTypes.FastContacts,this.state.sessionId,e);const t={publicDirectory:!1,message:!1,indexedDb:!1,bots:!1,allPeople:!1,fastContacts:!0,messageInConversation:!1};(0,M.compositeScenarioResultsRendered)(this.state.searchQuery,k.CompositeSearchOrigin.Dialpad,void 0,e,t)}this.props.onRender&&this.props.onRender()}componentWillUnmount(){super.componentWillUnmount(),C.default.destroySearch()}_accessibilityForSearchResultsView(){return 0===this.state.profiles.length?s.Types.ImportantForAccessibility.NoHideDescendants:void 0}}class L extends w.default{constructor(){super(...arguments),this._onHoverOverItemStart=e=>{this.isComponentMounted()&&this.setState({isHoveringOverItem:!0})},this._onHoverOverItemEnd=e=>{this.isComponentMounted()&&this.setState({isHoveringOverItem:!1})},this._onItemPressed=()=>{this.props.phoneNumber&&(this.props.onResultPress(this.props.phoneNumber,this.props.searchIndex),this.isComponentMounted()&&this.setState({isHoveringOverItem:!1}))}}_buildState(e,t){return{enableRefreshedPalette:A.default.getS4LUiFeatures().enableRefreshedPalette}}render(){const e=g.getItemHeightStyle(this.props.itemHeight-1),t=[g.styles.listItem];e&&t.push(e),this.state.isHoveringOverItem&&this.props.phoneNumber&&(this._useDarkTheme()?t.push(R.rowHighlightDarkStyle):t.push(this._themeStyles.rowHighlightViewStyle));const i=[b.default.fontStyle.body,this._themeStyles.secondaryTextColorStyle,T.default.flexNegativeOne,this._getOptionalRefreshedPaletteAwareAccessibleStyles()],n=[...i,g.styles.statusTextInnerContainer],o=this.props.displayName,r=this.props.phoneNumber;let c,d;if(r)d=(0,a.jsx)(s.View,Object.assign({style:g.styles.statusContainer,title:r},{children:(0,a.jsx)(l.default,{displayText:r,textToHighlight:this.props.textToHighlight,containerStyles:n,inlineTextStyle:i,highlightType:_.TextToHighlightType.PhoneNumber})}));else{d=void 0;let e=R.textOnGradient;!this._useDarkTheme()&&this._useAccessibleTheme()&&(e=this._themeStyles.primaryTextColorStyle),c=e}const u=-1!==o.indexOf(this.props.textToHighlight)?(0,a.jsx)(l.default,{displayText:o,textToHighlight:this.props.textToHighlight,containerStyles:n,inlineTextStyle:[b.default.rowTitleFontStyle(this._currentTheme),c],highlightType:_.TextToHighlightType.DisplayName}):(0,a.jsx)(v.RowTitle,Object.assign({style:c,numberOfLines:1},{children:o}));return(0,a.jsxs)(p.default.Button,Object.assign({style:t,onPress:r?this._onItemPressed:void 0,onHoverStart:r?this._onHoverOverItemStart:void 0,onHoverEnd:r?this._onHoverOverItemEnd:void 0,underlayColor:this._useDarkTheme()?f.Color.dialPadHoverDark:this._themeColors.rowHighlightColor,accessibilityTraits:s.Types.AccessibilityTrait.Button,accessibilityLabel:o+(r?", "+r:"")},{children:[(0,a.jsx)(I.UserIcon,{size:P.UserIconSize.Size40,userMri:this.props.mri,statusBorderColor:this._themeColors.primaryBackgroundColor},"userIcon"),(0,a.jsxs)(s.View,Object.assign({style:g.styles.textContainer},{children:[u,d]}),"text")]}))}_getOptionalRefreshedPaletteAwareAccessibleStyles(){if(this.state.enableRefreshedPalette&&this._useAccessibleTheme()&&this.state.isHoveringOverItem)return s.Styles.createTextStyle({color:this._themeColors.textOnColor},!1)}}t.default=x},461499:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneNumberInputBase=void 0;const a=i(785893),n=i(516778),o=i(889391),s=i(544279),r=i(156976),l=i(746096),c=i(913944),d=i(436237),u=i(915877),h=i(733754),p=i(104735),g=i(527683),C=i(789871),S=i(789871),m=i(735426),y=i(161230),f=i(886045),b=i(581760),_=i(711828);var T;!function(e){e[e.Regular=0]="Regular",e[e.Emergency=1]="Emergency"}(T||(T={}));const v=(0,u.lazyProperties)({contactsIcon:()=>n.Styles.createViewStyle({paddingLeft:10,paddingRight:10,paddingBottom:10,paddingTop:8,alignSelf:"flex-start",flex:0})});class w extends y.ResponsiveComponentBase{constructor(e){super(e),this._getOptionalContactsIcon=()=>this.state.isContactsIconEnabled?(0,a.jsx)(c.default,{icon:_.SkypeIcon.People,color:this._useAccessibleTheme()?this._themeColors.primaryIconColor:b.Color.white,hoverColor:this._useAccessibleTheme()?this._themeColors.iconHoverColor:b.Color.whiteOverlay50,size:_.IconSize.size24,style:v.contactsIcon,onPress:this._onContactsButtonClick,title:h.getString("PSTNDialerPanel.ContactsButtonTitle")}):void 0,this._onContactsButtonClick=()=>{d.track(new m.DialerPanelComponentClick(m.DialerPanelClickTarget.ContactsIcon)),p.default.navigateToContactsPanel(void 0,!1,this._getContext())},this._writePrefilledNumberToStore=()=>{var e;const t=this.props.prefilledInput;t&&(null===(e=this.state)||void 0===e?void 0:e.value)!==t&&this._writeToStore(t,l.NavigationCallOrigin.PstnDialpadPrefilled)}}_buildState(e,t){const i=super._buildState(e,t),a=C.default.getPhoneNumber(S.TriggerKeys.Emergency);i.value=C.default.getPhoneNumber(S.TriggerKeys.InputValue).inputValue,i.selectedResult=C.default.getSearchResults().selectedResult,i.phoneNumber=a,i.phoneNumber.emergency?i.mode=T.Emergency:i.mode=T.Regular;const n=o.default.getS4LEntitlementFeatures().SCE;return i.isContactsIconEnabled=n.Dialpad.Features.ContactsIconEnabled,i.isRateIntegrationEnabled=n.UserServices.Client.Features.RateIntegrationEnabled,i.accessibilitySummary=C.default.getAccessibilitySummary(),i.callRate=this._getCallRate(a),t&&(i.showInvalidNumberNote=e.openedOnInvalidNumberError),i}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),this._writePrefilledNumberToStore();const e=r.default.restorePhoneNumberInputIfNeeded();e&&this._writeToStore(e,l.NavigationCallOrigin.PstnDialpadSaveContact),r.default.clearState()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.props.prefilledInput!==e.prefilledInput&&this._writePrefilledNumberToStore()}_getCallRate(e){if(e.E164&&g.default.isValidNumberString(e.E164))return s.default.getCallRateByPhoneNumber(g.default.stripPlusSign(e.E164))}_isEmergencyMode(){return this.state.mode===T.Emergency}_writeToStore(e,t){C.default.overwritePhoneNumberInput(e,!1,t)}_announceForAccessibility(e,t=void 0){return f.default.maybeAnnounceForAccessibility(e,t)}}t.PhoneNumberInputBase=w},639254:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(889391),r=i(898278),l=i(404336),c=i(936540),d=i(651129),u=i(746096),h=i(110117),p=i(766649),g=i(436237),C=i(915877),S=i(733754),m=i(104735),y=i(330124),f=i(461499),b=i(789871),_=i(735426),T=i(886045),v=i(22222),w=i(581760),I=i(311010),P=i(711828),M=i(680837),k=i(619675),A=i(853374),R=(0,C.lazyProperties)({numberInputContainer:()=>o.Styles.createViewStyle({alignItems:"center",flexDirection:"row",paddingBottom:10,paddingLeft:20,paddingRight:10}),numberInput:()=>o.Styles.createTextStyle({backgroundColor:w.Color.transparent,color:w.Color.white,flex:0,font:I.default.font.uiDisplayBold}),emergencyCallContainerStyle:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),emergencyCallContainerStyleLandscape:()=>o.Styles.createViewStyle({flexDirection:"column"}),emergencyCallStyle:()=>o.Styles.createTextStyle({backgroundColor:w.Color.transparent,color:w.Color.white,marginBottom:5,paddingHorizontal:10,flexShrink:1}),emergencyCallLearnMoreStyle:()=>o.Styles.createViewStyle({alignSelf:"flex-start",marginRight:10}),emergencyCallLearnMoreStyleLandscape:()=>o.Styles.createViewStyle({alignSelf:"flex-start",marginLeft:10}),emergencyCallBackground:()=>o.Styles.createViewStyle({backgroundColor:w.Color.red,height:l.DefaultHeight}),errorNotificationFlexStyle:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",marginLeft:10,marginRight:40}),invalidNumberNotificationStyle:()=>o.Styles.createTextStyle({flex:1,backgroundColor:w.Color.transparent,color:w.Color.white,marginBottom:5,marginLeft:10})}),x={numberInput:(0,C.lazyProperties)({MobileSmall:()=>o.Styles.createTextStyle({fontSize:I.default.controlFontSize.h4}),MobileMedium:()=>o.Styles.createTextStyle({fontSize:I.default.controlFontSize.dialpadNumber}),MobileDefault:()=>o.Styles.createTextStyle({fontSize:I.default.controlFontSize.dialpadNumberLarge}),DesktopDefault:()=>o.Styles.createTextStyle({fontSize:I.default.controlFontSize.h4})})};class L extends f.PhoneNumberInputBase{constructor(){super(...arguments),this._onChangeTextEvent={isLocked:!1,newValue:""},this._onPressPhoneNumberContainer=e=>{this.props.onPress&&this.props.onPress()},this._onSubmit=()=>{if(!this.state.phoneNumber.callable||this.state.disableHighBandwidthOperations)return void g.log(u.LogTraceArea.DialerPanel,"PhoneNumberInputDesktop._onSubmit not callable phone number");const e=A.default.newCauseId();g.log(u.LogTraceArea.DialerPanel,"PhoneNumberInputDesktop._onSubmit, causeId: "+e),c.default.startOrAddPstnCall(this.state.phoneNumber.E164,this.state.phoneNumber.emergency,this.state.phoneNumber.countryCode,this.state.phoneNumber.suffix,this.props.callId,this.props.conversationId),!y.default.isUsingStackNavigationContext()&&this._isJoinCallRequest()&&m.default.closeGenericDesktopModal(e,this._getRootViewId())},this._onPaste=e=>{if(!e.clipboardData||!e.clipboardData.items||0===e.clipboardData.items.length)return;const t=n.find(e.clipboardData.items,(e=>"text/plain"===e.type)),i=!!this._textInputRef&&d.default.isCursorPlacedInPrefixArea(this.state.phoneNumber,this._textInputRef.getSelectionRange());t&&(this._onChangeTextEvent.isLocked=!0,t.getAsString((e=>{this._onChangeTextEvent.isLocked=!1;const t=d.default.normalizePhoneNumber(e);if(d.default.isE164Format(t))this._onChangeText(t,u.NavigationCallOrigin.PstnDialpadPasted);else if(i)this._onChangeText(t,u.NavigationCallOrigin.PstnDialpadPasted);else if(!n.isEmpty(this._onChangeTextEvent.newValue)){const e=d.default.normalizePhoneNumber(this._onChangeTextEvent.newValue);this._onChangeText(e,u.NavigationCallOrigin.PstnDialpadPasted)}g.track(new _.PasteNumber)})))},this._renderEmergencyCallElements=()=>{if(!this._isEmergencyMode())return;const e=[],t=[];if(this.state.phoneNumber.forceChangedPrefix){g.debug((()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 0"));const i=S.getString("PSTNDialerPanel.EmergencyCallingDefaultCountryAppliedLabel",{number:this.state.phoneNumber.suffix?this.state.phoneNumber.suffix:"",country:this.state.selectedCountry?this.state.selectedCountry.countryName:""});e.push((0,a.jsx)(k.BodyText,Object.assign({size:k.BodyTextSize.SmallDeprecated,style:R.emergencyCallStyle},{children:i}),"EmergencyCallingDefaultCountryAppliedLabel")),t.push(i)}if(this.state.phoneNumber.callable){let i;if(g.debug((()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 1")),n.includes(this.state.e911EnabledCountries,n.toLower(this.state.phoneNumber.countryCode)))i=S.getString("PSTNDialerPanel.E911CallingLimitedLabel");else{i=S.getString("PSTNDialerPanel.EmergencyCallingLimitedLabel")+" "+S.getString("PstnUtils.EmergencyCallWarning")}e.push((0,a.jsxs)(o.View,Object.assign({style:this.props.isInLandscape?R.emergencyCallContainerStyleLandscape:R.emergencyCallContainerStyle},{children:[(0,a.jsx)(k.Subtitle,Object.assign({style:R.emergencyCallStyle},{children:i}),"EmergencyCallingLimitedLabel"),(0,a.jsx)(v.default,{buttonSize:r.SXButtonSize.Small,buttonStyle:r.SXButtonStyle.LightFill,style:this.props.isInLandscape?R.emergencyCallLearnMoreStyleLandscape:R.emergencyCallLearnMoreStyle,title:S.getString("PstnUtils.EmergencyCallingLearnMore"),allowTextWrap:!0,onPress:this._onPressEmergencyCallLearnMoreHandler},"EmergencyCallingLimitedLabelContainer")]}),"EmergencyCallingContainer")),t.push(i)}else{g.debug((()=>"PhoneNumberInputDesktop._renderOptionalEmergencyCallNotification: 2"));const i=S.getString("PSTNDialerPanel.EmergencyCallingNoCallingLabel"),n=S.getString("PstnUtils.EmergencyCallingNotSupportedRegion");e.push((0,a.jsx)(k.Subtitle,Object.assign({style:R.emergencyCallStyle},{children:i}),"EmergencyCallingNoCallingLabel"),(0,a.jsx)(k.Caption,Object.assign({style:R.emergencyCallStyle},{children:n}),"EmergencyCallingNotSupportedRegion")),t.push(i),t.push(n)}return t.length>0&&T.default.maybeAnnounceForAccessibility(t.join(" ")),e},this._renderInvalidNotification=()=>{if(this.state.showInvalidNumberNote)return(0,a.jsxs)(o.View,Object.assign({style:R.errorNotificationFlexStyle},{children:[(0,a.jsx)(h.default,{icon:P.SkypeIcon.Info,size:P.IconSize.size20,color:w.Color.white},"infoIcon"),(0,a.jsx)(k.BodyText,Object.assign({size:k.BodyTextSize.BigDeprecated,bold:!0,style:R.invalidNumberNotificationStyle,numberOfLines:2},{children:S.getString("PSTNDialerPanel.InvalidNumberError")}))]}))},this._onPressEmergencyCallLearnMoreHandler=()=>{o.Linking.openUrl(s.default.getConfigSettingsNoSubscription().calling.emergencyCallingLearnMoreLink)},this._onTextInputRef=e=>{this._textInputRef=e||void 0},this._handleChangeText=e=>{this._onChangeText(e,u.NavigationCallOrigin.PstnDialpadTyped)},this._onChangeText=(e,t)=>{this._onChangeTextEvent.isLocked?this._onChangeTextEvent.newValue=e:e!==this.state.value&&(e&&!d.default.isValidPhoneNumberInput(e)?this._textInputRef&&this._textInputRef.setValue(this.state.value):b.default.overwritePhoneNumberInput(e,!0,t),this.props.onPress&&this.props.onPress())}}_buildState(e,t){const i=super._buildState(e,t);return i.selectedCountry=b.default.getSelectedCountry(),i.disableHighBandwidthOperations=p.default.isUsingGogoNetwork(),i.e911EnabledCountries=s.default.getS4LEntitlementFeatures().SCE.Dialpad.E911.enabledCountries,i}_getTextInput(){const e=[R.numberInput,this._chooseResponsiveStyle(x.numberInput)];(this._useDarkTheme()||this._useAccessibleTheme())&&e.push(this._themeStyles.headerTextColorStyle);let t=(0,a.jsx)(o.View,Object.assign({style:M.default.flexOne,onPress:this._onPressPhoneNumberContainer},{children:(0,a.jsx)(o.TextInput,{style:e,autoFocus:!0,value:this.state.value,placeholder:S.getString("PSTNPhoneNumberInput.NumberPlaceholder"),accessibilityLabel:this._getAccessibilityLabel(),placeholderTextColor:this._useAccessibleTheme()?w.Color.whiteOverlay80:w.Color.whiteOverlay50,onChangeText:this._handleChangeText,ref:this._onTextInputRef,onPaste:this._onPaste,onSubmitEditing:this._onSubmit,clearButtonMode:"never",keyboardType:"none"})}));return t=(0,a.jsx)("div",Object.assign({className:this._useAccessibleTheme()?void 0:"inputGradient"},{children:t})),t}_isJoinCallRequest(){return this.props.callId&&this.props.conversationId}_isInputFocused(){return this._textInputRef&&this._textInputRef.isFocused()}render(){const e=this._isEmergencyMode()||this.state.showInvalidNumberNote?(0,a.jsxs)(o.View,{children:[this._renderEmergencyCallElements(),this._renderInvalidNotification()]}):void 0;return(0,a.jsxs)(o.View,Object.assign({style:this._isEmergencyMode()?R.emergencyCallBackground:void 0},{children:[(0,a.jsxs)(o.View,Object.assign({style:R.numberInputContainer},{children:[(0,a.jsx)(o.View,Object.assign({style:M.default.flexOne},{children:this._getTextInput()})),this._getOptionalContactsIcon()]})),e]}))}componentDidMount(){super.componentDidMount(),this._textInputRef&&this._textInputRef.selectRange(-1,-1)}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.showInvalidNumberNote&&this.props.prefilledInput!==this.state.phoneNumber.E164&&this.setState({showInvalidNumberNote:!1}),this.props.navigationSource===u.DialerNavigationSource.EdgeTelLink&&b.default.setPhoneNumberOrigin(u.NavigationCallOrigin.EdgeTelLink),this._isInputFocused()||!this.state.phoneNumber.inputValue)return void(this.state.isRateIntegrationEnabled&&this.state.callRate&&T.default.maybeAnnounceForAccessibility(this.state.callRate));const a=this._getAccessibilityLabel(!0);a&&T.default.maybeAnnounceForAccessibility(a,500),this.state.selectedResult&&!t.selectedResult&&this.requestFocus()}requestFocus(){n.defer((()=>{if(this.isComponentMounted()&&this._textInputRef){this._textInputRef.requestFocus();const e=this.state.phoneNumber.inputValue.length;e>0&&this._textInputRef.selectRange(e,e)}}))}_getCallAccessibilityLabel(){return this._isInputFocused()?S.getString("PSTNPhoneNumberInput.AccessibilityLabelEnterToCall"):S.getString("PSTNPhoneNumberInput.AccessibilityLabel")}_getAccessibilityLabel(e=!1){const t=e?[this.state.value]:[];return this.state.showInvalidNumberNote?t.push(S.getString("PSTNDialerPanel.InvalidNumberError")):this.state.phoneNumber.callable&&t.push(this._getCallAccessibilityLabel()),this.state.accessibilitySummary&&(this.state.accessibilitySummary.searchHasResults&&t.push(S.getString("PSTNPhoneNumberInput.A11yLabelContactsFound")),this.state.accessibilitySummary.selectedContactDisplayName&&t.push(S.getString("PSTNPhoneNumberInput.A11yLabelSingleContactSelected",{contactName:this.state.accessibilitySummary.selectedContactDisplayName})),!d.default.isE164Format(this.state.value)&&this.state.accessibilitySummary.selectedCountryName&&t.push(S.getString("PSTNPhoneNumberInput.AccessibilityLabelDestinationCountry",{country:this.state.accessibilitySummary.selectedCountryName}))),this.state.isRateIntegrationEnabled&&!this._isInputFocused()&&this.state.callRate&&t.push(this.state.callRate),t.length?t.join(", "):void 0}}t.default=L},254344:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(434849),o=i(516778),s=i(746096),r=i(110117),l=i(436237),c=i(915877),d=i(733754),u=i(330124),h=i(461499),p=i(735426),g=i(581760),C=i(311010),S=i(711828),m=i(680837),y=i(619675),f=i(400451),b=(0,c.lazyProperties)({numberInputContainer:()=>o.Styles.createViewStyle({alignItems:"center",flexDirection:"row",paddingBottom:10,paddingLeft:10,paddingRight:0,minHeight:45}),inputWrapper:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row"}),numberInput:()=>o.Styles.createTextStyle({backgroundColor:"transparent",color:g.Color.white,flex:0,font:C.default.font.uiDisplayBold,paddingRight:10}),numberInputFade:()=>o.Styles.createTextStyle({color:g.Color.whiteOverlay50}),numberInputFadeAccessibleLight:()=>o.Styles.createTextStyle({color:g.Color.blackOverlay60}),numberInputFadeAccessibleDark:()=>o.Styles.createTextStyle({color:g.Color.whiteOverlay80}),contextMenu:()=>o.Styles.createViewStyle({alignSelf:"stretch",flex:1}),errorNotificationFlexStyle:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",marginRight:40}),invalidNumberNotificationStyle:()=>o.Styles.createTextStyle({flex:1,backgroundColor:g.Color.transparent,color:g.Color.white,textAlignVertical:"top",marginBottom:5,marginLeft:10}),extendedHeight:()=>o.Styles.createTextStyle({minHeight:150})}),_={numberInput:(0,c.lazyProperties)({MobileSmall:()=>o.Styles.createTextStyle({fontSize:C.default.controlFontSize.h4}),MobileMedium:()=>o.Styles.createTextStyle({fontSize:C.default.controlFontSize.dialpadNumber}),MobileDefault:()=>o.Styles.createTextStyle({fontSize:C.default.controlFontSize.dialpadNumberLarge}),DesktopDefault:()=>o.Styles.createTextStyle({fontSize:C.default.controlFontSize.h4})})},T="copy",v="paste";class w extends h.PhoneNumberInputBase{constructor(){super(...arguments),this._onPress=e=>{this.props.onPress&&this.props.onPress()},this._onContextMenuRef=e=>{this._contextMenu=e||void 0},this._showContextMenu=()=>{this._contextMenu&&this._contextMenu.showContextMenu()},this._handleItemSelected=e=>{switch(e){case T:const e=this.state.value;e&&f.default.writeText(e);break;case v:l.track(new p.PasteNumber),o.Clipboard.getText().then((e=>{this._writeToStore(e,s.NavigationCallOrigin.PstnDialpadPasted)}))}},this._renderInvalidNotification=()=>{if(this.state.showInvalidNumberNote)return(0,a.jsxs)(o.View,Object.assign({style:b.errorNotificationFlexStyle},{children:[(0,a.jsx)(r.default,{icon:S.SkypeIcon.Info,color:g.Color.white,size:S.IconSize.size20}),(0,a.jsx)(y.BodyText,Object.assign({size:y.BodyTextSize.BigDeprecated,bold:!0,style:b.invalidNumberNotificationStyle},{children:d.getString("PSTNDialerPanel.InvalidNumberError")}))]}))}}_buildState(e,t){const i=super._buildState(e,t);return i.isUsingStackNavigationContext=u.default.isUsingStackNavigationContext(),i}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.showInvalidNumberNote)return this.props.prefilledInput!==this.state.phoneNumber.E164&&this.setState({showInvalidNumberNote:!1}),void(t.showInvalidNumberNote||this._announceForAccessibility(d.getString("PSTNDialerPanel.InvalidNumberError")));this.state.accessibilitySummary&&t.value===this.state.value&&(this.state.accessibilitySummary.searchHasResults?this._announceForAccessibility(d.getString("PSTNPhoneNumberInput.A11yLabelContactsFound")):this.state.accessibilitySummary.selectedContactDisplayName&&this._announceForAccessibility(d.getString("PSTNPhoneNumberInput.A11yLabelSingleContactSelected",{contactName:this.state.accessibilitySummary.selectedContactDisplayName})))}_announceForAccessibility(e){o.Accessibility.announceForAccessibility(e)}_getTextInput(){const e=[b.numberInput,this._chooseResponsiveStyle(_.numberInput)];(this._useDarkTheme()||this._useAccessibleTheme())&&e.push(this._themeStyles.headerTextColorStyle),0===this.state.value.length&&(this._useAccessibleTheme()?e.push(this._useDarkTheme()?b.numberInputFadeAccessibleDark:b.numberInputFadeAccessibleLight):e.push(b.numberInputFade));const t=this.state.value;return(0,a.jsx)(o.Text,Object.assign({style:e,numberOfLines:1,allowFontScaling:!1,ellipsizeMode:"head"},{children:t||d.getString("PSTNPhoneNumberInput.NumberPlaceholder")}))}render(){let e;this.state.isUsingStackNavigationContext&&(e=[b.inputWrapper]);const t=this.state.value.length?d.getString("PSTNPhoneNumberInput.AccessibilityLabelEnteredPhoneNumber",{number:this.state.value}):d.getString("PSTNPhoneNumberInput.AccessibilityLabelNumberPlaceholder");return(0,a.jsxs)(o.View,Object.assign({style:this.state.showInvalidNumberNote?[b.numberInputContainer,b.extendedHeight]:b.numberInputContainer},{children:[(0,a.jsx)(n.ContextMenu,Object.assign({items:this._getMenuItems(),onItemSelected:this._handleItemSelected,style:b.contextMenu,ref:this._onContextMenuRef},{children:(0,a.jsxs)(o.View,Object.assign({onLongPress:this._showContextMenu,onPress:this._onPress,style:m.default.flexOne},{children:[(0,a.jsx)(o.View,Object.assign({style:e,accessibilityLabel:t},{children:this._getTextInput()})),this._renderInvalidNotification()]}))})),this._getOptionalContactsIcon()]}))}_getMenuItems(){return[{text:d.getString("Pstn.CopyContextMenu"),command:T},{text:d.getString("Pstn.PasteContextMenu"),command:v}]}}t.default=w},161230:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ResponsiveComponentBase=void 0;const a=i(29130),n=i(24576);class o extends n.default{constructor(e){super(e),this._mobileSmallBreakpoint=360,this._mobileMediumBreakpoint=400,this._desktopSmallBreakpoint=800,this._desktopSmallHeightBreakpoint=600}_buildState(e,t){const i=this._getRootViewId(),n={};return n.xSize=a.default.getWidth(i),n.ySize=a.default.getHeight(i),n.isMobileScreenSize=a.default.isMobileScreenSize(i),n}_chooseResponsiveStyle(e){const t=this.props.isInLandscape?this.state.ySize:this.state.xSize,i=this.state.ySize,a=(this.props.isInLandscape?e.MobileDefaultLandscape:void 0)||e.MobileDefault;return this.state.isMobileScreenSize?t<=this._mobileSmallBreakpoint?e.MobileSmall||a:t<=this._mobileMediumBreakpoint?e.MobileMedium||a:e.MobileDefault:(t<=this._desktopSmallBreakpoint||i<=this._desktopSmallHeightBreakpoint)&&e.DesktopSmall||e.DesktopDefault}}t.ResponsiveComponentBase=o},778314:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(898278),r=i(258031),l=i(400984),c=i(651129),d=i(156976),u=i(587134),h=(i(746096),i(324393)),p=i(436237),g=i(915877),C=i(733754),S=i(104735),m=i(789871),y=i(789871),f=i(735426),b=i(29130),_=i(581760),T=i(311010),v=i(711828),w=i(478262),I=i(24576),P=(0,g.lazyProperties)({buttonContainer:()=>o.Styles.createViewStyle({backgroundColor:_.Color.transparent,marginBottom:12,alignItems:"flex-start"}),buttonStyle:()=>o.Styles.createViewStyle({paddingHorizontal:20,paddingVertical:6}),titleStyle:()=>o.Styles.createTextStyle({paddingLeft:12}),topBorderDividerDarkTheme:()=>o.Styles.createViewStyle({backgroundColor:_.Color.dialPadHoverDark}),topBorderDividerLightTheme:()=>o.Styles.createViewStyle({backgroundColor:_.Color.whiteOverlay20})});class M extends I.default{constructor(){super(...arguments),this._onButtonPress=e=>{if(e.stopPropagation(),this.state.phoneNumber){const e=c.default.getPhoneNumberMri(this.state.phoneNumber);if(l.default.isContact(e))return;d.default.savePhoneNumberInput(this.state.phoneNumber.inputValue),p.track(new f.DialerPanelComponentClick(f.DialerPanelClickTarget.SaveContactButton));const t={number:n.isEmpty(this.state.phoneNumber.E164)?this.state.phoneNumber.suffix:this.state.phoneNumber.E164,type:w.PhoneNumberTypes.Mobile};S.default.navigateToAddPhoneNumberPanel(r.AddPhoneNumberPanelOrigin.DialpadPanel,this._getRootViewId(),void 0,[t],void 0,this._onPhoneNumberSaved,this._onSaveNumberCancelled)}},this._onPhoneNumberSaved=e=>{y.default.preselectSavedContact(e),this.props.onContactSaved&&this.props.onContactSaved(),p.track(new f.SaveContactDialpadFlowStep(f.SaveContactFlowStep.SaveContactSuceeded))},this._onSaveNumberCancelled=()=>{d.default.shouldRestoreState(),p.track(new f.SaveContactDialpadFlowStep(f.SaveContactFlowStep.SaveContactCancelled))}}_buildState(e,t){return{phoneNumber:y.default.getPhoneNumber(m.TriggerKeys.E164),contentSizeMultiplier:b.default.getContentSizeMultiplier()}}render(){const e=this._useAccessibleTheme()?this._themeColors.primaryIconColor:_.Color.white,t=o.Styles.createTextStyle({color:e},!1),i=[P.titleStyle,T.default.bodyFontStyle(this._currentTheme),t];return!this._useDarkTheme()&&this._useAccessibleTheme()&&i.push(this._themeStyles.primaryTextColorStyle),p.track(new f.SaveContactDialpadFlowStep(f.SaveContactFlowStep.SaveContactButtonShow)),(0,a.jsxs)(o.View,Object.assign({style:P.buttonContainer},{children:[(0,a.jsx)(u.default,{marginLeft:10,marginRight:10,marginBottom:10,style:this._useDarkTheme()?P.topBorderDividerDarkTheme:P.topBorderDividerLightTheme}),(0,a.jsx)(h.default,{size:this._getContentSizeHeight(v.IconSize.size24),color:this._useAccessibleTheme()?this._themeColors.primaryIconColor:_.Color.white,icon:v.SkypeIcon.ContactAdd,title:C.getString("PSTNDialerPanel.PSTNDialerSaveContactButtonLabel"),accessibilityLabel:C.getString("PSTNDialerPanel.PSTNDialerSaveContactButtonLabel"),titleStyle:i,useTrailingIcon:!1,onPress:this._onButtonPress,style:P.buttonStyle})]}))}_getContentSizeHeight(e){return e*Math.min(this.state.contentSizeMultiplier||1,s.MaxContentSizeMultiplier)}}t.default=M},37627:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(915877),s=(i(733754),i(789871)),r=(i(886045),i(581760)),l=i(619675),c=i(24576),d=i(702301),u=i(567977),h=(0,o.lazyProperties)({container:()=>n.Styles.createButtonStyle({flex:0,flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingVertical:4}),textContainer:()=>n.Styles.createViewStyle({flex:1,marginHorizontal:10}),textStyle:()=>n.Styles.createTextStyle({backgroundColor:r.Color.transparent,color:r.Color.white})});class p extends c.default{_buildState(e,t){return{selectedResult:s.default.getSearchResults().selectedResult}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i)}render(){if(!this.state.selectedResult)return null;const e=!this._useDarkTheme()&&this._useAccessibleTheme();return(0,a.jsxs)(n.View,Object.assign({style:h.container},{children:[(0,a.jsx)(d.default,{size:u.UserIconSize.Size40,userMri:this.state.selectedResult.contact.userMri,statusBorderColor:this._themeColors.primaryBackgroundColor},"selectedContactUserIcon"),(0,a.jsx)(n.View,Object.assign({style:h.textContainer},{children:(0,a.jsx)(l.RowTitle,Object.assign({style:e?this._themeStyles.primaryTextColorStyle:h.textStyle,numberOfLines:1},{children:this.state.selectedResult.contact.displayName}))}))]}))}}t.default=p},716610:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(705465),s=i(281878),r=i(967593),l=i(889391),c=i(110117),d=i(458666),u=i(915877),h=i(733754),p=i(18078),g=i(581760),C=i(311010),S=i(711828),m=i(680837),y=i(24576),f=i(702301),b=i(567977),_=i(10102),T=(0,u.lazyProperties)({iconPadding:()=>n.Styles.createViewStyle({paddingRight:10,paddingLeft:10}),selectLang:()=>n.Styles.createTextStyle({paddingTop:0,height:22,lineHeight:20,overflow:"hidden",flexShrink:1}),selectLangMobile:()=>n.Styles.createTextStyle({paddingTop:3,height:22,lineHeight:20,overflow:"hidden",flexShrink:1}),container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),selectLangContainer:()=>n.Styles.createViewStyle({flex:1,flexGrow:1,flexShrink:1,flexDirection:"row",alignItems:"flex-start",alignContent:"flex-start",justifyContent:"flex-start",borderRadius:7}),selectLangContainerWidth:()=>n.Styles.createViewStyle({flexBasis:"35%"}),selectLangContainerPadding3:()=>n.Styles.createViewStyle({padding:3}),selectLangContainerBg:()=>n.Styles.createViewStyle({backgroundColor:g.Color.gray400}),flagContainerMobile:()=>n.Styles.createViewStyle({borderRadius:10,borderWidth:1,width:20,height:20,overflow:"hidden",paddingTop:4,alignItems:"center"}),flagContainerDesktop:()=>n.Styles.createViewStyle({marginLeft:4,marginRight:4,borderRadius:10,borderWidth:1,width:20,height:20,overflow:"hidden",paddingTop:3,paddingLeft:2,paddingRight:2,alignItems:"center"}),flagContainerBig:()=>n.Styles.createViewStyle({marginLeft:4,marginRight:4,borderRadius:20,borderWidth:2,width:40,height:40,overflow:"hidden",paddingTop:8,paddingLeft:2,paddingRight:2,alignItems:"center"}),flagContainerBorderGray:()=>n.Styles.createViewStyle({borderColor:g.Color.gray200}),flagContainerBorderBlue:()=>n.Styles.createViewStyle({borderColor:g.Color.blue}),flag:()=>n.Styles.createTextStyle({fontSize:9,fontWeight:"700"}),flagColor:()=>n.Styles.createTextStyle({color:g.Color.white}),flagBig:()=>n.Styles.createTextStyle({color:g.Color.white,fontSize:18,fontWeight:"700"}),leftArrow:()=>n.Styles.createViewStyle({position:"absolute",backgroundColor:g.Color.sxBlue,width:20,height:25,bottom:0,borderBottomRightRadius:25,left:2}),rightArrow:()=>n.Styles.createViewStyle({position:"absolute",width:20,height:25,bottom:0,borderBottomLeftRadius:25,right:2}),leftBubbleMargin:()=>n.Styles.createViewStyle({marginLeft:4}),rightBubbleMargin:()=>n.Styles.createViewStyle({marginRight:4}),languageBubbleRadius:()=>n.Styles.createViewStyle({borderRadius:16})}),v={textTransform:"uppercase"},w={textOverflow:"ellipsis",whiteSpace:"nowrap"},I=b.UserIconSize.Size36;class P extends y.default{constructor(){super(...arguments),this._onLanguageChange=()=>{this.props.onLanguageChange(this.props.isLocalLanguage)},this._onButtonRef=e=>{this.props.onRef&&e&&this.props.onRef(e)}}_buildState(e,t){return{settings:l.default.getS4LCMCFeatures().pstnTranslation}}_getNameFromCode(e){return d.getShortLanguageTitle(e)||e}render(){let e,t;const i=this._themeStyles.primaryIconColorStyle,l=this._themeColors.primaryIconColor,u=[T.selectLangContainer],g=[],y=[v];if(this.props.onlyIcon?(u.push(T.selectLangContainerPadding3),g.push(T.flagContainerBig),y.push(T.flagBig)):(u.push(T.selectLangContainerWidth),g.push(T.flagContainerDesktop),y.push(T.flag),y.push(i)),this.props.languageCode?g.push(T.flagContainerBorderBlue):g.push(T.flagContainerBorderGray),!this.props.onlyIcon&&this.state.settings.useUserIconInsteadOfFlags){g.push(n.Styles.createViewStyle({borderWidth:0,paddingTop:0,paddingLeft:0,paddingRight:0,width:I,height:I+2},!1)),t=this.props.languageCode?this._getNameFromCode(this.props.languageCode):h.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguage");const i=this.props.isLocalLanguage?p.default.getSkypeMri():this.props.conversationId;e=(0,a.jsx)(f.UserIcon,{userMri:i,size:I})}else this.props.languageCode?(t=this._getNameFromCode(this.props.languageCode),e=(0,a.jsx)(n.Text,Object.assign({style:y},{children:d.getLanguageFromLocale(this.props.languageCode)}))):(t=h.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguage"),e=(0,a.jsx)(c.default,{icon:S.SkypeIcon.SkypeTranslator,size:S.IconSize.size36,color:l}));const b=this.props.onlyIcon?void 0:(0,a.jsx)(n.Text,Object.assign({numberOfLines:1,style:[this.props.isUsingStackNavigationContext?T.selectLangMobile:T.selectLang,this._themeStyles.primaryTextColorStyle,C.default.fontStyle.secondaryButton,w]},{children:t}));let P;this.props.languageCode?(P=this.props.isLocalLanguage?h.getString("LanguageAndTranslationSettingsPanel.TranslationSelectedLocalLanguageTitleAccessibility"):h.getString("LanguageAndTranslationSettingsPanel.TranslationSelectedOtherLanguageTitleAccessibility"),P+=": "+this._getNameFromCode(this.props.languageCode)):P=this.props.isLocalLanguage?h.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLocalLanguageTitleAccessibility"):h.getString("LanguageAndTranslationSettingsPanel.TranslationSelectOtherLanguageTitleAccessibility");const M=_.reverseGradientColorsForColorInfo(this._getContext().userColor),k=[m.default.absoluteFill,T.languageBubbleRadius],A=this.props.isLocalLanguage?(0,a.jsx)(r.GradientView,{style:k,colors:M,direction:r.GradientDirection.RIGHT}):null,R=m.default.absoluteFill,x=this.props.isLocalLanguage?(0,a.jsx)(r.GradientView,{style:R,colors:M,direction:r.GradientDirection.RIGHT}):null,L=(0,a.jsx)(o.Pressable,Object.assign({onPress:this._onLanguageChange,style:m.default.flexOneRN},{children:(0,a.jsxs)(s.Box,Object.assign({importantForAccessibility:"no-hide-descendants",accessibilityLabel:P,ref:this._onButtonRef,backgroundColor:this._getContext().themeColors.bubbleColorSelfModernize,borderColor:void 0,borderWidth:"0",paddingLeft:"3",paddingTop:"2",paddingBottom:"2",paddingRight:"3",borderRadius:"16",flex:"1",flexDirection:"row"},{children:[(0,a.jsx)(n.View,Object.assign({style:[this.props.isLocalLanguage?T.leftArrow:T.rightArrow,{backgroundColor:this._getContext().themeColors.bubbleColorSelfModernize}]},{children:x})),A,b]}))})),V=this.props.isLocalLanguage?[(0,a.jsx)(n.View,Object.assign({style:n.Styles.combine([g,T.rightBubbleMargin])},{children:e})),L]:[L,(0,a.jsx)(n.View,Object.assign({style:n.Styles.combine([g,T.leftBubbleMargin])},{children:e}))];return(0,a.jsx)(n.View,Object.assign({style:u,importantForAccessibility:n.Types.ImportantForAccessibility.Auto,accessibilityTraits:n.Types.AccessibilityTrait.Button},{children:V}))}}class M extends y.default{constructor(){super(...arguments),this._onButtonRef=e=>{this.props.onRef&&e&&this.props.onRef(e)}}render(){const e=[T.container],t=[T.iconPadding],i=S.IconSize.size24;this.props.onlyIcons||e.push(m.default.flexOne);const o=this._themeColors.primaryIconColor;return(0,a.jsxs)(n.View,Object.assign({style:e},{children:[(0,a.jsx)(P,{colorThemeOverride:this.props.colorThemeOverride,isUsingStackNavigationContext:this.props.isUsingStackNavigationContext,languageCode:this.props.localLanguageLocale,onLanguageChange:this.props.changeLanguage,onlyIcon:this.props.onlyIcons,isLocalLanguage:!0,onRef:this.props.onRef}),(0,a.jsx)(n.Button,Object.assign({onPress:this.props.flipLanguages,accessibilityTraits:n.Types.AccessibilityTrait.Button,accessibilityLabel:h.getString("LanguageAndTranslationSettingsPanel.TranslationLanguageSwitchTitle"),importantForAccessibility:n.Types.ImportantForAccessibility.Auto,ref:this._onButtonRef},{children:(0,a.jsx)(c.default,{icon:S.SkypeIcon.LanguageSwitch,size:i,color:o,style:t})})),(0,a.jsx)(P,{colorThemeOverride:this.props.colorThemeOverride,isUsingStackNavigationContext:this.props.isUsingStackNavigationContext,languageCode:this.props.otherLanguageLocale,onLanguageChange:this.props.changeLanguage,onlyIcon:this.props.onlyIcons,isLocalLanguage:!1,onRef:this.props.onRef,conversationId:this.props.conversationId})]}))}}t.default=M},450845:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(462033),s=i(994224),r=i(502278),l=i(898278),c=i(311734),d=i(153211),u=i(757139),h=i(746096),p=i(805581),g=i(436237),C=i(547126),S=i(915877),m=i(733754),y=i(46929),f=i(716610),b=i(600076),_=(i(886045),i(581760)),T=i(711828),v=i(22222),w=i(24576),I=i(733574),P=i(853374),M=i(600212),k=i(889391),A=i(458666),R=i(322418),x=i(598925),L=(0,S.lazyProperties)({langBarContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center"}),langBarContainerPaddingTop:()=>n.Styles.createViewStyle({paddingTop:20}),doneButtonContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"center"}),doneButton:()=>n.Styles.createButtonStyle({alignSelf:"center"}),sectionTitleOverride:()=>n.Styles.createTextStyle({fontWeight:"bold",fontSize:14}),blank:()=>n.Styles.createViewStyle({})}),V=50,O={marginTop:0,marginBottom:0};class B extends w.default{constructor(){super(...arguments),this._dividerCount=0,this._buttons=[],this._onKeyUp=e=>(e.keyCode===C.default.ESCAPE&&this._onBack(),!1),this._onBack=()=>{const e=P.default.newCauseId();return g.log(h.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu._onBack Menu close on ESC press, causeId: ${e}`),u.default.close(this._getRootViewId(),e),!0},this._onButtonsRef=e=>{e&&this._buttons.push(e)}}static menuHeight(){let e=0;return e+=150,e+=2*c.default.rowHeight(O),e+=c.default.rowHeight(O),e+=60,e}_buildState(e,t){const i={translatorVoice:y.default.getCallTranslatorBotTranslationVoice(),localLanguageLocale:e.isPstnTranslation?p.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri):p.default.getCallTranslatorSpokenLanguage(e.conversationMri),otherLanguageLocale:e.isPstnTranslation?p.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(e.conversationMri):void 0,autoDetectFeatureEnabled:k.default.getS4LCMCFeatures().translationFeatures.automaticLangDetection,autoDetectEnabled:y.default.getCallTranslatorTranslationAutoDetectEnabled(),truVoiceFeatureEnabled:k.default.getS4LCMCFeatures().translationFeatures.truVoice,truVoiceEnabled:y.default.getCallTranslatorTruVoiceEnabled(),truVoiceConsentState:e.callId?R.default.getInCallFeatureState(e.callId):void 0};return e.callId&&(i.isTranslating=e.isPstnTranslation?s.default.InCallBotService.isPstnTranslationEnabled(e.callId):s.default.InCallBotService.isSkypeTranslationEnabled(e.callId)),i}componentDidMount(){super.componentDidMount();const e=s.default.InCallBotService.getPstnTranslationSessionId(this.props.callId);this.props.callId&&r.default.onPstnTranslationSettingsOpened(this.props.callId,e);const t=P.default.newCauseId();g.log(h.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.componentDidMount Menu open causeId: ${t}`),o.default.subscribe(this._onBack),n.Input.keyUpEvent.subscribe(this._onKeyUp)}componentWillUnmount(){super.componentWillUnmount();const e=P.default.newCauseId();g.log(h.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.componentWillUnMount Menu close causeId: ${e}`),o.default.unsubscribe(this._onBack),n.Input.keyUpEvent.unsubscribe(this._onKeyUp)}_translationDisabled(){return this.props.isPstnTranslation&&(!this.state.localLanguageLocale||!this.state.otherLanguageLocale)||this.props.isSkypeTranslation&&!this.state.localLanguageLocale||!this.state.translatorVoice}_getDividerProps(){let e=_.Color.whiteOverlay30;if(this.props.colorThemeOverride){e=M.default.themeColorsForTheme(this.props.colorThemeOverride).secondaryTextColor}return Object.assign(Object.assign({},O),{key:"divider-"+this._dividerCount++,rowHeight:c.default.rowHeight(O),color:e})}_addDivider(e){e.push({props:this._getDividerProps(),builder:c.default.buildRow,nonInteractive:!0})}_addAutoDetectionToggle(e){const t=m.getString("LanguageAndTranslationSettingsPanel.AutoDetectLanguage"),i=t+", "+(this.state.autoDetectEnabled?m.getString("ToggleSwitch.OnText"):m.getString("ToggleSwitch.OffText")),a={key:"autoDetectLanguage",rowType:d.CustomActionMenuRowType.Toggle,isSelected:this.state.autoDetectEnabled,accessibilityLabel:i,titleText:t,onRowPress:this.props.toggleAutoDetect,rowHeight:V,hideBorder:!0,icon:T.SkypeIcon.Wand,toggleOverlayColorAndroid:_.Color.black,onRef:this._onButtonsRef,hoverStyle:L.blank,autoShortenText:!0};e.push({props:a,builder:d.default.buildRow})}_addPstnLangChangeRow(e){const t=(0,a.jsx)(n.View,Object.assign({style:[L.langBarContainer,void 0]},{children:(0,a.jsx)(f.default,{isPstnTranslation:this.props.isPstnTranslation,isUsingStackNavigationContext:this.props.isUsingStackNavigationContext,isSkypeTranslation:this.props.isSkypeTranslation,localLanguageLocale:this.state.localLanguageLocale,otherLanguageLocale:this.state.otherLanguageLocale,colorThemeOverride:this.props.colorThemeOverride,conversationId:this.props.conversationMri,flipLanguages:this.props.flipLanguages,changeLanguage:this.props.changeLanguage})})),i=m.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLanguageTitle"),o={key:"langswitch",rowType:d.CustomActionMenuRowType.Custom,accessibilityLabel:i,rowHeight:70,hideBorder:!0,customElement:t,hoverStyle:L.blank};e.push({props:o,builder:d.default.buildRow})}_addSkypeLangChangeRow(e){const t=m.getString("LanguageAndTranslationSettingsPanel.SpokenLanguageLabel"),i=this.state.localLanguageLocale?(a=this.state.localLanguageLocale,A.getShortLanguageTitle(a)||a):"";var a;const n=t+", "+i,o={key:"translationlang",rowType:d.CustomActionMenuRowType.Default,accessibilityLabel:n,titleText:t,onRowPress:()=>this.props.changeLanguage(!0),rowHeight:V,hideBorder:!0,icon:T.SkypeIcon.PersonVoice,rightSideText:i,disabled:this.props.isSkypeTranslation&&this.state.autoDetectFeatureEnabled?this.state.autoDetectEnabled:void 0,onRef:this._onButtonsRef,hoverStyle:L.blank,autoShortenText:!0};e.push({props:o,builder:d.default.buildRow})}_addVoiceTitle(e){const t=m.getString("LanguageAndTranslationSettingsPanel.TranslationVoiceSelectionTitle"),i={key:"selectVoiceTitle",rowType:d.CustomActionMenuRowType.Default,accessibilityLabel:t,titleText:t,rowHeight:V,hideBorder:!0,hoverStyle:L.blank,containerStyleOverride:L.sectionTitleOverride,autoShortenText:!0,removeTabIndex:!0};e.push({props:i,builder:d.default.buildRow,nonInteractive:!0})}_addTruvoiceToggle(e){const t=k.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName,i=m.getString("LanguageAndTranslationSettingsPanel.TranslationTruVoice",{featureName:t}),a=i+", "+(this.state.truVoiceEnabled?m.getString("ToggleSwitch.OnText"):m.getString("ToggleSwitch.OffText")),n={key:"truVoice",rowType:d.CustomActionMenuRowType.Toggle,isSelected:this.state.truVoiceEnabled,accessibilityLabel:a,titleText:i,onRowPress:this.props.toggleTruVoice,rowHeight:V,hideBorder:!0,icon:T.SkypeIcon.MicrophoneSpark,toggleOverlayColorAndroid:_.Color.black,onRef:this._onButtonsRef,hoverStyle:L.blank,autoShortenText:!0};e.push({props:n,builder:d.default.buildRow})}_addVoiceSelector(e){const t=m.getString("LanguageAndTranslationSettingsPanel.TranslationSystemVoiceTitle");let i;i=this.props.isSkypeTranslation&&this.state.truVoiceFeatureEnabled&&this.state.truVoiceEnabled?m.getString("ToggleSwitch.OffText"):this.state.translatorVoice?I.default.getLabelForGender(this.state.translatorVoice):m.getString("LanguageAndTranslationSettingsPanel.TranslationSelectDefaultValue");const a=t+", "+i,n={key:"translationvoice",rowType:d.CustomActionMenuRowType.Default,accessibilityLabel:a,titleText:t,onRowPress:this.props.changeVoice,rowHeight:V,hideBorder:!0,icon:this.props.isSkypeTranslation?T.SkypeIcon.Robot:T.SkypeIcon.PersonVoice,rightSideText:i,disabled:this.props.isSkypeTranslation&&this.state.truVoiceFeatureEnabled?this.state.truVoiceEnabled:void 0,onRef:this._onButtonsRef,hoverStyle:L.blank,autoShortenText:!0};e.push({props:n,builder:d.default.buildRow})}_addTranslateToggle(e){const t=m.getString("LanguageAndTranslationSettingsPanel.TranslateThisCall"),i=t+", "+(this.state.isTranslating?m.getString("ToggleSwitch.OnText"):m.getString("ToggleSwitch.OffText")),a={key:"translatecall",rowType:d.CustomActionMenuRowType.Toggle,isSelected:this.state.isTranslating,accessibilityLabel:i,titleText:t,onRowPress:this.props.translateCall,rowHeight:V,hideBorder:!0,icon:T.SkypeIcon.SkypeTranslator,disabled:this._translationDisabled(),toggleOverlayColorAndroid:_.Color.black,onRef:this._onButtonsRef,hoverStyle:L.blank,autoShortenText:!0};e.push({props:a,builder:d.default.buildRow})}_addStopTranslationRow(e){const t=m.getString("CallTranscriptionNotifications.StopTranslation"),i=(0,a.jsx)(n.View,Object.assign({style:L.doneButtonContainer},{children:(0,a.jsx)(v.default,{buttonSize:l.SXButtonSize.Small,title:t,onPress:()=>{this.props.translateCall(),this.props.closeMenu()},style:L.doneButton})})),o={key:"done",rowType:d.CustomActionMenuRowType.Custom,accessibilityLabel:t,rowHeight:60,hideBorder:!0,customElement:i,removeTabIndex:!0,hoverStyle:L.blank};e.push({props:o,builder:d.default.buildRow})}_addDoneButtonRow(e){const t=m.getString("Global.DoneButtonTitle"),i=(0,a.jsx)(n.View,Object.assign({style:L.doneButtonContainer},{children:(0,a.jsx)(v.default,{buttonSize:l.SXButtonSize.Small,title:t,onPress:this.props.closeMenu,style:L.doneButton})})),o={key:"done",rowType:d.CustomActionMenuRowType.Custom,accessibilityLabel:t,rowHeight:60,hideBorder:!0,customElement:i,removeTabIndex:!0,hoverStyle:L.blank};e.push({props:o,builder:d.default.buildRow})}_getPstnTranslationMenu(e){this._addPstnLangChangeRow(e),this._addDivider(e),this._addVoiceSelector(e),this._addDivider(e),this._addTranslateToggle(e),this.props.isUsingStackNavigationContext||(this._addDivider(e),this._addDoneButtonRow(e))}_getSkypeTranslationMenu(e){var t,i;this.state.autoDetectFeatureEnabled&&(this._addAutoDetectionToggle(e),this._addDivider(e)),this._addSkypeLangChangeRow(e),this._addDivider(e);const a=(null===(t=this.state.truVoiceConsentState)||void 0===t?void 0:t.state)===x.InCallFeatureState.Enabled||(null===(i=this.state.truVoiceConsentState)||void 0===i?void 0:i.state)===x.InCallFeatureState.EnabledByRemote;(this.state.truVoiceFeatureEnabled||a)&&(this._addVoiceTitle(e),this._addTruvoiceToggle(e),this._addDivider(e)),this._addVoiceSelector(e),this._addDivider(e),this._addStopTranslationRow(e)}render(){const e=[];return this.props.isSkypeTranslation?this._getSkypeTranslationMenu(e):this.props.isPstnTranslation&&this._getPstnTranslationMenu(e),(0,a.jsx)(b.default,{rowBuilders:e,colorThemeOverride:this.props.colorThemeOverride,style:this.props.style})}}t.default=B},501452:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(583367),o=i(516778),s=i(244770),r=i(898278),l=i(72822),c=i(235251),d=i(915877),u=i(733754),h=i(104735),p=i(294021),g=i(938980),C=(i(328377),i(29130)),S=i(22222),m=i(619675),y=i(24576),f=(0,d.lazyProperties)({noCallsItemContainer:()=>o.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10}),noCallsItemContainerSmallTopMargin:()=>o.Styles.createViewStyle({marginTop:20}),noCallsItemContainerLargeTopMargin:()=>o.Styles.createViewStyle({marginTop:70,marginBottom:10}),noCallsItemInfoText:()=>o.Styles.createTextStyle({textAlign:"center"}),noCallsItemButton:()=>o.Styles.createButtonStyle({flex:1,marginTop:20,minWidth:190,alignSelf:"center"}),noCallsImageV3:()=>o.Styles.createImageStyle({width:130,height:130,alignSelf:"center"})});class b extends y.default{constructor(){super(...arguments),this._syncLocalAddressStore=()=>{this.state.hideSyncAddressBookCta||h.default.navigateToSyncAddressBook({origin:l.DialogNavOrigin.NoCallsItem,hideSkipButton:!0},void 0,this._getRootViewId())}}static getDefaultHeight(){return 157}_buildState(e,t){const i=this._getRootViewId(),a={hideSyncAddressBookCta:!0,isLandscape:C.default.getDeviceOrientation(i)===n.DeviceOrientation.Landscape&&!this._getContext().isPresentedInDesktopSubview,isSmallDevice:C.default.isSmallDevice(i)};return t&&(a.hideSyncAddressBookCta||g.default.track(new p.DisplayedEmptyStateCta(p.EmptyStateOrigin.NoCalls))),a}render(){let e,t;const i=[f.noCallsItemContainer];return this.state.hideSyncAddressBookCta||(e=(0,a.jsx)(S.default,{style:f.noCallsItemButton,buttonSize:r.SXButtonSize.Medium,onPress:this._syncLocalAddressStore,title:u.getString("NoCallsItem.ConnectButton")})),this.state.isLandscape||(t=(0,a.jsx)(o.Image,{style:f.noCallsImageV3,resizeMode:"contain",source:s.Collection.ONBOARDING_CALLS_EMPTYSTATE_NOCALLS_V3})),(0,a.jsxs)(o.View,Object.assign({style:i},{children:[t,(0,a.jsx)(c.default,{headerText:this.props.title}),(0,a.jsx)(m.BodyText,Object.assign({style:f.noCallsItemInfoText,textThemeColor:m.TextThemeColor.Secondary},{children:this.props.infoLabel})),e]}))}}t.default=b},770170:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(809206),s=i(583367),r=i(516778),l=i(974634),c=i(281878),d=i(889391),u=i(345187),h=i(980734),p=i(67930),g=i(994224),C=i(568580),S=i(598925),m=i(37034),y=i(671830),f=i(752754),b=i(780128),_=i(711930),T=i(803056),v=i(898278),w=i(400984),I=i(539549),P=i(341444),M=i(224631),k=i(681011),A=i(746096),R=i(881722),x=i(866127),L=i(913944),V=i(766649),O=i(436237),B=i(915877),D=i(518460),E=i(941209),N=i(733754),F=i(178735),j=i(734537),U=i(104735),H=i(330124),z=i(948199),G=i(501452),W=i(328377),K=i(491570),$=i(882052),q=i(793003),Q=i(29130),X=i(914976),Z=i(451070),J=i(681115),Y=i(536150),ee=i(704101),te=i(170919),ie=i(694622),ae=i(210541),ne=i(532514),oe=i(29165),se=i(748367),re=i(724067),le=i(190631),ce=i(295384),de=i(858585),ue=i(919364),he=i(316392),pe=i(22222),ge=i(711828),Ce=i(680837),Se=i(172758),me=i(853374),ye=i(191066),fe=i(311010),be=i(115340),_e=i(539474),Te=i(474728),ve=i(109106),we=(i(256886),[K.QuickCallPanelFilter.All,K.QuickCallPanelFilter.Skype,K.QuickCallPanelFilter.Phone]),Ie=(0,B.lazyProperties)({mainContainer:()=>r.Styles.createViewStyle({alignSelf:"stretch",flex:1}),headerContainer:()=>r.Styles.createViewStyle({flexDirection:"column",alignItems:"stretch"}),innerHeaderContainer:()=>r.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),searchInputContainer:()=>r.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),noCallsContainer:()=>r.Styles.createViewStyle({flex:1,paddingLeft:12,paddingRight:12,paddingTop:20,paddingBottom:20}),searchBoxContainerCompositeNav:()=>r.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",justifyContent:"center",flexDirection:"row",height:te.SearchInputHeight.default,paddingLeft:15,paddingVertical:10,flex:1}),searchHeaderWrapper:()=>r.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0}),searchAccessoryButton:()=>r.Styles.createViewStyle({marginRight:5}),dialpadBarAccessibilityOffset:()=>r.Styles.createViewStyle({marginBottom:65})}),Pe={flexGrow:1,flexShrink:0},Me={zeroInput:[{groupType:A.SearchResultsListGroup.PstnDialpad},{groupType:A.SearchResultsListGroup.UpcomingCalls},{groupType:A.SearchResultsListGroup.RecentCalls},{groupType:A.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:A.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputWithDialpadAccessory:[{groupType:A.SearchResultsListGroup.UpcomingCalls},{groupType:A.SearchResultsListGroup.RecentCalls},{groupType:A.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:A.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputSearchOnly:[{groupType:A.SearchResultsListGroup.RecentCalls},{groupType:A.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:A.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputOneOnOneCall:[{groupType:A.SearchResultsListGroup.RecentCalls},{groupType:A.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:A.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputAddToOneOnOneCall:[{groupType:A.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:A.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputGroupCall:[{groupType:A.SearchResultsListGroup.GroupMember},{groupType:A.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:A.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputCallsOnly:[{groupType:A.SearchResultsListGroup.RecentCallsExtended}],shortQuery:[{groupType:A.SearchResultsListGroup.AllPeople},{groupType:A.SearchResultsListGroup.GroupChats}],longQuery:[{groupType:A.SearchResultsListGroup.AllPeople,isCollapsible:!0},{groupType:A.SearchResultsListGroup.GroupChats,isCollapsible:!0},{groupType:A.SearchResultsListGroup.PublicDirectory,isCollapsible:!0}]},ke="quickCallHeader",Ae="selectedProfilesList",Re="quickCallSearchResultList",xe="compositeNavsearchResultsListWrapper";class Le extends p.default{constructor(e){super(e),this._onKeyDownEvent=new l.default,this._searchActive=!1,this._shadowVisible=!1,this._headerExpanded=!0,this._selectedProfiles=[],this._headerAnimatedTopValue=new r.Animated.Value(0),this._headerAnimatedTopStyle=r.Styles.createAnimatedViewStyle({transform:[{translateY:this._headerAnimatedTopValue}]}),this._resetTransitionTransformValue=new r.Animated.Value(0),this._resetTransitionOpacityValue=new r.Animated.Value(1),this._resetTransitionStyle=r.Styles.createAnimatedViewStyle({opacity:this._resetTransitionOpacityValue,transform:[{translateY:this._resetTransitionTransformValue}]}),this._shadowOpacityValue=new r.Animated.Value(0),this._shadowOpacityStyle=r.Styles.createAnimatedViewStyle({opacity:this._shadowOpacityValue}),this._onResultsCountChange=e=>{this.state.modernizeIllustrations&&0===n.trim(this.state.rawSearchQuery).length&&Te.default.setCallsEmpty(e)},this._renderAddContacts=()=>(0,a.jsx)(r.View,Object.assign({style:Ie.noCallsContainer},{children:(0,a.jsx)(G.default,{infoLabel:N.getString("QuickCallPanel.NoCallsDescriptionDesktop"),title:N.getString("QuickCallPanel.NoCallsTitleDesktop")})}),"noCallsItem"),this._renderDialpadButtonMobile=()=>(0,a.jsx)(L.default,{size:ge.IconSize.size24,onPress:this._onPressDialer,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,icon:ge.SkypeIcon.Dialpad,title:N.getString("PeopleList.PstnDialpadLabel")}),this._handleMenuCommand=e=>{if(!this.isComponentMounted())return;const t=Le._filterForCommand(e);n.isUndefined(t)||(F.default.setUserPreferencesLocal({quickCallFilter:t}),this.setState({filter:t}))},this._getSearchButton=(e,t)=>{const i=N.getString(this.state.isMobile?"SearchInputControl.PlaceHolderTextShort":"SearchInputControl.PlaceHolderTextPeopleGroupsMessages"),n=e?J.default.horizontalPaddingStyle(e):void 0;let o=(0,a.jsx)(ee.default,{buttonOnly:!0,placeholderText:i,accessibilityLabel:this.state.isMobileScreenReaderEnabled?N.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,useIOSStyles:!this.state.isMobile&&this.state.shouldUseIOSSearchStyles,safeAreaPaddingStyle:n,showSearchIcon:this._getContext().isPresentedInGenericDesktopModal||this.state.isMobile,onPress:this._handleSearchButtonClick},"search");if(t){const t=this._constructContainerStyles(e);o=(0,a.jsx)(r.View,Object.assign({style:t},{children:o}))}return this.state.useMobileOrTabletUI?o:(0,a.jsx)(r.View,Object.assign({style:[Ie.searchBoxContainerCompositeNav,this._themeStyles.searchBoxColorStyle]},{children:o}))},this._handleSearchButtonClick=()=>{const e=me.default.newCauseId();O.log(A.LogTraceArea.QuickCallPanel,"_handleSearchButtonClick causeId: "+e),O.track(new ve.PressAction(ve.PressScenario.SearchNavigation,A.SearchPanelInitiator.QuickCallPanel)),U.default.navigateToSearchFromPanel(e,this._getContext(),this._isPresentedInTabletLeftNav(),A.SearchPanelInitiator.QuickCallPanel)},this._addSelectedUsersToCall=()=>{const e=me.default.newCauseId();O.log(A.LogTraceArea.QuickCallPanel,"_addSelectedUsersToCall causeId: "+e),this.state.selectedMris&&this._addUsersToCall(this.state.selectedMris.map((e=>{const t=this.state.mriToPhoneMriMap.get(e);return t||e})),e)},this._handleSearchResultsListAddUserToCall=(e,t)=>{const i=me.default.newCauseId();O.log(A.LogTraceArea.QuickCallPanel,"_handleAddUserToCall causeId: "+i),this._containerRef&&this._containerRef.requestFocus?this._searchResultsListActionHelper(t,e,i):O.error(A.LogTraceArea.QuickCallPanel,"_searchResultsListActionHelper anchor is not focusable:  has container ref: "+!!this._containerRef+", causeId: "+i)},this._handleSearchResultsListItemClick=(e,t,i)=>{const a=me.default.newCauseId();if(O.log(A.LogTraceArea.QuickCallPanel,"_handleListItemClick causeId: "+a),i===A.SearchResultsListGroup.PstnDialpad)this._onPressDialer();else{const i=()=>e.isComponentMounted()?e:void 0;this._searchResultsListActionHelper(i,t,a)}},this._onPressDialer=()=>{const e=me.default.newCauseId();O.log(A.LogTraceArea.QuickCallPanel,"_onToggleDialpad, causeId: "+e),this._onInputTextChange("");let t=A.DialerNavigationSource.QuickCallPanel;this.props.callId?t=this.props.newGroup?A.DialerNavigationSource.QuickCallPanelAddToCall:A.DialerNavigationSource.QuickCallPanelNewCall:this.state.isInGroupCallMode&&(t=this.props.newGroup?A.DialerNavigationSource.QuickCallPanelNewCall:A.DialerNavigationSource.QuickCallPanelAddToCall),U.default.navigateToPSTNDialerWithParams({callId:this.props.callId,conversationId:this.props.conversationId,causeId:e,navigationSource:t},this._getRootViewId())},this._removeProfileFromSelection=e=>{if(this.isComponentMounted()){const t=e.getMri(),i=t?this._removeEntryFromMriToPhoneMap(t):void 0,a=n.compact(n.without(this.state.selectedMris,i||t));this.setState({selectedMris:a}),this._searchResultsList?this._searchResultsList.focusFirst():this._groupCallModeHeaderButtonRef&&this._groupCallModeHeaderButtonRef.requestFocus()}},this._onSimplePanelHeaderRef=e=>{this._headerRef=e||void 0},this._onSearchResultsListRef=e=>{this._searchResultsList=e||void 0},this._onContainerRef=e=>{this._containerRef=e||void 0},this._onGroupCallModeHeaderButtonRef=e=>{this._groupCallModeHeaderButtonRef=e||void 0},this._onGroupCallBackHeaderButtonRef=e=>{this._groupCallBackHeaderButtonRef=e||void 0},this._onSearchActive=e=>{this._showOrHideHeader(this.state,!e,!0),e?this.setState({isSearchActive:e}):this.setState({isSearchActive:e,rawSearchQuery:""})},this._onPressClose=()=>{const e=me.default.newCauseId();O.log(A.LogTraceArea.QuickCallPanel,"_onPressClose causeId: "+e),this.setState({rawSearchQuery:""}),this._goBack(e)},this._onSearchInputKeyDown=e=>{this._onKeyDownEvent.fire(e.keyCode)},this._onContentWrapperRef=e=>{this._wrappedTransitionView=e||void 0},this._onSearchHeaderRef=e=>{this._searchHeader=e||void 0},this._updateScrollYValue=e=>{this.state.enableRefreshedPalette&&this.state.enableCollapsibleHeaderSearch&&!this._isPresentedInDesktopLeftNav()&&!this._isPresentedInTabletLeftNav()&&this.setState({vlvScrollY:e})},this._onScroll=(e,t)=>{var i,a;if(this._updateScrollYValue(e),null===(a=(i=this.props).onScroll)||void 0===a||a.call(i,e,t),this._shouldCollapseHeader()){let i=this._headerExpanded;if(e<b.default.collapsableHeight(this._getRootViewId()))i=!0;else{i=i&&t-e>0}this._expandOrCollapseHeader(i,!0)}},this._onExperimentalNavScroll=(e,t)=>{var i,a;this._updateScrollYValue(e),null===(a=(i=this.props).onScroll)||void 0===a||a.call(i,e,t);const n=e>0;this._shadowVisible!==n&&(r.Animated.timing(this._shadowOpacityValue,{toValue:n?.5:0,duration:100,easing:r.Animated.Easing.Out()}).start(),this._shadowVisible=n)},this._onExperimentalCallButtonPress=e=>{{const t=me.default.newCauseId();O.log(A.LogTraceArea.QuickCallPanel,"_handleGroupCallButtonClick_Floating_CTA_desktop causeId: "+t),this._enterGroupCallMode(e)}},this._enterGroupCallMode=e=>{e.stopPropagation(),this.setState({isInGroupCallMode:!0})},this._leaveGroupCallMode=e=>{e.stopPropagation(),this.setState({isInGroupCallMode:!1,selectedMris:[]})},this._startGroupCall=()=>{const e=me.default.newCauseId();if(O.log(A.LogTraceArea.QuickCallPanel,"_startGroupCall causeId: "+e),this.state.selectedMris&&1===this.state.selectedMris.length){const t=()=>this._groupCallModeHeaderButtonRef;this._startCallToMri(this.state.selectedMris[0],t,e,A.NavigationCallOrigin.QuickCallPanelNewCall)}else this.setState({isNewGroupCallStarting:!0}),this.state.selectedMris?g.default.CallNavigationHelper.startNewGroupCallAndConversation(this.state.selectedMris,!1,e,void 0,A.NavigationCallOrigin.StartNewGroupCallAndConv).always((()=>{this.isComponentMounted()&&this.setState({isNewGroupCallStarting:!1})})):O.error(A.LogTraceArea.QuickCallPanel,"_startGroupCall with no mris causeId: "+e)},this._onInputTextChange=e=>{this.isComponentMounted()&&this.setState({rawSearchQuery:e})},this._goBack=e=>(O.log(A.LogTraceArea.QuickCallPanel,"QuickCallPanel._goBack, causeId: "+e),this._isPresentedInTabletLeftNav()?(U.default.closeCallSearchPanel(e,this._getContext()),!0):super._goBack(e)),e.searchOnly&&(this._transitionSubscriptionToken=z.default.transitionInfoEvent().subscribe((e=>{if(e.inProgress&&this.isComponentMounted())if(z.default.isHubSearchTransition()){if(e.toRoute&&e.fromRoute&&e.progress){const t=e.toRoute.type===z.RouteType.Search?e.toRoute.index:e.fromRoute.index;n.isUndefined(t)?this._clearAnimatedValues():this._setAnimatedValues(e.progress,t)}}else this._clearAnimatedValues()})))}_buildState(e,t){let i=K.QuickCallPanelFilter.All;e.useExperimentalDesktopUtilityBar&&(i=F.default.getUserPreferencesLocal().quickCallFilter||K.QuickCallPanelFilter.All);const{enableRefreshedPalette:a,enableCollapsibleHeaderSearch:l}=d.default.getS4LUiFeatures(),c={filter:i,enableRefreshedPalette:a,enableCollapsibleHeaderSearch:l},u=d.default.getS4LMessagingFeatures().modernizeIllustrations;t&&(c.vlvScrollY=0,c.isSearchActive=!1,c.isInGroupCallMode=!1,c.isNewGroupCallStarting=!1,c.selectedMris=[],c.mriToPhoneMriMap=new Map,c.rawSearchQuery="",this._searchController=new ne.default,e.newGroup&&(c.isInGroupCallMode=!0),c.isMobile=o.default.isMobile(),this._headerAnimatedHeightValue=new r.Animated.Value(b.default.expandedHeight(this._getRootViewId())),this._headerAnimatedHeightStyle=r.Styles.createAnimatedViewStyle({height:this._headerAnimatedHeightValue}));const h=this._getContext(),p=this._getRootViewId(),S=H.default.isUsingStackNavigationContext(),m=!e.hideHeader&&(!h.isPresentedInDesktopSubview||this._isPresentedInTabletLeftNav());c.isSmallDevice=Q.default.isSmallDevice(p),c.statusBarPadding=m?Z.default.statusBarPadding():0,c.isPortrait=Q.default.getDeviceOrientation(p)===s.DeviceOrientation.Portrait,c.isSyncAddressBookEnabled=W.default.getSyncAddressBookPrivacySetting(),c.hasCallsAndContacts=(0,I.default)().hasJoinedConversationsWithCall()||w.default.getFilteredSortedAllPeopleProfiles("",{excludeBots:!0,excludeShortCircuitMatches:!c.isSyncAddressBookEnabled,excludeUnauthorized:!c.isSyncAddressBookEnabled,excludeBlocked:!0}).length>0,c.shouldUseIOSSearchStyles=b.default.shouldUseIOSSearchStyles(),c.useMobileOrTabletUI=S||!!this._isPresentedInTabletLeftNav(),c.disableHighBandwidthOperations=V.default.isUsingGogoNetwork();const y=e.callId,f=e.conversationId;if(y&&f){c.activeCallMemberMris=n.map(n.filter(g.default.CallingStore.getRemoteCallMembers(y),(e=>!!e&&(C.default.isParticipantConnected(e)||C.default.isParticipantStateRinging(e.state)))),(e=>g.default.CallingStore.getRemoteCallMemberMri(y,e)));const e=(0,I.default)().getConversation(f);e&&(c.conversationMemberMris=e.getMemberMris())}return c.isMobileScreenReaderEnabled=Y.default.isMobileScreenReaderEnabled(),c.rowSize=this._isPresentedInDesktopLeftNav()?$.default.nonRecentRowSizeAndChanges():void 0,c.modernizeConversationList=x.default.canModernizeConversationList(),c.modernizeIllustrations=u,c.emptyStateModernizedEmoticon=d.default.getS4LMessagingFeatures().emoticonForEmptyCallsTab,c.shouldShowEmptyStateIllustrationScreen=u&&Te.default.getCallsEmpty()&&!e.hideIllustration,c.showEmptyStateIllustrationScreenOnDemand=u&&Te.default.getCallsEmpty(!0),c}scrollToTop(){this._searchResultsList&&this._searchResultsList.scrollToTop()}componentDidMount(){super.componentDidMount(),this._showOrHideHeader(this.state,!this._searchActive,!1),this._onScroll(0,0),ce.default.showPromptIfNeeded(this.props.conversationId||v.MainRootViewId)}componentWillUnmount(){super.componentWillUnmount(),this._transitionSubscriptionToken&&(this._transitionSubscriptionToken.unsubscribe(),this._transitionSubscriptionToken=void 0),this._searchController&&this._searchController.destroy(),this._onScroll(0,0)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i);const a=e=>{const t=this.state.mriToPhoneMriMap.get(e);return t||e};this._selectedProfiles=n.map(t.selectedMris,(e=>Se.default.getDisplayableUserByMri(a(e)))),this.state.statusBarPadding===t.statusBarPadding&&this.state.isPortrait===t.isPortrait&&this.state.selectedMris===t.selectedMris||this._showOrHideHeader(t,!this._searchActive,!1)}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.isInGroupCallMode!==t.isInGroupCallMode&&(this._headerRef&&this._headerRef.requestFocus(),this._groupCallBackHeaderButtonRef&&this.state.isInGroupCallMode&&this._groupCallBackHeaderButtonRef.requestFocus())}render(){const e=this._shouldCollapseHeader(),t=n.trim(this.state.rawSearchQuery),i=0===t.length;let o;o=i?this.state.filter===K.QuickCallPanelFilter.Phone||this.state.filter===K.QuickCallPanelFilter.Skype?Me.zeroInputCallsOnly:e?Me.zeroInputSearchOnly:this.state.isInGroupCallMode?this.props.conversationId&&y.isGroupConversation(this.props.conversationId)?[{groupType:A.SearchResultsListGroup.ShareGroup},...Me.zeroInputGroupCall]:this.props.callId?Me.zeroInputAddToOneOnOneCall:Me.zeroInputOneOnOneCall:Me.zeroInputWithDialpadAccessory:t.length<d.default.getConfigSettingsNoSubscription().search.longQueryCharCount?Me.shortQuery:Me.longQuery,(this.state.isInGroupCallMode||this.props.callId)&&(o=o.filter((e=>e.groupType!==A.SearchResultsListGroup.GroupChats)));const s=this._shouldShowDialPadBar(o),l=this.props.useExperimentalDesktopUtilityBar?this._renderUtilityBar():void 0,u=l?this._renderShadow():void 0,h=this.state.shouldShowEmptyStateIllustrationScreen?this._renderModernizedEmptyState():void 0,p=[Ie.mainContainer,this._getBackgroundColorStyle()],g=[];if(this.state.enableRefreshedPalette&&(!this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav())&&this.props.hideHeader){const e=N.getString(this.state.isMobile?"SearchInputControl.PlaceHolderTextShort":"SearchInputControl.PlaceHolderTextPeopleGroupsMessages");g.push((0,a.jsx)(_e.CollapsibleHeaderSearch,{onPress:this._handleSearchButtonClick,placeholder:e,value:this.state.vlvScrollY,valueFrom:0,valueTo:50},"search"))}if(this.state.showEmptyStateIllustrationScreenOnDemand)return g.push(this._renderModernizedEmptyState()),g;if(this.state.hasCallsAndContacts||this.state.isSyncAddressBookEnabled){this.state.isInGroupCallMode&&!n.isEmpty(this._selectedProfiles)&&g.push((0,a.jsx)(oe.default,{selectedProfiles:this._selectedProfiles,onProfileRemoved:this._removeProfileFromSelection},Ae));const t=this.props.callId||this.state.isInGroupCallMode?ae.FilterType.GroupCallCapable:ae.FilterType.CallCapable;let l=0;if(e&&(l=b.default.collapsableHeight(this._getRootViewId())),this.state.enableRefreshedPalette){const e=0;l=this.props.topInset||e}const d=!this.state.isInGroupCallMode&&(!this.props.callId&&i),p=Math.max(this.props.bottomPadding||0,s&&!this.state.isMobileScreenReaderEnabled?65:0),C=e||this.props.onScroll?this._onScroll:u?this._onExperimentalNavScroll:this._updateScrollYValue,S=this._getContext().isPresentedInGenericDesktopModal?A.SearchResultsListOrigin.QuickCallPanelModal:A.SearchResultsListOrigin.QuickCallPanel,m=(0,a.jsx)(ie.SearchResultsList,{rawSearchQuery:this.state.rawSearchQuery,origin:S,ref:this._onSearchResultsListRef,userMrisToExclude:this.state.activeCallMemberMris,searchResultGroups:o,searchController:this._searchController,isSearchActive:this.state.isSearchActive,hasCallIcons:d,hasAddToCallIcon:!!this.props.callId&&!this.props.newGroup,filterPeopleType:t,arePeopleSelectableForInvite:this.state.isInGroupCallMode,maxNumberOfSuggestedContacts:20,onListItemClick:this._handleSearchResultsListItemClick,onAddUserToCall:this.props.callId?this._handleSearchResultsListAddUserToCall:void 0,selectedMris:this.state.isInGroupCallMode?this.state.selectedMris:void 0,showInviteButton:!1,showButtonsOnHover:this.props.useExperimentalDesktopUtilityBar,disableItemOnLongPress:!0,excludeGroups:this.state.isInGroupCallMode,excludeEncrypted:this.state.isInGroupCallMode,onlyPstn:this.state.filter===K.QuickCallPanelFilter.Phone,excludePstn:this.state.filter===K.QuickCallPanelFilter.Skype,keyDownEvent:this._onKeyDownEvent,headerViewConfig:this.state.enableRefreshedPalette?void 0:this._getSearchButtonConfig(),topInset:l,bottomPadding:p,onScroll:C,onResultsCountChange:this._onResultsCountChange,accessibilityLabel:N.getString("QuickCallPanel.CallsList"),suppressPseudoFocus:!0,conversationId:this.props.conversationId,hideEmptyState:this.props.newGroup,hideIllustration:this.props.hideIllustration,rowSize:this.state.rowSize,excludeRecentCallFromSuggestedList:!0,isMobileTab:!!this.props.isMobileTab,emptyStateDisplayed:this.state.shouldShowEmptyStateIllustrationScreen},Re);this.state.useMobileOrTabletUI?h?g.push((0,a.jsxs)(c.ScrollView,Object.assign({contentContainerStyle:Pe},{children:[m,h]}),"scrollViewForOptionalEmptyStateScreen")):g.push(m):g.push((0,a.jsxs)(r.View,Object.assign({style:Ce.default.flexOne},{children:[h?(0,a.jsxs)(c.ScrollView,Object.assign({contentContainerStyle:Pe},{children:[m,h]})):m,u]}),xe))}else this._isPresentedInDesktopLeftNav()||this.state.modernizeIllustrations||g.push((0,a.jsx)(ue.default,{location:R.ExperimentLocation.CallsPanel},"skypeToPhoneCardExperiment")),h?g.push((0,a.jsx)(c.ScrollView,Object.assign({marginTop:(this.state.useMobileOrTabletUI,0),contentContainerStyle:Pe},{children:h}),"scrollViewForOptionalEmptyStateScreen")):g.push(this._renderAddContacts());const C=[Ce.default.flexOne];let S;this.state.useMobileOrTabletUI?(this.props.searchOnly&&C.push(r.Styles.createViewStyle({marginTop:b.default.collapsedHeight(this._getRootViewId())+this.state.statusBarPadding},!1)),s&&this.state.isMobileScreenReaderEnabled&&C.push(Ie.dialpadBarAccessibilityOffset),S=(0,a.jsx)(r.View,Object.assign({style:C},{children:g}),"content")):S=g;const m=e?this._renderSearchHeader():this._renderHeaderContainer(),f=s?(0,a.jsx)(k.default,{location:R.ExperimentLocation.CallsPanel,onPress:this._onPressDialer,onCallButtonPress:this._onExperimentalCallButtonPress},"DialpadBarExperiment"):void 0,_=this._getFooterButton(),v=this.state.shouldShowEmptyStateIllustrationScreen?[l,S]:[m,l,S,f];let w=(0,a.jsxs)(r.View,Object.assign({ref:this._onContainerRef,style:p},{children:[e?n.reverse(v):v,this._renderEntitlementsBanner(),_?this._getPanelFooter(_):void 0]}));return this.props.searchOnly&&(w=(0,a.jsx)(ye.default,Object.assign({ref:this._onContentWrapperRef,style:Ie.mainContainer},{children:w}))),(0,a.jsx)(T.default,Object.assign({goBack:this._goBack},{children:(0,a.jsx)(be.KeyboardAvoidingView,{children:w})}))}_getPanelFooter(e){const t=(0,a.jsx)(re.default,{button:e});return this.state.modernizeConversationList?(0,a.jsx)(r.View,Object.assign({style:j.default.getBannerBackgroundColorStyle(this._useDarkTheme(),this._useAccessibleTheme(),this._themeStyles)},{children:t})):t}_getBackgroundColorStyle(){if(this.state.enableRefreshedPalette||this.state.modernizeConversationList&&(this._isPresentedInDesktopLeftNav()||this._isPresentedInTabletLeftNav())){const e=[j.default.getBackgroundColorStyle(this._useDarkTheme(),this._useAccessibleTheme(),this._themeStyles)];return this.state.enableRefreshedPalette&&e.push(r.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary})),e}return this._isPresentedInDesktopLeftNav()?this._themeStyles.secondaryBackgroundColorStyle:this._themeStyles.primaryBackgroundColorStyle}_renderShadow(){return(0,a.jsx)(M.default,{opacityStyle:this._shadowOpacityStyle})}_renderUtilityBar(){const e=Le._menuItemTitle(this.state.filter),t=_.default.combinedAccessibilityLabel(N.getString("QuickCallPanel.ViewByMenu"),e);return(0,a.jsx)(se.default,{getMenuSections:this._getMenuSections(),currentMenuText:e,accessibilityText:t,onHandleMenuCommand:this._handleMenuCommand,newActionPickerContext:this.props.newActionPickerContext},"utilitybar")}_renderModernizedEmptyState(){return(0,a.jsx)(u.default,{emoticon:this.state.emptyStateModernizedEmoticon,topSlot:(0,a.jsx)(h.default,{headerText:N.getString("QuickCallPanel.NoCallsTitleModernized"),bodyText:N.getString("QuickCallPanel.NoCallsInfoModernized"),useThemeHeaderColor:!0})},"noCallsItem")}_renderSearchHeader(){if(this.state.useMobileOrTabletUI)return(0,a.jsx)(r.View,Object.assign({style:Ie.searchHeaderWrapper,ignorePointerEvents:!0},{children:(0,a.jsx)(f.default,{ref:this._onSearchHeaderRef,initialValue:1,autoFocus:!0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,cancelSearch:this._onPressClose})}),ke)}_renderHeaderContainer(){if(this.props.hideHeader)return;let e;if(this.state.useMobileOrTabletUI){let t;this.state.hasCallsAndContacts&&(t=(0,a.jsx)(r.View,Object.assign({style:Ie.searchInputContainer},{children:(0,a.jsx)(f.default,{initialValue:1,showButtonWhenInactive:!0,placeholderText:this.state.isMobile?N.getString("SearchInputControl.PlaceHolderTextShort"):N.getString("SearchInputControl.PlaceHolderTextPeopleGroupsMessages"),buttonAccessibilityLabel:this.state.isMobileScreenReaderEnabled?N.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,onActive:this._onSearchActive,actionButton:this.state.isInGroupCallMode?this._groupCallModeHeaderButton():void 0,buttonAccessoryView:this._renderDialpadButtonMobile(),hideButtonAccessoryViewBorder:!0})})));const i=this._getHeaderText(this.state),n=i?void 0:(0,a.jsx)(r.View,{style:Ce.default.flexOne});e=(0,a.jsx)(r.Animated.View,Object.assign({style:[Ie.headerContainer,this._headerAnimatedHeightStyle]},{children:(0,a.jsxs)(r.Animated.View,Object.assign({style:o.default.isMobile()?void 0:this._headerAnimatedTopStyle},{children:[(0,a.jsx)(le.SimplePanelHeader,{ref:this._onSimplePanelHeaderRef,panelName:i,leftButton:this._getHeaderCloseButton(),titleView:n,hideBottomBorder:!0,delayHeaderFocus:!1,shouldAnnouncePanelNameOnMount:!!this.props.callId&&!1}),t]}))}),ke)}else{let t;if(this.state.hasCallsAndContacts){const e=(0,a.jsx)(pe.default,{style:Ie.searchAccessoryButton,buttonStyle:v.SXButtonStyle.LightFill,buttonSize:v.SXButtonSize.Small,title:N.getString("QuickCallPanel.DialpadButtonLabel"),allowTextWrap:!1,icon:ge.SkypeIcon.Dialpad,showShadow:!0,onPress:this._onPressDialer});t=(0,a.jsx)(r.View,Object.assign({style:Ie.searchInputContainer},{children:(0,a.jsx)(P.default,{placeholderText:N.getString("SearchInputControl.PlaceHolderTextPeopleGroupsMessages"),accessoryView:e,showButtonWhenInactive:!0,autoFocus:!r.UserInterface.isNavigatingWithKeyboard(),autoFocusWhenActive:!0,buttonAccessibilityLabel:this.state.isMobileScreenReaderEnabled?N.getString("HubHeaderPanel.SearchHubAccessibilityLabel"):void 0,rawSearchQuery:this.state.rawSearchQuery||"",onInputTextChange:this._onInputTextChange,onActive:this._onSearchActive,onKeyDown:this._onSearchInputKeyDown})}))}e=(0,a.jsxs)(r.View,Object.assign({style:Ie.headerContainer},{children:[this._renderCompositeNavHeader(),(0,a.jsx)(r.View,Object.assign({style:[Ie.innerHeaderContainer,this._themeStyles.searchBoxColorStyle]},{children:t}))]}),ke)}return e}_renderEntitlementsBanner(){if(this._isPresentedInDesktopLeftNav())return(0,a.jsx)(de.default,{location:R.ExperimentLocation.CallsPanelBanner,useCompactLayout:this.state.rowSize===q.RowSize.ExtraCompact,onClose:()=>{this._searchResultsList&&this._searchResultsList.focusFirst()}})}_renderCompositeNavHeader(){return(0,a.jsx)(le.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:this._getHeaderCloseButton(),hideBottomBorder:!0,delayHeaderFocus:!1})}_getMenuSections(){return[{key:"calls",menuItems:n.map(we,(e=>({text:Le._menuItemTitle(e),command:Le._menuItemCommand(e),selected:e===this.state.filter,isCheckbox:!0})))}]}_getSearchButtonConfig(){if(!this.props.hideHeader||this.props.hideSearchBar)return;const e=this.state.isMobile?te.SearchInputHeight.modernizedSmall:this.state.shouldUseIOSSearchStyles?te.SearchInputHeight.iOS:this.state.isSmallDevice?te.SearchInputHeight.small:te.SearchInputHeight.default;return{renderItem:this._getSearchButton,height:e}}_constructContainerStyles(e){const t=[];return e&&t.push(r.Styles.createViewStyle({marginLeft:-1*e.left,marginRight:-1*e.right},!1)),this.state.enableRefreshedPalette&&t.push(r.Styles.createViewStyle({paddingBottom:8,backgroundColor:this._getContext().themeColors.surfaceAccent},!1)),t}_getHeaderCloseButton(){return this.state.isInGroupCallMode&&!this.props.newGroup?{text:N.getString("Global.CancelLabel"),onPress:this._leaveGroupCallMode,title:N.getString("Global.CancelLabel"),closeButtonType:le.CloseButtonType.Back}:{title:this.props.callId||!this.state.useMobileOrTabletUI&&!this.props.isAloneInNavStack?N.getString("Global.BackButtonTitle"):N.getString("QuickCallPanel.CloseButtonAccessibilityLabel"),onPress:this._onPressClose,setButtonRef:this._onGroupCallBackHeaderButtonRef,closeButtonType:(this.state.useMobileOrTabletUI||this.props.isAloneInNavStack)&&this.props.navigationDirection!==he.StackNavigationDirection.Push?le.CloseButtonType.Close:le.CloseButtonType.Back}}_groupCallModeHeaderButton(){const e=!this.state.selectedMris||0===this.state.selectedMris.length;return{text:this.props.callId?N.getString("QuickCallPanel.AddToCallText"):N.getString("QuickCallPanel.StartCallText"),onPress:this.props.callId?this._addSelectedUsersToCall:this._startGroupCall,disabled:e,showActivityIndicator:this.state.isNewGroupCallStarting,setButtonRef:this._onGroupCallModeHeaderButtonRef}}_getFooterButton(){return this.state.isInGroupCallMode?this._groupCallModeHeaderButton():this.state.modernizeIllustrations?void 0:this._getFooterButtonForDesktop()}_getFooterButtonForDesktop(){const e=this.props.callId?N.getString("QuickCallPanel.AddMultiplePeople"):N.getString("QuickCallPanel.CallMultiplePeople");return{icon:this.props.callId?ge.SkypeIcon.ContactGroupAdd:ge.SkypeIcon.ContactGroupCall,text:e,backgroundStyle:{borderRadius:32,paddingLeft:14,paddingRight:14},iconSize:ge.IconSize.size24,iconHorizontalMargin:4,buttonStyle:v.SXButtonStyle.GradientFill,textStyleOverride:[fe.default.font.uiDisplayRegular],disabled:this.state.disableHighBandwidthOperations,onPress:this._enterGroupCallMode}}_getHeaderText(e){let t=N.getString("QuickCallPanel.PanelHeaderDefault");return this.props.callId?t=N.getString(this.props.newGroup?"QuickCallPanel.PanelHeaderAddToCall":"QuickCallPanel.PanelHeaderNewCall"):e.isInGroupCallMode&&(t=N.getString(this.props.newGroup?"QuickCallPanel.PanelHeaderNewCall":"QuickCallPanel.SelectParticipantsHeader")),t}_addUsersToCall(e,t){if(O.log(A.LogTraceArea.QuickCallPanel,"_addUsersToCall causeId: "+t),!this.props.callId)return;g.default.CallParticipantUtils.addUsersToCallOrRing(e,this.props.callId,this.props.conversationId,this.state.conversationMemberMris,this.props.addToCallTelemetryOrigin||A.NavigationAddToCallOrigin.Unknown);const i=N.getString("QuickCallPanel.AddToCallAnnouncement",{count:e.length});r.Accessibility.announceForAccessibility(i),this.state.useMobileOrTabletUI?this._onPressClose():this._goBack(t)}_searchResultsListActionHelper(e,t,i){if(this.state.isInGroupCallMode){if(!d.default.getS4LCMCFeatures().enableUIToSelectSkypeOrPSTNContactToAddToGroupCall)return void this._addOrRemoveUserSelection(t,i);const a=e=>{this._addOrRemoveUserSelection(e,i)},o=(e,t)=>{this.state.mriToPhoneMriMap.set(t,e),a(t)},s=Se.default.getDisplayableUserByMri(t),r=y.isPhoneMri(t)?[]:E.mergeMriProfileAndExtraPhones(t,void 0,s?s.phoneNumbers:void 0),l=n.includes(this.state.selectedMris,t);return void(n.isEmpty(r)||l?(l&&this._removeEntryFromMriToPhoneMap(t),this._addOrRemoveUserSelection(t,i)):m.default.showForSkypeMri(e,this._getRootViewId(),t,void 0,!0,A.ContactInviteOrigin.Unknown,A.NavigationCallOrigin.Unknown,a,o,void 0,r))}if(this.props.callId)return void this._addUserToExistingCall(t,i);if(!t)return void O.error(A.LogTraceArea.QuickCallPanel,"_searchResultsListActionHelper with unactionable listItemMri: "+X.mriOrId(t)+", causeId: "+i);if(!y.isMri(t)&&E.isLocalAddressBookContact(t))return void this._handleAddressBookContactClick(e,t);const a=()=>{U.default.navigateToConversation({convId:t,causeId:i,origin:A.NavigationConversationOrigin.Search})};n.trim(this.state.rawSearchQuery).length||this._isPresentedInDesktopLeftNav()&&t?a():this._startCallToMri(t,e,i,A.NavigationCallOrigin.CallsTabQuickCallPanel)}_startCallToMri(e,t,i,a){if(O.log(A.LogTraceArea.QuickCallPanel,"_startCallToMri causeId: "+i),this.props.callId)return void O.log(A.LogTraceArea.QuickCallPanel,"_startCallToMri, callId must not be defined, causeId: "+i);if(!e||!y.isMri(e)||!g.default.CallNavigationHelper.isOutgoingCallingAllowed(e))return void O.log(A.LogTraceArea.QuickCallPanel,"_startCallToMri, calling not allowed, causeId: "+i);const n=D.default.getContactByCorrespondingMri(e);m.default.startCallOrMaybePrompt(t,this._getRootViewId(),{skypeMri:e,phones:n?n.phones:void 0,inviteOrigin:A.ContactInviteOrigin.CallPanelSearch,callOrigin:a,userIntent:S.StartCallOrMaybePromptUserIntent.Generic},i)}_handleAddressBookContactClick(e,t){const i=D.default.getContactById(t);i&&i.phones&&m.default.showForAddressContact(e,this._getRootViewId(),i.getDisplayName(),A.ContactInviteOrigin.CallPanelSearch,A.NavigationCallOrigin.QuickCallPanelCall,i.phones,i.emails)}_addUserToExistingCall(e,t){if(O.log(A.LogTraceArea.QuickCallPanel,"_addUserToExistingCall causeId: "+t),!this.props.callId)return;if(!this.state.conversationMemberMris||0===this.state.conversationMemberMris.length)return;const i=y.sanitizeMri(e,y.Namespaces.SkypeId);g.default.CallParticipantUtils.addUsersToCallOrRing([i],this.props.callId,this.props.conversationId,this.state.conversationMemberMris,this.props.addToCallTelemetryOrigin||A.NavigationAddToCallOrigin.Unknown),this._onPressClose()}_removeEntryFromMriToPhoneMap(e){const t=y.isPhoneMri(e)?Se.default.getConversationOwnerNoSubscription(e):e;return t&&this.state.mriToPhoneMriMap.delete(t),t}_addOrRemoveUserSelection(e,t){O.log(A.LogTraceArea.QuickCallPanel,"_addOrRemoveUserSelection causeId: "+t);const i=n.without(this.state.selectedMris,e);i.length===(this.state.selectedMris?this.state.selectedMris.length:0)&&i.push(e),this.setState({selectedMris:i})}_shouldCollapseHeader(){return this.state.useMobileOrTabletUI&&this.props.searchOnly}_expandOrCollapseHeader(e,t=!0){this._headerExpanded!==e&&(this._searchHeader&&this._searchHeader.setExpandedValue(e?1:0,t),this._headerExpanded=e)}_showOrHideHeader(e,t,i=!0){this._searchActive=!t;const a=this._getRootViewId(),n=this._headerHeight(e),o=t?0:-1*n,s=t?n+b.default.collapsableHeight(a):b.default.expandedHeight(a)+e.statusBarPadding;i?r.Animated.parallel([r.Animated.timing(this._headerAnimatedTopValue,{toValue:o,duration:200,easing:r.Animated.Easing.Out()}),r.Animated.timing(this._headerAnimatedHeightValue,{toValue:s,duration:200,easing:r.Animated.Easing.Out()})]).start():(this._headerAnimatedTopValue.setValue(o),this._headerAnimatedHeightValue.setValue(s))}_headerHeight(e){return(e.isPortrait?e.isSmallDevice?le.HeaderHeightSmall:le.HeaderHeight:e.isSmallDevice?le.HeaderHeightLandscapeSmall:le.HeaderHeightLandscape)+e.statusBarPadding}_setAnimatedValues(e,t){if(this._wrappedTransitionView){const i=r.Styles.createAnimatedViewStyle({transform:[{translateY:e.interpolate({inputRange:[t-1,t,t+1],outputRange:[90,0,0]})}]});this._wrappedTransitionView.setAnimatedStyle(i)}}_clearAnimatedValues(){this._wrappedTransitionView&&this._wrappedTransitionView.setAnimatedStyle(this._resetTransitionStyle)}_shouldShowDialPadBar(e){return n.some(e,(e=>e.groupType===A.SearchResultsListGroup.PstnDialpad))&&!this._isPresentedInDesktopLeftNav()&&!0}_isUsedDuringCall(){return!!this.props.callId}static _menuItemTitle(e){switch(e){case K.QuickCallPanelFilter.All:return N.getString("QuickCallPanel.AllFilter");case K.QuickCallPanelFilter.Skype:return N.getString("QuickCallPanel.SkypeFilter");case K.QuickCallPanelFilter.Phone:return N.getString("QuickCallPanel.PhoneFilter")}return""}static _menuItemCommand(e){switch(e){case K.QuickCallPanelFilter.All:return K.QuickCallPanelMenuItemCommand.all;case K.QuickCallPanelFilter.Skype:return K.QuickCallPanelMenuItemCommand.skype;case K.QuickCallPanelFilter.Phone:return K.QuickCallPanelMenuItemCommand.phone}return""}static _filterForCommand(e){switch(e){case K.QuickCallPanelMenuItemCommand.all:return K.QuickCallPanelFilter.All;case K.QuickCallPanelMenuItemCommand.skype:return K.QuickCallPanelFilter.Skype;case K.QuickCallPanelMenuItemCommand.phone:return K.QuickCallPanelFilter.Phone}}}t.default=Le},390244:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RaiseHandImageType=void 0;const a=i(785893),n=i(516778),o=i(217041),s=i(244770),r=i(915877);var l;!function(e){e[e.MediumSizeCenterAligned=0]="MediumSizeCenterAligned",e[e.SmallSizeTopLeftAligned=1]="SmallSizeTopLeftAligned"}(l=t.RaiseHandImageType||(t.RaiseHandImageType={}));const c=(0,r.lazyProperties)({raiseHandIcon20:()=>n.Styles.createImageStyle({height:20,width:20,position:"absolute",top:2,left:0}),raiseHandIcon32:()=>n.Styles.createImageStyle({height:30,width:32,alignSelf:"center",marginBottom:8})});class d extends o.ComponentBase{render(){const e=this._getStyle(),t=this._getSource();return(0,a.jsx)(n.Image,{style:e,resizeMode:"contain",source:t})}_getStyle(){switch(this.props.type){case l.MediumSizeCenterAligned:return c.raiseHandIcon32;case l.SmallSizeTopLeftAligned:return c.raiseHandIcon20}}_getSource(){switch(this.props.type){case l.MediumSizeCenterAligned:return s.Collection.RAISE_HAND_MEDIUM;case l.SmallSizeTopLeftAligned:return s.Collection.RAISE_HAND_SMALL}}}t.default=d},502557:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(217041),r=i(889391),l=i(994224),c=i(568580),d=i(278968),u=i(480200),h=i(471727),p=i(671830),g=i(952262),C=i(746096),S=i(623497),m=i(805581),y=i(436237),f=i(915877),b=i(18078),_=i(109440),T=i(33004),v=i(914976),w=i(478262),I=i(680837),P=i(912770),M=(0,f.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,overflow:"visible"}),fullScreenView:()=>I.default.absoluteFill,eventsContainer:()=>o.Styles.createViewStyle({paddingBottom:20,overflow:"visible"}),mobileEventsContainerWithCallControls:()=>o.Styles.createViewStyle({paddingBottom:75}),streamContainer:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch",overflow:"visible"})});class k extends s.ComponentBase{constructor(){super(...arguments),this._subscriptions=[],this._onSelectSceneResponseFailedEvent=e=>{if(this._eventStream){const t=this._getAudienceBotMri(this.props.callId);n.isUndefined(t)||this._eventStream.participantEvent(t,e)}},this._onSceneChangedEvent=(e,t)=>{this._eventStream&&this._eventStream.participantEvent(t,u.ParticipantEventType.TogetherModeBackgroundChanged)},this._onEventStreamRef=e=>{this._eventStream=e||void 0},this._onPhotoEventStreamRef=e=>{this._photoEventStream=e||void 0}}_buildState(e,t){t&&(this._subscriptions.push(l.default.AudienceBotService.selectSceneResponseFailedEvent(e.callId).subscribe(this._onSelectSceneResponseFailedEvent)),this._subscriptions.push(l.default.AudienceBotService.sceneChangedEvent(e.callId).subscribe(this._onSceneChangedEvent)));const{enableNotifyUsersMuteKick:i}=r.default.getS4LCMCFeatures(),a=[],o=[],s=m.default.getNonVisibleInCallBotMris(),c=m.default.getNonInteractiveInCallBotMris(),u=[];n.each(l.default.CallingStore.getRemoteCallMembers(e.callId),(t=>{const i=l.default.CallingStore.getRemoteCallMemberMri(e.callId,t);h.default.shouldRenderConnectedParticipantInEventStream(t,i,c)?a.push(i):h.default.shouldRenderRingingParticipantInEventStream(t,i,s)&&o.push(i)})),l.default.CallingStore.getParticipantsWithRaisedHands(e.callId).map((e=>{const t=n.concat(a,[b.default.getSkypeMri()]);n.find(t,(t=>t===e.id))&&u.push(e.id)}));const p=d.default.hasPostedReactions(e.reactionsConversationMri);let g;if(!t&&this._reactionsInteropMessageAllowed()&&p&&!this.state.hasPostedReactions){const t=l.default.CallingStore.getRemoteMembersNotSupportingCallingReactions(e.callId);t&&(g=h.default.getFeatureUnsupportedParticipantsInfo(e.callId,t,e.conversationMri))}const C=t?Date.now():this.state.callEntryTime,S=n.last(d.default.getPictureReactions(e.reactionsConversationMri,C)),y=this._photoInfoForMessage(S,e.conversationMri),f=d.default.getEventsReaction(e.reactionsConversationMri,C),_={callParticipantMris:a,ringingParticipantMris:o,reactionsMessageInfo:g,hasPostedReactions:p,lastPhotoInfo:y,eventReactions:f,enableNotifyUsersMuteKick:i,handRaisedMris:u};return t&&(_.suppressParticipantEvents=!0,_.callEntryTime=C),_}componentWillUnmount(){super.componentWillUnmount(),this._subscriptions.forEach((e=>e.unsubscribe())),this._subscriptions=[]}_getAudienceBotMri(e){const t=m.default.getCallAudienceBotMri(),i=m.default.getCallAudienceBotMriFilter();return l.default.InCallBotService.findActualBotMri(e,t,i)}_reactionsInteropMessageAllowed(){return p.isThread(this.props.conversationMri)||p.isSkypeIdMri(this.props.conversationMri)}_photoInfoForMessage(e,t){return e?{message:e,user:g.default.getMemberShortNameForConversation(t,e.creator)}:void 0}_identifyParticipantChange(e,t){if(this.state.suppressParticipantEvents||p.isOneOnOneConversation(this.props.conversationMri))return;const i=n.difference(e,t),a=n.difference(t,e);a.length&&this._onJoin(a),i.length&&this._onLeave(i)}_identifyParticipantRaiseHandChange(e,t){const i=n.difference(t,e);i.length&&this._onRaised(i)}_identifyParticipantRingingChange(e,t){if(this.state.suppressParticipantEvents)return;const i=n.difference(e,t);(n.difference(t,e).length||i.length)&&this._onParticipantsRinging(t),i.length&&this._onStopRinging(i)}_onJoin(e){n.each(e,((e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,u.ParticipantEventType.Join)}))}_onRaised(e){n.each(e,((e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,u.ParticipantEventType.HandRaised)}))}_onLeave(e){n.each(e,((e,t)=>{this._eventStream&&this._eventStream.participantEvent(e,u.ParticipantEventType.Leave)}))}_onMuted(e){this._eventStream&&this._eventStream.participantActionEvent(e.mri,e.actionMri,u.ParticipantEventType.Muted)}_onKickedOut(e){this._eventStream&&this._eventStream.participantActionEvent(e.mri,e.actionMri,u.ParticipantEventType.KickedOut)}_onStopRinging(e){n.each(e,((t,i)=>{if(this._eventStream){const i=l.default.CallingStore.findRemoteCallMember(this.props.callId,t);c.default.isParticipantConnected(i)||c.default.isParticipantInCanStreamMediaState(i)||this._eventStream.participantEvent(t,this._getStopRingingEventType(e))}}))}_getStopRingingEventType(e){return e.length&&n.intersection(l.default.InCallBotMriUtils.getCallFullscreenBotMris(),e).length?u.ParticipantEventType.BotUnavailable:u.ParticipantEventType.Unavailable}_onParticipantsRinging(e){this._eventStream&&this._eventStream.participantsRingingEvent(e)}componentDidMount(){super.componentDidMount(),p.isOneOnOneConversation(this.props.conversationMri)?P.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({suppressParticipantEvents:!1})}),3e3):P.default.setTimeout((()=>{this.isComponentMounted()&&this.setState({suppressParticipantEvents:!1})}),1e4)}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this._identifyParticipantRingingChange(t.ringingParticipantMris,this.state.ringingParticipantMris),this._identifyParticipantChange(t.callParticipantMris,this.state.callParticipantMris),this._identifyParticipantRaiseHandChange(t.handRaisedMris,this.state.handRaisedMris),this.state.reactionsMessageInfo&&!t.reactionsMessageInfo){const e=this.state.reactionsMessageInfo.count;if(0===e)return;y.log(C.LogTraceArea.CallReactions,"ReactionsPanel.componentDidUpdate: reactionsMessageInfo,  count: "+e+" firstUser: "+(v.mriOrId(this.state.reactionsMessageInfo.firstUser)||"none")+" secondUser: "+(v.mriOrId(this.state.reactionsMessageInfo.secondUser)||"none"));const t=h.default.getFeatureUnsupportedMessage(this.state.reactionsMessageInfo,h.UnsupportedFeature.CallReactions);t&&this._eventStream&&this._eventStream.textEvent(t)}if(this._photoEventStream&&this.state.lastPhotoInfo){this.state.lastPhotoInfo.message.cuid!==(t.lastPhotoInfo?t.lastPhotoInfo.message.cuid:void 0)&&this._photoEventStream.photoEvent(this.state.lastPhotoInfo.message,this.state.lastPhotoInfo.message.creator)}if(this.state.enableNotifyUsersMuteKick&&this.state.eventReactions){const e=n.last(this.state.eventReactions),i=n.last(t.eventReactions);(e?e.cuid:void 0)!==(i?i.cuid:void 0)&&this.state.eventReactions.forEach((e=>{const t=T.default.parseCallEventReaction(e);t&&(t.eventType===w.ReactionsTextType.CallEventMuted?this._onMuted(t):t.eventType===w.ReactionsTextType.CallEventKickedOut&&this._onKickedOut(t))}))}}render(){const e=[M.fullScreenView,M.eventsContainer,this.props.bottomStyle];return this.props.areMobileCallControlsVisible&&e.push(M.mobileEventsContainerWithCallControls),this.props.style&&e.push(this.props.style),(0,a.jsxs)(o.View,Object.assign({style:M.container,ignorePointerEvents:!0},{children:[(0,a.jsx)(o.Animated.View,Object.assign({style:e,ignorePointerEvents:!0,blockPointerEvents:!0},{children:(0,a.jsx)(S.default,{style:M.streamContainer,ref:this._onEventStreamRef})})),(0,a.jsx)(_.default,{style:M.fullScreenView,ref:this._onPhotoEventStreamRef,isDesktop:this.props.isDesktop,bottomMargin:this.props.desktopBottomMargin,desktopSideMargin:this.props.desktopSideMargin,sizePhotosToFit:this.props.sizePhotosToFit,photoTapDelay:this.props.photoTapDelay,onPhotoTap:this.props.onPhotoTap,onPhotoDismissed:this.props.onPhotoDismissed,reactionsConversationMri:this.props.reactionsConversationMri})]}))}}t.default=k},885376:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(733754),n=i(753602),o=i(581760),s=i(711828);class r extends n.default{_iconSize(){return s.IconSize.size20}_iconBackgroundColor(){return o.Color.gray300Overlay80}_icon(){return s.SkypeIcon.ContactAdd}_label(){}_tooltip(){return a.getString("CallBanner.AddPeopleToTheCallTooltip")}}t.default=r},753602:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RibbonExtraViewBase=void 0;const a=i(785893),n=i(516778),o=i(297775),s=i(911009),r=i(136400),l=i(110117),c=i(915877),d=i(581760),u=i(711828),h=i(619675),p=i(24576),g=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({justifyContent:"center",alignItems:"center"}),innerContainer:()=>n.Styles.createViewStyle({justifyContent:"center",alignItems:"center",overflow:"hidden",flexDirection:"row"}),label:()=>n.Styles.createTextStyle({color:d.Color.whiteOverlay80,backgroundColor:d.Color.transparent,textAlign:"center",textAlignVertical:"center",marginHorizontal:5,paddingBottom:1}),chevronIcon:()=>n.Styles.createViewStyle({marginLeft:5}),iconStyle:()=>n.Styles.createViewStyle({overflow:"visible"}),redDot:()=>n.Styles.createViewStyle({width:10,height:10,borderRadius:5,backgroundColor:d.Color.red,position:"absolute",left:12,top:15})}),C=d.Color.blackOverlay50;class S extends p.default{constructor(){super(...arguments),this._onHiddenChanged=e=>{this.isComponentMounted()&&this.state.hidden!==e&&this.setState({hidden:e})},this._onPress=e=>{this._handleOnPress(e)},this._onButtonRef=e=>{this._buttonRef=e||void 0}}_iconSize(){return u.IconSize.size16}_iconBackgroundColor(){return C}_iconBorderColor(){}_tooltip(){}_accessibilityLabel(){return this.props.accessibilityLabel}_labelStyle(){}_shouldRenderRedDot(){return!1}_iconColor(){}_containerStyle(){}_getMainContainerStyles(){}_buildState(e,t){const i={};return t&&(i.hidden=e.layoutController.isHidden()),i}_handleOnPress(e){this.props.onPress&&this.props.onPress()}componentDidMount(){super.componentDidMount(),this.props.layoutController.onHiddenChanged&&this.props.layoutController.onHiddenChanged(this._onHiddenChanged)}render(){if(this.state.hidden)return null;const e=this._label(),t=this._icon(),i=[g.label,this._labelStyle()],c=e?(0,a.jsx)(h.BodyText,Object.assign({style:i},{children:e})):void 0;let p,C,S,m=this._iconColor();m||(m=d.Color.whiteOverlay80),t&&(p=(0,a.jsx)(l.default,{icon:t,size:this._iconSize(),color:m,style:g.iconStyle})),this._shouldRenderRedDot()&&(C=(0,a.jsx)(n.View,{style:g.redDot})),this.props.showChevron&&(S=(0,a.jsx)(l.default,{icon:u.SkypeIcon.DownChevron,size:u.IconSize.size6,color:m,style:g.chevronIcon}));const y=this.props.dimensions.width===this.props.dimensions.height?this.props.dimensions.width/2:0,f=[g.innerContainer,n.Styles.createViewStyle({backgroundColor:this._iconBackgroundColor(),height:this.props.dimensions.height,width:this.props.dimensions.width,borderRadius:y},!1)];f.push(this._containerStyle());const b=this._accessibilityLabel(),_={style:f,title:this._tooltip(),accessibilityLabel:b,onPress:this._onPress};let T;const v=this.props.coachMarkType;T=v&&b?(0,a.jsxs)(o.default.HoverableButton,Object.assign({},_,{coachMarkType:v,anchorAccessibilityLabel:b,onAnchorPress:this._onPress,positions:[s.PopupAnchorPositon.Bottom],anchorRef:this._onButtonRef},{children:[p,c,C,S]})):(0,a.jsxs)(r.HoverableButton,Object.assign({},_,{ref:this._onButtonRef},{children:[p,c,C,S]}));const w=[g.container,this.props.layoutController.getStyles()];return this.props.ribbonOpacityStyle&&w.push(this.props.ribbonOpacityStyle),w.push(this._getMainContainerStyles()),(0,a.jsx)(n.Animated.View,Object.assign({style:w},{children:T}))}}t.RibbonExtraViewBase=S,t.default=S},402952:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(733754),n=i(753602),o=i(581760),s=i(711828);class r extends n.default{_buildState(e,t){const i=super._buildState(e,t);return t&&(i.remainder=void 0,i.ringing=void 0),i}showRemainder(e,t){!this.isComponentMounted()||this.state.remainder===e&&this.state.ringing===t||this.setState({remainder:e,ringing:t})}_iconBackgroundColor(){return o.Color.gray400Overlay80}_icon(){return this.state.ringing?s.SkypeIcon.CallAnimSmall4:s.SkypeIcon.Plus}_label(){return this.state.remainder&&this.state.remainder>0?this.state.remainder.toString():void 0}_tooltip(){return this._intTooltip()}_accessibilityLabel(){return this.props.accessibilityLabel||this._intTooltip()}_intTooltip(){return this.state.remainder&&this.state.remainder>0?a.getString("CallBanner.MorePeopleInTheCallTooltip",{count:this.state.remainder}):void 0}}t.default=r},677557:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(583367),o=i(220187),s=i(994224),r=i(136850),l=i(671830),c=i(273145),d=i(933790),u=i(733754),h=i(753602),p=i(174984),g=i(581760),C=i(711828);class S extends h.default{_buildState(e,t){const i=r.default.getStageMode(e.callId),a=s.default.CallScreenShareStore.hasIncomingScreensharing(e.callId),n={isPSTNCall:s.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:l.isEncryptedThread(e.conversationMri),conversationMri:e.conversationMri,callId:e.callId};this._changeCallLayoutCommand=new o.ChangeCallLayoutCommand(n,e.isIncomingOrOutGoingRing,i);const c=Object.assign(Object.assign({},super._buildState(e,t)),{isAudioOnlyCall:n.isPSTNCall&&n.isEncryptedCall,stageMode:i,hasIncomingScreenshare:a,callInfo:n});return t&&(c.hidden=e.layoutController.isHidden()),c}_iconSize(){return C.IconSize.size20}_iconBackgroundColor(){return g.Color.transparent}_icon(){return C.SkypeIcon.ViewSwitcher}_label(){}_tooltip(){return this._intLabel()}_accessibilityLabel(){return this._intLabel()}_handleOnPress(e){let t;const i=e;if(i.pageX&&i.pageY){d.default.setAnchorPosition({x:i.pageX,y:i.pageY});const e=this._getRootViewId();t=c.default.getMenuTargetCallback(e)}else t=()=>this._buttonRef;this.props.showFullScreenOptionInRibbonSettings?n.default.isFullScreenMode(this._getRootViewId()).then((i=>{this._showRibbonSettingsMenu(!0,i,t,e)})):this._showRibbonSettingsMenu(!1,!1,t,e)}_showRibbonSettingsMenu(e,t,i,n){const o=a.pick(n,"pageX","pageY");a.defer((()=>{p.default.show(this.props.availableLayoutModes,this.props.layoutMode,this.props.onCallPanelHeaderLayoutChange,i,this._getRootViewId(),o,this.state.isAudioOnlyCall,e,t,this.state.stageMode,this.state.hasIncomingScreenshare,this._changeCallLayoutCommand)}))}_intLabel(){return u.getString("CallPanel.RibbonLayoutAccessibilityLabel")}}t.default=S},897982:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.maybePresentRinglessCallInterstitial=void 0;const a=i(785893),n=i(583367),o=i(516778),s=i(244770),r=i(67930),l=i(994224),c=i(109520),d=i(502278),u=i(711930),h=i(147204),p=i(898278),g=i(404336),C=i(437490),S=i(746096),m=i(913944),y=i(436237),f=i(915877),b=i(733754),_=i(29130),T=i(451070),v=i(681115),w=i(910265),I=i(22222),P=i(581760),M=i(711828),k=i(734528),A=i(619675),R=i(340395),x="RinglessCallInterstitial",L=(0,f.lazyProperties)({dialog:()=>o.Styles.createViewStyle({flex:1,justifyContent:"center"}),dialogHeaderContainer:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,flexDirection:"row",justifyContent:"space-between"}),closeButton:()=>o.Styles.createViewStyle({paddingLeft:15,paddingRight:15}),footer:()=>o.Styles.createViewStyle({height:60,alignSelf:"center"}),footerLandscape:()=>o.Styles.createViewStyle({height:50,alignSelf:"center"}),footerButton:()=>o.Styles.createViewStyle({alignSelf:"center",justifyContent:"center",alignItems:"center",marginTop:10}),interstitialImage:()=>o.Styles.createImageStyle({height:120,width:360,alignSelf:"center",marginTop:5}),message:()=>o.Styles.createTextStyle({alignSelf:"center",textAlign:"center",marginVertical:10,marginHorizontal:30,backgroundColor:P.Color.transparent})});t.maybePresentRinglessCallInterstitial=function(e,t){y.log(S.LogTraceArea.CallingUI,"RinglessCallInterstitial maybePresentRinglessCallInterstitial, causeId: "+e.causeId);const i=(0,a.jsx)(V,{dialogId:x,conversationMri:e.conversationMri,withVideo:e.withVideo,origin:e.origin,isLargeGroup:e.isLargeGroup,causeId:e.causeId});h.default.showModal(i,x,t)};class V extends r.default{constructor(){super(...arguments),this._closeButtonPressed=()=>{y.log(S.LogTraceArea.CallNavigation,"RinglessCallInterstitial._closeButtonPressed causeId: "+this.props.causeId),d.default.trackRinglessCallInterstitial(c.RinglessCallInterstitialActions.Cancel,this.props.isLargeGroup),h.default.dismissModal(this.props.dialogId,this._getRootViewId())},this._onButtonPressed=()=>{y.log(S.LogTraceArea.CallNavigation,"RinglessCallInterstitial._onButtonPressed causeId: "+this.props.causeId),d.default.trackRinglessCallInterstitial(c.RinglessCallInterstitialActions.ContinueWithCall,this.props.isLargeGroup),l.default.CallNavigationHelper.startCall({conversationMri:this.props.conversationMri,withVideo:this.props.withVideo,origin:this.props.origin},this.props.causeId)}}_buildState(e,t){const i=this._getRootViewId();return{isLandscape:!this._getContext().isPresentedInDesktopSubview&&_.default.getDeviceOrientation(i)===n.DeviceOrientation.Landscape,isMobileScreenSize:_.default.isMobileScreenSize(i),statusBarHeight:T.default.leavePaddingForStatusBar()?T.default.statusBarHeight():0}}componentDidMount(){super.componentDidMount(),C.dismissAll()}componentWillUnmount(){super.componentWillUnmount(),y.log(S.LogTraceArea.CallingUI,"RinglessCallInterstitial componentWillUnmount")}render(){const e=this._renderCloseButton(),t=this._renderActionButton(),i=this.state.isMobileScreenSize?{maxWidth:void 0,maxHeight:void 0}:{maxWidth:g.CompactWidth,maxHeight:462},n=this._renderImage(),s=this._getTitleText(),r=this._getContentText(),l=u.default.combinedAccessibilityLabel(s,r);return(0,a.jsxs)(w.default,Object.assign({dialogId:this.props.dialogId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0},i,{maxWidth:this.state.isMobileScreenSize?void 0:g.DefaultWidth,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:l},{children:[(0,a.jsx)(R.default,{statusBarKey:"RinglessCall",barStyle:R.BarStyle.LIGHT_CONTENT,animated:!0}),(0,a.jsxs)(o.View,Object.assign({style:L.dialog},{children:[e,n,(0,a.jsx)(A.PanelHeader,Object.assign({style:L.message},{children:s})),(0,a.jsx)(A.BodyText,Object.assign({style:L.message},{children:r})),t]}))]}))}_getHeaderTopMargin(){return this.state.isMobileScreenSize&&!this.state.isLandscape&&!this._getContext().isPresentedInDesktopSubview&&this.state.statusBarHeight>0?this.state.statusBarHeight:!this.state.isMobileScreenSize&&this.state.isLandscape?15:5}_renderCloseButton(){const e=[L.dialogHeaderContainer],t=this._getHeaderTopMargin();return t&&e.push(v.default.marginTopStyle(t)),(0,a.jsx)(o.View,Object.assign({style:e},{children:(0,a.jsx)(m.default,{style:L.closeButton,icon:k.closeIcon(),size:M.IconSize.size24,title:b.getString("Global.CloseButtonTitle"),onPress:this._closeButtonPressed,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor})}))}_renderActionButton(){return(0,a.jsx)(o.View,Object.assign({style:this.state.isLandscape?L.footerLandscape:L.footer},{children:(0,a.jsx)(I.default,{buttonSize:p.SXButtonSize.Medium,buttonStyle:p.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:P.AgnosticGradientFillButtonColors.blue,style:L.footerButton,allowTextWrap:!0,title:b.getString("CallPanel.GroupCallRingLessContinueToCallButtonTitle"),onPress:this._onButtonPressed,autoFocus:!1})}))}_renderImage(){const e=this.props.isLargeGroup?s.Collection.RINGLESS_CALL_LARGE_GROUP:s.Collection.RINGLESS_CALL_SMALL_GROUP;return(0,a.jsx)(o.Image,{source:e,style:L.interstitialImage})}_getTitleText(){return this.props.isLargeGroup?b.getString("CallPanel.GroupCallRinglessLargeGroup"):b.getString("CallPanel.GroupCallRinglessSmallGroup")}_getHeaderText(e){return this._getTitleText()}_getContentText(){return this.props.isLargeGroup?b.getString("CallPanel.GroupCallRinglessLargeGroupExplanation"):b.getString("CallPanel.GroupCallRinglessSmallGroupExplanation")}}t.default=V},451804:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(311010),r=i(581760),l=i(915877),c=i(733754),d=(0,l.lazyProperties)({controlItem:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",cursor:"pointer",backgroundColor:r.Color.black,marginBottom:7}),controlItemText:()=>n.Styles.createTextStyle({textAlign:"center",color:r.Color.white}),controlItemTextActive:()=>n.Styles.createTextStyle({fontSize:s.default.controlFontSize.screenShareZoomControlActiveItem}),controlItemTextNonActive:()=>n.Styles.createTextStyle({fontSize:s.default.controlFontSize.screenShareZoomControlNonActiveItem})});class u extends o.ComponentBase{constructor(){super(...arguments),this._onReactionButtonRef=e=>{this._reactionButton=e||void 0}}requestFocus(){this._reactionButton&&this._reactionButton.requestFocus()}render(){const e=[d.controlItem,...this.props.styles],t=[d.controlItemText,this.props.isActive?d.controlItemTextActive:d.controlItemTextNonActive];return(0,a.jsx)(n.Button,Object.assign({style:e,onPress:this.props.onClick,ref:this._onReactionButtonRef,accessibilityLabel:c.getString("CallControls.ScreenShareZoomControlsZoomButtonAnnouncement",{zoomLevel:this.props.zoomLevelText})},{children:(0,a.jsx)(n.Text,Object.assign({style:t},{children:this.props.textToShow}))}))}}t.default=u},380306:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(915877),r=i(581760),l=i(813598),c=i(451804),d=i(297775),u=i(911009),h=i(733754),p=i(913944),g=i(711828),C=i(706250),S=i(746096),m=i(640363),y="item_",f=(0,s.lazyProperties)({controlsContainer:()=>n.Styles.createViewStyle({width:36,minHeight:36,borderRadius:18,borderWidth:2,position:"absolute",bottom:15,right:15,alignItems:"center",justifyContent:"center",borderColor:r.Color.black,backgroundColor:r.Color.white}),controlsContainerOpened:()=>n.Styles.createViewStyle({paddingTop:3}),controlsMenuWrapper:()=>n.Styles.createViewStyle({alignItems:"center",height:30,overflow:"hidden"}),controlsMenuInnerWrapper:()=>n.Styles.createViewStyle({alignItems:"center"}),controlsClosedButtonWrapper:()=>n.Styles.createViewStyle({width:30,height:30,position:"absolute",backgroundColor:r.Color.white}),controlsClosedButton:()=>n.Styles.createViewStyle({width:30,height:30,alignItems:"center",justifyContent:"center"}),controlsClosedButtonText:()=>n.Styles.createTextStyle({fontSize:15}),closeControlsIcon:()=>n.Styles.createViewStyle({width:22,height:22,borderRadius:11,backgroundColor:r.Color.black,marginBottom:3}),activeItem:()=>n.Styles.createViewStyle({width:l.zoomDrawerValues.activeItemSize,height:l.zoomDrawerValues.activeItemSize,borderRadius:14}),notActiveItem:()=>n.Styles.createViewStyle({width:l.zoomDrawerValues.nonActiveItemSize,height:l.zoomDrawerValues.nonActiveItemSize,borderRadius:11}),lastItemMargin:()=>n.Styles.createViewStyle({marginBottom:l.zoomDrawerValues.lastItemMargin})});class b extends o.ComponentBase{constructor(){super(...arguments),this._mountedRefsMap=new C.default,this._animatedHeightValue=new n.Animated.Value(l.zoomDrawerValues.minHeight),this._animatedOpacityValue=new n.Animated.Value(l.zoomDrawerValues.minOpacity),this._animatedContainerStyle=n.Styles.createAnimatedViewStyle({height:this._animatedHeightValue}),this._animatedInnerContainerStyle=n.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue}),this._onMenuCloseButtonRef=e=>{this._menuClosedButtonRef=e||void 0},this._handleOpenMenu=()=>{this.setState({shouldDrawerBeOpened:!0,isDrawerOpened:!0,menuOpenedWithKeyboard:this.props.isNavigatingWithKeyboard})},this._handleCloseMenu=()=>{this.setState({shouldDrawerBeOpened:!1,menuOpenedWithKeyboard:!1})}}_buildState(e,t){const i={};return t&&(i.shouldDrawerBeOpened=!1,i.isDrawerOpened=!1,i.menuOpenedWithKeyboard=!1),i}componentWillUnmount(){super.componentWillUnmount(),this._drawerAnimation&&(this._drawerAnimation.stop(),this._drawerAnimation=void 0)}componentDidUpdate(e,t,i){if(super.componentDidUpdate(e,t,i),this.state.shouldDrawerBeOpened!==t.shouldDrawerBeOpened&&this._positionControlsDrawer(),this.state.isDrawerOpened!==t.isDrawerOpened){const e=this.state.isDrawerOpened?this._mountedRefsMap.ref(y+0):this._menuClosedButtonRef;e&&e.requestFocus()}}render(){const{isDrawerOpened:e,menuOpenedWithKeyboard:t}=this.state,{currentZoomLevel:i,isNavigatingWithKeyboard:o}=this.props,s=l.zoomUiSizesText.length-1,r=[f.controlsMenuWrapper,this._animatedContainerStyle],c=[f.controlsMenuInnerWrapper,this._animatedInnerContainerStyle],p=m.default.getPlatformType()===S.PlatformType.OSX?h.getString("CallControls.ScreenShareZoomCoachMarkMacLabel"):h.getString("CallControls.ScreenShareZoomCoachMarkDefaultLabel");return(0,a.jsx)(d.default.View,Object.assign({coachMarkType:u.CoachMarkType.ScreenShareZoomControl,anchorAccessibilityLabel:p,positions:[u.PopupAnchorPositon.Left,u.PopupAnchorPositon.Bottom],onMouseEnter:this._handleOpenMenu,onMouseLeave:this._handleCloseMenu,widthOverride:l.zoomDrawerValues.coachMarkWidth,style:[f.controlsContainer,e?f.controlsContainerOpened:void 0]},{children:e?(0,a.jsx)(n.Animated.View,Object.assign({style:r},{children:(0,a.jsxs)(n.Animated.View,Object.assign({style:c},{children:[this._renderZoomLevelButtons(s,i),t&&this._renderDrawerCloseButton()]}))})):(0,a.jsx)(n.Animated.View,Object.assign({style:f.controlsClosedButtonWrapper},{children:(0,a.jsx)(n.Button,Object.assign({accessibilityLabel:h.getString("CallControls.ScreenShareZoomControlsOpenButtonAnnouncement"),ref:this._onMenuCloseButtonRef,onPress:o?this._handleOpenMenu:void 0,style:f.controlsClosedButton},{children:(0,a.jsx)(n.Text,Object.assign({style:f.controlsClosedButtonText},{children:l.zoomUiSizesText[s-i]+"x"}))}))}))}))}_renderDrawerCloseButton(){return(0,a.jsx)(p.default,{icon:g.SkypeIcon.DownChevron,size:g.IconSize.size16,color:r.Color.white,accessibilityLabel:h.getString("CallControls.ScreenShareZoomControlsCloseButtonAnnouncement"),style:f.closeControlsIcon,onPress:this._handleCloseMenu})}_renderZoomLevelButtons(e,t){return l.zoomUiSizesText.map(((i,n)=>{const o=e-n,s=n===e,r=!this.state.menuOpenedWithKeyboard&&s,l=o===t,d=[l?f.activeItem:f.notActiveItem,r?f.lastItemMargin:void 0];return(0,a.jsx)(c.default,{zoomLevelText:i,textToShow:s?i+"x":i,ref:this._mountedRefsMap.onComponentRef(y+n),styles:d,isActive:l,onClick:()=>this._setZoomLevel(o)},i)}))}_positionControlsDrawer(){const{shouldDrawerBeOpened:e}=this.state,t=e?this._getDrawerHeight(this.state.menuOpenedWithKeyboard):l.zoomDrawerValues.minHeight,i=e?l.zoomDrawerValues.maxOpacity:l.zoomDrawerValues.minOpacity;if(!this._animatedHeightValue||!this._animatedOpacityValue)return;const a=n.Animated.timing(this._animatedHeightValue,{toValue:t,easing:n.Animated.Easing.Linear(),duration:e?l.zoomDrawerValues.openDuration:l.zoomDrawerValues.closeDuration}),o=n.Animated.timing(this._animatedOpacityValue,{toValue:i,easing:n.Animated.Easing.Linear(),duration:e?l.zoomDrawerValues.openDuration:l.zoomDrawerValues.closeDuration});let s,r;e?(s=a,r=o):(s=o,r=a),this._drawerAnimation=s,this._drawerAnimation.start((()=>{this._drawerAnimation=r,this._drawerAnimation.start((()=>{this._onPositionDrawerAnimationCompleted()}))}))}_onPositionDrawerAnimationCompleted(){const{shouldDrawerBeOpened:e}=this.state;e||this.setState({isDrawerOpened:!1})}_getDrawerHeight(e){const t=l.zoomUiSizesText.length+(e?1:0);return(l.zoomDrawerValues.nonActiveItemSize+l.zoomDrawerValues.itemMargin)*(t-1)+(l.zoomDrawerValues.activeItemSize+l.zoomDrawerValues.lastItemMargin)}_setZoomLevel(e){this.props.currentZoomLevel!==e&&this.props.setZoomLevel(e)}}t.default=b},635428:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(148540),r=i(787720),l=i(889391),c=i(994224),d=i(47447),u=i(471727),h=i(898278),p=i(587134),g=i(746096),C=i(913944),S=i(436237),m=i(648638),y=i(172490),f=i(915877),b=i(733754),_=i(178735),T=i(29130),v=i(672997),w=i(628477),I=i(596187),P=i(911275),M=i(910265),k=i(22222),A=i(581760),R=i(311010),x=i(711828),L=i(734528),V=i(478262),O=i(680837),B=i(619675),D=i(24576),E=i(912770),N=A.Color.gray400,F=(0,f.lazyProperties)({panel:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",alignSelf:"stretch",backgroundColor:N}),modalContainerForAll:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"center",justifyContent:"flex-start",padding:20}),sourcesLists:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",marginHorizontal:40,justifyContent:"flex-start",alignSelf:"center"}),screensSourcesList:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"center",flexWrap:"wrap"}),windowsSourcesList:()=>o.Styles.createViewStyle({flex:1,flexWrap:"wrap",flexDirection:"column",justifyContent:"center"}),title:()=>o.Styles.createViewStyle({marginBottom:30}),titleText:()=>o.Styles.createTextStyle({color:A.Color.white,fontSize:R.default.controlFontSize.cardTitle}),divider:()=>o.Styles.createViewStyle({flex:1,height:void 0,minWidth:2}),sourceListScreen:()=>o.Styles.createViewStyle({justifyContent:"flex-start"}),sourceListWindow:()=>o.Styles.createViewStyle({flexWrap:"wrap",flexDirection:"row",justifyContent:"flex-start"}),buttons:()=>o.Styles.createViewStyle({flexDirection:"row"}),button:()=>o.Styles.createViewStyle({marginHorizontal:10,marginTop:15,width:180}),modalAudioLabelContainer:()=>o.Styles.createViewStyle({paddingHorizontal:4,flexDirection:"row",alignItems:"center",justifyContent:"center",alignSelf:"stretch",marginTop:15}),includeAudioLabel:()=>o.Styles.createTextStyle({color:A.Color.white}),audioMargin:()=>o.Styles.createViewStyle({marginRight:10}),sectionHeader:()=>o.Styles.createTextStyle({color:A.Color.white,marginLeft:5,marginBottom:10}),closeButton:()=>o.Styles.createViewStyle({alignSelf:"flex-start",justifyContent:"center",height:50,paddingLeft:15,paddingRight:15})});class j extends D.default{constructor(){super(...arguments),this._onAudioToggleChange=(e,t)=>{e.stopPropagation(),S.log(g.LogTraceArea.CallingUI,"ScreenSharingPanel._onAudioToggleChange"),this.setState({includeAudio:t},(()=>{E.default.setTimeout((()=>{this.isComponentMounted()&&this._audioToggleRef&&this._audioToggleRef.focusToggle()}),100)}))},this._onEscape=()=>(S.log(g.LogTraceArea.CallingUI,"ScreenSharingPanel._onEscape"),this._onClose(w.ScreenSharingPanelCancelOrigin.Esc),!0),this._onAudioToggleRef=e=>{this._audioToggleRef=e||void 0},this._onClose=e=>{var t;this.props.onClose&&(S.track(new w.ScreenSharingPanelCancelEvent(e,this.state.screensSourcesList.length,(null===(t=this.state.windowsSourcesList)||void 0===t?void 0:t.length)||0,this.props.isScreenSharingActive)),this.props.onClose())},this._onSourceSelected=(e,t)=>{S.log(g.LogTraceArea.CallingUI,"ScreenSharingPanel: _onSourceSelected "+s.SharingSourceType[this.state.selectedSourcesType]),t&&this.state.isNavigatingWithKeyboard?this._shareScreen(w.ScreenSharingStartOrigin.EnterWithKeyboardNavigation):this.setState({selectedSource:e})},this._shareScreen=e=>{var t;this.state.selectedSource&&(S.track(new w.ScreenSharingPanelStartedSharingEvent(this.state.selectedSource.getType(),e,this.state.screensSourcesList.length,(null===(t=this.state.windowsSourcesList)||void 0===t?void 0:t.length)||0,this.props.isScreenSharingActive)),this.props.onSelectSource(this.state.selectedSource,this.state.includeAudio,this.state.selectedSource.getType()))}}_buildState(e,t){t&&(this._rootViewId=this._getRootViewId());const i=d.CallingCapabilities.applicationSharingSupported(),a=T.default.getWidth(this._rootViewId),o=v.default.responsiveWidthForSize(a),r=c.default.DeviceStore.getAvailableScreens(),h=i?c.default.DeviceStore.getAvailableWindows():void 0;let p,C;t?(p=e.currentScreenSharingSource||n.first(r),C=e.currentScreenSharingSourceType||s.SharingSourceType.Monitor,c.default.DeviceStore.fetchAvailableWindows()):(p=this.state.selectedSource,C=this.state.selectedSourcesType),S.log(g.LogTraceArea.CallingUI,`created new state screensSourcesList ${r.length} windowSharingEnabled ${i}`),h&&S.log(g.LogTraceArea.CallingUI,`windowsSourcesList ${h.length}`);const y=l.default.getS4LCMCFeatures(),f=u.default.isLightTheme()&&y.enableNewCallScreen&&_.default.getNewCallScreenDesignEnabled(),b=this._useAccessibleTheme(),w=f||b;return{includeAudio:t?!!e.initialShareSounds:this.state.includeAudio,screensSourcesList:r,windowsSourcesList:h||[],hasWindowsSection:!!(null==h?void 0:h.length),appWidth:a,selectedSourcesType:C,selectedSource:p,screenSize:o,isNavigatingWithKeyboard:m.default.isNavigatingWithKeyboard(),useHighContrastTheme:b,useDefaultTheme:w}}componentDidMount(){super.componentDidMount(),y.default.addEscapeHandler(this._onEscape),this._windowsInterval=E.default.setInterval((()=>c.default.DeviceStore.fetchAvailableWindows()),1e3)}componentWillUnmount(){super.componentWillUnmount(),y.default.removeEscapeHandler(this._onEscape),E.default.clearInterval(this._windowsInterval),c.default.DeviceStore.clearAvailableWindows()}render(){const e=I.default.getWindowSourceItemDimensions(),t=this.state.appWidth<=650?e.width:this.state.screenSize<=V.ResponsiveWidth.Tiny?2*e.width:void 0,i=[F.windowsSourcesList,o.Styles.createViewStyle({maxWidth:t},!1)],n=[F.sectionHeader];this.state.useDefaultTheme&&n.push(this._themeStyles.primaryTextColorStyle);const s=this.state.hasWindowsSection&&[(0,a.jsx)(p.default,{style:F.divider,color:this.state.useDefaultTheme?this._themeColors.dividerColor:A.Color.gray200Overlay20,marginRight:25,marginLeft:18},"divider"),(0,a.jsxs)(o.View,Object.assign({style:i},{children:[(0,a.jsx)(B.RowTitle,Object.assign({style:n},{children:b.getString("ScreenSharingModal.WindowsSection")})),(0,a.jsx)(P.ScreenSharingSourceList,{style:F.sourceListWindow,sourcesList:this.state.windowsSourcesList,itemWidth:e.width,itemHeight:e.height,currentScreenSharingSource:this.props.currentScreenSharingSource,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,shareScreen:this._shareScreen,selectedSource:this.state.selectedSource,onSourceSelected:this._onSourceSelected,accessibilityLabel:b.getString("ScreenSharingModal.WindowsSection"),useHighContrastTheme:this.state.useHighContrastTheme,useDefaultTheme:this.state.useDefaultTheme})]}),"windowsList")],r=[F.titleText];this.state.useDefaultTheme&&r.push(this._themeStyles.primaryTextColorStyle);const l=I.default.getScreenSourceItemDimensions(this.state.screenSize,!this.state.hasWindowsSection,this.state.screensSourcesList.length),c=[F.screensSourcesList,o.Styles.createViewStyle({minWidth:l.width},!1)],u=d.CallingCapabilities.screenSharingWithSoundSupported(),h=(0,a.jsxs)(o.View,Object.assign({style:F.modalContainerForAll},{children:[(0,a.jsx)(o.View,Object.assign({style:F.title},{children:(0,a.jsx)(B.RowTitle,Object.assign({style:r},{children:b.getString("ScreenSharingModal.Title")}))})),(0,a.jsxs)(o.View,Object.assign({style:F.sourcesLists},{children:[(0,a.jsxs)(o.View,Object.assign({style:c},{children:[(0,a.jsx)(B.RowTitle,Object.assign({style:n},{children:b.getString("ScreenSharingModal.ScreensSection")})),(0,a.jsx)(P.ScreenSharingSourceList,{style:this.state.hasWindowsSection?F.sourceListScreen:F.sourceListWindow,sourcesList:this.state.screensSourcesList,itemWidth:l.width,itemHeight:l.height,currentScreenSharingSource:this.props.currentScreenSharingSource,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,shareScreen:this._shareScreen,selectedSource:this.state.selectedSource,onSourceSelected:this._onSourceSelected,accessibilityLabel:b.getString("ScreenSharingModal.ScreensSection"),useHighContrastTheme:this.state.useHighContrastTheme,useDefaultTheme:this.state.useDefaultTheme})]})),s]})),d.CallingCapabilities.screenSharingWithSoundSupported()&&this._getAudioToggle(),(0,a.jsxs)(o.View,Object.assign({style:this.state.screenSize>V.ResponsiveWidth.MinDesktop?F.buttons:void 0},{children:[this._getCancelButton(),this._getStartSharingButton()]}))]})),g=[F.panel];return this.state.useDefaultTheme&&g.push(this._themeStyles.primaryBackgroundColorStyle),(0,a.jsx)(M.default,Object.assign({dialogId:"screenShare",onClickOutside:()=>this._onClose(w.ScreenSharingPanelCancelOrigin.ClickOutside),maxWidth:I.default.getModalWidth(this.state.screenSize,this.state.screensSourcesList.length,this.state.windowsSourcesList.length),maxHeight:I.default.getModalHeigh(this.state.screensSourcesList.length,this.state.windowsSourcesList.length,u),fullScreen:this.state.screenSize<=V.ResponsiveWidth.Tiny,useFullSizeContainer:!0},{children:(0,a.jsxs)(o.View,Object.assign({style:g},{children:[this.state.screenSize<=V.ResponsiveWidth.Tiny&&this._getBackButton(),h]}))}))}_getBackButton(){return(0,a.jsx)(C.default,{style:F.closeButton,icon:L.closeIcon(),size:x.IconSize.size24,title:b.getString("Global.CloseButtonTitle"),onPress:()=>this._onClose(w.ScreenSharingPanelCancelOrigin.BackButton),color:A.Color.white,hoverColor:A.Color.whiteOverlay70})}_getAudioToggle(){const e=(0,a.jsx)(r.default,{ref:this._onAudioToggleRef,isOn:this.state.includeAudio,accessibilityLabel:b.getString("ScreenSharingModal.IncludeAudioToggleAccessibilityLabel"),onChange:this._onAudioToggleChange,style:O.default.alignItemsCenter}),t=[F.includeAudioLabel];this.state.useDefaultTheme&&t.push(this._themeStyles.primaryTextColorStyle);const i=(0,a.jsx)(o.View,Object.assign({style:F.audioMargin},{children:(0,a.jsx)(B.RowTitle,Object.assign({style:t},{children:b.getString("ScreenSharingModal.IncludeAudioText")}))}));return(0,a.jsxs)(o.View,Object.assign({style:F.modalAudioLabelContainer},{children:[i,e]}))}_getCancelButton(){const e=this.state.useHighContrastTheme?h.SXButtonStyle.ThemeStroke:h.SXButtonStyle.ColorStroke;return(0,a.jsx)(k.default,{title:b.getString("ScreenSharingModal.Cancel"),style:F.button,buttonStyle:e,buttonSize:h.SXButtonSize.Medium,onPress:()=>this._onClose(w.ScreenSharingPanelCancelOrigin.CancelButton)})}_getStartSharingButton(){return(0,a.jsx)(k.default,{title:this._getScreenShareButtonText(),style:F.button,buttonSize:h.SXButtonSize.Medium,onPress:()=>this._shareScreen(w.ScreenSharingStartOrigin.StartButton),disabled:!this.state.selectedSource})}_getScreenShareButtonText(){return this.props.isScreenSharingActive?this.state.selectedSourcesType&&this.state.selectedSourcesType===s.SharingSourceType.Window?b.getString("ScreenSharingModal.SwitchWindow"):b.getString("ScreenSharingModal.SwitchScreen"):this.state.hasWindowsSection?b.getString("ScreenSharingModal.ShareScreenOrWindow"):this.state.includeAudio?b.getString("ScreenSharingModal.ShareScreenAndSounds"):b.getString("ScreenSharingModal.ShareScreen")}}t.default=j},265974:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(148540),s=i(109520),r=i(746096),l=i(110117),c=i(436237),d=i(915877),u=i(733754),h=i(89808),p=i(914976),g=i(596187),C=i(404057),S=i(581760),m=i(711828),y=i(619675),f=i(24576),b=(0,d.lazyProperties)({image:()=>n.Styles.createViewStyle({borderColor:S.Color.transparent,backgroundColor:S.Color.gray400}),missingPreviewView:()=>n.Styles.createViewStyle({borderColor:S.Color.transparent,backgroundColor:S.Color.gray400,flexDirection:"column",alignContent:"center",alignItems:"center",justifyContent:"space-around"}),missingPreviewText:()=>n.Styles.createTextStyle({color:S.Color.white}),imageSelectedBorder:()=>n.Styles.createImageStyle({borderColor:S.Color.blue}),imageHoverBorder:()=>n.Styles.createImageStyle({borderColor:S.Color.gray200Overlay20}),imageSelectedBackground:()=>n.Styles.createViewStyle({backgroundColor:S.Color.blue}),imageHoverBackground:()=>n.Styles.createViewStyle({backgroundColor:S.Color.gray200Overlay60}),centerContent:()=>n.Styles.createViewStyle({borderRadius:4,alignItems:"center",paddingBottom:8,paddingTop:4}),sourceItem:()=>n.Styles.createViewStyle({justifyContent:"center",marginTop:4}),sourceDescription:()=>n.Styles.createTextStyle({textAlign:"center",color:S.Color.white,marginTop:8}),appDescription:()=>n.Styles.createTextStyle({textAlign:"left"}),textLine:()=>n.Styles.createViewStyle({marginLeft:5})});class _ extends f.default{constructor(){super(...arguments),this._failedCode="Failed",this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!1})},this._toggleSelection=()=>{c.log(r.LogTraceArea.CallingUI,"ScreenSharingSourceItem: _toggleSelection Source Selected "+p.dev_unknownOmit(this.props.sourceDetails.getDescription())),this.props.onSourceSelected(this.props.sourceDetails,this.props.isSelected)},this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{selectedColor:h.default.getPrimaryColor()}}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}componentDidMount(){super.componentDidMount(),this._setPreviewUrl(this.props.width,this.props.height)}render(){let e;const t=this.props.sourceDetails.getDescription(),i=n.Styles.createViewStyle({width:this.props.width,height:this.props.height,borderWidth:this.props.borderWidth},!1);let o;if(this.props.isSelected){const e=n.Styles.createImageStyle({borderColor:this.state.selectedColor},!1);o=this.props.useHighContrastTheme?this._themeStyles.primaryViewColorStyle:e}else this.state.isHoveringOn&&(o=b.imageHoverBorder);const s=[b.image,i,o],r=[b.missingPreviewView,i,o],c=this._getPlaceholderSize();if(this.state.previewUrl)if(this.state.previewUrl===this._failedCode){const t=u.getString("ScreenSharingModal.PreviewUnavailable");e=(0,a.jsxs)(n.View,Object.assign({style:[r]},{children:[(0,a.jsx)(l.default,{icon:m.SkypeIcon.MissingPreview,color:S.Color.white,size:c}),(0,a.jsx)(y.BodyText,Object.assign({style:b.missingPreviewText},{children:t}))]}))}else e=(0,a.jsx)(n.Image,{style:s,source:this.state.previewUrl,resizeMode:"stretch"});const d=[n.Styles.createViewStyle({width:this.props.width},!1)];d.push(b.appDescription,b.textLine),this.props.useDefaultTheme&&(this.props.isSelected?d.push(this._themeStyles.primaryBackgroundColorTextStyle):d.push(this._themeStyles.secondaryTextColorStyle));const h=n.Styles.createViewStyle({minWidth:this.props.width+2*this.props.borderWidth,minHeight:this.props.height+2*this.props.borderWidth+16},!1);let p;if(this.props.isSelected){const e=n.Styles.createViewStyle({backgroundColor:this.state.selectedColor},!1);p=this.props.useHighContrastTheme?this._themeStyles.primaryViewColorStyle:e}else this.state.isHoveringOn&&(p=b.imageHoverBackground);return(0,a.jsx)(n.GestureView,Object.assign({onDoubleTap:this.props.onDoubleTap},{children:(0,a.jsx)(n.View,Object.assign({onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd},{children:(0,a.jsx)(n.Button,Object.assign({ref:this._onContainerRef,style:[b.sourceItem,h],onPress:this._toggleSelection,accessibilityLabel:this.props.accessibilityLabel,tabIndex:this.props.tabIndex},{children:(0,a.jsxs)(n.View,Object.assign({style:[b.centerContent,p]},{children:[e,(0,a.jsx)(y.Caption,Object.assign({style:[b.sourceDescription,d],numberOfLines:1},{children:t}))]}))}))}))}))}_getPlaceholderSize(){return this.props.height<=g.SharingSourceSize.Small.width?m.IconSize.size48:this.props.height<=g.SharingSourceSize.Medium.width?m.IconSize.size100:m.IconSize.size128}_setPreviewUrl(e,t){this.props.sourceDetails.getPreviewAsync(e,t).then((e=>{this._checkIfUnmountedReportLateApi("get source preview")||e&&this._createCanvasAndSetpreviewUrl(e)})).catch((e=>{this.setState({previewUrl:this._failedCode});const t=C.default.errorAsString(e);c.error(r.LogTraceArea.CallingUI,"ScreenSharingSourceItem._setPreviewUrl "+t),c.track(new s.ScreenShareSourceGetPreviewFailure(t,o.SharingSourceType[this.props.sourceDetails.getType()],String(this.props.currentlyShared)))})),this.props.sourceDetails.getType()!==o.SharingSourceType.Monitor&&this._setPreviewUrlToIcon(e,t)}_setPreviewUrlToIcon(e,t){this.props.sourceDetails.getIcon(50,50).then((i=>{this._checkIfUnmountedReportLateApi("getIcon")||this.state.previewUrl||this._createCanvasForIconAndSetpreviewUrl(i,e,t)})).catch((e=>{const t=C.default.errorAsString(e);c.error(r.LogTraceArea.CallingUI,"ScreenSharingSourceItem._setPreviewUrlToIcon "+t),c.track(new s.ScreenShareSourceGetIconFailure(t,String(this.props.currentlyShared)))}))}_checkIfUnmountedReportLateApi(e){return!this.isComponentMounted()&&(c.log(r.LogTraceArea.GenericUnsafe,"ScreenSharingSource: "+e+" returned after component was unmounted: "+p.dev_unknownOmit(this.props.sourceDetails.getDescription())),!0)}_createCanvasForIconAndSetpreviewUrl(e,t,i){const a=document.createElement("canvas");a.width=t,a.height=i,a.style.width=t+"px",a.style.height=i+"px";const n=a.getContext("2d");n&&(n.fillStyle=S.Color.black,n.fillRect(0,0,t,i),n.putImageData(e,t/2-25,i/2-25)),this.setState({previewUrl:a.toDataURL()})}_createCanvasAndSetpreviewUrl(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.width=e.width,t.height=e.height,t.style.width=e.width+"px",t.style.height=e.height+"px",i&&i.putImageData(e,0,0),this.setState({previewUrl:t.toDataURL()})}}t.default=_},911275:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSharingSourceList=void 0;const a=i(785893),n=i(496486),o=i(516778),s=i(217041),r=i(148540),l=i(711930),c=i(547126),d=i(915877),u=i(733754),h=i(706250),p=i(628477),g=i(265974),C=(0,d.lazyProperties)({scrollView:()=>o.Styles.createScrollViewStyle({marginRight:-30,flex:1})}),S="source";class m extends s.ComponentBase{constructor(){super(...arguments),this._mountedSourceRefsMap=new h.default,this._onKeyPress=e=>{let t=this.state.focusedIndex;e.keyCode!==c.default.UP&&e.keyCode!==c.default.LEFT||(t-=1),e.keyCode!==c.default.DOWN&&e.keyCode!==c.default.RIGHT||(t+=1),t<0||t>=this.props.sourcesList.length||this.isComponentMounted()&&this.setState({focusedIndex:t})}}_buildState(e,t){return{focusedIndex:t?0:this.state.focusedIndex}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.focusedIndex!==t.focusedIndex&&this._focusItem(this.state.focusedIndex)}render(){return(0,a.jsx)(o.ScrollView,Object.assign({style:C.scrollView,onKeyPress:this._onKeyPress},{children:(0,a.jsx)(o.View,Object.assign({style:this.props.style},{children:this._getAvailableSharingSources()}))}))}_focusItem(e=0){if(e<0||e>=this.props.sourcesList.length)return;const t=this._mountedSourceRefsMap.ref(S+e);null==t||t.requestFocus()}_getAvailableSharingSources(){return n.map(this.props.sourcesList,((e,t)=>{const i=!!this.props.selectedSource&&e.getId()===this.props.selectedSource.getId(),n=!!this.props.currentScreenSharingSource&&e.getId()===this.props.currentScreenSharingSource.getId(),o=e.getId(),s=e.getDescription(),c=e.getType()===r.SharingSourceType.Monitor?"ScreenSharingModal.DesktopAccessibilityLabel":"ScreenSharingModal.WindowAccessibilityLabel";let d=u.getString(c,{description:s,currentItemIndex:t+1,numberOfItems:this.props.sourcesList.length});return i&&(d=l.default.combinedAccessibilityLabel(d,u.getString("Global.SelectedAccessibilityLabel"))||""),(0,a.jsx)(g.default,{ref:this._mountedSourceRefsMap.onComponentRef(S+t),tabIndex:this.state.focusedIndex===t?0:-1,sourceDetails:e,onSourceSelected:this.props.onSourceSelected,isSelected:i,screenIndex:t,width:this.props.itemWidth-8,height:this.props.itemHeight,borderWidth:4,currentlyShared:n,onDoubleTap:()=>this.props.shareScreen(p.ScreenSharingStartOrigin.DoubleClickSource),accessibilityLabel:d,useHighContrastTheme:this.props.useHighContrastTheme,useDefaultTheme:this.props.useDefaultTheme},o)}))}}t.ScreenSharingSourceList=m},321284:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(967593),s=i(516778),r=i(994224),l=i(915877),c=i(733754),d=i(89808),u=i(581760),h=i(24576),p=i(912770),g=(0,l.lazyProperties)({progressContainer:()=>s.Styles.createViewStyle({height:20,flexDirection:"row",overflow:"hidden",marginBottom:10,alignSelf:"center",justifyContent:"center"}),progressDotContainer:()=>s.Styles.createViewStyle({width:21,height:20,overflow:"hidden",backgroundColor:u.Color.transparent}),progressDot:()=>s.Styles.createViewStyle({width:40,height:40,borderRadius:20,borderWidth:14,borderStyle:"solid",backgroundColor:u.Color.transparent,marginTop:-10,marginLeft:-10})});class C extends h.default{_buildState(e,t){return t?{level:0}:{}}componentDidMount(){super.componentDidMount(),this._timer=p.default.setInterval((()=>{r.default.DeviceStore.getMicrophoneVolumeLevel().then((e=>{this.isComponentMounted()&&this.setState({level:e||0})}))}),200)}componentWillUnmount(){super.componentWillUnmount(),this._timer&&(p.default.clearInterval(this._timer),this._timer=void 0)}render(){const e=this.props.steps||19,t=[g.progressDot];t.push(s.Styles.createViewStyle({borderColor:this.props.backgroundColor||this._themeColors.primaryBackgroundColor},!1));const i=n.range(e).map((i=>{const n=[t];return i*(1/e)>=this.state.level&&n.push(this._themeStyles.secondaryBackgroundColorStyle),(0,a.jsx)(s.View,Object.assign({style:g.progressDotContainer},{children:(0,a.jsx)(s.View,{style:n})}),i.toString())}));return(0,a.jsx)(s.View,Object.assign({accessibilityLabel:c.getString("AudioVideoSettings.MicrophoneLevelMeter"),accessibilityTraits:s.Types.AccessibilityTrait.Image,ariaRoleDescription:""},{children:(0,a.jsx)(o.GradientView,Object.assign({style:[g.progressContainer,this.props.style],colors:d.default.getGradientColorsNoSubscription(),direction:o.GradientDirection.LEFT},{children:i}))}))}}t.default=C},646989:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(994224),n=i(733754),o=i(873659);class s extends o.default{_getVolume(){return a.default.DeviceStore.getMicrophoneVolume()}_setVolume(e){a.default.DeviceStore.setMicrophoneVolume(100*e)}_getAccessibilityLabel(){return n.getString("CallControls.CallButtonMicrophoneVolumeLabel")}}t.default=s},654863:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(994224),n=i(733754),o=i(873659);class s extends o.default{_getVolume(){return a.default.DeviceStore.getSpeakerVolume()}_setVolume(e){a.default.DeviceStore.setSpeakerVolume(100*e)}_getAccessibilityLabel(){return n.getString("CallControls.CallButtonSpeakerVolumeLabel")}}t.default=s},873659:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(994224),s=i(733754),r=(i(886045),i(363795)),l=i(24576);class c extends l.default{constructor(){super(...arguments),this._onVolumeChange=e=>{if(!this.isComponentMounted())return;const t=n.round(10*e,1);this.setState({accessibilityVolume:t}),this.props.onAdjustVolume&&this.props.onAdjustVolume(),this._setVolume(e)},this._onSelectedDeviceChanged=()=>{this.setState({initialValue:this._getVolume()})}}componentDidMount(){super.componentDidMount(),o.default.DeviceStore.selectedDevicesChangedEvent().subscribe(this._onSelectedDeviceChanged)}componentWillUnmount(){super.componentWillUnmount(),o.default.DeviceStore.selectedDevicesChangedEvent().unsubscribe(this._onSelectedDeviceChanged),o.default.DeviceStore.saveSettings()}_getAccessibilityVolumeAnnouncement(e){return s.getString("AudioVideoSettings.SpeakerVolumeSliderAnnouncement",{volume:e})}_buildState(e,t){return{initialValue:t?this._getVolume():-1,accessibilityVolume:n.round(this._getVolume()/10,1)}}render(){return(0,a.jsx)(r.default,{style:this.props.style,value:-1!==this.state.initialValue?this.state.initialValue/100:void 0,trackHeight:this.props.trackHeight||10,handleSize:this.props.handleSize||26,onProgressChange:this._onVolumeChange,accessibilityLabel:this._getAccessibilityLabel(),colorThemeOverride:this.props.colorThemeOverride,dragStep:.02,ariaValueNow:this.state.accessibilityVolume})}}t.default=c},76350:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(260662),r=i(746096),l=i(812854),c=i(913944),d=i(915877),u=i(733754),h=i(445026),p=i(681115),g=i(581760),C=i(640363),S=i(711828),m=(0,d.lazyProperties)({container:()=>o.Styles.createViewStyle({position:"absolute",bottom:0,right:0,left:0,height:70,overflow:"visible"}),innerContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between",backgroundColor:g.Color.blackOverlay20}),innerContainerRTL:()=>o.Styles.createViewStyle({flexDirection:"row-reverse"}),closeIcon:()=>o.Styles.createViewStyle({width:S.IconSize.default,height:S.IconSize.default,alignItems:"center",justifyContent:"center"})});class y extends s.default{constructor(){super(...arguments),this._enableHaptics=C.default.getPlatformType()===r.PlatformType.iOS,this._animatedStylesInitialized=!1}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.isOpen!==t.isOpen&&this._positionDrawer(!0,this.state)}openDrawer(){super.openDrawer(),this._enableHaptics&&l.default.prepareFeedback()}closeDrawer(){const e=super.closeDrawer();return this._enableHaptics&&l.default.unprepareFeedback(),e}_onHandleReactionPressed(){super._onHandleReactionPressed(),this._enableHaptics&&l.default.triggerFeedback()}_positionDrawer(e,t){if(this._onPositionDrawer(e,t),!this._animatedStylesInitialized)return void this._maybeInitAnimatedStyles(t);const i=this._animatedValues(t);this._animatedTransformValue&&this._animatedOpacityValue&&(e?(this._drawerAnimation=o.Animated.parallel([h.default.timing(this._animatedTransformValue,{toValue:i.top,easing:o.Animated.Easing.Out(),duration:150,useNativeDriver:!0}),h.default.timing(this._animatedOpacityValue,{toValue:i.opacity,easing:o.Animated.Easing.Out(),duration:150,useNativeDriver:!0})]),this._drawerAnimation.start((e=>{this._onPositionDrawerAnimationCompleted()}))):(this._animatedTransformValue.setValue(i.top),this._animatedOpacityValue.setValue(i.opacity)))}_renderReactionViews(e){const t=(0,a.jsx)(c.default,{style:m.closeIcon,size:S.IconSize.size24,icon:S.SkypeIcon.Cancel,color:g.Color.white,hoverColor:g.Color.white,title:u.getString("ReactionsStream.ReactionBarCloseDrawerTitle"),onPress:this._onToggleOpen},"close");return n.compact([...e,t])}_maybeInitAnimatedStyles(e){if(!this._animatedStylesInitialized){const t=this._animatedValues(e);this._animatedTransformValue=new o.Animated.Value(t.top),this._animatedOpacityValue=new o.Animated.Value(t.opacity),this._animatedStyle=o.Styles.createAnimatedViewStyle({opacity:this._animatedOpacityValue,transform:[{translateY:this._animatedTransformValue}]}),this._animatedStylesInitialized=!0}}_animatedValues(e){return{top:e.isOpen?0:this._drawerSize(),opacity:e.isOpen?1:0}}_drawerSize(){return 70+this.props.bottomSafeAreaInset}render(){const e=[m.container];this._animatedStyle&&e.push(this._animatedStyle);const t=[m.innerContainer];return p.default.hasHorizontalSafeAreas(this.props.horizontalInsets)&&t.push(p.default.horizontalPaddingStyle(this.props.horizontalInsets)),this._isRTL&&t.push(m.innerContainerRTL),this.props.bottomSafeAreaInset&&(e.push(p.default.heightStyle(this._drawerSize())),t.push(p.default.paddingBottomStyle(this.props.bottomSafeAreaInset))),(0,a.jsx)(o.Animated.View,Object.assign({style:e},{children:(0,a.jsx)(o.View,Object.assign({style:t},{children:this._renderContent()}))}))}}t.default=y},309399:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(48777),o=i(374049);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(n.default,{callId:this.props.callId,conversationMri:this.props.conversationMri,textStyle:o.CommonToastStyles.titleStyle,linkStyle:o.CommonToastStyles.linkStyle})}}t.default=s},428493:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStackNavCallMediaCapturerToast=t.RemoteStackNavCallMediaCapturerToast=void 0;const a=i(785893),n=i(217041),o=i(121936),s=i(767332),r=i(163841),l=i(581760),c=i(711828);class d extends n.ComponentBase{render(){const e=[{icon:c.SkypeIcon.CallRemoteNdiRecord,color:l.Color.white}];return(0,a.jsx)(s.RemoteStackNavPrivacyToast,{conversationMri:this.props.conversationMri,initiatorMri:this.props.initiatorMri,topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,notificationTextPath:"CallMediaCapturerToast.NotificationText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedAccessibilityLabel",icons:e,style:this.props.style})}}t.RemoteStackNavCallMediaCapturerToast=d;class u extends n.ComponentBase{constructor(){super(...arguments),this._getTimestamp=()=>{},this._onStopPress=()=>{o.default.setNdiEnabled(!1)}}render(){return(0,a.jsx)(s.LocalStackNavPrivacyToast,{topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,onStopPress:this._onStopPress,getTimestamp:this._getTimestamp,colorThemeOverride:r.Theme.ColorfulDark,privacyStatementTextPath:"CallMediaCapturerToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallMediaCapturerToast.MorePrivacyInfoLinkText",stopLinkTextPath:"CallMediaCapturerToast.StopLinkText",startedAccessibilityLabelTextPath:"CallMediaCapturerToast.StartedInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallMediaCapturerToast.StoppedInitiatorAccessibilityLabel",style:this.props.style})}}t.LocalStackNavCallMediaCapturerToast=u},333778:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(217041),o=i(994224),s=i(767332),r=i(163841),l=i(581760),c=i(711828);class d extends n.ComponentBase{constructor(){super(...arguments),this._getTimestamp=()=>o.default.CallingStore.getCallRecordingTimestamp(this.props.callId)}_buildState(e,t){const i=o.default.CallingStore.getCallRecordingInitiator(e.callId);return{initiatorMri:i,isLocalInitiator:o.default.InCallBotUtils.isCallRecordingInitiator(i)}}render(){if(this.state.initiatorMri&&this.state.isLocalInitiator)return(0,a.jsx)(s.LocalStackNavPrivacyToast,{topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,onStopPress:this.props.onPress,getTimestamp:this._getTimestamp,colorThemeOverride:r.Theme.ColorfulDark,privacyStatementTextPath:"CallRecorderToast.PrivacyStatementText",morePrivacyInfoLinkTextPath:"CallRecorderToast.RecordingInitiatorMorePrivacyInfoLinkText",stopLinkTextPath:"CallRecorderToast.StopRecordingLinkText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingInitiatorAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingInitiatorAccessibilityLable",style:this.props.style});const e=[{icon:c.SkypeIcon.CallRecordStroke,color:l.Color.white},{icon:c.SkypeIcon.CallRecordDot,color:l.Color.red}];return(0,a.jsx)(s.RemoteStackNavPrivacyToast,{conversationMri:this.props.conversationMri,initiatorMri:this.state.initiatorMri,topInset:this.props.topInset,viewWidth:this.props.viewWidth,onDesiredHeightChanged:this.props.onDesiredHeightChanged,notificationTextPath:"CallRecorderToast.IsRecordingText",initialNotficationTextPath:"CallRecorderToast.StartingRecordingText",startedAccessibilityLabelTextPath:"CallRecorderToast.StartedRecordingAccessibilityLabel",stoppedAccessibilityLabelTextPath:"CallRecorderToast.StoppedRecordingAccessibilityLabel",icons:e,style:this.props.style})}}t.default=d},690089:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(163841),o=i(389324),s=i(374049);class r extends s.StackNavHeightBasedToast{_getContainerStyle(){return s.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(o.default,{closeToast:this.props.closeToast,colorThemeOverride:n.Theme.ColorfulDark})}}t.default=r},376835:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(934501),o=i(374049);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(n.default,{toastType:this.props.type,textStyle:o.CommonToastStyles.titleStyle,conversationMri:this.props.conversationMri,onDismiss:this.props.closeToast,callId:this.props.callId,isUsingStackNavigation:!0})}}t.default=s},374049:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StackNavHeightBasedToast=t.CommonToastStyles=void 0;const a=i(785893),n=i(516778),o=i(217041),s=i(915877),r=i(581760),l=i(311010),c=(0,s.lazyProperties)({hidden:()=>n.Styles.createViewStyle({opacity:0})});t.CommonToastStyles=(0,s.lazyProperties)({titleStyle:()=>n.Styles.createTextStyle({color:r.Color.white,font:l.default.font.uiDisplayBold,fontSize:l.default.controlFontSize.subtitle}),linkStyle:()=>n.Styles.createTextStyle({color:r.Color.sxBlue,font:l.default.font.uiDisplayBold,fontSize:l.default.controlFontSize.smallButton}),container:()=>n.Styles.createViewStyle({paddingLeft:10,paddingRight:10,paddingVertical:10,backgroundColor:r.Color.gray400Overlay70})});class d extends o.ComponentBase{constructor(){super(...arguments),this.onLayout=e=>{const t=this.props.topInset,i=e.height-(t||0);i!==this.state.desiredHeight&&this.setState({desiredHeight:i,initialLayoutComplete:!0})}}_buildState(e,t){const i={};return t&&(i.initialLayoutComplete=!1,i.desiredHeight=0),i}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}componentWillUnmount(){super.componentWillUnmount(),this.props.onDesiredHeightChanged(0)}render(){const e=[this._getContainerStyle()];return this.props.topInset&&e.push(n.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.props.style&&e.push(this.props.style),this.state.initialLayoutComplete||e.push(c.hidden),(0,a.jsx)(n.View,Object.assign({style:e,onLayout:this.onLayout},{children:this._renderContent()}))}}t.StackNavHeightBasedToast=d},254594:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(46767),o=i(374049);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(n.default,{callId:this.props.callId,textStyle:o.CommonToastStyles.titleStyle,linkStyle:o.CommonToastStyles.linkStyle})}}t.default=s},424431:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(333643),o=i(374049);class s extends o.StackNavHeightBasedToast{_getContainerStyle(){return o.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(n.default,{callId:this.props.callId,conversationMri:this.props.conversationMri,isEncryptedCall:this.props.isEncryptedCall,isPSTNCall:this.props.isPSTNCall,textStyle:o.CommonToastStyles.titleStyle,linkStyle:o.CommonToastStyles.linkStyle})}}t.default=s},767332:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStackNavPrivacyToast=t.RemoteStackNavPrivacyToast=void 0;const a=i(785893),n=i(516778),o=i(561541),s=i(944973),r=i(952262),l=i(913944),c=i(915877),d=i(733754),u=i(451070),h=i(581760),p=i(711828),g=i(619675),C=i(711930),S=(i(680837),i(590602)),m=i(267824),y=i(889391),f=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",paddingLeft:10,paddingRight:10,paddingVertical:10,backgroundColor:h.Color.gray400Overlay70}),contentContainer:()=>n.Styles.createViewStyle({flex:1,marginLeft:10,paddingTop:4}),hiddenContainer:()=>n.Styles.createViewStyle({opacity:0}),titleContainer:()=>n.Styles.createViewStyle({flexDirection:"row",flex:1}),privacyStatementContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingTop:5}),privacyStatementTextContainer:()=>n.Styles.createViewStyle({flex:1,marginRight:5}),statusTextStyle:()=>n.Styles.createTextStyle({flex:1,paddingHorizontal:10}),textStyle:()=>n.Styles.createTextStyle({color:h.Color.white}),linkStyle:()=>n.Styles.createTextStyle({color:h.Color.sxBlue})});class b extends o.RemoteBaseCallRecorderToast{constructor(){super(...arguments),this._onLayout=e=>{const t=e.height-(this.props.topInset||0);t!==this.state.desiredHeight&&this.setState({desiredHeight:t,initialLayoutComplete:!0})}}_buildState(e,t){const i=u.default.horizontalPaddingStyle(),a={initiatorDisplayName:e.initiatorMri?r.default.getMemberShortNameForConversation(e.conversationMri,e.initiatorMri):void 0,horizontalPaddingStyle:i};return t&&(a.initialLayoutComplete=!1,a.desiredHeight=0),a}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}render(){const e=[f.container];this.state.horizontalPaddingStyle&&e.push(this.state.horizontalPaddingStyle),this.props.topInset&&e.push(n.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.props.style&&e.push(this.props.style),this.state.initialLayoutComplete||e.push(f.hiddenContainer);const t=(0,a.jsx)(s.default,{icons:this.props.icons});let i;const o=[f.titleContainer,n.Styles.createViewStyle({maxWidth:this.props.viewWidth-55},!1)];let r;return this.state.initiatorDisplayName?r=d.getString(this.props.notificationTextPath,{name:this.state.initiatorDisplayName}):this.props.initialNotficationTextPath&&(r=d.getString(this.props.initialNotficationTextPath)),r&&(i=(0,a.jsx)(n.View,Object.assign({style:o},{children:(0,a.jsx)(g.Subtitle,Object.assign({style:f.textStyle},{children:r}))}))),(0,a.jsxs)(n.View,Object.assign({style:e,onLayout:this._onLayout},{children:[t,(0,a.jsx)(n.View,Object.assign({style:f.contentContainer},{children:i}))]}))}}t.RemoteStackNavPrivacyToast=b;class _ extends o.LocalBaseCallRecorderToast{constructor(){super(...arguments),this._onLayout=e=>{const t=e.height-(this.props.topInset||0);t!==this.state.desiredHeight&&this.setState({desiredHeight:t,initialLayoutComplete:!0})}}_buildState(e,t){const i=u.default.horizontalPaddingStyle(),a=y.default.getConfigSettingsNoSubscription().skypeGoLinks.privacyAndCookies,n={horizontalPaddingStyle:i,recordingTimestamp:e.getTimestamp(),privacyLinkUrl:a};return t&&(n.showPrivacyLink=!0,n.initialLayoutComplete=!1,n.desiredHeight=0),n}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.desiredHeight!==t.desiredHeight&&this.props.onDesiredHeightChanged(t.desiredHeight)}render(){const e=[{icon:p.SkypeIcon.CallRecordStroke,color:h.Color.white},{icon:p.SkypeIcon.CallRecordDot,color:h.Color.red}],t=[f.container];this.state.horizontalPaddingStyle&&t.push(this.state.horizontalPaddingStyle),this.props.topInset&&t.push(n.Styles.createViewStyle({paddingTop:this.props.topInset},!1)),this.props.style&&t.push(this.props.style),this.state.initialLayoutComplete||t.push(f.hiddenContainer);const i=(0,a.jsx)(n.View,Object.assign({onPress:this._onStopPress},{children:(0,a.jsx)(s.default,{icons:e})})),o=(0,a.jsxs)(n.View,Object.assign({style:f.titleContainer},{children:[(0,a.jsx)(g.Subtitle,Object.assign({style:f.textStyle},{children:this._getElapsedTime()})),(0,a.jsx)(n.Button,Object.assign({onPress:this._onStopPress},{children:(0,a.jsx)(g.Subtitle,Object.assign({style:[f.statusTextStyle,f.linkStyle]},{children:d.getString(this.props.stopLinkTextPath)}))}))]}));let r;if(this.state.showPrivacyLink){const e=[f.privacyStatementTextContainer,n.Styles.createViewStyle({maxWidth:this.props.viewWidth-80},!1)],t=d.getString(this.props.morePrivacyInfoLinkTextPath),i=d.getParts(this.props.privacyStatementTextPath,{learnMoreLink:this._getPrivacyLink(t)}),o=C.default.linkAccessibilityInfo(d.getString(this.props.privacyStatementTextPath,{learnMoreLink:t}));r=(0,a.jsxs)(n.View,Object.assign({style:f.privacyStatementContainer},{children:[(0,a.jsx)(n.View,Object.assign({style:e,accessibilityLabel:o.label,accessibilityTraits:o.traits,importantForAccessibility:void 0,onPress:this._onMorePrivacyInfoPress},{children:(0,a.jsx)(g.Caption,Object.assign({style:S.default.subtitleMediumSemiLarge},{children:i}))})),(0,a.jsx)(l.default,{icon:p.SkypeIcon.ClosePanel,size:p.IconSize.size20,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.primaryIconColor,title:d.getString("Global.CloseButtonTitle"),onPress:this._onDismissPrivacyInfoPress})]}))}return(0,a.jsxs)(n.View,Object.assign({style:t,onLayout:this._onLayout},{children:[i,(0,a.jsxs)(n.View,Object.assign({style:f.contentContainer},{children:[o,r]}))]}))}_getPrivacyLink(e){return(0,a.jsx)(m.AccessibleLink,Object.assign({url:this.state.privacyLinkUrl,textElement:g.Caption,correctiveMargin:-3},{children:e}),"recordingPrivacyNote")}}t.LocalStackNavPrivacyToast=_},191018:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(110117),s=i(915877),r=i(733754),l=i(374049),c=i(581760),d=i(711828),u=i(619675),h=(0,s.lazyProperties)({containerstyle:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center"}),titleStyle:()=>n.Styles.createTextStyle({paddingLeft:7})});class p extends l.StackNavHeightBasedToast{_getContainerStyle(){return l.CommonToastStyles.container}_renderContent(){return(0,a.jsxs)(n.View,Object.assign({style:h.containerstyle},{children:[(0,a.jsx)(o.default,{icon:d.SkypeIcon.MicrophoneOff,size:d.IconSize.size14,color:c.Color.white}),(0,a.jsx)(u.BodyText,Object.assign({style:[l.CommonToastStyles.titleStyle,h.titleStyle],numberOfLines:1},{children:r.getString("CallPanel.MicrophoneServerMuted")}))]}))}}t.default=p},884449:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(374049),o=i(266318);class s extends n.StackNavHeightBasedToast{_getContainerStyle(){return n.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(o.default,{textStyle:n.CommonToastStyles.titleStyle,conversationMri:this.props.conversationMri,onDismiss:this.props.closeToast})}}t.default=s},297016:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(374049),o=i(237191);class s extends n.StackNavHeightBasedToast{_getContainerStyle(){return n.CommonToastStyles.container}_renderContent(){return(0,a.jsx)(o.default,{callId:this.props.callId,textStyle:n.CommonToastStyles.titleStyle,linkStyle:n.CommonToastStyles.linkStyle,conversationMri:this.props.conversationMri})}}t.default=s},662038:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(677381),r=i(79669);class l extends s.default{constructor(){super(...arguments),this._checkIfContentDimensionsChanged=()=>{if(n.isUndefined(this._popupRef))return;const e=this._popupRef.getBoundingClientRect();n.isUndefined(this.state.prevContentRect)||Math.round(this.state.prevContentRect.width)===Math.round(e.width)&&Math.round(this.state.prevContentRect.height)===Math.round(e.height)||this.props.onContentDimensionsChanged&&this.props.onContentDimensionsChanged(),this.setState({prevContentRect:e})},this._onPopupRef=e=>{this._popupRef=e||void 0}}_buildState(e,t){const i={};return t&&(i.prevContentRect=void 0),i}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._checkIfContentDimensionsChanged()}render(){return(0,a.jsx)("div",Object.assign({ref:this._onPopupRef},{children:(0,a.jsx)(r.default,Object.assign({anchorPosition:this.props.anchorPosition,anchorOffset:this.props.anchorOffset,popupWidth:this.props.popupWidth,popupHeight:this.props.popupHeight,fillColor:this.props.fillColor,strokeColor:this.props.strokeColor,popupAccessibilityTitle:this.props.popupAccessibilityTitle,offset:this.props.offset},{children:(0,a.jsx)(o.View,Object.assign({style:this.props.style},{children:this.props.renderContent()}))}))}))}}t.default=l},712305:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallsListSection=void 0;const a=i(785893),n=i(705465),o=i(667294),s=i(281878),r=i(746096),l=i(694622),c=i(853374),d=i(491632),u=i(37034),h=i(598925),p=i(898278),g=i(532514),C=i(633896),S=i(994460),m=i(111612),y=n.StyleSheet.create({flexOne:{flex:1}});t.CallsListSection=(0,o.forwardRef)((({showEmptyIllustration:e,emptyStateEmoticon:t,emptyStateHeader:i,categoryFilter:n,searchGroups:f,onScroll:b,handleResultsCountChange:_,topInset:T},v)=>{const w=(0,o.useMemo)((()=>new g.default),[]),I=(0,o.useCallback)(((e,t)=>function(e,t,i){const a=c.default.newCauseId();d.Instrumentation.log(r.LogTraceArea.QuickCallPanel,`[CallsListSection][handleCallListItemClick][${a}]list item was clicked`),d.Instrumentation.track(new C.CallTabsListTelemetry(e,S.ButtonEvents.Press));const n=e===S.Tab.Calls?r.NavigationCallOrigin.CallsTab:r.NavigationCallOrigin.PhoneTab;u.default.startCallOrMaybePrompt((()=>t),p.MainRootViewId,{skypeMri:i,inviteOrigin:r.ContactInviteOrigin.CallPanelSearch,userIntent:h.StartCallOrMaybePromptUserIntent.Generic,callOrigin:n},a)}(n,e,t)),[n]),P=n===S.Tab.Calls,M=n===S.Tab.Phone,k=e&&!!t,A=M?r.SearchResultsListOrigin.PhoneTabPanel:r.SearchResultsListOrigin.CallsTabPanel;return(0,a.jsxs)(s.Column,Object.assign({style:y.flexOne},{children:[(0,a.jsx)(s.Box,Object.assign({flexGrow:k?"0":"1",flexBasis:T?`${T}`:"auto"},{children:(0,a.jsx)(l.SearchResultsList,{ref:v,searchResultGroups:f,searchController:w,origin:A,onScroll:b,excludePstn:P,onlyPstn:M,onListItemClick:I,onResultsCountChange:_,hasCallIcons:!0,topInset:T,emptyStateDisplayed:k})})),k&&(0,a.jsx)(s.Box,Object.assign({flexGrow:1},{children:(0,a.jsx)(m.IllustrationScreen,{emoticon:t,topSlot:i},"noCallsItem")}))]}))})),t.default=t.CallsListSection},98198:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getResultListMode=void 0;const a=i(994460),n=i(746096),o={zeroInputSearchSkypeCalls:[{groupType:n.SearchResultsListGroup.RecentCalls},{groupType:n.SearchResultsListGroup.SuggestedFrequentConversations},{groupType:n.SearchResultsListGroup.CombinedContactsWithoutAlphaHeaders}],zeroInputSearchPhoneCalls:[{groupType:n.SearchResultsListGroup.RecentCalls},{groupType:n.SearchResultsListGroup.AllPeopleWithPhoneNumbers}]};t.getResultListMode=e=>e===a.Tab.Calls?o.zeroInputSearchSkypeCalls:o.zeroInputSearchPhoneCalls},769840:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(166454),o=i(980449);t.default=function({maxHeight:e,scrollTop:t,children:i}){return(0,a.jsx)(o.default,Object.assign({top:52},{children:(0,a.jsx)(n.Sliding,Object.assign({value:t,valueFrom:0,valueTo:40,maxSlideValue:-60},{children:(0,a.jsx)(n.CollapsibleRow,Object.assign({value:t,valueFrom:40,valueTo:155,maxHeight:e},{children:i}))}))}))}},545248:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(281878),o=i(667294),s=i(705465),r=i(733754),l=i(905616),c=i(711828),d=i(898278),u=i(581760),h=i(258187),p=i(104735),g=i(660198),C=i(889391),S=i(436237),m=i(633896),y=i(994460),f=i(450005),b=i(814806),_=i(904604),T=i(171354),v=i(980449),w=i(166454),I=s.StyleSheet.create({scrollViewContentContainer:{flexGrow:1,justifyContent:"flex-start",alignItems:"stretch",minWidth:"100%",gap:8,paddingHorizontal:12}});t.default=(0,g.WithResub)((function({onHeightChange:e,ecs:t,pathsRequiringHeaders:i,stratusHost:g,scrollTop:C,userHasEntitlements:_}){const P=(0,h.useCommonContext)(),[M,k]=(0,o.useState)();return(0,a.jsx)(v.default,Object.assign({top:52},{children:(0,a.jsx)(w.Sliding,Object.assign({value:C,valueFrom:0,valueTo:220,maxSlideValue:-300},{children:(0,a.jsxs)(n.Column,Object.assign({onLayout:t=>{const{height:i}=t.nativeEvent.layout;void 0===M&&k(i),null==e||e(i)}},{children:[(0,a.jsx)(T.CreditBarSection,{}),(0,a.jsxs)(s.ScrollView,Object.assign({horizontal:!0,showsHorizontalScrollIndicator:!1,contentContainerStyle:I.scrollViewContentContainer},{children:[(0,a.jsx)(l.default,{title:r.getString("CallTab.InternationalCall"),subtitle:r.getString("CallTab.InternationalCallSubtitle"),icon:c.SkypeIcon.Globe,buttonStyle:d.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:u.AgnosticGradientFillButtonColors.darkPurple,onPress:()=>{S.track(new m.CallTabsButtonsTelemetry(y.Tab.Phone,y.Buttons.SkypeToPhone,y.ButtonEvents.Press,_)),p.default.navigateToBalanceStatePanel("PhoneTab.ButtonSection.SkypeToPhone",P.rootViewId)}},"phoneTabSkypeToPhone"),(0,a.jsx)(l.default,{title:r.getString("CallTab.SkypeCredit"),subtitle:r.getString("CreditExpiration.CallButtonLabel"),icon:c.SkypeIcon.Money,buttonStyle:d.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:u.AgnosticGradientFillButtonColors.mediumBlue,onPress:()=>{S.track(new m.CallTabsButtonsTelemetry(y.Tab.Phone,y.Buttons.SkypeCredit,y.ButtonEvents.Press,_)),p.default.navigateToBalanceStatePanel("PhoneTab.ButtonSection.SkypeCredit",P.rootViewId)}},"phoneTabSkypeCredit"),(0,a.jsx)(l.default,{title:r.getString("CallTab.SkypeNumberPretitle"),subtitle:r.getString("CallTab.SkypeNumberSubtitle"),icon:c.SkypeIcon.Call,buttonStyle:d.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:u.AgnosticGradientFillButtonColors.darkGreen,onPress:()=>{S.track(new m.CallTabsButtonsTelemetry(y.Tab.Phone,y.Buttons.SkypeNumber,y.ButtonEvents.Press,_)),(0,f.runSkypeNumberPurchaseFlow)({location:b.Location.PhoneTab,rootViewId:P.rootViewId,ecs:t,pathsRequiringHeaders:i,stratusHost:g,context:P})}},"phoneTabSkypeNumber")]}))]}))}))}))}),(e=>{const t=C.default.getS4LCommerceFeatures(),{newBuyCreditExperience:i,skypeNumber:a,webConfig:n}=t,{enableNewCallsCreditOffers:o}=C.default.getS4LMessagingFeatures();return Object.assign(Object.assign({},e),{clientCurrencyFormatting:i.useClientFormattingForCurrencies,ecs:a,pathsRequiringHeaders:n.pathsRequiringHeaders,stratusHost:C.default.getConfigSettings().secureStratus.host,enableNewCallsCreditOffers:o,userHasEntitlements:_.default.userHasActiveEntitlements()})}))},905616:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(583367),s=i(22222),r=i(680837),l=i(311010),c=i(898278),d=i(915877),u=i(29130),h=i(677381),p=i(359753),g=(0,d.lazyProperties)({button:()=>n.Styles.createButtonStyle({flexGrow:1,flexShrink:1,flexBasis:0,borderRadius:8}),buttonLandscape:()=>n.Styles.createButtonStyle({maxWidth:200}),buttonText:()=>n.Styles.createTextStyle({font:l.default.font.uiDisplayBold,fontSize:14,lineHeight:18,fontWeight:c.FontWeight.bold}),textLeft:()=>n.Styles.createTextStyle({textAlign:"left"}),textRight:()=>n.Styles.createTextStyle({textAlign:"right"}),innerContainer:()=>n.Styles.createViewStyle({flex:1,minWidth:160,borderRadius:8,paddingHorizontal:16,paddingBottom:16,justifyContent:"flex-end",alignItems:"flex-start"}),innerContainerLandscape:()=>n.Styles.createViewStyle({flex:1,width:200,borderRadius:8,paddingHorizontal:16,paddingBottom:10,justifyContent:"flex-end",alignItems:"stretch"})});function C({pretitle:e,title:t,subtitle:i,icon:o,buttonStyle:l,agnosticGradientColor:c,onPress:d,isLandscape:u,colorInfoOverride:h}){const C=(0,p.useLocalization)(),S=n.Styles.combine([u?g.innerContainerLandscape:g.innerContainer]),m=C.isRTL?g.textRight:g.textLeft;return(0,a.jsx)(s.default,{onPress:d,pretitle:e,title:t,subtitle:i,backgroundIcon:o,textStyleOverride:[g.buttonText,m],style:n.Styles.combine([g.button,r.default.shadowLightStyle,u?g.buttonLandscape:void 0]),buttonStyle:l,agnosticGradientColor:c,colorInfoOverride:h,innerContainerStyle:S,maxTitleWidth:u?200:160,allowTextWrap:!0,backgroundStyle:{height:void 0,paddingLeft:void 0,paddingRight:void 0}})}class S extends h.default{_buildState(){const e=this._getRootViewId();return{isLandscape:u.default.getDeviceOrientation(e)===o.DeviceOrientation.Landscape}}render(){return(0,a.jsx)(C,{pretitle:this.props.pretitle,title:this.props.title,subtitle:this.props.subtitle,icon:this.props.icon,buttonStyle:this.props.buttonStyle,agnosticGradientColor:this.props.agnosticGradientColor,onPress:this.props.onPress,colorInfoOverride:this.props.colorInfoOverride,isLandscape:this.state.isLandscape})}}t.default=S},442340:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(667294),s=i(705465),r=i(281878),l=i(967593),c=i(913944),d=i(711828),u=i(600212),h=i(110117),p=i(660198),g=i(904604),C=i(739119),S=i(311010),m=i(733754),y=i(104735),f=i(258187),b=i(569381),_=i(853374),T=i(491632),v=i(516283),w=i(633896),I=i(994460);t.default=(0,p.WithResub)(n.memo((({creditEntitlement:e,subscriptions:t})=>{const i=(0,f.useCommonContext)(),{gradients:n,mode:p,themeColors:g}=(0,u.useSkypeTheme)(),P=(0,r.useSUIThemeStyles)((e=>({innerContainer:{backgroundColor:e.colors.surfacePrimary,borderRadius:10,margin:2},gradient:{borderRadius:12,flexGrow:1,flexShrink:1},container:{paddingHorizontal:20},creditIcon:{color:e.colors.iconPrimary,alignSelf:"center",marginRight:5},iconButtonStyle:{height:20},balanceText:{fontSize:S.default.fontSize.size14,lineHeight:20,color:e.colors.textPrimary}})),[]),M=e&&C.getFormattedBalance(e)||"0",k=t.length>0,A=(0,o.useCallback)((()=>{const a=_.default.newCauseId();T.Instrumentation.log(v.LogTraceArea.Navigation,`CreditBarSection.navigateToBalanceStatePanel, causeId: ${a}`);const n=C.hasActiveSubscriptions(t)||C.hasUsableCredit(e);T.Instrumentation.track(new w.CallTabsButtonsTelemetry(I.Tab.Phone,I.Buttons.CreditBar,I.ButtonEvents.Press,n)),y.default.navigateToBalanceStatePanel("PhoneTab.CreditBar",i.rootViewId,void 0,void 0,a)}),[i.rootViewId,t,e]),R=p.isAccessible?[g.strokeHighContrast,g.strokeHighContrast]:n.secondary;return(0,a.jsx)(r.Row,Object.assign({marginY:4,marginX:3},{children:(0,a.jsx)(l.GradientView,Object.assign({direction:l.GradientDirection.TOP_LEFT,colors:R,style:P.gradient},{children:(0,a.jsxs)(r.Box,Object.assign({style:P.innerContainer,paddingY:3,paddingX:4},{children:[(0,a.jsxs)(r.Row,Object.assign({alignContent:"center",justifyContent:"space-between"},{children:[(0,a.jsx)(r.Column,Object.assign({w:"5/6"},{children:(0,a.jsxs)(r.Row,Object.assign({alignItems:"center",alignContent:"center",flexGrow:1},{children:[(0,a.jsx)(h.default,{icon:d.SkypeIcon.Money,size:d.IconSize.size14,color:P.creditIcon.color,style:P.creditIcon}),(0,a.jsx)(s.Text,Object.assign({style:P.balanceText},{children:m.getString("QuickCallPanel.CreditBarBallance",{amount:M})}))]}))})),(0,a.jsx)(r.Column,{children:(0,a.jsx)(c.default,{icon:d.SkypeIcon.MoreVertical,size:d.IconSize.size16,color:g.iconPrimary,onPress:A,style:P.iconButtonStyle})})]})),k&&(0,a.jsx)(b.SubscriptionsList,{subscriptions:t})]}))}))}))})),(()=>({creditEntitlement:g.default.getCreditEntitlement(),subscriptions:g.default.getSubscriptions()})))},436305:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionItem=void 0;const a=i(785893),n=i(667294),o=i(281878),s=i(705465),r=i(733754),l=i(50831),c=i(311010),d=i(210108),u=i(600212),h=i(267824),p=i(31280);t.SubscriptionItem=({subscription:e,onPress:t})=>{const{gradients:i,mode:g,themeColors:C}=(0,u.useSkypeTheme)(),S=(0,o.useSUIThemeStyles)((e=>({text:{fontSize:c.default.fontSize.size12,lineHeight:16,color:e.colors.textPrimary},upgrade:{fontSize:c.default.fontSize.size12,lineHeight:16,marginLeft:4}})),[]),m=(0,d.getSubscriptionCountryName)(e),y=(0,n.useCallback)((()=>{null==t||t(e)}),[t,e]),f=!e.isUnlimited&&(e.availableMinutes||0)<5,b=g.isAccessible?[C.strokeHighContrast,C.strokeHighContrast]:i.secondary;return(0,a.jsx)(o.Column,Object.assign({marginBottom:3},{children:(0,a.jsxs)(s.Pressable,Object.assign({onPress:y},{children:[(0,a.jsxs)(o.Row,Object.assign({justifyContent:"space-between"},{children:[(0,a.jsx)(p.Caption,Object.assign({style:S.text},{children:m})),(0,a.jsxs)(o.Row,{children:[void 0!==e.availableMinutes&&void 0!==e.totalMinutes&&!e.isUnlimited&&(0,a.jsx)(p.Caption,Object.assign({style:S.text},{children:r.getString("QuickCallPanel.CreditBarNumberOfMinutes",{current:e.availableMinutes,total:e.totalMinutes})})),e.isUnlimited&&(0,a.jsx)(p.Caption,Object.assign({style:S.text},{children:r.getString("QuickCallPanel.CreditBarUnlimited")})),f&&(0,a.jsx)(h.Link,Object.assign({url:"",style:S.upgrade,onPress:y},{children:r.getString("QuickCallPanel.CreditBarUpgrade")}))]})]})),(0,a.jsx)(o.Row,Object.assign({marginTop:1},{children:(0,a.jsx)(l.ProgressBar,{value:e.isUnlimited?1:e.availableMinutes||0,totalValue:e.isUnlimited?1:e.totalMinutes||0,gradientColors:b})}))]}))}))}},569381:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionsList=void 0;const a=i(785893),n=i(667294),o=i(667294),s=i(281878),r=i(733754),l=i(436305),c=i(311010),d=i(258187),u=i(956002),h=i(31280),p=i(660198),g=i(334387),C=i(889391);t.SubscriptionsList=(0,p.WithResub)(n.memo((({subscriptions:e,displayLimit:t=2,shouldUseGPlayBilling:i,callingSubscriptionFeatures:n,commerceConfig:p})=>{const g=(0,d.useCommonContext)(),[C,S]=(0,o.useReducer)((e=>!e),!1),m=(0,s.useSUIThemeStyles)((e=>({text:{fontSize:c.default.fontSize.size12,lineHeight:16,color:e.colors.textSecondary}})),[]),y=(0,o.useCallback)((e=>{(0,u.handleSubscriptionDetailPress)(e,g.rootViewId,i,p,n)}),[g.rootViewId,p,n,i]),f=C?r.getString("QuickCallPanel.CreditBarShowLess"):r.getString("QuickCallPanel.CreditBarShowMore");return(0,a.jsxs)(s.Column,Object.assign({paddingTop:3},{children:[e.map(((e,i)=>!C&&i>=t?null:(0,a.jsx)(l.SubscriptionItem,{subscription:e,onPress:y},`${e.id}-${i}`))),e.length>t&&(0,a.jsx)(h.BodyText,Object.assign({style:m.text,onPress:S},{children:f}))]}))})),(e=>({subscriptions:e.subscriptions,displayLimit:e.displayLimit,shouldUseGPlayBilling:g.default.shouldUseGooglePlayBillingForSubscriptions(),commerceConfig:C.default.getS4LCommerceFeatures(),callingSubscriptionFeatures:C.default.getS4LEntitlementFeatures().SCE.CallingSubscriptions.Features})))},210108:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSubscriptionCountryName=void 0;const a=i(904604),n=i(733754);t.getSubscriptionCountryName=function(e){var t;let i=a.default.subscriptionHasLocalizedName(e)&&(null===(t=e.data)||void 0===t?void 0:t.nameFormatted)||n.getString("Entitlements.DefaultSubscriptionName");const o=i.split(" ");return o.length>3&&(i=`${o.slice(0,3).join(" ")}...`),i}},171354:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CreditBarSection=void 0;const a=i(442340);t.CreditBarSection=a.default},956002:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.handleSubscriptionDetailPress=void 0;const a=i(231657),n=i(491632),o=i(746096),s=i(37802),r=i(404057),l=i(640363);t.handleSubscriptionDetailPress=function(e,t,i,c,d){n.Instrumentation.log(o.LogTraceArea.SubscriptionDataSection,`credit bar handleSubscriptionDetailPress subscription id ${e.id}`),n.Instrumentation.track(new s.SubscriptionDetailsLinkClick(e.id));const u=c.nativeProducts.manageSubscription,h=u.apple.subscriptionPlanRegExp,p=u.gPlay.subscriptionPlanRegExp,g=u.apple.enabled,C=u.gPlay.enabled;g||n.Instrumentation.log(o.LogTraceArea.SubscriptionDataSection,"iOS manageable subscriptions disabled."),C||n.Instrumentation.log(o.LogTraceArea.SubscriptionDataSection,"GPlay manageable subscriptions disabled.");const S=!!function(e,t){let i;try{i=new RegExp(e)}catch(e){const t=r.default.asString(e);return n.Instrumentation.error(o.LogTraceArea.SubscriptionDataSection,t),void n.Instrumentation.track(new s.EntitlementIntegrationError("ios_plan_regexp",t))}const a=t&&t.plan;if(!a){const e=`No plan information: ${r.default.asString(t)}`;return n.Instrumentation.error(o.LogTraceArea.SubscriptionDataSection,e),void n.Instrumentation.track(new s.EntitlementIntegrationError("plan_missing",e))}return i.test(a)}(h,e.attributes),m=!!function(e,t){let i;try{i=new RegExp(e)}catch(e){const t=r.default.asString(e);return n.Instrumentation.error(o.LogTraceArea.SubscriptionDataSection,t),void n.Instrumentation.track(new s.EntitlementIntegrationError("gplay_plan_regexp",t))}const a=t&&t.plan;if(!a){const e=`No plan information: ${r.default.asString(t)}`;return n.Instrumentation.error(o.LogTraceArea.SubscriptionDataSection,e),void n.Instrumentation.track(new s.EntitlementIntegrationError("plan_missing",e))}return i.test(a)}(p,e.attributes),y=d.ManageSubscriptionsUXImprovements||function(e,t){let i=!1;if(t){if(e){const e=l.default.getPlatformType();i=[o.PlatformType.iOS,o.PlatformType.OSX].includes(e)}else i=!1;n.Instrumentation.log(o.LogTraceArea.SubscriptionDataSection,`Result: ${i}`)}return i}(g,S)||function(e,t){let i=!1;t&&(i=e,n.Instrumentation.log(o.LogTraceArea.SubscriptionDataSection,`Result: ${i}`));return i}(C,m)||function(e,t){n.Instrumentation.log(o.LogTraceArea.SubscriptionDataSection,`Check is manageable subscription: ${r.default.asString(t)}`);const i=!e;return n.Instrumentation.log(o.LogTraceArea.SubscriptionDataSection,`Result: ${i}`),i}(i,e.attributes);a.default.showDialog({isManageAble:y,commerceConfig:c,appleInAppSubscription:S,gplayInAppSubscription:m,subscription:e},t)}},606450:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MinorProtectionBanner=void 0;const a=i(785893),n=i(667294),o=i(667294),s=i(281878),r=i(733754),l=i(31280),c=i(311010),d=i(898278),u=i(660198),h=i(889391),p=i(37802),g=i(540522),C=i(258187),S=i(491632),m=i(746096),y=i(267824),f=(0,u.WithResub)(n.memo((({giveLinkUrl:e,learnMoreUrl:t})=>{const i=(0,C.useCommonContext)(),n=(0,s.useSUIThemeStyles)((e=>({container:{backgroundColor:e.colors.surfaceSecondary,borderRadius:12,borderWidth:1,borderColor:e.colors.strokeHighContrast},text:{textAlign:"center",fontSize:c.default.fontSize.size12,lineHeight:16,marginBottom:4,paddingHorizontal:12},link:{fontSize:c.default.fontSize.size12,letterSpacing:-.24,marginVertical:4,textAlign:"center",fontWeight:d.FontWeight.semiBold}})),[]),u=(0,o.useCallback)(((e,t)=>{S.Instrumentation.track(new p.AADCPanelLoaded(p.AADCExperienceLoaded.BalancePanelScreenLoaded,e)),g.openUrl(m.BrowserOrigin.SubscriptionDataSection,t,i.rootViewId)}),[i.rootViewId]);return(0,a.jsxs)(s.Box,Object.assign({style:n.container,margin:5,paddingX:2,paddingY:4,alignItems:"center"},{children:[(0,a.jsx)(l.BodyText,Object.assign({style:n.text},{children:r.getString("BalanceStatePanel.AgeAppropriateInfo")})),e&&(0,a.jsx)(y.Link,Object.assign({url:e,style:n.link,onPress:()=>u(p.AADCLInfoLinksClickTarget.GiftSkypeCreditFAQLinkClicked,e)},{children:r.getString("QuickCallPanel.MinorProtectionBannerGift")})),t&&(0,a.jsx)(y.Link,Object.assign({url:t,style:n.link,onPress:()=>u(p.AADCLInfoLinksClickTarget.AADCLearnMoreLinkClicked,t)},{children:r.getString("QuickCallPanel.MinorProtectionBannerSettings")}))]}))})),(()=>({learnMoreUrl:h.default.getConfigSettingsNoSubscription().skypeGoLinks.aadcLearnMoreLink,giveLinkUrl:h.default.getConfigSettingsNoSubscription().skypeGoLinks.giftSkypeCreditLink})));t.MinorProtectionBanner=f},74491:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneTabPanel=void 0;const a=i(785893),n=i(667294),o=i(999946),s=i(545248),r=i(712305),l=i(98198),c=i(474728),d=i(746096),u=i(994460),h=i(606450),p=i(660198),g=i(593486),C=i(256886),S=(0,n.forwardRef)((({isChildOrMinor:e,emptyStateEmoticon:t},i)=>{const[p]=(0,n.useState)((0,l.getResultListMode)(u.Tab.Phone)),[g,S]=(0,n.useState)(void 0),[m,y]=(0,n.useState)(!1),[f,b]=(0,n.useState)(0),_=(0,n.useCallback)((e=>{b(e)}),[]),T=(0,n.useCallback)((e=>{void 0===g&&S(e)}),[g]),v=(0,n.useCallback)((e=>{y(0===e),c.default.setPhoneCallsEmpty(e)}),[]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.default,{scrollTop:f,searchOrigin:d.SearchPanelInitiator.PhoneTabPanel}),e?(0,a.jsx)(h.MinorProtectionBanner,{}):(0,a.jsx)(s.default,{scrollTop:f,onHeightChange:T}),(0,a.jsx)(r.default,{categoryFilter:u.Tab.Phone,emptyStateEmoticon:t,handleResultsCountChange:v,ref:i,onScroll:_,searchGroups:p,showEmptyIllustration:m,topInset:g&&g+C.COLLAPSIBLE_HEADER_SEARCH_MAX_HEIGHT+4})]})})),m=(0,p.WithResub)((0,n.memo)(S),(e=>Object.assign(Object.assign({},e),{isChildOrMinor:g.default.isChildOrMinor()})));t.PhoneTabPanel=m},999946:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(733754),s=i(539474),r=i(104735),l=i(853374),c=i(746096),d=i(436237),u=i(633896),h=i(109106);t.default=function({scrollTop:e,searchOrigin:t}){const i=(0,n.useCallback)((()=>{const e=l.default.newCauseId();d.log(c.LogTraceArea.CallsTabPanel,`[SearchSection][onSearchButtonClick][${e}]`),d.track(new u.CallTabsSearchTelemetry(t)),d.track(new h.PressAction(h.PressScenario.SearchNavigation,t)),r.default.navigateToSearch({searchOrigin:t},e)}),[t]);return(0,a.jsx)(s.CollapsibleHeaderSearch,{value:e,valueFrom:0,valueTo:50,placeholder:o.getString("SearchInputControl.PlaceHolderTextShort"),onPress:i})}},178809:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(281878),o=i(667294),s=i(667294),r=i(733754),l=i(693380),c=i(711828),d=i(898278),u=i(436237),h=i(746096),p=i(104735),g=i(853374),C=i(667024),S=i(5470),m=i(415963),y=i(258187),f=i(600212),b=i(680837),_=i(769840),T=i(633896),v=i(994460),w=i(109106),I=i(164723),P=e=>{e.stopPropagation();const t=g.default.newCauseId();u.log(h.LogTraceArea.CallsTabPanel,`[ButtonsSection][onMeetNowPress][${t}]`),u.track(new T.CallTabsButtonsTelemetry(v.Tab.Calls,v.Buttons.MeetNow,v.ButtonEvents.Press));const i=g.default.newCauseId();C.default.createOneShotTrackerAndMarkPressTime(i,m.ScenarioName.ResponsivenessMeetNow,e),u.track(new w.PressAction(w.PressScenario.MeetNow,I.MeetNowOrigin.CallsTabMobile)),S.default.navigateToCreateOrJoinFlyout()};t.default=(0,o.memo)((({scrollTop:e,height:t})=>{const i=(0,y.useCommonContext)(),{themeColors:{iconOnColor:o,iconPrimary:C,textOnColor:S,textPrimary:m,surfaceAltFill:w,dividerPrimary:I},gradients:{secondary:M},mode:{isAccessible:k}}=(0,f.useSkypeTheme)(),A=(0,s.useCallback)((e=>{e.stopPropagation();const t=g.default.newCauseId();u.log(h.LogTraceArea.CallsTabPanel,`[ButtonsSection][onAudioCallPress][${t}]`),u.track(new T.CallTabsButtonsTelemetry(v.Tab.Calls,v.Buttons.AudioCall,v.ButtonEvents.Press)),p.default.navigateToQuickCallPanelWithParams({causeId:t,newGroup:!0},i.rootViewId)}),[i.rootViewId]);return(0,a.jsx)(_.default,Object.assign({scrollTop:e,maxHeight:t},{children:(0,a.jsxs)(n.Row,Object.assign({height:"100%",paddingX:"3",paddingY:"5"},{children:[(0,a.jsx)(l.default,{title:r.getString("CallTab.StartACallButton"),icon:c.SkypeIcon.VideoFilled,iconColor:o,buttonStyle:d.SXButtonStyle.GradientFill,buttonConfig:{textColor:S},onPress:A,style:b.default.shadowLightStyle}),(0,a.jsx)(l.default,{title:r.getString("CallTab.CreateACallButton"),accessoryView:(0,c.getIcon)(c.SkypeIcon.Link,c.IconSize.size24,C,{gradientcolor1:M[0],gradientcolor2:M[1]}),buttonStyle:d.SXButtonStyle.ThemeFill,buttonConfig:{backgroundColor:w,textColor:m,borderColor:k?I:void 0},onPress:P,style:b.default.shadowLightStyle})]}))}))}))},693380:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(583367),s=i(22222),r=i(311010),l=i(915877),c=i(898278),d=i(29130),u=i(677381),h=(0,l.lazyProperties)({button:()=>n.Styles.createButtonStyle({flexGrow:1,flexShrink:1,flexBasis:0,marginHorizontal:4,borderRadius:8}),buttonText:()=>n.Styles.createTextStyle({font:r.default.font.uiDisplayRegular,fontSize:13,lineHeight:18}),innerContainer:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",flex:1,borderRadius:8}),innerContainerLandscape:()=>n.Styles.createViewStyle({alignItems:"center",justifyContent:"center",flex:1,borderRadius:8})});function p({title:e,accessoryView:t,icon:i,iconColor:o,buttonStyle:r,buttonConfig:l,onPress:d,style:u,isLandscape:p}){return(0,a.jsx)(s.default,{textStyleOverride:[h.buttonText],style:n.Styles.combine([h.button,u]),buttonStyle:r,onPress:d,title:e,accessoryView:t,icon:i,iconColor:o,iconPositon:p?c.SXButtonIconPosition.Start:c.SXButtonIconPosition.Top,buttonConfig:l,innerContainerStyle:p?h.innerContainerLandscape:h.innerContainer,backgroundStyle:{height:void 0}})}class g extends u.default{_buildState(){const e=this._getRootViewId();return{isLandscape:d.default.getDeviceOrientation(e)===o.DeviceOrientation.Landscape}}render(){return(0,a.jsx)(p,Object.assign({},this.state,this.props))}}t.default=g},536378:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallsTabPanel=t.CallsTabPanelInternal=void 0;const a=i(785893),n=i(667294),o=i(999946),s=i(178809),r=i(712305),l=i(98198),c=i(474728),d=i(953615),u=i(746096),h=i(994460),p=i(733754),g=i(111612),C=i(660198),S=i(330124),m=i(29130),y=i(290120),f=i(898278),b=i(360305),_=(0,l.getResultListMode)(h.Tab.Calls);t.CallsTabPanelInternal=(0,n.forwardRef)((({emptyStateEmoticon:e,isMobileLandscape:t},i)=>{const[l,C]=(0,n.useState)(0),[S,m]=(0,n.useState)(!1),y=t?90:120,f=(0,n.useCallback)((e=>{C(e),(0,d.getHubTabScrollStore)("calls").setValue(e)}),[]),b=(0,n.useCallback)((e=>{m(0===e),c.default.setPhoneCallsEmpty(e)}),[]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.default,{scrollTop:l,searchOrigin:u.SearchPanelInitiator.CallsTabPanel}),(0,a.jsx)(s.default,{scrollTop:l,height:y}),(0,a.jsx)(r.default,{categoryFilter:h.Tab.Calls,emptyStateEmoticon:e,emptyStateHeader:(0,a.jsx)(g.IllustrationScreenHeader,{headerText:(0,p.getString)("QuickCallPanel.NoCallsTitleModernized"),bodyText:(0,p.getString)("QuickCallPanel.NoCallsInfoModernized"),useThemeHeaderColor:!0}),handleResultsCountChange:b,onScroll:f,ref:i,searchGroups:_,showEmptyIllustration:S,topInset:y+35})]})})),t.CallsTabPanel=(0,C.WithResub)((0,n.memo)(t.CallsTabPanelInternal),(e=>Object.assign(Object.assign({},e),{isMobileLandscape:S.default.isMobileEnvironmentWithStackNavigation()&&m.default.getDeviceOrientation(f.MainRootViewId)===y.DeviceOrientation.Landscape&&!b.default.isTabletNoSubscription()})))},449216:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallsTabPanel=void 0;var a=i(536378);Object.defineProperty(t,"CallsTabPanel",{enumerable:!0,get:function(){return a.CallsTabPanel}})},447017:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(581760),r=200;class l extends o.ComponentBase{constructor(e){super(e),this._loopDuration=3e3,this._backgroundRing1ScaleAnimatedValue=new n.Animated.Value(1),this._backgroundRing1ScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing1ScaleAnimatedValue}]}),this._backgroundRing2ScaleAnimatedValue=new n.Animated.Value(1),this._backgroundRing2ScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing2ScaleAnimatedValue}]}),this._backgroundRing3ScaleAnimatedValue=new n.Animated.Value(1),this._backgroundRing3ScaleAnimatedStyle=n.Styles.createAnimatedViewStyle({transform:[{scale:this._backgroundRing3ScaleAnimatedValue}]})}_startAnimation(){this._animation=n.Animated.parallel([n.Animated.sequence([n.Animated.timing(this._backgroundRing1ScaleAnimatedValue,{delay:.3*this._loopDuration,toValue:1.9,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.5*this._loopDuration,isInteraction:!1}),n.Animated.timing(this._backgroundRing1ScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.5,0,1,1),duration:.2*this._loopDuration,isInteraction:!1})]),n.Animated.sequence([n.Animated.timing(this._backgroundRing2ScaleAnimatedValue,{toValue:2.1,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.66*this._loopDuration,isInteraction:!1}),n.Animated.timing(this._backgroundRing2ScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.7,0,1,1),duration:.33*this._loopDuration,isInteraction:!1})]),n.Animated.sequence([n.Animated.timing(this._backgroundRing3ScaleAnimatedValue,{toValue:2.3,easing:n.Animated.Easing.CubicBezier(.33,0,0,1),duration:.75*this._loopDuration,isInteraction:!1}),n.Animated.timing(this._backgroundRing3ScaleAnimatedValue,{toValue:1,easing:n.Animated.Easing.CubicBezier(.9,0,1,1),duration:.25*this._loopDuration,isInteraction:!1})])]),this._animation.start((()=>{this.isComponentMounted()&&this.props.animate&&this._startAnimation()}))}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),!e.animate&&this.props.animate&&this._startAnimation()}componentDidMount(){super.componentDidMount(),this.props.animate&&this._startAnimation()}_containerStyle(){const e=this.props.size||r;return n.Styles.createViewStyle({overflow:"visible",width:e,height:e,alignItems:"center",justifyContent:"center"},!1)}_backgroundRing1Style(){const e=this.props.size||r;return n.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:s.Color.gray300,opacity:.35},!1)}_backgroundRing2Style(){const e=this.props.size||r;return n.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:s.Color.gray300,opacity:.15},!1)}_backgroundRing3Style(){const e=this.props.size||r;return n.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:s.Color.gray300,opacity:.15},!1)}_backgroundRing0Style(){const e=this.props.size||r;return n.Styles.createViewStyle({position:"absolute",top:e/4,left:e/4,width:e/2,height:e/2,borderRadius:e/4,backgroundColor:s.Color.gray300,opacity:.07,transform:[{scale:2.3}]},!1)}render(){return(0,a.jsx)(n.View,Object.assign({style:this.props.style,blockPointerEvents:!0},{children:(0,a.jsxs)(n.View,Object.assign({style:this._containerStyle()},{children:[(0,a.jsx)(n.Animated.View,{style:[this._backgroundRing0Style()]}),(0,a.jsx)(n.Animated.View,{style:[this._backgroundRing1Style(),this._backgroundRing1ScaleAnimatedStyle]}),(0,a.jsx)(n.Animated.View,{style:[this._backgroundRing2Style(),this._backgroundRing2ScaleAnimatedStyle]}),(0,a.jsx)(n.Animated.View,{style:[this._backgroundRing3Style(),this._backgroundRing3ScaleAnimatedStyle]})]}))}))}}t.default=l},266318:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(952262),r=i(110117),l=i(915877),c=i(733754),d=i(581760),u=i(311010),h=i(711828),p=i(619675),g=(0,l.lazyProperties)({contentContainer:()=>n.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",marginVertical:10}),textContentContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>n.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>n.Styles.createTextStyle({fontSize:u.default.controlFontSize.caption}),container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start"}),dismissButtonDesktop:()=>n.Styles.createViewStyle({margin:10}),dismissButtonMobile:()=>n.Styles.createViewStyle({marginTop:10}),translationIconDesktop:()=>n.Styles.createViewStyle({marginLeft:15})});class C extends o.ComponentBase{constructor(){super(...arguments),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss()}}_buildState(e,t){return{conversationName:s.default.getDisplayName(e.conversationMri)||""}}render(){return(0,a.jsxs)(n.View,Object.assign({style:[this.props.containerStyle,g.container]},{children:[(0,a.jsxs)(n.View,Object.assign({style:g.contentContainer},{children:[this._renderTeamsIcon(),this._renderTextContent()]})),this._renderDismissButton()]}))}_renderTeamsIcon(){return(0,a.jsx)(r.default,{style:g.translationIconDesktop,icon:h.SkypeIcon.MSTeams,color:d.Color.white,size:h.IconSize.size24},"teamsIcon")}_renderTextContent(){return(0,a.jsx)(n.View,Object.assign({style:g.textContentContainer},{children:(0,a.jsx)(p.BodyText,Object.assign({style:this._getTextStyles()},{children:c.getString("TeamsInteropBanner.TeamsInteropInCallBannerText",{userName:this.state.conversationName})}))}),"textContentContainer")}_renderDismissButton(){return(0,a.jsx)(r.default,{style:g.dismissButtonDesktop,color:d.Color.white,onPress:this._onDismiss,size:h.IconSize.size24,icon:h.SkypeIcon.Cancel},"dismissButton")}_getTextStyles(){return[this.props.textStyle,g.textContent]}}t.default=C},815362:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(967593),o=i(516778),s=i(217041),r=i(47447),l=i(671830),c=i(746096),d=i(436237),u=i(915877),h=i(723752),p=i(18078),g=i(581760),C=i(680837),S=i(912770),m=i(702301),y=i(567977),f=10,b=(0,u.lazyProperties)({bubbleContainer:()=>o.Styles.createViewStyle({flex:-1,flexDirection:"row"}),simpleBubbleContainer:()=>o.Styles.createViewStyle({maxWidth:260}),bubble:()=>o.Styles.createViewStyle({flex:-1,alignSelf:"flex-start",backgroundColor:g.Color.gray400,borderTopRightRadius:f,borderBottomLeftRadius:f,borderBottomRightRadius:f,padding:15,marginBottom:4,marginHorizontal:20}),bubbleSelf:()=>o.Styles.createViewStyle({flex:-1,alignSelf:"flex-end",backgroundColor:g.Color.gray50,borderTopLeftRadius:f,borderTopRightRadius:f,borderBottomLeftRadius:f,padding:15,marginBottom:4,marginHorizontal:20}),simpleBubble:()=>o.Styles.createViewStyle({flex:-1,padding:8}),bubbleGradient:()=>o.Styles.createViewStyle({position:"absolute",top:0,left:0,right:0,bottom:0,borderTopRightRadius:f,borderBottomLeftRadius:f,borderBottomRightRadius:f}),bubbleText:()=>o.Styles.createTextStyle({color:g.Color.white,backgroundColor:g.Color.transparent}),bubbleTextSelf:()=>o.Styles.createTextStyle({color:g.Color.gray400,backgroundColor:g.Color.transparent}),userIcon:()=>o.Styles.createViewStyle({marginLeft:5})});class _ extends s.ComponentBase{componentDidMount(){super.componentDidMount(),d.log(c.LogTraceArea.CallReactions,"TextReactionView.componentDidMount cuid: "+this.props.id),this._reactionOnScreenTimer=S.default.setTimeout((()=>{this._reactionOnScreenTimer=void 0,this.isComponentMounted()&&this.props.onAnimationEnd&&this.props.onAnimationEnd(this.props.id,this.props.mri)}),this.props.textTimeoutMs||3e3)}componentWillUnmount(){super.componentWillUnmount(),d.log(c.LogTraceArea.CallReactions,"TextReactionView.componentWillUnmount cuid: "+this.props.id),this._reactionOnScreenTimer&&(S.default.clearTimeout(this._reactionOnScreenTimer),this._reactionOnScreenTimer=void 0)}render(){const e=p.default.isMyMri(this.props.mri),t=l.isAgent(this.props.mri),i=e||this.props.hideBackground?void 0:(0,a.jsx)(n.GradientView,{style:b.bubbleGradient,colors:this.props.gradientColors,direction:n.GradientDirection.RIGHT}),s=e||this.props.hideUserIcon?void 0:(0,a.jsx)(m.UserIcon,{style:b.userIcon,size:y.UserIconSize.Size30,userMri:this.props.mri}),c=this.props.hideBackground?b.simpleBubble:e?b.bubbleSelf:b.bubble,d=e||this.props.hideBackground?b.bubbleTextSelf:b.bubbleText;let u;if(this.props.reaction){const e={renderMedia:!1,allowLargeEmoticons:!0,textOverrideStyle:d,allowTextFallbackEmoticons:!0,numberOfLines:this.props.hideBackground&&!t&&r.UICapabilities.textNumberOfLinesSupported()?10:void 0};u=(0,a.jsx)(h.default,{message:this.props.reaction,options:e})}else this.props.content&&(u=(0,a.jsx)(o.Text,Object.assign({style:d},{children:this.props.content})));const g=[];return this.props.hideBackground&&g.push(b.simpleBubbleContainer),this.props.onPress&&g.push(C.default.pointerCursor),this.props.style&&g.push(this.props.style),(0,a.jsx)(o.View,Object.assign({style:g,onPress:this.props.onPress,activeOpacity:.8},{children:(0,a.jsxs)(o.View,Object.assign({style:b.bubbleContainer},{children:[s,(0,a.jsxs)(o.View,Object.assign({style:c},{children:[i,u]}))]}))}))}}t.default=_},296229:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(471727),s=i(136400),r=i(110117),l=i(915877),c=i(733754),d=i(498053),u=i(311010),h=i(711828),p=i(619675),g=i(24576),C=i(66123),S=(0,l.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginRight:16}),labelStyle:()=>n.Styles.createTextStyle({textAlign:"center",textAlignVertical:"center",marginHorizontal:5,paddingBottom:1,fontSize:u.default.fontSize.size13Deprecated,font:u.default.font.uiDisplayRegular}),iconStyle:()=>n.Styles.createViewStyle({overflow:"visible"}),iconCompactStyle:()=>n.Styles.createViewStyle({paddingHorizontal:8})});class m extends g.default{constructor(){super(...arguments),this._onTogetherModeBackgroundChangeButtonPress=()=>{this._changeTogetherModeBackgroundCommand.execute()}}_buildState(e,t){return t&&(this._changeTogetherModeBackgroundCommand=new d.ChangeTogetherModeBackgroundCommand(e.callId,e.conversationMri)),{canChangeTogetherModeBackground:this._changeTogetherModeBackgroundCommand.canExecute(),compactView:o.CallUIUtils.isDesktopMinCallPanelHeaderV2(this._getRootViewId())}}render(){if(!this.state.canChangeTogetherModeBackground)return null;const e=c.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),t=[S.iconStyle,this.state.compactView?S.iconCompactStyle:void 0],i={style:S.container,title:e,accessibilityLabel:e,onPress:this._onTogetherModeBackgroundChangeButtonPress};let n;return this.state.compactView||(n=(0,a.jsx)(p.BodyText,Object.assign({style:[S.labelStyle,{color:this.props.labelColor}]},{children:e}))),(0,a.jsxs)(s.HoverableButton,Object.assign({},i,{children:[(0,a.jsx)(r.IconView,{icon:C.default.getBackgroundChangeButtonIcon(),size:h.IconSize.size16,color:this.props.labelColor,style:t}),n]}))}}t.default=m},263520:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(746096),s=i(110117),r=i(436237),l=i(915877),c=i(89808),d=i(914976),u=i(581760),h=i(311010),p=i(711828),g=i(619675),C=i(24576),S=(0,l.lazyProperties)({image:()=>n.Styles.createViewStyle({borderColor:u.Color.transparent,backgroundColor:u.Color.gray400}),imageHoverBorder:()=>n.Styles.createImageStyle({borderColor:u.Color.gray200Overlay20}),imageHoverBackground:()=>n.Styles.createViewStyle({backgroundColor:u.Color.gray200Overlay60}),centerContent:()=>n.Styles.createViewStyle({borderRadius:4,alignItems:"center",paddingBottom:8,paddingTop:4,position:"relative"}),maxAudienceIconAndValue:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",position:"absolute",top:13,right:13,backgroundColor:"#2B2C33D8",paddingHorizontal:2}),maxAudienceIcon:()=>n.Styles.createViewStyle({marginBottom:2,marginRight:4}),maxAudienceText:()=>n.Styles.createTextStyle({color:u.Color.white}),backgroundItem:()=>n.Styles.createViewStyle({justifyContent:"center",marginTop:4}),backgroundName:()=>n.Styles.createTextStyle({textAlign:"left",color:u.Color.white,marginTop:8}),textLine:()=>n.Styles.createViewStyle({marginLeft:5}),selectedTextStyleDark:()=>n.Styles.createViewStyle({backgroundColor:u.Color.gray400}),selectedTextStyleWhite:()=>n.Styles.createViewStyle({backgroundColor:u.Color.white})});class m extends C.default{constructor(){super(...arguments),this._onHoverStart=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!0})},this._onHoverEnd=()=>{this.isComponentMounted()&&this.setState({isHoveringOn:!1})},this._onPress=()=>{r.log(o.LogTraceArea.CallingUI,"TogetherModeBackgroundItem: _onPress Background Selected "+d.dev_unknownOmit(this.props.backgroundDetails.untranslatedName)),this.props.onSelected(this.props.backgroundDetails,this.props.isSelected)},this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{isHoveringOn:!1,selectedColor:c.default.getPrimaryColor(),primaryBackgroundColorStyle:c.default.getPrimaryBackgroundColorStyle()}}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}render(){const e=this.props.backgroundDetails.label,t=n.Styles.createViewStyle({width:this.props.width,height:this.props.height,borderWidth:this.props.borderWidth},!1),i=[S.image,t,this._getExtraBorderStyle()],o=(0,a.jsx)(g.Caption,Object.assign({style:[S.backgroundName,this._getCaptionStyles()],numberOfLines:1},{children:e})),r=n.Styles.createViewStyle({minWidth:this.props.width+2*this.props.borderWidth,minHeight:this.props.height+2*this.props.borderWidth+16},!1),l=(0,a.jsxs)(n.View,Object.assign({style:S.maxAudienceIconAndValue},{children:[(0,a.jsx)(s.default,{style:S.maxAudienceIcon,size:p.IconSize.size14,color:u.Color.white,icon:p.SkypeIcon.ContactGroup}),(0,a.jsx)(n.Text,Object.assign({style:[S.maxAudienceText,h.default.fontStyle.tertiaryButton]},{children:this.props.backgroundDetails.maxAudience}))]}));return(0,a.jsx)(n.GestureView,Object.assign({onDoubleTap:this.props.onDoubleTap},{children:(0,a.jsx)(n.View,Object.assign({onMouseEnter:this._onHoverStart,onMouseLeave:this._onHoverEnd},{children:(0,a.jsx)(n.Button,Object.assign({ref:this._onContainerRef,style:[S.backgroundItem,r],onPress:this._onPress,accessibilityLabel:this.props.accessibilityLabel,tabIndex:this.props.tabIndex},{children:(0,a.jsxs)(n.View,Object.assign({style:[S.centerContent,this._getExtraBackgroundStyle()]},{children:[(0,a.jsx)(n.Image,{style:i,source:this.props.backgroundDetails.url,resizeMode:"stretch"}),l,o]}))}))}))}))}_getCaptionStyles(){const e=[n.Styles.createViewStyle({width:this.props.width},!1),S.textLine];return this.props.isSelected?e.push(this.props.highContrastTheme?this._themeStyles.primaryBackgroundColorTextStyle:this.state.primaryBackgroundColorStyle):this.props.defaultTheme&&e.push(this._themeStyles.primaryTextColorStyle),e}_getExtraBackgroundStyle(){if(this.props.isSelected){const e=n.Styles.createViewStyle({backgroundColor:this.state.selectedColor},!1);return this.props.highContrastTheme?this._themeStyles.primaryViewColorStyle:e}if(this.state.isHoveringOn)return S.imageHoverBackground}_getExtraBorderStyle(){if(this.props.isSelected){const e=n.Styles.createImageStyle({borderColor:this.state.selectedColor},!1);return this.props.highContrastTheme?this._themeStyles.primaryViewColorStyle:e}if(this.state.isHoveringOn)return S.imageHoverBorder}}t.default=m},429311:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(217041),r=i(711930),l=i(547126),c=i(915877),d=i(733754),u=i(706250),h=i(263520),p=(0,c.lazyProperties)({scrollView:()=>o.Styles.createScrollViewStyle({flex:1})}),g="source";class C extends s.ComponentBase{constructor(){super(...arguments),this._mountedItemRefsMap=new u.default,this._onKeyPress=e=>{let t=this.state.focusedIndex;e.keyCode!==l.default.UP&&e.keyCode!==l.default.LEFT||(t-=1),e.keyCode!==l.default.DOWN&&e.keyCode!==l.default.RIGHT||(t+=1),t<0||t>=this.props.backgroundsList.length||this.isComponentMounted()&&this.setState({focusedIndex:t})}}_buildState(e,t){return{focusedIndex:t?0:this.state.focusedIndex}}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this.state.focusedIndex!==t.focusedIndex&&this._focusItem(this.state.focusedIndex)}render(){return(0,a.jsx)(o.ScrollView,Object.assign({style:p.scrollView,onKeyPress:this._onKeyPress,showsVerticalScrollIndicator:!1},{children:(0,a.jsx)(o.View,Object.assign({style:this.props.style},{children:this._getAvailableBackgrounds()}))}))}_focusItem(e=0){if(e<0||e>=this.props.backgroundsList.length)return;const t=this._mountedItemRefsMap.ref(g+e);null==t||t.requestFocus()}_getAvailableBackgrounds(){return n.map(this.props.backgroundsList,((e,t)=>{const i=!!this.props.selectedBackground&&e.sceneId===this.props.selectedBackground.sceneId,n=e.sceneId,o=e.label;let s=d.getString("TogetherModeModal.BackgroundAccessibilityLabel",{name:o,currentItemIndex:t+1,numberOfItems:this.props.backgroundsList.length});return i&&(s=r.default.combinedAccessibilityLabel(s,d.getString("Global.SelectedAccessibilityLabel"))||""),(0,a.jsx)(h.default,{ref:this._mountedItemRefsMap.onComponentRef(g+t),tabIndex:this.state.focusedIndex===t?0:-1,backgroundDetails:e,onSelected:this.props.onItemSelected,isSelected:i,width:this.props.itemWidth-8,height:this.props.itemHeight,borderWidth:4,onDoubleTap:this.props.onItemDoubleTap,accessibilityLabel:s,highContrastTheme:this.props.highContrastTheme,stackNavigation:this.props.stackNavigation,defaultTheme:this.props.defaultTheme},n)}))}}t.default=C},338163:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return null}},95292:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TouchBar=void 0;var a=i(338163);Object.defineProperty(t,"TouchBar",{enumerable:!0,get:function(){return a.default}})},16383:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(889391),s=i(994224),r=i(598925),l=i(898278),c=i(539549),d=i(952262),u=i(746096),h=i(913944),p=i(110117),g=i(805581),C=i(436237),S=i(915877),m=i(733754),y=i(46929),f=i(104735),b=i(330124),_=i(29130),T=i(914976),v=i(22222),w=i(581760),I=i(711828),P=i(359433),M=i(680837),k=i(619675),A=i(24576),R=i(613084),x=i(853374),L=(0,S.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",borderTopWidth:1,borderStyle:"solid",backgroundColor:w.Color.whiteOverlay20,justifyContent:"flex-start",alignItems:"center"}),textContent:()=>n.Styles.createTextStyle({flexShrink:1,paddingLeft:10,paddingRight:45,marginVertical:8}),textContentContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",flexWrap:"wrap",alignItems:"center"}),textContentContainerMobile:()=>n.Styles.createTextStyle({flexDirection:"column",justifyContent:"flex-start",alignItems:"flex-start"}),textContentContainerDeprecateDesktop:()=>n.Styles.createTextStyle({flexWrap:"nowrap"}),textContentDeprecationDesktop:()=>n.Styles.createTextStyle({flexShrink:1,flex:1}),textStyleMobile:()=>n.Styles.createTextStyle({fontSize:12}),buttonsContainer:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",marginVertical:8,alignSelf:"center"}),buttonsContainerMobile:()=>n.Styles.createViewStyle({alignSelf:"flex-start"}),iconStyle:()=>n.Styles.createViewStyle({marginVertical:10,marginLeft:20}),closeIconStyle:()=>n.Styles.createViewStyle({marginVertical:10,marginRight:20}),actionButton:()=>n.Styles.createViewStyle({marginHorizontal:10})});class V extends A.default{constructor(){super(...arguments),this._onAcceptRequestPress=()=>{R.default.acceptTranslation(this.props.conversationId,this.state.spokenLanguageLocale)},this._onDeclineRequestPress=()=>{R.default.declineTranslationRequest(this.props.conversationId,this.state.spokenLanguageLocale)},this._onDeprecationAcceptPress=()=>{const e=x.default.newCauseId(),t=this.state.remoteUser.getMri();t?(R.default.requestTranslation(t,this.state.spokenLanguageLocale),f.default.navigateToConversation({convId:t,causeId:e,origin:u.NavigationConversationOrigin.EngagementNotice})):C.log(u.LogTraceArea.Calling,"TranslationConversationBanner._onDeprecationAcceptPress conversationId: "+T.mriOrId(this.props.conversationId)+" causeId: "+e)},this._onLearnMoreLinkPress=e=>{n.Linking.openUrl(o.default.getConfigSettingsNoSubscription().translator.learnMoreUrl)},this._onDismiss=e=>{e.stopPropagation(),this.state.translationState===r.TranslationState.Pending?R.default.declineTranslationRequest(this.props.conversationId,this.state.spokenLanguageLocale):this.state.translationState!==r.TranslationState.Requested&&this.state.translationState!==r.TranslationState.Enabled||y.default.setConversationTranslationBannerDismissState(this.props.conversationId,!0)},this._onSpokenLanguageLinkPress=e=>{e.preventDefault(),s.default.CallNavigationHelper.navigateToTranslationSettingsPanel(!1,this._getRootViewId())}}_buildState(e,t){const i=(0,c.default)().getConversation(e.conversationId),a=o.default.getS4LCMCFeatures().translatorAgentId;let n=e.conversationId;return i&&e.isDeprecated&&a&&(n=i.getMemberMrisWithoutMe().filter((e=>e!==a))[0]||n),{isDismissed:y.default.getConversationTranslationBannerDismissState(e.conversationId),isUsingStackNavigationContext:b.default.isUsingStackNavigationContextNoSubscription(),translationState:g.default.getConversationTranslationState(e.conversationId)||r.TranslationState.Disabled,spokenLanguageLocale:g.default.getLocalCallTranslatorBotSpokenLanguageLocale(),isDeviceLanguageSupported:g.default.isDeviceLanguageSupportedForTranslation(),remoteUser:d.default.getDisplayableProfile(n),isSmallScreen:_.default.isWidthSmallerThanThreshold(1024,this._getRootViewId())}}render(){if(this.state.isDismissed||this.state.translationState===r.TranslationState.Disabled&&!this.props.isDeprecated)return null;if(this.state.isDeviceLanguageSupported&&this.state.translationState===r.TranslationState.Enabled)return null;const e=(0,a.jsx)(h.default,{style:L.closeIconStyle,hoverColor:this._getIconColor(),color:this._getIconColor(),onPress:this._onDismiss,title:m.getString("Global.CloseButtonTitle"),size:I.IconSize.size24,icon:I.SkypeIcon.Cancel});return(0,a.jsxs)(n.View,Object.assign({style:this._getContainerStyles()},{children:[this._renderTranslationIcon(),(0,a.jsxs)(n.View,Object.assign({style:this._getTextContentContainerStyle()},{children:[(0,a.jsx)(k.BodyText,Object.assign({style:this._getTextStyles()},{children:this._getText()})),this._renderOptionalActionButtons()]})),e]}))}_renderOptionalActionButtons(){const{translationState:e,remoteUser:t}=this.state;return e===r.TranslationState.Pending?(0,a.jsxs)(n.View,Object.assign({style:this._getButtonContainerStyle()},{children:[(0,a.jsx)(v.default,{style:L.actionButton,buttonSize:l.SXButtonSize.Small,title:m.getString("TranslationBanner.AcceptButtonTitle"),onPress:this._onAcceptRequestPress}),(0,a.jsx)(v.default,{style:L.actionButton,buttonSize:l.SXButtonSize.Small,buttonStyle:l.SXButtonStyle.LightFill,title:m.getString("TranslationBanner.DeclineButtonTitle"),onPress:this._onDeclineRequestPress})]})):this.props.isDeprecated?(0,a.jsx)(n.View,Object.assign({style:this._getButtonContainerStyle()},{children:(0,a.jsx)(v.default,{style:L.actionButton,buttonSize:l.SXButtonSize.Small,title:m.getString("TranslationBanner.TryNewTranslationsButtonV2",{userName:t.getShortName()}),onPress:this._onDeprecationAcceptPress})})):void 0}_getButtonContainerStyle(){return[L.buttonsContainer,void 0,this.props.isDeprecated?M.default.flexZero:void 0]}_getTextContentContainerStyle(){return[L.textContentContainer,void 0,this._isDeprecatedOnWideScreen()?L.textContentContainerDeprecateDesktop:void 0]}_getContainerStyles(){const e=[L.container,this._themeStyles.headerShadowBorderColorStyle];return this._useAccessibleTheme()&&e.push(this._themeStyles.primaryBackgroundColorStyle),e}_renderTranslationIcon(){return(0,a.jsx)(p.IconView,{style:L.iconStyle,icon:I.SkypeIcon.SkypeTranslator,color:this._themeColors.primaryIconColor,size:I.IconSize.size24})}_getIconColor(){return this._themeColors.primaryTextColor}_getText(){return this.state.translationState===r.TranslationState.Requested?m.getString("TranslationBanner.RequestSentText",{userName:this.props.conversationName}):this.state.translationState===r.TranslationState.Pending?m.getParts("TranslationBanner.RequestReceivedTextv2",{userName:this.props.conversationName,learnMoreLink:this._getLearnMoreLink()}):this.props.isDeprecated?m.getParts("TranslationBanner.OldBotDeprecationTextV2",{date:this.props.translatorBotDeprecationDate||""}):this.state.isDeviceLanguageSupported||this.state.translationState!==r.TranslationState.Enabled?void 0:m.getParts("UserSettingsPanel.TranslateMessagesAndCallsAppLanguageNotSupportedExplanation",{spokenLanguageLink:this._getLanguageSettingsLink()})}_getLearnMoreLink(){return(0,a.jsx)(P.default,Object.assign({url:"#",blue:!0,onPress:this._onLearnMoreLinkPress},{children:m.getString("UserSettingsPanel.TranslationCELAStatementLearnMore")}),"keyLearnMore")}_getTextStyles(){return[L.textContent,this._themeStyles.primaryTextColorStyle,void 0,this._isDeprecatedOnWideScreen()?L.textContentDeprecationDesktop:void 0]}_isDeprecatedOnWideScreen(){return!!this.props.isDeprecated&&!this.state.isSmallScreen}_getLanguageSettingsLink(){return(0,a.jsx)(P.default,Object.assign({url:"#",blue:!0,onPress:this._onSpokenLanguageLinkPress},{children:m.getString("UserSettingsPanel.TranslateMessagesAndCallsAppLanguageNotSupportedSelectLinkText")}),"keySpokenLanguage")}}t.default=V},237191:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(217041),s=i(889391),r=i(110117),l=i(915877),c=i(733754),d=i(46929),u=i(581760),h=i(311010),p=i(711828),g=i(359433),C=i(619675),S=(0,l.lazyProperties)({contentContainer:()=>n.Styles.createButtonStyle({flex:1,flexDirection:"row",alignItems:"center",marginVertical:10}),textContentContainer:()=>n.Styles.createViewStyle({flex:1,alignSelf:"center"}),textContent:()=>n.Styles.createTextStyle({paddingLeft:10,paddingRight:15,flexWrap:"wrap",flex:1}),textContentMobile:()=>n.Styles.createTextStyle({fontSize:h.default.controlFontSize.caption}),container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"flex-start"}),dismissButtonDesktop:()=>n.Styles.createViewStyle({margin:10}),dismissButtonMobile:()=>n.Styles.createViewStyle({marginTop:10}),translationIconDesktop:()=>n.Styles.createViewStyle({marginLeft:15})});class m extends o.ComponentBase{constructor(){super(...arguments),this._onDismiss=()=>{this.props.onDismiss&&this.props.onDismiss(),d.default.setInCallTranslationBannerDismissState(this.props.conversationMri,!0)},this._onLearnMoreLinkPress=e=>{n.Linking.openUrl(s.default.getConfigSettingsNoSubscription().translator.learnMoreUrl)}}render(){return(0,a.jsxs)(n.View,Object.assign({style:[this.props.containerStyle,S.container]},{children:[(0,a.jsxs)(n.View,Object.assign({style:S.contentContainer},{children:[this._renderTranslationIcon(),this._renderTextContent()]})),this._renderDismissButton()]}))}_renderTranslationIcon(){var e,t;return(0,a.jsx)(r.default,{style:S.translationIconDesktop,icon:p.SkypeIcon.SkypeTranslator,color:null!==(e=this.props.iconColor)&&void 0!==e?e:u.Color.white,size:null!==(t=this.props.iconSize)&&void 0!==t?t:p.IconSize.size16},"translationIcon")}_renderTextContent(){const e=c.getParts("TranslationBanner.TranslatedConversationInCallText",{learnMore:this._getLearnMoreLink()});return(0,a.jsx)(n.View,Object.assign({style:S.textContentContainer},{children:(0,a.jsx)(C.BodyText,Object.assign({style:this._getTextStyles()},{children:e}))}),"textContentContainer")}_renderDismissButton(){var e,t;return(0,a.jsx)(r.default,{style:S.dismissButtonDesktop,color:null!==(e=this.props.iconColor)&&void 0!==e?e:u.Color.white,onPress:this._onDismiss,size:null!==(t=this.props.iconSize)&&void 0!==t?t:p.IconSize.size24,icon:p.SkypeIcon.Cancel},"dismissButton")}_getLearnMoreLink(){return(0,a.jsx)(g.default,Object.assign({style:this.props.linkStyle,url:"#",blue:!0,onPress:this._onLearnMoreLinkPress},{children:c.getString("TranslationBanner.TranslatedConversationInCallLearnMoreLink")}),"learnMoreLink")}_getTextStyles(){return[this.props.textStyle,S.textContent]}}t.default=m},988154:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(994224),o=i(24576),s=i(147204),r=i(733754),l=i(746096),c=i(711828),d=i(502278),u=i(480200),h=i(560787),p=i(313912),g=i(948310),C="ShareQRPopup";class S extends o.default{constructor(){super(...arguments),this._onShareQRButtonPress=e=>{d.default.onShowShareTwinCamConnection(this.props.callId),n.default.CallPostMessageService.postTwinCamSyncMessage(this.props.conversationMri),g.default.beginTrackingTwinCam(l.NavigationCallOrigin.TwinCamQr),g.default.trackQRNavigationStarted(this.props.conversationMri),s.default.showPopup({getAnchor:this._getShareQRButtonRef,rootViewId:this._getRootViewId(),renderPopup:this._renderShareTwinCamQRContent,preventDismissOnPress:!1,positionPriorities:["top","right"]},C)},this._renderShareTwinCamQRContent=()=>{const{callId:e,conversationMri:t}=this.props;return(0,a.jsx)(p.default,{callId:e,conversationMri:t,leftOffset:this.props.isShowingRecents?100:0,onStopTwinCamPressed:this.props.onStopTwinCamPressed,isPopup:!0})},this._setShareQRButtonRef=e=>{this._shareTwinCamQRButtonRef=e},this._getShareQRButtonRef=()=>this._shareTwinCamQRButtonRef}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),e.isTwinCamConnected!==this.props.isTwinCamConnected&&s.default.dismissPopup(C,this._getRootViewId())}render(){const{colorConfig:e,caption:t,callButtonSize:i,isDisabled:n,title:o,showToolTip:s,toolTipConfig:l,isTwinCamConnected:d}=this.props,p=c.SkypeIcon.TwinCamMidOffGradient;return d&&e&&(e.hoverIcon=void 0),(0,a.jsx)(h.default,{icon:d?p:c.SkypeIcon.TwinCamMid,accessibilityLabel:r.getString("CallControlsOverFlowMenu.TwinCam"),size:i,colorConfig:e,isDisabled:n,onPress:this._onShareQRButtonPress,caption:t,ref:this._setShareQRButtonRef,isToggledOn:d,title:o,showToolTip:s,toolTipConfig:l},u.CallControlsKeys.TwinCam)}}t.default=S},313912:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(817673),o=i(516778),s=i(892112),r=i(244770),l=i(994224),c=i(257538),d=i(22222),u=i(359433),h=i(619675),p=i(680837),g=i(24576),C=i(889391),S=i(733754),m=i(898278),y=i(581760),f=i(915877),b=i(711828),_=i(110117),T=i(163841),v=(0,f.lazyProperties)({twinCam:()=>o.Styles.createViewStyle({flexDirection:"column",alignItems:"center",flex:1,padding:20}),header:()=>o.Styles.createViewStyle({paddingHorizontal:10,backgroundColor:y.Color.darkThemeBackground}),twinCamViewContent:()=>o.Styles.createViewStyle({flexDirection:"column",alignItems:"center",flex:1}),twinCamPopup:()=>o.Styles.createViewStyle({borderRadius:8,shadowColor:y.Color.blackOverlay40,shadowOffset:{width:0,height:2},shadowOpacity:.8,shadowRadius:10,width:320,marginBottom:20,backgroundColor:y.Color.darkThemeBackground}),darkAccessibleTwinCamBorder:()=>o.Styles.createViewStyle({borderWidth:1,borderColor:y.Color.white}),twinCamText:()=>o.Styles.createTextStyle({color:y.Color.white,textAlign:"center",fontSize:c.MeetNowFontSize.lobbySubtitleMedium}),twinCamHeaderText:()=>o.Styles.createTextStyle({color:y.Color.white}),twinCamTextPadding:()=>o.Styles.createTextStyle({color:y.Color.white,textAlign:"center",marginBottom:20,marginTop:14,fontSize:c.MeetNowFontSize.lobbySubtitleSmall}),twinCamTitle:()=>o.Styles.createTextStyle({color:y.Color.white,marginBottom:20,textAlign:"center",fontSize:c.MeetNowFontSize.lobbyTitleMedium}),twinCamCode:()=>o.Styles.createTextStyle({color:y.Color.white,marginBottom:20,textAlign:"center",fontSize:c.MeetNowFontSize.lobbySubtitleMedium}),qrBgPortrait:()=>o.Styles.createViewStyle({width:208,height:208,padding:10,borderRadius:10,backgroundColor:y.Color.white,marginBottom:20,marginTop:20}),titleTwinCamArea:()=>o.Styles.createViewStyle({width:115,marginBottom:10,marginTop:5,flexDirection:"row"}),titleTwinCamText:()=>o.Styles.createTextStyle({color:y.Color.white,fontSize:c.MeetNowFontSize.lobbyTextInput,marginLeft:10})});class w extends g.default{constructor(){super(...arguments),this._onLearnMoreLinkPress=e=>{o.Linking.openUrl(C.default.getConfigSettingsNoSubscription().twinCam.learnMoreUrl)}}_buildState(e,t){const i=l.default.CallingStore.getConnectedEndpoints(e.callId).length>0,{twinCamEnabled:a}=C.default.getS4LCMCFeatures(),o=l.default.CallingStore.isCallJoinedAsTwinCam(e.callId);return{isTwinCamConnected:a&&i&&!o,joinLink:"skype:?call&"+n.stringify({twincam:!0,threadId:e.conversationMri,callId:e.callId})}}_getLearnMoreLink(){return(0,a.jsx)(u.default,Object.assign({url:"#",white:this._useDarkTheme(),textThemeColor:m.TextThemeColor.Secondary,underline:!0,onPress:this._onLearnMoreLinkPress},{children:S.getString("CallControlsOverFlowMenu.TwinCamHowToConnect")}),"keyLearnMore")}_getIconColor(){return this._useDarkTheme()?y.Color.white:y.Color.black}render(){const e=this._useDarkTheme(),t=this._useAccessibleTheme(),i=e||t?c.MeetNowStyle.getStyle(t,e):c.MeetNowStyle.getThemeStyle(T.Theme.Delphi),n=[v.twinCam,this.props.leftOffset?o.Styles.createViewStyle({left:this.props.leftOffset},!1):void 0,this.props.isPopup?v.twinCamPopup:void 0,e?void 0:i.background],l={backgroundColor:this._themeColors.primaryBackgroundColor,textColor:this._themeColors.primaryTextColor},u=e?void 0:o.Styles.createTextStyle({color:l.textColor},!0);t&&e&&n.push(v.darkAccessibleTwinCamBorder);const g=r.Collection.SKYPE_LOGO,C=this.state.isTwinCamConnected?(0,a.jsx)(h.BodyText,Object.assign({style:[v.twinCamCode,u]},{children:S.getString("CallControlsOverFlowMenu.TwinCamConnected")})):(0,a.jsxs)(o.View,Object.assign({style:v.twinCamViewContent},{children:[(0,a.jsxs)(o.View,Object.assign({style:v.titleTwinCamArea},{children:[(0,a.jsx)(_.IconView,{size:24,color:this._getIconColor(),icon:b.SkypeIcon.TwinCamMid},"iconTwinCam"),(0,a.jsx)(h.BodyText,Object.assign({style:[v.titleTwinCamText,u]},{children:S.getString("CallControlsOverFlowMenu.TwinCam")}))]})),(0,a.jsx)(h.Subtitle,Object.assign({style:[v.twinCamTitle,u]},{children:S.getString("CallControlsOverFlowMenu.TwinCamShareVideo")})),(0,a.jsx)(o.View,Object.assign({style:v.qrBgPortrait},{children:(0,a.jsx)(s.default,{message:this.state.joinLink,correctionLevel:"Q",style:p.default.flexOne,color:y.Color.black,backgroundColor:y.Color.white,iconSrc:g,iconHeight:50,iconWidth:50,iconExcavate:!0,size:188})})),(0,a.jsx)(h.BodyText,Object.assign({style:[v.twinCamText,u]},{children:S.getString("CallControlsOverFlowMenu.TwinCamJoinCode")})),(0,a.jsx)(h.BodyText,Object.assign({style:[v.twinCamTextPadding,u]},{children:this._getLearnMoreLink()}))]}));return(0,a.jsxs)(o.View,Object.assign({style:n,tabIndex:-1,accessibilityLabel:S.getString("MeetNowCallControls.TwinCam")},{children:[C,this.state.isTwinCamConnected&&(0,a.jsx)(d.default,{buttonStyle:m.SXButtonStyle.DarkFill,buttonSize:m.SXButtonSize.Medium,title:S.getString("CallControlsOverFlowMenu.StopTwinCam"),allowTextWrap:!0,onPress:this.props.onStopTwinCamPressed})]}))}}t.default=w},721045:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dismiss=t.show=void 0;const a=i(785893),n=i(496486),o=i(583367),s=i(516778),r=i(934339),l=i(300060),c=i(889391),d=i(462033),u=i(996074),h=i(228664),p=i(994224),g=i(598925),C=i(47447),S=i(671830),m=i(147204),y=i(898278),f=i(400984),b=i(539549),_=i(757139),T=i(404336),v=i(437490),w=i(952262),I=i(904604),P=i(746096),M=i(211375),k=i(136400),A=i(110117),R=i(497174),x=i(436237),L=i(172490),V=i(915877),O=i(518460),B=i(941209),D=i(733754),E=i(854757),N=i(70665),F=i(330124),j=i(364956),U=i(127333),H=i(785207),z=i(695697),G=i(29130),W=i(914976),K=i(415963),$=i(910265),q=i(190631),Q=i(22222),X=i(581760),Z=i(711828),J=i(478262),Y=i(680837),ee=i(619675),te=i(976543),ie=i(354298),ae=i(172758),ne=i(853374),oe=i(115340),se=(0,V.lazyProperties)({dialog:()=>s.Styles.createViewStyle({flex:1,alignItems:"stretch",justifyContent:"center"}),innerContainer:()=>s.Styles.createViewStyle({flex:1,alignSelf:"stretch",alignItems:"center",justifyContent:"center",padding:20}),title:()=>s.Styles.createTextStyle({marginTop:25,marginBottom:20,textAlign:"center",backgroundColor:X.Color.transparent}),sectionTitle:()=>s.Styles.createViewStyle({flex:1,alignItems:"stretch",alignSelf:"stretch",justifyContent:"center",flexDirection:"row"}),sectionTitleText:()=>s.Styles.createTextStyle({paddingHorizontal:10}),message:()=>s.Styles.createTextStyle({marginTop:10,marginBottom:20,textAlign:"center",backgroundColor:X.Color.transparent}),centeredText:()=>s.Styles.createTextStyle({textAlign:"center",backgroundColor:X.Color.transparent}),permissionsText:()=>s.Styles.createTextStyle({paddingBottom:20}),permissions:()=>s.Styles.createViewStyle({alignSelf:"stretch"}),primaryButton:()=>s.Styles.createButtonStyle({marginHorizontal:20,alignSelf:"stretch"}),messageComposerContainer:()=>s.Styles.createViewStyle({alignSelf:"stretch",justifyContent:"center",marginTop:20,marginHorizontal:20}),actionContainer:()=>s.Styles.createViewStyle({alignSelf:"stretch",alignItems:"center",marginBottom:20}),feedbackButton:()=>s.Styles.createButtonStyle({marginTop:20})});function re(e,t,i){x.log(P.LogTraceArea.UnansweredCall,"dismiss causeId: "+i),N.unregisterModalDialogDismissalException(e),m.default.dismissModal(e,t)}t.show=function(e,t,i,n){x.log(P.LogTraceArea.UnansweredCall,"show causeId: "+n);const o=(0,a.jsx)(le,{modalId:t,callId:e.originalCallId,conversationMri:e.originalConversationMri,unansweredCallOutput:e});return N.registerModalDialogDismissalException(t),m.default.showModal(o,t,i),e=>re(e,i.rootViewId,n)},t.dismiss=re;class le extends u.default{constructor(){super(...arguments),this._renderAction=(e,t)=>{switch(e.action){case g.UnansweredCallAction.SendMessage:if(S.isPhoneMri(this.props.conversationMri)||this.state.oneToOneConversationUnaccepted)return;const i=e.message&&0===t?(0,a.jsx)(ee.BodyText,Object.assign({bold:!0,style:se.centeredText},{children:e.message})):void 0;return(0,a.jsxs)(s.View,Object.assign({style:se.actionContainer},{children:[i,this._renderMessageComposer(e.prepopulatedMessage)]}),"composer"+t);case g.UnansweredCallAction.PromptForPermission:let n;this.props.unansweredCallOutput.reason===g.UnansweredCallReason.MicAndCamPermissionDenied?n=j.default.getDeniedPrompt(J.PermissionType.MicrophoneAndCamera):this.props.unansweredCallOutput.reason===g.UnansweredCallReason.CameraPermissionDenied?n=j.default.getDeniedPrompt(J.PermissionType.Camera):this.props.unansweredCallOutput.reason===g.UnansweredCallReason.MicrophonePermissionDenied?n=j.default.getDeniedPrompt(J.PermissionType.Microphone):this.props.unansweredCallOutput.reason===g.UnansweredCallReason.ReadPhoneStatePermissionDenied&&(n=j.default.getDeniedPrompt(J.PermissionType.ReadPhoneState));const o=n?(0,a.jsx)(ee.BodyText,Object.assign({bold:!0,style:[se.centeredText,se.permissionsText]},{children:n})):void 0,r=C.UICapabilities.systemSettingsDeepLinkSupported()?(0,a.jsx)(Q.default,{style:se.primaryButton,buttonStyle:y.SXButtonStyle.AgnosticGradientFill,agnosticGradientColor:X.AgnosticGradientFillButtonColors.blue,onPress:this._onPermissionSettingsPress,title:D.getString("UnansweredCallActions.Settings")}):void 0;return(0,a.jsxs)(s.View,Object.assign({style:se.permissions},{children:[o,r]}),"permissions"+t);case g.UnansweredCallAction.SendFeedback:return(0,a.jsx)(k.HoverableButton,Object.assign({onPress:this._onSendFeedbackPress,style:se.feedbackButton},{children:(0,a.jsx)(ee.BodyText,Object.assign({bold:!0,style:se.centeredText,textThemeColor:ee.TextThemeColor.Secondary},{children:e.message}),"sendfeedbacktext"+t)}),"sendfeedbackbutton"+t);case g.UnansweredCallAction.CallPSTN:return this._renderCallButtons();case g.UnansweredCallAction.ShowRegulatoryInfoIndia||g.UnansweredCallAction.ShowRegulatoryInfoNetherlands:return this._renderRegulatoryInfoButton(e.action)}},this._onTitleOrMessageRef=e=>{this._titleOrMessageRef=e||void 0},this._onPermissionSettingsPress=()=>{s.Linking.openUrl("app-settings:")},this._onCallButtonPressed=e=>{const t=ne.default.newCauseId();x.log(P.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onCallButtonPressed mri: "+W.mriOrId(e)+" causeId: "+t),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,g.UnansweredCallAction.CallPSTN,t),this._closeDialog(this._getRootViewId(),t),x.track(new ie.UnansweredCallCTA("cta_clicked")),p.default.CallNavigationHelper.startCall({conversationMri:e,withVideo:!1,origin:P.NavigationCallOrigin.UnansweredCallPanel},t)},this._onMessageSent=e=>{const t=ne.default.newCauseId();return x.log(P.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onMessageSent causeId: "+t),H.default.postMessageFromInput(this.props.conversationMri,P.PostSource.UnansweredCallPanel,e,void 0,{name:K.ScenarioName.SendTextMessage}),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,g.UnansweredCallAction.SendMessage,t),this._closeDialog(this._getRootViewId(),t),!0},this._onSendFeedbackPress=e=>{const t=ne.default.newCauseId();x.log(P.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onSendFeedbackPress causeId: "+t),e.stopPropagation(),z.default.reportProblem(!0,this._getRootViewId()),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,g.UnansweredCallAction.SendFeedback,t),this._closeDialog(this._getRootViewId(),t)},this._onClickOutside=()=>{const e=ne.default.newCauseId();x.log(P.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onClickOutside causeId: "+e),this._reportCancel(e)},this._onCancelPress=()=>{const e=ne.default.newCauseId();x.log(P.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onCancelPress causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e)},this._onBack=()=>{const e=ne.default.newCauseId();return x.log(P.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onBack causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e),x.log(P.LogTraceArea.HardwareBackButton,"goBack: true componentId: UnansweredCallPanel"),!0},this._onEscape=()=>{const e=ne.default.newCauseId();return x.log(P.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onEscape causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e),!0},this._onAppStateChange=e=>{if(e===s.Types.AppActivationState.Background){const e=ne.default.newCauseId();x.log(P.LogTraceArea.UnansweredCall,"UnansweredCallPanel._onAppStateChange causeId: "+e),this._reportCancel(e),this._closeDialog(this._getRootViewId(),e)}},this._closeDialog=(e,t)=>{x.log(P.LogTraceArea.UnansweredCall,"UnansweredCallPanel._closeDialog causeId: "+t),re(this.props.modalId,e,t)},this._onPhoneActionsMenuClose=e=>{x.log(P.LogTraceArea.UnansweredCall,"_onPhoneActionsMenuClose causeId: "+e),_.default.close(this._getRootViewId(),e)},this._onTrySkypeToPhoneButtonRef=e=>{this._trySkypeToPhoneButtonRef=e||void 0}}_buildState(e,t){const i=this._getRootViewId(),a=S.isOneOnOneConversation(e.conversationMri);let n;if(a){const t=(0,b.default)().getConversation(e.conversationMri);t?n=t.getOtherPartyMri():S.isSkypeIdMri(e.conversationMri)&&(n=e.conversationMri)}return{isLandscape:G.default.getDeviceOrientation(i)===o.DeviceOrientation.Landscape,isMobileScreenSize:G.default.isMobileScreenSize(i),title:e.unansweredCallOutput.title,oneToOneConversationUnaccepted:a&&!f.default.isConversationAccepted(e.conversationMri),displayName:w.default.getShortDisplayName(e.conversationMri)||D.getString("UnansweredCallTitle.UnknownCallee"),fullName:w.default.getDisplayName(e.conversationMri)||D.getString("UnansweredCallTitle.UnknownCallee"),isOneOnOne:a,localAddressBookContact:O.default.getContactByCorrespondingMri(e.conversationMri),userPhones:n?ae.default.getFullUserProfileByMri(n).phones:[],callActionUcuxEnabled:c.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.NewUcuxCallActionEnabled,hasEntitlements:I.default.userHasActiveEntitlements()}}componentDidMount(){super.componentDidMount();const e=ne.default.newCauseId();x.log(P.LogTraceArea.UnansweredCall,"componentDidMount causeId: "+e),this._titleOrMessageRef&&this._titleOrMessageRef.requestFocus(),v.dismissAll(),d.default.subscribe(this._onBack),L.default.addEscapeHandler(this._onEscape),this._activationSubToken=l.default.subscribeForChanges("UnansweredCallPanel",this._onAppStateChange)}componentWillUnmount(){super.componentWillUnmount();const e=ne.default.newCauseId();x.log(P.LogTraceArea.UnansweredCall,"componentWillUnmount causeId: "+e),d.default.unsubscribe(this._onBack),L.default.removeEscapeHandler(this._onEscape),this._reportCancel(e),this._activationSubToken&&(this._activationSubToken.unsubscribe(),this._activationSubToken=void 0),M.setFocusWithDelay(M.FocusEvent.CloseUnansweredCallPanel,500)}render(){return(0,a.jsx)($.default,Object.assign({dialogId:this.props.modalId,containerStyle:this._themeStyles.primaryBackgroundColorStyle,closeOnClickOutside:!0,maxWidth:this.state.isMobileScreenSize?void 0:T.CompactWidth,fullScreen:this.state.isMobileScreenSize,useFullSizeContainer:!0,accessibilityLabel:this.state.title||this.props.unansweredCallOutput.optionalSecondaryMessage||"",onClickOutside:this._onClickOutside},{children:(0,a.jsx)(oe.KeyboardAvoidingView,{children:this._content()})}))}_renderMessageComposer(e){let t=[];return e&&(t=t.concat(new R.UnhandledEntity(e))),(0,a.jsx)(s.View,Object.assign({style:[se.messageComposerContainer]},{children:(0,a.jsx)(E.default,{conversationId:this.props.conversationMri,otherPartyMri:void 0,hideMediaBar:!0,disableCopyPasteMedia:!0,hideEmoticonKeyboardIcon:!0,hideMediaPickerIcon:!0,hideMojiPickerIcon:!0,hideStickerPickerIcon:!0,hideLocationPickerIcon:!0,hideContactPickerIcon:!0,hideOverflowMenu:!0,hideSmsIcon:!0,hideAudioMessage:!0,shouldAutoFocus:!!e,showSendControlWhenEmpty:!0,initialInputEntities:t,onMessageSent:this._onMessageSent})}),"composer")}_renderRegulatoryInfoButton(e){let t="",i="";const o=c.default.getConfigSettingsNoSubscription().pstn;if(e===g.UnansweredCallAction.ShowRegulatoryInfoIndia?(t=o.indiaRegulatoryFaq,i=D.getString("PstnUtils.BlockedRegulatoryIndiaButton")):e===g.UnansweredCallAction.ShowRegulatoryInfoNetherlands&&(t=o.netherlandsRegulatoryFaq,i=D.getString("PstnUtils.BlockedRegulatoryNetherlandsButton")),!n.isEmpty(t)&&!n.isEmpty(i))return(0,a.jsx)(s.View,Object.assign({style:se.actionContainer},{children:(0,a.jsx)(Q.default,{title:i,onPress:()=>{s.Linking.openUrl(t)},buttonSize:y.SXButtonSize.Medium,autoFocus:!0})}),"regulatoryButton");x.warn(P.LogTraceArea.UnansweredCall,`Missing button properties for UnansweredCallAction: ${g.UnansweredCallAction[e]}; url = "${t}", buttonTitle = "${i}"`)}_renderCallButtons(){const e=B.mergeMriProfileAndExtraPhones(this.props.conversationMri,this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,this.state.userPhones);let t,i;if(e&&0!==e.length)return 1===e.length?(t=(0,a.jsx)(s.View,Object.assign({style:se.sectionTitle},{children:(0,a.jsx)(ee.Subtitle,Object.assign({style:[se.sectionTitleText,this._themeStyles.primaryTextColorStyle]},{children:D.getString("UnansweredCallActions.TrySkypeToPhoneButton")}))})),i=this._renderCallButton(e[0].number)):i=this._renderTrySkypeToPhoneButton(e),x.track(new ie.UnansweredCallCTA("cta_shown")),(0,a.jsxs)(s.View,Object.assign({style:se.actionContainer},{children:[t,(0,a.jsx)(s.View,Object.assign({style:se.messageComposerContainer},{children:i}))]}),"placecall")}_renderCallButton(e){const t=S.sanitizeMri(e,S.Namespaces.PSTN),i=`${D.getString("UnansweredCallActions.CallName",{name:this.state.displayName})} ${e} `;return(0,a.jsx)(h.default,{isUsingStackNav:F.default.isUsingStackNavigationContextNoSubscription(),icon:Z.SkypeIcon.SkypeOut,accessibilityLabel:i,phoneNumber:e,onPress:()=>this._onCallButtonPressed(t)},"callingbutton_"+e)}_renderTrySkypeToPhoneButton(e){return(0,a.jsx)(h.default,{ref:this._onTrySkypeToPhoneButtonRef,isUsingStackNav:F.default.isUsingStackNavigationContextNoSubscription(),icon:Z.SkypeIcon.SkypeOut,phoneNumber:D.getString("UnansweredCallActions.TrySkypeToPhoneButton"),accessibilityLabel:D.getString("UnansweredCallActions.TrySkypeToPhoneButton"),onPress:()=>this._showPhoneActionsMenu(e)},"trySkypeToPhoneButton")}_headerCloseButton(){return{closeButtonType:q.CloseButtonType.Close,title:D.getString("Global.CloseButtonTitle"),onPress:this._onCancelPress,color:this._themeColors.primaryIconColor}}_content(){const e=this.state.isMobileScreenSize&&this.state.isLandscape,t=(0,a.jsx)(q.SimplePanelHeader,{leftButton:this._headerCloseButton(),hideBottomBorder:!0,floating:!0,useTransparentBackground:!0}),i=this.state.title?(0,a.jsx)(ee.PanelHeader,Object.assign({ref:this._onTitleOrMessageRef,landscape:e,style:se.title},{children:this.state.title}),"title"):void 0,o=this.props.unansweredCallOutput.optionalSecondaryMessage?(0,a.jsx)(ee.PanelHeader,Object.assign({ref:i?void 0:this._onTitleOrMessageRef,landscape:e,style:se.message},{children:this.props.unansweredCallOutput.optionalSecondaryMessage}),"message"):void 0;let l,c;if(n.some(this.props.unansweredCallOutput.actions,(e=>e.action===g.UnansweredCallAction.CallPSTN))){const e=B.mergeMriProfileAndExtraPhones(this.props.conversationMri,this.state.localAddressBookContact?this.state.localAddressBookContact.phones:void 0,this.state.userPhones),t=!S.isPhoneMri(this.props.conversationMri)&&!this.state.oneToOneConversationUnaccepted&&this.state.isOneOnOne&&e.length>0&&this.state.hasEntitlements;t&&x.track(new ie.UnansweredCallCTA("cta_eligible"));const i=t&&this.state.callActionUcuxEnabled?n.filter(this.props.unansweredCallOutput.actions,(e=>e.action===g.UnansweredCallAction.CallPSTN)):n.filter(this.props.unansweredCallOutput.actions,(e=>e.action===g.UnansweredCallAction.SendMessage));l=n.map(i,this._renderAction)}else l=n.map(this.props.unansweredCallOutput.actions,this._renderAction);if(this.props.unansweredCallOutput.visualInfo)switch(this.props.unansweredCallOutput.visualInfo.type){case g.UnansweredCallVisualInfoType.Emoticon:c=(0,a.jsx)(r.AnimatedEmoticon,{size:r.Size.ExtraLarge,emoticonName:this.props.unansweredCallOutput.visualInfo.name,standaloneAnimation:!0});break;case g.UnansweredCallVisualInfoType.Icon:c=(0,a.jsx)(A.default,{icon:this.props.unansweredCallOutput.visualInfo.name,size:Z.IconSize.size80,color:X.Color.gray300})}return(0,a.jsxs)(s.View,Object.assign({style:Y.default.flexOne},{children:[(0,a.jsxs)(s.View,Object.assign({style:se.innerContainer},{children:[c,i,o,l]}),"innercontainer"),t]}))}_reportCancel(e){x.log(P.LogTraceArea.UnansweredCall,"UnansweredCallPanel._reportCancel causeId: "+e),te.default.reportUnansweredCallActionTaken(this.props.callId,this.props.unansweredCallOutput.reason,g.UnansweredCallAction.None,e)}_showPhoneActionsMenu(e){const t=n.map(e,(e=>{const t=S.sanitizeMri(e.number,S.Namespaces.PSTN);return{props:{key:"pstnButton"+e.number+e.type,phone:e,keepSpaceForSubtitle:!0,onPress:()=>this._onCallButtonPressed(t)},builder:U.default.buildRow}}));_.default.showWithBuilders({builders:t,anchor:()=>this._trySkypeToPhoneButtonRef,getTitle:()=>this.state.fullName,onCloseMenu:this._onPhoneActionsMenuClose,rootViewId:this._getRootViewId()})}}t.default=le},601494:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(994224),s=i(109520),r=i(502278),l=i(924506),c=i(898278),d=i(285043),u=i(913944),h=i(915877),p=i(733754),g=i(22222),C=i(581760),S=i(711828),m=i(619675),y=i(853374),f=(0,h.lazyProperties)({popupContainer:()=>n.Styles.createViewStyle({width:300,paddingHorizontal:15,borderRadius:5,backgroundColor:C.Color.darkThemeBackgroundOverlay85}),popupContainerLightTheme:()=>n.Styles.createViewStyle({backgroundColor:C.Color.whiteOverlay90}),popupContainerBackground:()=>n.Styles.createViewStyle({backgroundColor:C.Color.darkThemeBackground}),popupTitleRow:()=>n.Styles.createTextStyle({marginTop:15,flexDirection:"row",justifyContent:"space-between"}),backgroundReplacementContainer:()=>n.Styles.createViewStyle({marginBottom:15})});class b extends d.HoverPopup{constructor(){super(...arguments),this._allowHidePopup=()=>this._defaultAllowHidePopupConditions()&&!this.state.isAwaitingConfirmation&&!this.state.shouldShowCloseButton,this._onClosePressed=()=>{this.state.shouldShowCloseButton&&this.setState({shouldShowCloseButton:!1},(()=>{this._isAnchorHovered=!1,this._isAnchorLongPressed=!1,this._isPopupHovered=!1,this._hidePopup(!1)}))},this._onCameraSelected=(e,t)=>{const i=y.default.newCauseId();e&&(o.default.CallControlsStore.setIsAwaitingCameraConfirmation(!0),r.default.updateCallVideoSettingsPopupEvent((e=>{e.markDidChangeCameraDevice()})),o.default.DeviceStore.preselectDevices({camera:t},i))},this._onToggleBlur=e=>{r.default.updateCallVideoSettingsPopupEvent((t=>{e?t.toggleBlurOn():t.toggleBlurOff()}))},this._onBackgroundChangePress=e=>{this.props.onChangeBackgroundPress&&this.props.onChangeBackgroundPress()}}_buildState(e,t){return Object.assign(Object.assign({},super._buildState(e,t)),{isAwaitingConfirmation:o.default.CallControlsStore.isAwaitingCameraConfirmation(),enableBackgroundReplacement:o.default.DeviceStore.isBackgroundReplacementEnabled()})}componentWillUnmount(){super.componentWillUnmount(),this.state.isAwaitingConfirmation&&o.default.CallControlsStore.setIsAwaitingCameraConfirmation(!1),this.onClosed()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),t.isAwaitingConfirmation&&!this.state.isAwaitingConfirmation&&this._hidePopup(!0)}renderContent(){const e={backgroundColor:C.Color.blue,textColor:C.Color.white},t=this.state.enableBackgroundReplacement&&(0,a.jsx)(n.View,Object.assign({style:f.backgroundReplacementContainer},{children:(0,a.jsx)(g.default,{buttonSize:c.SXButtonSize.Medium,buttonStyle:c.SXButtonStyle.Custom,title:p.getString("AudioVideoSettings.CameraBackgroundReplacementLabel"),onPress:this._onBackgroundChangePress,buttonConfig:e,autoFocus:!1})})),i=this.state.shouldShowCloseButton?(0,a.jsx)(u.default,{icon:S.SkypeIcon.ClosePanel,color:this._themeColors.primaryTextColor,hoverColor:this._themeColors.primaryIconColor,size:S.IconSize.size20,onPress:this._onClosePressed,title:p.getString("AudioVideoSettings.VideoSettingsClose")}):void 0;return(0,a.jsxs)(n.View,Object.assign({style:[f.popupContainer,this.props.useLightTheme?f.popupContainerLightTheme:void 0,this.props.isOutgoingVideoDisabled?f.popupContainerBackground:void 0]},{children:[(0,a.jsxs)(n.View,Object.assign({style:f.popupTitleRow},{children:[(0,a.jsx)(m.Subtitle,{children:p.getString("CallControlsOverFlowMenu.AdjustVideoSettings")}),i]})),(0,a.jsx)(l.default,{colorThemeOverride:this._currentTheme,hideVideoLabel:!0,labelMaxWidth:166,onCameraSelected:this._onCameraSelected,onToggleBlur:this._onToggleBlur,forceVideoOnClose:!0,forceUpdateDefaultDevice:!1,skipVideoOnClose:this.state.isAwaitingConfirmation,overrideVideoPreviewDimensions:{width:270,height:150},isVideoDisabledDuringScreenSharing:this.props.isVideoDisabledDuringScreenSharing,showNewBackgroundReplacementUI:!1,isOutgoingVideoDisabled:this.props.isOutgoingVideoDisabled}),t]}))}popupDescription(){return"VideoSettings"}onOpened(e){r.default.setCallVideoSettingsPopupEvent(new s.CallVideoSettingsPopup(this.props.callId,e)),o.default.CallControlsStore.setSettingsPopupVisibility(!0),this.state.shouldShowCloseButton||this.props.isVideoButtonEnabled||this.setState({shouldShowCloseButton:!0})}onClosed(){o.default.CallControlsStore.setSettingsPopupVisibility(!1)}}t.default=b},403239:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=(i(667294),i(705465)),o=i(581760),s=n.StyleSheet.create({wrapper:{position:"relative"},redDot:{width:10,height:10,borderRadius:5,backgroundColor:o.Color.red,position:"absolute",right:"-7%",top:"25%",marginTop:-5,marginRight:5}});t.default=function(e){return(0,a.jsxs)(n.View,Object.assign({style:s.wrapper},{children:[e.children,e.showRedDot?(0,a.jsx)(n.View,{style:s.redDot}):void 0]}))}},518967:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(667294),s=i(217041),r=i(326517),l=i(471727),c=i(915877),d=i(680837),u=(0,c.lazyProperties)({opacityLight:()=>n.Styles.createImageStyle({opacity:.3}),opacityDark:()=>n.Styles.createImageStyle({opacity:.5})}),h=o.memo((({isLightCallingTheme:e})=>{const[t,i]=o.useState();if(o.useEffect((()=>{const e=r.default.getAvailableBackgroundUri();return e&&i(e),()=>{e&&r.default.setBackgroundAvailable(e)}}),[]),!t)return null;const s=e?u.opacityLight:u.opacityDark;return(0,a.jsx)(n.Image,{style:n.Styles.combine(d.default.absoluteFill,s),resizeMode:"cover",source:t})}));var p;t.default=(p=h,class extends s.ComponentBase{_buildState(e,t){return{isLightCallingTheme:l.CallUIUtils.isLightTheme()}}render(){return(0,a.jsx)(p,{isLightCallingTheme:this.state.isLightCallingTheme})}})},838817:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(889391),r=i(136850),l=i(480200),c=i(471727),d=i(757139),u=i(924907),h=i(915877),p=i(733754),g=i(731844),C=i(753602),S=i(581760),m=i(311010),y=i(711828),f=i(163841),b=i(853374),_=(0,h.lazyProperties)({container:()=>o.Styles.createViewStyle({alignItems:"flex-end"}),innerContainer:()=>o.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"center",overflow:"visible",flexDirection:"row",width:void 0})});class T extends C.default{constructor(){super(...arguments),this._showMenu=e=>{const t=()=>this._buttonRef,i=this._getRootViewId();d.default.showWithContent({menuId:d.default.menuId(),anchor:t,rootViewId:i,menuHeight:u.default.getLayoutPickerHeight(this.state.availableMenuItems),content:(0,a.jsx)(u.default,{anchor:t,rootViewId:i,callId:this.props.callId,conversationMri:this.props.conversationMri,useMobileControls:this.props.useMobileCallControls,isIncomingOrOutGoingRing:this.props.isIncomingOrOutGoingRing,showFullScreenOption:this.state.showFullScreenOptionInRibbonSettings,isInFullscreenMode:e,availableItems:this.state.availableMenuItems}),getTitle:()=>{},onCloseMenu:e=>d.default.close(i,e),onMenuClosed:this._onMenuClosed,colorThemeOverride:f.Theme.ColorfulDark,hidePopupArrow:!0,staticContent:!0,menuWidth:264,borderRadius:8,offset:{x:-l.RibbonSizes.ribbonItemSizeSmall-20,y:0}},b.default.newCauseId()),this.setState({isMenuShown:!0})},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach((e=>{e.markAsSeen&&e.markAsSeen()}))}}_buildState(e,t){const i=s.default.getS4LCMCFeatures().enableFullScreenOnWeb,a=c.default.getAvailableMenuItems(e.callId,i,e.useMobileCallControls,e.conversationMri);return Object.assign(Object.assign({},super._buildState(e,t)),{stageMode:r.default.getStageMode(e.callId),showFullScreenOptionInRibbonSettings:i,menuContainsNewItem:n.some(a,(e=>e.isNew)),availableMenuItems:a})}_iconSize(){return y.IconSize.size16}_iconColor(){return S.Color.white}_labelStyle(){return[m.default.fontStyle.bodySmallDeprecated,o.Styles.createTextStyle({color:S.Color.white},!1)]}_containerStyle(){return _.innerContainer}_getMainContainerStyles(){return _.container}_iconBackgroundColor(){return S.Color.transparent}_icon(){return c.default.getIconForStageMode(this.state.stageMode,!1)}_label(){return c.default.getStageModeItemTitle(this.state.stageMode,!1)}_tooltip(){return this._intLabel()}_accessibilityLabel(){return this._intLabel()}_shouldRenderRedDot(){return this.state.menuContainsNewItem}_handleOnPress(e){this.state.isMenuShown&&d.default.close(this._getRootViewId(),b.default.newCauseId()),this.state.menuContainsNewItem&&this.setState({menuContainsNewItem:!1}),this.state.showFullScreenOptionInRibbonSettings?g.default.isFullScreenMode(this._getRootViewId()).then((e=>{this._showMenu(e)})):this._showMenu(!1)}_intLabel(){return p.getString("CallPanel.RibbonLayoutAccessibilityLabel")}}t.default=T},74074:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(889391),r=i(136850),l=i(471727),c=i(757139),d=i(924907),u=i(915877),h=i(733754),p=i(731844),g=i(581760),C=i(311010),S=i(711828),m=i(163841),y=i(853374),f=i(24576),b=i(136400),_=i(619675),T=i(110117),v=g.Color.gray400,w=(0,u.lazyProperties)({innerContainer:()=>o.Styles.createViewStyle({justifyContent:"flex-end",alignItems:"center",overflow:"visible",flexDirection:"row",width:void 0}),label:()=>o.Styles.createTextStyle({backgroundColor:g.Color.transparent,textAlign:"center",textAlignVertical:"center",marginHorizontal:5,paddingBottom:1,color:g.Color.white,fontSize:C.default.fontSize.size13Deprecated,font:C.default.font.uiDisplayRegular}),labelLightTheme:()=>o.Styles.createTextStyle({color:v}),iconStyle:()=>o.Styles.createViewStyle({overflow:"visible"}),chevronIcon:()=>o.Styles.createViewStyle({marginLeft:5}),redDot:()=>o.Styles.createViewStyle({width:8,height:8,borderRadius:4,backgroundColor:g.Color.red,position:"absolute",left:10,top:8})});class I extends f.default{constructor(){super(...arguments),this._handleOnPress=e=>{this.state.isMenuShown&&c.default.close(this._getRootViewId(),y.default.newCauseId()),this.state.menuContainsNewItem&&this.setState({menuContainsNewItem:!1}),this.state.showFullScreenOption?p.default.isFullScreenMode(this._getRootViewId()).then((e=>{this._showMenu(e)})):this._showMenu(!1)},this._onButtonRef=e=>{this._buttonRef=e||void 0},this._showMenu=e=>{const t=()=>this._buttonRef,i=this._getRootViewId();c.default.showWithContent({menuId:c.default.menuId(),anchor:t,rootViewId:i,menuHeight:d.default.getLayoutPickerHeight(this.state.availableMenuItems),content:(0,a.jsx)(d.default,{anchor:t,rootViewId:i,callId:this.props.callId,conversationMri:this.props.conversationMri,useMobileControls:this.props.useMobileCallControls,isIncomingOrOutGoingRing:this.props.isIncomingOrOutGoingRing,showFullScreenOption:this.state.showFullScreenOption,isInFullscreenMode:e,availableItems:this.state.availableMenuItems,itemColor:this.props.useLightTheme?v:void 0,dividerColor:this.props.useLightTheme?this._themeColors.dividerColor:void 0}),getTitle:()=>{},onCloseMenu:e=>c.default.close(i,e),onMenuClosed:this._onMenuClosed,colorThemeOverride:this.props.useLightTheme?m.Theme.Colorful:m.Theme.ColorfulDark,hidePopupArrow:!0,staticContent:!0,menuWidth:302,borderRadius:8,backgroundColor:this.props.useLightTheme?this._themeColors.primaryBackgroundColor:"#292828"},y.default.newCauseId()),this.setState({isMenuShown:!0})},this._onMenuClosed=e=>{this.state.availableMenuItems.forEach((e=>{e.markAsSeen&&e.markAsSeen()}))}}_buildState(e,t){const i=s.default.getS4LCMCFeatures().enableFullScreenOnWeb,a=l.default.getAvailableMenuItemsV2(e.callId,i,e.useMobileCallControls,e.conversationMri);return{isMenuShown:this.state&&this.state.isMenuShown,stageMode:r.default.getStageMode(e.callId),showFullScreenOption:i,menuContainsNewItem:n.some(a,(e=>e.isNew)),availableMenuItems:a}}render(){const e=[w.label,this.props.useLightTheme?w.labelLightTheme:void 0],t=(0,a.jsx)(_.BodyText,Object.assign({style:e},{children:h.getString("CallPanel.CallHeaderViewLabel")})),i=this.props.useLightTheme?v:g.Color.white,n=(0,a.jsx)(T.default,{icon:S.SkypeIcon.GridView,size:S.IconSize.size16,color:i,style:w.iconStyle}),s=[w.innerContainer,o.Styles.createViewStyle({backgroundColor:g.Color.transparent,height:this.props.height},!1)],r=this._intLabel(),l={style:s,title:this._intLabel(),accessibilityLabel:r,onPress:this._handleOnPress};return(0,a.jsxs)(b.HoverableButton,Object.assign({},l,{ref:this._onButtonRef},{children:[n,t,this.state.menuContainsNewItem?(0,a.jsx)(o.View,{style:w.redDot}):void 0]}))}_intLabel(){return h.getString("CallPanel.RibbonLayoutAccessibilityLabel")}}t.default=I},924907:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(889391),o=i(220187),s=i(994224),r=i(136850),l=i(109520),c=i(502278),d=i(480200),u=i(471727),h=i(671830),p=i(144228),g=i(757139),C=i(366355),S=i(436237),m=i(435025),y=i(733754),f=i(731844),b=i(711828),_=i(853374),T=i(178735),v={[d.StageMode.Speaker]:l.CallViewMenuActions.SwitchToSpeaker,[d.StageMode.Presentation]:l.CallViewMenuActions.SwitchToPresentation,[d.StageMode.FocusedScreenShare]:l.CallViewMenuActions.SwitchToContent,[d.StageMode.Grid]:l.CallViewMenuActions.SwitchToModernGrid,[d.StageMode.TogetherMode]:l.CallViewMenuActions.SwitchToTogetherMode,[d.StageMode.LargeGrid]:l.CallViewMenuActions.SwitchToLargeGallery},w={[d.CallPanelHeaderLayout.Window]:"CallPanel.CallHeaderLayoutWindowLabel",[d.CallPanelHeaderLayout.Float]:"CallPanel.CallHeaderLayoutFloatLabel"},I={[d.CallPanelHeaderLayout.Window]:l.CallViewMenuActions.SwitchToWindow,[d.CallPanelHeaderLayout.Float]:l.CallViewMenuActions.SwitchToFloat};class P extends p.default{static getLayoutPickerHeight(e){const t=d.DesktopLayoutPickerItemHeight;return a.sum(a.map(e,(e=>e.type===d.LayoutPickerMenuItemType.Divider?11:t)))}_buildState(e,t){const i={isPSTNCall:s.default.CallingStore.isPSTNCall(e.callId),isEncryptedCall:h.isEncryptedThread(e.conversationMri),conversationMri:e.conversationMri,callId:e.callId},a=r.default.getStageMode(e.callId);this._changeCallLayoutCommand=new o.ChangeCallLayoutCommand(i,!!e.isIncomingOrOutGoingRing,a);const l=n.default.getS4LCMCFeatures();return{activeStageMode:a,activeHeaderMode:r.default.getCallHeaderLayoutMode(e.callId),tmNumberOfParticipants:l.callAudienceBotConfig.minParticipantsOnCall,lgNumberOfParticipants:l.callGridViewBotConfig.minParticipantsOnCall,activeOnlyVideoOnTheStage:r.default.getOnlyVideoOnTheStage(e.callId),isCallStageV2:l.enableNewCallScreen,isSelfInTheGrid:r.default.getSelfInTheGrid(e.callId),isTrayHidden:r.default.isTopTrayHidden(e.callId),isLightThemeStage:u.default.isLightTheme()}}_buildRows(e,t){return e.availableItems.map(((t,i)=>{const a={type:t.type,callId:e.callId,useMobileControls:e.useMobileControls,callStageV2:this.state.isCallStageV2,itemColor:e.itemColor,dividerColor:e.dividerColor};switch(t.type){case d.LayoutPickerMenuItemType.Divider:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{isDivider:!0,key:"divider"+i}));case d.LayoutPickerMenuItemType.StageModeSpeaker:case d.LayoutPickerMenuItemType.StageModeFocusedScreenShare:case d.LayoutPickerMenuItemType.StageModeGrid:case d.LayoutPickerMenuItemType.StageModeManual:case d.LayoutPickerMenuItemType.StageModePresentation:case d.LayoutPickerMenuItemType.StageModeTogetherMode:case d.LayoutPickerMenuItemType.StageModeLargeGrid:const n=u.default.layoutPickerMenuItemTypeToStageMode(t.type);return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:u.default.getIconForStageMode(n,this.state.isCallStageV2),title:u.default.getStageModeItemTitle(n,this.state.isCallStageV2),isSelected:n===u.default.displayedStageMode(this.state.activeStageMode),onRowPress:()=>this._onStageRowPress(n),changeLayoutCommand:this._changeCallLayoutCommand,tooltip:this._getTooltipForLgOrTm(n),key:d.StageMode[n]}));case d.LayoutPickerMenuItemType.OnlyVideoOnTheStage:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:b.SkypeIcon.Video,title:y.getString("CallPanel.HideAudioFromTheStage"),onRowPress:()=>this._onOnlyVideoOnTheStageRowPress(),isSelected:this.state.activeOnlyVideoOnTheStage,key:"onlyVideoOnTheStage",isNew:t.isNew}));case d.LayoutPickerMenuItemType.Fullscreen:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:this._getFullscreenModeIcon(!!e.isInFullscreenMode),title:this._getFullscreenModeItemTitle(!!e.isInFullscreenMode),onRowPress:()=>this._onFullScreenRowPress(!e.isInFullscreenMode),key:"fullscreen"}));case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile:case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat:case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow:case d.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone:const o=u.default.layoutPickerMenuItemTypeToHeaderMode(t.type);return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{title:this._getHeaderModeItemTitle(o),isSelected:o===this.state.activeHeaderMode,onRowPress:()=>this._onHeaderRowPress(o),key:d.CallPanelHeaderLayout[o]}));case d.LayoutPickerMenuItemType.SelfInTheGridToggle:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:b.SkypeIcon.Contact,title:y.getString("CallPanel.ShowMyselfInTheGrid"),isSelected:this.state.isSelfInTheGrid,onRowPress:()=>this._onSelfInTheGridToggled(),key:"selfInGrid",isNew:t.isNew}));case d.LayoutPickerMenuItemType.HidePeopleAtTop:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:b.SkypeIcon.TopPanelCollapse,title:y.getString("CallPanel.HidePeopleAtTop"),onRowPress:()=>this._onTopTrayCollapseExpandPress(),key:"hideTray"}));case d.LayoutPickerMenuItemType.ShowPeopleAtTop:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:b.SkypeIcon.TopPanelExpand,title:y.getString("CallPanel.ShowPeopleAtTop"),onRowPress:()=>this._onTopTrayCollapseExpandPress(),key:"showTray"}));case d.LayoutPickerMenuItemType.SwitchToDarkThemeStage:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:b.SkypeIcon.Lightbulb,title:y.getString("CallPanel.SwitchToDarkThemeStage"),onRowPress:()=>this._onSwitchThemeButtonPress(),key:"switchToDarkThemeStage"}));case d.LayoutPickerMenuItemType.SwitchToLightThemeStage:return this._buildSimpleRowBuilder(Object.assign(Object.assign({},a),{icon:b.SkypeIcon.Lightbulb,title:y.getString("CallPanel.SwitchToLightThemeStage"),onRowPress:()=>this._onSwitchThemeButtonPress(),key:"switchToLightThemeStage"}))}}))}_buildSimpleRowBuilder(e){return{props:e,builder:m.default.buildRow}}_onStageRowPress(e){this._changeCallLayoutCommand.execute(e),g.default.close(this.props.rootViewId,_.default.newCauseId()),c.default.trackCallViewMenuActions(v[e])}_onHeaderRowPress(e){r.default.setCallHeaderLayoutMode(this.props.callId,e),g.default.close(this.props.rootViewId,_.default.newCauseId()),c.default.trackCallViewMenuActions(I[e])}_onOnlyVideoOnTheStageRowPress(){const e=!this.state.activeOnlyVideoOnTheStage;r.default.setOnlyVideoOnTheStage(this.props.callId,e),this._forgetManuallySetStageRibbonParticipantPlacements(),g.default.close(this.props.rootViewId,_.default.newCauseId());const t=e?l.CallViewMenuActions.ActivateOnlyVideoOnTheStage:l.CallViewMenuActions.DeactivateOnlyVideoOnTheStage;c.default.trackCallViewMenuActions(t)}_forgetManuallySetStageRibbonParticipantPlacements(){this.state.activeStageMode===d.StageMode.Manual&&this._changeCallLayoutCommand.execute(d.StageMode.Grid),s.default.OngoingCallService.setStagedParticipantsSelection(this.props.callId,void 0)}_onSelfInTheGridToggled(){const e=!this.state.isSelfInTheGrid;r.default.setSelfInTheGrid(e,this.props.callId),g.default.close(this.props.rootViewId,_.default.newCauseId());const t=e?l.CallViewMenuActions.ActivateSelfInTheGrid:l.CallViewMenuActions.DeactivateSelfInTheGrid;c.default.trackCallViewMenuActions(t)}_onTopTrayCollapseExpandPress(){const e=!this.state.isTrayHidden;r.default.setHideTopTray(e,this.props.callId),g.default.close(this.props.rootViewId,_.default.newCauseId()),S.track(new l.ToggleCallTray(this.props.callId,e))}_onSwitchThemeButtonPress(){const e=!this.state.isLightThemeStage;T.default.setLightThemeCallStageEnabled(e),g.default.close(this.props.rootViewId,_.default.newCauseId());const t=e?l.CallViewMenuActions.SwitchToLightThemeStage:l.CallViewMenuActions.SwitchToDarkThemeStage;c.default.trackCallViewMenuActions(t)}_onFullScreenRowPress(e){g.default.close(this.props.rootViewId,_.default.newCauseId()),e?f.default.tryEnterFullScreenMode(this.props.rootViewId).then((e=>{e?(S.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.EnterFullScreen)),c.default.trackCallViewMenuActions(l.CallViewMenuActions.EnterFullScreen)):S.log(C.LogTraceArea.CallingUI,"Failed to Enter Full Screen Mode")})):f.default.exitFullScreenMode(this.props.rootViewId).then((()=>{S.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.ExitFullScreen))})).catch((e=>{S.log(C.LogTraceArea.CallingUI,"Failed to exit full screen mode:")}))}_getTooltipForLgOrTm(e){if(e===d.StageMode.TogetherMode||e===d.StageMode.LargeGrid)return y.getString("CallPanel.StageModeRequiresMoreParticipantsTooltip",{count:d.StageMode.TogetherMode?this.state.tmNumberOfParticipants:this.state.lgNumberOfParticipants})}_getHeaderModeItemTitle(e){const t=w[e];return t?y.getString(t):(S.error(C.LogTraceArea.CallingUI,"No title found for header mode: "+d.CallPanelHeaderLayout[e]),"")}_getFullscreenModeItemTitle(e){return e?y.getString("CallPanel.ExitFullScreen"):y.getString("CallPanel.EnterFullScreen")}_getFullscreenModeIcon(e){return e?b.SkypeIcon.FitToWindow:b.SkypeIcon.ViewSwitcher}}t.default=P},435025:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(480200),r=i(153211),l=i(915877),c=i(581760),d=i(311010),u=i(711828),h=i(24576),p=i(136850),g=i(471727),C=i(994224),S=i(76514),m=i(156018),y=(0,l.lazyProperties)({dividerDesktop:()=>o.Styles.createViewStyle({borderBottomWidth:1,height:1,marginTop:5,marginBottom:5,borderColor:c.Color.gray400Overlay70}),dividerDesktopV2:()=>o.Styles.createViewStyle({height:2,marginTop:4,marginBottom:4,backgroundColor:"#11100F"}),dividerMobile:()=>o.Styles.createViewStyle({borderBottomWidth:1,height:1,borderColor:c.Color.whiteOverlay70}),rowMobile:()=>o.Styles.createViewStyle({marginHorizontal:16}),hoverStyle:()=>o.Styles.createViewStyle({backgroundColor:c.Color.gray200Overlay20})}),f=c.Color.white;class b extends h.default{constructor(){super(...arguments),this._onContainerRef=e=>{this._containerRef=e||void 0}}_buildState(e,t){return{disabled:this._isDisabled(e),isSelected:this._isSelected(e)}}_isDisabled(e){let t=!1;const i=g.default.layoutPickerMenuItemTypeToStageMode(e.type);if(e.changeLayoutCommand&&!n.isUndefined(i)&&(t=!e.changeLayoutCommand.canExecuteForStageMode(i)),e.type===s.LayoutPickerMenuItemType.SelfInTheGridToggle){const i=p.default.getOnlyVideoOnTheStage(e.callId)&&!C.default.CallingStore.isProvidingVideo(e.callId),a=S.default.hasPinnedParticipants(e.callId);(i||a)&&(t=!0)}return e.type===s.LayoutPickerMenuItemType.OnlyVideoOnTheStage&&S.default.getPinnedParticipants(e.callId)&&(t=!0),e.type!==s.LayoutPickerMenuItemType.HidePeopleAtTop||m.default.trayHasParticipants(e.callId)||(t=!0),t}_isSelected(e){let t=e.isSelected;if(e.type===s.LayoutPickerMenuItemType.SelfInTheGridToggle){const i=p.default.getOnlyVideoOnTheStage(e.callId)&&!C.default.CallingStore.isProvidingVideo(e.callId),a=S.default.hasPinnedParticipants(e.callId);(i||a)&&(t=!1)}return e.type===s.LayoutPickerMenuItemType.OnlyVideoOnTheStage&&S.default.hasPinnedParticipants(e.callId)&&(t=!1),!!t}render(){if(this.props.isDivider)return this._renderDivider();const e=this.props.itemColor?this.props.itemColor:f,t={onRef:this._onContainerRef,icon:this.props.icon,accessibilityLabel:this.props.title||"",titleText:this.props.title,onRowPress:this.props.onRowPress,colorThemeOverride:this.props.colorThemeOverride,rowHeight:this._getRowHeight(),titleTextColor:e,accessoryIcon:this.state.isSelected?u.SkypeIcon.Ok:void 0,titleStyle:d.default.fontStyle.bodySmallDeprecated,iconSize:u.IconSize.size16,accessoryIconSize:u.IconSize.size16,iconColor:e,accessoryIconColor:e,hideBorder:!this.props.showBorder,disabled:this.state.disabled,borderColor:c.Color.gray50Overlay50,tooltip:this.state.disabled?this.props.tooltip:void 0,containerStyleOverride:this.props.useMobileControls?y.rowMobile:void 0,hoverStyle:y.hoverStyle,isNew:this.props.isNew};return r.default.buildRow(t)}requestFocus(){this._containerRef&&this._containerRef.requestFocus()}_getRowHeight(){return this.props.useMobileControls?s.MobileLayoutPickerItemHeight:s.DesktopLayoutPickerItemHeight}_renderDivider(){const e=this.props.useMobileControls?y.dividerMobile:this.props.callStageV2?y.dividerDesktopV2:y.dividerDesktop;return(0,a.jsx)(o.View,{style:[e,this.props.dividerColor&&{backgroundColor:this.props.dividerColor}],importantForAccessibility:o.Types.ImportantForAccessibility.No})}}b.buildRow=e=>(0,a.jsx)(b,Object.assign({},e)),t.default=b},334548:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NewCallReactionsView=void 0;const a=i(785893),n=i(516778),o=i(24576),s=i(3573),r=i(480200),l=i(915877),c=i(680837),d=i(366355),u=i(853374),h=i(436237),p=i(662602),g=i(18078),C=(0,l.lazyProperties)({reactionsView:()=>c.default.absoluteFill});class S extends o.default{constructor(){super(...arguments),this._stageReactionsAnimatedOpacityValue=new n.Animated.Value(1),this._stageReactionsAnimatedStyle=n.Styles.createAnimatedViewStyle({opacity:this._stageReactionsAnimatedOpacityValue}),this._getAnchorInfoChanges=(e,t)=>{},this._onTextReactionPressed=()=>{if(this.props.onTextReactionPressed){const e=u.default.newCauseId();h.log(d.LogTraceArea.CallingUI,"CallStageView._onTextReactionPressed, causeId: "+e),this.props.onTextReactionPressed(e)}},this._getAnchorInfo=e=>{const t=g.default.isMyMri(e)?r.CallStageElementKeys.localUserKey:e;let i;return p.default.measureLayoutRelativeToAncestor((()=>this.props.getChildRef(t)),this.props.getParentRef).then((e=>{i={rect:e,hidden:!1}})),i}}render(){return this.props.disableReactions?null:(0,a.jsx)(n.Animated.View,Object.assign({style:[C.reactionsView,this._stageReactionsAnimatedStyle],ignorePointerEvents:!0},{children:(0,a.jsx)(s.default,{reactionsConversationMri:this.props.reactionsConversationId,ignorePointerEvents:!0,parentDimensions:this.props.parentDimensions,topOffsetForUnhandledReactions:0,alignRight:!0,getAnchorInfo:this._getAnchorInfo,getAnchorInfoChanges:this._getAnchorInfoChanges,getCallReactionsDisplayHelper:this.props.getCallReactionsDisplayHelper,onReactionTap:this._onTextReactionPressed})}),r.CallStageElementKeys.callTextReactionViewKey)}}t.NewCallReactionsView=S},454704:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TrayOverflowButton=void 0;const a=i(785893),n=i(516778),o=i(24576),s=i(581760),r=i(915877),l=i(311010),c=i(136400),d=i(619675),u=i(480200),h=i(853374),p=i(436237),g=i(366355),C=u.BigTrayCallParticipantAvatarSize,S=(0,r.lazyProperties)({overflowButtonContainer:()=>n.Styles.createViewStyle({backgroundColor:s.Color.transparent,width:u.BigTrayOverflowButtonSize,flexShrink:0,flexGrow:0,alignContent:"center",justifyContent:"center",alignItems:"center",alignSelf:"stretch"}),overflowButton:()=>n.Styles.createButtonStyle({width:C,height:C,borderRadius:C/2,backgroundColor:s.Color.gray200Overlay60,alignContent:"center",justifyContent:"center"}),overflowButtonLightTheme:()=>n.Styles.createButtonStyle({backgroundColor:s.Color.gray100}),overflowButtonLabel:()=>n.Styles.createTextStyle({color:s.Color.whiteOverlay80,backgroundColor:s.Color.transparent,textAlign:"center",textAlignVertical:"center",paddingBottom:1,fontSize:l.default.fontSize.size18}),overflowButtonLabelLightTheme:()=>n.Styles.createTextStyle({color:s.Color.gray400})});class m extends o.default{constructor(){super(...arguments),this._onPress=()=>{const e=h.default.newCauseId();p.log(g.LogTraceArea.CallingUI,"OverflowButton._onPress "+e),this.props.onOverflowButtonPress(e,u.CallRosterOrigin.TrayOverflowButton,!1)}}render(){if(!this.props.hiddenParticipantsNumber)return null;const{buttonSizeMultiplier:e=1}=this.props,t=[S.overflowButtonContainer],i=[S.overflowButton],o=[S.overflowButtonLabel];if(1!==e){const a=n.Styles.createViewStyle({width:u.BigTrayOverflowButtonSize*e},!1),s=n.Styles.createButtonStyle({width:C*e,height:C*e,borderRadius:C},!1),r=n.Styles.createTextStyle({fontSize:e<1?l.default.fontSize.size16:l.default.fontSize.size18},!1);t.push(a),i.push(s),o.push(r)}return this.props.showTrayVertically&&t.push(n.Styles.createViewStyle({height:u.BigTrayOverflowButtonSize*e},!1)),this.props.useLightTheme&&(i.push(S.overflowButtonLightTheme),o.push(S.overflowButtonLabelLightTheme)),(0,a.jsx)(n.View,Object.assign({style:t},{children:(0,a.jsx)(c.HoverableButton,Object.assign({style:i,onPress:this._onPress},{children:(0,a.jsx)(d.BodyText,Object.assign({style:o},{children:`+${this.props.hiddenParticipantsNumber}`}))}))}))}}t.TrayOverflowButton=m},18128:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(217041),o=i(889391),s=i(766649);class r extends n.ComponentBase{_buildState(e,t){const i=o.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.DarkerDialerBarEnabled;return{onPress:e.onPress,enableDarkerColors:i,disableHighBandwidthOperations:s.default.isUsingGogoNetwork()}}render(){const e=this.props.layoutComponent;return(0,a.jsx)(e,{experimentSettings:this.props.experimentSettings,onPress:this.state.onPress,onCallButtonPress:this.props.onCallButtonPress,enableDarkerColors:this.state.enableDarkerColors,disabled:this.state.disableHighBandwidthOperations})}}t.default=r},681011:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(18128),o=i(396114),s=i(340493);class r extends o.LayoutExperiment{constructor(e){super(e,"DialpadBar")}_getOptionFromConf(){return"revert"}render(){const e=this._getLayoutToDisplay();if(e)return(0,a.jsx)(n.default,Object.assign({layoutComponent:e,experimentSettings:this._getExperimentSettings()},this.props));if(this.props.defaultComponent){const e=this.props.defaultComponent;return(0,a.jsx)(e,Object.assign({experimentSettings:this._getExperimentSettings()},this.props))}return null}_getLayoutToDisplay(){return s.default}}t.default=r},340493:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=(i(583367),i(967593)),s=i(110117),r=i(502830),l=i(915877),c=i(733754),d=i(89808),u=i(29130),h=i(126978),p=i(581760),g=i(711828),C=(i(360305),i(619675)),S=i(24576),m=(0,l.lazyProperties)({container:()=>n.Styles.createViewStyle({flexDirection:"row",flex:1,paddingVertical:12,justifyContent:"center",bottom:0}),buttonContainer:()=>n.Styles.createViewStyle({alignItems:"center",flex:1,flexGrow:0,flexDirection:"row",height:50,borderRadius:28}),actionButtonStyle:()=>n.Styles.createViewStyle({flex:1,alignItems:"center",flexDirection:"row",borderRadius:20,paddingHorizontal:20}),buttonText:()=>n.Styles.createTextStyle({color:p.Color.white,flex:0,maxWidth:180}),addToCallMargins:()=>n.Styles.createViewStyle({marginLeft:6,marginRight:3}),dialpadMargin:()=>n.Styles.createViewStyle({marginRight:6}),dialpadMarginMulti:()=>n.Styles.createViewStyle({marginLeft:3})});class y extends S.default{constructor(){super(...arguments),this._callButtonLabelName="QuickCallPanel.SkypeCallLabel",this._onPress=()=>{this.props.onPress&&this.props.experimentSettings&&(r.default.registerDialerButtonClickAction(this.props.experimentSettings),this.props.onPress())},this._onCallButtonPress=e=>{this.props.onCallButtonPress&&this.props.experimentSettings&&(r.default.registerCallButtonClickAction(this.props.experimentSettings),this.props.onCallButtonPress(e))},this._onLayout=e=>{this.isComponentMounted()&&this._useLayoutWidth()&&this.setState({width:e.width})}}_buildState(e,t){const i=this._getRootViewId();return{orientation:u.default.getDeviceOrientation(i),useIOSLandscapeStyles:!1,width:this._useLayoutWidth()?void 0:this._getContext().isPresentedInDesktopLeftNav?h.default.getWidth():u.default.getWidth(i),gradientColors:d.default.getGradientColors(),primaryColor:d.default.getPrimaryColor()}}componentDidMount(){super.componentDidMount(),this.props.experimentSettings&&r.default.registerOpenAction(this.props.experimentSettings)}render(){const e=this._useAccessibleTheme()?this._themeColors.primaryIconColor:this.state.primaryColor,t=n.Styles.createViewStyle({borderColor:e,borderWidth:2,backgroundColor:this._themeColors.primaryBackgroundColor},!1),i=n.Styles.createTextStyle({color:e},!1);let r,l;const d=this._isPresentedInDesktopLeftNav()?1:2;if(this.state.width){const e=this.state.width-(this.state.useIOSLandscapeStyles?60:0);r=n.Styles.createViewStyle({position:"absolute",width:this.state.width,paddingHorizontal:this.state.useIOSLandscapeStyles?20:void 0},!1),l=n.Styles.createViewStyle({width:.9*e/d},!1)}const u=this._isPresentedInDesktopLeftNav()?void 0:(0,a.jsx)(n.View,Object.assign({style:[m.buttonContainer,t,l,m.addToCallMargins]},{children:(0,a.jsxs)(n.Button,Object.assign({style:[m.actionButtonStyle,l],onPress:this._onCallButtonPress,accessibilityLabel:c.getString("QuickCallPanel.PanelHeaderNewCall"),disabled:this.props.disabled},{children:[(0,a.jsx)(s.default,{icon:g.SkypeIcon.CallAdd,color:e,size:g.IconSize.size24}),(0,a.jsx)(C.BodyText,Object.assign({bold:!0,style:[m.buttonText,i],allowFontScaling:!1},{children:c.getString(this._callButtonLabelName)}))]}))}),"AddCallButton"),h=this._useAccessibleTheme()?n.Styles.createTextStyle({color:this._themeColors.primaryBackgroundColor},!1):void 0,p=(0,a.jsxs)(n.Button,Object.assign({style:[m.actionButtonStyle,l],onPress:this._onPress,accessibilityLabel:c.getString("QuickCallPanel.DialpadButtonAccessibilityLabel"),disabled:this.props.disabled},{children:[(0,a.jsx)(s.default,{icon:g.SkypeIcon.Dialpad,color:this._themeColors.primaryBackgroundColor,size:g.IconSize.size24}),(0,a.jsx)(C.BodyText,Object.assign({bold:!0,style:[m.buttonText,h],allowFontScaling:!1},{children:c.getString("QuickCallPanel.DialpadButtonLabelShort")}))]}),"DialpadButton"),S=[m.dialpadMargin,d>1?m.dialpadMarginMulti:void 0];let y;if(this._useAccessibleTheme()){const e=[m.buttonContainer,l,S,n.Styles.createViewStyle({backgroundColor:this._themeColors.primaryIconColor},!1)];y=(0,a.jsx)(n.View,Object.assign({style:e},{children:p}),"Container_View")}else y=(0,a.jsx)(o.GradientView,Object.assign({style:[m.buttonContainer,l,S],colors:this.state.gradientColors,direction:o.GradientDirection.BOTTOM_RIGHT},{children:p}),"Gradient_View");return(0,a.jsxs)(n.View,Object.assign({style:[m.container,r],onLayout:this._useLayoutWidth()?this._onLayout:void 0},{children:[u,y]}))}_useLayoutWidth(){return!0}}t.default=y},396114:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutExperiment=t.ExperimentOption=void 0;const a=i(217041);var n;!function(e){e[e.Default=0]="Default",e[e.NewCta=1]="NewCta"}(n=t.ExperimentOption||(t.ExperimentOption={}));const o={default:n.Default,newCta:n.NewCta};class s extends a.ComponentBase{constructor(e,t){super(e),this._settings={name:t,location:e.location}}shouldComponentUpdate(e,t){return this.state.optionToPresent!==t.optionToPresent}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this._setSettingsLayoutOption(t.optionToPresent)}_buildState(e,t){const i={optionToPresent:this._getOptionFromConf()};return t&&this._setSettingsLayoutOption(i.optionToPresent),i}_getOptionToDisplay(){const e=this.state.optionToPresent;return o[e]?o[e]:n.Default}_getExperimentSettings(){return this._settings}_setSettingsLayoutOption(e){this._settings.layoutOption=e}}t.LayoutExperiment=s},385498:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionDefault=void 0;const a=i(785893),n=i(516778),o=i(889391),s=i(898278),r=i(944973),l=i(587134),c=i(746096),d=i(881722),u=i(913944),h=i(502830),p=i(915877),g=i(733754),C=i(866127),S=i(178735),m=i(734537),y=i(104735),f=i(827357),b=i(316392),_=i(22222),T=i(581760),v=i(640363),w=i(711828),I=i(619675),P=i(24576),M=i(22541);var k,A;!function(e){e[e.GetFreeTrial=0]="GetFreeTrial",e[e.GetCredit=1]="GetCredit",e[e.GetSubscription=2]="GetSubscription"}(k||(k={})),function(e){e[e.SkypeToPhone=0]="SkypeToPhone",e[e.Credit=1]="Credit",e[e.Subscription=2]="Subscription"}(A||(A={}));const R=(0,p.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:0,minHeight:60,paddingTop:11,paddingLeft:8,paddingRight:8,paddingBottom:3,flexDirection:"row",alignItems:"flex-start",justifyContent:"space-between"}),buttonContainer:()=>n.Styles.createViewStyle({flex:0,alignSelf:"flex-start",paddingTop:21,paddingLeft:7}),buttonContainerBroad:()=>n.Styles.createViewStyle({flex:0,alignSelf:"flex-end",paddingTop:5}),bannerContainer:()=>n.Styles.createViewStyle({alignItems:"stretch",justifyContent:"space-between",backgroundColor:T.Color.transparent}),closeIconContainer:()=>n.Styles.createViewStyle({position:"absolute",top:8,right:8,padding:4}),textContainer:()=>n.Styles.createViewStyle({flex:1,paddingLeft:7,paddingRight:8,justifyContent:"space-between",alignItems:"flex-start"}),bodyStyle:()=>n.Styles.createTextStyle({flex:1,lineHeight:18,fontSize:13}),caption:()=>n.Styles.createTextStyle({flex:1,lineHeight:16,fontSize:12})}),x={skypeToPhone:{icon:[{icon:w.SkypeIcon.GlobeCredit,color:T.Color.orangeLight},{icon:w.SkypeIcon.CreditGlobe,color:T.Color.blueDark}],buttonType:k.GetCredit,labelType:A.SkypeToPhone},credit:{icon:[{icon:w.SkypeIcon.GlobeCredit,color:T.Color.orangeLight},{icon:w.SkypeIcon.CreditGlobe,color:T.Color.blueDark}],buttonType:k.GetCredit,labelType:A.Credit},subscription:{icon:[{icon:w.SkypeIcon.Globe,color:T.Color.blue}],buttonType:k.GetSubscription,labelType:A.Subscription},freeTrial:{icon:[{icon:w.SkypeIcon.GlobeCredit,color:T.Color.orangeLight},{icon:w.SkypeIcon.CreditGlobe,color:T.Color.blueDark}],buttonType:k.GetFreeTrial,labelType:A.SkypeToPhone}};class L extends P.default{constructor(){super(...arguments),this._appVersion=v.default.getAppVersion(),this._telemetrySent=!1,this._renderActionButton=(e,t)=>t?this._renderButton(k.GetFreeTrial):"credit_only"===e?this._renderButton(k.GetSubscription):this._renderButton(k.GetCredit),this._renderButton=e=>{let t,i="";const n={buttonStyle:s.SXButtonStyle.Custom},o={textColor:T.Color.white};switch(e){case k.GetFreeTrial:t=T.AgnosticGradientFillButtonColors.green,i=g.getString("SkypeToPhonePanel.GetFreeTrialButton");break;case k.GetCredit:t=T.AgnosticGradientFillButtonColors.orange,i=g.getString("SkypeToPhonePanel.GetCreditButton");break;case k.GetSubscription:t=T.AgnosticGradientFillButtonColors.blue,i=g.getString("SkypeToPhonePanel.GetSubscriptionButton")}if(this._useAccessibleTheme()){const e=this._useDarkTheme();o.backgroundColor=e?T.Color.white:T.Color.black,o.textColor=e?T.Color.black:T.Color.white}else n.buttonStyle=s.SXButtonStyle.AgnosticGradientFill,n.agnosticGradientColor=t,n.gradientDirection=M.GradientDirection.BOTTOM_RIGHT;let r=R.buttonContainer;return i.length>16&&!this.state.isCompactView&&(r=R.buttonContainerBroad),{button:(0,a.jsx)(_.default,Object.assign({style:r,backgroundStyle:L._backgroundStyle,title:i,onPress:this._onProceedButtonPress,buttonSize:s.SXButtonSize.Small,buttonConfig:o},n),"banner_content_button"),titleLength:i.length}},this._onProceedButtonPress=e=>{let t;e.stopPropagation(),this.props.experimentSettings&&(h.default.registerBalanceStateButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),t=d.ExperimentLocation[this.props.experimentSettings.location]),y.default.navigateToBalanceStatePanel(t||"SkypeToPhoneBanner.Generic",this._getRootViewId(),void 0,"credit_only"===this.props.userEntitlementsSummary?c.BalanceStatePanelSection.Subscriptions:void 0)},this._getBannerTheme=(e,t)=>t?x.freeTrial:"credit_only"===e?x.subscription:"none"===e?x.skypeToPhone:x.credit,this._onPressClose=()=>{this.props.experimentSettings&&h.default.registerCloseButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),S.default.setUserPreferencesLocal({entitlementsBannerOptions:{visible:!1,closedForClientVersion:this._appVersion}}),this.props.onClose()}}_buildState(e,t){const i=S.default.getUserPreferencesLocal().entitlementsBannerOptions,a=i&&(i.visible||i.closedForClientVersion!==this._appVersion),n=o.default.getS4LEntitlementFeatures().SCE.SkypeToPhoneBanner.Features.BannerEnabled,s=o.default.getS4LEntitlementFeatures().SCE.SkypeToPhoneBanner.Features.ForceShowBanner;return{isEntitlementsBannerVisible:a&&(n||s)||"both"!==e.userEntitlementsSummary&&s,isCompactView:f.default.isSplitNavStackCollapsed(b.StackNavigatorId.DesktopContent),modernizeConversationList:C.default.canModernizeConversationList()}}_sendTelemetry(){this.props.experimentSettings&&this.state.isEntitlementsBannerVisible&&!this._telemetrySent&&(h.default.registerOpenAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),this._telemetrySent=!0)}componentDidMount(){super.componentDidMount(),this._sendTelemetry()}componentDidUpdate(e,t,i){super.componentDidUpdate(e,t,i),this._sendTelemetry()}render(){if(!this.state.isEntitlementsBannerVisible)return null;const e=this._getBannerTheme(this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable);let t,i=g.getString("SkypeToPhonePanel.CallPhonesSendSMS");switch(e.labelType){case A.Subscription:i=g.getString("SkypeToPhonePanel.SaveMoreText"),t=g.getString("SkypeToPhonePanel.Subscriptions");break;case A.Credit:t=g.getString("ProfileCard.SkypeCreditsLabel");break;case A.SkypeToPhone:t=g.getString("Entitlements.SkypeToPhoneTitle")}const o=(0,a.jsx)(r.default,{iconSize:w.IconSize.size58,icons:e.icon}),s=this._renderActionButton(this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),c=this.state.isCompactView||s.titleLength<17?[(0,a.jsxs)(n.View,Object.assign({style:R.textContainer},{children:[(0,a.jsx)(I.Caption,Object.assign({style:R.caption},{children:t})),(0,a.jsx)(I.BodyText,Object.assign({style:R.bodyStyle,size:this.props.useCompactLayout?I.BodyTextSize.SmallDeprecated:void 0},{children:i}))]}),"text_section"),s.button]:(0,a.jsxs)(n.View,Object.assign({style:R.textContainer},{children:[(0,a.jsx)(I.Caption,Object.assign({style:R.caption},{children:t})),(0,a.jsx)(I.BodyText,Object.assign({style:R.bodyStyle},{children:i})),s.button]})),d=(0,a.jsx)(u.default,{style:R.closeIconContainer,size:w.IconSize.size12,color:this._themeColors.primaryIconColor,hoverColor:this._themeColors.iconHoverColor,onPress:this._onPressClose,icon:w.SkypeIcon.ClosePanel,title:g.getString("Global.CloseButtonTitle")}),h=this.state.modernizeConversationList?m.default.getBannerBackgroundColorStyle(this._useDarkTheme(),this._useAccessibleTheme(),this._themeStyles):this._themeStyles.secondaryBackgroundColorStyle;return(0,a.jsxs)(n.View,Object.assign({style:R.bannerContainer},{children:[(0,a.jsx)(l.default,{}),(0,a.jsxs)(n.View,Object.assign({style:[R.container,h]},{children:[o,c]})),d]}))}}L._backgroundStyle={paddingLeft:12,paddingRight:12,borderRadius:20},t.LayoutOptionDefault=L,t.default=L},923223:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(217041),s=i(739119),r=i(904604),l=(i(259261),i(473367)),c=i(334387);class d extends o.ComponentBase{_buildState(e,t){const i=r.default.getSubscriptions(),a=r.default.getCreditEntitlement(),o=l.default.getLoadedPersonalizedRecommendations();return{userEntitlementsSummary:s.getEntitlementCombination(a,i),isFreeTrialAvailable:o&&n.some(o.callingOffers,(e=>e.isFreeTrial)),shouldUseGPlayBilling:c.default.shouldUseGooglePlayBillingForCredit()||c.default.shouldUseGooglePlayBillingForSubscriptions()}}componentDidMount(){super.componentDidMount(),this.state.shouldUseGPlayBilling?c.default.requestUpdate():l.default.requestPersonalizedRecommendationsUpdate()}render(){const e=this.props.layoutComponent;return(0,a.jsx)(e,{experimentSettings:this.props.experimentSettings,userEntitlementsSummary:this.state.userEntitlementsSummary,isFreeTrialAvailable:this.state.isFreeTrialAvailable,useCompactLayout:this.props.useCompactLayout,onClose:this.props.onClose})}}t.default=d},858585:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(889391),o=i(396114),s=i(385498),r=i(923223);class l extends o.LayoutExperiment{constructor(e){super(e,"SkypeToPhoneBanner")}_getOptionFromConf(){return n.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Experiments.SkypeToPhoneBanner}render(){return(0,a.jsx)(r.default,Object.assign({layoutComponent:s.default,experimentSettings:this._getExperimentSettings()},this.props))}}t.default=l},532516:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionDefault=void 0;const a=i(785893),n=i(516778),o=i(244770),s=i(898278),r=i(913944),l=i(502830),c=i(915877),d=i(733754),u=i(451072),h=i(104735),p=i(22222),g=i(581760),C=i(711828),S=i(734528),m=i(680837),y=i(619675),f=i(24576),b=i(889391),_=o.Collection.SKYPE_TO_PHONE_SMALL,T=(0,c.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,flexDirection:"row",alignItems:"center",paddingHorizontal:10,paddingVertical:4,marginTop:5}),iconContainer:()=>n.Styles.createViewStyle({width:40,height:40,marginRight:10,flexDirection:"row",alignItems:"center",justifyContent:"center",overflow:"visible"}),iconStyle:()=>n.Styles.createImageStyle({width:40,height:40,justifyContent:"center",overflow:"visible"}),labelsContainer:()=>n.Styles.createViewStyle({flex:1,paddingLeft:5}),topTextLine:()=>n.Styles.createViewStyle({flexDirection:"row",justifyContent:"space-between"}),bottomTextLine:()=>n.Styles.createViewStyle({marginTop:2}),rightLabelText:()=>n.Styles.createTextStyle({textAlignVertical:"center",height:20}),rightPartView:()=>n.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"center",paddingHorizontal:6,overflow:"visible"}),forwardButton:()=>n.Styles.createViewStyle({alignItems:"center",paddingHorizontal:10}),itemDivider:()=>n.Styles.createViewStyle({height:1,marginHorizontal:10,marginTop:5}),itemDividerMiddle:()=>n.Styles.createViewStyle({height:1,marginLeft:65,marginTop:0}),itemDividerDarkeTheme:()=>n.Styles.createViewStyle({backgroundColor:g.Color.gray400})});class v extends f.default{constructor(){super(...arguments),this._onProceedButtonPress=e=>{e.stopPropagation(),this.props.experimentSettings&&l.default.registerBalanceStateButtonClickAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable),h.default.navigateToBalanceStatePanel("DialerPanel.UserEntitlements.navigateBalanceState",this._getRootViewId())},this._renderImage=(e,t)=>{const i=[T.iconStyle];return t&&i.push(t),(0,a.jsx)(n.Image,{style:i,source:e})},this._renderOptionalSpacer=(e,t)=>{},this._renderTopText=e=>(0,a.jsx)(n.View,Object.assign({style:T.topTextLine},{children:(0,a.jsx)(y.RowTitle,Object.assign({style:m.default.flexOne,numberOfLines:2},{children:e}))}))}_buildState(){return{enableRefreshedPalette:b.default.getS4LUiFeatures().enableRefreshedPalette}}componentDidMount(){super.componentDidMount(),this.props.experimentSettings&&l.default.registerOpenAction(this.props.experimentSettings,this.props.userEntitlementsSummary,this.props.isFreeTrialAvailable)}render(){const e=[T.itemDivider];this._useDarkTheme()?e.push(T.itemDividerDarkeTheme):e.push(this._themeStyles.dividerColorStyle);const t=d.getString("Entitlements.SkypeToPhoneTitle");let i,o,l=t;if(this.props.hasCallingEntitlements){const e=d.getString("Entitlements.SubscriptionsSmallCaps",{count:this.props.subscriptionsCount});l+=", "+e,this.props.formattedBalance&&(l+=", "+this.props.formattedBalance),i=(0,a.jsx)(y.BodyText,Object.assign({style:T.bottomTextLine,numberOfLines:1,textThemeColor:y.TextThemeColor.Secondary},{children:e})),o=[(0,a.jsx)(y.RowTitle,Object.assign({style:[this._themeStyles.secondaryTextColorStyle,T.rightLabelText,m.default.pointerCursor],numberOfLines:1},{children:this.props.formattedBalance}),"creditEntitlementValueText"),(0,a.jsx)(r.default,{size:C.IconSize.size20,color:this._themeColors.disclosureArrowColor,hoverColor:this._themeColors.iconHoverColor,icon:S.navForwardIcon(),style:T.forwardButton,title:d.getString("Global.ForwardButton"),accessibilityLabel:d.getString("Global.ForwardButton")},"creditEntitlementForwardButton")]}else{const e=d.getString("Entitlements.AddFundsLabel");l+=", "+e;const t={backgroundColor:this._themeColors.buttonBackgroundColor,textColor:this._themeColors.primaryIconColor};o=(0,a.jsx)(n.View,Object.assign({blockPointerEvents:!0},{children:(0,a.jsx)(p.default,{title:e,buttonStyle:s.SXButtonStyle.Custom,buttonSize:s.SXButtonSize.Small,buttonConfig:t,allowTextWrap:!0})}))}return(0,a.jsxs)(n.View,{children:[this._renderOptionalSpacer("skypeToPhoneSpacer",[e,T.itemDividerMiddle]),(0,a.jsxs)(u.MaybeListItem.Button,Object.assign({style:[T.container,m.default.pointerCursor],accessibilityLabel:l,onPress:this._onProceedButtonPress},{children:[(0,a.jsx)(n.View,Object.assign({style:T.iconContainer},{children:this._renderImage(_,void 0)})),(0,a.jsxs)(n.View,Object.assign({style:[T.labelsContainer,m.default.pointerCursor]},{children:[this._renderTopText(t),i]})),(0,a.jsx)(n.View,Object.assign({style:T.rightPartView},{children:o}))]})),(0,a.jsx)(n.View,{style:e})]})}}t.LayoutOptionDefault=v,t.default=v},590454:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutOptionNewCta=t.ActionButtonType=void 0;const a=i(785893),n=i(496486),o=i(516778),s=i(898278),r=i(532516),l=i(915877),c=i(733754),d=i(451072),u=i(22222),h=i(581760),p=i(680837),g=i(619675),C=i(711828),S=i(944973),m=i(311010),y=i(126978),f=(i(360305),i(22541));var b;!function(e){e[e.GetFreeTrial=0]="GetFreeTrial",e[e.GetCredit=1]="GetCredit",e[e.GetSubscription=2]="GetSubscription"}(b=t.ActionButtonType||(t.ActionButtonType={}));const _=C.IconSize.size58,T=C.IconSize.size40,v=(0,l.lazyProperties)({componentContainer:()=>o.Styles.createViewStyle({paddingHorizontal:16,paddingVertical:6}),listItemContainer:()=>o.Styles.createViewStyle({flexDirection:"row"}),buttonContainer:()=>o.Styles.createViewStyle({flexDirection:"column",justifyContent:"center",paddingLeft:4,overflow:"visible"}),buttonContainerWide:()=>o.Styles.createViewStyle({maxWidth:200}),buttonContainerSmall:()=>o.Styles.createViewStyle({paddingLeft:5}),iconContainer:()=>o.Styles.createViewStyle({flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"visible"}),centerTextContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",justifyContent:"space-around",paddingVertical:3,paddingRight:4,paddingLeft:16,flexGrow:1}),entitlementsContainer:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",paddingTop:1}),regularTextStyles:()=>o.Styles.createTextStyle({font:m.default.font.uiDisplayRegular}),buttonTextStyle:()=>o.Styles.createTextStyle({textAlign:"center"}),bannerTextStyle:()=>o.Styles.createTextStyle({fontSize:13,lineHeight:18}),topTextStyle:()=>o.Styles.createTextStyle({fontSize:12,lineHeight:16})});class w extends r.default{constructor(){super(...arguments),this._renderTopText=e=>(0,a.jsx)(g.Caption,Object.assign({numberOfLines:1,style:v.regularTextStyles},{children:e})),this._getButtonContainerResponsiveMaxWidth=()=>{let e;if(this.props.isLandscape)e=95;else{const t=y.default.getWidthNoSubscription(y.SideBar.Left);e=Math.ceil((t-32-_)/2)}return o.Styles.createViewStyle({maxWidth:e},!1)}}render(){const e=[v.iconContainer],t=[v.buttonContainer],i=[v.centerTextContainer];this.props.isSmallDevice&&!this.props.isLandscape&&t.push(v.buttonContainerSmall),t.push(this._getButtonContainerResponsiveMaxWidth());const s=c.getString("Entitlements.SkypeToPhoneTitle"),r=this._renderTopText(s),l=this._renderCenterText(),u=this._renderActionButton(),g=[s,l.accessibilityLabel,u.accessibilityLabel],m=n.join(g,", "),y=[{icon:C.SkypeIcon.GlobeCredit,color:h.Color.orangeLight},{icon:C.SkypeIcon.CreditGlobe,color:h.Color.blueDark}],f=this.props.isLandscape?T:_;return(0,a.jsx)(o.View,Object.assign({style:v.componentContainer},{children:(0,a.jsxs)(d.MaybeListItem.Button,Object.assign({style:[v.listItemContainer,p.default.pointerCursor],accessibilityLabel:m,onPress:this._onProceedButtonPress,accessibilityTraits:o.Types.AccessibilityTrait.Button},{children:[(0,a.jsx)(o.View,Object.assign({style:e},{children:(0,a.jsx)(S.default,{iconSize:f,icons:y})})),(0,a.jsxs)(o.View,Object.assign({style:i},{children:[r,l.element]})),(0,a.jsx)(o.View,Object.assign({style:t},{children:u.element}))]}))}))}_renderCenterText(){if(this.props.isFreeTrialAvailable||"none"===this.props.userEntitlementsSummary){const e=c.getString("SkypeToPhonePanel.CallPhoneNumbers");return{element:(0,a.jsx)(o.View,Object.assign({style:v.entitlementsContainer},{children:(0,a.jsx)(g.Caption,Object.assign({numberOfLines:void 0,selected:!0,style:[v.regularTextStyles,v.bannerTextStyle]},{children:e}))})),accessibilityLabel:e}}{const e=this._renderCallingEntitlement(),t=this._renderSubscriptions(),i=n.compact([e?e.accessibilityLabel:void 0,t.accessibilityLabel]),s=n.join(i,", ");return{element:(0,a.jsxs)(o.View,Object.assign({style:v.entitlementsContainer},{children:[e?e.element:void 0,t.element]})),accessibilityLabel:s}}}_renderActionButton(){return this.props.isFreeTrialAvailable?this._renderButton(b.GetFreeTrial):"credit_only"===this.props.userEntitlementsSummary?this._renderButton(b.GetSubscription):this._renderButton(b.GetCredit)}_renderButton(e){let t,i="";const n={buttonStyle:s.SXButtonStyle.Custom},r={textColor:h.Color.white};switch(e){case b.GetFreeTrial:t=h.AgnosticGradientFillButtonColors.green,i=c.getString("SkypeToPhonePanel.GetFreeTrialButton");break;case b.GetCredit:t=h.AgnosticGradientFillButtonColors.orange,i=c.getString("SkypeToPhonePanel.GetCreditButton");break;case b.GetSubscription:t=h.AgnosticGradientFillButtonColors.blue,i=c.getString("SkypeToPhonePanel.GetSubscriptionButton")}if(this._useAccessibleTheme()){const e=this._useDarkTheme();r.backgroundColor=e?h.Color.white:h.Color.black,r.textColor=e?h.Color.black:h.Color.white}else n.buttonStyle=s.SXButtonStyle.AgnosticGradientFill,n.agnosticGradientColor=t,n.gradientDirection=f.GradientDirection.BOTTOM_RIGHT;e!==b.GetFreeTrial&&this.state.enableRefreshedPalette&&(n.buttonStyle=s.SXButtonStyle.GradientFill);return{element:(0,a.jsx)(o.View,Object.assign({blockPointerEvents:!0},{children:(0,a.jsx)(u.default,Object.assign({title:i,backgroundStyle:w._buttonBackgroundStyles,buttonSize:s.SXButtonSize.Small,buttonConfig:r,allowTextWrap:!0,textStyleOverride:[v.regularTextStyles,v.buttonTextStyle,v.bannerTextStyle]},n))})),accessibilityLabel:i}}_renderSubscriptions(){let e;e=this.props.subscriptionMinutes&&1===this.props.subscriptionsCount?-1===this.props.subscriptionMinutes?c.getString("SkypeToPhonePanel.SubscriptionUnlimited"):c.getString("SkypeToPhonePanel.SubscriptionMinutesLeft",{count:this.props.subscriptionMinutes||""}):c.getString("SkypeToPhonePanel.SubscriptionsCount",{count:this.props.subscriptionsCount});return{element:this._renderSmallBodyText(e),accessibilityLabel:e}}_renderCallingEntitlement(){if(this.props.formattedBalance){const e=c.getString("SkypeToPhonePanel.Credit",{amount:this.props.formattedBalance||""});return{element:this._renderSmallBodyText(e),accessibilityLabel:e}}}_renderSmallBodyText(e){return(0,a.jsx)(g.BodyText,Object.assign({numberOfLines:1,bold:!0,size:s.BodyTextSize.SmallDeprecated},{children:e}))}}w._buttonBackgroundStyles={borderRadius:32,paddingLeft:12,paddingRight:12,paddingTop:7,paddingBottom:7},t.LayoutOptionNewCta=w,t.default=w},422962:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(583367),s=i(217041),r=i(889391),l=i(739119),c=i(898278),d=i(904604),u=(i(259261),i(473367)),h=i(29130),p=i(334387);class g extends s.ComponentBase{_buildState(e,t){const i=d.default.getSubscriptions(),a=d.default.getCreditEntitlement(),s=u.default.getLoadedPersonalizedRecommendations();return{canRenderEntitlements:r.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.UIEnabled,userFormattedBalance:l.getFormattedBalance(a),userSubscriptionsCount:i?n.size(i):0,hasActiveCreditEntitlements:l.hasUsableCredit(a),hasCallingEntitlements:d.default.userHasSubscriptions(),userEntitlementsSummary:l.getEntitlementCombination(a,i),subscriptionMinutes:1===n.size(i)?i[0].isUnlimited?-1:i[0].availableMinutes:void 0,isFreeTrialAvailable:s&&n.some(s.callingOffers,(e=>e.isFreeTrial)),isSmallDevice:h.default.isSmallDevice(c.MainRootViewId),isLandscape:void 0!==e.isLandscape?e.isLandscape:h.default.getDeviceOrientation(c.MainRootViewId)===o.DeviceOrientation.Landscape,shouldUseGPlayBilling:p.default.shouldUseGooglePlayBillingForCredit()||p.default.shouldUseGooglePlayBillingForSubscriptions()}}componentDidMount(){super.componentDidMount(),this.state.shouldUseGPlayBilling?p.default.requestUpdate():u.default.requestPersonalizedRecommendationsUpdate()}render(){const e=this.props.layoutComponent;return(0,a.jsx)(e,{experimentSettings:this.props.experimentSettings,userEntitlementsSummary:this.state.userEntitlementsSummary,formattedBalance:this.state.userFormattedBalance,subscriptionsCount:this.state.userSubscriptionsCount,hasActiveCreditEntitlements:this.state.hasActiveCreditEntitlements,hasCallingEntitlements:this.state.hasCallingEntitlements,subscriptionMinutes:this.state.subscriptionMinutes,isFreeTrialAvailable:this.state.isFreeTrialAvailable,isSmallDevice:this.state.isSmallDevice,isLandscape:this.state.isLandscape})}}t.default=g},919364:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(889391),o=i(396114),s=i(532516),r=i(590454),l=i(422962);class c extends o.LayoutExperiment{constructor(e){super(e,"SkypeToPhoneCard")}_getOptionFromConf(){return n.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Experiments.SkypeToPhoneCard}render(){const e=this._getLayoutToDisplay();if(e)return(0,a.jsx)(l.default,Object.assign({layoutComponent:e,experimentSettings:this._getExperimentSettings()},this.props));if(this.props.defaultComponent){const e=this.props.defaultComponent;return(0,a.jsx)(e,Object.assign({experimentSettings:this._getExperimentSettings()},this.props))}return null}_getLayoutToDisplay(){return this._getOptionToDisplay()===o.ExperimentOption.NewCta?r.default:s.default}}t.default=c},105201:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GroupMemberHelper=void 0;const a=i(667294),n=i(785893),o=i(496486),s=i(746096),r=i(733754),l=i(56644),c=i(801211),d=i(204899),u=i(478262),h="groupMemberHeader",p="groupMemberFooter",g="groupMember_";class C extends d.SearchSectionHelper{constructor(e=s.SearchResultsListGroup.GroupMember){super(),this._keys={footer:p,header:h},this._groupType=e}static _getKey(e){return g+e}static _getMri(e){return e}buildConfig(e,t,i){return{inactiveCallMemberMris:t.searchController.getGroupMemberResults(t.conversationId),searchQuery:i.trimmedNormalizedQuery,limit:3}}getItems(e,t,i,a,n){const o=s.SearchResultsListGroup.GroupMember,l={itemTemplate:"groupMember",header:r.getString("QuickCallPanel.GroupMembersNotOnCallSectionHeader",{count:this._searchConfig.inactiveCallMemberMris.length})},c=d.SearchSectionHelper.generateItemsLists({searchResultsListState:e,searchResultsListProps:t,groupType:o,sourceList:this._searchConfig.inactiveCallMemberMris,keys:this._keys,renderConfig:l,getKey:C._getKey,getMri:C._getMri,limit:3,onFooterPress:n}),u=c.defaultList||[];return e.isShowingMore[this._groupType]&&u.push(...c.listWithRestOfItems),c.footerItem&&u.push(c.footerItem),c.defaultList}renderItem(e){return e.item.key===h?d.SearchSectionHelper.renderHeader(r.getString("QuickCallPanel.GroupMembersNotOnCallSectionHeader",{count:this._searchConfig.inactiveCallMemberMris.length})):e.item.key===p?this._renderFooterItem(e.item):e.item.key.substring(0,12)===g?this._renderSearchResultItem(e):void 0}_renderFooterItem(e){return(0,n.jsx)(c.default,{shouldShowAllResults:e.isShowingMore,groupType:this._groupType,onShowMorePress:e.onPress})}_renderSearchResultItem(e){const t=e.item.key.substring(12),i=d.SearchSectionHelper.getSearchBaseItemProps(e,t),n={textToHighlight:this._searchConfig.searchQuery,highlightType:u.TextToHighlightType.DisplayName};return(0,a.createElement)(l.default,Object.assign({},i,{key:"groupMemberItem",mri:t,textToHighlightInfo:n,showLastCallInfo:!1,groupType:s.SearchResultsListGroup.GroupMember,onItemPress:e.item.onListItemClick||o.noop}))}}t.GroupMemberHelper=C},797822:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.startPhoneNumberVerification=t.startPhoneNumberVerificationFromManageSearchPanel=void 0;const a=i(436237),n=i(778887),o=i(615414);function s(e,t){n.default.displayMsaPhoneAccrualDialog(e,t)}t.startPhoneNumberVerificationFromManageSearchPanel=function(e,t){a.track(new o.PnvUIStartFromManageSearchPanel),s(e,t)},t.startPhoneNumberVerification=s},633727:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PstnDialpadHelper=t.PstnDialpadItem=void 0;const a=i(785893),n=i(516778),o=i(217041),s=i(746096),r=i(881722),l=i(766649),c=i(915877),d=i(204899),u=i(919364),h="dialpad",p="dialpadSpacer",g=(0,c.lazyProperties)({spacer:()=>n.Styles.createViewStyle({height:10})});class C extends o.ComponentBase{_buildState(e,t){return{disableHighBandwidthOperations:l.default.isUsingGogoNetwork()}}requestFocus(){}render(){return(0,a.jsx)(u.default,{location:r.ExperimentLocation.CallsPanel})}}t.PstnDialpadItem=C;class S extends d.SearchSectionHelper{constructor(){super()}buildConfig(e,t,i){}getItems(e,t,i,a){const n=[];return n.push({key:h,height:56,measureHeight:!0,template:"dialpad",isLastItem:!0,groupType:s.SearchResultsListGroup.PstnDialpad,onListItemClick:t.onListItemClick,isHoverable:!1}),n}renderItem(e){return e.item.key===h?this._renderDialpadItem(e):e.item.key===p?this._renderSpacer():void 0}_renderSpacer(){return(0,a.jsx)(n.View,{style:g.spacer},p)}_renderDialpadItem(e){return(0,a.jsx)(C,Object.assign({},e))}}t.PstnDialpadHelper=S},758735:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RecentCallsHelper=void 0;const a=i(785893),n=i(496486),o=i(516778),s=i(671830),r=i(746096),l=i(915877),c=i(733754),d=i(501452),u=i(539543),h=i(34273),p=i(56644),g=i(204899),C=i(478262),S=i(172758),m="recentCallsHeader",y="recentCall_",f="noCallsItemKey",b=(0,l.lazyProperties)({noCallsContainer:()=>o.Styles.createViewStyle({paddingLeft:12,paddingRight:12,paddingTop:20,paddingBottom:20})}),_={header:m};class T extends g.SearchSectionHelper{static _getKey(e){return y+e}static _getMri(e){return e}constructor(e){super(),this._useExtendedCallCount=e}buildConfig(e,t,i){return{localPhoneContacts:u.mapLocalContactsByMri(t.searchController.getAddressBookResults()),recentCallsConversationIds:t.searchController.getRecentCallsResults(),combinedContactsConversationIds:t.searchController.getCombinedContactsResults().reduce(((e,t)=>{var i;const a=null===(i=t.skypeContact)||void 0===i?void 0:i.getMri();return a&&e.push(a),e}),[]),isSyncAddressBookEnabled:i.isSyncAddressBookEnabled,limit:this._useExtendedCallCount?50:20,searchQuery:i.trimmedNormalizedQuery,upcomingCallsCount:h.default.ScheduledCallsStore.getUpcomingScheduledCalls().length}}getItems(e,t){const i=this._useExtendedCallCount?r.SearchResultsListGroup.RecentCallsExtended:r.SearchResultsListGroup.RecentCalls;if(0===this._searchConfig.recentCallsConversationIds.length&&0===this._searchConfig.combinedContactsConversationIds.length&&0===this._searchConfig.upcomingCallsCount&&!t.hideEmptyState&&0===Object.keys(this._searchConfig.localPhoneContacts).length)return[{index:0,isLastItem:!0,key:f,height:d.default.getDefaultHeight(),measureHeight:!0,template:"noCalls",groupType:i}];const a={itemTemplate:"call",header:c.getString("QuickCallPanel.RecentCallsSectionHeader"),hideHeader:this._useExtendedCallCount};return g.SearchSectionHelper.generateItemsLists({searchResultsListState:e,searchResultsListProps:t,groupType:i,sourceList:this._searchConfig.recentCallsConversationIds.slice(0,this._searchConfig.limit),keys:_,renderConfig:a,getKey:T._getKey,getMri:T._getMri}).defaultList}renderItem(e){return e.item.key===m?g.SearchSectionHelper.renderHeader(c.getString("QuickCallPanel.RecentCallsSectionHeader")):e.item.key.substring(0,11)===y?this._renderSearchResultItem(e):e.item.key===f?this._renderNoCallsItem():void 0}_getNoCallsTitle(){return c.getString("RecentCallsHelper.NoRecentCallsTitleDesktop")}_renderNoCallsItem(){let e;return e=c.getString("RecentCallsHelper.NoRecentCallsDescriptionDesktop"),(0,a.jsx)(o.View,Object.assign({style:b.noCallsContainer},{children:(0,a.jsx)(d.default,{infoLabel:e,title:this._getNoCallsTitle()})}),"noCallsItem")}_renderSearchResultItem(e){const t=e.item.key.substring(11),i=g.SearchSectionHelper.getSearchBaseItemProps(e,t),o={key:"recentCallItem",mri:S.default.getConversationOwner(t),origin:e.origin,pstnMri:s.isPhoneMri(t)?t:void 0,showLastCallInfo:!0,onItemPress:e.item.onListItemClick||n.noop};if(s.isPhoneMri(t)){const e=this._searchConfig.localPhoneContacts[t];e&&(o.addressBookContactOverride=e,o.isAddressBookContact=!0)}const l={textToHighlight:this._searchConfig.searchQuery,highlightType:C.TextToHighlightType.DisplayName};return(0,a.jsx)(p.default,Object.assign({},i,o,{textToHighlightInfo:l,groupType:this._useExtendedCallCount?r.SearchResultsListGroup.RecentCallsExtended:r.SearchResultsListGroup.RecentCalls}))}}t.RecentCallsHelper=T},539543:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapLocalContactsByMri=void 0;const a=i(496486),n=i(671830),o=i(527683);t.mapLocalContactsByMri=function(e){const t={},i=a.compact(a.map(e,(e=>e.addressBookContact)));return a.each(i,(e=>{e&&a.each(e.phones,(i=>{if(o.default.isValidNumberString(i.number)){const a=n.getMriFromPhoneNumber(i);t[a]=e}}))})),t}},193439:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.showTranslationMenu=void 0;const a=i(785893),n=i(496486),o=i(733754),s=i(757139),r=i(437490),l=i(450845),c=i(746096),d=i(436237),u=i(824490),h=i(711828),p=i(163841),g=i(805581),C=i(853374),S=i(438891),m=i(293194),y=i(46929),f=i(889391),b=i(458666),_=i(994224),T=i(104735);t.showTranslationMenu=function e(t){d.log(c.LogTraceArea.CallingUI,`showTranslationMenu causeId: ${t.causeId}`);const i=()=>{var e;d.log(c.LogTraceArea.CallingUI,"onCloseMenu using X in header. causeId: "+t.causeId),null===(e=t.onClose)||void 0===e||e.call(t),s.default.close(t.rootViewId,t.causeId)},v=()=>{const e=C.default.newCauseId();d.log(c.LogTraceArea.CallingUI,`showTranslationMenu causeId: ${e}`);const i=o.getString("LanguageAndTranslationSettingsPanel.TranslationSystemVoiceTitle"),a=[{command:S.Gender.female,text:o.getString("LanguageAndTranslationSettingsPanel.TranslatedVoiceOptionFemale")},{command:S.Gender.male,text:o.getString("LanguageAndTranslationSettingsPanel.TranslatedVoiceOptionMale")}],n=t.rootViewId,s={anchor:()=>{},buttons:a,title:i};m.default.showWithActionMenuConfig({options:s,callback:t=>w(t,e),onCancel:()=>I(),maintainAnchor:!1,rootViewId:n,useAlertForMobile:!0,useAlertForDesktop:t.useAlertForDesktop(),invokingEvent:void 0,allowScrolling:t.useAlertForDesktop()})},w=(e,i)=>{var a;e!==S.Gender.female&&e!==S.Gender.male?d.log(c.LogTraceArea.CallingUI,`showTranslationMenu newVoice ${e} not in supported voices list. causeId: ${i}`):(y.default.setCallTranslatorBotTranslationVoice(e),null===(a=t.update)||void 0===a||a.call(t,i)),I()},I=()=>{t.useAlertForDesktop()&&e(t)},P=e=>{const t=b.getShortLanguageTitle(e);return t&&""!==t?t:e},M=e=>{const i=C.default.newCauseId();d.log(c.LogTraceArea.CallingUI,`_togglePstnTranslationLanguageMenu causeId: ${i}`);let a=o.getString("LanguageAndTranslationSettingsPanel.TranslationSelectLocalLanguageTitle");e||(a=o.getString("LanguageAndTranslationSettingsPanel.TranslationSelectOtherLanguageTitle"));const n=f.default.getS4LCMCFeaturesNoSubscription().callTranslatorBotConfig.languageSupport.speech,s=o.getLanguageFromLocale(),r=[...n].sort(((e,t)=>{const i=P(e),a=P(t);return i.localeCompare(a,s)})).map((e=>({text:P(e),command:e}))),l=t.rootViewId,u={anchor:()=>{},buttons:r,title:a};m.default.showWithActionMenuConfig({options:u,callback:a=>t.changeLanguage(e,a,i),onCancel:()=>I(),maintainAnchor:!1,rootViewId:l,useAlertForMobile:!0,useAlertForDesktop:t.useAlertForDesktop(),invokingEvent:void 0,allowScrolling:t.useAlertForDesktop()})},k=e=>{T.default.navigateToSpokenLanguagePicker(!1,t.rootViewId,e,t.conversationMri,t.changeLanguage)},A=n.throttle((()=>{const e=y.default.getCallTranslatorTruVoiceEnabled();_.default.InCallBotService.enableTruVoice(t.callId,!e)}),f.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceButtonThrottleTimeoutMs),R=n.throttle((()=>{const e=y.default.getCallTranslatorTranslationAutoDetectEnabled();_.default.InCallBotService.enableAutoDetect(t.callId,!e)}),f.default.getS4LCMCFeaturesNoSubscription().translationFeatures.autoDetectButtonThrottleTimeoutMs),x={callId:t.callId,conversationMri:t.conversationMri,isPSTNCall:t.isPstnCall,isEncryptedCall:!1,callerContext:t.callerContext,callUIState:t.callUIState},L=t.useLightTheme?p.Theme.Delphi:p.Theme.DelphiDark,V=(0,a.jsx)(l.default,Object.assign({isPstnTranslation:t.isPstnTranslation,isSkypeTranslation:t.isSkypeTranslation,colorThemeOverride:L,isUsingStackNavigationContext:t.isUsingStackNavigationContext,translateCall:t.startTranslation,changeVoice:()=>{const e=C.default.newCauseId();d.log(c.LogTraceArea.CallingUI,`_togglePstnTranslationChangeVoice causeId: ${e}`),v()},changeLanguage:e=>{const t=C.default.newCauseId();d.log(c.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.Button Change my language pressed causeId: ${t}`),f.default.getS4LCMCFeaturesNoSubscription().enableNewLanguageSelectors?k(e):M(e)},flipLanguages:()=>{var e;const i=C.default.newCauseId();d.log(c.LogTraceArea.CallingUI,`PstnTranslatorCallControlsCustomActionMenu.Button Flip languages pressed causeId: ${i}`),g.default.switchPstnCallTranlatorBotSpokenLanguageLocales(t.conversationMri),null===(e=t.update)||void 0===e||e.call(t,i)},closeMenu:i,toggleAutoDetect:R,toggleTruVoice:A,style:t.menuComponentStyle},x)),O=()=>o.getString("LanguageAndTranslationSettingsPanel.CallTranslationSettingsTitle"),B=l.default.menuHeight();s.default.showWithContent({menuId:s.default.menuId(),anchor:t.anchor,rootViewId:t.rootViewId,menuHeight:B,menuWidth:450,content:V,useBlurredBackground:!1,colorThemeOverride:L,borderRadius:8,headerConfig:t.isUsingStackNavigationContext?{headerType:u.HeaderType.Slim}:{headerType:u.HeaderType.Default,rightButton:{icon:h.SkypeIcon.Cancel,onPress:e=>{i()}}},staticContent:!0,useTransparentShim:!0,hidePopupArrow:!0,useDesktopPopup:!t.isUsingStackNavigationContext&&!t.isMobileScreenReaderEnabled,getTitle:O,onCloseMenu:e=>{d.log(c.LogTraceArea.CallingUI,"onCloseMenu causeId: "+e),s.default.close(t.rootViewId,e)}},t.causeId),r.dismissAll()}},633289:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(109520),n=i(905531),o=i(746096),s=i(436237),r=i(733754),l=i(293194),c=i(853374),d="LeaveCall",u="EndCallForEveryOne";class h{static selectEndCallMenuItem(e,t,i){const n=c.default.newCauseId();switch(s.log(o.LogTraceArea.CallingUI,"CallControlsEndCallContextMenu.selectEndCallMenuItem causeId: "+n),l.default.dismiss(h._endCallMenuId,t),e){case u:i(!0,n),s.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.EndCallForEveryone));break;case d:i(!1,n),s.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.LeaveCall))}}static _getEndCallMenuConfig(e){return{anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:-10}}}}h._endCallMenuId=l.default.menuId(),h.showEndCallMenuPopup=(e,t,i,n)=>{const o=h._getEndCallMenuConfig(i);l.default.showWithOptions({id:h._endCallMenuId,config:o,getMenuItems:h._getEndCallMenuItems,handleMenuCommand:n,rootViewId:e,invokingEvent:t})&&s.track(new a.EndCallPopupMenuActionsEvent(a.EndCallPopupActions.EndCallPopupShown))},h._getEndCallMenuItems=()=>{const e=[];return e.push({text:r.getString("CallControls.LeaveCall"),command:d}),n.default.call().canEndCallForAll&&e.push({text:r.getString("CallControls.HangupAllMessageDesktop"),command:u}),e},t.default=h},825207:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(994224),o=i(109520),s=i(502278),r=i(480200),l=i(471727),c=i(898278),d=i(746096),u=i(436237),h=i(733754),p=i(104735),g=i(217093),C=i(399189),S=i(754306),m=i(293194),y=i(853374),f=i(613125),b="TurnOffVideo",_="Mute",T="Unmute",v="BlurBackground",w="UnblurBackground",I="CropVideo",P="FullVideo",M="BackgroundEffectsSettings",k="LowerHand",A="PinParticipant",R="UnpinParticipant";t.default=class{constructor(e){this._callLocalVideoContextMenuOptions=e,this._getActionsMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0}}),this._getCallLocalVideoMenuItems=()=>{const e=[],t=this._getCameraMenuItems(),i=this._getOtherMenuItems();return t.length&&e.push({key:"cameraSwitching",menuItems:t}),e.push({key:"otherSettings",menuItems:i}),e},this._getCameraMenuItems=()=>{const e=[],t=n.default.DeviceStore.getCameras(),i=this._getSelectedCameraId();return a.each(t,(t=>{e.push({text:t.label,command:t.id,selected:this._localVideoOn&&t.id===i,selectableType:c.SXMenuItemSelectableType.Checkbox})})),e.push({text:h.getString("CallControls.CallButtonTurnOffVideoLabel"),command:b,selected:!this._localVideoOn,selectableType:c.SXMenuItemSelectableType.Checkbox}),e},this._getOtherMenuItems=()=>{const e=[],t=l.default.isLocalOrServerMuted(this._callLocalVideoContextMenuOptions.callId);if(this._localVideoOn&&n.default.DeviceStore.isBackgroundBlurCapable()&&!n.default.DeviceStore.isBackgroundReplacementEnabled()){const t=n.default.DeviceStore.isBackgroundBlurred();e.push({text:t?h.getString("CallControls.CallMenuUnBlurBackground"):h.getString("CallControls.CallMenuBlurBackground"),command:t?w:v})}return this._localVideoOn&&n.default.DeviceStore.isBackgroundReplacementEnabled()&&e.push({text:h.getString("CallControlsOverFlowMenu.BackgroundEffectsSettings"),command:M}),e.push({text:t?h.getString("CallControls.CallMenuUnmuteMicrophone"):h.getString("CallControls.CallMenuMuteMicrophone"),command:t?T:_}),this._callLocalVideoContextMenuOptions.showLowerHand&&e.push({text:h.getString("CallControls.LowerHand"),command:k}),this._callLocalVideoContextMenuOptions.showCropUncropMenuOption&&!a.isUndefined(this._callLocalVideoContextMenuOptions.sizeToFit)&&(this._callLocalVideoContextMenuOptions.sizeToFit?e.push({text:h.getString("CallControls.ShowCroppedVideo"),command:I}):e.push({text:h.getString("CallControls.ShowFullVideo"),command:P})),this._callLocalVideoContextMenuOptions.showPinOption&&this._callLocalVideoContextMenuOptions.isGroupCall&&e.push({text:h.getString("CallControls.PinParticipant"),command:A}),this._callLocalVideoContextMenuOptions.showUnpinOption&&this._callLocalVideoContextMenuOptions.isGroupCall&&e.push({text:h.getString("CallControls.UnpinParticipant"),command:R}),e},this._selectMenuItem=(e,t,i)=>{var c;const h=y.default.newCauseId();u.log(d.LogTraceArea.CallingUI,"CallLocalVideoContextMenu._selectMenuItem"+e+" causeId: "+h);const p=n.default.DeviceStore.getCameras();switch(a.each(p,(t=>{var i;if(t.id!==e);else if(t.id!==this._getSelectedCameraId()&&(n.default.DeviceStore.choosePreferredDevices({camera:e},h),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.SwitchCamera))),!this._localVideoOn){const{callId:e}=this._callLocalVideoContextMenuOptions;null===(i=n.default.CallingStore.getLocalVideoState(e))||void 0===i||i.setLocalVideoEnabled(!0),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.TurnOnVideo))}})),e){case b:if(this._localVideoOn){const{callId:e}=this._callLocalVideoContextMenuOptions;null===(c=n.default.CallingStore.getLocalVideoState(e))||void 0===c||c.setLocalVideoEnabled(!1),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.TurnOffVideo))}break;case _:n.default.CallingStore.mute(this._callLocalVideoContextMenuOptions.callId,h),l.default.announceMicrophoneState(!0),s.default.updateCallTelemetry(this._callLocalVideoContextMenuOptions.callId,h,(e=>e.muteLocalVideoContextMenuPress())),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.Mute));break;case T:n.default.CallingStore.unmute(this._callLocalVideoContextMenuOptions.callId,h),l.default.announceMicrophoneState(!1),s.default.updateCallTelemetry(this._callLocalVideoContextMenuOptions.callId,h,(e=>e.muteLocalVideoContextMenuPress())),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.Unmute));break;case v:n.default.DeviceStore.setBackgroundBlurred(!0),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.BackgroundBlur));break;case w:n.default.DeviceStore.setBackgroundBlurred(!1),u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.BackgroundUnBlur));break;case I:i&&i(!1);break;case P:i&&i(!0);break;case M:this._showAVSettings(t);break;case k:new C.LowerHandCommand(this._callLocalVideoContextMenuOptions.callId,S.LowerHandOrigin.OverflowMenu).execute();break;case A:case R:new f.PinUnpinCommand(r.CallStageElementKeys.localUserKey,this._callLocalVideoContextMenuOptions.callId).execute()}},this._showCallLocalVideoMenuPopup=(e,t,i,a)=>{const n=this._getActionsMenuConfig(i);m.default.showGroupWithOptions({id:this._callLocalVideoMenuId,config:n,getMenuGroups:this._getCallLocalVideoMenuItems,handleMenuCommand:a,rootViewId:e,invokingEvent:t})&&u.track(new o.LocalVideoActionsEvent(o.LocalVideoActions.PopupShown))},this._getSelectedCameraId=()=>{const e=n.default.DeviceStore.getCurrentDevices();return null==e?void 0:e.camera},this._showAVSettings=e=>{const t=y.default.newCauseId();u.log(d.LogTraceArea.CallingUI,"CallLocalVideContextMenu._showAVSettings causeId: "+t),p.default.navigateToDesktopSettingsGroup(g.SettingsGroup.AudioVideoSettings,e,t)},this._callLocalVideoMenuId=m.default.menuId(),this._localVideoOn=n.default.CallingStore.isProvidingVideo(this._callLocalVideoContextMenuOptions.callId)}showContextMenu(e,t,i,a){!!this._callLocalVideoContextMenuOptions.conversationMri&&n.default.CallingFeaturesHelper.allowOutboundVideo({isPSTNCall:n.default.CallingStore.isPSTNCall(this._callLocalVideoContextMenuOptions.callId),isEncryptedCall:n.default.CallingStore.isEncryptedCall(this._callLocalVideoContextMenuOptions.callId),conversationMri:this._callLocalVideoContextMenuOptions.conversationMri,callId:this._callLocalVideoContextMenuOptions.callId})?this._showCallLocalVideoMenuPopup(e,t,i,(t=>this._selectMenuItem(t,e,a))):u.log(d.LogTraceArea.CallingUI,"CallLocalVideoContextMenu allowOutboundVideo is false")}}},37034:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(397691),n=i(850781),o=i(994224),s=i(178536),r=i(66020),l=i(733754),c=i(293194);t.default=new class{showForSkypeMri(e,t,i,a,n,o,s,l,c,d,u,h,p){r.default.showForSkypeMri(e,t,i,a,n,o,s,l,c,d,u,h,p)}showForPhoneNumber(e,t,i,a,n){r.default.showForPhoneNumber(e,t,i,a,n)}showForAddressContact(e,t,i,a,n,o,s,l,c,d){r.default.showForAddressContact(e,t,i,a,n,o,s,l,c,d)}startCallOrMaybePrompt(e,t,i,d,u,h){const p=(e,t)=>o.default.CallNavigationHelper.startCall({conversationMri:e,withVideo:t,origin:i.callOrigin,openInMainWindow:u,view:h},d),g=i=>{const n=[{text:l.getString("CallOrInviteMenu.UnencryptedCallAlertYes"),command:""}],o={anchor:e,buttons:n,positionPriorities:["bottom"],title:i?l.getString("CallOrInviteMenu.UnencryptedVideoCallAlertTitle"):l.getString("CallOrInviteMenu.UnencryptedAudioCallAlertTitle"),message:i?l.getString("CallOrInviteMenu.UnencryptedVideoCallAlertBody"):l.getString("CallOrInviteMenu.UnencryptedAudioCallAlertBody"),cancelButtonTitle:l.getString("CallOrInviteMenu.UnencryptedCallAlertNo"),cancelButtonPosition:c.CancelButtonPosition.End,destructiveButtonIndex:0},s=a.Defer();return c.default.showWithActionMenuConfig({options:o,callback:e=>{e!==c.SXActionMenuCancel?s.resolve(void 0):s.reject()},rootViewId:t,useAlertForDesktop:!0,useAlertForMobile:!1,invokingEvent:void 0}),s.promise()},C=(e,t,a)=>o.default.CallNavigationHelper.answerOrJoinCall({conversationMri:e,callId:t,withVideo:a,origin:i.callOrigin,isTwinCam:i.showTwinCam,openInMainWindow:u,view:h},d),S=(e,t,a)=>o.default.CallPreviewUtils.answerOrJoinCall({conversationMri:e,callId:t,withVideo:a,origin:i.callOrigin,isTwinCam:i.showTwinCam},d),m=(a,n,o,s,l,c,d,u)=>{r.default.showForSkypeMri(e,t,a,n,o,i.inviteOrigin,i.callOrigin,s,l,c,d,u,i.popupTitleOverride)},y=(a,n,o)=>{r.default.showForAddressContact(e,t,a,i.inviteOrigin,i.callOrigin,n,o,!1)};return n.default.loadCallingBundle().then((()=>s.default.startCallOrMaybePromptHelper(i,p,C,S,m,y,g,d)))}}},719463:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(889391),n=i(220187),o=i(847094),s=i(647176),r=i(109520),l=i(471727),c=i(898278),d=i(746096),u=i(436237),h=i(733754),p=i(104735),g=i(498053),C=i(399189),S=i(754306),m=i(293194),y=i(853374),f=i(613125),b="RemoveFromCall",_="Mute",T="CropVideo",v="FullVideo",w="SendMessage",I="ViewProfile",P="MuteEveryone",M="LowerHand",k="ChangeTogetherModeBackground",A="PinParticipant",R="UnpinParticipant";t.default=class{constructor(e){this._callParticipantContextMenuOptions=e,this._selectUserNameChevronMenuItem=(e,t,i)=>{this._selectCanvasAndRibbonActionsMenuItem(e,t,i)},this._getCanvasAndRibbonActionsMenuConfig=e=>({anchor:e,useTheme:!0,positionPriorities:["top","bottom"],popupBeakSize:{height:0,width:0}}),this._getCallParticipantMenuItems=()=>{const e=[];return this._callParticipantContextMenuOptions.showMute&&e.push({text:h.getString("CallControls.CallButtonMute"),command:_,disabled:!this._callParticipantContextMenuOptions.isMuteOptionDisabled}),this._callParticipantContextMenuOptions.showRemoveCall&&e.push({text:h.getString("CallControls.RemoveFromCall"),command:b}),this._callParticipantContextMenuOptions.showCropVideoOption?e.push({text:h.getString("CallControls.ShowCroppedVideo"),command:T}):this._callParticipantContextMenuOptions.showFullVideoOption&&e.push({text:h.getString("CallControls.ShowFullVideo"),command:v}),this._callParticipantContextMenuOptions.showLowerHandOption&&a.default.getS4LCMCFeatures().enableCallLowerHandByOthers&&l.default.canHandBeLoweredForParticipant(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.userMri)&&e.push({text:h.getString("CallControls.LowerHand"),command:M}),this._callParticipantContextMenuOptions.showChangeTogetherModeBackgroundOption&&e.push({text:h.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),command:k}),this._callParticipantContextMenuOptions.showPinOption&&e.push({text:h.getString("CallControls.PinParticipant"),command:A}),this._callParticipantContextMenuOptions.showUnpinOption&&e.push({text:h.getString("CallControls.UnpinParticipant"),command:R}),e},this._getMenuItemsRelatedToOutsideTheCall=()=>{const e=[];return this._callParticipantContextMenuOptions.showSendMessageMenuOption&&e.push({text:h.getString("CallControls.SendMessageFromParticipantMenuAccessibilityLabel"),command:w}),this._callParticipantContextMenuOptions.showViewProfile&&e.push({text:h.getString("GroupProfilePanel.ViewInfo"),command:I}),e},this._getMenuItemsRelatedToModeratedChat=()=>{const e=[];return this._callParticipantContextMenuOptions.showMuteEveryone&&e.push({text:h.getString("CallControls.CallButtonMuteEveryone"),command:P}),e},this._getCanvasAndRibbonActionsMenuItems=()=>{const e=[],t=this._getCallParticipantMenuItems(),i=this._getMenuItemsRelatedToOutsideTheCall(),a=this._getMenuItemsRelatedToModeratedChat();return t.length>0&&e.push({key:"menuItemsCallParticipant",menuItems:t,title:void 0}),i.length>0&&e.push({key:"menuItemsRelatedToOutsideTheCall",menuItems:i}),a.length>0&&e.push({key:"menuItemsRelatedToModeratedChat",menuItems:a}),e},this._selectCanvasAndRibbonActionsMenuItem=(e,t,i)=>{const a=y.default.newCauseId();switch(u.log(d.LogTraceArea.CallingUI,"CallParticipantActionsContextMenu._selectCanvasAndRibbonActionsMenuItem causeId: "+a),e){case I:p.default.showDetailsPanelWithParams({mri:this._callParticipantContextMenuOptions.userMri,rootViewId:c.MainRootViewId,causeId:a}),u.track(new r.CanvasAndRibbonActionsEvent(r.CanvasAndRibbonActions.ViewProfile));break;case b:s.default.handleRemoteHangup(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId,a),u.track(new r.CanvasAndRibbonActionsEvent(r.CanvasAndRibbonActions.RemoveFromCall));break;case _:s.default.handleRemoteMute(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId,a),u.track(new r.CanvasAndRibbonActionsEvent(r.CanvasAndRibbonActions.Mute));break;case P:new n.MuteEveryoneCommand(this._callParticipantContextMenuOptions.callId).execute(),u.track(new r.CallMuteEveryoneEvent(r.MuteEveryoneOrigin.OverflowMenu));break;case T:if(i){new o.default(i).execute()}break;case v:if(i){new o.FullVideoCommand(i).execute()}break;case w:(new o.SendMessageCommand).execute(this._callParticipantContextMenuOptions.userMri);break;case M:new C.LowerHandParticipantCommand(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.userMri,S.LowerHandOrigin.OverflowMenu,this._callParticipantContextMenuOptions.isLocal,this._callParticipantContextMenuOptions.displayName).execute();break;case k:new g.ChangeTogetherModeBackgroundCommand(this._callParticipantContextMenuOptions.callId,this._callParticipantContextMenuOptions.conversationMri).execute();break;case A:case R:new f.PinUnpinCommand(this._callParticipantContextMenuOptions.userMri,this._callParticipantContextMenuOptions.callId).execute()}},this._showCanvasAndRibbonActionsMenuPopup=(e,t,i,a,n,o)=>{const s=this._getCanvasAndRibbonActionsMenuConfig(i);m.default.showGroupWithOptions({id:this._canvasAndRibbonActionsMenuId,config:s,getMenuGroups:this._getCanvasAndRibbonActionsMenuItems,handleMenuCommand:a,onDismiss:o,maintainTitleForMobile:!0,cancelButtonTitleIOS:h.getString("Global.CancelLabel"),rootViewId:e,invokingEvent:t})&&(n&&n(),u.track(new r.CanvasAndRibbonActionsEvent(r.CanvasAndRibbonActions.PopupShown)))},this._canvasAndRibbonActionsMenuId=m.default.menuId()}showContextMenu(e,t,i,a,n,o){this._showCanvasAndRibbonActionsMenuPopup(e,t,i,(e=>this._selectUserNameChevronMenuItem(e,n,o)),a,n)}}},488717:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(809206),o=i(63413),s=i(220187),r=i(825207),l=i(719463),c=i(480200),d=i(671830),u=i(539549),h=i(273145),p=i(933790),g=i(844972),C=i(471727);t.default=new class{getCallLocalVideoContextMenuOptions(e,t,i,n,o,s){return{callId:e,conversationMri:t,isGroupCall:!!t&&d.isGroupConversation(t),sizeToFit:!a.isUndefined(o)&&o,isCompact:!!i,isRenderingVideo:n,isCropVideoEnabledOnGroupCall:!0,isCropVideoEnabledOn1On1Call:!0,showCropUncropMenuOption:!1,showLowerHand:s,showPinOption:C.default.shouldShowCallParticipantPinOption(c.CallStageElementKeys.localUserKey,e),showUnpinOption:C.default.shouldShowCallParticipantUnpinOption(c.CallStageElementKeys.localUserKey,e)}}getShowCropUncropMenuOption(e,t,i){let a=!0;return(n.BrowserEnvironment.isEngineEdgeHTML()||e||!t||i)&&(a=!1),a}getMenuOptionEnabled(e){let t=!1,i=!1,n=!1,r=!1,l=!1,c=!1,h=!1;const p=new s.MuteEveryoneCommand(e.callId).canExecute(),C=(0,u.default)().getConversation(e.conversationMri),S=e.isGroupCall&&!e.isCropVideoEnabledOnGroupCall||!e.isGroupCall&&!e.isCropVideoEnabledOn1On1Call;if(t=this.getShowCropUncropMenuOption(S,e.isRenderingVideo,e.isCompact),!e.isLocal&&e.isGroupCall){n=!0,i=!0;const{showChangeTogetherModeBackgroundOption:a}=e;a?(i=!1,n=!1,t=!1):(0,g.isRegularMemberInModeratedGroup)(C)&&(i=!1,n=!1)}return!e.showSendMessageMenuOption||e.isLocal||!e.isGroupCall||o.default.isMriBlocked(e.userMri)||d.isGuestUserMri(e.userMri)||(l=!0),i&&e.isLocalMuteSupported&&e.isServerMutedSupported&&!e.isMuted&&(r=!0),t&&!a.isUndefined(e.sizeToFit)&&(e.sizeToFit?c=!0:h=!0),{isMuteOptionDisabled:r,showMute:i,showMuteEveryone:p,showRemoveCall:n,showCropUncropMenuOption:t,showSendMessageMenuOption:l,showCropVideoOption:c,showFullVideoOption:h}}showParticipantActionsContextMenuOnPosition(e,t,i,n,o,s){p.default.setAnchorPosition(e),a.defer((()=>{const a=h.default.getMenuTargetCallback(t),r=this.getMenuOptionEnabled(i);i.isMuteOptionDisabled=r.isMuteOptionDisabled,i.showMute=r.showMute,i.showMuteEveryone=r.showMuteEveryone,i.showRemoveCall=r.showRemoveCall,i.showCropUncropMenuOption=r.showCropUncropMenuOption,i.showSendMessageMenuOption=r.showSendMessageMenuOption,i.showCropVideoOption=r.showCropVideoOption,i.showFullVideoOption=r.showFullVideoOption;new l.default(i).showContextMenu(t,{pageX:e.x,pageY:e.y},a,n,o,i.showCropUncropMenuOption?s:void 0)}))}showParticipantActionsContextMenu(e,t,i,n,o,s){e.stopPropagation(),e.preventDefault();const r=a.pick(e,"pageX","pageY");this.showParticipantActionsContextMenuOnPosition({x:r.pageX||0,y:r.pageY||0},t,i,n,o,s)}showLocalVideoActionsContextMenuOnPosition(e,t,i,n){p.default.setAnchorPosition(e),a.defer((()=>{const a=h.default.getMenuTargetCallback(t),o=new r.default(i),s=i.isGroupCall&&!i.isCropVideoEnabledOnGroupCall||!i.isGroupCall&&!i.isCropVideoEnabledOn1On1Call;i.showCropUncropMenuOption=this.getShowCropUncropMenuOption(s,i.isRenderingVideo,i.isCompact),o.showContextMenu(t,{pageX:e.x,pageY:e.y},a,i.showCropUncropMenuOption?n:void 0)}))}showLocalVideoActionsContextMenu(e,t,i,n){e.stopPropagation(),e.preventDefault();const o=a.pick(e,"pageX","pageY");this.showLocalVideoActionsContextMenuOnPosition({x:o.pageX||0,y:o.pageY||0},t,i,n)}}},847094:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SendMessageCommand=t.FullVideoCommand=void 0;const a=i(109520),n=i(476621),o=i(746096),s=i(436237),r=i(104735),l=i(914976),c=i(853374);t.default=class{constructor(e){this._onToggleCropVideo=e}execute(){s.log(o.LogTraceArea.Calling,"CropVideoCommand.execute."),this._onToggleCropVideo(!1)}};t.FullVideoCommand=class{constructor(e){this._onToggleCropVideo=e}execute(){s.log(o.LogTraceArea.Calling,"FullVideoCommand.execute."),this._onToggleCropVideo(!0)}};t.SendMessageCommand=class{execute(e){n.default.ensureConversationLoadedOrFaked(e).then((t=>{const i=c.default.newCauseId();s.log(o.LogTraceArea.Calling,"SendMessageCommand.execute, causeId: "+i+" user mri:"+l.mriOrId(e)),r.default.navigateToConversation({convId:e,origin:o.NavigationConversationOrigin.CallParticipantActionMenu,isNewConversation:t,causeId:i}),s.track(new a.CanvasAndRibbonActionsEvent(a.CanvasAndRibbonActions.SendMessage))}))}}},785107:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SubtitleMaxWidthV3=t.SubtitleMaxWidthV2=t.SubtitleMaxWidth=void 0;const a=i(853374),n={desktop:{portrait:{preview:{isHorizontal:!0,sizeRatio:.7},interactive:{isHorizontal:!0,sizeRatio:.5}},landscape:{preview:{isHorizontal:!0,sizeRatio:.7},interactive:{isHorizontal:!1,fixedSize:300,sizeRatio:0}}},mobile:{portrait:{preview:{isHorizontal:!0,sizeRatio:.65},interactive:{isHorizontal:!0,sizeRatio:.5}},landscape:{preview:{isHorizontal:!0,sizeRatio:.8},interactive:{isHorizontal:!1,sizeRatio:.5}}}};t.SubtitleMaxWidth=500,t.SubtitleMaxWidthV2=600,t.SubtitleMaxWidthV3=1e3;class o{static getTranscriptionLayout(e,t,i){const a=t?n.mobile:n.desktop,o=i?a.landscape:a.portrait;return e?o.interactive:o.preview}static getTranscriptionLayoutRects(e,t){const i=t.fixedSize?o.shrinkRectByAmount(e,t.fixedSize,t.isHorizontal):o.shrinkRectByRatio(e,t.sizeRatio,t.isHorizontal);let a=i.remainderRect;if(t.paddingSize){const e=o.shrinkRectByAmount(a,t.paddingSize,!t.isHorizontal).shrinkedRect;a={x:t.isHorizontal?e.x+t.paddingSize:e.x,y:t.isHorizontal?e.y:e.y+t.paddingSize,width:e.width,height:e.height}}return{stage:i.shrinkedRect,subtitles:a,isHorizontal:t.isHorizontal}}static shrinkRectByRatio(e,t,i){t=a.default.clampValue(t,0,1);const n=Math.floor((i?e.height:e.width)*t);return o.shrinkRectByAmount(e,n,i)}static shrinkRectByAmount(e,t,i){t=a.default.clampValue(t,0,i?e.height:e.width);const n=i?{x:e.x,y:e.y,width:e.width,height:e.height-t}:{x:e.x,y:e.y,width:e.width-t,height:e.height};return{shrinkedRect:n,remainderRect:i?{x:e.x,y:n.y+n.height,width:e.width,height:e.height-n.height}:{x:n.x+n.width,y:e.y,width:e.width-n.width,height:e.height}}}}t.default=o},174984:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(583367),o=i(516778),s=i(889391),r=i(994224),l=i(109520),c=i(502278),d=i(480200),u=i(471727),h=i(898278),p=i(746096),g=i(436237),C=i(915877),S=i(733754),m=i(293194),y=i(853374),f="ribbonettingspopup";var b;!function(e){e.Speaker="speaker",e.Content="content",e.Grid="grid",e.TogetherMode="togetherMode",e.LargeGrid="largeGrid",e.Window="window",e.Float="float",e.Presentation="presentation",e.EnterFullScreen="enterFullScreen",e.ExitFullScreen="exitFullScreen"}(b||(b={}));const _={[b.Speaker]:d.StageMode.Speaker,[b.Presentation]:d.StageMode.Presentation,[b.Content]:d.StageMode.FocusedScreenShare,[b.Grid]:d.StageMode.Grid,[b.TogetherMode]:d.StageMode.TogetherMode,[b.LargeGrid]:d.StageMode.LargeGrid},T={[b.Speaker]:l.CallViewMenuActions.SwitchToSpeaker,[b.Presentation]:l.CallViewMenuActions.SwitchToPresentation,[b.Content]:l.CallViewMenuActions.SwitchToContent,[b.Grid]:l.CallViewMenuActions.SwitchToModernGrid,[b.TogetherMode]:l.CallViewMenuActions.SwitchToTogetherMode,[b.LargeGrid]:l.CallViewMenuActions.SwitchToLargeGallery},v=(0,C.lazyProperties)({menuContainerStyles:()=>o.Styles.createViewStyle({paddingVertical:20,paddingBottom:10}),menuButtonStyles:()=>o.Styles.createButtonStyle({borderLeftWidth:0,paddingHorizontal:20})});class w{static show(e,t,i,n,o,s,r,l,c,d,u,h){const p={anchor:n,useTheme:!0,popupBeakSize:{height:0,width:0},popupOffset:{x:0,y:5},positionPriorities:["bottom","left"],menuStyles:{menuContainerStyles:v.menuContainerStyles,menuButtonStyles:v.menuButtonStyles},onCallPanelHeaderLayoutChange:i,changeCallLayoutCommand:h,hasIncomingScreenshare:u},g=[],C=[];if(h.canExecute()){const e=this._layoutMenuItemsForGridFocus(d,u,p);g.push({key:"stagelayoutsettings",menuItems:e})}a.each(e,(e=>{const i=this._layoutMenuItemForMode(e,e===t);i&&C.push(i)})),C.length&&g.push({key:"ribbonlayoutsettings",menuItems:C}),l&&(c?g.push({key:"exitfullscreensetting",menuItems:[{text:S.getString("CallPanel.ExitFullScreen"),command:b.ExitFullScreen}]}):g.push({key:"enterfullscreensetting",menuItems:[{text:S.getString("CallPanel.EnterFullScreen"),command:b.EnterFullScreen}]})),m.default.showGroupWithOptions({id:f,config:p,getMenuGroups:()=>g,handleMenuCommand:(e,t)=>this._selectOverflowMenuItem(e,t,o),cancelButtonTitleIOS:S.getString("Global.CancelLabel"),rootViewId:o,invokingEvent:s})}}w._layoutMenuItemsForGridFocus=(e,t,i)=>{const a=(e,t,i,a=!1,n=!0)=>({text:S.getString(e),command:t,selected:i,isCheckbox:n,disabled:a}),n=[a("CallPanel.CallHeaderGridViewLabel",b.Grid,u.default.isInGridStageMode(e))];if(t){const t=r.default.CallingFeaturesHelper.isPresentationModeEnabled(),i=t?b.Presentation:b.Content,o=t?d.StageMode.Presentation:d.StageMode.FocusedScreenShare;n.push(a(t?"CallPanel.CallHeaderPresentationViewLabel":"CallPanel.CallHeaderContentViewLabel",i,e===o))}else n.push(a("CallPanel.CallHeaderSpeakerViewLabel",b.Speaker,e===d.StageMode.Speaker));const o=s.default.getS4LCMCFeaturesNoSubscription();return o.callAudienceBotConfig.enabledGroupCall&&n.push(a("CallPanel.CallHeaderTogetherModeViewLabel",b.TogetherMode,e===d.StageMode.TogetherMode,!i.changeCallLayoutCommand.canExecuteForStageMode(d.StageMode.TogetherMode))),o.callGridViewBotConfig.enabled&&n.push(a("CallPanel.CallHeaderLargeGridViewLabel",b.LargeGrid,e===d.StageMode.LargeGrid,!i.changeCallLayoutCommand.canExecuteForStageMode(d.StageMode.LargeGrid))),n},w._layoutMenuItemForMode=(e,t)=>{switch(e){case d.CallPanelHeaderLayout.Float:return{text:S.getString("CallPanel.CallHeaderLayoutFloatLabel"),command:b.Float,selected:t,selectableType:h.SXMenuItemSelectableType.Checkbox};case d.CallPanelHeaderLayout.Window:return{text:S.getString("CallPanel.CallHeaderLayoutWindowLabel"),command:b.Window,selected:t,selectableType:h.SXMenuItemSelectableType.Checkbox}}},w._selectOverflowMenuItem=(e,t,i)=>{const a=y.default.newCauseId();if(g.log(p.LogTraceArea.Navigation,"RibbonSettingsUtils._selectOverflowMenuItem, causeId: "+a),m.default.dismiss(f,i),t.onCallPanelHeaderLayoutChange)switch(e){case b.Speaker:case b.Presentation:case b.Content:case b.Grid:case b.TogetherMode:case b.LargeGrid:t.changeCallLayoutCommand.execute(_[e]),c.default.trackCallViewMenuActions(T[e]);break;case b.Float:t.onCallPanelHeaderLayoutChange(d.CallPanelHeaderLayout.Float),c.default.trackCallViewMenuActions(l.CallViewMenuActions.SwitchToFloat);break;case b.Window:t.onCallPanelHeaderLayoutChange(d.CallPanelHeaderLayout.Window),c.default.trackCallViewMenuActions(l.CallViewMenuActions.SwitchToWindow);break;case b.EnterFullScreen:n.default.tryEnterFullScreenMode(i).then((e=>{e?(g.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.EnterFullScreen)),c.default.trackCallViewMenuActions(l.CallViewMenuActions.EnterFullScreen)):g.log(p.LogTraceArea.CallingUI,"Failed to Enter Full Screen Mode")}));break;case b.ExitFullScreen:n.default.exitFullScreenMode(i).then((()=>{g.track(new l.RibbonSettingsMenuActionEvent(l.RibbonSettingsMenuActions.ExitFullScreen))})).catch((e=>{g.log(p.LogTraceArea.CallingUI,"Failed to exit full screen mode:")}))}},t.default=w},596187:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModalHeight=t.ModalWidth=t.SharingSourceSize=void 0;const a=i(478262);class n{}n.XLarge={width:960,height:576},n.Large={width:480,height:288},n.Medium={width:240,height:144},n.Small={width:160,height:90},n.XSmall={width:80,height:45},t.SharingSourceSize=n;const o=n.Small.width;var s;!function(e){e[e.FourWindowsColumns=490+3*o]="FourWindowsColumns",e[e.ThreeWindowsColumns=490+2*o]="ThreeWindowsColumns",e[e.TwoWindowsColumns=490+o]="TwoWindowsColumns",e[e.OneWindowsColumn=490]="OneWindowsColumn",e[e.NoWindowsColumn=600]="NoWindowsColumn"}(s=t.ModalWidth||(t.ModalWidth={}));var r;!function(e){e[e.ThreeScreens=650]="ThreeScreens",e[e.ThreeScreensAndToggle=720]="ThreeScreensAndToggle",e[e.TwoScreens=515]="TwoScreens",e[e.TwoScreensAndToggle=585]="TwoScreensAndToggle",e[e.OneScreen=380]="OneScreen",e[e.OneScreenAndToggle=450]="OneScreenAndToggle",e[e.NoWindowsOneScreens=640]="NoWindowsOneScreens",e[e.NoWindowsTwoScreens=500]="NoWindowsTwoScreens",e[e.NoWindowsMoreThanTwoScreens=685]="NoWindowsMoreThanTwoScreens"}(r=t.ModalHeight||(t.ModalHeight={}));t.default=class{static getSourceItemDimensions(e,t,i){let a=!1;t&&e<t&&i>1&&(a=!0);const o=e/i;return o>1e3&&!a?n.XLarge:o>200?n.Large:o>90?n.Medium:n.Small}static getWindowSourceItemDimensions(){return n.Small}static getScreenSourceItemDimensions(e,t,i){return t?1===i&&e!==a.ResponsiveWidth.MinDesktop?n.Large:n.Medium:e!==a.ResponsiveWidth.MinDesktop||t?n.Small:n.XSmall}static getModalWidth(e,t,i){if(0===i)return s.NoWindowsColumn;let n,o;switch(e){case a.ResponsiveWidth.Large:n=4;break;case a.ResponsiveWidth.Medium:n=3;break;case a.ResponsiveWidth.Small:default:n=2}o=2!==t||3!==i&&4!==i?i>9?4:i>6?3:i>3?2:1:2;switch(Math.min(n,o)){case 1:default:return s.OneWindowsColumn;case 2:return s.TwoWindowsColumns;case 3:return s.ThreeWindowsColumns;case 4:return s.FourWindowsColumns}}static getModalHeigh(e,t,i){if(0===t)return 1===e?r.NoWindowsOneScreens:2===e?r.NoWindowsTwoScreens:r.NoWindowsMoreThanTwoScreens;let a;switch(a=e>=3?3:2===e?t>4?3:e:t>=3?3:t,a){case 1:return i?r.OneScreenAndToggle:r.OneScreen;case 2:return i?r.TwoScreensAndToggle:r.TwoScreens;default:return i?r.ThreeScreensAndToggle:r.ThreeScreens}}}},789174:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ModalHeight=t.ModalWidth=t.BackgroundSize=void 0;class i{}i.XLarge={width:960,height:576},i.Large={width:288,height:173},i.Medium={width:240,height:144},i.Small={width:160,height:90},i.XSmall={width:80,height:45},t.BackgroundSize=i;const a=i.Small.width;var n;!function(e){e[e.FourColumns=380+3*a]="FourColumns",e[e.ThreeColumns=380+2*a]="ThreeColumns",e[e.TwoColumns=380+a]="TwoColumns",e[e.OneColumn=380]="OneColumn"}(n=t.ModalWidth||(t.ModalWidth={}));var o;!function(e){e[e.ThreeRows=650]="ThreeRows",e[e.TwoRows=515]="TwoRows",e[e.OneRow=380]="OneRow"}(o=t.ModalHeight||(t.ModalHeight={}));t.default=class{static getBackgroundItemDimensions(e,t,a){return a&&e&&t?i.Medium:e&&t?i.Large:i.Medium}static getModalWidth(e,t){return n.TwoColumns}static getModalHeight(e){return o.ThreeRows}}},928303:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InCallFeatureStoppedState=t.InCallFeatureStoppedByRemoteUserState=t.InCallFeatureEnabledByRemoteState=t.InCallFeatureEnabledState=t.RemoteConsentRejectedByRemoteUserState=t.RemoteConsentCancelledByLocalUserState=t.RemoteConsentRequestedByLocalUserState=t.SelfConsentFromRemoteUserRejectedByLocalUserState=t.SelfConsentRequestedByRemoteUserState=t.SelfConsentRejectedState=t.SelfConsentRequestedState=t.InCallFeatureRemoteFailedState=t.InCallFeatureFailedState=t.InCallFeatureNotSupportedState=t.InCallFeatureDisabledState=t.FeatureConsentFlowState=void 0;const a=i(436237),n=i(598925),o=i(746096);class s{constructor(e,t){this.getState=()=>({state:this.getFeatureState(),requestedBy:this._requestedBy}),this.onEnter=()=>{this._logMessage(`Switching to ${n.InCallFeatureState[this.getFeatureState()]}`)},this._callId=e,this._requestedBy=t}_logInvalidTransition(e){this._logMessage(`Transition ${n.InCallFeatureTransitionAction[e.action]}\n            from ${n.InCallFeatureState[this.getState().state]} state not supported`)}_logMessage(e){a.log(o.LogTraceArea.InCallBotService,`[InCallFeature] ${e}`)}}t.FeatureConsentFlowState=s;class r extends s{constructor(e,t,i,a,o){super(a,o),this.getFeatureState=()=>n.InCallFeatureState.Disabled,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.Start:case n.InCallFeatureTransitionAction.RequestConsent:return this._hasConsent()?new f(this._callId,e.requestedBy):new p(this._hasConsent,this._callId,e.requestedBy);case n.InCallFeatureTransitionAction.Fail:return new d(this._callId);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.Start:return this._isFeatureSupportedFn()?this._hasConsent()?this._hasRemoteConsentFn()?new y(this._callId):new C(this._callId):new u(this._hasConsent,this._hasRemoteConsentFn,this._callId):new l(this._callId);case n.InCallFeatureTransitionAction.Fail:return new c(this._callId);case n.InCallFeatureTransitionAction.Stop:return new r(this._hasConsent,this._hasRemoteConsentFn,this._isFeatureSupportedFn,this._callId);default:return this._logInvalidTransition(e),this}},this._hasConsent=e,this._hasRemoteConsentFn=t,this._isFeatureSupportedFn=i}}t.InCallFeatureDisabledState=r;class l extends s{constructor(e){super(e),this.getFeatureState=()=>n.InCallFeatureState.NotSupported,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>this,this.handleLocalUserAction=e=>this}}t.InCallFeatureNotSupportedState=l;class c extends s{constructor(e){super(e),this.getFeatureState=()=>n.InCallFeatureState.Failed,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>n.InCallFeatureTransitionAction.Fail,this.handleRemoteUserAction=e=>this,this.handleLocalUserAction=e=>this}}t.InCallFeatureFailedState=c;class d extends s{constructor(e){super(e),this.getFeatureState=()=>n.InCallFeatureState.RemoteFailed,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>n.InCallFeatureTransitionAction.Fail,this.handleRemoteUserAction=e=>this,this.handleLocalUserAction=e=>this}}t.InCallFeatureRemoteFailedState=d;class u extends s{constructor(e,t,i){super(i),this.getFeatureState=()=>n.InCallFeatureState.SelfConsentRequested,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.RejectConsent:return new m(this._callId,e.requestedBy);case n.InCallFeatureTransitionAction.Stop:return new b(this._callId,e.requestedBy);case n.InCallFeatureTransitionAction.Fail:return new d(this._callId);case n.InCallFeatureTransitionAction.RequestConsent:case n.InCallFeatureTransitionAction.Start:return new p(this._hasConsent,this._callId,e.requestedBy);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.RejectConsent:return new h(this._callId);case n.InCallFeatureTransitionAction.RequestConsent:return new C(this._callId);case n.InCallFeatureTransitionAction.Stop:return new _(this._callId);case n.InCallFeatureTransitionAction.Start:return this._hasConsent()?this._hasRemoteConsentFn()?new y(this._callId):new C(this._callId):(this._logInvalidTransition(e),this);case n.InCallFeatureTransitionAction.Fail:return new c(this._callId);default:return this._logInvalidTransition(e),this}},this._hasConsent=e,this._hasRemoteConsentFn=t}}t.SelfConsentRequestedState=u;class h extends s{constructor(e){super(e),this.getFeatureState=()=>n.InCallFeatureState.SelfConsentRejected,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.SelfConsentRejectedState=h;class p extends s{constructor(e,t,i){super(t,i),this.getFeatureState=()=>n.InCallFeatureState.ConsentRequestedByRemote,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.RejectConsent:return new m(this._callId,e.requestedBy);case n.InCallFeatureTransitionAction.Stop:return new b(this._callId,e.requestedBy);case n.InCallFeatureTransitionAction.Fail:return new d(this._callId);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.Start:case n.InCallFeatureTransitionAction.RequestConsent:return this._hasConsent()?new y(this._callId):(this._logInvalidTransition(e),this);case n.InCallFeatureTransitionAction.RejectConsent:return new g(this._callId);case n.InCallFeatureTransitionAction.Stop:return new _(this._callId);case n.InCallFeatureTransitionAction.Fail:return new c(this._callId);default:return this._logInvalidTransition(e),this}},this._hasConsent=e}}t.SelfConsentRequestedByRemoteUserState=p;class g extends s{constructor(e){super(e),this.getFeatureState=()=>n.InCallFeatureState.SelfConsentRejected,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>n.InCallFeatureTransitionAction.RejectConsent,this.handleRemoteUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.SelfConsentFromRemoteUserRejectedByLocalUserState=g;class C extends s{constructor(e){super(e),this.getFeatureState=()=>n.InCallFeatureState.RemoteConsentRequested,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>n.InCallFeatureTransitionAction.RequestConsent,this.handleRemoteUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.Start:case n.InCallFeatureTransitionAction.RequestConsent:return new y(this._callId);case n.InCallFeatureTransitionAction.RejectConsent:return new m(this._callId,e.requestedBy);case n.InCallFeatureTransitionAction.Stop:return new b(this._callId,e.requestedBy);case n.InCallFeatureTransitionAction.Fail:return new d(this._callId);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.Stop:return new S(this._callId);case n.InCallFeatureTransitionAction.Fail:return new c(this._callId);default:return this._logInvalidTransition(e),this}}}}t.RemoteConsentRequestedByLocalUserState=C;class S extends s{constructor(e){super(e),this.getFeatureState=()=>n.InCallFeatureState.RemoteConsentCancelled,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>n.InCallFeatureTransitionAction.Stop,this.handleRemoteUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.RemoteConsentCancelledByLocalUserState=S;class m extends s{constructor(e,t){super(e,t),this.getFeatureState=()=>n.InCallFeatureState.RemoteConsentRejected,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.RemoteConsentRejectedByRemoteUserState=m;class y extends s{constructor(e){super(e),this.getFeatureState=()=>n.InCallFeatureState.Enabled,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>n.InCallFeatureTransitionAction.Start,this.handleRemoteUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.RejectConsent:return new m(this._callId,e.requestedBy);case n.InCallFeatureTransitionAction.Stop:return new b(this._callId,e.requestedBy);case n.InCallFeatureTransitionAction.Fail:return new d(this._callId);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.RejectConsent:return new g(this._callId);case n.InCallFeatureTransitionAction.Stop:return new _(this._callId);case n.InCallFeatureTransitionAction.Fail:return new c(this._callId);default:return this._logInvalidTransition(e),this}}}}t.InCallFeatureEnabledState=y;class f extends s{constructor(e,t){super(e,t),this.getFeatureState=()=>n.InCallFeatureState.EnabledByRemote,this.isFinal=()=>!1,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.RejectConsent:return new m(this._callId,e.requestedBy);case n.InCallFeatureTransitionAction.Stop:return new b(this._callId,e.requestedBy);case n.InCallFeatureTransitionAction.Fail:return new d(this._callId);default:return this._logInvalidTransition(e),this}},this.handleLocalUserAction=e=>{switch(e.action){case n.InCallFeatureTransitionAction.RejectConsent:return new g(this._callId);case n.InCallFeatureTransitionAction.Stop:return new _(this._callId);case n.InCallFeatureTransitionAction.Fail:return new c(this._callId);default:return this._logInvalidTransition(e),this}}}}t.InCallFeatureEnabledByRemoteState=f;class b extends s{constructor(e,t){super(e,t),this.getFeatureState=()=>n.InCallFeatureState.StoppedByRemote,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!1,this.getTransitionAction=()=>{},this.handleRemoteUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.InCallFeatureStoppedByRemoteUserState=b;class _ extends s{constructor(e,t){super(e,t),this.getFeatureState=()=>n.InCallFeatureState.Stopped,this.isFinal=()=>!0,this.shouldPublishToRoster=()=>!0,this.getTransitionAction=()=>n.InCallFeatureTransitionAction.Stop,this.handleRemoteUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new d(this._callId):(this._logInvalidTransition(e),this),this.handleLocalUserAction=e=>e.action===n.InCallFeatureTransitionAction.Fail?new c(this._callId):(this._logInvalidTransition(e),this)}}t.InCallFeatureStoppedState=_},248467:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallCardType=void 0;const a=i(496486),n=i(671830),o=i(746096),s=i(436237),r=i(914976);t.CallCardType={Started:"started",Ended:"ended",Missed:"missed",Cast:"cast"};t.default=class{static getCallUsersMaxDuration(e,t=0){if(!e.length)return t;const i=a.map(e,(e=>e.duration));return a.max(i)||t}static getMri(e){let t=e.identity;if(t||(e.nameChild&&(t=e.nameChild.getRawText()),t&&t.length))return t}static getCallCardUsers(e){const t=[];return a.each(e,(e=>{const i=this.getMri(e);if(!i)return void s.log(o.LogTraceArea.CallCard,"getCallCardUsers() -  no user in partnode.");const l=n.isMri(i)?n.asMri(i):n.isSkypeId(i)?n.sanitizeMri(i,n.Namespaces.SkypeId):void 0;if(l){if(!n.isAgent(l)){let i;if(e.durationChild&&a.isFunction(e.durationChild.getRawText)){const t=parseInt(e.durationChild.getRawText(),10);a.isFinite(t)&&t>=0?i=t:s.warn(o.LogTraceArea.CallCard,"Invalid Call Card user duration from service")}t.push({mri:l,duration:i,isParticipant:!!i})}}else s.log(o.LogTraceArea.CallCard,"getCallCardUsers() - part node user not valid. value:"+r.mriOrId(i))})),t}}},446228:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.callTranslatorBotAutoDetectLanguages=t.callTranslatorBotSpokenLanguageLocale=t.serviceGridViewBotUri=t.serviceAudienceBotUri=t.stateVersion=t.serviceUri=t.timestamp=t.participantIsAlexa=t.initiatorUserMri=t.participantNotIsVideoCapable=t.participantIsCapturingCallMedia=t.participantHasEndpointMetadata=t.participantSupportsCallMediaCaptureNotifications=t.participantHasTruVoiceTranslationConsent=t.participantSupportsTruVoiceTranslation=t.participantHasInCallTranslationConsent=t.participantSupportsInCallTranslation=t.participantSupportsCallRecording=t.participantSupportsCallingReactions=t.getLocalUserSupportsServerMuteUnmute=t.participantSupportsServerMute=void 0;const a=i(496486),n=i(568580),o=i(290298),s=i(640363);function r(e,t,i){return d(e,(e=>{const n=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.services));if(n){const e=n.endpointMetadata.services;return a.find(e,(e=>e.id===t&&e.version===i))}}))}function l(e,t){return!!e&&(!!e.endpoints&&a.some(e.endpoints.endpointDetails,(e=>!!e.endpointMetadata&&t(e.endpointMetadata))))}function c(e,t){return!!n.default.isParticipantConnected(e)&&l(e,t)}function d(e,t){if(e&&e.endpoints&&n.default.isParticipantConnected(e))return t(e.endpoints.endpointDetails)}function u(e,t){return!!e&&a.some(e,(e=>!!e.capabilities&&t(e.capabilities)))}t.participantSupportsServerMute=function(e){return function(e,t){if(!n.default.isParticipantConnected(e))return!1;if(!e)return!1;if(!e.endpoints)return!1;return u(e.endpoints.endpointDetails,t)}(e,(e=>"enabled"===e.serverMuteUnmute))},t.getLocalUserSupportsServerMuteUnmute=function(e){return u(e,(e=>"enabled"===e.serverMuteUnmute))},t.participantSupportsCallingReactions=function(e){return c(e,(e=>!!e.reactionsEnabled))},t.participantSupportsCallRecording=function(e){return c(e,(e=>!!e.supportsCallRecording))},t.participantSupportsInCallTranslation=function(e){return c(e,(e=>!!e.inCallTranslationSupported))},t.participantHasInCallTranslationConsent=function(e){return c(e,(e=>!!e.hasInCallTranslationConsent))},t.participantSupportsTruVoiceTranslation=function(e){return c(e,(e=>!!e.inTruVoiceTranslationSupported))},t.participantHasTruVoiceTranslationConsent=function(e){return c(e,(e=>!!e.hasTruVoiceTranslationConsent))},t.participantSupportsCallMediaCaptureNotifications=function(e){return c(e,(e=>!!e.supportsNotifyCallMediaCaptured))},t.participantHasEndpointMetadata=function(e){return l(e,(e=>!0))},t.participantIsCapturingCallMedia=function(e){return c(e,(e=>!!e.isCallMediaCaptured))},t.participantNotIsVideoCapable=function(e){return c(e,(e=>!a.isUndefined(e.isVideoCapable)&&!e.isVideoCapable))},t.initiatorUserMri=function(e){return d(e,(e=>{const t=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.initiatorUserId));return t?t.endpointMetadata.initiatorUserId:void 0}))},t.participantIsAlexa=function(e){return!!d(e,(e=>a.some(e,(e=>{if(!e)return!1;const t=o.SkypeVersionParser.parse(e.clientVersion);return!!t&&s.default.isAlexaPlatformId(t.platformId)}))))},t.timestamp=function(e){return d(e,(e=>{const t=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.timestamp));return t?t.endpointMetadata.timestamp:void 0}))},t.serviceUri=function(e,t,i){const a=r(e,t,i);return a?a.uri:void 0},t.stateVersion=function(e,t,i){const a=r(e,t,i);return a?a.stateVersion:void 0},t.serviceAudienceBotUri=function(e){return d(e,(e=>{var t,i;const n=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.metadata&&!!e.endpointMetadata.metadata.serviceUri));return n?null===(i=null===(t=n.endpointMetadata)||void 0===t?void 0:t.metadata)||void 0===i?void 0:i.serviceUri:void 0}))},t.serviceGridViewBotUri=function(e){return d(e,(e=>{var t,i;const n=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.metadata&&!!e.endpointMetadata.metadata.serviceUri));return n?null===(i=null===(t=n.endpointMetadata)||void 0===t?void 0:t.metadata)||void 0===i?void 0:i.serviceUri:void 0}))},t.callTranslatorBotSpokenLanguageLocale=function(e){return d(e,(e=>{const t=a.find(e,(e=>!!e.endpointMetadata&&!!e.endpointMetadata.callTranslatorBotSpokenLanguageLocale));return t?t.endpointMetadata.callTranslatorBotSpokenLanguageLocale:void 0}))},t.callTranslatorBotAutoDetectLanguages=function(e){return d(e,(e=>{const t=e.find((e=>{var t;return Boolean(null===(t=null==e?void 0:e.endpointMetadata)||void 0===t?void 0:t.callTranslatorAutoDetectLangs)}));return null==t?void 0:t.endpointMetadata.callTranslatorAutoDetectLangs}))}},796096:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallMarkerDisplayUtils=t.CallMarkerType=void 0;const a=i(496486),n=i(248467),o=i(976059),s=i(671830),r=i(816402),l=i(746096),c=i(436237),d=i(733754),u=i(711828),h=i(853374);var p;!function(e){e[e.Started=0]="Started",e[e.Ended=1]="Ended",e[e.Missed=2]="Missed",e[e.NoAnswer=3]="NoAnswer",e[e.Declined=4]="Declined",e[e.Failed=5]="Failed"}(p=t.CallMarkerType||(t.CallMarkerType={}));t.default=class{static calculateCallMarkerInfo(e,t){let i=this._extractCallCardInfoFromPartListNode(e);return t&&e.type!==n.CallCardType.Started&&(i=this._mergeCallLogsIntoCallMarkerInfo(t,i)),i}static calculateCallMarkerInfoFromPath(e,t,i,a,n){const o={callId:t,conversationId:i,type:a,duration:n};return this._mergeCallLogsIntoCallMarkerInfo(e,o)}static _mergeCallLogsIntoCallMarkerInfo(e,t){let i=t.type,n=t.duration;if(e)if(e.callState===o.CallState.Failed)i=p.Failed;else if(e.callState===o.CallState.Missed&&e.callDirection===o.CallDirection.Incoming)i=p.Missed;else if(e.callState===o.CallState.Missed&&e.callDirection===o.CallDirection.Outgoing)i=p.NoAnswer;else if(e.callState===o.CallState.Declined)i=p.Declined;else if(e.callState===o.CallState.Accepted&&e.callDirection===o.CallDirection.Outgoing&&e.forwardingInfo&&e.forwardingInfo.acceptedBy&&e.forwardingInfo.acceptedBy.type===o.ParticipantType.Voicemail)i=p.NoAnswer;else if(e.callState===o.CallState.Accepted&&e.callDirection===o.CallDirection.Outgoing&&e.callType===o.CallType.MultiParty&&1===a.size(e.participants))i=p.NoAnswer;else if(e.callState===o.CallState.Accepted&&(i=p.Ended,e.connectTime&&e.endTime)){const t=new Date(e.connectTime).getTime(),i=new Date(e.endTime).getTime();t&&i&&i>t&&(n=a.floor((i-t)/1e3))}return Object.assign(Object.assign({},t),{type:i,duration:n})}static _extractCallCardInfoFromPartListNode(e){const t=!!e.conversationId&&s.isThread(e.conversationId),i=!!e.conversationId&&s.isPhoneMri(e.conversationId),o=!!e.conversationId&&s.isGroupConversation(e.conversationId),r=n.default.getCallCardUsers(e.children),d=a.filter(r,(e=>e.isParticipant));let u,h=p.Ended;const g=a.size(e.children),C=a.size(r),S=a.size(d);g!==C&&c.warn(l.LogTraceArea.CallCard,`renderPartListNodeParts() user mismatch. tree: ${g} card: ${C} participants: ${S}type: ${h} thread: ${t} PSTN: ${i}`);const m=S>1;return e.type===n.CallCardType.Started?h=p.Started:o&&!m||!o&&e.type===n.CallCardType.Missed?h=p.Missed:(u=n.default.getCallUsersMaxDuration(r),h=p.Ended),{callId:e.callId,conversationId:e.conversationId,type:h,duration:u}}};t.CallMarkerDisplayUtils=class{static getText(e,t){switch(e){case p.Started:return d.getString("CallCard.CallStartedStatusMessage");case p.Missed:return d.getString("CallCard.CallMissedStatusMessage");case p.Ended:if(t){const e=r.default.getFormattedDuration(t,!1);return d.getString("CallCard.CallEndedStatusWithDurationMessage",{duration:e})}return d.getString("CallCard.CallEndedStatusMessage");case p.Declined:return d.getString("CallCard.CallDeclinedStatusMessage");case p.NoAnswer:return d.getString("CallCard.CallNoAnswerStatusMessage");case p.Failed:return d.getString("CallCard.CallFailedStatusMessage");default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getTextForEncryptedThread(e,t){switch(e){case p.Started:return d.getString("CallCard.EncryptedCallStartedStatusMessage");case p.Missed:return d.getString("CallCard.EncryptedCallMissedStatusMessage");case p.Ended:if(t){const e=r.default.getFormattedDuration(t,!1);return d.getString("CallCard.EncryptedCallEndedStatusWithDurationMessage",{duration:e})}return d.getString("CallCard.EncryptedCallEndedStatusMessage");case p.Declined:return d.getString("CallCard.EncryptedCallDeclinedStatusMessage");case p.NoAnswer:return d.getString("CallCard.EncryptedCallNoAnswerStatusMessage");case p.Failed:return d.getString("CallCard.EncryptedCallFailedStatusMessage");default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getIcon(e){switch(e){case p.Started:return u.SkypeIcon.CallStart;case p.Missed:case p.NoAnswer:case p.Declined:case p.Failed:return u.SkypeIcon.CallMissed;case p.Ended:return u.SkypeIcon.CallEnd;default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}static getTextForAccessibilityLabel(e){switch(e){case p.Started:return d.getString("AccessibilityLabel.Call");case p.Missed:return d.getString("AccessibilityLabel.CallMissed");case p.Ended:return d.getString("AccessibilityLabel.Call");case p.Declined:return d.getString("AccessibilityLabel.CallDeclined");case p.NoAnswer:return d.getString("AccessibilityLabel.CallNoAnswer");case p.Failed:return d.getString("AccessibilityLabel.CallFailed");default:return h.default.switchStatementExhaustiveChecking(e,"Unknown marker type - Was a call marker type added?")}}}},138438:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(351077);t.default=class{static updateCallEventMessages(e){const t=a.compact(e),i=a.clone(t);let o,s,r=0;return a.each(t,((e,t)=>{n.isEventCallStartedMessageType(e)?(o=e,r=t,s=void 0):n.isEventCallEndedMessageType(e)?o&&o.skypeguid===e.skypeguid&&(s?i[t]=e.applyPropertyLie("messagesSentDuringCall",!0):i[r]=void 0):e.isShownInStream()&&(s=e)})),a.compact(i)}}},951638:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.problemSections=t.CQFHash=t.shuffleArray=t.XorShift=t.tokensString=t.shouldTriggerForCall=t.ProblemTokens=t.ProblemSectionType=void 0;const a=i(421832),n=i(148540),o=i(397691),s=i(671830),r=i(440276),l=i(746096),c=i(436237),d=i(18078);var u,h;!function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(u=t.ProblemSectionType||(t.ProblemSectionType={})),function(e){e[e.AudioTokenNoSoundLocal=101]="AudioTokenNoSoundLocal",e[e.AudioTokenNoSoundRemote=102]="AudioTokenNoSoundRemote",e[e.AudioTokenEcho=103]="AudioTokenEcho",e[e.AudioTokenNoise=104]="AudioTokenNoise",e[e.AudioTokenLowSound=105]="AudioTokenLowSound",e[e.AudioTokenDropped=106]="AudioTokenDropped",e[e.AudioTokenDistorted=107]="AudioTokenDistorted",e[e.AudioTokenInterrupted=108]="AudioTokenInterrupted",e[e.AudioTokenOther=109]="AudioTokenOther",e[e.AudioTokenPSTNDialpad=301]="AudioTokenPSTNDialpad",e[e.VideoTokenNoVideoLocal=201]="VideoTokenNoVideoLocal",e[e.VideoTokenNoVideoRemote=202]="VideoTokenNoVideoRemote",e[e.VideoTokenLowQuality=203]="VideoTokenLowQuality",e[e.VideoTokenFreezing=204]="VideoTokenFreezing",e[e.VideoTokenStoppedUnexpectedly=205]="VideoTokenStoppedUnexpectedly",e[e.VideoTokenOtherSideTooDark=206]="VideoTokenOtherSideTooDark",e[e.VideoTokenNoAudioSync=207]="VideoTokenNoAudioSync",e[e.VideoTokenOther=208]="VideoTokenOther"}(h=t.ProblemTokens||(t.ProblemTokens={})),t.shouldTriggerForCall=function(e,t,i){if(e.durationSeconds<t.MinCallDurationSecs)return c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" duration too short ("+e.durationSeconds+" < "+t.MinCallDurationSecs+"). Returning false."),o.Resolved(!1);if(e.forwardingDestinationType&&"voicemail"===e.forwardingDestinationType)return c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" went to voicemail. Returning false."),o.Resolved(!1);let r;if(i){const t=s.isGroupConversation(e.conversationMri)?n.EcsCallType.CallTypeGroup:s.isPhoneMri(e.conversationMri)?n.EcsCallType.CallTypePstn:n.EcsCallType.CallTypeS2s;r=a.default.shouldTriggerCQF(d.default.getSkypeId(),e.callId,t).catch((()=>(c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: "+e.callId+" calling stack didn't provide a value. Assuming false."),!1)))}else r=o.Resolved(!1);return r.then((i=>{if(i)return!0;const a=s.isGroupConversation(e.conversationMri)?t.GroupCall_Percent:s.isPhoneMri(e.conversationMri)?t.PSTN_Percent:t.S2S_Percent;return C(e.callId)%100>=a?(c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: hash for "+e.callId+" not within "+a+"%. Returning false."),!1):(c.log(l.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackUtils.shouldTriggerForCall: hash for "+e.callId+" within "+a+"%. Returning true."),!0)}))},t.tokensString=function(e){if(0!==e.length)return"checks="+e.join("%20")};class p{constructor(e){const t=C(e);this._w=t,this._x=t/2>>>0,this._y=t/3>>>0,this._z=t/4>>>0}getNext(){const e=(this._x^this._x<<11>>>0)>>>0;return this._x=this._y,this._y=this._z,this._z=this._w,this._w=(this._w^this._w>>>19^e^e>>>8)>>>0,this._w}}function g(e,t){const i=new p(t);for(let t=e.length-1;t>=1;t--){const a=i.getNext()%(t+1),n=e[t];e[t]=e[a],e[a]=n}}function C(e){const t=r.computeSHA256(e);return(t[0]<<24|t[1]<<16|t[2]<<8|t[3]<<0)>>>0}t.XorShift=p,t.shuffleArray=g,t.CQFHash=C;const S=[h.AudioTokenNoSoundLocal,h.AudioTokenNoSoundRemote,h.AudioTokenEcho,h.AudioTokenNoise,h.AudioTokenLowSound,h.AudioTokenDropped,h.AudioTokenDistorted,h.AudioTokenInterrupted],m=[h.VideoTokenNoVideoLocal,h.VideoTokenNoVideoRemote,h.VideoTokenLowQuality,h.VideoTokenFreezing,h.VideoTokenStoppedUnexpectedly,h.VideoTokenOtherSideTooDark,h.VideoTokenNoAudioSync];function y(e,t,i){const a=t.slice(0);return g(a,e),a}t.problemSections=function(e,t){const i=[{type:u.Audio,title:"AudioProblems",problems:y(e,S,h.AudioTokenOther)}];return t&&(i.push({type:u.Video,title:"VideoProblems",problems:y(e,m,h.VideoTokenOther)}),g(i,e)),i}},660289:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(480200),n=i(746096),o=i(436237),s=i(33004),r=i(914976),l=i(886045);t.default=class{constructor(){this._participantReactionCallbacks={}}registerUnhandledReactionCallback(e){this._unhandledReactionCallback=e}unregisterUnhandledReactionCallback(){this._unhandledReactionCallback=void 0}registerUnhandledReactionDismissCallback(e){this._dismissUnhandledReactionCallback=e}unregisterUnhandledReactionDismissCallback(){this._dismissUnhandledReactionCallback=void 0}registerParticipantReactionCallback(e,t){o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.registerParticipantReactionCallback key: "+r.mriOrId(e)),this._participantReactionCallbacks[e]=t}unregisterParticipantReactionCallback(e){o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.unregisterParticipantReactionCallback key: "+r.mriOrId(e)),delete this._participantReactionCallbacks[e]}dismissReaction(e){o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.dismissReaction key: "+r.mriOrId(e)),this._dismissUnhandledReactionCallback&&this._dismissUnhandledReactionCallback(e)}showReaction(e){l.default.shouldAnnounceForAccessibility()&&s.default.announceReaction(e.reaction);const t=e.isLocal?a.CallStageElementKeys.localUserKey:e.reaction.creator,i=e.isLocal?a.CallStageElementKeys.localUserKey:r.mriOrId(e.reaction.creator);o.log(n.LogTraceArea.CallReactions,"CallReactionsDisplayHelper.showReaction cuid: "+e.reaction.cuid+" key: "+i+" has callback "+!!this._participantReactionCallbacks[t]),this._participantReactionCallbacks[t]&&this._participantReactionCallbacks[t](e)||this._unhandledReactionCallback&&this._unhandledReactionCallback(e)}static getTextTimeoutBasedOnContent(e){return e.length<=40?3e3:e.length<=100?4500:6e3}}},698172:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(351077);i(671830);t.default=new class{getReactionsThreadPostParams(e){return{[a.MessageProperties.CastParentThreadId]:e}}}},568580:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SubscriptionTokenDisposable=t.SubscriptionDisposable=void 0;const a=i(174958),n=i(496486),o=i(999591),s=i(148540),r=i(974634),l=i(397691),c=i(816402),d=i(598925),u=i(671830),h=i(440276),p=i(746096),g=i(436237),C=i(527683),S=i(276173),m=i(914976),y=i(404057),f=i(47447);t.SubscriptionDisposable=class{constructor(e,t){this._token=e,this._unsubscribe=t}dispose(){if(this._token){const e=this._token;this._token=void 0,this._unsubscribe(e)}}};t.SubscriptionTokenDisposable=class{constructor(e){this._token=e}dispose(){this._token&&(this._token.unsubscribe(),this._token=void 0)}};const b=[s.CallState.LocalHold,s.CallState.RemoteHold],_=[...b,s.CallState.Connected],T=[..._,s.CallState.Connecting,s.CallState.Notified,s.CallState.EarlyMedia];class v{constructor(){this.onCallingError=new r.default,this._callBlacklist=[]}activeCallStates(){return T}connectedCallStates(){return _}onHoldCallStates(){return b}isCallStateActive(e){return n.includes(this.activeCallStates(),e)}isCallStateConnected(e){return n.includes(this.connectedCallStates(),e)}isCallStateOnHold(e){return n.includes(this.onHoldCallStates(),e)}isParticipantConnected(e){return!!e&&this.isParticipantStateConnected(e.state)}isParticipantInCanStreamMediaState(e){return(null==e?void 0:e.state)===s.ParticipantState.EarlyMedia}isParticipantStateConnected(e){return e===s.ParticipantState.Connected||e===s.ParticipantState.OnHold}isParticipantRinging(e,t=!0){return e&&this.isParticipantStateRinging(e.state,t)}isParticipantStateRinging(e,t=!0){return t&&e===s.ParticipantState.Connecting||e===s.ParticipantState.Ringing}isParticipantOnHold(e){return e&&e.state===s.ParticipantState.OnHold}isParticipantTalking(e){return e&&e.voiceLevel>0}isParticipantMuted(e){return e&&e.isServerMuted}isPstnNetherlandsReason(e){return!!e&&480===e.callControllerCode&&213432===e.callControllerSubCode}participantMris(e){const t=u.asMri(e.id);return{default:(e.acceptedBy&&e.acceptedBy!==e.id?v._normalizeForwardedEndpoint(u.asMri(e.acceptedBy)):void 0)||t,original:t}}static _normalizeForwardedEndpoint(e){if(!u.isPhoneMri(e))return e;const t=u.splitMri(e),i=C.default.getNormalizedPhoneNumber(t.id);return i?u.sanitizeMri(i,t.namespace):e}conversationLiveStateFromCastNotification(e){if(!e)return void g.error(p.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing castContext: undefined");const t=this._uncompressPayload(e),i=t&&n.attempt((()=>atob(t)));if(!i||n.isError(i))return void g.error(p.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing castContext: "+y.default.errorAsString(i),a.pii.Omit(e||""));const o=y.default.parseJsonErrorToUndefined(i);if(o&&!n.isError(o))return o.groupCallInitiator&&(o.groupCallInitiator=u.sanitizeMri(o.groupCallInitiator,u.Namespaces.SkypeId)),o;g.error(p.LogTraceArea.Calling,"conversationLiveStateFromCastNotification: Error when parsing rawData: "+y.default.errorAsString(o),a.pii.Omit(i||""))}blacklistCallId(e,t){n.includes(this._callBlacklist,e)||(g.log(p.LogTraceArea.Calling,"Blacklisting callId: "+e+" causeId: "+t),this._callBlacklist.push(e))}isLiveStateValid(e){return!this.invalidLiveStateError(e)}invalidLiveStateError(e){return e?"Active"!==e.status?("InActive"===e.status&&g.warn(p.LogTraceArea.Calling,"Got non-null inactive live state "+a.pii.Omit(JSON.stringify(e))),"Status of call is "+e.status):e.expiration?1e3*e.expiration<Date.now()?"Expired with Active status":e.conversationId&&e.conversationUrl?n.includes(this._callBlacklist,e.conversationId)?"Call ID has been blacklisted":u.isMri(e.conversationUrl)&&u.isEncryptedThread(e.conversationUrl)?"Call is encrypted":void 0:"Missing call ID or conversation URL":"Missing expiration":"No live state found"}isLiveStateForGoLive(e){return!!e&&"cast"===e.conversationType}isLiveStateValidAndForGoLive(e){return!!this.isLiveStateValid(e)&&this.isLiveStateForGoLive(e)}incomingCallNotificationForFlamingo(e){let t,i;if(e.content){const a=y.default.parseJsonErrorToUndefined(e.content);a&&(a.cp&&(t=this._uncompressPayload(a.cp)),i=a.callId)}const a=u.getParsedConversationId(e),n=parseInt(e.eventId,10);return{evt:n,gp:t,gpc:e.content,nsp:void 0,displayName:void 0,callId:e.skypeguid||i,conversationMri:v._maybeSanitizeMri(e.conversationId||e.imdisplayname||a,n),callerMri:v._maybeSanitizeMri(e.imdisplayname,n),participantId:e.skypeguid,videoCall:"true"===e.isVideoCall,encryptedKey:void 0,recipientId:void 0}}incomingCallNotificationForPnh(e,t){let i;return t.servicePayload&&t.servicePayload.cp&&(i=this._uncompressPayload(t.servicePayload.cp)),{evt:e,gp:i,gpc:JSON.stringify(t.servicePayload),nsp:void 0,displayName:t.displayName,callId:t.callId,conversationMri:v._maybeConvertToEncryptedThread(v._maybeSanitizeMri(t.convoId,e),e),callerMri:v._maybeSanitizeMri(t.callerId,e),participantId:t.participantId,videoCall:"true"===t.videoCall,encryptedKey:t.encryptedKey,recipientId:v._maybeSanitizeRecipientId(t.recipientId)}}incomingGoLivelNotificationForPnh(e,t){const i=this.conversationLiveStateFromCastNotification(t.castContext);if(i)return{evt:e,callId:t.callId,callerMri:v._maybeSanitizeMri(i.groupCallInitiator,e),conversationMri:v._maybeSanitizeMri(t.threadId,e),recipientId:v._maybeSanitizeRecipientId(t.recipientId),conversationLiveState:i,participantId:void 0};g.warn(p.LogTraceArea.Calling,"Conversation livestate missing from notification: "+a.pii.Omit(JSON.stringify(t)))}stopGoLiveNotificationForPnh(e,t){return{evt:e,callId:t.callId,conversationMri:v._maybeSanitizeMri(t.threadId,e),recipientId:v._maybeSanitizeRecipientId(t.recipientId),participantId:void 0}}incomingGoLiveNotificationForTrouter(e){const t=e.eventId||e.body.evt,i=this.conversationLiveStateFromCastNotification(e.body.castContext);if(i)return{evt:t,callId:e.body.callId,callerMri:v._maybeSanitizeMri(i.groupCallInitiator,t),conversationMri:v._maybeSanitizeMri(e.body.threadId,t),recipientId:v._maybeSanitizeRecipientId(e.body.recipientId),conversationLiveState:i,participantId:void 0};g.warn(p.LogTraceArea.Calling,"Conversation livestate missing from notification: "+a.pii.Omit(JSON.stringify(e.body)))}stopGoLiveNotificationForTrouter(e){const t=e.eventId||e.body.evt;return{evt:t,callId:e.body.callId,conversationMri:v._maybeSanitizeMri(e.body.threadId,t),recipientId:v._maybeSanitizeRecipientId(e.body.recipientId),participantId:void 0}}_uncompressPayload(e){const t=h.base64StringToUint8Array(e);if(!t)return void g.warn(p.LogTraceArea.Calling,"_uncompressPayload: Couldn't un-base64 call data");const i=o.inflate(t);return h.Uint8ArrayToBase64String(i)}stopCallNotificationForPnh(e,t){return{evt:e,reason:t.reason,callId:t.callId,conversationMri:v._maybeSanitizeMri(t.conversationId,e),callerMri:v._maybeSanitizeMri(t.callerMri,e),participantId:t.participantId,recipientId:v._maybeSanitizeRecipientId(t.recipientId)}}stopCallNotificationForPermission(e){return{evt:e.evt,callId:e.callId,participantId:e.participantId,conversationMri:e.conversationMri,callerMri:e.callerMri,reason:"RejectedDueToNoMicPermission",recipientId:e.recipientId}}incomingCallNotificationForTrouter(e){let t;t=e.body.servicePayload&&e.body.servicePayload.cp?this._uncompressPayload(e.body.servicePayload.cp):e.body.gp;const i=e.eventId||e.body.evt;return{evt:i,gp:t,gpc:e.body.servicePayload?JSON.stringify(e.body.servicePayload):void 0,nsp:void 0,displayName:e.body.displayName,callId:e.body.callId,conversationMri:v._maybeConvertToEncryptedThread(v._maybeSanitizeMri(e.body.convoId||e.body.conversationId,i),i),callerMri:v._maybeSanitizeMri(e.body.callerId||e.body.callerMri,i),participantId:e.body.participantId,videoCall:"boolean"==typeof e.body.videoCall?e.body.videoCall:"true"===e.body.videoCall,encryptedKey:e.body.encryptedKey,recipientId:v._maybeSanitizeRecipientId(e.body.recipientId)}}stopCallNotificationForTrouter(e){const t=e.eventId||e.body.evt;return{evt:t,reason:e.body.reason,callId:e.body.callId,conversationMri:v._maybeSanitizeMri(e.body.convoId||e.body.conversationId,t),callerMri:v._maybeSanitizeMri(e.body.callerId||e.body.callerMri,t),participantId:e.body.participantId,recipientId:v._maybeSanitizeRecipientId(e.body.recipientId)}}incomingCallNotificationForP2PPnh(e){const t=e.eventType;return{evt:t,displayName:e.displayName,callId:e.callId,conversationMri:v._maybeSanitizeMri(e.convoId,t),callerMri:v._maybeSanitizeMri(e.callerId,t),participantId:e.participantId,videoCall:"true"===e.videoCall,recipientId:v._maybeSanitizeRecipientId(e.recipientId)}}static _maybeSanitizeMri(e,t){const i=v._getCallerNamespaceForCallEvent(e,t);return e?u.sanitizeMri(e,i):void 0}static _maybeConvertToEncryptedThread(e,t){return t===S.PNHEvents.IncomingNGCEncryptedCall&&e&&!u.isEncryptedThread(e)?u.buildOneOnOneEncryptedThreadId(e):e}static _maybeSanitizeRecipientId(e){return e?u.sanitizeMri(e,u.Namespaces.SkypeId):void 0}buildNGCCallPayload(e,t,i,o,s,r){var l,c,d;const u=e.gp;if(!u)return void g.error(p.LogTraceArea.Calling,`buildNGCCallPayload: Error when decoding gp payload: undefined causeId: ${r}`);const h=n.attempt((()=>atob(u)));if(!h||n.isError(h))return void g.error(p.LogTraceArea.Calling,"buildNGCCallPayload: Error when decoding gp payload: "+y.default.errorAsString(h)+" causeId: "+r+" "+a.pii.Omit(u));const C=y.default.parseJsonErrorable(h);if(C&&!n.isError(C)){if(C.callNotification)return{conversationId:e.conversationMri||(null===(l=C.groupChat)||void 0===l?void 0:l.threadId)||C.callNotification.from.id,messageId:null===(c=C.groupChat)||void 0===c?void 0:c.messageId,callerId:e.callerMri||C.callNotification.from.id,convoCallId:e.callId||C.debugContent.callId,isMultiParty:Boolean(null===(d=C.conversationInvitation)||void 0===d?void 0:d.isMultiParty),fromMixer:C.callNotification.fromMixer,ngcCall:!0,body:{evt:e.evt,nsp:e.nsp||"",gp:f.CallingCapabilities.isPluginlessCallingStack()?e.gp||"":e.gpc||e.gp||""},videoCall:e.videoCall,launchTime:i,pushReceivedTime:o.pushReceivedTime,registrationId:s||"",callKey:t,participantId:e.participantId,connectionType:o.connectionType};g.log(p.LogTraceArea.Calling,`Unable to create incoming NGC payload ${r}`)}else g.error(p.LogTraceArea.Calling,"buildNGCCallPayload: Error when parsing gp payload: "+y.default.errorAsString(C)+" causeId: "+r+" "+a.pii.Omit(h))}static _getCallerNamespaceForCallEvent(e,t){if(e&&u.isMri(e))return u.getMriNamespace(e);switch(t){case S.PNHEvents.IncomingNGCCall:case S.PNHEvents.IncomingP2PCall:case S.PNHEvents.IncomingNGCGroupCall:case S.PNHEvents.IncomingNGCEncryptedCall:return u.Namespaces.SkypeId;case S.PNHEvents.IncomingNGCPSTNCall:return u.Namespaces.PSTN;case S.PNHEvents.IncomingS4BCall:return u.Namespaces.S4B_Bridge;case S.PNHEvents.IncomingNGCStopRinger:return C.default.isPossiblyPhoneNumber(e)?u.Namespaces.PSTN:u.Namespaces.SkypeId;default:return u.Namespaces.SkypeId}}getMediaPeerTypeForIncomingCall(e){switch(e){case S.PNHEvents.IncomingS4BCall:case S.PNHEvents.IncomingNGCCall:case S.PNHEvents.IncomingNGCEncryptedCall:return s.MediaPeerType.ConsumerTwoParty;case S.PNHEvents.IncomingNGCGroupCall:return s.MediaPeerType.ConsumerPstn;case S.PNHEvents.IncomingNGCPSTNCall:default:return s.MediaPeerType.ConsumerMultiParty}}isValidCallingMri(e){if(!e)return!1;if(!u.isMri(e))return!1;switch(u.getMriNamespace(e)){case u.Namespaces.S4B_Bridge:case u.Namespaces.PSTN:case u.Namespaces.SkypeId:case u.Namespaces.Thread:case u.Namespaces.Bot:return!0;default:return!1}}extractMriFromKey(e,t=!1){if(u.isMri(e))return t?m.mriOrId(e):e;const i=["ss_","video_","icon_"];for(let a=0;a<i.length;++a)if(n.startsWith(e,i[a])){const n=e.substring(i[a].length);if(u.isMri(n))return t?`${i[a]}${m.mriOrId(n)}`:n}return t?a.pii.Omit(e):e}sanitizeCallStartOptions(e){return n.mapValues(n.clone(e),((e,t)=>"callKey"===t||"encryptedKey"===t?e?"yes":"no":"label"===t?a.pii.Omit(e):e))}validateIncomingCallNotificationBody(e){return!!e.conversationMri&&(u.isEncryptedThread(e.conversationMri)?!!e.encryptedKey:!e.encryptedKey)}validateOutgoingCall(e,t){return!u.isEncryptedThread(e)||!t.withVideo&&!!t.ringOthers}validateOutgoingCallParticipants(e,t){return!e.ringOthers||t.length>0}generateCallingError(e,t,i,a,n,o,s){const r=new d.CallingError(e,t,i,a,n,o,s);return g.warn(p.LogTraceArea.Calling,`[CallingUtils] generateCallingError for callId: ${e}, action: ${t}, message: ${i} terminatedReason: ${a}, failureType: ${n} validationReason: ${o}`),this.onCallingError.fire(r),l.Rejected(r)}maybeCallingErrorAsString(e){const t=e.action,i=e.terminatedReason,a=e.failureType,n=e.validationReason?d.CallValidationFailureReason[e.validationReason]:void 0,o=e.message;if(!(t||i||a||n))return{message:y.default.errorAsString(e),isCallingError:!1};return{message:"callId: "+e.callId+"action: "+t+" terminatedReason: "+i+" failureType: "+a+" validationFailureReason: "+n+" message: "+o,isCallingError:!0}}validateParametersPromise(e,t,i,a,n){return this.validateParameters(e,t,a,n)?l.Resolved():this.generateCallingError(e,i,"Parameter validation failed for "+t+" ("+i+")",s.TerminatedReason.BadRequest,s.FailureType.CallSetupFailed,d.CallValidationFailureReason.InvalidParameters,a)}validateParameters(e,t,i,a){let o=!0;return n.each(a,(a=>{const n=n=>{const s="Failed to validate parameter "+m.mriOrId(a.param)+" in method ["+t+"] callId: "+e+" causeId: "+i+(n?", error "+y.default.errorAsString(n):"");g.error(p.LogTraceArea.Calling,s),o=!1};try{a.check()||n()}catch(e){n(e)}})),o}isEventTypeTriggeringMuteAction(e){return n.includes([d.CallDeviceQualityEventType.DeviceEcho,d.CallDeviceQualityEventType.DeviceMultipleEndpoints,d.CallDeviceQualityEventType.AudioCaptureUltrasoundDetected],e)}createLiveStateFromJoinBlob(e){const t=y.default.parseJsonErrorToUndefined(e.trim());return void 0!==t&&(t.status="Active",t.expiration=c.default.add(Date.now(),0,1)/1e3),void 0!==t?y.default.asString(t):null}}t.default=new v},256955:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DialerSearchUtils=void 0;const a=i(496486);t.DialerSearchUtils=class{static sortByDisplayName(e){return a.sortBy(a.values(e),(e=>e.contact.displayName))}static getSearchCriteria(e,t=!1){return 0!==e.inputValue.indexOf("+")&&t||a.isEmpty(e.E164)?e.inputValue:e.E164}}},283706:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(285788),n=i(480200),o=i(733754),s=i(711828);t.default=class{static getViewInformationForAudioRouting(e){let t;switch(e){case a.default.AudioOutputEarpiece:t=o.getString("CallPanel.EarpieceWarning");break;case a.default.AudioOutputSpeaker:t=o.getString("CallPanel.SpeakerWarning");break;case a.default.AudioOutputBluetooth:t=o.getString("CallPanel.BluetoothWarning");break;case a.default.AudioOutputWiredHeadset:t=o.getString("CallPanel.HeadsetWarning");break;default:return}return{warningText:t,warningViewType:n.InCallWarningViewType.Audio}}static getViewInformationForAudioMuted(e,t){if((e||t)&&(e||t)){let i,a;return t&&e?(i=void 0,a=o.getString("CallPanel.SpeakerAndMicrophoneMuted")):t?(i=s.SkypeIcon.VolumeOff,a=o.getString("CallPanel.SpeakerMuted")):e&&(i=s.SkypeIcon.MicrophoneOff,a=o.getString("CallPanel.MicrophoneMuted")),a?{warningText:a,icon:i,warningViewType:n.InCallWarningViewType.Audio}:void 0}}static getViewInformationForVoicemail(){return{warningText:o.getString("CallPanel.RecordingVoicemail"),warningViewType:n.InCallWarningViewType.Voicemail}}static getViewInformationForForwarding(){return{warningText:o.getString("CallPanel.CallForwarding"),warningViewType:n.InCallWarningViewType.Forwarding}}}},502830:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(436237),n=i(354298);t.default=class{static registerOpenAction(e,t,i){a.track(new n.ExperimentOpenAction(e,t,i))}static registerDialerButtonClickAction(e,t,i){a.track(new n.ExperimentButtonClickAction(n.NavigateToDestination.DialerPanel,e,t,i))}static registerBalanceStateButtonClickAction(e,t,i){a.track(new n.ExperimentButtonClickAction(n.NavigateToDestination.BalanceStatePanel,e,t,i))}static registerCallButtonClickAction(e,t){a.track(new n.ExperimentButtonClickAction(n.NavigateToDestination.GroupCall,e,t))}static registerCloseButtonClickAction(e,t,i){a.track(new n.ExperimentBannerCloseAction(e,t,i))}}},527683:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PhoneNumberFormat=void 0;const a=i(174958),n=i(93791),o=i(496486),s=i(746096),r=i(436237),l=i(733754),c=i(404057),d=i(640363),u=i(478262),h=i(853374),p=/[^0-9\.\+]+/g,g=/(,+(.*))/;let C;var S;!function(e){e[e.E164=1]="E164",e[e.INTERNATIONAL=2]="INTERNATIONAL",e[e.NATIONAL=3]="NATIONAL",e[e.RFC3966=4]="RFC3966"}(S=t.PhoneNumberFormat||(t.PhoneNumberFormat={}));class m{static isPossibleNumber(e,t){return m._getInstance().isPossibleNumberString(e,t||d.default.getCountryCode())}static getRegionCodeForNumber(e){try{return e?m._getInstance().getRegionCodeForNumber(e):void 0}catch(t){return void r.error(s.LogTraceArea.Phone,"PhoneUtils.getRegionCodeForNumber: Failed to get region code for number "+a.pii.Omit(e?e.getRawInput():"")+" - "+c.default.errorAsString(t))}}static getCountryCodeForRegion(e){return m._getInstance().getCountryCodeForRegion(e)}static isValidNumberString(e){return m.isValidNumber(m.parse(e))}static isValidNumber(e){return!!e&&m._getInstance().isValidNumber(e)}static parseAndFormat(e,t,i){const a=m.parse(e,i);if(a&&m._getInstance().isValidNumber(a))return m.format(a,t)}static parse(e,t){try{return m._getInstance().parse(e,t)}catch(e){return}}static parseAndKeepRawInput(e,t){try{return m._getInstance().parseAndKeepRawInput(e,t)}catch(t){return void r.error(s.LogTraceArea.Phone,"PhoneUtils.parseAndKeepRawInput: Failed to parse phone number "+a.pii.Omit(e)+" - "+c.default.errorAsString(t))}}static format(e,t){return t?m._getInstance().format(e,m._getGoogleFormat(t)):m._getInstance().format(e)}static formatNumberWithType(e){const t=m.getStringForPhoneType(e.type);let i=e.number;try{const t=m._getInstance().parse(e.number);i=m._getInstance().format(t,n.PhoneNumberFormat.INTERNATIONAL)}catch(e){}return l.getString("PhoneUtils.PhoneFormat",{type:t,number:i})}static getMatchedPhoneNumber(e,t){if(e&&0!==e.length)return o.find(e,(e=>e.number.indexOf(t)>-1))}static getStringForPhoneType(e){switch(e){case u.PhoneNumberTypes.Home:return l.getString("PhoneUtils.PhoneHome");case u.PhoneNumberTypes.Mobile:return l.getString("PhoneUtils.PhoneMobile");case u.PhoneNumberTypes.Office:return l.getString("PhoneUtils.PhoneOffice");case u.PhoneNumberTypes.Other:return l.getString("PhoneUtils.PhoneOther");default:return h.default.switchStatementExhaustiveChecking(e)}}static convertLabelToPhoneType(e){if(!e)return u.PhoneNumberTypes.Other;switch(e.toLowerCase()){case"mobile":return u.PhoneNumberTypes.Mobile;case"office":return u.PhoneNumberTypes.Office;case"home":return u.PhoneNumberTypes.Home;default:return u.PhoneNumberTypes.Other}}static getNormalizedPhoneNumber(e,t=!0){let i=e.trim();if(t&&(i=m.convertPhoneLetters(i),i=i.replace(p,""),0===i.length))return"";let a=d.default.getCountryCode();if(!a){const e=l.getLocale().split("-");e instanceof Array&&e.length>1&&(a=e[1])}i=m.convert00ToPlus(i);let n=m.parse(i,a);return n&&m.isValidNumber(n)?m.format(n,S.E164):n&&o.startsWith(i,"+")?i:o.startsWith(i,"+")?void 0:(n=m.parse("+"+i),n&&m.isValidNumber(n)?m.format(n,S.E164):i)}static normalizePartialNumberWithCountryCode(e){let t=e.replace(p,"");if(0===t.length)return"";const i=d.default.getCountryCode();if(t=m.convert00ToPlus(t),!o.startsWith(t,"+")&&i)try{const e=m._getInstance().getCountryCodeForRegion(i);return m.compilePhoneNumber(t,e)}catch(e){return r.warn(s.LogTraceArea.Phone,"PhoneUtils: Unable to get country code for countryCode: ",a.pii.Omit(i)),t}return t}static convert00ToPlus(e){return o.startsWith(e,"00")?"+"+e.substring(2):e}static compilePhoneNumber(e,t){return"+"+t+e}static stripSpecialChars(e){return e.replace(p,"")}static stripPossibleExtension(e){return e.replace(g,"")}static getPossibleExtension(e,t){const i=e.match(g),a=t?1:2;return i&&i[a]?i[a]:void 0}static isPossiblyPhoneNumber(e){return!!e&&(e.startsWith("+")&&(e=e.slice(1)),!isNaN(parseInt(e,10)))}static stripPlusSign(e){return e&&e.length>0&&"+"===e[0]?e.substring(1):e}static _getInstance(){return C||(C=n.PhoneNumberUtil.getInstance()),C}static _getGoogleFormat(e){switch(e){case S.E164:return n.PhoneNumberFormat.E164;case S.INTERNATIONAL:return n.PhoneNumberFormat.INTERNATIONAL;case S.NATIONAL:return n.PhoneNumberFormat.NATIONAL;case S.RFC3966:return n.PhoneNumberFormat.RFC3966}}static convertPhoneLetters(e){e=e.toLowerCase();let t="";const i=o.startsWith(e,"+");return o.each(e.split(""),(e=>{switch(e){case"0":t+="0";break;case"1":t+="1";break;case"2":case"a":case"b":case"c":t+="2";break;case"3":case"d":case"e":case"f":t+="3";break;case"4":case"g":case"h":case"i":t+="4";break;case"5":case"j":case"k":case"l":t+="5";break;case"6":case"m":case"n":case"o":t+="6";break;case"7":case"p":case"q":case"r":case"s":t+="7";break;case"8":case"t":case"u":case"v":t+="8";break;case"9":case"w":case"x":case"y":case"z":t+="9"}})),i&&(t="+"+t),t}}t.default=m},110771:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(397691),o=i(951638),s=i(746096),r=i(436237);t.default=new class{shouldPresentScheduleNextCallPanel(e,t,i,n,o){if(!a.isEmpty(t))return r.log(s.LogTraceArea.ScheduleCall,"shouldPresentScheduleNextCallPanel: skipping for "+e.callId+" because other calls are active "+JSON.stringify(t)),!1;const l=e.durationSeconds>o.scheduleNextCallDurationSeconds,c=n>=o.scheduleNextCallFrequency,d=i<o.maxScheduleNextCallDisplays;return!!(l&&c&&d&&e.isCallCreator)}shouldPresentCallQualityFeedbackPanel(e,t,i,l,c){return a.isEmpty(t)?l?(r.log(s.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackPanel:_maybePresentCQF: showing because of forceCQF"),n.Resolved(!0)):o.shouldTriggerForCall(e.callInfo,i,c).then((t=>(t&&r.log(s.LogTraceArea.CallQualityFeedback,"CallQualityFeedbackPanel:_maybePresentCQF: showing for "+e.callInfo.callId+" because of ECS"),t))):(r.log(s.LogTraceArea.CallQualityFeedback,"shouldPresentCallQualityFeedbackPanel: skipping for "+e.callInfo.callId+" because other calls are active "+JSON.stringify(t)),n.Resolved(!1))}shouldPresentPermissionPanel(e,t){return!!a.isEmpty(t)||(r.log(s.LogTraceArea.CallMonitor,"shouldPresentPermissionPanel: skipping for "+e.callId+" because other calls are active "+JSON.stringify(t)),!1)}shouldPresentCallerIdPanel(e){return a.isEmpty(e)}}},33004:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(516778),o=i(244770),s=i(889391),r=i(480200),l=i(681959),c=i(351077),d=i(23293),u=i(986374),h=i(952262),p=i(82433),g=i(746096),C=i(436237),S=i(733754),m=i(89808),y=i(18078),f=i(404057),b=i(78780),_=i(478262),T=["cid","sender","receivers","message"];class v{static imageForSticker(e){switch(e.toLowerCase()){case"sticker1":return o.Collection.CAPTURE_STICKER1;case"sticker8":return o.Collection.CAPTURE_STICKER8;case"sticker17":return o.Collection.CAPTURE_STICKER17;case"sticker20":return o.Collection.CAPTURE_STICKER20;case"sticker22":return o.Collection.CAPTURE_STICKER22;case"sticker29":return o.Collection.CAPTURE_STICKER29;case"sticker31":return o.Collection.CAPTURE_STICKER31;case"sticker32":return o.Collection.CAPTURE_STICKER32;default:return o.Collection.CAPTURE_STICKER33}}static stickerKeyForText(e){switch(e){case"omg":return"STICKER31";case"snap":return"STICKER33";case"awesome":return"STICKER8";case"BRB":return"STICKER1";case"hello":return"STICKER29";case"oops":return"STICKER22";case"yes":return"STICKER17";case"ouch":return"STICKER20";case"wow":return"STICKER32"}}static textForImageSticker(e){switch(e){case"STICKER31":return"omg";case"STICKER33":return"snap";case"STICKER8":return"awesome";case"STICKER1":return"BRB";case"STICKER29":return"hello";case"STICKER22":return"oops";case"STICKER17":return"yes";case"STICKER20":return"ouch";case"STICKER32":return"wow"}}static localizedAccessibilityTextForImageSticker(e){switch(e){case"STICKER31":return S.getString("Sticker.OMGAccessibilityLabel");case"STICKER33":return S.getString("Sticker.SnapAccessibilityLabel");case"STICKER8":return S.getString("Sticker.AwesomeAccessibilityLabel");case"STICKER1":return S.getString("Sticker.BRBAccessibilityLabel");case"STICKER29":return S.getString("Sticker.HelloAccessibilityLabel");case"STICKER22":return S.getString("Sticker.OopsAccessibilityLabel");case"STICKER17":return S.getString("Sticker.YesAccessibilityLabel");case"STICKER20":return S.getString("Sticker.OuchAccessibilityLabel");case"STICKER32":return S.getString("Sticker.WowAccessibilityLabel")}}static messageToReactionsEmoticonLocalizedAccesssibilityString(e){const t=e.getEmoticonCallReactionKey();return t?this.localizedAccessibilityTextForEmoticon(t):void 0}static localizedAccessibilityTextForEmoticon(e){const t=p.default.getEmoticonByNameNoSubscription(e);return(null==t?void 0:t.description)||e}static isAnimationReaction(e){return"cake"===e}static isSuperAnimationReaction(e){return a.includes(s.default.getS4LCMCFeatures().callAnimatedReactionsConfig.callAnimatedReactionsKeys,e)}static superAnimationReactionsNumber(e){let t=0;return a.each(e,(e=>{this.isSuperAnimationReaction(e)&&t++})),t}static isTranscriptionReaction(e){const t=f.default.parseJsonErrorToUndefined(e.content);return t&&a.every(T,(e=>e in t))}static isCallEventReaction(e){const t=u.decode(e),i=a.last(t.children);if(!i.getInternalType)return!1;const n=i.getInternalType()&&i.getInternalType()||_.ReactionsTextType.Default;return!!i.getUserMri()&&a.includes([_.ReactionsTextType.CallEventMuted,_.ReactionsTextType.CallEventKickedOut,_.ReactionsTextType.CallEventTransfer,_.ReactionsTextType.CallEventKickedOutOwn],n)}static animationInfoForKey(e,t){switch(e){case"beer":return b.default.BEER;case"cake":return t?b.default.CELEBRATION_ICBC:b.default.CELEBRATION_ICBC_PORTRAIT;case"clap":return b.default.CLAP;case"dropthemic":return b.default.DROPTHEMIC;case"facepalm":return b.default.FACEPALM;case"fire":return b.default.FIRE;case"heart":return b.default.HEART;case"highfive":return b.default.HIGHFIVE;case"laugh":return b.default.LAUGH;case"mistletoe":return b.default.MISTLETOE;case"penguin":return b.default.PENGUIN;case"rudolfsurprise":return b.default.RUDOLFSURPRISE;case"sad":return b.default.SAD;case"sarcastic":return b.default.SARCASTIC;case"snowflake":return b.default.SNOWFLAKE;case"surprised":return b.default.SURPRISED;case"xmascwl":return b.default.XMASCWL;case"xmasyes":return b.default.XMASYES;case"yes":return b.default.YES}}static announceReaction(e){const t=h.default.getDisplayableProfile(e.creator);let i,o,s=!0;if(e.isEmoticonCallReaction())i=v.messageToReactionsEmoticonLocalizedAccesssibilityString(e);else{const t=u.decode(e),n=a.last(t.children),r=a.first(t.children);if(o=n.getStyle?n.getStyle():void 0,o===_.ReactionsTextStyle.Sticker){if(r.getRawText?r.getRawText():void 0){const e=v.stickerKeyForText(r.getRawText());i=e&&v.localizedAccessibilityTextForImageSticker(e)}}else{if(r.children.length){const e=a.first(r.children);e.getRawText&&(i=e.getRawText())}else r.getRawText&&(i=r.getRawText());s=!1}}if(i){if(s){let e;e=o===_.ReactionsTextStyle.Snapshot?i:S.getString("AccessibilityLabel.Reactions1User",{firstUser:t.getShortName(),reactionName:i}),n.Accessibility.announceForAccessibility(e)}}else C.warn(g.LogTraceArea.CallReactions,"ReactionsEmojiStream._updateReactionsAndReturnState Unsupported reaction emoticon/sticker or empty text")}static callReactionInfoForReaction(e){const t=u.decode(e),i=a.last(t.children),n=c.getMessageTypeGroup(e),o=i.getStyle&&i.getStyle()||_.ReactionsTextStyle.Default;let s;if(!e.isEmoticonCallReaction()&&n===c.MessageTypeGroups.Text){const i=a.first(t.children);let n;if(n=l.renderText(t,{skipAuthor:!0}),i.children.length){const e=a.first(i.children);e.getRawText&&(n=e.getRawText())}else i.getRawText&&(n=i.getRawText());if(o===_.ReactionsTextStyle.Sticker&&n){const e=v.stickerKeyForText(n);e&&(s=v.imageForSticker(e))}else if(o===_.ReactionsTextStyle.Snapshot){const t=h.default.getDisplayableProfile(e.creator);s=S.getString("CallPanel.SnapshotNotification",{name:t.getShortName()})}else s=n}const r=y.default.isMyMri(e.creator);return{reaction:e,reactionsTextStyle:o,gradientColors:r?m.default.getGradientColors():d.default.getGradientColors(e.creator),isLocal:r,content:s}}static parseCallEventReaction(e){const t=u.decode(e),i=a.last(t.children);if((i.getStyle&&i.getStyle()||_.ReactionsTextStyle.Default)===_.ReactionsTextStyle.CallEvent){const t=i.getInternalType()&&i.getInternalType()||_.ReactionsTextType.Default,a=i.getUserMri();if(a)return{mri:e.creator,actionMri:a,eventType:t}}}}v.reactionItems=[{key:"heart",type:r.ReactionsItemType.Emoticon},{key:"STICKER32",type:r.ReactionsItemType.Sticker},{key:"cwl",type:r.ReactionsItemType.Emoticon},{key:"STICKER8",type:r.ReactionsItemType.Sticker},{key:"sad",type:r.ReactionsItemType.Emoticon}],t.default=v},72311:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(746096),n=i(438891),o=i(640363),s=i(478262),r={enableAndroidNativeIncomingCallNotifications:!1,enableAndroidNativeIncomingGroupCallNotifications:!1,enableAndroidNonDismissibleIncomingCallNotifications:!1,enableElectronIntegratedCalling:!1,enableStreamVideo:!1,enableAdaptiveCameraContentScale:!1,resumableUploads:{enabled:!0,types:["Video","VideoMessage"]},mobilePreviewPercentage:.2,enableMissedCallbackReminderAppActive:!1,enableIncomingVideoNotification:!1,enableNewIncomingVideoSound:!1,enableTestCalls:!1,maximumGroupSizeRing:25,maximumGroupSizeGoLive:250,maximumGroupSizeRinglessCall:50,maxRecordingMs:18e4,videoWidth:640,videoHeight:360,videoBitrate:1300,enableMsnpFlamingoMessages:!0,translatorAgentId:"28:0d5d6cff-595d-49d7-9cf8-973173f5233b",videoProfile:1,enableVideoBFrame:!1,videoReEncodeKeyFrameSec:1,optimizeVideoForNetwork:!1,captureStopDelayMs:1e4,cameraVersion:1,enableSimpleTextReactions:!1,enableHDVideo:!1,androidCallMonitorConfig:{permissionPromptMaxDisplayCount:3,permissionPromptResetIntervalSeconds:2419200},enableBatteryOptimizationNotification:!1,enableBatteryOptimizationNotificationV2:!0,enableBufferSharing:!1,callRecorderBotMri:"28:0ad9717e-76fd-4658-a764-beaf21698977",callRecorderBotMriFilter:["28:0ad9717e-76fd-4658-a764-beaf21698977","28:56fc6434-1e40-4e9e-ace2-373ce28cfba4"],callRecorderRetentionDurationDays:30,callReactionsBarButtonConfig:{mobile:[["Moments"],["Reactions"]],tablet:[["Chat","Moments"],["Gallery","Reactions"]]},enablePhotoSharingCoachMark:!1,enableCallTechnicalInformation:!1,callReactionButtonKey:"heart",callCelebrationConfig:{callCelebrateButtonKey:"cake"},callAnimatedReactionsConfig:{callAnimatedReactionsKeys:["beer","clap","dropthemic","facepalm","fire","heart","highfive","laugh","mistletoe","penguin","rudolfsurprise","sad","sarcastic","snowflake","surprised","xmascwl","xmasyes","yes","cake"],callAnimatedReactionsTimeoutsinMs:{beer:3e3,cake:3750,clap:2e3,default:3e3,fire:3600,heart:2e3,laugh:2e3,penguin:6300,rudolfsurprise:3e3,sad:2e3,sarcastic:2e3,snowflake:5e3,surprised:2e3,yes:2e3}},enableGifCaptureLoadingIndicator:!1,allowIncomingCallsWithExpiredToken:!1,enableAddToCallRibbonCoachMark:!1,enableNDISetting:o.default.isElectronOsx()||o.default.isElectronWindows(),learnMoreNDILink:"https://www.newtek.com/blog/tips/using-ndi-in-skype/",broadcastTermsOfServiceUrl:"https://www.skype.com/{lang}/legal/broadcast/",enableMessageTranslation:!1,enableOneMessageTranslation:!1,translatorBotDeprecationDate:"31/12/2019",enableTranslatorBotDeprecation:!1,messageTranslatorEndpointUrl:"https://translatorv2.skype.com/api/v1/text.translation",callCaptionsEnableTranslatedVoiceOption:!1,isCallCaptionsCleanupEnabled:!1,isCallCaptionsDataChannelEnabled:!1,callCaptionsCleanupBatchSize:1e3,callCaptionsCleanupValidDate:"",callCaptionsClearTimeout:7e3,callCaptionsMaxHistory:100,callCaptionsEnableSubtitleLanguageOption:!1,isInterimCaptionConcatenated:!1,isInterimCaptionHighlightEnabled:!1,callCaptionsStartImmediateTrigger:!1,callCaptionsMerge:!0,callCaptionsHideSpokenLangInSettings:!0,callCaptionsPositionModeDefault:n.CaptionsPositionMode.float,callCaptionsSettingsShowHistory:!1,callCaptionsScrolling:{allowStopScrolling:!0,allowScrollingAnimation:!1,stopScrollingThreshold:50,scrollingCallbackDebounce:100,jumpToAndButtonDisplayDelay:300},callCaptionsFloatPanel:{enabled:!0,desktopSizePercentage:.3,mobileSizePercentage:.35,letterSpacingWindows:0,limit:10,timeout:7e3},callCaptionsBottomPanel:{enabled:!0,desktopSizePercentage:.2,mobileSizePercentage:.4,captionsWidthDesktopPercentage:.6,limit:20,timeout:0},callCaptionsLeftPanel:{enabled:!0,desktopSizePercentage:.25,captionsWidthDesktopPercentage:.95,limit:50,timeout:0},callTranslatorBotConfig:{enabledTranslatorOneOnOneCall:!1,enabledTranslatorOneOnOnePstnCall:!1,enabledTranslatorGroupCall:!1,hideInRoster:!0,botMri:"28:5dad43e6-3db1-435f-b8ee-7b0a759c658f",botMriFilter:["28:9f6cbb6e-083f-4b96-bcfa-802488dcf40e","28:d96d5a9f-c9ae-41af-9187-e213d456041f","28:29a41b3a-90e7-4d23-9d24-afe4dee2e4e7","28:52b0c63e-a675-4e38-b8fb-b373d96ec315","28:f15ea256-e453-4b87-810e-6fabc0a6fdb3","28:f4c739a9-9d32-45a9-bb93-bfb955b30270","28:5dad43e6-3db1-435f-b8ee-7b0a759c658f"],service:{id:"skype.tx",version:1},languageSupport:{speech:["de-DE","en-GB","en-US","es-ES","fr-FR","it-IT","ja-JP","pt-BR","ru-RU","zh-CN","zh-TW"],tts:["de-DE","en-GB","en-US","es-ES","fr-FR","it-IT","ja-JP","pt-BR","ru-RU","zh-CN","zh-TW"]},translatorBotClientTimeoutMs:5e3},pstnTranslation:{enabled:!1,showToast:!0,privacyLink:"https://go.skype.com/privacy",useAlertDialogOnDesktop:!1,useUserIconInsteadOfFlags:!1,hideSettingsOnTranslationStart:!1,translationSettingsHideTimeout:5e3,captionsLimit:50,captionsTimeout:0},skypeTranslation:{enabled:!1,privacyLink:"https://go.skype.com/privacy",variantB:!1},translationFeatures:{showInSettings:!0,enableConsentListener:!0,consentButtonsSameColor:!1,truVoice:!1,automaticLangDetection:!1,automaticLangDetectionNumberOfResults:4,toastTimeout:8e3,truVoiceName:"Truvoice",autoDetectButtonThrottleTimeoutMs:1e3,truVoiceButtonThrottleTimeoutMs:1e3},translationDefaultVoice:n.Gender.female,isStartCaptionsInfoPanelEnabled:!1,callControlTimeoutMs:7e3,callControlShortTimeoutMs:5e3,isInCallFeatureConsentEnabled:!0,inCallFeatureConsentRosterDelayMs:500,syncAdapterMode:"on",photoEventTimeoutMs:5e3,callAudienceBotConfig:{enabledOneOnOneCall:!1,enabledGroupCall:!1,enabledBackgroundSelection:!1,botMri:"28:9cd07db6-fab5-438c-8e34-44117fac7650",botMriFilter:["28:4969df63-cfcb-45e3-b06e-1f2b54d8b9bb","28:9cd07db6-fab5-438c-8e34-44117fac7650","28:3d59cb08-f597-4e49-9add-a05f9735152b"],backgrounds:[],minParticipantsOnCall:2,maxNumberOfAttemptsForDataChannelHandler:4,retryDelayMsForDataChannelHandler:500},callGridViewBotConfig:{enabled:!1,botMri:"28:ab5d1521-415b-4380-82e4-af803fb8bf2d",botMriFilter:["28:9dc84a1d-cd1f-4e39-83b4-365e9482e2ad","28:8cf0f6d9-65dc-464b-a2cb-8f66a9767358","28:ab5d1521-415b-4380-82e4-af803fb8bf2d"],minParticipantsOnCall:2},enableUFDForDeviceHasEcho:!1,enableAttachVideoWithId:!1,enableJoinerCallPreview:!1,enableRinglessCall:!1,enableRinglessCallForSmallGroups:!1,enableEndGoLiveForLastParticipant:!1,enableBlockPSTNUserInContactInviteHeader:!1,enablnewPSTNLandingScreenWhileSearch:!1,enableTapToMoveCallParticipant:!1,enableSlimcorelogging:!1,retryPolicy:{maxPostElapsedTime:3e5,maxTransferTime:{postingService_getStatusServerTranscoding:6e4,postingService_postChatMessage:s.NumberShim.MAX_SAFE_INTEGER,postingService_postChatMessageForeground:s.NumberShim.MAX_SAFE_INTEGER},maxRetriesDefault:5,maxRetries:{postingService_urlPreviewFetching:3,postingService_updateChatMessageProperties:3,postingService_getStatusServerTranscoding:1e3,postingService_postChatMessage:s.NumberShim.MAX_SAFE_INTEGER,postingService_postChatMessageForeground:s.NumberShim.MAX_SAFE_INTEGER},constantPollTime:{postingService_getStatusServerTranscoding:500},countLocalNetworkFailures:!0},optimalVideoCountInitialThrottleSeconds:0,enablePreRS5HIDSupported:!0,enableAccessibleRecordButton:!1,disableCopyingOriginalVideoToCache:!1,videoReencodeConfig:{profile:2,highQualitySource:!1,outputWidth:1280,outputHeight:720,videoBitrate:2e6,audioBitrate:96e3,minSizeDecreaseRatio:.2},picturePrefetch:{status:"On",maxTimeIntervalPriorToStartupSec:86400,maxQueuedEntriesCount:20},picturePrefetchCacheExpiryTimeSec:259200,videoPrefetchCacheExpiryTimeSec:259200,enableLibraryVideoMarkup:!1,maxVideoDurationOnMobileMin:1,fileRetentionDurationDays:30,scheduleNextCallDurationSeconds:300,scheduleNextCallFrequency:20,scheduledCallNotSupportedFallbackUrl:"https://www.skype.com/get-skype",scheduledCallSearchBatchSize:100,enableScheduledCallAddToCalendar:!1,enableScheduledCallsSystemMessages:!1,scheduledCallInviteSendTimeout:3e3,maxScheduleNextCallDisplays:5,enableMeetNowEmoticonPicker:!1,enableMeetNowStickersOnSafari:!1,meetNowTitleSuggestionList:{enableSuggestionList:!1,isFlatList:!0},removeThreadIdFromUrlHistory:!1,waitJoinKnowledgeTimeoutMs:15e3,enablePreHeatCall:!1,enableObservingCall:!1,enableFullScreenOnWeb:!1,enableDoubleTapToFullScreen:!1,serverMessagesAfterThreadCreationTimeWindow:3e3,earpieceHiddenForVideoCalls:!1,enableMobileScreenSharing:!1,enableCameraPortraitLock:!1,enableMobileSubtitlesRightPanel:!1,enableScreenSharingToolbar:!1,enableDeclineAndMessageOnRingControls:!1,enableBlurBackgroundForAllCalls:!1,footprintServiceIntervalInMinutes:0,footprintServiceConfigUrls:[],enableScreenSharingControl:!1,enableEndCallWhenSystemSleeps:!1,useConverstionSyncForJoinCall:!1,officeLensMinIosVersion:"12.2.0",disableParticipantTalkingAnimation:!1,enableShouldShowCQFDelegation:!1,enableScreenRecordingPermission:!1,enableCallIntegration:!1,enableBackgroundReplacement:!1,enableBackgroundBlurOnWeb:!1,enableBackgroundBlurOnIOS:!1,enableBackgroundBlurOnAndroid:!1,backgroundEffects:[],bingBackgrounds:{enableImageDownload:!1,host:"https://www.bing.com",path:"/hp/api/v1/imagegallery?format=json&setmkt=[LOCALE]&today=1",syncIntervalMs:216e5,maxImageDownloadRetries:10,pickImageBasedOnUserIdHash:!1,showInSettings:!1,showInCallHeader:!1,showInCallFooter:!1,iconCountInHeader:1,captionAlwaysCollapsed:!0,useBingLogoInsteadOfSearchIcon:!1,showBackgroundCaptions:!0,tryOpenInAppBrowser:!0,sendBackgroundInfoUpdates:!0,throttleIntervalMs:500,clickLinkPartnerCode:"SBIOTD"},backgroundCategories:a.BackgroundCategories,enableBackgroundEffectsCategories:!1,numberOfVisibleLastUsedEffects:4,backgroundEffectsUri:"https://secure.skypeassets.com/content/dam/scom/",backgroundEffectsDefaultFolder:"skypebackgroundimage/",enableVideoBackgroundEffects:!1,hideSnapshotButton:!1,keepScreenShareWhenDisableVideo:!1,modernCallStage:{enabled:!1,maxStageElements:4,animationDuration:250,keepStreamAlive:!1,enableVideoPrioritization:!1,minVideoSize:{width:360,height:270},mobileMinVideoSize:{width:180,height:135},autoLetterBoxThresholdRatio:.3},enableNotifyUsersMuteKick:!1,enablePerfomanceTelemetry:!1,perfomanceTelemetryTimeoutInterval:5e3,enableAllCallButtonsVisible:!1,enableNewBackgroundEffectsLayout:!1,maxNumberOfVideosInUI:12,enableDialpadOnPSTNSubtitlesCalls:!1,disableVideosInRibbon:!1,enableCallPreviewPermissionOnLoad:!1,enableDeviceNumberTelemetry:!1,enableMsixPermissionTelemetry:!1,enableUFDQualityTelemetry:!1,enableShareInviteMessageVariant:!1,enablePresentationMode:!1,enableParticipantsButtonInCallControls:!1,enableParticipantsButtonPstnMobile:!1,enableAudioParticipantsOnTheStage:!1,enableAudioParticipantsOnTheStageByDefault:!1,enableAudioParticipantsOnTheStageAsNew:!1,enableNewCallScreen:!1,newCallScreenEnabledByDefault:!1,enableLightThemeOnCallStage:!1,enableCallingThemeSwitch:!1,enableTransparentVideoStream:!1,enableAudioParticipantsBackground:!1,enableAudioParticipantsBackgroundInTray:!1,audioParticipantsBackgroundFileNames:[],enableReactionsInCallStageMobile:!1,enableOutgoingVideoFirefox:!1,enableIncomingVideoFirefox:!1,enableScreenSharingFirefox:!1,cameraHelp:{showCameraIssuesText:!1,cameraIssuesLink:"https://go.skype.com/call.quality.guide"},enableUIToSelectSkypeOrPSTNContactToAddToGroupCall:!1,meetNowRequestsConfig:{retryCount:3,timeoutInMs:15e3},electronNavigationDebounce:1e3,enableSpeechConsentFlow:!1,speechConsentFlowConfig:{callsBetweenConsentSuggestion:5,maxSuggestionsShownCount:3},enableNoiseSuppression:!1,enableNewLayoutPicker:!1,enableLockMeeting:!1,enableAudienceDataChannel:!1,enableAsyncMedia:!1,PSTNCampaignTerminatedReasons:[],customCallReactions:{enabled:!1,maxNumberOfCustomReactions:6,defaultPack:["yes","cwl","surprised","clap","cry"],useNewAddEmojiIcon:!1},enableNewCustomCallReactions:!1,enableCallHandoff:!1,enableCallLowerHandByOthers:!1,enableMultipleStreamSupport:!1,autoLetterBoxThresholdRatioForNewStage:.5,enableLocalSpeakingIndicator:!1,callingStoreThrottleMs:void 0,enableEcoMode:!1,enableCallParticipantsPinning:!1,twinCamEnabled:!1,twinCamOneOnOneForceUpdateEnabled:!1,enableTopTrayHiding:!1,enableScreenShareZoom:!1,enablePictureInPictureCallMonitor:!1,enablePerfResponsivenessTracking:!1,responsivenessTrackingTimeout:6e4,responsivenessScenarioSampling:{},enableNSModeSwitching:!1,audioConfig:{enableMusicMode:!1,enableAEC:!1,enableSpatialAudio:!1,defaultMusicMode:!1,defaultAECMode:!1},enableMicSoundIndicator:!1,showSimpleReconnectingLostMessage:!0,enableNewLanguageSelectors:!1,enableNewCallPanel:{enableVisitor:!1,enablePortraitFlex:!1,enableLandscapeFlex:!1,enableExperimentalHeader:!1,enableExperimentalCallControls:!1},enableDialpadDeeplink:!1,clientCountry:"other",enableTouchBarControls:!1,enableIOSNativeCallsAddInfo:!1,disableUpdateEndpointMetadataOnESCConfigChange:!1,disableCallEndSoundPlayingWhenMultipleCalls:!1,enableRemovedSlimcoreStreamObjectsHandling:!0};t.default=r},326517:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(397691),n=i(889391),o=i(436237),s=i(746096),r=i(422538);t.default=new class{constructor(){this._audioBackgrounds=[],r.RegisterStartupable(this,"AudioParticipantBackgroundHelper")}startup(){const{enableAudioParticipantsBackground:e,audioParticipantsBackgroundFileNames:t,backgroundEffectsUri:i,backgroundEffectsDefaultFolder:o}=n.default.getS4LCMCFeaturesNoSubscription();return e&&(this._audioBackgrounds=t.map((e=>({uri:i+o+e,available:!0})))),a.Resolved()}getAvailableBackgroundUri(){if(0===this._audioBackgrounds.length)return void o.log(s.LogTraceArea.CallingUI,"There are no backgrounds to select from.");this._audioBackgrounds.some((e=>e.available))||this._audioBackgrounds.forEach((e=>e.available=!0));const e=this._audioBackgrounds.find((e=>e.available));return e?(o.log(s.LogTraceArea.CallingUI,"Available background found."),e.available=!1,e.uri):void 0}setBackgroundAvailable(e){const t=this._audioBackgrounds.find((t=>t.uri===e));t&&(t.available=!0)}}},960041:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(397691),n=i(583367),o=i(889391),s=i(746096),r=i(436237),l=i(422538),c=i(404057);class d{constructor(){l.RegisterStartupable(this,"BatteryOptimizationNotificationHelper")}startup(){return o.default.getS4LCMCFeaturesNoSubscription().enableBatteryOptimizationNotification&&(r.log(s.LogTraceArea.Calling,"Battery optimization notification enabled"),d._showBatteryOptimizationNotification()),a.Resolved()}static _showBatteryOptimizationNotification(){n.default.showBatteryOptimizationNotification().then((e=>{r.log(s.LogTraceArea.Calling,`Battery optimization notification displayed: ${e}`)}),(e=>{r.warn(s.LogTraceArea.Calling,"Battery optimization notification displaying failed: "+c.default.errorAsString(e))}))}}t.default=new d},654597:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateTelemetry=t.getCallConnectionType=t.getCallConnectionTypeAndUpdateTelemetry=void 0;const a=i(148540),n=i(502278),o=i(671830),s=i(400984),r=i(539549),l=i(746096),c=i(436237),d=i(178735),u=i(306819),h=i(914976),p=i(422538);function g(e,t){return c.log(l.LogTraceArea.Calling,"getCallConnectionType conversationMri: "+h.mriOrId(e)+" causeId: "+t),p.EnsureStarted([d.default,u.default]).then((()=>{if(d.default.getUserPreferencesLocalNoSubscription().forceRelay)return c.log(l.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to force causeId: "+t),a.ConnectionType.NoDirectConnection;const i=u.default.getCallConnectionType();return i===a.ConnectionType.NoDirectConnection?(c.log(l.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to NetworkOperatorStore causeId: "+t),i):e&&(o.isOneToOneThread(e)||o.isSkypeIdMri(e))?(0,r.default)().getConversationPotentiallyBeforeStartupAsync(e).then((e=>s.default.isConversationObjectAccepted(e)?a.ConnectionType.AllSupported:(c.log(l.LogTraceArea.Calling,"getCallConnectionType NoDirectConnection due to ContactsStore.isIncomingContactInvitePending causeId: "+t),a.ConnectionType.NoDirectConnection))):a.ConnectionType.AllSupported}))}function C(e,t,i){n.default.updateCallTelemetry(e,i,(e=>{e.setMccMncCode(u.default.getMccCode(),u.default.getMncCode()),e.callConnectionType(t)}))}t.getCallConnectionTypeAndUpdateTelemetry=function(e,t,i){return g(t,i).then((t=>(C(e,t,i),t)))},t.getCallConnectionType=g,t.updateTelemetry=C},12563:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.postCallEventNotification=void 0;const a=i(18078),n=i(952262),o=i(733754),s=i(746096),r=i(478262),l=i(480200),c=i(581400);t.postCallEventNotification=function(e,t,i,d,u,h){if(!d)return;let p="";const g=n.default.getDisplayableProfile(a.default.getSkypeMri()),C=n.default.getDisplayableProfile(t);switch(e){case r.ReactionsTextType.CallEventMuted:p=o.getString("CallPanel.MicrophoneServerMutedPersonalize",{initiator:g.getDisplayName(),person:C.getDisplayName()});break;case r.ReactionsTextType.CallEventKickedOut:p=o.getString("CallPanel.RemoveFromCallPersonalize",{initiator:g.getDisplayName(),person:C.getDisplayName()});break;case r.ReactionsTextType.CallEventTransfer:case r.ReactionsTextType.CallEventKickedOutOwn:p=o.getString("CallControls.RemovedFromCallByTwinCam")}const S={reactionInfo:{type:l.ReactionsItemType.CallEvent,key:p,internalType:e,userMri:t},causeId:h,timestamp:Date.now(),postSource:s.PostSource.CallMoments,callId:i,conversationMri:d,reactionsConversationMri:u,logTraceArea:s.LogTraceArea.CallingUI};c.CallReactionPostingHelpers.postReaction(S)}},613125:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PinUnpinCommand=void 0;const a=i(436237),n=i(889391),o=i(76514),s=i(109520);t.PinUnpinCommand=class{constructor(e,t){this._key=e,this._callId=t}canExecute(){return n.default.getS4LCMCFeatures().enableCallParticipantsPinning}execute(){const e=o.default.isParticipantPinned(this._key,this._callId);e?o.default.unpinParticipant(this._key,this._callId):o.default.pinParticipant(this._key,this._callId);const t=e?new s.UnpinCallParticipant(this._callId):new s.PinCallParticipant(this._callId);a.track(t)}}},718260:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.compileCallRateLabel=void 0;const a=i(889391),n=i(629951),o=i(488366),s=i(733754);t.compileCallRateLabel=function(e){let t;switch(e.callFundedBy){case o.CallRateFundingSource.Credit:e.price&&e.currency&&(t=s.getString("CallOptionsMenu.CallFundedBy_Credit",{price:n.getFormattedRate(e.price,e.currency,3)}));break;case o.CallRateFundingSource.CallingPlan:t=s.getString("CallOptionsMenu.CallFundedBy_CallingPlan");break;case o.CallRateFundingSource.FreeCall:t=s.getString("CallOptionsMenu.CallFundedBy_FreeCall");break;case o.CallRateFundingSource.TasterCall:t=s.getString("CallOptionsMenu.CallFundedBy_TasterCall",{numberOfMinutes:a.default.getS4LEntitlementFeatures().SCE.CallRates.TasterCallMaxDurationMinutes});break;case o.CallRateFundingSource.NoFunding:t=s.getString("CallOptionsMenu.CallFundedBy_NoFunding")}return t}},581400:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallReactionPostingHelpers=void 0;const a=i(994224),n=i(278968),o=i(698172),s=i(502278),r=i(480200),l=i(882261),c=i(497174),d=i(436237),u=i(785207),h=i(33004),p=i(914976),g=i(478262),C=i(794050);t.CallReactionPostingHelpers=class{static postReaction(e){e.reactionInfo.type===r.ReactionsItemType.Sticker?this._postStickerText(e):e.reactionInfo.type===r.ReactionsItemType.Emoticon?this._postEmoticon(e):e.reactionInfo.type===r.ReactionsItemType.Snapshot?this._postSnapshot(e):e.reactionInfo.type===r.ReactionsItemType.Animation?this._postAnimation(e):e.reactionInfo.type===r.ReactionsItemType.CallEvent&&this._postCallEvent(e)}static _postAnimation(e){const t=e.reactionInfo.key;this._postHelper(e,"animation",(()=>{const i=[new c.UnhandledEntity(t)];e.callId&&(i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.Animation)),s.default.updateCallTelemetry(e.callId,e.causeId,(e=>e.postAnimationReaction())),s.default.trackInCallReaction(t,"animation",!1,!1,!0));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a),s.default.trackInCallActivity(e.callId,e.reactionsConversationMri,a.messageForPosting.clientmessageid)}))}static _postEmoticon(e){this._postHelper(e,"emoticon",(()=>a.default.CallPostMessageService.postEmoticonReactionString(e.reactionInfo.key,e.conversationMri,e.reactionsConversationMri,e.callId,void 0,e.causeId)))}static _postStickerText(e){const t=h.default.textForImageSticker(e.reactionInfo.key);t&&t.length&&this._postHelper(e,"sticker",(()=>{const i=[new c.UnhandledEntity(t)];e.callId&&(i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.Sticker)),s.default.updateCallTelemetry(e.callId,e.causeId,(e=>e.postTextReaction())),s.default.trackInCallReaction(t,"sticker",!1,!1,!1));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a),s.default.trackInCallActivity(e.callId,e.reactionsConversationMri,a.messageForPosting.clientmessageid)}))}static _postSnapshot(e){const t=e.reactionInfo.key;if(!t.length)return;const i=[new c.UnhandledEntity(t)];e.callId&&i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.Snapshot));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a)}static _postCallEvent(e){const t=e.reactionInfo.key;if(!t.length)return;const i=[new c.UnhandledEntity(t)];e.callId&&i.push(new c.CallReactionMetadataEntity(e.callId,g.ReactionsTextStyle.CallEvent,e.reactionInfo.internalType,e.reactionInfo.userMri));const a=l.createMessageInfo(e.reactionsConversationMri,e.postSource,i,void 0,o.default.getReactionsThreadPostParams(e.conversationMri));u.default.postMessage(a)}static _postHelper(e,t,i){let a;d.log(e.logTraceArea,"_postHelper, type: "+t+" reactionsConversationId: "+p.mriOrId(e.reactionsConversationMri)+" callId: "+e.callId+" causeId: "+e.causeId),e.timestamp&&(a=new C.default(C.ScenarioName.RenderLocalCallReaction),a.start(void 0,e.timestamp),a.markStepCompleted("onReactionPressed"),n.default.setReactionPressedScenario(a)),n.default.setHasPostedReactions(e.reactionsConversationMri,!0),i(),a&&a.markStepCompleted("posted")}}},647176:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(148540),o=i(889391),s=i(12563),r=i(994224),l=i(568580),c=i(502278),d=i(471727),u=i(671830),h=i(539549),p=i(746096),g=i(436237),C=i(733754),S=i(18078),m=i(5409),y=i(914976),f=i(711828),b=i(478262),_=i(790970);class T{static getRosterForConversation(e,t=!0){const i=(0,h.default)().getConversation(e);if(!i)return g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: Failed to get conversation "+y.mriOrId(e)),[];const a=m.default.getSortedPeopleListInConversation(i,t);return a&&0===a.length&&g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: returns empty list conversationId="+y.mriOrId(e)),a}static getActiveParticipants(e,t){const i=T.getRosterForConversation(t),n=S.default.getSkypeMri();return a.filter(i,(t=>{if(t===n)return!0;{const i=r.default.CallingStore.findRemoteCallMember(e,t);return l.default.isParticipantConnected(i)}}))}static getInactiveGroupMembersFromRoster(e,t){return a.difference(e,t)}static getInactiveGroupMembers(e,t){return this.getInactiveGroupMembersFromRoster(T.getRosterForConversation(t,!1),r.default.CallingStore.getRemoteCallMemberMris(e))}static getConversationName(e){const t=(0,h.default)().getConversation(e);return t?t.topicName():(g.log(p.LogTraceArea.CallingUI,"CallRosterUtils.getRosterForConversation: Failed to get conversation "+y.mriOrId(e)),"")}static getParticipantRenderInfoConfig(e,t,i,a){const o=a?a.state:void 0,s=l.default.isParticipantConnected(a),c=a&&a.voiceLevel>0,d=o===n.ParticipantState.Ringing||o===n.ParticipantState.Connecting,u=!!a&&a.isServerMuted;return{key:e,participantState:o,isActive:s,isTalking:c,isRinging:d,isServerMuted:u,isServerMutedSupported:!!a&&r.default.CallingStore.getServerMuteUnmuteSupportedForParticipant(t,a),isLocalMuted:u,isLocalMuteSupported:i}}static getRenderInfoForParticipant(e,t){const i=e.key,a=e.participantState,n=e.isActive,o=e.isTalking,s=e.isRinging,r=e.isServerMuted,l=e.isServerMutedSupported,c=e.isLocalMuted,d=e.isLocalMuteSupported;return t&&e.participantState===t.participantState&&o===t.isTalking&&s===t.isRinging&&r===t.isServerMuted&&l===t.isServerMutedSupported&&d===t.isLocalMuteSupported&&c===t.isLocalMuted?t:{key:i,participantState:a,isActive:n,isTalking:o,isRinging:s,isServerMuted:r,isServerMutedSupported:l,isLocalMuted:c,isLocalMuteSupported:d}}static getRenderInfoForCurrentParticipant(e,t,i){const a=d.default.isLocalOrServerMuted(t);return{key:e,participantState:n.ParticipantState.Connected,isActive:!0,isTalking:!1,isRinging:!1,isLocal:!0,isLocalMuteSupported:i,isServerMuted:a,isServerMutedSupported:!0,isLocalMuted:a}}static getAllMembersWithActiveAndInactiveParticipants(e,t,i){const n={},o=[],s=[],l=S.default.getSkypeMri(),c=T.getRosterForConversation(e),d=r.default.CallingStore.getLocalMuteSupported(t),u=T.getRenderInfoForCurrentParticipant(l,t,d);c&&0===c.length&&g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getAllMembersWithActiveandInActiveParticipants: allMembers is empty list conversationId="+y.mriOrId(e));const h=a.map(r.default.CallingStore.getParticipantsWithRaisedHands(t),(e=>e.id)),C=a.uniq(a.concat(h,c)),m=a.includes(h,l);return a.each(C,(e=>{if(e!==l){const a=r.default.CallingStore.findRemoteCallMember(t,e),l=T.getParticipantRenderInfoConfig(e,t,u.isLocalMuteSupported,a),c=T.getRenderInfoForParticipant(l,i[e]);a&&c.isActive?o.push(c):s.push(c),n[e]=c}else e===l&&m&&(o.push(u),n[l]=u)})),u&&!m&&(o.push(u),n[l]=u),o&&0===o.length&&g.warn(p.LogTraceArea.CallingUI,"CallRosterUtils.getAllMembersWithActiveandInActiveParticipants: activeParticipants is empty list conversationId="+y.mriOrId(e)),{activeParticipants:o,inactiveParticipants:s,allMembers:c,allParticipants:n}}static getIconTitleForMuteOrUnMute(e,t,i,a,n){let o,s,r=!1;return t&&i?(o=f.SkypeIcon.MicrophoneOff,s=C.getString("CallControls.CallButtonUnmuteLabel")):t&&!i?(o=f.SkypeIcon.Microphone,s=C.getString("CallControls.CallButtonMute")):e&&a?a&&n?(o=f.SkypeIcon.MicrophoneOff,s=C.getString("CallPanel.MicrophoneUnMuteNotAllowed"),r=!0):(o=f.SkypeIcon.Microphone,s=C.getString("CallControls.CallButtonMute")):(o=f.SkypeIcon.Microphone,s=C.getString("CallPanel.MicrophoneMuteNotSupported"),r=!0),{icon:o,title:s,disableIcon:r}}}T.handleLocalMuteOrUnmute=(e,t)=>(c.default.updateCallTelemetry(e,t,(e=>e.muteCallRosterPress())),d.default.isLocalOrServerMuted(e)?(r.default.CallingStore.unmute(e,t),!1):(r.default.CallingStore.mute(e,t),_.default.updateCallRosterTelemetry(e,t,(e=>e.callRosterMutedUser())),!0)),T.handleRemoteMute=(e,t,i)=>{const a=r.default.CallingStore.findRemoteCallMember(t,e),l=u.getReactionsThreadMriForCallId(t),c=r.default.CallingStore.getCallConversationMri(t);a?(r.default.CallingStore.muteParticipants(t,n.MuteScope.Specified,[a],i).then((()=>{o.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick&&s.postCallEventNotification(b.ReactionsTextType.CallEventMuted,e,t,c,l,i)})),_.default.updateCallRosterTelemetry(t,i,(e=>e.callRosterMutedUser()))):g.error(p.LogTraceArea.CallingUI,`[CallRosterUtils] _handleRemoteMute\n                                                          participantToMute is null or empty, causeId: ${i}`)},T.handleRemoteHangup=(e,t,i)=>{const a=u.getReactionsThreadMriForCallId(t),n=r.default.CallingStore.getCallConversationMri(t);o.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick&&s.postCallEventNotification(b.ReactionsTextType.CallEventKickedOut,e,t,n,a,i),r.default.CallingStore.removeParticipant(t,e,i)},t.default=T},372667:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(697995),n=i(929925),o=i(148540),s=i(397691),r=i(994224),l=i(581400),c=i(136850),d=i(502278),u=i(480200),h=i(471727),p=i(175080),g=i(10102),C=i(898278),S=i(952262),m=i(746096),y=i(749679),f=i(436237),b=i(635400),_=i(733754),T=i(10909),v=i(18078),w=i(785207),I=i(914976),P=i(404057),M=i(478262),k=i(675865),A=i(172758);var R,x,L;!function(e){e[e.Small=1]="Small",e[e.Medium=2]="Medium",e[e.Large=3]="Large"}(R||(R={})),function(e){e[e.Landscape=1]="Landscape",e[e.Portrait=2]="Portrait"}(x||(x={})),function(e){e[e.Row=1]="Row",e[e.Column=2]="Column"}(L||(L={}));class V{constructor(e,t){this.causeId=e,this.mri=t}}class O extends V{constructor(e,t,i){super(e,t),this._size=i}captureFrame(e){return a.default.createImageContext(this._size.width,this._size.height).then((e=>{const t=S.default.getDisplayableProfile(this.mri),i=(0,g.gradientColorsForColors)(t.getColor().colors);let n=t.getAvatarUrl(M.AvatarSize.Large);n&&(n=k.default.getAuthenticatedUrl(n));const o={x:this._size.width/2,y:0},r={x:this._size.width/2,y:this._size.height},l={origin:{x:0,y:0},size:this._size},c=200;a.default.drawLinearGradient(e,o,i[0],r,i[1],l);const d=s.Defer();if(n)return a.default.createImageContextWithURL(n).then((n=>{if(a.default.isContextValid(n)){const t=a.default.getSize(n),i=t.width<=t.height?t.width:t.height,o=z((t.width-i)/2,(t.height-i)/2,i,i),s=z((this._size.width-c)/2,(this._size.height-c)/2,c,c),r=a.default.createPath(b.GCPathTypes.Arc);r?(r.appencArcToPath({x:this._size.width/2,y:this._size.height/2},100,0,2*Math.PI),a.default.clipPath(e,r)):f.error(m.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createPath return undefined"),a.default.drawGraphicsContext(e,n,o,s)}else{const a=t.getInitials();this.renderAvatarInitialsLook(e,a,i,c)}a.default.createImageData(e,0,0,this._size.width,this._size.height).then((t=>{t?d.resolve(t):(f.error(m.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageData return null"),d.resolve(void 0)),a.default.destroyContext(e),a.default.isContextValid(n)&&a.default.destroyContext(n)}))})).catch((()=>(f.error(m.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageContextWithURL return null"),s.Resolved(void 0)))),d.promise();{const n=t.getInitials();this.renderAvatarInitialsLook(e,n,i,c),a.default.createImageData(e,0,0,this._size.width,this._size.height).then((t=>{t?d.resolve(t):(f.error(m.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageData return null"),d.resolve(void 0)),a.default.destroyContext(e)}))}return d.promise()})).catch((()=>(f.error(m.LogTraceArea.CallingUI,"CallSnapshots.Audioparticipant captureFrame Graphics.createImageContext return null"),s.Resolved(void 0))))}renderAvatarInitialsLook(e,t,i,n){const o=p.colorStringToBodyMovinRgbArray(i[0]);a.default.setFillColor(e,255,255,255,1),a.default.fillArc(e,{x:this._size.width/2,y:this._size.height/2},n/2,0,2*Math.PI),a.default.setStrokeColor(e,Math.ceil(255*o[0]),Math.ceil(255*o[1]),Math.ceil(255*o[2]),1),a.default.setLineWidth(e,2),a.default.strokeArc(e,{x:this._size.width/2,y:this._size.height/2},n/2+1,0,2*Math.PI),a.default.setTextAlignment(e,a.HorizontalTextAlignment.Center,a.VerticalTextAlignment.Center),a.default.setFont(e,"sans-serif",n/4,!0),a.default.setFillColor(e,Math.ceil(255*o[0]),Math.ceil(255*o[1]),Math.ceil(255*o[2]),1),a.default.fillText(e,t,this._size.width/2,this._size.height/2)}}class B extends V{constructor(e,t,i){super(e,t),this._renderer=i}captureFrame(e){return s.fromThenable(this._renderer.captureFrame(e))}}class D{constructor(){this._offset={x:0,y:0},this._size={width:0,height:0},this._sizeScale=1}setSize(e){this._size=e}getSize(){return this._size}setOffset(e){this._offset=e}getOffset(){return this._offset}setSizeScale(e){this._sizeScale=e}concatSizeScale(e){this.setSizeScale(this.getSizeScale()*e)}getSizeScale(){return this._sizeScale}getRenderRectangle(){return z(this._offset.x*this._sizeScale,this._offset.y*this._sizeScale,this._size.width*this._sizeScale,this._size.height*this._sizeScale)}}class E extends D{static layoutDefinition(e,t,i,a,n){return f.log(m.LogTraceArea.CallingUI,"CallSnapshots.layoutDefinition (causeId:"+e+" ; landscape count:"+i.length+" ; portrait count: "+a.length+" )"),t.layout===L.Column?new N(e,t,i,a,n):new F(e,t,i,a,n)}static chooseRenderBox(e,t,i,a){f.log(m.LogTraceArea.CallingUI,"CallSnapshots.chooseRenderBox (causeId:"+e+" ; landscape count:"+i.length+" ; portrait count: "+a.length+" )");const n=t.orientation===x.Landscape?i:a;switch(t.sizeClass){case R.Large:return n.splice(n.length-1,1)[0];case R.Medium:return n.splice(Math.floor(n.length/2),1)[0];case R.Small:return n.splice(0,1)[0]}}constructor(e,t,i,a,n){super(),this._boxes=[],this.constructLayout(e,t,i,a,n)}constructLayout(e,t,i,a,n){if(t.definitions)for(const o of t.definitions)this._boxes.push(E.layoutDefinition(e,o,i,a,n));else if(t.elements)for(const n of t.elements)this._boxes.push(E.chooseRenderBox(e,n,i,a))}boxes(){return this._boxes}render(e){a.default.saveContext(e),a.default.setTranslate(e,this.getOffset().x,this.getOffset().y);for(const t of this._boxes)t.render(e);a.default.restoreContext(e)}setSizeScale(e){for(const t of this._boxes)t.concatSizeScale(e);this.doLayout()}doLayout(){for(const e of this._boxes)e.doLayout()}}class N extends E{doLayout(){super.doLayout();let e=0,t=-1;for(const i of this.boxes())i.getRenderRectangle().size.width>e&&(e=i.getRenderRectangle().size.width),(-1===t||i.getRenderRectangle().size.width<t)&&(t=i.getRenderRectangle().size.width);const i=(e-(e-t)/2)*this.getSizeScale();if(t!==e)for(const e of this.boxes()){const t=i/e.getRenderRectangle().size.width;e.concatSizeScale(t)}let a=0;for(const e of this.boxes())e.setOffset({x:0,y:a}),a+=e.getRenderRectangle().size.height;this.setSize({width:i,height:a})}}class F extends E{doLayout(){super.doLayout();let e=0,t=-1;for(const i of this.boxes())i.getRenderRectangle().size.height>e&&(e=i.getRenderRectangle().size.height),(-1===t||i.getRenderRectangle().size.height<t)&&(t=i.getRenderRectangle().size.height);const i=(e-(e-t)/2)*this.getSizeScale();if(t!==e)for(const e of this.boxes()){const t=i/e.getRenderRectangle().size.height;e.concatSizeScale(t)}let a=0;for(const e of this.boxes())e.setOffset({x:a,y:0}),a+=e.getRenderRectangle().size.width;this.setSize({width:a,height:i})}}class j extends D{constructor(e){super(),this._videoFrame=e,this._renderRect=this._computeRenderRect(),this.setSize({width:this._renderRect.size.width,height:this._renderRect.size.height})}isLandscape(){return this._videoFrame.getSize().width>=this._videoFrame.getSize().height}_computeRenderRect(){const e={origin:{x:0,y:0},size:{width:0,height:0}},t=this._videoFrame.getSize();if(this.isLandscape()){const i=4,a=3;e.size.width=t.width,e.size.height=a/i*e.size.width,e.size.height>t.height&&(e.size.height=t.height,e.size.width=i/a*e.size.height)}else{const i=3,a=4;e.size.height=t.height,e.size.width=i/a*e.size.height,e.size.width>t.width&&(e.size.width=t.width,e.size.height=a/i*e.size.width)}return e.origin.x=(t.width-e.size.width)/2,e.origin.y=(t.height-e.size.height)/2,e}renderRect(){return this._renderRect}doLayout(){}render(e){a.default.drawImage(e,this._videoFrame,this._renderRect.origin.x,this._renderRect.origin.y,this._renderRect.size.width,this._renderRect.size.height,this.getOffset().x,this.getOffset().y,this._renderRect.size.width*this.getSizeScale(),this._renderRect.size.height*this.getSizeScale())}}class U extends j{_computeRenderRect(){const e=this._videoFrame.getSize();return{origin:{x:0,y:0},size:{width:e.width,height:e.height}}}}class H{static takeSnapshot(e,t,i,a,n,l){f.log(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot causeId: "+e+" callId: "+t);const u=c.default.getStageMode(t),p=[],g=[];let C,S=0;let y=!1;const b=r.default.CallingStore.isConnectedAudienceBotInCall(t),_=r.default.CallingStore.isConnectedGridViewBotInCall(t),T=b&&h.CallUIUtils.isTogetherMode(u),w=_&&h.CallUIUtils.isLargeGrid(u);if(w){const i=r.default.CallingStore.getConnectedGridViewBotMriInCall(t);i&&(H.addVideoParticipantForMri(t,i,g,e),y=!0)}else if(T){const i=r.default.CallingStore.getConnectedAudienceBotMriInCall(t);i&&(H.addVideoParticipantForMri(t,i,g,e),y=!0)}else{for(C=0;C<n.length&&!y;C++){const i=r.default.CallingStore.getBestStreamForMri(t,n[C],o.StreamType.ScreenSharing);if(i){S++;const a=r.default.CallingStore.getRemoteStreamRenderer(t,n[C],i);if(void 0!==a){const t=new B(e,n[C],a);g.push(t),y=!0}}else f.log(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot failed to find remote stream causeId: "+e+" callId: "+t+" mri: "+I.mriOrId(n[C]))}if(!y)for(C=0;C<n.length;C++){const i=r.default.CallingStore.getStreamsForMri(t,n[C],o.StreamType.Video),a={width:600,height:450};if(i)i.forEach((i=>{const o=r.default.CallingStore.getRemoteStreamRenderer(t,n[C],i);if(o){const t=new B(e,n[C],o);g.push(t)}else{const t=new O(e,n[C],a);p.push(t)}}));else{f.log(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot failed to find remote video streamNaN causeId: "+e+" callId: "+t+" mri: "+I.mriOrId(n[C]));const i=new O(e,n[C],a);p.push(i)}}this.addLocalUserTwinCamStreams(e,t,g)}f.log(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot participation -  causeId: "+e+" callId: "+t+" total audio only "+p.length+" total video "+(g.length-S)+" total screen sharing "+S),d.default.updateCallTelemetry(t,e,(e=>e.setPhotoSnapshotMakeup(p.length,g.length-S,S))),H.postNotification(e,t,i,a),f.log(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot rendering participants -  causeId: "+e);const M=[];this.getLocalRenderer(t).then((i=>{if(!y&&!w&&!T)if(i&&i.captureFrame)try{M.push(s.fromThenable(i.captureFrame(this.sCaptureTimeoutMS)))}catch(t){f.log(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot localRenderer.captureFrame "+P.default.errorAsString(t)+" causeId: "+e)}else f.log(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot no local renderer frame capture -  causeId: "+e);for(C=0;C<g.length&&M.length<H.sMaxParticipants;C++){const t=g[C];try{M.push(t.captureFrame(this.sCaptureTimeoutMS))}catch(t){f.log(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot aParticipant.captureFrame "+P.default.errorAsString(t)+" causeId: "+e)}}s.all(M.map((e=>e.catch((e=>e))))).then((i=>{var a;const n=[];for(const t of i)(null===(a=null==t?void 0:t.getSize)||void 0===a?void 0:a.call(t))?n.push(t):t?f.log(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot error rendering a frame -  causeId: "+e+" error: "+t):f.log(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot null return rendering a frame -  causeId: "+e);if(n.length>0)this.renderAndPost(e,t,l,n,y);else{const i=[],a={width:600,height:450},n=new O(e,v.default.getSkypeMri(),a);i.push(n.captureFrame(this.sCaptureTimeoutMS));for(const e of p)i.length<H.sMaxParticipants&&i.push(e.captureFrame(this.sCaptureTimeoutMS));s.all(i.map((e=>e.catch((e=>e))))).then((i=>{const a=[];for(const t of i)t?a.push(t):a.length<H.sMaxParticipants&&f.log(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot error rendering a frame -  causeId: "+e+" error: "+t);a.length>0&&this.renderAndPost(e,t,l,a,y)}))}}))}))}static addLocalUserTwinCamStreams(e,t,i){r.default.CallingStore.getCallMediaStreamsOnOtherEndpoints(t).forEach((a=>{const n=v.default.getSkypeMri(),o=r.default.CallingStore.getRemoteStreamRenderer(t,n,a);if(o){const t=new B(e,n,o);i.push(t)}}))}static addVideoParticipantForMri(e,t,i,a){const n=r.default.CallingStore.getBestStreamForMri(e,t,o.StreamType.Video);if(n){const o=r.default.CallingStore.getRemoteStreamRenderer(e,t,n);if(o){const e=new B(a,t,o);i.push(e)}else f.error(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot large grid or together mode renderer is "+o)}else f.error(m.LogTraceArea.CallingUI,"CallSnapshots.takeSnapshot large grid or together mode stream is "+n)}static renderAndPost(e,t,i,a,n){const o=[],s=[];let r;for(r=0;r<a.length;r++){const i=a[r];if(i){const e=i.getSize();if(!e||e.width<=0||e.height<=0)return void f.error(m.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost frameSize is illegel"+e);f.log(m.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost frame: #"+r+" width: "+e.width+"height: "+e.height),e.width>=e.height?s.push(n?new U(i):new j(i)):o.push(n?new U(i):new j(i))}else f.log(m.LogTraceArea.CallingUI,"CallSnapshots.renderAndPost missing frame @ #"+r+" -  causeId: "+e+" callId: "+t)}const l=this.layoutComposition(e,s.length,o.length,0,0);l&&this.processMoment(e,t,i,l,s,o)}static postNotification(e,t,i,a){const n=A.default.getFullUserProfileByMri(v.default.getSkypeMri()),o={reactionInfo:{type:u.ReactionsItemType.Snapshot,key:_.getString("CallPanel.SnapshotNotification",{name:n.getDisplayName()})},causeId:e,postSource:m.PostSource.SnapshotNotification,callId:t,conversationMri:i,reactionsConversationMri:a,logTraceArea:m.LogTraceArea.CallingUI};l.CallReactionPostingHelpers.postReaction(o)}static processMoment(e,t,i,o,s,r){f.log(m.LogTraceArea.CallingUI,"CallSnapshots.processMoment (causeId:"+e+" ; landscape count:"+s.length+" ; portrait count: "+r.length+" )"),s=s.sort(((e,t)=>e.getSize().width>t.getSize().width?1:e.getSize().width<t.getSize().width?-1:0)),r=r.sort(((e,t)=>e.getSize().height>t.getSize().height?1:e.getSize().height<t.getSize().height?-1:0));const l=E.layoutDefinition(e,o,s,r,{origin:{x:0,y:0},size:{width:0,height:0}});if(l.doLayout(),l.getRenderRectangle().size.width>this.sMaxDim){const e=this.sMaxDim/l.getRenderRectangle().size.width;l.concatSizeScale(e)}if(l.getRenderRectangle().size.height>this.sMaxDim){const e=this.sMaxDim/l.getRenderRectangle().size.height;l.concatSizeScale(e)}let c=!1;a.default.createImageContext(l.getSize().width,l.getSize().height).then((e=>{l.render(e),n.default.drawLogo(e,l.getSize().height,l.getSize().width).then((()=>{a.default.createFileData(e,this.getSnapshotFileName()+".jpeg",(e=>{e?w.default.postUploadAndShowFeedbackToast(i,e,m.PostSource.CallMoments,!1,t):(c=!0,f.error(m.LogTraceArea.CallingUI,"CallSnapshots.processMoment Graphics.createFileData return null data"))})),a.default.destroyContext(e)}))})).catch((t=>{c=!0,f.error(m.LogTraceArea.CallingUI,"CallSnapshots.processMoment failed to create context with error"+P.default.errorAsString(t)+" ( causeId:"+e+" )")})).finally((()=>{c&&T.default.scheduleTextMessage(_.getString("CallPanel.SnapshotFailureMiniToast"),void 0,C.MainRootViewId)}))}static getSnapshotFileName(){const e=new Date(Date.now()),t="Skype-"+y.getISO8601Date(e)+"-"+y.getISO8601Time(e);return t===this.lastSnapshotFileName?(this.lastSnapshotFileName=t,t+"-"+ ++this.counterForSnapshotIn1S):(this.counterForSnapshotIn1S=0,this.lastSnapshotFileName=t,t)}static getLocalRenderer(e){return r.default.CallControlsStore.isProvidingVideo(e)?s.Resolved(r.default.CallingStore.getVideoPreviewRenderer(e)):s.Resolved(void 0)}static layoutComposition(e,t,i,a,n){return f.log(m.LogTraceArea.CallingUI,"CallSnapshots.layoutComposition (causeId:"+e+" ; landscape:"+t+" ; portraitCount: "+i+")"),1===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Large}]}:2===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Large},{position:2,orientation:x.Landscape,sizeClass:R.Large}]}:3===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Large},{position:1,orientation:x.Landscape,sizeClass:R.Large},{position:2,orientation:x.Landscape,sizeClass:R.Large}]}:0===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Large}]}:0===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Medium},{position:1,orientation:x.Portrait,sizeClass:R.Medium}]}:0===t&&3===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Medium},{position:1,orientation:x.Portrait,sizeClass:R.Medium},{position:2,orientation:x.Portrait,sizeClass:R.Medium}]}:1===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Large},{position:1,orientation:x.Landscape,sizeClass:R.Medium}]}:2===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:2,portrait:0,layout:L.Column,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Small},{position:1,orientation:x.Landscape,sizeClass:R.Small}]},{landscape:0,portrait:1,layout:L.Column,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Medium}]}]}:3===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:1,portrait:1,layout:L.Column,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Large},{position:1,orientation:x.Landscape,sizeClass:R.Medium}]},{landscape:2,portrait:0,layout:L.Column,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Medium},{position:1,orientation:x.Landscape,sizeClass:R.Medium}]}]}:2===t&&3===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:1,portrait:2,layout:L.Row,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Medium},{position:1,orientation:x.Portrait,sizeClass:R.Small},{position:2,orientation:x.Portrait,sizeClass:R.Small}]},{landscape:1,portrait:1,layout:L.Row,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Large},{position:1,orientation:x.Portrait,sizeClass:R.Small}]}]}:3===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:0,portrait:2,layout:L.Column,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Medium},{position:1,orientation:x.Portrait,sizeClass:R.Medium}]},{landscape:3,portrait:0,layout:L.Column,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Medium},{position:1,orientation:x.Landscape,sizeClass:R.Medium},{position:2,orientation:x.Landscape,sizeClass:R.Medium}]}]}:1===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:0,portrait:2,layout:L.Row,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Small},{position:1,orientation:x.Portrait,sizeClass:R.Small}]},{landscape:1,portrait:0,layout:L.Row,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Medium}]}]}:2===t&&2===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:1,portrait:1,layout:L.Column,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Small},{position:1,orientation:x.Portrait,sizeClass:R.Medium}]},{landscape:1,portrait:1,layout:L.Column,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Medium},{position:1,orientation:x.Landscape,sizeClass:R.Small}]}]}:1===t&&3===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:1,portrait:1,layout:L.Row,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Small},{position:1,orientation:x.Landscape,sizeClass:R.Medium}]},{landscape:0,portrait:2,layout:L.Row,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Medium},{position:1,orientation:x.Portrait,sizeClass:R.Medium}]}]}:0===t&&4===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:0,portrait:2,layout:L.Row,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Medium},{position:1,orientation:x.Portrait,sizeClass:R.Medium}]},{landscape:0,portrait:2,layout:L.Row,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Medium},{position:1,orientation:x.Portrait,sizeClass:R.Medium}]}]}:4===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:2,portrait:0,layout:L.Row,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Medium},{position:1,orientation:x.Landscape,sizeClass:R.Medium}]},{landscape:2,portrait:0,layout:L.Row,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Medium},{position:1,orientation:x.Landscape,sizeClass:R.Medium}]}]}:4===t&&1===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:1,portrait:1,layout:L.Column,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Large},{position:1,orientation:x.Landscape,sizeClass:R.Medium}]},{landscape:3,portrait:0,layout:L.Column,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Medium},{position:1,orientation:x.Landscape,sizeClass:R.Medium},{position:2,orientation:x.Landscape,sizeClass:R.Medium}]}]}:1===t&&4===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:0,portrait:3,layout:L.Row,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Medium},{position:1,orientation:x.Portrait,sizeClass:R.Medium},{position:2,orientation:x.Portrait,sizeClass:R.Medium}]},{landscape:1,portrait:1,layout:L.Row,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Large},{position:1,orientation:x.Portrait,sizeClass:R.Medium}]}]}:0===t&&5===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Row,definitions:[{landscape:0,portrait:3,layout:L.Column,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Small},{position:1,orientation:x.Portrait,sizeClass:R.Small},{position:2,orientation:x.Portrait,sizeClass:R.Small}]},{landscape:0,portrait:2,layout:L.Column,elements:[{position:0,orientation:x.Portrait,sizeClass:R.Medium},{position:1,orientation:x.Portrait,sizeClass:R.Small}]}]}:5===t&&0===i&&0===a&&0===n?{landscape:t,portrait:i,layout:L.Column,definitions:[{landscape:3,portrait:0,layout:L.Row,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Small},{position:1,orientation:x.Landscape,sizeClass:R.Small},{position:2,orientation:x.Landscape,sizeClass:R.Small}]},{landscape:2,portrait:0,layout:L.Row,elements:[{position:0,orientation:x.Landscape,sizeClass:R.Medium},{position:1,orientation:x.Landscape,sizeClass:R.Small}]}]}:void f.log(m.LogTraceArea.CallingUI,"CallStageView.layoutComposition: Failed to provide layout for "+t+", "+i)}}function z(e,t,i,a){return{origin:{x:Math.ceil(e),y:Math.ceil(t)},size:{width:Math.ceil(i),height:Math.ceil(a)}}}H.sMaxDim=1920,H.sCaptureTimeoutMS=7500,H.sMaxParticipants=5,H.lastSnapshotFileName="",H.counterForSnapshotIn1S=0,t.default=H},502278:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallTriggeredBy=void 0;const a=i(496486),n=i(77354),o=i(516778),s=i(148540),r=i(397691),l=i(889391),c=i(278819),d=i(568580),u=i(109520),h=i(260021),p=i(671830),g=i(562141),C=i(398907),S=i(536699),m=i(746096),y=i(438891),f=i(436237),b=i(998754),_=i(18078),T=i(121936),v=i(101163),w=i(276173),I=i(954416),P=i(415963),M=i(677914),k=i(583181),A=i(216568),R=i(422538),x=i(699948),L=i(404057),V=i(794050),O=i(790970),B=i(418037),D=i(853374),E=i(236533);var N;!function(e){e.None="None",e.ScheduleACall="ScheduleACall"}(N=t.CallTriggeredBy||(t.CallTriggeredBy={}));class F{constructor(){this._callTelemetryEvents={},this._callPerformanceTelemetryEvents={},this._callPerformanceTelemetryTokens={},this._incomingCallScenarios={},this._answerCallScenarioIds={},this._answerCallScenarios={},this._startRingingEvents={},this._micButtonClickEvents={},this._stopRingingEvents={},this._notificationFailureEvents={},this._callConnectedOnAnswerEvents={},this._timeToDisplayIncomingCallScreenEvents={},this._callAddPhotoTelemetryEvents={},this._callRecordingEvents={},this._callCaptioningEvents={},this._ndiEvents={},this._callTogetherModeEvents={},this._callLargeGridEvents={},this._videoButtonClickEvents={},this._videoToggleDurations=new Map,this._onCallingError=e=>{const t=l.default.getS4LCMCFeaturesNoSubscription().PSTNCampaignTerminatedReasons;this._waitForIds().then((()=>f.track(new u.CallActionError(e,A.default.CallingNodeId.get(),A.default.EdfRegistrationId.get(),t))))},this.updateCallAudioSettingsPopupEvent=e=>{this._callAudioSettingsPopupEvent?e(this._callAudioSettingsPopupEvent):f.warn(m.LogTraceArea.Calling,"[CallTelemetryHelper] updateCallAudioSettingsPopupEvent - attempted to update the AudioSettings popup but no popup event has been set")},this.updateCallVideoSettingsPopupEvent=e=>{this._callVideoSettingsPopupEvent?e(this._callVideoSettingsPopupEvent):f.warn(m.LogTraceArea.Calling,"[CallTelemetryHelper] updateCallVideoSettingsPopupEvent, attempted to update the VideoSettings popup but no popup event has been set")},this.setCallAudioSettingsPopupEvent=e=>{this._callAudioSettingsPopupEvent||(this._callAudioSettingsPopupEvent=e)},this.setCallVideoSettingsPopupEvent=e=>{this._callVideoSettingsPopupEvent||(this._callVideoSettingsPopupEvent=e)},this._updatePerformanceEvent=e=>{var t,i,a,n;const o=c.default.getPerformanceMetrics(),s=this._callPerformanceTelemetryEvents[e];s&&o&&(o.systemUsageInfo&&s.setMainUsage(o.systemUsageInfo),s.setGPUUsage(null===(t=o.gpu)||void 0===t?void 0:t.wss,null===(i=o.gpu)||void 0===i?void 0:i.cpu),s.setRendererUsage(null===(a=o.renderer)||void 0===a?void 0:a.wss,null===(n=o.renderer)||void 0===n?void 0:n.cpu))},this._sendCallAVSettingsPopupEvents=()=>{this._callAudioSettingsPopupEvent&&(f.track(this._callAudioSettingsPopupEvent),this._callAudioSettingsPopupEvent=void 0),this._callVideoSettingsPopupEvent&&(f.track(this._callVideoSettingsPopupEvent),this._callVideoSettingsPopupEvent=void 0)},this.onCallManagerError=e=>{this._waitForIds().then((()=>{f.track(new u.CallActionCallKitError(e.operation,e.domain,e.code,e.callId,A.default.CallingNodeId.get(),!!e.terminal))}))},this.onCallManagerSuccess=e=>{f.track(new u.CallActionCallKitSuccess(e.operation,e.result,e.attemptNumber))},d.default.onCallingError.subscribe(this._onCallingError)}_waitForIds(){return r.all([A.default.CallingNodeId.waitUntilSet(),A.default.EdfRegistrationId.waitUntilSet()]).then(a.noop)}onCallCreated(e){if(!this._callTelemetryEvents[e.callId]){if(f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] Starting to track Call event for callId: "+e.callId+" causeId: "+e.causeId),this._callTelemetryEvents[e.callId]=new u.Call({callId:e.callId,conversationId:e.conversationId,participantId:e.participantId,isCallCreator:e.isCallCreator,origin:e.origin,isScheduledCallActive:e.isScheduledCallActive,source:e.source,isLegacyMeetNow:e.isLegacyMeetNow,isEchoCall:e.isEchoCall,isTranslatedCall:e.isTranslatedCall,nodeId:A.default.CallingNodeId.get(),isGroupCall:e.isGroupConversation,isFirstCall:e.isFirstCall,timeBeforeFirstCallInSec:e.timeBeforeFirstCallInSec,isPreheated:e.isPreheated,noiseSuppressionMode:e.noiseSuppressionMode,isModerated:e.isModerated}),l.default.getS4LCMCFeatures().enablePerfomanceTelemetry){const t=c.default.getPerformanceMetrics();t&&t.systemUsageInfo&&c.default.isTracking()&&(this._callPerformanceTelemetryEvents[e.callId]=new v.CallPerformanceEvent(e.callId,t.systemUsageInfo.cpuSpeed,t.systemUsageInfo.cpuModel,t.systemUsageInfo.cores),this._callPerformanceTelemetryTokens[e.callId]=c.OnMetricsUpdated.subscribe((()=>this._updatePerformanceEvent(e.callId))),c.default.startTrackingPerformance())}f.track(new u.CallEntryPoint(e.callId,e.origin,e.conversationId,e.isGroupConversation,e.isVideoCall,e.isPstnCall,e.isIncomingCall,!1,e.causeId))}}onCallDisposed(e,t,i){var a;if(O.default.getActiveSession()&&(f.log(m.LogTraceArea.Calling,`[CallTelemetryHelper] onCallDisposed, causeId: ${i}`),O.default.completeSession(),this.updateCallTelemetry(e.callId,i,(e=>e.callRosterClosedCount()))),e.failureType!==s.FailureType.CallSetupFailed&&e.durationSeconds>0?(this._maybeCompleteCallRecordingEvent(e.callId,i),this._maybeCompleteCallCaptioningEvent(e.callId,i),this._maybeCompleteNdiEvent(e.callId),this.onStopTogetherMode(e.callId,i),this.onStopGridView(e.callId,i),this.updateCallTelemetry(e.callId,i,(a=>{var n;f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] onCallDisposed, sending Call event for callId: "+e.callId+" causeId: "+i),a.isConversationAccepted(t),a.setIsCallCreator(e.isCallCreator),a.setCallConversationMriNamespace(p.getMriNamespace(e.conversationMri)),a.setCallDurationSeconds(e.durationSeconds),a.setIsPSTNCall(!!e.isPSTNCall),a.setColorTheme(B.default.colorTheme()),a.setCallReconnectTelemetry(),a.setHadNativeIncomingCallNotificationsEnabled(l.default.getS4LCMCFeatures().enableAndroidNativeIncomingCallNotifications),this._micButtonClickEvents[e.callId]&&(a.failedToggleMic(),delete this._micButtonClickEvents[e.callId]);const o=null===(n=this._videoToggleDurations.get(e.callId))||void 0===n?void 0:n.sort();if(o&&o.length>0){const e=o[0];a.setToggleVideoBestDuration(e);const t=o[Math.floor(o.length/2)];a.setToggleVideoMedianDuration(t);const i=o[o.length-1];a.setToggleVideoWorstDuration(i)}this._videoButtonClickEvents[e.callId]&&(a.failedToggleVideo(),delete this._videoButtonClickEvents[e.callId]),f.track(a)})),C.default.trackMeetNowCallIfValid(e.conversationMri),S.default.trackMeetNowCallIfValid(e.conversationMri)):(C.default.finishScenario(),S.default.finishScenario()),l.default.getS4LCMCFeatures().enablePerfomanceTelemetry&&this._callPerformanceTelemetryTokens[e.callId]){null===(a=this._callPerformanceTelemetryTokens[e.callId])||void 0===a||a.unsubscribe();const t=this._callPerformanceTelemetryEvents[e.callId];t&&f.track(t),this._callPerformanceTelemetryTokens[e.callId]=void 0,this._callPerformanceTelemetryEvents[e.callId]=void 0}this._sendCallAVSettingsPopupEvents(),delete this._notificationFailureEvents[e.callId],delete this._startRingingEvents[e.callId],delete this._stopRingingEvents[e.callId],delete this._callTelemetryEvents[e.callId]}updateCallTelemetry(e,t,i){const a=this._callTelemetryEvents[e];a?i(a):f.warn(m.LogTraceArea.Calling,"[CallTelemetryHelper]","updateCallTelemetry","Attempted to access telemetry event for callId:",e,"causeId:",t)}maybeSendInviteFreeDeclinedEvent(e,t,i,a){p.isSkypeIdMri(t)&&!i&&f.track(new u.CallActionInviteFreeDecline(e))}trackInCallReaction(e,t,i,a,n){f.track(new u.InCallReaction(e,t,i,a,n))}trackInCallUFD(e,t,i){f.track(new u.InCallUFD(e,t,i))}trackOverflowMenuActions(e){const t=a.size(e),i=e[0]||"None",n=e[1]||"None";f.track(new u.OverflowMenuOpenedEvent(t,i,n))}trackInCallActivity(e,t,i){const a=h.getCorrelationIdFromMessageParts(_.default.getSkypeMri(),t,i);f.track(new u.InCallActivity(e,a))}trackCallViewMenuActions(e){f.track(new u.CallViewMenuActionEvent(e))}trackCallPreview(e,t,i,a,n){f.track(new u.CallPreviewEvent(e,t,i,a,n))}trackRingTheGroup(e){f.track(new u.RingTheGroupEvent(e))}trackRinglessCallInterstitial(e,t){f.track(new u.RinglessCallInterstitialEvent(e,t))}trackCalleePresence(e,t,i){a.each(t,(t=>i(t).then((t=>f.track(new u.CallActionCalleeUserPresence(e,t))))))}trackCallIntention(e,t,i,a){f.log(m.LogTraceArea.Calling,`[CallTelemetryHelper] trackCallIntention causeId: ${a}.`);const n=p.isGroupConversation(t),o=p.isPhoneMri(t),s=l.default.getS4LCMCFeaturesNoSubscription().clientCountry;f.track(new u.CallIntention(e,t,n,i,o,s,a))}trackMicButtonClick(e,t){this.updateCallTelemetry(e,t,(e=>e.micButtonPress()));this._micButtonClickEvents[e]&&(this.updateCallTelemetry(e,t,(e=>e.failedToggleMic())),delete this._micButtonClickEvents[e]),this._micButtonClickEvents[e]=Date.now()}trackMicStateChange(e,t){const i=this._micButtonClickEvents[e];if(!i)return void f.log(m.LogTraceArea.Calling,`[CallTelemetryHelper] trackMicStateChange - related micButtonClick event for callId ${e} not found.`);Date.now()-i>3*E.SECOND&&this.updateCallTelemetry(e,t,(e=>e.toggleMicTimedOut())),delete this._micButtonClickEvents[e]}trackStartRinging(e,t){if(this._startRingingEvents[e])return void f.log(m.LogTraceArea.Calling,`[CallTelemetryHelper] trackStartRinging - duplicate event for callId ${e} skipped.`);const i=new u.CallActionStartRinging(e,t);this._startRingingEvents[e]={startRingingTime:Date.now(),startRingingEvent:i},f.track(i)}trackStopRinging(e,t,i){if(this._stopRingingEvents[e])return void f.log(m.LogTraceArea.Calling,`[CallTelemetryHelper] trackStopRinging - duplicate event for callId ${e} skipped.`);const a=this._startRingingEvents[e];if(!a)return void f.log(m.LogTraceArea.Calling,`[CallTelemetryHelper] trackStopRinging - related startRinging event for callId ${e} not found.`);const n=Date.now()-a.startRingingTime,o=new u.CallActionStopRinging(e,t,n,i);f.log(m.LogTraceArea.Calling,`[CallTelemetryHelper] trackStopRinging callId: ${e} ringingDuration: ${n}ms`,`reason: ${u.CalleeStopRingingReason[t]}`,i?`(${i})`:""),this._stopRingingEvents[e]=o,f.track(o)}trackIncomingCallNotificationFailure(e,t,i){if(this._notificationFailureEvents[e])return void f.log(m.LogTraceArea.Calling,`[CallTelemetryHelper] trackIncomingCallNotificationFailure - duplicate event for callId ${e} skipped.`);const a=new u.IncomingCallNotificationFailure(e,t,i);this._notificationFailureEvents[e]=a,f.track(a)}trackAudioOutputRouteChange(e,t){const i=e!==t;f.track(new u.AudioOutputRouteChangedEvent(e,t,i))}trackSystemHotKey(e){f.track(new u.SystemHotKeyCallEvent(e))}onIncomingCallNotification(e,t){const i=D.default.newGuid();return this._waitForIds().then((()=>{if(e.eventType!==w.PNHEvents.IncomingNGCStopRinger)this._sendCallNotificationEvent(e,t),e.isDuplicate||e.eventType===w.PNHEvents.IncomingP2PCall||e.eventType===w.PNHEvents.IncomingGoLiveStart||this._beginTrackingIncomingCall(i,e,t);else{}})),i}onStopCallNotification(e,t){this._waitForIds().then((()=>this._sendCallNotificationEvent(e,t)))}trackIncomingVideoNotification(e,t,i){const o=e?u.IncomingVideoNotificationAction.Pressed:u.IncomingVideoNotificationAction.Displayed,s=a.isUndefined(i)?n.IncomingVideoNotificationOrigin[n.IncomingVideoNotificationOrigin.NotSpecified]:n.IncomingVideoNotificationOrigin[i];f.track(new u.IncomingVideoNotification(s,t,o))}trackTouchBarButtonClick(e,t){f.track(new u.TouchBarButtonClickEvent(e,t))}_sendCallNotificationEvent(e,t){f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] Sending call notification telemetry for callId: "+e.callId+" source: "+e.source+" causeId: "+t),r.all([this._waitForIds(),R.EnsureStarted(I.default)]).then((()=>{const t=F._hydrateInfo(e);f.track(new u.CallActionPushNotification(t,A.default.CallingNodeId.get(),A.default.EdfRegistrationId.get()))}))}static _hydrateInfo(e){return Object.assign(Object.assign({},e),{hasRegistered:I.default.hasRegisteredWithService(),isStarted:k.default.isUIDisplayed()})}_beginTrackingIncomingCall(e,t,i){r.all([this._waitForIds(),R.EnsureStarted(I.default)]).then((()=>{const a=F._hydrateInfo(t),n={ActivationState:o.Types.AppActivationState[o.App.getActivationState()],EventType:a.eventType,HasRegistered:a.hasRegistered,IsStarted:a.isStarted,Source:a.source,TimeWaitingToProcess:Math.max(0,a.pushProcessedTime-a.pushReceivedTime)};let s=this._incomingCallScenarios[e];if(!s){f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper]_beginTrackingIncomingCall, Starting incoming call scenario telemetry for scenarioId: "+e+" source: "+a.source+" causeId: "+i);const t={CallId:a.callId,NodeId:A.default.CallingNodeId.get()||"",RegistrationId:A.default.EdfRegistrationId.get()||""};a.participantId&&(t.ParticipantId=a.participantId),s=new V.default(P.ScenarioName.IncomingCall,e,t),this._incomingCallScenarios[e]=s;let o=a.pushReceivedTime||a.pushProcessedTime;if(o<=0){const e="[CallTelemetryHelper] Received invalid incoming call scenario start time";f.error(m.LogTraceArea.Calling,e),o=Date.now()}s.start(n,o)}this.markIncomingCallStep(e,u.IncomingCallStep.NotificationReceived,i,n,a.pushProcessedTime-a.pushReceivedTime)}))}markIncomingCallStep(e,t,i,a,n){this._waitForIds().then((()=>{var o;this._incomingCallScenarios[e]&&(f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] markIncomingCallStep, marking incoming call scenario step for scenarioId: "+e+" step: "+u.IncomingCallStep[t]+" causeId: "+i),null===(o=this._incomingCallScenarios[e])||void 0===o||o.markStepCompleted(u.IncomingCallStep[t],a,n))}))}endTrackingIncomingCall(e,t,i){this._waitForIds().then((()=>{if(!this._incomingCallScenarios[e])return void f.warn(m.LogTraceArea.Calling,"[CallTelemetryHelper] endTrackingIncomingCall, unable to end tracking unknown incoming call: "+e+" causeId: "+t);const a=this._incomingCallScenarios[e];f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] endTrackingIncomingCall, completing incoming call scenario telemetry for scenarioId: "+e+" reason: "+(i?u.IncomingCallEndReason[i.reason]:"success")+" causeId: "+t),i?null==a||a.fail(u.IncomingCallEndReason[i.reason],i.details):null==a||a.finish(),delete this._incomingCallScenarios[e]}))}checkCrashedCalls(){R.EnsureStarted(b.default).then((()=>{const e=b.default.getData(g.InternalKeys.ActiveCalls);e&&e.length&&(f.log(m.LogTraceArea.Calling,`[CallTelemetryHelper] checkCrashedCalls, reporting crashed calls: ${JSON.stringify(e)}`),this.updateActiveCalls(void 0),A.default.CallingNodeId.waitUntilSet().then((()=>{a.each(e,(e=>{f.track(new u.CallCrashEvent(e.callId,e.state,A.default.CallingNodeId.get(),e.participantId,e.endpointId))}))})))}))}updateActiveCalls(e){b.default.putData(g.InternalKeys.ActiveCalls,e)}_getCallAddPhotosEvent(e){return e?this._callAddPhotoTelemetryEvents[e]:void 0}initCallAddPhotosEvent(e,t,i,a=!1){if(this._getCallAddPhotosEvent(e))return;const n=p.isGroupConversation(t);this._callAddPhotoTelemetryEvents[e]=a?new u.CallAddPhotosWithFabEvent(e,n,i):new u.CallAddPhotosEvent(e,n,i)}markPhotosSentCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i?(i.setPhotosSent(t),i.setNumberOfPhotos(1)):f.warn(m.LogTraceArea.Calling,"[CallTelemetryHelper] markPhotosSentCallAddPhotosEvent, no callAddPhotos Event")}markPhotosSelectedCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i&&i.setMediaPickerPhotosSelected(t)}markFromMediaPickerAndNumberOfPhotosCallAddPhotosEvent(e,t,i){const a=this._getCallAddPhotosEvent(e);a&&(a.setPhotosSent(!0),a.setFromMediaPicker(t),a.setNumberOfPhotos(i))}markPhotoTakenCallAddPhotosEvent(e,t){const i=this._getCallAddPhotosEvent(e);i&&i.setPhotoTaken(t)}completeCallAddPhotosEvent(e){const t=this._getCallAddPhotosEvent(e);t&&(f.track(t),delete this._callAddPhotoTelemetryEvents[e])}onStartRecording(e,t){this._callRecordingEvents[e]?f.warn(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStartRecording, recording event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,(e=>{e.startRecordingCount()})),f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStartRecording, callId: "+e+" causeId: "+t),this._callRecordingEvents[e]={recordingStartTime:Date.now(),callRecordingEvent:new u.CallRecordingEvent(e)})}onStopRecording(e,t){this._maybeCompleteCallRecordingEvent(e,t),this.updateCallTelemetry(e,t,(e=>{e.stopRecordingCount()}))}onStartPstnTranslationClicked(e,t){this.updateCallTelemetry(e,t,(e=>{e.startPstnTranslationClickedCount()}))}onStartCaptions(e,t,i,a,n,o,s,r){this._callCaptioningEvents[e]?f.warn(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStartCaptions, captioning event already exists for callId: "+e+" causeId: "+r):(this.updateCallTelemetry(e,r,(e=>{e.startCaptioningCount(),s&&e.setInitialCaptionPositionMode(s)})),f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStartCaptions, callId: "+e+" causeId: "+r),this._callCaptioningEvents[e]={captioningStartTime:Date.now(),callCaptioningEvent:new u.CallCaptioningEvent(e,t,i,a,n,o)})}onStopCaptions(e,t){this._maybeCompleteCallCaptioningEvent(e,t),this.updateCallTelemetry(e,t,(e=>{e.stopCaptioningCount()}))}onStartCustomVoice(e,t,i,a){this.updateCallTelemetry(e,a,(e=>{e.startCustomVoiceCount(),e.translationConsentChangeDate(t),e.translationTruvoiceConsentChangeDate(i)}))}onStopCustomVoice(e,t){this.updateCallTelemetry(e,t,(e=>{e.stopCustomVoiceCount()}))}onStartTranslationAutoDetect(e,t){this.updateCallTelemetry(e,t,(e=>{e.startTranslationAutoDetectCount()}))}onStopTranslationAutoDetect(e,t){this.updateCallTelemetry(e,t,(e=>{e.stopTranslationAutoDetectCount()}))}onStartSkypeTranslation(e,t){this.updateCallTelemetry(e,t,(e=>{e.startSkypeTranslationClickedCount()}))}onStopSkypeTranslation(e,t){this.updateCallTelemetry(e,t,(e=>{e.stopSkypeTranslationClickedCount()}))}onSkypeTranslationStarted(e,t,i,a){this.updateCallTelemetry(e,a,(e=>{e.skypeTranslationStartedCount(),e.translationConsentChangeDate(t),e.translationTruvoiceConsentChangeDate(i)}))}onSkypeTranslationStopped(e,t){this.updateCallTelemetry(e,t,(e=>{e.skypeTranslationStoppedCount()}))}onRecieveCaptions(e,t){this.updateCallTelemetry(e,t,(e=>{e.didReceiveCaptions()}));const i=this._callCaptioningEvents[e];if(i&&!i.firstCaptionReceivedTime){const a=i.captioningStartTime,n=Date.now()-a;i.firstCaptionReceivedTime=n,this.updateCallTelemetry(e,t,(e=>{e.setFirstCaptionReceivedLengthSeconds(n)}))}}onCaptionPositionModeChanged(e,t,i){var a,n;this.updateCallTelemetry(e,i,(e=>{e.didChangeCaptionsPositionMode(t)})),null===(n=null===(a=this._callCaptioningEvents[e])||void 0===a?void 0:a.callCaptioningEvent)||void 0===n||n.setPositionMode(t)}onCaptionsStartingMessageClick(e,t){var i,a;this.updateCallTelemetry(e,t,(e=>{e.didClickCaptionsStartingMessage()})),null===(a=null===(i=this._callCaptioningEvents[e])||void 0===i?void 0:i.callCaptioningEvent)||void 0===a||a.startMessageClicked()}onFailedCaptionsConfig(e,t){this.updateCallTelemetry(e,t,(e=>{e.failedCaptioningConfigCount()}))}onPstnTranslationLanguageChange(e,t,i,a,n,o){const s=new u.CallPstnTranslationLanguageChangeEvent(e,null!=t?t:"",a,n,i);f.track(s)}onPstnTranslationSettingsOpened(e,t){const i=new u.CallPstnTranslationSettingsOpened(e,null!=t?t:"");f.track(i)}onSetReceiverSetup(e,t){this.updateCallTelemetry(e,t,(e=>{e.receiverSetupCount()}))}onStartTogetherMode(e,t){this._callTogetherModeEvents[e]?f.warn(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStartTogetherMode recording event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,(e=>{e.startTogetherMode()})),f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStartTogetherMode callId: "+e+" causeId: "+t),this._callTogetherModeEvents[e]={botAddedStartTime:Date.now(),callFullScreenBotEvent:new u.CallFullScreenBotEvent(e,y.BotType[y.BotType.Audience])})}onStopTogetherMode(e,t){const i=this._callTogetherModeEvents[e];if(!i)return;f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStopTogetherMode, callId: "+e+" causeId: "+t);const a=i.callFullScreenBotEvent;if(!a)return;a.setBotOnCallLengthSeconds((Date.now()-i.botAddedStartTime)/1e3);const n=a.getBotOnCallUselessTime();0!==n&&a.addBotOnCallUselessLengthSeconds((Date.now()-n)/1e3),f.track(i.callFullScreenBotEvent),delete this._callTogetherModeEvents[e]}onTogetherModeFailed(e,t,i){f.track(new u.CallFullScreenBotError(a.isNumber(t)?t:0,t.callId,y.BotType[y.BotType.Audience]))}onGridViewFailed(e,t,i){this._waitForIds().then((()=>{f.track(new u.CallFullScreenBotError(a.isNumber(t)?t:0,t.callId,y.BotType[y.BotType.GridView]))}))}onStartGridView(e,t){this._callLargeGridEvents[e]?f.warn(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStartGridView, large grid event already exists for callId: "+e+" causeId: "+t):(this.updateCallTelemetry(e,t,(e=>{e.startLargeGrid()})),f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStartGridView, callId: "+e+" causeId: "+t),this._callLargeGridEvents[e]={botAddedStartTime:Date.now(),callFullScreenBotEvent:new u.CallFullScreenBotEvent(e,y.BotType[y.BotType.GridView])})}onStopGridView(e,t){const i=this._callLargeGridEvents[e];if(!i)return;f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStopGridView, callId: "+e+" causeId: "+t);const a=i.callFullScreenBotEvent;a.setBotOnCallLengthSeconds((Date.now()-i.botAddedStartTime)/1e3);const n=a.getBotOnCallUselessTime();0!==n&&a.addBotOnCallUselessLengthSeconds((Date.now()-n)/1e3),f.track(i.callFullScreenBotEvent),delete this._callLargeGridEvents[e]}onAddingBotToCall(e,t){f.track(new u.AddBotToCallEvent(e,y.BotType[t]))}onBotAddedToCall(e,t,i){f.track(new u.AddBotToCallSucceededEvent(e,y.BotType[t],i))}onBotFailed(e,t,i,n){f.track(new u.AddBotToCallFailedEvent(e,y.BotType[t],i,a.isNumber(n)?n:0))}_maybeCompleteCallRecordingEvent(e,t){const i=this._callRecordingEvents[e];if(!i)return;f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] _maybeCompleteCallRecordingEvent, callId: "+e+" causeId: "+t);i.callRecordingEvent.recordingLengthSeconds((Date.now()-i.recordingStartTime)/1e3),f.track(i.callRecordingEvent),delete this._callRecordingEvents[e]}_maybeCompleteCallCaptioningEvent(e,t){const i=this._callCaptioningEvents[e];if(!i)return;f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] _maybeCompleteCallCaptioningEvent, callId: "+e+" causeId: "+t);const a=i.callCaptioningEvent;a.setCaptioningLengthSeconds((Date.now()-i.captioningStartTime)/1e3);const n=i.firstCaptionReceivedTime;n&&a.setFirstCaptionReceivedLengthSeconds(n/1e3),f.track(i.callCaptioningEvent),delete this._callCaptioningEvents[e]}screenShareControlReceivedControlRequest(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlReceivedControlRequest()))}togetherModeSceneChangeRequestCount(e,t){this.updateCallTelemetry(e,t,(e=>e.togetherModeSceneChangeRequestCount()))}screenShareControlReceivedControlRequestCanceled(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlReceivedControlRequestCanceled()))}screenShareControlSentControlRequest(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlSentControlRequest()))}screenShareControlRequestAccepted(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlRequestAccepted()))}screenShareControlRequestDenied(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlRequestDenied()))}screenShareControlGranted(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlGranted()))}screenShareControlSharerTerminatedControl(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlSharerTerminatedControl()))}screenShareControlViewerTerminatedControl(e,t){this.updateCallTelemetry(e,t,(e=>e.screenShareControlViewerTerminatedControl()))}onStopScreenSharing(e,t){f.track(new u.ScreenSharingStoppedEvent(e,t))}pinToolbar(e,t){this.updateCallTelemetry(e,t,(e=>e.pinToolbar()))}unPinToolbar(e,t){this.updateCallTelemetry(e,t,(e=>e.unPinToolbar()))}setGiveControlAsPossible(e,t){this.updateCallTelemetry(e,t,(e=>e.setGiveControlAsPossible()))}onStartNdi(e,t){this._ndiEvents[e]?f.warn(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStartNdi, ndi event already exists for callId: "+e):(this.updateCallTelemetry(e,"ndi-started",(e=>{e.startNdiCount()})),f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] onStartNdi, callId: "+e),this._ndiEvents[e]={broadcastingStartTime:Date.now(),broadcastingEvent:new u.NdiBroadcastEvent(e,t)})}onStopNdi(e){this._maybeCompleteNdiEvent(e),this.updateCallTelemetry(e,"ndi-stopped",(e=>{e.stopNdiCount()}))}onBlockedVideoBannerShown(e){this.updateCallTelemetry(e,"BlockedVideoBannerShown",(e=>{e.blockedVideoBannerShown()}))}onZoomIn(e){this.updateCallTelemetry(e,"ZoomedInCount",(e=>{e.zoomedIn()}))}onZoomOut(e,t,i){this.updateCallTelemetry(e,"ZoomedOutCount",(e=>{e.zoomedOut(t,i)}))}onZoomDragUsed(e){this.updateCallTelemetry(e,"ZoomDragUsed",(e=>{e.zoomDragUsed()}))}onZoomChangeType(e,t){this.updateCallTelemetry(e,"ZoomChangeType",(e=>{e.zoomChangeType(t)}))}onAudioSystemReset(e,t){this.updateCallTelemetry(e,t,(e=>{e.audioSystemResetCount()}))}onCallManagerUsed(e,t){this.updateCallTelemetry(e,t,(e=>{e.callManagerUsed()}))}setIsIgnoringBatteryOptimizations(e,t,i){this.updateCallTelemetry(e,t,(e=>{e.setIsIgnoringBatteryOptimizations(i)}))}_maybeCompleteNdiEvent(e){if(!this._ndiEvents[e])return;f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] _maybeCompleteNdiEvent, callId: "+e);const t=this._ndiEvents[e];if(!t)return;const i=t.broadcastingEvent;i.setBroadcastingLengthSeconds((Date.now()-t.broadcastingStartTime)/1e3),i.setWatermarkLocation(T.default.getWatermarkLocation()),f.track(i),delete this._ndiEvents[e]}updateNdiTelemetry(e,t){const i=this._ndiEvents[e];i&&t(i.broadcastingEvent)}updateCallRecordingTelemetry(e,t,i){const a=this._callRecordingEvents[e];a&&i(a.callRecordingEvent)}updateCallCaptioningTelemetry(e,t,i){const a=this._callCaptioningEvents[e];a&&i(a.callCaptioningEvent)}updateCallTogetherModeTelemetry(e,t){const i=this._callTogetherModeEvents[e];i&&t(i.callFullScreenBotEvent)}updateCallGridViewTelemetry(e,t){const i=this._callLargeGridEvents[e];i&&t(i.callFullScreenBotEvent)}updateTogetherModeAvailability(e,t){this.updateCallTelemetry(e,t,(e=>{e.ableToStartTogetherMode()}))}updateLargeGridAvailability(e,t){this.updateCallTelemetry(e,t,(e=>{e.ableToStartLargeGrid()}))}setHadNewCallStageEnabled(e,t){this.updateCallTelemetry(e,t,(e=>{e.setHadNewCallStageEnabled()}))}setHadOldCallStageEnabled(e,t){this.updateCallTelemetry(e,t,(e=>{e.setHadOldCallStageEnabled()}))}addCallingStoreUpdatePerformance(e,t,i){this.updateCallTelemetry(e,t,(e=>{e.addCallingStoreUpdatePerformance(i)}))}onShowShareTwinCamConnection(e){this.updateCallTelemetry(e,"ShowShareTwinCamConnectionCount",(e=>{e.showShareTwinCamConnection()}))}onUseTwinCamConnection(e){this.updateCallTelemetry(e,"TwinCamConnectionUsedCount",(e=>{e.useTwinCamConnection()}))}onFailedTwinCamConnection(e){this.updateCallTelemetry(e,"TwinCamConnectionFailedCount",(e=>{e.failedTwinCamConnection()}))}onStopTwinCam(e,t){this.updateCallTelemetry(e,"StopTwinCamCount",(e=>{e.stopTwinCam(t)}))}onAbleToStartTwinCam(e,t){this.updateCallTelemetry(e,"AbleToStartTwinCam",(e=>{e.setAbleToStartTwinCam(t)}))}onCallNetworkErrorReason(e,t){this.updateCallTelemetry(e,"CallNetworkErrorReason",(e=>{e.setCallNetworkErrorReason(t)}))}rejoinCallTelemetry(e,t,i,a){f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] rejoinCallTelemetry callId: "+e+" causeId: "+t);const n=p.isGroupConversation(a),o=p.isPhoneMri(a);f.track(new u.CallEntryPoint(e,i,a,n,!1,o,!0,!0,t))}beginTrackingAnswerCall(e,t,i){return this._waitForIds().then((()=>{let a=this._answerCallScenarioIds[e];if(!a){a=D.default.newGuid(),f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] beginTrackingAnswerCall, starting answer call scenario telemetry for scenarioId: "+a+" causeId: "+i);const n={CallId:e,NodeId:A.default.CallingNodeId.get()||"",RegistrationId:A.default.EdfRegistrationId.get()||""};if(t){n.IsGroupCall=!p.isOneOnOneConversation(t);let e=N.None;const i=M.default.getScheduledCallByConversationId(t);i&&M.default.isScheduledCallNow(i.id)&&(e=N.ScheduleACall),n.TriggeredBy=e}const o=new V.default(P.ScenarioName.AnswerCall,a,n);this._answerCallScenarios[a]=o,this._answerCallScenarioIds[e]=a,o.setDuplicateStepMarkingEnabled(!0),o.start()}return a}))}markAnswerCallStep(e,t,i,a,n,o){this._waitForIds().then((()=>r.Resolved(this._answerCallScenarioIds[e]))).then((o=>o||(t===u.AnswerCallStep.NotifyingCallee?(x.default.notifyingCallee(n),this.beginTrackingAnswerCall(e,i,a)):r.Rejected("markAnswerCallStep, unable to mark step for unknown answer call: "+e+" causeId: "+a)))).then((e=>{var i;f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] markAnswerCallStep, marking answer call scenario step for scenarioId: "+e+" step: "+u.AnswerCallStep[t]+" causeId: "+a),null===(i=this._answerCallScenarios[e])||void 0===i||i.markStepCompleted(u.AnswerCallStep[t],n,o)})).catch((e=>f.warn(m.LogTraceArea.Calling,`[CallTelemetryHelper] markAnswerCallStep catch: ${L.default.errorAsString(e,!0)}`)))}endTrackingAnswerCall(e,t,i){this._waitForIds().then((()=>{const a=this._answerCallScenarioIds[e];if(!a)return void f.warn(m.LogTraceArea.Calling,"[CallTelemetryHelper] endTrackingAnswerCall, unable to end tracking unknown answer call: "+a+" causeId: "+t);const n=this._answerCallScenarios[a];f.log(m.LogTraceArea.Calling,"[CallTelemetryHelper] endTrackingAnswerCall, completing answer call scenario telemetry for scenarioId: "+a+" reason: "+(i?u.AnswerCallEndReason[i.reason]:"success")+" causeId: "+t),i?null==n||n.fail(u.AnswerCallEndReason[i.reason],i.details):null==n||n.finish(),delete this._answerCallScenarios[a],delete this._answerCallScenarioIds[e]}))}onCalleeAnsweredCall(e,t){this._callConnectedOnAnswerEvents[e]||(this._callConnectedOnAnswerEvents[e]=new u.CallConnectedOnAnswerEvent(e,t,(t=>{f.track(t),delete this._callConnectedOnAnswerEvents[e]})))}onCallStateConnected(e){const t=this._callConnectedOnAnswerEvents[e];t&&t.markConnectedState()}trackVideoButtonClick(e,t){this._videoButtonClickEvents[e]&&(this.updateCallTelemetry(e,t,(e=>e.failedToggleVideo())),delete this._videoButtonClickEvents[e]),this._videoButtonClickEvents[e]=Date.now()}trackVideoStateChange(e,t){const i=this._videoButtonClickEvents[e];if(!i)return void f.log(m.LogTraceArea.Calling,`[CallTelemetryHelper] trackVideoStateChange - related videoButtonClick event for callId ${e} not found.`);const a=Date.now()-i;var n=this._videoToggleDurations.get(e);n?n.push(a):n=[a],this._videoToggleDurations.set(e,n),delete this._videoButtonClickEvents[e]}onReceivedNativeNotificationForIncomingRing(e,t){this._timeToDisplayIncomingCallScreenEvents[e]||(this._timeToDisplayIncomingCallScreenEvents[e]=new u.IncomingCallScreenDisplayedEvent(e,t,(t=>{delete this._timeToDisplayIncomingCallScreenEvents[e],f.track(t)})))}onCallPanelRendered(e){const t=this._timeToDisplayIncomingCallScreenEvents[e];t&&t.markIncomingCallScreenDisplayed()}test_getAnswerCallScenarios(){return this._answerCallScenarios}test_resetAnswerCallScenarios(){this._answerCallScenarios={},this._answerCallScenarioIds={}}}t.default=new F},129273:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addTruVoiceEnabledMessage=t.addTruVoiceStoppedMessage=t.addTruVoiceCancelledMessage=t.addTruVoiceRejectedMessage=t.addTruVoiceConsentQuestionMessage=t.addTruVoiceConsentSentMessage=t.addTruVoiceConsentMessage=t.addTruVoiceAvailableMessage=t.addTranslationEnabledMessage=t.addTranslationNotSuppportedMessage=t.addTranslationStoppedMessage=t.addTranslationCancelledMessage=t.addTranslationRejectedMessage=t.addTranslationConsentQuestionMessage=t.addTranslationConsentSentMessage=t.addTranslationConsentMessage=t.addUnableDetectLanguageMessage=t.removeUnableDetectLanguageMessage=t.addLanguageChangeDetectedMessage=t.removeLanguageChangeDetectedMessage=t.addSameLanguageMessage=t.addErrorMessage=t.addStartMessage=t.removeId=t.removeAll=void 0;const a=i(953143),n=i(711828),o=i(733754),s=i(458666),r=i(581760),l=i(436237),c=i(915678),d=i(18078),u=i(952262),h=i(994224),p=i(912770),g=i(889391),C=i(886045);function S(e){a.default.removeToast(e)}function m(e,t){const i=a.default.getToastsOfType(e).filter((e=>e.state.participantId===t)),n=i.pop();return i.forEach((e=>S(e.id))),n}function y(e,t){var i;const n=null===(i=a.default.toastForCallId(e,t,a.ToastCategory.Captions))||void 0===i?void 0:i.id,o=a.default.addCaptionsGenericToast(e,t);return n!==o&&void 0!==o&&C.default.maybeAnnounceForAccessibility(t.text),o}function f(e,t){var i;const n=null===(i=a.default.toastForCallId(e,t,a.ToastCategory.Captions))||void 0===i?void 0:i.id,o=a.default.addCaptionsGeneriConsentToast(e,t);return n!==o&&void 0!==o&&C.default.maybeAnnounceForAccessibility(t.title),o}function b(e,t){const i=a.ToastType.CaptionsParticipantLanguageChange;a.default.getToastsOfType(i).filter((e=>e.state.participantId===t)).forEach((e=>S(e.id)))}function _(e,t){const i=a.ToastType.CaptionsLanguageDetectionError;a.default.getToastsOfType(i).filter((e=>e.state.participantId===t)).forEach((e=>S(e.id)))}t.removeAll=function(e){a.default.removeAllFromCategory(e,a.ToastCategory.Captions)},t.removeId=S,t.addStartMessage=function(e,t){return y(a.ToastType.CaptionsStart,{callId:e,text:t})},t.addErrorMessage=function(e){const t=a.ToastType.CaptionsError;return l.track(new c.CaptionsNotificationDisplayedEvent(e,t.toString(),void 0)),y(t,{callId:e,text:o.getString("CallTranscriptionNotifications.Error"),icon:n.SkypeIcon.CallWarning,iconColorOverride:r.Color.red,dismissable:!0})},t.addSameLanguageMessage=function(e,t,i=!1){const n=a.ToastType.CaptionsLanguageChange;if(I(n,e,void 0,void 0))return;const s=i?"CallTranscriptionNotifications.SameLanguageB":"CallTranscriptionNotifications.SameLanguageA";return l.track(new c.CaptionsNotificationDisplayedEvent(e,n.toString(),i)),y(n,{callId:e,text:o.getString(s),dismissable:!0,buttons:[{label:o.getString(i?"CallTranscriptionNotifications.Keep":"CallTranscriptionNotifications.StopTranslation"),action:T(e,n,i,c.NotificationActionButtonType.Primary,null==t?void 0:t[0])},{label:o.getString(i?"CallTranscriptionNotifications.Dismiss":"CallTranscriptionNotifications.Keep"),action:T(e,n,i,c.NotificationActionButtonType.Secondary,null==t?void 0:t[1])}]})},t.removeLanguageChangeDetectedMessage=b,t.addLanguageChangeDetectedMessage=function(e,t,i,n,r=!1){const d=a.ToastType.CaptionsParticipantLanguageChange;_(e,t);const u=i.split("-")[0],h=s.getLanguageOnlyTitle(u);if(I(d,e,t,u))return;b(0,t);const p=v(e,t),g={callId:e,participantId:t,text:r?o.getString("CallTranscriptionNotifications.LanguageChangeDetectedB",{language:h,name:p}):o.getString("CallTranscriptionNotifications.LanguageChangeDetectedA",{language:h,name:p}),dismissable:!0,buttons:[(null==n?void 0:n[0])?{label:o.getString(r?"CallTranscriptionNotifications.Revert":"CallTranscriptionNotifications.Change",{language:h}),action:T(e,d,r,c.NotificationActionButtonType.Primary,null==n?void 0:n[0])}:void 0]},S=m(d,t);return S?(a.default.updateToast(S.id,g)&&C.default.maybeAnnounceForAccessibility(g.text),S.id):(l.track(new c.CaptionsNotificationDisplayedEvent(e,d.toString(),r)),y(d,g))},t.removeUnableDetectLanguageMessage=_,t.addUnableDetectLanguageMessage=function(e,t,i,n){const s=a.ToastType.CaptionsLanguageDetectionError;if(I(s,e,t,void 0))return;b(0,t);const r=v(e,t),d=n?o.getString("CallTranscriptionNotifications.UnableDetectLanguageTextB",{name:r}):o.getString("CallTranscriptionNotifications.UnableDetectLanguageTextA",{name:r}),u=m(s,t);return u?u.id:(l.track(new c.CaptionsNotificationDisplayedEvent(e,s.toString(),n)),y(s,{callId:e,participantId:t,text:d,dismissable:!0,buttons:[{label:o.getString(n?"CallTranscriptionNotifications.Keep":"CallTranscriptionNotifications.SetUp"),action:T(e,s,n,c.NotificationActionButtonType.Primary,null==i?void 0:i[0])},{label:o.getString(n?"CallTranscriptionNotifications.SetUp":"CallTranscriptionNotifications.StopTranslation"),action:T(e,s,n,c.NotificationActionButtonType.Secondary,null==i?void 0:i[1])}]}))},t.addTranslationConsentMessage=function(e,t){const i=a.ToastType.CaptionsTranslationConsent,s=g.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;return l.track(new c.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0)),f(i,{callId:e,icon:n.SkypeIcon.SkypeTranslatorNew,title:o.getString("CallTranscriptionNotifications.TranslationConsentTitle"),text:o.getString("CallTranscriptionNotifications.TranslationConsentText"),subtitle:o.getString("CallTranscriptionNotifications.TranslationConsentSubtitle"),subtext:[o.getString("CallTranscriptionNotifications.TranslationConsentSubtext1"),o.getString("CallTranscriptionNotifications.TranslationConsentSubtext2",{featureName:s}),o.getString("CallTranscriptionNotifications.TranslationConsentSubtext3")],link:{text:o.getString("CallTranscriptionNotifications.TranslationConsentLearnMore"),url:g.default.getS4LCMCFeaturesNoSubscription().skypeTranslation.privacyLink},buttons:[{label:o.getString("CallTranscriptionNotifications.TranslationConsentSendRequest"),action:T(e,i,void 0,c.NotificationActionButtonType.Primary,t[0])},{label:o.getString("CallTranscriptionNotifications.TranslationConsentMaybeLater"),action:T(e,i,void 0,c.NotificationActionButtonType.Secondary,t[1])}]})},t.addTranslationConsentSentMessage=function(e,t){const i=a.ToastType.CaptionsTranslationRequestSent;return l.track(new c.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0)),y(i,{callId:e,text:o.getString("CallTranscriptionNotifications.TranslationConsentSentText"),dismissable:!0,buttons:[{label:o.getString("CallTranscriptionNotifications.TranslationConsentSentGotIt"),action:T(e,i,void 0,c.NotificationActionButtonType.Primary,t[0])},{label:o.getString("CallTranscriptionNotifications.TranslationConsentSentCancel"),action:T(e,i,void 0,c.NotificationActionButtonType.Secondary,t[1])}]})},t.addTranslationConsentQuestionMessage=function(e,t,i){const s=a.ToastType.CaptionsTranslationConsentRequest,r=g.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;l.track(new c.CaptionsNotificationDisplayedEvent(e,s.toString(),void 0));const d=o.getString("CallTranscriptionNotifications.TranslationConsentQuestionTitle",{name:null!=t?t:o.getString("CallTranscriptionNotifications.OtherUser")});return f(s,{callId:e,icon:n.SkypeIcon.SkypeTranslatorNew,title:d,text:o.getString("CallTranscriptionNotifications.TranslationConsentText"),subtitle:o.getString("CallTranscriptionNotifications.TranslationConsentSubtitle"),subtext:[o.getString("CallTranscriptionNotifications.TranslationConsentSubtext1"),o.getString("CallTranscriptionNotifications.TranslationConsentSubtext2",{featureName:r}),o.getString("CallTranscriptionNotifications.TranslationConsentSubtext3")],link:{text:o.getString("CallTranscriptionNotifications.TranslationConsentLearnMore"),url:g.default.getS4LCMCFeaturesNoSubscription().skypeTranslation.privacyLink},buttons:[{label:o.getString("CallTranscriptionNotifications.TranslationConsentQuestionTranslate"),action:T(e,s,void 0,c.NotificationActionButtonType.Primary,i[0])},{label:o.getString("CallTranscriptionNotifications.TranslationConsentQuestionNoTranks"),action:T(e,s,void 0,c.NotificationActionButtonType.Secondary,i[1])}]})},t.addTranslationRejectedMessage=function(e,t){const i=a.ToastType.CaptionsTranslationRejected;l.track(new c.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0));const n=y(i,{callId:e,text:o.getString("CallTranscriptionNotifications.TranslationRejectedText"),dismissable:!0});return n&&t&&p.default.setTimeout((()=>{a.default.removeToast(n)}),t),n},t.addTranslationCancelledMessage=function(e,t){const i=a.ToastType.CaptionsTranslationCancelled;l.track(new c.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0));const n=y(i,{callId:e,text:o.getString("CallTranscriptionNotifications.TranslationCancelledText"),dismissable:!0});return n&&t&&p.default.setTimeout((()=>{a.default.removeToast(n)}),t),n},t.addTranslationStoppedMessage=function(e,t,i){const n=a.ToastType.CaptionsTranslationStopped;l.track(new c.CaptionsNotificationDisplayedEvent(e,n.toString(),void 0));const s=y(n,{callId:e,text:t?o.getString("CallTranscriptionNotifications.TranslationStoppedTextName",{name:t}):o.getString("CallTranscriptionNotifications.TranslationStoppedText"),dismissable:!0});return s&&i&&p.default.setTimeout((()=>{a.default.removeToast(s)}),i),s},t.addTranslationNotSuppportedMessage=function(e,t,i){const n=a.ToastType.CaptionsTranslationNotSupported;l.track(new c.CaptionsNotificationDisplayedEvent(e,n.toString(),void 0));const s=y(n,{callId:e,text:o.getString("CallTranscriptionNotifications.TranslationNotSuppportedText"),dismissable:!0,buttons:[{label:o.getString("CallTranscriptionNotifications.TranslationNotSuppportedGotIt"),action:T(e,n,void 0,c.NotificationActionButtonType.Primary,t[0])}]});return s&&i&&p.default.setTimeout((()=>{a.default.removeToast(s)}),i),s},t.addTranslationEnabledMessage=function(e,t,i){const n=a.ToastType.CaptionsTranslationEnabled;l.track(new c.CaptionsNotificationDisplayedEvent(e,n.toString(),void 0));const s=y(n,{callId:e,text:t?o.getString("CallTranscriptionNotifications.TranslationEnabledTextName",{name:t}):o.getString("CallTranscriptionNotifications.TranslationEnabledText"),dismissable:!0});return s&&i&&p.default.setTimeout((()=>{a.default.removeToast(s)}),i),s},t.addTruVoiceAvailableMessage=function(e,t,i){const n=a.ToastType.CaptionsTruVoiceEnable,s=g.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;l.track(new c.CaptionsNotificationDisplayedEvent(e,n.toString(),void 0));const r=y(n,{callId:e,text:o.getString("CallTranscriptionNotifications.TruVoiceConsentText",{featureName:s}),dismissable:!0,buttons:[{label:o.getString("CallTranscriptionNotifications.TruVoiceConsentLearnMore"),action:T(e,n,void 0,c.NotificationActionButtonType.Primary,t[0])},{label:o.getString("CallTranscriptionNotifications.TruVoiceConsentMaybeLater"),action:T(e,n,void 0,c.NotificationActionButtonType.Secondary,t[1])}]});return r&&i&&p.default.setTimeout((()=>{a.default.removeToast(r)}),i),r},t.addTruVoiceConsentMessage=function(e,t){const i=a.ToastType.CaptionsTruVoiceConsent,s=g.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;return l.track(new c.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0)),f(i,{callId:e,icon:n.SkypeIcon.MicrophoneSpark,title:o.getString("CallTranscriptionNotifications.TruVoiceConsentTitle",{featureName:s}),text:o.getString("CallTranscriptionNotifications.TruVoiceConsentText",{featureName:s}),subtitle:o.getString("CallTranscriptionNotifications.TruVoiceConsentSubtitle"),subtext:[o.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext1",{featureName:s}),o.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext2",{featureName:s}),o.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext3",{featureName:s})],link:{text:o.getString("CallTranscriptionNotifications.TruVoiceConsentLearnMore"),url:g.default.getS4LCMCFeaturesNoSubscription().skypeTranslation.privacyLink},buttons:[{label:o.getString("CallTranscriptionNotifications.TruVoiceConsentSendRequest"),action:T(e,i,void 0,c.NotificationActionButtonType.Primary,t[0])},{label:o.getString("CallTranscriptionNotifications.TruVoiceConsentMaybeLater"),action:T(e,i,void 0,c.NotificationActionButtonType.Secondary,t[1])}]})},t.addTruVoiceConsentSentMessage=function(e,t){const i=a.ToastType.CaptionsTruVoiceRequestSent,n=g.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;return l.track(new c.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0)),y(i,{callId:e,text:o.getString("CallTranscriptionNotifications.TruVoiceConsentSentText",{featureName:n}),dismissable:!0,buttons:[{label:o.getString("CallTranscriptionNotifications.TruVoiceConsentSentGotIt"),action:T(e,i,void 0,c.NotificationActionButtonType.Primary,t[0])},{label:o.getString("CallTranscriptionNotifications.TruVoiceConsentSentCancel"),action:T(e,i,void 0,c.NotificationActionButtonType.Secondary,t[0])}]})},t.addTruVoiceConsentQuestionMessage=function(e,t,i){const s=a.ToastType.CaptionsTruVoiceConsentRequest,r=g.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;return l.track(new c.CaptionsNotificationDisplayedEvent(e,s.toString(),void 0)),f(s,{callId:e,icon:n.SkypeIcon.MicrophoneSpark,title:o.getString("CallTranscriptionNotifications.TruVoiceConsentQuestionTitle",{name:null!=t?t:o.getString("CallTranscriptionNotifications.OtherUser"),featureName:r}),text:o.getString("CallTranscriptionNotifications.TruVoiceConsentText",{featureName:r}),subtitle:o.getString("CallTranscriptionNotifications.TruVoiceConsentSubtitle"),subtext:[o.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext1",{featureName:r}),o.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext2",{featureName:r}),o.getString("CallTranscriptionNotifications.TruVoiceConsentSubtext3",{featureName:r})],link:{text:o.getString("CallTranscriptionNotifications.TruVoiceConsentLearnMore"),url:g.default.getS4LCMCFeaturesNoSubscription().skypeTranslation.privacyLink},buttons:[{label:o.getString("CallTranscriptionNotifications.TruVoiceConsentQuestionActivate",{featureName:r}),action:T(e,s,void 0,c.NotificationActionButtonType.Primary,i[0])},{label:o.getString("CallTranscriptionNotifications.TruVoiceConsentQuestionNoThanks"),action:T(e,s,void 0,c.NotificationActionButtonType.Secondary,i[1])}]})},t.addTruVoiceRejectedMessage=function(e,t){const i=a.ToastType.CaptionsTruVoiceRejected,n=g.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;l.track(new c.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0));const s=y(i,{callId:e,text:o.getString("CallTranscriptionNotifications.TruVoiceRejectedText",{featureName:n}),dismissable:!0});return s&&t&&p.default.setTimeout((()=>{a.default.removeToast(s)}),t),s},t.addTruVoiceCancelledMessage=function(e,t){const i=a.ToastType.CaptionsTruVoiceCancelled,n=g.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;l.track(new c.CaptionsNotificationDisplayedEvent(e,i.toString(),void 0));const s=y(i,{callId:e,text:o.getString("CallTranscriptionNotifications.TruVoiceCancelledText",{featureName:n}),dismissable:!0});return s&&t&&p.default.setTimeout((()=>{a.default.removeToast(s)}),t),s},t.addTruVoiceStoppedMessage=function(e,t,i){const n=a.ToastType.CaptionsTruVoiceStopped,s=g.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;l.track(new c.CaptionsNotificationDisplayedEvent(e,n.toString(),void 0));const r=y(n,{callId:e,text:t?o.getString("CallTranscriptionNotifications.TruVoiceStoppedTextName",{name:t,featureName:s}):o.getString("CallTranscriptionNotifications.TruVoiceStoppedText",{featureName:s}),dismissable:!0});return r&&i&&p.default.setTimeout((()=>{a.default.removeToast(r)}),i),r},t.addTruVoiceEnabledMessage=function(e,t,i){const n=a.ToastType.CaptionsTruVoiceEnabled,s=g.default.getS4LCMCFeaturesNoSubscription().translationFeatures.truVoiceName;l.track(new c.CaptionsNotificationDisplayedEvent(e,n.toString(),void 0));const r=y(n,{callId:e,text:t?o.getString("CallTranscriptionNotifications.TruVoiceEnabledTextName",{name:t,featureName:s}):o.getString("CallTranscriptionNotifications.TruVoiceEnabledText",{featureName:s}),dismissable:!0});return r&&i&&p.default.setTimeout((()=>{a.default.removeToast(r)}),i),r};const T=(e,t,i,a,n)=>o=>{l.track(new c.CaptionsNotificationClickedEvent(e,t.toString(),i,a)),n()},v=(e,t)=>{let i;return h.default.CallingStore.connectedParticipants(e).forEach((e=>{var a,n;null===(n=null===(a=e.endpoints)||void 0===a?void 0:a.endpointDetails)||void 0===n||n.forEach((a=>{a.participantId===t&&(i=e.id)}))})),i?d.default.isMyMri(i)?o.getString("DisplayInfoStore.ListMyName"):u.default.getShortDisplayName(i)||t:t},w={},I=(e,t,i,n)=>{const o=`${a.ToastType[e]}-${t}-${i}-${n}`;return!!w[o]||(w[o]=(new Date).valueOf(),p.default.setTimeout((()=>{delete w[o]}),2e4),!1)}},201990:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.truVoiceDisable=t.truVoiceEnable=t.translationAutoDetectEnableOnFirstConsent=t.translationAutoDetectDisable=t.translationAutoDetectEnable=t.resetTruVoiceConsent=t.giveTruVoiceConsent=t.resetTranslationConsent=t.giveTranslationConsent=void 0;const a=i(46929),n=i(853374),o=i(502278);function s(e){const t=n.default.newCauseId();a.default.setCallTranslatorTranslationAutoDetectEnabled(!0),o.default.onStartTranslationAutoDetect(e,t)}t.giveTranslationConsent=function(){a.default.setCallTranslatorTranslationConsent(!0),a.default.setCallTranslatorTranslationConsentChangeDate(Date.now())},t.resetTranslationConsent=function(){a.default.setCallTranslatorTranslationConsent(!1),a.default.setCallTranslatorTranslationConsentChangeDate(Date.now()),a.default.setCallTranslatorTranslationAutoDetectOffered(!1)},t.giveTruVoiceConsent=function(){a.default.setCallTranslatorTruVoiceConsent(!0),a.default.setCallTranslatorTruVoiceConsentChangeDate(Date.now())},t.resetTruVoiceConsent=function(){a.default.setCallTranslatorTruVoiceConsent(!1),a.default.setCallTranslatorTruVoiceConsentChangeDate(Date.now()),a.default.setCallTranslatorTruVoiceOffered(!1)},t.translationAutoDetectEnable=s,t.translationAutoDetectDisable=function(e){const t=n.default.newCauseId();a.default.setCallTranslatorTranslationAutoDetectEnabled(!1),o.default.onStopTranslationAutoDetect(e,t)},t.translationAutoDetectEnableOnFirstConsent=function(e){a.default.getCallTranslatorTranslationAutoDetectOffered()||(s(e),a.default.setCallTranslatorTranslationAutoDetectOffered(!0))},t.truVoiceEnable=function(e){if(a.default.setCallTranslatorTruVoiceEnabled(!0),e){const t=n.default.newCauseId(),i=a.default.getCallTranslatorTranslationConsentChangeDate(),s=a.default.getCallTranslatorTruVoiceConsentChangeDate();o.default.onStartCustomVoice(e,i,s,t)}},t.truVoiceDisable=function(e){if(a.default.setCallTranslatorTruVoiceEnabled(!1),e){const t=n.default.newCauseId();o.default.onStopCustomVoice(e,t)}}},471727:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallUIUtils=t.ReactionButtonType=t.UnsupportedFeature=t.MaxVideoWidthOnMobile=t.ServerMutedToastTimeout=t.DummyVideoSize=void 0;const a=i(496486),n=i(516778),o=i(148540),s=i(285788),r=i(889391),l=i(994224),c=i(47447),d=i(568580),u=i(598925),h=i(480200),p=i(803493),g=i(539549),C=i(685329),S=i(952262),m=i(746096),y=i(805581),f=i(436237),b=i(733754),_=i(257538),T=i(844972),v=i(18078),w=i(330124),I=i(827357),P=i(498053),M=i(399189),k=i(754306),A=i(33004),R=i(29130),x=i(914976),L=i(886045),V=i(824932),O=i(126978),B=i(581760),D=i(711828),E=i(360305),N=i(418037),F=i(66123),j=i(178735),U=i(671830),H=i(136850),z=i(76514),G=i(156018),W=i(502278);t.DummyVideoSize={height:0,width:0};const K=1e4;var $,q;t.ServerMutedToastTimeout=5e3,t.MaxVideoWidthOnMobile=1.3*h.RibbonSizes.ribbonItemSizeSmall,function(e){e[e.CallReactions=0]="CallReactions"}($=t.UnsupportedFeature||(t.UnsupportedFeature={})),function(e){e[e.Celebration=0]="Celebration",e[e.Heart=1]="Heart"}(q=t.ReactionButtonType||(t.ReactionButtonType={}));const Q={[h.StageMode.Speaker]:"CallPanel.CallHeaderSpeakerViewLabel",[h.StageMode.Grid]:"CallPanel.CallHeaderGridViewLabel",[h.StageMode.Presentation]:"CallPanel.CallHeaderPresentationViewLabel",[h.StageMode.FocusedScreenShare]:"CallPanel.CallHeaderContentViewLabel",[h.StageMode.TogetherMode]:"CallPanel.CallHeaderTogetherModeViewLabel",[h.StageMode.LargeGrid]:"CallPanel.CallHeaderLargeGridViewLabel"},X={[h.StageMode.Speaker]:"CallPanel.CallHeaderSpeakerViewLabel",[h.StageMode.Grid]:"CallPanel.CallHeaderGridViewLabel",[h.StageMode.Presentation]:"CallPanel.CallHeaderPresentationViewLabel",[h.StageMode.FocusedScreenShare]:"CallPanel.CallHeaderContentViewLabel",[h.StageMode.TogetherMode]:"CallPanel.CallHeaderTogetherModeViewLabel",[h.StageMode.LargeGrid]:"CallPanel.CallHeaderLargeGalleryViewLabel"},Z={[h.StageMode.Speaker]:D.SkypeIcon.StartIncomingVideo,[h.StageMode.Grid]:D.SkypeIcon.Gallery,[h.StageMode.FocusedScreenShare]:D.SkypeIcon.Presenter,[h.StageMode.LargeGrid]:D.SkypeIcon.GalleryLarge,[h.StageMode.TogetherMode]:D.SkypeIcon.Audience,[h.StageMode.Manual]:D.SkypeIcon.GridView,[h.StageMode.Presentation]:D.SkypeIcon.Presenter},J={[h.StageMode.Speaker]:D.SkypeIcon.StartIncomingVideo,[h.StageMode.Grid]:D.SkypeIcon.GridView,[h.StageMode.FocusedScreenShare]:D.SkypeIcon.ContentView,[h.StageMode.Presentation]:D.SkypeIcon.Presenter,[h.StageMode.LargeGrid]:D.SkypeIcon.GalleryLarge,[h.StageMode.TogetherMode]:D.SkypeIcon.Audience,[h.StageMode.Manual]:D.SkypeIcon.GridView},Y=176;class ee{static _filterPerEndpointDuplicitStreams(e){const t=new Map;return e.filter((e=>e.isAvailable)).forEach((e=>{const i=t.get(e.endpointId);(!i||e.rank>i.rank)&&t.set(e.endpointId,e)})),Array.from(t.values())}static elementInfoForParticipantOrScreenshare(e,t,i,a,n,s,r){const c=a.state,p=this.isFullScreenBot(t)?[u.VideoOverrideReason.FullScreenBot]:void 0,g=r?o.StreamType.ScreenSharing:o.StreamType.Video,C=this._isStreamAvailable(t,g,i,void 0,p),S=this._streamDimensions(t,g,i),y=!!r&&C;let b=!1;if(y){const e=l.default.ScreenSharingControlStoreRegistrar.getStoreFromCallId(i);if(e){const t=e.viewerInControl();t&&v.default.isMyMri(t.mri)&&(b=!0)}else f.warn(m.LogTraceArea.CallingUI,"Screen sharing control store is undefined")}const _=d.default.isParticipantRinging(a),T=s&&d.default.isParticipantOnHold(a),w=d.default.isParticipantMuted(a),I=!!r,P=l.default.CallingStore.getRaisedHandRankForMri(i,t),M=d.default.isParticipantTalking(a),k=t===l.default.CallScreenShareStore.getPresenter(i)&&!r,A=l.default.CallingStore.isHandRaisedForMri(t,i),R=this.isTogetherModeBot(t),x=this.isLargeGridBot(t),L=a.state;let V=0;const O=this._filterPerEndpointDuplicitStreams(a.streams[g]).map((e=>{const a=this._isStreamAvailable(t,g,i,e,p,e.endpointId),n=this._streamDimensions(t,g,i,e.endpointId);return a&&V++,{endpointId:e.endpointId,isStreamAvailable:a,videoDimensions:n}}));let B=h.CallParticipantStreamsStatus.None;return 0!==V&&(B=V>1?h.CallParticipantStreamsStatus.Multiple:h.CallParticipantStreamsStatus.Single),n&&c===n.participantState&&C===n.isStreamAvailable&&S===n.videoDimensions&&y===n.isScreensharing&&b===n.isScreenshareControlling&&_===n.isRinging&&T===n.isOnHold&&w===n.isServerMuted&&I===n.renderScreenShare&&P===n.raisedHandRank&&M===n.isTalking&&O===n.streams&&B===n.streamsStatus&&k===n.isPresenter&&A===n.isHandRaised&&L===n.state?n:{key:e,mri:t,participantState:c,isStreamAvailable:C,videoDimensions:S,isScreensharing:y,isScreenshareControlling:b,isRinging:_,isOnHold:T,isServerMuted:w,renderScreenShare:I,ribbonAddTime:n?n.ribbonAddTime:this.nextRibbonAddTime(),connectionSortKey:_?1:0,raisedHandRank:P,isTalking:M,isHandRaised:A,isPresenter:k,state:L,streamsStatus:B,streams:O,isLargeGridBot:x,isTogetherModeBot:R}}static getLocalMediaStreams(e,t){const i=v.default.getSkypeMri(),a=l.default.CallingStore.getParticipantId(e),n=[{isStreamAvailable:l.default.CallingStore.isProvidingVideo(e),videoDimensions:l.default.CallingStore.getLocalVideoStreamSize(e),endpointId:h.CallStageElementKeys.localUserKey}],o=l.default.CallingStore.getCallMediaStreams(e);return o&&o[t]&&o[t].filter((e=>e.participantId!==a)).map((a=>{const o=this._isStreamAvailable(i,t,e,a),s=this._streamDimensions(i,t,e,a.endpointId);n.push({endpointId:a.endpointId,isStreamAvailable:o,videoDimensions:s})})),n}static isLargeGridBot(e){const t=y.default.getCallGridViewBotMriFilter();return a.includes(t,e)}static isTogetherModeBot(e){const t=y.default.getCallAudienceBotMriFilter();return a.includes(t,e)}static isFullScreenBot(e){return this.isTogetherModeBot(e)||this.isLargeGridBot(e)}static isLocalOrServerMuted(e){return l.default.CallingFeaturesHelper.isLocalOrServerMuted(e)}static nextRibbonAddTime(e=!0){return e?this._ribbonAddTimeValue--:Date.now()}static shouldRenderParticipant(e,t,i){return(d.default.isParticipantConnected(e)||d.default.isParticipantRinging(e))&&!a.includes(i,t)}static getMouseCornerPosition(e,t,i){if(i){const a=.15*i.width;if(e-i.x<a&&t-i.y<a)return h.CallingViewCornerPostion.UpperLeft;if(e-i.x<a&&t-i.y>i.height-a)return h.CallingViewCornerPostion.BottomLeft;if(e-i.x>i.width-a&&t-i.y<a)return h.CallingViewCornerPostion.UpperRight;if(e-i.x>i.width-a&&t-i.y>i.height-a)return h.CallingViewCornerPostion.BottomRight}return h.CallingViewCornerPostion.NotAtCorner}static shouldStartSimulateViewResizing(e,t,i,a,n){return e&&t&&i&&a&&n}static shouldReRenderVisibleRibbonItems(e,t,i){const n=Math.min(e.length,t.length),o=i?e.filter((e=>-1===i.indexOf(e)&&-1===i.indexOf("ss_"+e))):e;let s=!1;return a.each(o.slice(0,n),(e=>{-1===t.indexOf(e)&&(s=!0)})),s}static shouldRenderParticipantState(e){return d.default.isParticipantStateConnected(e)||d.default.isParticipantStateRinging(e)}static shouldRenderConnectedParticipantInEventStream(e,t,i){return d.default.isParticipantConnected(e)&&!a.includes(i,t)}static shouldRenderRingingParticipantInEventStream(e,t,i){return d.default.isParticipantRinging(e)&&!a.includes(i,t)}static ribbonLayoutRect(e,t,i,a,n){let o=a.height,s=a.width;const r=e&&e!==h.LayoutInfoVideoType.None?ee._tryToGetCorrectAspectRatioViaVideoType(e,t):1;return n?o=a.height/r:s=a.width*r,{x:i,y:0,width:s,height:o}}static _tryToGetCorrectAspectRatioViaVideoType(e,t){return a.isUndefined(t)||e===h.LayoutInfoVideoType.None?1:t}static _getSwapableRibbionItemKeys(e){return a.map(e.filter((e=>!a.isUndefined(e.ribbonPosition)&&e.ribbonPosition>=0&&!e.displayOnStage&&!e.isLocal&&!e.isHostOfScreenshare&&!e.isScreenshare)),(e=>e.key))}static _getSwapableRibbionItemIndex(e){const t=e.filter((e=>!a.isUndefined(e.ribbonPosition)&&!e.displayOnStage&&e.ribbonPosition>=0&&!e.isLocal&&!e.isHostOfScreenshare&&!e.isScreenshare));return a.map(t,(t=>a.findIndex(e,(e=>e.key===t.key))))}static getVisibleSwapableRibbonItemKeys(e,t){return a.map(e.filter((e=>!a.isUndefined(e.ribbonPosition)&&!e.displayOnStage&&e.ribbonPosition>=0&&-1===t.indexOf(e.key)&&!e.isLocal&&!e.isHostOfScreenshare&&!e.isScreenshare)),(e=>e.key))}static reorderLayoutInfoViaLeastVisibleItemSwaping(e,t){const i=Math.min(t.length,e.length),n=ee._getSwapableRibbionItemKeys(e).slice(0,i),o=ee._getSwapableRibbionItemIndex(e).slice(0,i),s=a.filter(n,(e=>-1===t.indexOf(e))),r=[];let l=0;a.each(t,(t=>{let i;i=-1!==n.indexOf(t)?t:s[l++];const o=a.find(e,(e=>e.key===i));a.isUndefined(o)||r.push(a.clone(o))})),r.forEach(((t,i)=>{if(i<o.length){const a=o[i];if(a<e.length){const i=e[a].ribbonPosition,n=e[a].participantRank;e[a]=t,e[a].ribbonPosition=i,e[a].participantRank=n}}}))}static stageLayoutRect(e,t){const i=e.height*((null==t?void 0:t.height)||1),a=e.width*((null==t?void 0:t.width)||1);return ee.translateRect({x:0,y:0,height:i,width:a},e.width)}static translateRect(e,t){if(!e)return;return{x:t-e.x-e.width,y:e.y,width:e.width,height:e.height}}static translatePoint(e,t){if(!e)return;return{x:t-e.x,y:e.y}}static nametagOffset(e,t){return{offset:0+h.AudioNotificationOffset}}static accessoryPosition(e,t,i){if(i)switch(t){case 1:return;case 2:return h.CallAccessoryPosition.Center;case 3:return 0===e?h.CallAccessoryPosition.Center:1===e?h.CallAccessoryPosition.BottomRight:h.CallAccessoryPosition.TopRight}switch(t){case 1:return;case 2:case 3:return 0===e?h.CallAccessoryPosition.BottomRight:h.CallAccessoryPosition.TopRight;case 4:if(0===e||1===e)return h.CallAccessoryPosition.BottomRight;if(2===e||3===e)return h.CallAccessoryPosition.TopRight}}static compareElementInfo(e,t){if(e.connectionSortKey!==t.connectionSortKey)return this._compareValue(e.connectionSortKey,t.connectionSortKey);if(e.renderScreenShare!==t.renderScreenShare)return this._compareBoolean(!!t.renderScreenShare,!!e.renderScreenShare);if(e.isScreensharing!==t.isScreensharing)return this._compareBoolean(!!t.isScreensharing,!!e.isScreensharing);if(!e.isTalking&&!t.isTalking&&e.raisedHandRank!==t.raisedHandRank)return this._compareValue(e.raisedHandRank||Number.MAX_VALUE,t.raisedHandRank||Number.MAX_VALUE);if(e.activeSpeakerRank!==t.activeSpeakerRank)return this._compareValue(e.activeSpeakerRank||-1,t.activeSpeakerRank||-1);const i=e.isStreamAvailable,a=t.isStreamAvailable;return i!==a?this._compareBoolean(a,i):this._compareValue(e.ribbonAddTime,t.ribbonAddTime)}static getOrderedByVideoPresenceParticipants(e,t){const i=l.default.CallParticipantStore.getParticipantRenderInfosForCall(t),n=a.compact(a.map(e,(e=>i.get(e)))).sort(((e,t)=>this._compareRenderInfoBasedOnVideo(e,t)));return a.map(n,(e=>e.renderKey))}static getOrderedDisplayedTrayParticipants(e,t,i,n=1,o=!1,s=!1,r=!1){const c=l.default.CallParticipantStore.getParticipantRenderInfosForCall(i),d=a.compact(a.map(e,(e=>c.get(e)))),u=r?z.default.getPinnedParticipants(i):void 0,h=d.sort(((e,t)=>this._compareTrayRenderInfo(e,t,s,u))),p=this._getNumberOfShownParticipants(t,h,n,o),g=a.take(h,p),C=a.takeRight(h,h.length-p);return this._showHiddenTalkingParticipant(g,C),a.map(g,(e=>e.renderKey))}static _showHiddenTalkingParticipant(e,t){var i;const n=a.find(t,(e=>0===e.activeSpeakerRank)),o=e.length-1,s=null===(i=e[o])||void 0===i?void 0:i.isLocal;n&&!s&&a.fill(e,n,o)}static _compareTrayRenderInfo(e,t,i,n){if(e.isLocal!==t.isLocal)return this._compareBoolean(t.isLocal,e.isLocal);if(i&&e.isPresenter!==t.isPresenter)return this._compareBoolean(!!t.isPresenter,!!e.isPresenter);if(n){const i=a.includes(n,e.renderKey),o=a.includes(n,t.renderKey);if(i!==o)return this._compareBoolean(o,i)}const o=e.shouldRenderVideo,s=t.shouldRenderVideo;if(o!==s)return this._compareBoolean(s,o);const r=0===e.activeSpeakerRank,l=0===t.activeSpeakerRank;if(r!==l)return this._compareBoolean(l,r);if(!e.isTalking&&!t.isTalking&&e.raisedHandRank!==t.raisedHandRank){const i=a.isUndefined(e.raisedHandRank)?Number.MAX_VALUE:e.raisedHandRank,n=a.isUndefined(t.raisedHandRank)?Number.MAX_VALUE:t.raisedHandRank;return this._compareValue(i,n)}return e.activeSpeakerRank!==t.activeSpeakerRank?this._compareValue(e.activeSpeakerRank||-1,t.activeSpeakerRank||-1):0}static _compareRenderInfoBasedOnVideo(e,t){if(e.isLocal!==t.isLocal)return this._compareBoolean(t.isLocal,e.isLocal);const i=e.shouldRenderVideo,n=t.shouldRenderVideo;if(i!==n)return this._compareBoolean(n,i);if(r.default.getS4LCMCFeaturesNoSubscription().twinCamEnabled){const i=!!e.streams&&a.filter(e.streams,(e=>e.isStreamAvailable)).length>1,n=!!t.streams&&a.filter(t.streams,(e=>e.isStreamAvailable)).length>1;if(i&&!n)return-1;if(!i&&n)return 1}return 0}static _getNumberOfShownParticipants(e,t,i=1,n=!1){let o=t.length;if(a.sumBy(t,(e=>this._getParticipantSize(e,i,n)))>e){let s=e-h.BigTrayOverflowButtonSize*i;a.each(t,((e,a)=>{const r=this._getParticipantSize(e,i,n);return s>r?(s-=r,!0):(o=0===a&&(null==t?void 0:t.length)>0?1:a,!1)}))}return o}static _getParticipantSize(e,t=1,i=!1){return e?!e.shouldRenderVideo||i?h.BigTrayCallParticipantMainAxisSize.audio*t:h.BigTrayCallParticipantMainAxisSize.video*t:0}static getErrorToastType(e){switch(e){case u.CallDeviceQualityEventType.AudioStoppedWorking:return h.DeviceStatusToastType.AudioStoppedWorking;case u.CallDeviceQualityEventType.MicrophoneStoppedWorking:return h.DeviceStatusToastType.MicrophoneStoppedWorking;case u.CallDeviceQualityEventType.SpeakerStoppedWorking:return h.DeviceStatusToastType.SpeakerStoppedWorking;case u.CallDeviceQualityEventType.AudioDeviceBusy:return h.DeviceStatusToastType.AudioDeviceBusy;case u.CallDeviceQualityEventType.VideoStoppedWorking:return h.DeviceStatusToastType.VideoStoppedWorking;case u.CallDeviceQualityEventType.VideoTimedOut:return h.DeviceStatusToastType.VideoTimedOut;case u.CallDeviceQualityEventType.VideoCameraBusy:return h.DeviceStatusToastType.VideoSystemBusy;case u.CallDeviceQualityEventType.VideoSystemOutOfMemory:return h.DeviceStatusToastType.VideoSystemOutOfMemory;case u.CallDeviceQualityEventType.DeviceCausingEcho:return h.DeviceStatusToastType.DeviceCausingEcho;case u.CallDeviceQualityEventType.MicrophoneNotMuteButSilent:return h.DeviceStatusToastType.MicrophoneNotMuteButSilent;case u.CallDeviceQualityEventType.DeviceRenderGlitches:return h.DeviceStatusToastType.DeviceRenderGlitches;case u.CallDeviceQualityEventType.DeviceLowSNR:return h.DeviceStatusToastType.DeviceLowSNR;case u.CallDeviceQualityEventType.DeviceClipping:return h.DeviceStatusToastType.DeviceClipping;case u.CallDeviceQualityEventType.DeviceEcho:return h.DeviceStatusToastType.DeviceEcho;case u.CallDeviceQualityEventType.DeviceMultipleEndpoints:return h.DeviceStatusToastType.DeviceMultipleEndpoints;case u.CallDeviceQualityEventType.DeviceRenderZeroVolume:return h.DeviceStatusToastType.DeviceRenderZeroVolume;case u.CallDeviceQualityEventType.CpuInsufficient:return h.DeviceStatusToastType.CpuInsufficient;case u.CallDeviceQualityEventType.ZeroCaptureDevicesEnumerated:return h.DeviceStatusToastType.ZeroCaptureDevicesEnumerated;case u.CallDeviceQualityEventType.ZeroRenderDevicesEnumerated:return h.DeviceStatusToastType.ZeroRenderDevicesEnumerated;case u.CallDeviceQualityEventType.VideoCaptureDeviceFreeze:return h.DeviceStatusToastType.VideoCaptureDeviceFreeze;case u.CallDeviceQualityEventType.AudioCapturePermissionDenied:return h.DeviceStatusToastType.AudioCapturePermissionDenied;case u.CallDeviceQualityEventType.VideoCapturePermissionDenied:return h.DeviceStatusToastType.VideoCapturePermissionDenied;case u.CallDeviceQualityEventType.VideoCaptureFreezeRecovered:return h.DeviceStatusToastType.VideoCaptureFreezeRecovered;case u.CallDeviceQualityEventType.DeviceRenderHowling:return h.DeviceStatusToastType.DeviceRenderHowling;case u.CallDeviceQualityEventType.PresentationAudioLoopbackDeviceState:return h.DeviceStatusToastType.PresentationAudioLoopbackDeviceState;case u.CallDeviceQualityEventType.RemoteNetworkConnectivityIssue:return h.DeviceStatusToastType.RemoteNetworkConnectivityIssue;case u.CallDeviceQualityEventType.AudioCaptureUltrasoundDetected:return h.DeviceStatusToastType.AudioCaptureUltrasoundDetected;case u.CallDeviceQualityEventType.MusicModeNotAvailable:return h.DeviceStatusToastType.MusicModeNotAvailable;case u.CallDeviceQualityEventType.CameraLighting:return h.DeviceStatusToastType.CameraLighting;case u.CallDeviceQualityEventType.AudioCaptureMusicDetectedWithHighNS:return h.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS;case u.CallDeviceQualityEventType.AudioCaptureMusicDetectedWithLowNS:return h.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS;case u.CallDeviceQualityEventType.AudioCaptureMusicDetectedWithHighNSNotAvailable:return h.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNSNotAvailable;default:return}}static getToastInformation(e,i,a,n){let o,s,r=!1,l=D.SkypeIcon.Warning;switch(e){case h.DeviceStatusToastType.AudioStoppedWorking:o="CallPanel.AudioDeviceFailed",r=!0;break;case h.DeviceStatusToastType.MicrophoneStoppedWorking:o="CallPanel.MicrophoneFailed",r=!0;break;case h.DeviceStatusToastType.SpeakerStoppedWorking:o="CallPanel.SpeakerFailed",r=!0;break;case h.DeviceStatusToastType.AudioDeviceBusy:o="CallPanel.AudioDeviceBusy",r=!0;break;case h.DeviceStatusToastType.MicrophoneDisconnected:o="CallPanel.NoMicrophone";break;case h.DeviceStatusToastType.SpeakerDisconnected:o="CallPanel.NoSpeaker";break;case h.DeviceStatusToastType.SoundSharingStopped:o="CallPanel.SoundSharingStopped";break;case h.DeviceStatusToastType.VideoStoppedWorking:case h.DeviceStatusToastType.VideoTimedOut:o="CallPanel.CameraFailed",r=!0;break;case h.DeviceStatusToastType.VideoSystemBusy:o="CallPanel.CameraBusy",r=!0;break;case h.DeviceStatusToastType.VideoSystemOutOfMemory:o="CallPanel.CameraStoppedWorkingOutOfMemory";break;case h.DeviceStatusToastType.CameraChanged:o="CallPanel.CameraChanged",r=!0,s=K;break;case h.DeviceStatusToastType.MicrophoneChanged:o="CallPanel.MicrophoneChanged",r=!0,s=K;break;case h.DeviceStatusToastType.SpeakerChanged:o="CallPanel.SpeakerChanged",r=!0,s=K;break;case h.DeviceStatusToastType.CompositeAudioAvailable:a?(o="CallPanel.NewAudio",s=K):(o="CallPanel.CompositeAudioChanged",r=!0,s=K);break;case h.DeviceStatusToastType.DeviceCausingEcho:o="CallPanel.DeviceCausingEcho",s=K;break;case h.DeviceStatusToastType.MicrophoneNotMuteButSilent:o="CallPanel.MicrophoneNotMuteButSilent",r=!0,s=K;break;case h.DeviceStatusToastType.MicrophoneServerMuted:o="CallPanel.MicrophoneServerMuted",s=t.ServerMutedToastTimeout,l=D.SkypeIcon.MicrophoneOff;break;case h.DeviceStatusToastType.OutgoingVideoDisabledDuringScreenSharing:o="CallPanel.OutgoingVideoDisabledScreenSharing";break;case h.DeviceStatusToastType.DeviceRenderGlitches:o="CallPanel.DeviceRenderGlitches",r=!0;break;case h.DeviceStatusToastType.DeviceLowSNR:o="CallPanel.DeviceLowSNR";break;case h.DeviceStatusToastType.DeviceClipping:o="CallPanel.DeviceClipping";break;case h.DeviceStatusToastType.DeviceEcho:o="CallPanel.DeviceEcho",l=D.SkypeIcon.MicrophoneOff;break;case h.DeviceStatusToastType.DeviceMultipleEndpoints:o="CallPanel.DeviceMultipleEndpoints",l=D.SkypeIcon.MicrophoneOff;break;case h.DeviceStatusToastType.DeviceRenderZeroVolume:o="CallPanel.DeviceRenderZeroVolume";break;case h.DeviceStatusToastType.CpuInsufficient:o="CallPanel.CpuInsufficient";break;case h.DeviceStatusToastType.ZeroCaptureDevicesEnumerated:o="CallPanel.ZeroCaptureDevicesEnumerated";break;case h.DeviceStatusToastType.ZeroRenderDevicesEnumerated:o="CallPanel.ZeroRenderDevicesEnumerated";break;case h.DeviceStatusToastType.VideoCaptureDeviceFreeze:o="CallPanel.VideoCaptureDeviceFreeze",r=!0,s=K;break;case h.DeviceStatusToastType.AudioCapturePermissionDenied:o="CallPanel.AudioCapturePermissionDenied",r=!0;break;case h.DeviceStatusToastType.VideoCapturePermissionDenied:o="CallPanel.VideoCapturePermissionDenied",r=!0;break;case h.DeviceStatusToastType.VideoCaptureFreezeRecovered:o="CallPanel.VideoCaptureFreezeRecovered",r=!0,s=K;break;case h.DeviceStatusToastType.DeviceRenderHowling:o="CallPanel.DeviceRenderHowling",r=!0;break;case h.DeviceStatusToastType.PresentationAudioLoopbackDeviceState:o="CallPanel.PresentationAudioLoopbackDeviceState";break;case h.DeviceStatusToastType.RemoteNetworkConnectivityIssue:o="CallPanel.RemoteNetworkConnectivityIssue";break;case h.DeviceStatusToastType.AudioCaptureUltrasoundDetected:o="CallPanel.AudioCaptureUltrasoundDetected",l=D.SkypeIcon.MicrophoneOff;break;case h.DeviceStatusToastType.MusicModeNotAvailable:o="CallPanel.MusicModeNotAvailable";break;case h.DeviceStatusToastType.CameraLighting:o="CallPanel.CameraLighting";break;case h.DeviceStatusToastType.VideoEffectsQualityChange:o="CallPanel.OnVideoEffectsQuality";break;case h.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNS:o="CallPanel.MusicDetectedWithHighNS";break;case h.DeviceStatusToastType.AudioCaptureMusicDetectedWithHighNSNotAvailable:r=!0,o="CallPanel.MusicDetectedWithHighNSNotAvailable";break;case h.DeviceStatusToastType.AudioCaptureMusicDetectedWithLowNS:o="CallPanel.MusicDetectedWithLowNS";break;case h.DeviceStatusToastType.None:default:return void f.warn(m.LogTraceArea.CallingUI,"Showing toast without specified error type this shouldnt happen")}return{notificationText:b.getString(o,i),showAvSettingsLink:r,timeout:s,icon:l,buttons:a,action:n}}static enableLayoutAnimation(){return!1}static isLightTheme(){const{enableLightThemeOnCallStage:e,enableCallingThemeSwitch:t}=r.default.getS4LCMCFeatures();return t?!!e&&!N.default.isDarkTheme()&&j.default.getLightThemeCallStageEnabled():!!e&&!N.default.isDarkTheme()}static disableCaptureAndChanges(e){return l.default.CallingStore.isProvidingVideo(e)}static _compareValue(e,t){return e===t?0:e>t?1:-1}static _compareBoolean(e,t){return e===t?0:e?1:-1}static fallbackStageElements(e,t,i){const a=this._fallbackStageParticipantKey(e,t,i);return a?[a]:[]}static isLeftPanelOpen(){return!w.default.isUsingStackNavigationContext()&&I.default.isLeftPanelShowing()}static isGalleryPanelOpen(){return!w.default.isUsingStackNavigationContext()&&I.default.isGalleryShowing()}static isSubtitlesPanelOpen(){return!w.default.isUsingStackNavigationContext()&&I.default.isSubtitlesShowing()}static isRightPanelOpen(){return!w.default.isUsingStackNavigationContext()&&I.default.isRightSideBarShowing()}static getCallCanvasWidth(e){let t=R.default.getWidth(e);return t-=this.isLeftPanelOpen()?O.default.getWidthNoSubscription(O.SideBar.Left):0,t-=this.isRightPanelOpen()?O.default.getWidthNoSubscription(O.SideBar.Right,!1):0,t}static getControlsType(e){const t=this.getCallCanvasWidth(e);let i;return i=w.default.isUsingStackNavigationContext()?h.CallControlsType.Mobile:t<=this._getWidthBreakpoint(h.CallControlsType.DesktopMinSmallest)?h.CallControlsType.DesktopMinSmallest:t<=this._getWidthBreakpoint(h.CallControlsType.DesktopMedium)?h.CallControlsType.DesktopMedium:t<=this._getWidthBreakpoint(h.CallControlsType.DesktopMinStageTwo)?h.CallControlsType.DesktopMinStageTwo:t<=this._getWidthBreakpoint(h.CallControlsType.DesktopMin)?h.CallControlsType.DesktopMin:h.CallControlsType.Default,i}static _getWidthBreakpoint(e){switch(e){case h.CallControlsType.DesktopMin:return h.DesktopMinNewCallControlsWidthBreakpoint;case h.CallControlsType.DesktopMedium:return h.DesktopMediumtNewCallControlsWidthBreakpoint;case h.CallControlsType.DesktopMinStageTwo:return h.DesktopMinStageTwoNewCallControlsWidthBreakpoint;case h.CallControlsType.DesktopMinSmallest:return h.DesktopMinSmallestNewCallControlsWidthBreakpoint}return-1}static isMinDesktop(e){return e===h.CallControlsType.DesktopMinSmallest||e===h.CallControlsType.DesktopMinStageTwo||e===h.CallControlsType.DesktopMin}static isDesktopMinCallPanelHeader(e){return!w.default.isUsingStackNavigationContext()&&!E.default.isTablet()&&this.getCallCanvasWidth(e)<=h.DesktopMinCallPanelHeaderWidthBreakpoint}static isDesktopMinCallRibbon(e){return!w.default.isUsingStackNavigationContext()&&!E.default.isTablet()&&this.getCallCanvasWidth(e)<=h.DesktopMinCallRibbonWidthBreakpoint}static isDesktopMinCallPanelHeaderV2(e){return!w.default.isUsingStackNavigationContext()&&!E.default.isTablet()&&this.getCallCanvasWidth(e)<=h.DesktopMinCallPanelHeaderV2WidthBreakpoint}static overflowMenuRowButtonsDescriptors(e){if(!e.callId||e.isEncryptedCall)return[];const t=[],i=new P.NativeMobileInvitePeopleCommand(e.conversationMri,_.MeetNowOrigin.CallPanel,e.callId);if(i.canExecute()){const a=b.getString("JoinLinkCard.InvitePopupAccessibilityTitle"),n={key:h.CallControlsOverflowItem.AddPeople,icon:{icon:D.SkypeIcon.ShareiOS,color:e.iconColor},title:a,accessibilityLabel:a,onPress:()=>i.execute()};t.push(n)}return t}static overflowMenuListDescriptors(e){if(!e.callId||e.isEncryptedCall)return[];const t={isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,callId:e.callId},i=[];if(r.default.getS4LCMCFeaturesNoSubscription().enableNoiseSuppression){const a=new P.ToggleNoiseSuppressionCommand(e.callId,t,e.noiseSuppressionMode);if(a.canExecute()){const t=[{label:b.getString("AudioVideoSettings.NoiseSuppressionOff"),value:o.NoiseSuppressionMode[o.NoiseSuppressionMode.Off]},{label:b.getString("AudioVideoSettings.NoiseSuppressionAuto"),value:o.NoiseSuppressionMode[o.NoiseSuppressionMode.Auto]},{label:b.getString("AudioVideoSettings.NoiseSuppressionLow"),value:o.NoiseSuppressionMode[o.NoiseSuppressionMode.Low]},{label:b.getString("AudioVideoSettings.NoiseSuppressionHigh"),value:o.NoiseSuppressionMode[o.NoiseSuppressionMode.High]}],n=t.find((t=>t.value===o.NoiseSuppressionMode[e.noiseSuppressionMode])),s=n?n.label:"",r=b.getString("AudioVideoSettings.NoiseSuppressionControlAccessibilityLabel",{selectedItem:s}),l={key:h.CallControlsOverflowItem.NoiseSuppression,icon:{icon:D.SkypeIcon.SoundWave,color:e.iconColor},title:b.getString("AudioVideoSettings.NoiseSuppressionControlLabel"),accessibilityLabel:r,onItemSelected:e=>a.execute(e),menuItems:t,listLabel:s};i.push(l)}}return i}static overflowMenuToggleDescriptors(e){if(!e.callId||e.isEncryptedCall)return[];const t={isPSTNCall:e.isPSTNCall,isEncryptedCall:e.isEncryptedCall,conversationMri:e.conversationMri,callId:e.callId},i=[];if(e.isBackroundBlurEnabled){const t=new P.BackgroundBlurCommand(e.callId,e.isVideoActive,e.isBackroundBlurEnabled,e.isBackgroundBlurSelected),a={key:h.CallControlsOverflowItem.BackgroundBlur,icon:{icon:D.SkypeIcon.BackgroundReplacement,color:e.iconColor},title:b.getString("CallControlsOverFlowMenu.EnableBackgroundBlur"),accessibilityLabel:b.getString("CallControlsOverFlowMenu.EnableBackgroundBlur"),onPress:()=>t.execute(),selected:e.isBackgroundBlurSelected,disabled:!t.canExecute(),isNew:e.isBackgroundBlurNewItem};i.push(a)}const a=new P.ToggleIncomingVideoCommand(e.callId,t,e.isAudioOnlyEnabled,e.isIncomingVideoDisabled);if(a.canExecute()){const t=!e.isIncomingVideoDisabled&&!e.isAudioOnlyEnabled,n=b.getString(t?"CallControlsOverFlowMenu.StopIncomingVideo":"CallControlsOverFlowMenu.StartIncomingVideo"),o={key:h.CallControlsOverflowItem.IncomingVideo,icon:{icon:D.SkypeIcon.Video,color:e.iconColor},title:b.getString("CallControlsOverFlowMenu.StartIncomingVideo"),accessibilityLabel:n,onPress:()=>a.execute(),selected:t};i.push(o)}return i}static overflowMenuButtonDescriptors(e,t){if(!e.callId||e.isEncryptedCall)return[];const i=[],a=new P.ToggleHoldCallCommand(e,void 0,e.iconColor);if(a.canExecute()){const e=a.getButtonDescriptor();e&&i.push(e)}const n=new P.TwinCamCommand(e.callId,e);if(n.canExecute()){const t=l.default.CallingStore.hasConnectedTwinCam(e.callId),a={key:h.CallControlsOverflowItem.TwinCam,icon:{icon:D.SkypeIcon.TwinCamMid,color:e.iconColor},title:t?b.getString("CallControlsOverFlowMenu.StopTwinCam"):b.getString("CallControlsOverFlowMenu.TwinCam"),accessibilityLabel:t?b.getString("CallControlsOverFlowMenu.StopTwinCam"):b.getString("CallControlsOverFlowMenu.TwinCam"),onPress:()=>n.execute(t)};i.push(a)}const o=new P.ShowBingBackgroundsCommand(e.callId,e.callerContext);if(o.canExecute()){const t={key:h.CallControlsOverflowItem.BingBackgrounds,icon:{icon:D.SkypeIcon.Bing,color:e.iconColor},title:b.getString("CallControlsOverFlowMenu.BingBackgrounds"),accessibilityLabel:b.getString("CallControlsOverFlowMenu.BingBackgrounds"),onPress:()=>o.execute()};i.push(t)}const s=new P.AddToCallCommand(e.callId,e,e.conversationMri,e.callerContext,m.NavigationAddToCallOrigin.OverflowMenu);if(s.canExecute()){const t={key:h.CallControlsOverflowItem.AddPeople,icon:{icon:D.SkypeIcon.ContactAdd,color:e.iconColor},title:b.getString("CallControlsOverFlowMenu.AddPeopleToCall"),accessibilityLabel:b.getString("CallControlsOverFlowMenu.AddPeopleToCall"),onPress:()=>s.execute()};i.push(t)}const r=new P.ParticipantsCommand(e.callId,e.conversationMri,e.callerContext);if(r.canExecute()){const t={key:h.CallControlsOverflowItem.Participants,icon:{icon:D.SkypeIcon.ContactGroupTwoPersonas,color:e.iconColor},title:b.getString("CallControlsOverFlowMenu.Participants"),accessibilityLabel:b.getString("CallControlsOverFlowMenu.Participants"),onPress:()=>r.execute()};i.push(t)}const c=new P.ToggleRecordCommand(e.callId,e,e.isRecording);if(c.canExecute()&&e.callUIState===h.CallUIState.Default){const t=b.getString(e.isRecording?"CallControlsOverFlowMenu.StopRecording":"CallControlsOverFlowMenu.StartRecording"),a={key:h.CallControlsOverflowItem.CallRecording,icon:e.isRecording?[{icon:D.SkypeIcon.CallRecordStroke,color:e.iconColor},{icon:D.SkypeIcon.CallRecordDot,color:B.Color.red}]:{icon:D.SkypeIcon.CallRecord,color:e.iconColor},title:t,accessibilityLabel:t,onPress:()=>c.execute()};i.push(a)}if(!l.default.CallingFeaturesHelper.allowReactionsInCallStageMobile()){const t=this.getReactionButtonType(e.conversationMri,e.callId),a=this.getReactionCommand(t,e.callId,e,e.reactionsConversationMri);if(a){const n=ee.getReactionButtonDescriptors(t,a),o=Object.assign(Object.assign({},n),{icon:{icon:n.icon,color:e.iconColor}});i.push(o)}}const d=new P.MomentCommand(e.callId,e,e.reactionsConversationMri);if(d.canExecute()&&l.default.CallingFeaturesHelper.allowReactionsInCallStageMobile()&&e.callUIState===h.CallUIState.Default){const t={icon:D.SkypeIcon.Snapshot,color:e.iconColor},a=b.getString("CallReactionsBar.PhotoSnapshotButtonShortTitle"),n={key:h.CallControlsOverflowItem.Moments,icon:t,title:a,accessibilityLabel:a,onPress:()=>d.execute()};i.push(n)}const u=new V.MobileScreenShareToggleCommand(e);if(u.canExecute()){const t=e.isScreenShareActive?{icon:D.SkypeIcon.ScreenShareOff,color:e.iconColor}:{icon:D.SkypeIcon.ScreenShare,color:e.iconColor},a=b.getString(e.isScreenShareActive?"CallControlsOverFlowMenu.StopShareScreen":"CallControlsOverFlowMenu.ShareScreen"),n={key:h.CallControlsOverflowItem.MobileScreenSharing,icon:t,title:a,accessibilityLabel:a,onPress:()=>u.execute()};i.push(n)}const p=new M.RaiseHandCommand(e.callId,e);if(p.canExecute()){const t={icon:D.SkypeIcon.RaiseHand,color:e.iconColor},a=b.getString("CallControls.RaiseHand"),n=b.getString("CallControls.RaiseHandLabel"),o={key:h.CallControlsOverflowItem.RaiseHands,icon:t,title:a,accessibilityLabel:n,onPress:()=>p.execute()};i.push(o)}const g=new M.LowerHandCommand(e.callId,k.LowerHandOrigin.CallControls);if(g.canExecute()){const t={icon:D.SkypeIcon.LowerHand,color:e.iconColor},a=b.getString("CallControls.LowerHand"),n=b.getString("CallControls.LowerHandLabel"),o={key:h.CallControlsOverflowItem.LowerHands,icon:t,title:a,accessibilityLabel:n,onPress:()=>g.execute()};i.push(o)}const C=new P.ToggleCallStatsCommand(e.callId,t);if(C.canExecute()){const t={key:h.CallControlsOverflowItem.CallStats,icon:{icon:D.SkypeIcon.Info,color:e.iconColor},title:b.getString("CallPanel.CallStats"),doesNotInfluenceMenuLayout:!0,onPress:()=>C.execute()};i.push(t)}const S=new P.ChangeTogetherModeBackgroundCommand(e.callId,e.conversationMri);if(S.canExecute()){const t=b.getString("CallControlsOverFlowMenu.ChangeTogetherModeBackground"),a={key:h.CallControlsOverflowItem.ChangeTogetherModeBackground,icon:{icon:F.default.getBackgroundChangeButtonIcon(),color:e.iconColor},title:t,doesNotInfluenceMenuLayout:!0,onPress:()=>S.execute()};i.push(a)}const y=new P.ToggleCaptionsCommand(e.callId,e,e.isTranslating);if(y.canExecute()&&e.callUIState===h.CallUIState.Default){const t=b.getString("CallControlsOverFlowMenu.LiveCaptionsStart"),a=D.SkypeIcon.ClosedCaption,n=t,o={key:h.CallControlsOverflowItem.CallTranslator,icon:{icon:a,color:e.iconColor},title:n,accessibilityLabel:t,onPress:()=>y.execute(),selected:e.isTranslating};i.push(o)}const f=new P.ToggleSkypeTranslateCommand(e.callId,e,e.isSkypeTranslating);if(f.canExecute()&&e.callUIState===h.CallUIState.Default){const t=b.getString((e.isSkypeTranslating,"CallControlsOverFlowMenu.Translate")),a=D.SkypeIcon.SkypeTranslatorNew,n=t,o={key:h.CallControlsOverflowItem.CallSkypeTranslation,icon:{icon:a,color:e.iconColor},title:n,accessibilityLabel:t,onPress:()=>f.execute(),selected:e.isSkypeTranslating};i.push(o)}const _=new P.SwitchCameraCommand(e.callId,e.isVideoActive);if(_.canExecute()){const t={key:h.CallControlsOverflowItem.SwitchCamera,icon:{icon:D.SkypeIcon.SwitchCamera,color:e.iconColor},title:b.getString("QuickCapturePanel.SwitchCameraButtonTitle"),accessibilityLabel:b.getString("QuickCapturePanel.SwitchCameraButtonTitle"),onPress:()=>_.execute()};i.push(t)}return i}static getFeatureUnsupportedParticipantsInfo(e,t,i){return a.isEmpty(t)?void 0:{count:t.length,firstUser:S.default.getMemberShortNameForConversation(i,l.default.CallingStore.getRemoteCallMemberMri(e,t[0])),secondUser:t.length>1?S.default.getMemberShortNameForConversation(i,l.default.CallingStore.getRemoteCallMemberMri(e,t[1])):void 0}}static getFeatureUnsupportedMessage(e,t){const i=e.count;let a;if(e.firstUser&&(e.firstUser||e.secondUser))switch(i){case 1:a=this._getOneCountFeatureUnsupportedMessage(e.firstUser,t);break;case 2:a=this._getTwoCountFeatureUnsupportedMessage(e,t);break;default:a=this._getMoreCountFeatureUnsupportedMessage(e,t)}else a=this._getDefaultFeatureUnsupportedMessage(t);return a||f.error(m.LogTraceArea.CallingUI,"CallUIUtils.getFeatureUnsupportedMessage Missing localized unsupported message"),a}static announceCameraDirectionState(e){if(!L.default.shouldAnnounceForAccessibility())return;let t;e===o.CameraPosition.Front?t=b.getString("CallControls.CameraFrontAnnouncement"):e===o.CameraPosition.Back&&(t=b.getString("CallControls.CameraBackAnnouncement")),t&&n.Accessibility.announceForAccessibility(t)}static getAccessibilityLabelForStageMode(e){switch(e){case h.StageMode.Grid:case h.StageMode.Manual:return b.getString("CallControls.StageModeGridAnnouncement");case h.StageMode.FocusedScreenShare:return b.getString("CallControls.StageModeFocusedScreenShareAnnouncement");case h.StageMode.Presentation:return b.getString("CallPanel.CallHeaderPresentationViewLabel");case h.StageMode.Speaker:return b.getString("CallControls.StageModeFocusAnnouncement");default:return}}static announceStageMode(e){if(!L.default.shouldAnnounceForAccessibility())return;const t=this.getAccessibilityLabelForStageMode(e);t&&n.Accessibility.announceForAccessibility(t)}static announceMicrophoneState(e,t=!1){if(!L.default.shouldAnnounceForAccessibility())return;const i=this.getAccessibilityLabelForMicrophoneMute(e,t);i&&n.Accessibility.announceForAccessibility(i)}static getAccessibilityLabelForMicrophoneMute(e,t=!1){let i;return t&&e?i=b.getString("CallControls.MicrophoneServerMutedAccessibilityLabel"):t||e?!t&&e&&(i=b.getString("CallControls.MicrophoneMutedAccessibilityLabel")):i=b.getString("CallControls.MicrophoneUnmutedAccessibilityLabel"),i}static announceVideoState(e){L.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(b.getString("CallPreview.ToggleVideoOnLabel")):n.Accessibility.announceForAccessibility(b.getString("CallPreview.ToggleVideoOffLabel")))}static announceHoldState(e){L.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(b.getString("CallControlsOverFlowMenu.HoldCallAnnouncement")):n.Accessibility.announceForAccessibility(b.getString("CallControlsOverFlowMenu.ResumeCallAnnouncement")))}static announceScreenShareState(e){L.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(b.getString("CallControlsOverFlowMenu.ScreenShareStartAnnouncement")):n.Accessibility.announceForAccessibility(b.getString("CallControlsOverFlowMenu.ScreenShareEndAnnouncement")))}static announceSubtitleState(e,t){L.default.shouldAnnounceForAccessibility()&&(t?e?n.Accessibility.announceForAccessibility(b.getString("CallControlsOverFlowMenu.SubtitleStartStateAnnouncement")):n.Accessibility.announceForAccessibility(b.getString("CallControlsOverFlowMenu.SubtitleStopStateAnnouncement")):e?n.Accessibility.announceForAccessibility(b.getString("CallControlsOverFlowMenu.SubtitleBeginStartAnnouncement")):n.Accessibility.announceForAccessibility(b.getString("CallControlsOverFlowMenu.SubtitleBeginStopAnnouncement")))}static _announceIncomingVideoAllowanceState(e){L.default.shouldAnnounceForAccessibility()&&(e?n.Accessibility.announceForAccessibility(b.getString("CallControlsOverFlowMenu.AllowIncomingVideoStopStateAnnouncement")):n.Accessibility.announceForAccessibility(b.getString("CallControlsOverFlowMenu.AllowIncomingVideoStartStateAnnouncement")))}static enableIncomingVideo(e,t){const i=l.default.CallingStore.getVideoOverrides(e);(null==i?void 0:i.clearRemoteStreamOverride(u.VideoOverrideReason.IncomingVideoDisabled))&&(W.default.updateCallTelemetry(e,t,(e=>e.enableIncomingVideoCount())),ee._announceIncomingVideoAllowanceState(!0))}static disableIncomingVideo(e,t){const i=l.default.CallingStore.getVideoOverrides(e);(null==i?void 0:i.setRemoteStreamOverride(u.VideoOverrideReason.IncomingVideoDisabled))&&(i.clearRemoteStreamOverride(u.VideoOverrideReason.AudioOnlyMode),W.default.updateCallTelemetry(e,t,(e=>e.disableIncomingVideoCount())),ee._announceIncomingVideoAllowanceState(!1))}static isIncomingVideoDisabled(e){if(l.default.CallingFeaturesHelper.isIncomingVideoDisabled())return!0;const t=l.default.CallingStore.getVideoOverrides(e);return Boolean(null==t?void 0:t.hasSpecificRemoteStreamOverride(u.VideoOverrideReason.IncomingVideoDisabled))}static getRingingItemDisplayString(e){let t="";if(e.length&&a.intersection(y.default.getCallFullscreenBotMris(),e).length){if(a.intersection(y.default.getCallAudienceBotMriFilter(),e).length)return b.getString("ReactionsStream.CallingTogetherMode");if(a.intersection(y.default.getCallGridViewBotMriFilter(),e).length)return b.getString("ReactionsStream.CallingLargeGridMode")}e.length&&(t=S.default.getDisplayName(e[0])||b.getString("Notifications.UnknownUserShort"));let i="";e.length>1&&(i=S.default.getDisplayName(e[1])||b.getString("Notifications.UnknownUserShort"));let n="";return 1===e.length?n=b.getString("ReactionsStream.CallingParticipant",{participant:t}):2===e.length?n=b.getString("ReactionsStream.CallingTwoParticipants",{firstParticipant:t,secondParticipant:i}):e.length>2&&(n=b.getString("ReactionsStream.CallingMultipleParticipants",{participant:t,count:e.length-1})),n}static getShareScreenIcon(e){return e?D.SkypeIcon.ScreenShareOff:D.SkypeIcon.ScreenShare}static videoTypeForKey(e,t,i){if(e===h.CallStageElementKeys.localUserKey){if(this.renderVideoPreview(t,i))return i.isLandscape?h.LayoutInfoVideoType.Landscape:h.LayoutInfoVideoType.Portrait}else if(e===this.screenShareKey(t)){const i=t.renderedRemoteElementInfo[e];if(i.isStreamAvailable)return i.videoDimensions&&i.videoDimensions.width>i.videoDimensions.height?h.LayoutInfoVideoType.Landscape:h.LayoutInfoVideoType.Portrait}return h.LayoutInfoVideoType.None}static videoAspectRatioForKey(e,t,i){const a=r.default.getS4LCMCFeatures();if(e===h.CallStageElementKeys.localUserKey){if(this.renderVideoPreview(t,i)){const e=t.localVideoDimension||{width:a.videoWidth,height:a.videoHeight};if(e&&e.width>0&&e.height>0)return e.width/e.height}}else if(e===this.screenShareKey(t)){const i=t.renderedRemoteElementInfo[e];if(i.isStreamAvailable&&i.videoDimensions&&i.videoDimensions.width>0&&i.videoDimensions.height>0)return i.videoDimensions.width/i.videoDimensions.height}return 1}static renderVideoPreview(e,t){return e.isProvidingVideo&&!e.ribbonHidden&&t.isVideoTarget}static screenShareKey(e){return e.screenshareElementInfo?e.screenshareElementInfo.key:void 0}static shouldRenderStage(e){return e.stageMode!==h.CallStageViewMode.RibbonOnly&&e.stageMode!==h.CallStageViewMode.None}static getNextScaleFactor(e,t,i){const n=a.range(1,t,(t-1)/i);n.push(t);const o=a.find(n,(t=>t>e));return a.isUndefined(o)?1:o}static adjustedStageViewRect(e){const t=ee.adjustedStageViewBounds(e);return t.x=e.viewRect.x,t}static getSizesForStageElements(e,t,i,a,n,o){const s=i.width*i.height,r=a&&!o||!a&&o;let l;l=r?i.width*(i.height+t-s):i.height*(i.width+t-s);const c=t-l;let d,u;if(a?(u=1/(0===l?t/i.height:i.width),d=1/n.height):(u=1/n.width,d=1/(0===l?t/i.width:i.height)),1===t)return[{width:u,height:d},...e];if(0===l){return new Array(t).fill({width:u,height:d}).concat(e)}for(let t=0;t<l;t++)e.unshift({width:u,height:d});if(c>=1){const t=ee._getNewVirtualStageSize(l,i,r);return ee.getSizesForStageElements(e,c,t,o?!a:a,n,!1)}return e}static _getNewVirtualStageSize(e,t,i){const a=i?t.width:t.height,n=(i?t.height:t.width)-Math.ceil(e/a);return{width:i?a:n,height:i?n:a}}static getStageVideoCount(e,t,i,a){const n=Math.ceil(Math.sqrt(e)),o=Math.min(i,t,n),s=Math.ceil(e/o),r=Math.max(o,s),l=Math.min(o,s);return{width:a?r:l,height:a?l:r}}static isTopStageElement(e,t,i,n){let o=[],s=n;if(0===a.keys(t).length)o=[...i];else{const r={},l=a.invert(t);for(const t of e){const e=l[t.key];if(e&&!a.isUndefined(t.stagePosition)){const o=parseInt(e,10);t.stagePosition===n&&(s=o);a.clone(t).stagePosition=o;const l=t.stagePosition;i[l]&&(r[e]=i[l])}}const c=a.sortBy(a.keys(r));for(const e of c)r[e]&&o.push(r[e])}const r=a.filter(o,(e=>void 0===e)).length>0;if(0===o.length||r)return!1;const l=1/o[0].width;if(o.length>2&&o.length%2==1){const e=a.findIndex(o,{height:1}),t=1/o[0===e?1:0].height;if(e>=0){const i=[e];for(let a=0;a<e;a+=t)i.push(a);for(let a=e+1;a<o.length;a+=t)i.push(a);return a.includes(i,s)}}return s<l}static adjustedStageViewBounds(e){const t=this.getStageTopOffset(e),i=this._getStageBottomOffset(e);return{x:0,y:e.viewRect.y+t,width:e.viewRect.width,height:e.viewRect.height-t-i}}static _getStageBottomOffset(e){return e.useMobileControls?0:h.DesktopCallControlsHeight}static getStageTopOffset(e){return this.getCurrentCallPanelHeaderLayout(e)===h.CallPanelHeaderLayout.Window?h.CallPanelHeaderHeight.window:0}static isInGridStageMode(e){return e===h.StageMode.Grid||e===h.StageMode.Manual}static isInIncomingScreenshareMode(e){return e===h.StageMode.Presentation||e===h.StageMode.FocusedScreenShare}static isInPresentationMode(e){return l.default.CallingFeaturesHelper.isPresentationModeEnabled()&&e===h.StageMode.Presentation}static getScreensharingMode(){return l.default.CallingFeaturesHelper.isPresentationModeEnabled()?h.StageMode.Presentation:h.StageMode.FocusedScreenShare}static getAvailableHeaderModes(e,t){return e?[]:t?[h.CallPanelHeaderLayout.Window,h.CallPanelHeaderLayout.Float]:[]}static isTogetherMode(e){return e===h.StageMode.TogetherMode}static isLargeGrid(e){return e===h.StageMode.LargeGrid}static getRibbonItemTopMargin(e){return h.RibbonSizes.ribbonItemModernStageTopMargin}static getCurrentCallPanelHeaderLayout(e){return e.callPanelHeaderLayout}static _getDefaultFeatureUnsupportedMessage(e){let t;if(e===$.CallReactions)t="CallPanel.ReactionsShortMessageDefault";return t?b.getString(t):void 0}static _getOneCountFeatureUnsupportedMessage(e,t){let i;if(t===$.CallReactions)i="CallPanel.ReactionsShortMessage1User";return i?b.getString(i,{firstUser:e}):void 0}static _getTwoCountFeatureUnsupportedMessage(e,t){let i;if(t===$.CallReactions)i="CallPanel.ReactionsShortMessage2Users";return i?b.getString(i,{firstUser:e.firstUser,secondUser:e.secondUser}):void 0}static _getMoreCountFeatureUnsupportedMessage(e,t){let i;if(t===$.CallReactions)i="CallPanel.ReactionsShortMessageMoreUsers";return i?b.getString(i,{count:e.count-2,firstUser:e.firstUser,secondUser:e.secondUser}):void 0}static _fallbackStageParticipantKey(e,t,i){let n;const o=a.keys(e),s=a.sortBy(a.filter(a.map(o,(t=>e[t])),(e=>e.isStreamAvailable))).map((e=>e.key)),r=a.last(s);if(r)n=r;else if(!t||i===h.CallStageViewMode.StageAndRibbon&&c.CallingCapabilities.floatableResizableVideoPreviewSupported())if(o.length){const t=a.find(o,(t=>{const i=e[t];return i&&!a.isUndefined(i.participantState)&&d.default.isParticipantStateConnected(i.participantState)}));n=t||o[0]}else n=h.CallStageElementKeys.localUserKey;else n=h.CallStageElementKeys.localUserKey;if(f.log(m.LogTraceArea.CallingUI,"CallStageView._fallbackStageParticipantKey: "+x.mriOrId(n)),n===h.CallStageElementKeys.localUserKey)return n;return e[n]?n:void 0}static _isStreamAvailable(e,t,i,a,n,o){if(!e)return!1;const s=!(!a||!l.default.RemoteStreamHelper.validateStream(i,e,a,n))?a:l.default.RemoteStreamHelper.getAvailableStream(i,e,t,o,n);return!!s&&s.isAvailable}static _streamDimensions(e,i,a,n){return e&&l.default.RemoteStreamHelper.getStreamSize(a,e,i,n)||t.DummyVideoSize}static getReactionItems(e){const t=ee.getEmoticonReactionKey(e),i=(0,C.default)().getCustomReactions(),n=a.uniq([t,...i].reverse());return a.map(n,(e=>({key:e,type:A.default.isAnimationReaction(e)?h.ReactionsItemType.Animation:h.ReactionsItemType.Emoticon})))}static getEmoticonReactionKey(e){const t=r.default.getS4LCMCFeatures();if(e)return t.callCelebrationConfig.callCelebrateButtonKey;const i=(0,C.default)();if(i.hasBeenCustomized()){const e=i.getCurrentReactions();return 0===e.length?i.getCustomReactions()[0]:e[0]}return t.callReactionButtonKey}static canHandBeLoweredForParticipant(e,t){const i=l.default.CallingStore.getCallConversationMri(e),a=i&&(0,g.default)().getConversation(i);return l.default.CallingStore.isHandRaisedForMri(t,e)&&(!(0,T.isModerated)(a)||(0,T.isCurrentUserAdminInModeratedGroup)(a)||v.default.isMyMri(t))}static announceLoweredHandState(e,t){if(!L.default.shouldAnnounceForAccessibility())return;let i;e?i=b.getString("CallPanel.HandLowered"):t&&(i=b.getString("CallPanel.HandLoweredOther",{displayName:t})),i&&n.Accessibility.announceForAccessibility(i)}static getReactionButtonType(e,t){let i=q.Heart;return p.default.getCelebrationData(e,t)&&(i=q.Celebration),i}static getReactionCommand(e,t,i,a){let n;switch(e){case q.Celebration:n=new P.SendReactionCommand(h.ReactionsItemType.Animation,"cake",t,i,a);break;case q.Heart:n=new P.SendReactionCommand(h.ReactionsItemType.Emoticon,"heart",t,i,a)}if(n.canExecute())return n}static getReactionButtonDescriptors(e,t){let i;switch(e){case q.Celebration:i={key:h.CallControlsOverflowItem.CelebrationAnimation,icon:D.SkypeIcon.Birthday,title:b.getString("CallControlsOverFlowMenu.CelebrateBirthday"),accessibilityLabel:b.getString("CallControlsOverFlowMenu.CelebrateBirthday"),onPress:()=>t.execute()};break;case q.Heart:i={key:h.CallControlsOverflowItem.HeartReaction,icon:D.SkypeIcon.HeartOutline,title:b.getString("CallControlsOverFlowMenu.ReactWithHeart"),accessibilityLabel:b.getString("CallControlsOverFlowMenu.ReactWithHeart"),onPress:()=>t.execute()}}return i}static getStageModeItemTitle(e,t){const i=(t?X:Q)[this.displayedStageMode(e)];return i?b.getString(i):(f.error(m.LogTraceArea.CallingUI,"No title found for stage mode: "+h.StageMode[e]),"")}static getIconForStageMode(e,t){const i=(t?J:Z)[this.displayedStageMode(e)];return i||f.error(m.LogTraceArea.CallingUI,"No icon found for stage mode: "+h.StageMode[e]),i}static displayedStageMode(e){return e===h.StageMode.Manual?h.StageMode.Grid:e}static getAvailableMenuItems(e,t,i,a){const n=H.default.getAvailableStageModes(e).reduce(((e,t,a)=>(i&&0!==a&&e.push({type:h.LayoutPickerMenuItemType.Divider}),e.push({type:ee._stageModeToLayoutPickerMenuItemType(t)}),e)),[]),o=r.default.getS4LCMCFeatures(),s=U.isOneOnOneConversation(a);o.enableAudioParticipantsOnTheStage&&!s&&(n.push({type:h.LayoutPickerMenuItemType.Divider}),n.push({type:h.LayoutPickerMenuItemType.OnlyVideoOnTheStage,isNew:this._isOnlyVideoOnTheStageNew(o),markAsSeen:this._markOnlyVideoOnTheStageAsSeen}));const l=H.default.getStageMode(e);this.isInGridStageMode(l)&&i&&(n.push({type:h.LayoutPickerMenuItemType.Divider}),n.push({type:h.LayoutPickerMenuItemType.SelfInTheGridToggle})),t&&(n.push({type:h.LayoutPickerMenuItemType.Divider}),n.push({type:h.LayoutPickerMenuItemType.Fullscreen}));const c=ee.getAvailableHeaderModes(i,s);return c.length&&n.push({type:h.LayoutPickerMenuItemType.Divider}),c.forEach((e=>{n.push({type:ee._headerModeToLayoutPickerMenuItemType(e)})})),n}static getAvailableMenuItemsV2(e,t,i,a){const n=H.default.getAvailableStageModesV2(e).reduce(((e,t,a)=>(i&&0!==a&&e.push({type:h.LayoutPickerMenuItemType.Divider}),e.push({type:ee._stageModeToLayoutPickerMenuItemType(t)}),e)),[]),o=r.default.getS4LCMCFeatures(),s=U.isOneOnOneConversation(a),l=H.default.getStageMode(e),c=!s&&this.isInGridStageMode(l),d=this.isInGridStageMode(l),u=o.enableTopTrayHiding;if((c||d||u)&&n.push({type:h.LayoutPickerMenuItemType.Divider}),c&&n.push({type:h.LayoutPickerMenuItemType.OnlyVideoOnTheStage,isNew:this._isOnlyVideoOnTheStageNew(o),markAsSeen:this._markOnlyVideoOnTheStageAsSeen}),d&&n.push({type:h.LayoutPickerMenuItemType.SelfInTheGridToggle}),u){const t=H.default.isTopTrayHidden(e)?h.LayoutPickerMenuItemType.ShowPeopleAtTop:h.LayoutPickerMenuItemType.HidePeopleAtTop;n.push({type:t})}if(t&&(n.push({type:h.LayoutPickerMenuItemType.Divider}),n.push({type:h.LayoutPickerMenuItemType.Fullscreen})),o.enableCallingThemeSwitch&&o.enableLightThemeOnCallStage&&!N.default.isDarkTheme()){n.push({type:h.LayoutPickerMenuItemType.Divider});const e=this.isLightTheme()?h.LayoutPickerMenuItemType.SwitchToDarkThemeStage:h.LayoutPickerMenuItemType.SwitchToLightThemeStage;n.push({type:e})}return n}static _isOnlyVideoOnTheStageNew(e){return e.enableAudioParticipantsOnTheStageAsNew&&!!j.default.getUserPreferencesLocal().showOnlyVideoOnTheStageAsNew}static _stageModeToLayoutPickerMenuItemType(e){switch(e){case h.StageMode.Speaker:return h.LayoutPickerMenuItemType.StageModeSpeaker;case h.StageMode.FocusedScreenShare:return h.LayoutPickerMenuItemType.StageModeFocusedScreenShare;case h.StageMode.Grid:return h.LayoutPickerMenuItemType.StageModeGrid;case h.StageMode.Manual:return h.LayoutPickerMenuItemType.StageModeManual;case h.StageMode.Presentation:return h.LayoutPickerMenuItemType.StageModePresentation;case h.StageMode.TogetherMode:return h.LayoutPickerMenuItemType.StageModeTogetherMode;case h.StageMode.LargeGrid:return h.LayoutPickerMenuItemType.StageModeLargeGrid}}static layoutPickerMenuItemTypeToStageMode(e){switch(e){case h.LayoutPickerMenuItemType.StageModeSpeaker:return h.StageMode.Speaker;case h.LayoutPickerMenuItemType.StageModeFocusedScreenShare:return h.StageMode.FocusedScreenShare;case h.LayoutPickerMenuItemType.StageModeGrid:return h.StageMode.Grid;case h.LayoutPickerMenuItemType.StageModeManual:return h.StageMode.Manual;case h.LayoutPickerMenuItemType.StageModePresentation:return h.StageMode.Presentation;case h.LayoutPickerMenuItemType.StageModeTogetherMode:return h.StageMode.TogetherMode;case h.LayoutPickerMenuItemType.StageModeLargeGrid:return h.StageMode.LargeGrid;default:return}}static _headerModeToLayoutPickerMenuItemType(e){switch(e){case h.CallPanelHeaderLayout.Mobile:return h.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile;case h.CallPanelHeaderLayout.Float:return h.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat;case h.CallPanelHeaderLayout.Window:return h.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow;case h.CallPanelHeaderLayout.None:return h.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone}}static layoutPickerMenuItemTypeToHeaderMode(e){switch(e){case h.LayoutPickerMenuItemType.CallPanelHeaderLayoutMobile:return h.CallPanelHeaderLayout.Mobile;case h.LayoutPickerMenuItemType.CallPanelHeaderLayoutFloat:return h.CallPanelHeaderLayout.Float;case h.LayoutPickerMenuItemType.CallPanelHeaderLayoutWindow:return h.CallPanelHeaderLayout.Window;case h.LayoutPickerMenuItemType.CallPanelHeaderLayoutNone:return h.CallPanelHeaderLayout.None;default:return}}static shouldShowCallParticipantPinOption(e,t){var i;return r.default.getS4LCMCFeaturesNoSubscription().enableCallParticipantsPinning&&j.default.getNewCallScreenDesignEnabled()&&this.isInGridStageMode(H.default.getStageMode(t))&&!this.isCallParticipantPinned(e,t)&&G.default.getStageCapacity(t)>((null===(i=z.default.getPinnedParticipants(t))||void 0===i?void 0:i.length)||0)}static shouldShowCallParticipantUnpinOption(e,t){return r.default.getS4LCMCFeaturesNoSubscription().enableCallParticipantsPinning&&j.default.getNewCallScreenDesignEnabled()&&this.isCallParticipantPinned(e,t)}static isCallParticipantPinned(e,t){return!!e&&z.default.isParticipantPinned(e,t)}static isPortraitVideo(e){return e&&e.height>e.width}static getUserOptionsAccessibilityLabel(e,t,i){if(!e)return;let a;return a=t?b.getString("CallPanel.DisplayNameWithMicrophoneMuted",{displayName:e}):b.getString("SkypeUserListItem.DisplayNameLabel",{displayName:e}),i&&(a=b.getString("CallPanel.DisplayNameWithHandRaised",{prefix:a})),a}static _getRoundedValueByRatio(e,t,i){const a=t&&t.height&&t.width?t.width/t.height:2/3;return Math.round(i?e/a:e*a)}static getLocalPreviewMobilesShape(e){return e&&e.height&&e.width&&e.width>=e.height?{height:ee._getRoundedValueByRatio(Y,e,!0),width:Y}:{height:Y,width:ee._getRoundedValueByRatio(Y,e)}}static areMoreAudioOutputsAvailable(e,t,i){if(!t.earpieceHiddenForVideoCalls)return f.log(m.LogTraceArea.CallingUI,"CallPanelHeader.areMoreAudioRoutesAvailable - ECS disabled.  Showing all audio routes."),!0;f.log(m.LogTraceArea.CallingUI,`CallPanelHeader.areMoreAudioRoutesAvailable video: ${e} availableRoutes: ${i}`);let a=i.length;return e&&i.includes(s.default.AudioOutputEarpiece)&&a--,a>1}}ee._ribbonAddTimeValue=1,ee._markOnlyVideoOnTheStageAsSeen=()=>{j.default.setUserPreferencesLocal({showOnlyVideoOnTheStageAsNew:!1})},t.CallUIUtils=ee,t.default=ee},178536:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StartCallOptionAction=void 0;const a=i(496486),n=i(148540),o=i(397691),s=i(598925),r=i(994224),l=i(568580),c=i(598925),d=i(47447),u=i(671830),h=i(539549),p=i(220076),g=i(746096),C=i(436237),S=i(518460),m=i(941209),y=i(914976),f=i(172758);var b;!function(e){e[e.call=0]="call",e[e.promptForAddresses=1]="promptForAddresses",e[e.promptForSkypeMri=2]="promptForSkypeMri",e[e.failed=3]="failed"}(b=t.StartCallOptionAction||(t.StartCallOptionAction={}));const _=new class{startCallOrMaybePromptHelper(e,t,i,r,h,_,T,v){if(!this._releaseAssert(!!e.skypeMri||!a.isEmpty(e.phones),"CallOptionsHelper.startCallOrMaybePromptHelper","Must pass skypeMri or phones"))return l.default.generateCallingError("",s.CallAction.Start,"Must pass skypeMri or phones",n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,c.CallValidationFailureReason.InvalidParameters,v),o.Resolved();if(!this._releaseAssert(!e.skypeMri||l.default.isValidCallingMri(e.skypeMri),"CallOptionsHelper.startCallOrMaybePromptHelper","If skypeMri is passed, it must be valid for calling"))return l.default.generateCallingError("",s.CallAction.Start,"If skypeMri is passed, it must be valid for calling",n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,c.CallValidationFailureReason.InvalidParameters,v),o.Resolved();const w=(t,a,n)=>{if(!t)return;const o=this._activeCallIdForMri(t,n);return o?e.showCallPreview?r(t,o,a):i(t,o,a):void 0},I=(i,a)=>{w(i,a,v)||(e.initiatingConversation&&u.isEncryptedThread(e.initiatingConversation)&&!u.isEncryptedThread(i)?T(a).then((()=>t(i,a))):t(i,a)),M()},P=e=>I(e,!1),M=()=>{e.onCallStartedAnsweredOrJoined&&e.onCallStartedAnsweredOrJoined()},k=e=>{I(e,!1)};if(w(e.skypeMri,e.userIntent===c.StartCallOrMaybePromptUserIntent.Video,v))return M(),o.Resolved();const A=[!e.skypeMri||u.isThread(e.skypeMri)?o.Resolved(void 0):f.default.getFullUserProfileByMriAsync(e.skypeMri),d.CallingCapabilities.encryptedCallingSupported()&&e.skypeMri&&u.isSkypeIdMri(e.skypeMri)?p.getEstablishedEncryptedThreadId(e.skypeMri):o.Resolved(void 0)];return o.all(A).then((([t,i])=>{var a;let n=m.mergeMriProfileAndExtraPhones(e.skypeMri,void 0,t?t.phones:e.phones);const o=e.skypeMri?S.default.getContactByCorrespondingMri(e.skypeMri):void 0;n=o?m.mergeMriProfileAndExtraPhones(void 0,n,o.phones):n;const s=this._callingOptionsHelper(e.skypeMri,n,e.userIntent,i);switch(s.action){case b.failed:C.error(g.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper failed. skypeMri: "+y.mriOrId(e.skypeMri)+", allPhones: "+n+", userIntent: "+e.userIntent);break;case b.call:if(!s.callMri){C.error(g.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper returned call action with no mri.");break}I(s.callMri,!!s.withVideo);break;case b.promptForSkypeMri:if(!e.skypeMri){C.error(g.LogTraceArea.Calling,"CallOptionsHelper._callingOptionsHelper promptForSkypeMri called with no mri.");break}h(u.isPhoneMri(e.skypeMri)?void 0:e.skypeMri,i,!!s.suppressPromptVideoOption,I,P,k,n,e.showSmsOption);break;case b.promptForAddresses:const o=e.skypeMri?u.getPhoneNumberFromMri(e.skypeMri):void 0,r=o?S.default.getContactByPhoneNumber(o):void 0,l=r?r.getDisplayName():t?t.getDisplayName():"",c=null===(a=null==t?void 0:t.emails)||void 0===a?void 0:a.map((e=>e.address));_(l,n,c)}}))}test_callingOptionsHelper(e,t){return this._callingOptionsHelper(e.skypeMri,e.phones,e.userIntent,t)}_callingOptionsHelper(e,t,i,n){const o=a.isEmpty(t)?0:t.length;return!e||u.isPhoneMri(e)?o&&i!==c.StartCallOrMaybePromptUserIntent.Video?i===c.StartCallOrMaybePromptUserIntent.Generic?{action:b.promptForAddresses}:1===o?{action:b.call,withVideo:!1,callMri:u.sanitizeMri(t[0].number,u.Namespaces.PSTN)}:{action:e?b.promptForSkypeMri:b.promptForAddresses}:{action:b.failed}:u.isThread(e)?o?{action:b.failed}:i===c.StartCallOrMaybePromptUserIntent.Generic?{action:b.promptForSkypeMri}:{action:b.call,withVideo:i===c.StartCallOrMaybePromptUserIntent.Video,callMri:e}:u.isUserMri(e)?i===c.StartCallOrMaybePromptUserIntent.Generic?{action:b.promptForSkypeMri}:i===c.StartCallOrMaybePromptUserIntent.Video?{action:b.call,withVideo:!0,callMri:e}:0!==o||n?{action:b.promptForSkypeMri,suppressPromptVideoOption:!0}:{action:b.call,withVideo:!1,callMri:e}:{action:b.failed}}_releaseAssert(e,t,i){return!!e||(C.error(g.LogTraceArea.Calling,y.dev_unknownOmit(t)+": "+y.dev_unknownOmit(i)),!1)}_activeCallIdForMri(e,t){if(!e)return;if(u.isThread(e)){const i=(0,h.default)().getConversation(e);if(!i){const i="CallOptionsHelper._activeCallIdForMri: Didn't find conversation";return C.warn(g.LogTraceArea.Calling,i+" "+y.mriOrId(e)+" causeId: "+t),void l.default.generateCallingError("",s.CallAction.AnswerOrJoin,i,n.TerminatedReason.BadRequest,n.FailureType.CallSetupFailed,c.CallValidationFailureReason.ConversationNotFound,t)}const a=i.validLiveState();return a&&a.conversationId}const i=r.default.CallingStore.getCallIdsForConversationMri(e);return a.head(i)}};t.default=_},497081:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DesktopSecondaryCallControlsManager=t.OverflowMenuCommands=void 0;const a=i(496486),n=i(480200),o=i(861253),s=i(853374);var r,l;!function(e){e.OnAddToCall="OnAddToCall",e.OnShowParticipants="OnShowParticipants",e.OnShowAVSettings="OnShowAVSettings",e.OnShowAudioSettings="OnShowAudioSettings",e.ShareScreen="ShareScreen",e.ShareScreenAndSounds="ShareScreenAndSounds",e.ConfirmStopSharing="ConfirmStopSharing",e.StopSharing="StopSharing",e.SwitchScreen="SwitchScreen",e.ScreenShareControl="ScreenShareControl",e.StopScreenShareControl="StopScreenShareControl",e.HoldCall="HoldCall",e.ResumeCall="ResumeCall",e.StartRecording="StartRecording",e.StopRecording="StopRecording",e.StartCaptions="StartCaptions",e.StopCaptions="StopCaptions",e.LiveCaptions="LiveCaptions",e.SkypeTranslate="SkypeTranslate",e.StopSkypeTranslate="StopSkypeTranslate",e.Snap="Snapshot",e.React="React",e.CustomReact="CustomReact",e.EnableIncomingVideo="EnableIncomingVideo",e.DisableIncomingVideo="DisableIncomingVideo",e.Blur="BlurBackground",e.Unblur="UnblurBackground",e.CallStats="CallStats",e.BackgroundEffectsSettings="BackgroundEffectsSettings",e.MuteEveryone="MuteEveryone",e.RaiseHand="RaiseHand",e.LowerHand="LowerHand",e.ChangeTogetherModeBackground="ChangeTogetherModeBackground",e.BingBackgrounds="BingBackgrounds",e.Invite="Invite",e.TwinCam="TwinCam",e.StopTwinCam="StopTwinCam"}(r=t.OverflowMenuCommands||(t.OverflowMenuCommands={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(l||(l={}));t.DesktopSecondaryCallControlsManager=class{configure(e){(0,o.default)(e,this._input)||(this._input=e,this._computeControlPlacement())}_computeControlPlacement(){if(this._input.controlsType===n.CallControlsType.DesktopMinSmallest){this._leftControls=[this._input.leftControlForDesktopMinSmallest];const e=a.flatMap(this._input.idealLeftControls,(e=>this._callControlKeyToOverflowMenuCommands(e.type))),t=a.flatMap(this._input.idealRightControls,(e=>this._callControlKeyToOverflowMenuCommands(e.type)));this._overflowControls=e.concat(t).concat(this._input.idealOverflowControls);const i=this._callControlKeyToOverflowMenuCommands(this._input.leftControlForDesktopMinSmallest);return 1===i.length&&(this._overflowControls=a.filter(this._overflowControls,(e=>e!==i[0]))),void(this._rightControls=this._overflowControls.length>0?[n.CallControlsKeys.Overflow]:[])}const e=this._getCapacity(this._input.controlsType,l.Left),t=this._getCapacity(this._input.controlsType,l.Right),i=this._restrictControls(this._input.idealLeftControls,e),o=this._restrictControls(this._input.idealRightControls,t);this._leftControls=a.map(i.controlsToKeep,(e=>e.type)),this._rightControls=a.map(o.controlsToKeep,(e=>e.type));const s=a.map(i.controlsForOverflow,(e=>e.type)),r=a.map(o.controlsForOverflow,(e=>e.type));var c=a.flatMap(s,(e=>this._callControlKeyToOverflowMenuCommands(e))),d=a.flatMap(r,(e=>this._callControlKeyToOverflowMenuCommands(e)));c=a.filter(c,(e=>-1===this._input.idealOverflowControls.indexOf(e))),d=a.filter(d,(e=>-1===this._input.idealOverflowControls.indexOf(e))),this._overflowControls=c.concat(d).concat(this._input.idealOverflowControls)}getLeftControls(){return this._leftControls}getRightControls(){return this._rightControls}getOverflowControls(){return this._overflowControls}_restrictControls(e,t){for(var i=a.map(e,(e=>({control:e,delete:!1}))),n=e.length;n>t;){const e=a.filter(i,(e=>!e.delete)),o=a.max(a.map(e,(e=>e.control.priority)));for(let e=0;e<i.length&&!(n<=t);e++)i[e].delete||i[e].control.priority!==o||(i[e].delete=!0,--n)}const o=a.filter(i,(e=>!e.delete)),s=a.filter(i,(e=>e.delete));return{controlsToKeep:a.map(o,(e=>e.control)),controlsForOverflow:a.map(s,(e=>e.control))}}_callControlKeyToOverflowMenuCommands(e){switch(e){case n.CallControlsKeys.Participants:return this._input.isOneOnOneCall?[r.OnAddToCall]:[r.OnShowParticipants];case n.CallControlsKeys.ScreenShare:const t=[this._input.isScreenShareActive?r.StopSharing:r.ShareScreen];return this._input.isScreenShareActive&&(this._input.numberAvailableScreens>1||this._input.windowSharingEnabled)&&t.push(r.SwitchScreen),t;case n.CallControlsKeys.ScreenShareControl:return this._input.canRequestScreenShareControl?[r.ScreenShareControl]:[r.StopScreenShareControl];case n.CallControlsKeys.RaiseHand:return[r.RaiseHand];case n.CallControlsKeys.LowerHand:return[r.LowerHand];case n.CallControlsKeys.ChangeScene:return[r.ChangeTogetherModeBackground];case n.CallControlsKeys.Record:if(this._input.allowRecording){if(!this._input.isRecording&&this._input.connectedAndNotOnHoldCallId===this._input.callId)return[r.StartRecording];if(this._input.isCallRecordingInitiator)return[r.StopRecording]}return[];case n.CallControlsKeys.ReactionsDrawer:return[r.React];case n.CallControlsKeys.ReactionsPopover:return[r.CustomReact];case n.CallControlsKeys.Moments:return[r.Snap];case n.CallControlsKeys.ShareLink:return[r.Invite];case n.CallControlsKeys.TwinCam:return[r.TwinCam];case n.CallControlsKeys.StopTwinCam:return[r.StopTwinCam];case n.CallControlsKeys.LiveCaptions:return this._input.allowLiveCaptions&&this._input.connectedAndNotOnHoldCallId===this._input.callId?[r.LiveCaptions]:[];case n.CallControlsKeys.SkypeTranslate:return this._input.allowSkypeTranslate&&this._input.connectedAndNotOnHoldCallId===this._input.callId?this._input.isSkypeTranslating?[r.StopSkypeTranslate]:[r.SkypeTranslate]:[];case n.CallControlsKeys.Mic:case n.CallControlsKeys.MicQuickSettings:case n.CallControlsKeys.Video:case n.CallControlsKeys.VideoQuickSettings:case n.CallControlsKeys.Dialpad:case n.CallControlsKeys.EndCall:case n.CallControlsKeys.Overflow:case n.CallControlsKeys.Chat:return[];default:return s.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsKeys element")}}_getCapacity(e,t){switch(e){case n.CallControlsType.Mobile:return Number.MAX_SAFE_INTEGER;case n.CallControlsType.Default:return 5;case n.CallControlsType.DesktopMin:return t===l.Right?5:4;case n.CallControlsType.DesktopMinStageTwo:return t===l.Right?5:3;case n.CallControlsType.DesktopMedium:return 2;case n.CallControlsType.DesktopMinSmallest:return 1;default:return s.default.switchStatementExhaustiveChecking(e,"Missing case for an CallControlsType element")}}}},936540:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(994224),n=i(671830),o=i(539549),s=i(651129),r=i(759799),l=i(746096),c=i(436237),d=i(789871),u=i(735426),h=i(853374);t.default=class{static startOrAddPstnCall(e,t,i,r,p,g,C){const S=d.default.getPhoneNumberOrigin()||l.NavigationCallOrigin.PstnDialpad;c.track(new u.StartCall(l.NavigationCallOrigin[S])),i&&s.default.setDefaultPstnDestinationCountryCode(i);const m=h.default.newCauseId();if(t)this._startEmergencyPstnCall(e,m,i,r);else{let t;if(e&&(t=n.sanitizeMri(e,n.Namespaces.PSTN)),t)if(p&&g){const e=(0,o.default)().getConversation(g);let i=[];e&&(i=e.getMemberMris()),a.default.CallParticipantUtils.addUsersToCallOrRing([t],p,g,i,l.NavigationAddToCallOrigin.Unknown)}else C&&a.default.PstnUtils.setCallDTMF(t,C),a.default.CallNavigationHelper.startCall({conversationMri:t,withVideo:!1,origin:d.default.getPhoneNumberOrigin()||l.NavigationCallOrigin.PstnDialpad},m),d.default.resetPhoneNumberOrigin()}}static _startEmergencyPstnCall(e,t,i,n){i?n?(c.track(new u.EmergencyCall),c.log(l.LogTraceArea.GenericUnsafe,"Placing emergency call to "+s.default.maskPhoneNumber(e)+", destination country: "+i),r.default.getEmergencyContentForNumberNoSubscription(n)&&c.track(new u.E911EmergencyContentEvent),a.default.CallNavigationHelper.startEmergencyCall(n,i,t).catch((e=>{c.warn(l.LogTraceArea.GenericUnsafe,"Failed to place emergency call, reason: "+JSON.stringify(e)),c.track(new u.EmergencyCallFailed)}))):c.warn(l.LogTraceArea.GenericUnsafe,"Refusing to place emergency call, reason: no information about phone number suffix"):c.warn(l.LogTraceArea.GenericUnsafe,"Refusing to place emergency call, reason: no information about phone number country")}}},651129:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(174958),n=i(496486),o=i(889391),s=i(671830),r=i(746096),l=i(436237),c=i(178735),d=i(46929),u=i(772136),h=i(735426),p=i(404057),g={a:2,b:2,c:2,d:3,e:3,f:3,g:4,h:4,i:4,j:5,k:5,l:5,m:6,n:6,o:6,p:7,q:7,r:7,s:7,t:8,u:8,v:8,w:9,x:9,y:9,z:9,å:2,ä:2,á:2,ā:2,č:2,é:3,ē:3,í:4,ī:4,ģ:4,ķ:5,ļ:5,ö:6,ó:6,õ:6,ø:6,ņ:6,š:7,ü:8,ú:8,ū:8,ž:9,а:2,б:2,в:2,г:2,д:3,е:3,ж:3,з:3,и:4,й:4,к:4,л:4,м:5,н:5,о:5,п:5,р:6,с:6,т:6,у:6,ф:7,х:7,ц:7,ч:7,ш:8,щ:8,ъ:8,ы:8,ь:9,э:9,ю:9,я:9};t.default=class{static isEmergencyNumber(e){const t=o.default.getS4LEntitlementFeatures().SCE.Dialpad.EmergencyCall.allowedNumbers;return!!e.suffix&&n.includes(t,e.suffix)}static getEmergencyCallingCountrySubstitute(e){const t=this.getDefaultEmergencyCallingCountry();if(t&&e!==t&&this.allowedEmergencyCallingDestinationCountry(t))return u.default.getCountryByCode(t)}static isCallableNumber(e){return e.emergency?this.allowedEmergencyCallingDestinationCountry(n.toLower(e.countryCode)):!!e.prefix&&!!e.suffix&&e.suffix.length>1}static isValidPhoneNumberInput(e){return!!e&&/^\+?[\d\s]*(,[\d\s\*\#,]*$|$)/.test(e)}static getDefaultEmergencyCallingCountry(){return d.default.getEmergencyCallDefaultCountry()}static allowedEmergencyCallingDestinationCountry(e){return n.includes(o.default.getS4LEntitlementFeatures().SCE.Dialpad.EmergencyCall.allowedCountries,e)}static normalizePhoneNumber(e){if(!e)return"";let t,i=0;const n=o.default.getS4LEntitlementFeatures().SCE.Dialpad.NumberInput.decodeHtmlMaxIterations;try{do{t=e,e=decodeURIComponent(e),i++}while(t!==e&&i<n)}catch(t){l.error(r.LogTraceArea.DialerPanel,"[DialerPhoneNumberUtils] Failed to decode input number: "+a.pii.Omit(e))}let s=e.replace(/[^\d\+\*\#,]/g,"");return s.lastIndexOf("+")===s.length-1?"+":(s=s.replace(/(?!^)\+/g,""),s=s.replace(/^00/,"+"),"00"===s?"+":s)}static filterPhoneNumberChar(e,t){return t&&/[\d\+\*\#,]/.test(t)&&this.isValidPhoneNumberInput(e+t)?t:""}static getCountryDestinationPrefixIndex(e){const t={};let i=-1,a=0;return n.each(e,((e,n)=>{t[e.countryCode]||(t[e.countryCode]=[],++a),t[e.countryCode].push(n),i<e.countryCode&&(i=e.countryCode)})),{index:t,indexSize:a,maxLength:i>=0?i.toString().length:0}}static getFormattedPhoneNumber(e,t){if(!t)return e;const i=t.length+1;return e.length===i?e:e.substring(0,i)+" "+e.substring(i)}static isE164Format(e){return 0===e.indexOf("+")}static getE164FormattedPhoneNumber(e,t){return e?"+"+e+(t||""):""}static getPhoneNumberSuffix(e,t){return t?this.isE164Format(e)?e.slice(t.length+1):e:n.trimStart(e,"+")}static getPhoneNumberPrefixCountry(e,t){if(!e)return;const i=t.index[n.parseInt(e)];if(!i||0===i.length)return;if(1===i.length)return u.default.getCountryByCode(i[0]);const a=o.default.getS4LEntitlementFeatures().SCE.Dialpad.CountryCodeToCountryDefault[e];return a?u.default.getCountryByCode(a.toLowerCase()):u.default.getCountryByCode(i[0])}static getPhoneNumberPrefix(e,t){if(e.length<2||0!==e.indexOf("+"))return;if(!t)return;const i=t.maxLength+1;for(let a=2;a<=i;++a){const i=n.toInteger(e.substring(1,a));if(t.index[i])return i.toString();if(n.includes(o.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling.TestPrefixes,i))return i.toString();if(n.includes(o.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling.NonGeographicPrefixes,i))return i.toString()}}static getDefaultPstnDestinationCountry(){const e=this._getStoredDefaultPstnDestinationCountryCode()||this._getGeoIpCountryCode();if(e)return u.default.getCountryByCode(e)}static setDefaultPstnDestinationCountryCode(e){const t=this._getStoredDefaultPstnDestinationCountryCode();if(t!==e){const i=this._getGeoIpCountryCode();void 0===t&&e!==i&&l.track(new h.DefaultCountryStored(i,e)),c.default.setUserPreferencesLocal({defaultPstnDestinationCountryCode:e})}}static _getStoredDefaultPstnDestinationCountryCode(){return c.default.getUserPreferencesLocal().defaultPstnDestinationCountryCode}static _getGeoIpCountryCode(){var e;return(null===(e=o.default.getHeaders().CountryCode)||void 0===e?void 0:e.toLowerCase())||""}static getPhoneNumberMri(e){return s.sanitizeMri(e.E164,s.Namespaces.PSTN)}static phoneNumberToString(e){return"PhoneNumber(input: "+this.maskPhoneNumber(e.inputValue)+", E164: "+this.maskPhoneNumber(e.E164)+", prefix: "+e.prefix+", suffix: "+this.maskPhoneNumber(e.suffix)+", country: "+e.countryCode+", callable: "+e.callable+", emergency: "+e.emergency+", searchable: "+e.searchable+", fcp: "+e.forceChangedPrefix+")"}static maskPhoneNumber(e){return e?a.pii.Omit(e):""}static containsNonGeographicOrTestPrefixes(e){const t=o.default.getS4LEntitlementFeatures().SCE.Dialpad.Calling;if(t){const i=t.NonGeographicPrefixes?t.NonGeographicPrefixes:[],a=t.TestPrefixes?t.TestPrefixes:[],o=i.concat(a);return n.some(o,(t=>0===e.indexOf("+"+t)))}return!1}static isCursorPlacedInPrefixArea(e,t){if(!this._isSingleCursorPlaced(t))return!1;const i=e.inputValue.length-(e.suffix?e.suffix.length:0);return t.start<i}static mapKeypadLettersToNumbers(e){const t=[];let i;e=p.default.deburrLowerCase(e);for(const a of e)i=g[a],i||0===i?t.push(i):t.push(a);return t.join("")}static _isSingleCursorPlaced(e){return e.start===e.end}}},269965:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getStringFromKeyCode=t.isNumpadNumberKeyCode=t.isNumberKeyCode=t.isDialPadKeyCode=void 0;const a=i(547126),n=48,o=57,s=96,r=105;function l(e){return n<=e&&e<=o}function c(e){return s<=e&&e<=r}t.isDialPadKeyCode=function(e,t){return t?e===a.default.THREE||e===a.default.EIGHT:l(e)||c(e)||42===e||106===e||35===e||e===a.default.COMMA},t.isNumberKeyCode=l,t.isNumpadNumberKeyCode=c,t.getStringFromKeyCode=function(e,t){return t?e===a.default.THREE?e=35:e===a.default.EIGHT&&(e=42):c(e)?e-=n:106===e?e=42:e===a.default.COMMA&&(e=44),String.fromCharCode(e)}},805581:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(174958),o=i(889391),s=i(598925),r=i(539549),l=i(746096),c=i(438891),d=i(436237),u=i(733754),h=i(178735),p=i(46929),g=i(914976),C=i(458666);t.default=new class{getCallRecorderBotMri(){return h.default.getUserPreferencesLocal().callRecorderBotMriOverride||o.default.getS4LCMCFeatures().callRecorderBotMri}getCallRecorderBotMriFilter(){const e=h.default.getUserPreferencesLocal().callRecorderBotMriOverride,t=o.default.getS4LCMCFeatures().callRecorderBotMriFilter;return e?[e,...t]:t}setCallRecorderBotOverride(e){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.setCallRecorderBotOverride mri: "+g.mriOrId(e)),h.default.setUserPreferencesLocal({callRecorderBotMriOverride:e})}clearCallRecorderBotOverride(){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.clearCallRecorderBotOverride"),h.default.setUserPreferencesLocal({callRecorderBotMriOverride:void 0})}getCallTranslatorBotMri(){return h.default.getUserPreferencesLocal().callTranslatorBotMriOverride||o.default.getS4LCMCFeatures().callTranslatorBotConfig.botMri}getCallTranslatorBotMriFilter(){const e=h.default.getUserPreferencesLocal().callTranslatorBotMriOverride,t=o.default.getS4LCMCFeatures().callTranslatorBotConfig.botMriFilter;return e?[e,...t]:t}setCallTranslatorBotOverride(e){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.setCallTranslatorBotOverride mri: "+g.mriOrId(e)),h.default.setUserPreferencesLocal({callTranslatorBotMriOverride:e})}clearCallTranslatorBotOverride(){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.clearCallTranslatorBotOverride"),h.default.setUserPreferencesLocal({callTranslatorBotMriOverride:void 0})}setCallTranslatorBotHideInRosterOverride(e){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.setCallTranslatorBotHideInRosterOverride hide: "+e),h.default.setUserPreferencesLocal({callTranslatorBotHideInRosterOverride:e})}getLocalCallTranslatorBotSpokenLanguageLocale(e=void 0){const t=this.getCallTranslatorSpokenLanguage(e);if(t&&!a.isEmpty(t))return t;const i=p.default.getCallTranslatorBotSubtitleLanguageLocale();return i&&!a.isEmpty(i)?i:u.getLocale()}getLocalPstnCallTranlatorBotSpokenLanguageLocale(e){if(e){const t=p.default.getCallPstnTranslatorBotSpokenLanguageLocales();if(t&&t[e]&&t[e].local)return t[e].local}const t=p.default.getCallTranslatorBotSubtitleLanguageLocale();return t&&!a.isEmpty(t)?t:u.getLocale()}setLocalPstnCallTranlatorBotSpokenLanguageLocale(e,t){let i=p.default.getCallPstnTranslatorBotSpokenLanguageLocales();i||(i={}),i[e]||(i[e]={}),i[e].local=t,p.default.setCallPstnTranslatorBotSpokenLanguageLocales(i)}getOtherPstnCallTranlatorBotSpokenLanguageLocale(e){if(e){const t=p.default.getCallPstnTranslatorBotSpokenLanguageLocales();if(t&&t[e]&&t[e].other)return t[e].other}}setOtherPstnCallTranlatorBotSpokenLanguageLocale(e,t){let i=p.default.getCallPstnTranslatorBotSpokenLanguageLocales();i||(i={}),i[e]||(i[e]={}),i[e].other=t,p.default.setCallPstnTranslatorBotSpokenLanguageLocales(i)}switchPstnCallTranlatorBotSpokenLanguageLocales(e){const t=p.default.getCallPstnTranslatorBotSpokenLanguageLocales();if(!t||!t[e])return;const i=t[e].local,a=t[e].other;t[e].local=a,t[e].other=i,p.default.setCallPstnTranslatorBotSpokenLanguageLocales(t)}getAllowedCallTranslatorCaptionsPositionMode(e,t=!1,i=!1){if(t||i)return c.CaptionsPositionMode.float;if(e&&this._isCaptionsPositionModeEnabled(e))return e;const a=o.default.getS4LCMCFeaturesNoSubscription().callCaptionsPositionModeDefault;return this._isCaptionsPositionModeEnabled(a)?a:c.CaptionsPositionMode.float}_isCaptionsPositionModeEnabled(e){const t=o.default.getS4LCMCFeaturesNoSubscription();switch(e){case c.CaptionsPositionMode.bottom:return t.callCaptionsBottomPanel.enabled;case c.CaptionsPositionMode.left:return t.callCaptionsLeftPanel.enabled;case c.CaptionsPositionMode.float:return t.callCaptionsFloatPanel.enabled;default:return!1}}getCallTranslatorSpokenLanguage(e){if(e){const t=p.default.getCallTranslatorSpokenLanguage();if(t&&t[e])return t[e]}const t=p.default.getCallTranslatorBotSubtitleLanguageLocale();return t&&!a.isEmpty(t)?t:u.getLocale()}setCallTranslatorSpokenLanguage(e,t){d.log(l.LogTraceArea.Calling,`Setting call captions spoken language to ${t} for conversation ${n.pii.Mri(e)}`);const i=p.default.getCallTranslatorSpokenLanguage()||{};i[e]=t,p.default.setCallTranslatorSpokenLanguage(i)}getLocalCallTranslatorBotSubtitleLanguageLocale(e=void 0){const t=this.getCallTranslatorSpokenLanguage(e);if(t&&!a.isEmpty(t))return t;const i=p.default.getCallTranslatorBotSubtitleLanguageLocale();return i&&!a.isEmpty(i)?i:u.getLocale()}isDeviceLanguageSupportedForTranslation(){const e=o.default.getS4LCMCFeatures().callTranslatorBotConfig.languageSupport.speech,t=this.getLocalCallTranslatorBotSpokenLanguageLocale();return e.includes(C.getLocaleStandardized(t))}isLanguageSupportedForTranslation(e){return o.default.getS4LCMCFeatures().callTranslatorBotConfig.languageSupport.speech.includes(C.getLocaleStandardized(e))}isConversationTranslated(e){const t=(0,r.default)().getConversation(e);return t?this.isDeviceLanguageSupportedForTranslation()&&t.getTranslationState()===s.TranslationState.Enabled:(d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.isConversationTranslated invalid conversation"),!1)}getConversationTranslationState(e){const t=(0,r.default)().getConversation(e);if(t)return t.getTranslationState();d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.isConversationTranslated invalid conversation")}getCallAudienceBotMri(){return h.default.getUserPreferencesLocal().callAudienceBotMriOverride||o.default.getS4LCMCFeatures().callAudienceBotConfig.botMri}getCallAudienceBotMriFilter(){const e=h.default.getUserPreferencesLocal().callAudienceBotMriOverride,t=o.default.getS4LCMCFeatures().callAudienceBotConfig.botMriFilter;return e?[e,...t]:t}getBotType(e){return a.includes(this.getCallAudienceBotMriFilter(),e)?c.BotType.Audience:a.includes(this.getCallGridViewBotMriFilter(),e)?c.BotType.GridView:a.includes(this.getCallRecorderBotMriFilter(),e)?c.BotType.Recorder:a.includes(this.getCallTranslatorBotMriFilter(),e)?c.BotType.Translator:void 0}setCallAudienceBotOverride(e){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.setCallAudienceBotOverride mri: "+g.mriOrId(e)),h.default.setUserPreferencesLocal({callAudienceBotMriOverride:e})}clearCallAudienceBotOverride(){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.clearCallAudienceBotOverride"),h.default.setUserPreferencesLocal({callAudienceBotMriOverride:void 0})}getCallGridViewBotMri(){return h.default.getUserPreferencesLocal().callGridViewBotMriOverride||o.default.getS4LCMCFeatures().callGridViewBotConfig.botMri}getCallGridViewBotMriFilter(){const e=h.default.getUserPreferencesLocal().callGridViewBotMriOverride,t=o.default.getS4LCMCFeatures().callGridViewBotConfig.botMriFilter;return e?[e,...t]:t}setCallGridViewBotOverride(e){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.setCallGridViewBotOverride mri: "+g.mriOrId(e)),h.default.setUserPreferencesLocal({callGridViewBotMriOverride:e})}clearCallGridViewBotOverride(){d.log(l.LogTraceArea.Calling,"InCallBotMriUtils.clearCallGridViewBotOverride"),h.default.setUserPreferencesLocal({callGridViewBotMriOverride:void 0})}getCallFullscreenBotMris(){return[...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}getMultiParticipantInCallBotMris(){return[...this.getCallRecorderBotMriFilter(),...this.getCallTranslatorBotMriFilter(),...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}getNonVisibleInCallBotMris(){const e=o.default.getS4LCMCFeatures().callTranslatorBotConfig.hideInRoster,t=h.default.getUserPreferencesLocal().callTranslatorBotHideInRosterOverride,i=this.getCallRecorderBotMriFilter();return!t&&e?[...i,...this.getCallTranslatorBotMriFilter()]:i}getNonInteractiveInCallBotMris(){return[...this.getCallRecorderBotMriFilter(),...this.getCallTranslatorBotMriFilter(),...this.getCallAudienceBotMriFilter(),...this.getCallGridViewBotMriFilter()]}}},498053:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SwitchCameraCommand=t.TwinCamCommand=t.ToggleHoldCallCommand=t.ToggleCallStatsCommand=t.ShowBingBackgroundsCommand=t.InvitePeopleCommand=t.NativeMobileInvitePeopleCommand=t.ToggleSkypeTranslateCommand=t.ToggleCaptionsCommand=t.ToggleNoiseSuppressionCommand=t.ToggleIncomingVideoCommand=t.BackgroundBlurCommand=t.ToggleRecordCommand=t.ChangeTogetherModeBackgroundCommand=t.ToggleAudienceModeCommand=t.MomentCommand=t.SendReactionCommand=t.ParticipantsCommand=t.AddToCallCommand=void 0;const a=i(496486),n=i(148540),o=i(269521),s=i(18078),r=i(889391),l=i(775352),c=i(994224),d=i(671830),u=i(581400),h=i(12563),p=i(372667),g=i(136850),C=i(502278),S=i(480200),m=i(471727),y=i(47447),f=i(469840),b=i(539549),_=i(746096),T=i(805581),v=i(436237),w=i(733754),I=i(693446),P=i(844972),M=i(104735),k=i(536150),A=i(886045),R=i(115489),x=i(262232),L=i(478262),V=i(790970),O=i(66123),B=i(853374),D=i(835114),E=i(952262),N=i(581760),F=i(711828);t.AddToCallCommand=class{constructor(e,t,i,a,n){this._callId=e,this._info=t,this._conversationMri=i,this._context=a,this._origin=n}canExecute(){return c.default.CallingFeaturesHelper.allowAddToCall(this._info)}execute(){const e=B.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"AddToCallCommand.execute callId: ${this._callId} causeId: ${causeId}"),v.log(_.LogTraceArea.CallingUI,"AddToCallCommand.onNavigateAwayFrom Call onCallScreenClose,callId: ${this._callId} causeId: ${causeId}"),o.PushNotifications.onCallScreenClose(),M.default.openAddToCall(this._conversationMri,this._callId,this._origin,this._context(),e),V.default.updateCallRosterTelemetry(this._callId,e,(e=>e.callRosterAddToCall()))}};t.ParticipantsCommand=class{constructor(e,t,i){this._callId=e,this._conversationMri=t,this._context=i}canExecute(){const e=r.default.getS4LCMCFeaturesNoSubscription().enableParticipantsButtonPstnMobile,t=!c.default.CallingStore.isOneOnOneCall(this._callId),i=(0,b.default)().getConversation(this._conversationMri),a=!(!(null==i?void 0:i.isGroupConversation())||!i.getThreadMembers().find((e=>d.isPhoneMri(e.id))));return e&&t&&a}execute(){const e=B.default.newCauseId();v.log(_.LogTraceArea.CallingUI,`ParticipantsCommand.execute callId: ${this._callId} causeId: ${e}`),v.log(_.LogTraceArea.CallingUI,`ParticipantsCommand.onNavigateAwayFrom Call onCallScreenClose, callId: ${this._callId} causeId: ${e}`),o.PushNotifications.onCallScreenClose(),M.default.openCallRoster(this._conversationMri,this._callId,e,this._context())}};t.SendReactionCommand=class{constructor(e,t,i,a,n){this._reactionType=e,this._reactionKey=t,this._callId=i,this._info=a,this._reactionsConversationMri=n}canExecute(){return c.default.CallingFeaturesHelper.allowReactions(this._info)}execute(){const e=B.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"SendReactionCommand.execute callId: ${this._callId} causeId: ${causeId}");const t={reactionInfo:{type:this._reactionType,key:this._reactionKey},causeId:e,timestamp:Date.now(),postSource:_.PostSource.CallReactionPressed,callId:this._callId,conversationMri:this._info.conversationMri,reactionsConversationMri:this._reactionsConversationMri,logTraceArea:_.LogTraceArea.CallReactionsDrawer};u.CallReactionPostingHelpers.postReaction(t)}};t.MomentCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._reactionsConversationMri=i}canExecute(){return c.default.CallingFeaturesHelper.allowSnapshots(this._info)&&y.CallingCapabilities.callSnapshotSupported()}execute(){const e=B.default.newCauseId(),t=x.default.SkypeCameraCapture;v.log(_.LogTraceArea.CallingUI,"MomentCommand.execute callId: ${this._callId} causeId: ${causeId}");const i=[this._info.conversationMri],a=this._info.conversationMri,n=this._reactionsConversationMri,o=c.default.CallingStore.getRankedSpeakerMris(this._callId);t.playOnce(e),p.default.takeSnapshot(e,this._callId,a,n,o,i),A.default.maybeAnnounceForAccessibility(w.getString("CallPanel.SnapshotPosted")),C.default.updateCallTelemetry(this._callId,e,(e=>e.postPhotoSnapshot()))}};t.ToggleAudienceModeCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isAudienceMode=i}canExecute(){return c.default.CallingFeaturesHelper.allowCallAudienceBot(this._info)}execute(){const e=B.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"AudienceCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isAudienceMode?c.default.InCallBotService.stopAudienceMode(this._callId,e):c.default.InCallBotService.startAudienceMode(this._callId,e)}};class j{constructor(e,t){this._callId=e,this._conversationMri=t}canExecute(){return j.canExecute(this._callId,this._conversationMri)}static canExecute(e,t){if(a.isUndefined(e)||a.isUndefined(t))return!1;const i=g.default.getStageMode(e)===S.StageMode.TogetherMode,{enabledBackgroundSelection:n}=r.default.getS4LCMCFeatures().callAudienceBotConfig,o=c.default.CallingStore.isConnectedAudienceBotInCall(e),s=!a.isEmpty(O.default.getTogetherModeBackgrounds()),l=j._isAllowedToChangeBackgroundIfInModeratedGroup(t);if(i&&n&&o&&l){if(s)return!0;{const e="ChangeTogetherModeBackgroundCommand.canExecute no TogetherMode backgrounds to choose from";return v.warn(_.LogTraceArea.CallingUI,e),!1}}return!1}static _isAllowedToChangeBackgroundIfInModeratedGroup(e){const t=e&&(0,b.default)().getConversation(e);return!(0,P.isModerated)(t)||(0,P.isCurrentUserAdminInModeratedGroup)(t)}execute(){const e=B.default.newCauseId();C.default.togetherModeSceneChangeRequestCount(this._callId,e);const t={conversationMri:this._conversationMri,onChangeBackground:t=>{c.default.AudienceBotService.selectAudienceScene(this._callId,e,t.sceneId)},onStartTogetherMode:a.noop,onClose:a.noop,isAudienceBotInCall:!0,selectedBackground:undefined};M.default.navigateToTogetherModePanel(t,O.default.getPanelId())}}t.ChangeTogetherModeBackgroundCommand=j;t.ToggleRecordCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isRecording=i}canExecute(){const e=c.default.CallingStore.getCallRecordingInitiator(this._callId);return c.default.CallingFeaturesHelper.allowRecording(this._info)&&c.default.InCallBotUtils.showCallRecorderControls(e)}execute(){const e=B.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"RecordCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isRecording?c.default.InCallBotService.stopRecording(this._callId,e):c.default.InCallBotService.startRecording(this._callId,e)}};t.BackgroundBlurCommand=class{constructor(e,t,i,a){this._callId=e,this._isVideoActive=t,this._isBackgroundBlurEnabled=i,this._isBackgroundBlurSelected=a}canExecute(){return this._isBackgroundBlurEnabled&&this._isVideoActive}execute(){const e=B.default.newCauseId();v.log(_.LogTraceArea.CallingUI,`BackgroundBlurCommand.execute callId: ${this._callId} causeId: ${e}`),this._isVideoActive&&(this._isBackgroundBlurSelected=!this._isBackgroundBlurSelected,c.default.DeviceStore.setBackgroundBlurred(this._isBackgroundBlurSelected))}};t.ToggleIncomingVideoCommand=class{constructor(e,t,i,a){this._callId=e,this._info=t,this._audioOnlyEnabled=i,this._isIncomingVideoDisabled=a}canExecute(){return c.default.CallingFeaturesHelper.allowIncomingVideoToBeDisabled(this._info)}execute(){const e=B.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"IncomingVideoCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._audioOnlyEnabled?c.default.CallingStore.stopAudioOnly(this._callId,e):this._isIncomingVideoDisabled?m.default.enableIncomingVideo(this._callId,e):m.default.disableIncomingVideo(this._callId,e)}};t.ToggleNoiseSuppressionCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._noiseSuppressionMode=i}canExecute(){return c.default.CallingFeaturesHelper.allowIncomingVideoToBeDisabled(this._info)}execute(e){const t=B.default.newCauseId(),i=c.default.DeviceStore.getNoiseSuppressionMode();let a;switch(v.log(_.LogTraceArea.CallingUI,`NoiseSuppressionCommand.execute callId: ${this._callId}\n                                                       item: ${e} mode: ${this._noiseSuppressionMode} causeId: ${t}`),e){case n.NoiseSuppressionMode.Auto:a=n.NoiseSuppressionMode.Auto;break;case n.NoiseSuppressionMode.Off:a=n.NoiseSuppressionMode.Off;break;case n.NoiseSuppressionMode.Low:a=n.NoiseSuppressionMode.Low;break;case n.NoiseSuppressionMode.High:a=n.NoiseSuppressionMode.High;break;default:return}this._noiseSuppressionMode=a,c.default.DeviceStore.setNoiseSuppressionMode(this._noiseSuppressionMode),c.default.CallingStore.setNoiseSuppressionMode(this._noiseSuppressionMode),v.track(new R.NoiseSuppressionSettingsEvent(!0,i,a,l.MicrophoneSettingsOrigin.InCallPopup))}};t.ToggleCaptionsCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isTranslating=i}canExecute(){const e=T.default.isConversationTranslated(this._info.conversationMri),t=c.default.InCallBotService.isPstnTranslationEnabled(this._info.callId),i=c.default.InCallBotService.isSkypeTranslationEnabled(this._info.callId);return c.default.CallingFeaturesHelper.allowCaptioning(this._info)&&!e&&!t&&!i}execute(){const e=B.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"CaptionsCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isTranslating?c.default.InCallBotService.stopTranslator(this._callId,e):c.default.InCallBotService.startTranslator(this._callId,e)}};t.ToggleSkypeTranslateCommand=class{constructor(e,t,i){this._callId=e,this._info=t,this._isTranslating=i}canExecute(){const e=c.default.InCallBotService.isCaptioningEnabled(this._info.callId),t=T.default.isConversationTranslated(this._info.conversationMri),i=c.default.InCallBotService.isPstnTranslationEnabled(this._info.callId);return c.default.CallingFeaturesHelper.allowSkypeTranslation(this._info)&&!t&&!i&&!e}execute(){const e=B.default.newCauseId();v.log(_.LogTraceArea.CallingUI,"TranslatorCommand.execute callId: ${this._callId} causeId: ${causeId}"),this._isTranslating?c.default.InCallBotService.stopSkypeTranslationConsent(this._callId,e):c.default.InCallBotService.startSkypeTranslationConsent(this._callId,e)}};t.NativeMobileInvitePeopleCommand=class{constructor(e,t,i){this._conversationId=e,this._origin=t,this._callId=i}canExecute(){const e=(0,b.default)().getConversation(this._conversationId);return!(!(null==e?void 0:e.isGroupConversation())||!(null==e?void 0:e.isJoinEnabled()))&&(this._joinLink=f.default.getLink(this._conversationId),!!this._joinLink)}execute(){this._joinLink&&I.default.showMobile({threadId:this._conversationId,joinLink:this._joinLink,callId:this._callId,meetNowParameters:{origin:this._origin}})}};t.InvitePeopleCommand=class{constructor(e,t){this._conversationId=e,this._rootViewId=t}canExecute(){var e;const t=(0,b.default)().getConversation(this._conversationId);return null!==(e=null==t?void 0:t.isGroupConversation())&&void 0!==e&&e}execute(){const e=E.default.getDisplayName(this._conversationId);M.default.navigateToGroupShare(this._conversationId,e,D.InviteLinkOrigin.QuickCallPanel,this._rootViewId)}};t.ShowBingBackgroundsCommand=class{constructor(e,t){this._callId=e,this._context=t}canExecute(){const e=c.default.CallingFeaturesHelper.bingBackgroundsEnabled(),t=c.default.CallParticipantBackgroundInfoStore.captionsReceivedCount(this._callId);return e&&t>0}execute(){v.log(_.LogTraceArea.CallingUI,"ShowBingBackgroundsCommand.execute callId: ${this._callId}"),v.log(_.LogTraceArea.CallingUI,"ShowBingBackgroundsCommand.onNavigateAwayFrom Call onCallScreenClose,callId: ${this._callId} causeId: ${causeId}"),o.PushNotifications.onCallScreenClose(),M.default.openBingBackgroundsOverview(this._callId,this._context())}};t.ToggleCallStatsCommand=class{constructor(e,t,i){this._callId=e,this._context=t,this._modal=i}canExecute(){return r.default.getS4LCMCFeatures().enableCallTechnicalInformation&&!k.default.isMobileScreenReaderEnabled()&&y.CallingCapabilities.callTechnicalInformationSupported()}execute(){M.default.navigateToCallingDebugPanel(this._callId,this._context,this._modal)}};t.ToggleHoldCallCommand=class{constructor(e,t,i=N.Color.white){this._callInfo=e,this._causeId=null!=t?t:B.default.newCauseId(),this._iconColor=i,this._allowHoldCall=c.default.CallingFeaturesHelper.allowHoldCall(e),this._isCallOnHoldResumeable=void 0!==e.callId&&c.default.CallingStore.isCallOnHoldResumeable(e.callId)}canExecute(){return void 0!==this._callInfo.callId&&(this._allowHoldCall||this._isCallOnHoldResumeable)}execute(){const e=c.default.ActiveCallUIHelper.connectedToActiveCall(this._callInfo.conversationMri),t=c.default.CallingStore.getConnectedOrOutgoingAndNotOnHoldCallId();v.log(_.LogTraceArea.Calling,`ToggleHoldCommand.execute ${e?"HOLD":"RESUME"} causeId: ${this._causeId}`),e?c.default.CallingStore.hold(this._callInfo.callId,this._causeId):t&&t!==this._callInfo.callId?c.default.CallingStore.hold(t,this._causeId).then(this._unhold):this._unhold()}getButtonDescriptor(){return this._allowHoldCall?{key:S.CallControlsOverflowItem.ToggleHoldCall,icon:{icon:F.SkypeIcon.Pause,color:this._iconColor},title:w.getString("CallControlsOverFlowMenu.HoldCall"),accessibilityLabel:w.getString("CallControlsOverFlowMenu.HoldCall"),onPress:()=>this.execute()}:this._isCallOnHoldResumeable?{key:S.CallControlsOverflowItem.ToggleHoldCall,icon:{icon:F.SkypeIcon.Play,color:this._iconColor},title:w.getString("CallControlsOverFlowMenu.ResumeCall"),accessibilityLabel:w.getString("CallControlsOverFlowMenu.ResumeCall"),onPress:()=>this.execute()}:void 0}_unhold(){this._callInfo.callId&&c.default.CallingStore.unhold(this._callInfo.callId,this._causeId)}};t.TwinCamCommand=class{constructor(e,t){this._callId=e,this._info=t,this._onStopTwinCamButtonPress=()=>{const e=B.default.newCauseId();if(v.log(_.LogTraceArea.Calling,"_onStopTwinCamButtonPress: causeId: "+e),r.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick){const t=d.getReactionsThreadMriForCallId(this._callId),i=s.default.getSkypeMri();h.postCallEventNotification(L.ReactionsTextType.CallEventKickedOutOwn,i,this._callId,this._info.conversationMri,t,e)}c.default.CallingStore.removeOtherEndpoints(this._callId,e)}}canExecute(){return!a.isUndefined(this._callId)&&!a.isUndefined(this._info.conversationMri)&&c.default.CallingFeaturesHelper.allowTwinCam(this._info)}execute(e){if(e)this._onStopTwinCamButtonPress();else{const e={callId:this._callId,conversationMri:this._info.conversationMri,onStopTwinCamPressed:this._onStopTwinCamButtonPress};M.default.navigateToTwinCamPanel(e)}}};t.SwitchCameraCommand=class{constructor(e,t){this._callId=e,this._isVideoActive=t}canExecute(){return r.default.getS4LCMCFeaturesNoSubscription().enableNewCallPanel.enableExperimentalHeader&&this._isVideoActive}execute(){const e=B.default.newCauseId(),t=c.default.DeviceStore.getCameras(),i=c.default.DeviceStore.getSelectedCamera(),a=i&&i.position,n=i&&i.id,o=t.find((e=>e.id!==n&&e.position!==a)),s=null==o?void 0:o.id,r=null==o?void 0:o.position;s&&r?(c.default.DeviceStore.choosePreferredDevices({camera:s},e),v.log(_.LogTraceArea.CallingUI,"[SwitchCameraCommand]",`_updateVideoSource ${n} position ${a} -> ${s} position ${r}`,`causeId: ${e}`),C.default.updateCallTelemetry(this._callId,e,(e=>e.toggleCamera()))):v.warn(_.LogTraceArea.CallingUI,"[SwitchCameraCommand] No camera found to switch to.")}}},399189:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LowerHandParticipantCommand=t.LowerHandCommand=t.RaiseHandCommand=void 0;const a=i(994224),n=i(471727),o=i(436237),s=i(754306),r=i(853374);t.RaiseHandCommand=class{constructor(e,t){this._callId=e,this._info=t}isFeatureEnabled(){return a.default.CallingFeaturesHelper.allowRaiseHands(this._info)}canExecute(){return a.default.CallingFeaturesHelper.allowRaiseHands(this._info)&&!a.default.CallingStore.isHandRaisedForCurrentUserMri(this._callId)}execute(){return o.track(new s.RaiseHandTelemetryEvent(this._callId,s.RaiseHandAction.RaiseHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1)),a.default.CallingStore.raiseHand(this._callId,r.default.newCauseId())}};t.LowerHandCommand=class{constructor(e,t){this._callId=e,this._lowerHandOrigin=t}canExecute(){return a.default.CallingStore.isHandRaisedForCurrentUserMri(this._callId)}execute(){return o.track(new s.RaiseHandTelemetryEvent(this._callId,s.RaiseHandAction.LowerMyHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1,this._lowerHandOrigin)),n.default.announceLoweredHandState(!0),a.default.CallingStore.lowerHandForCurrentUserMri(this._callId,r.default.newCauseId())}};t.LowerHandParticipantCommand=class{constructor(e,t,i,a,n){this._callId=e,this._mri=t,this._lowerHandOrigin=i,this._isLocal=a,this._displayName=n}isHandRaised(){return a.default.CallingStore.isHandRaisedForMri(this._mri,this._callId)}canExecute(){return n.default.canHandBeLoweredForParticipant(this._callId,this._mri)}execute(){a.default.CallingStore.lowerHandForMri(this._mri,this._callId,r.default.newCauseId()),o.track(new s.RaiseHandTelemetryEvent(this._callId,s.RaiseHandAction.LowerOthersHand,a.default.CallingStore.connectedParticipantsCount(this._callId)+1,this._lowerHandOrigin)),n.default.announceLoweredHandState(this._isLocal,this._displayName)}}},172425:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocallyStartedRinglessCallType=void 0;const a=i(889391),n=i(994224),o=i(647176),s=i(671830),r=i(539549),l=i(746096),c=i(436237),d=i(46929),u=i(104735),h=i(853374);var p;!function(e){e[e.OnePerson=0]="OnePerson",e[e.SmallGroup=1]="SmallGroup",e[e.LargeGroup=2]="LargeGroup",e[e.GoLive=3]="GoLive",e[e.None=4]="None"}(p=t.LocallyStartedRinglessCallType||(t.LocallyStartedRinglessCallType={}));class g{static getRinglessCallType(e,t){const i=g.getMemberCount(e);return t&&!this.isLocallyStartedRinglessCall(e,t)?p.None:1===i?p.OnePerson:i<=a.default.getS4LCMCFeatures().maximumGroupSizeRing&&a.default.getS4LCMCFeatures().enableRinglessCallForSmallGroups?p.SmallGroup:i>a.default.getS4LCMCFeatures().maximumGroupSizeRing&&a.default.getS4LCMCFeatures().enableRinglessCall?p.LargeGroup:p.GoLive}static getMemberCount(e){const t=(0,r.default)().getConversation(e);return t?Math.max(t.getMemberCount(),0):0}static isLocallyStartedRinglessCall(e,t){return n.default.CallingStore.hasStartedCallLocallyGoLive(t)}static handleRingTheGroup(e,t){const i=o.default.getInactiveGroupMembers(t,e);n.default.CallParticipantUtils.addUsersToCallOrRing(i,t,e,i,l.NavigationAddToCallOrigin.GoLiveInformationView);const a=h.default.newCauseId();c.log(l.LogTraceArea.CallingUI,`[GoLiveInformationPanel] _handleRingAll, causeId: ${a}`)}static isRingTheGroupOptionAvailable(e,t){return!(!g.isLocallyStartedRinglessCall(e,t)||n.default.CallingStore.hasRingingParticipants(t,!0)||this.getRinglessCallType(e)!==p.SmallGroup)}static isPotentialRinglessCall(e,t){if(!s.isGroupConversation(e))return!1;switch(g.getRinglessCallType(e)){case p.SmallGroup:return t;case p.LargeGroup:return!0;default:return!1}}static isInterstitialShown(e){const t=g.getMemberCount(e);if(1!==t)return t>a.default.getS4LCMCFeatures().maximumGroupSizeRing?d.default.getInterstitialForLargeGroupRinglessCallsShown():d.default.getInterstitialForSmallGroupRinglessCallsShown()}static shouldShowInterstitial(e,t){return!g.isInterstitialShown(e)&&g.isPotentialRinglessCall(e,t)}static maybeShowRinglessCallInterstitial(e,t,i,a){if(g.isInterstitialShown(e)||!g.isPotentialRinglessCall(e,t))return;c.log(l.LogTraceArea.CallingUI,"RinglessCallUtils show Ringlesscall interstitial");const n=g.getRinglessCallType(e)===p.LargeGroup;u.default.navigateToRinglessCallInterstitial({conversationMri:e,origin:i,withVideo:t,isLargeGroup:n,causeId:a}),n?d.default.setInterstitialForLargeGroupRinglessCallsShown(!0):d.default.setInterstitialForSmallGroupRinglessCallsShown(!0)}}t.default=g},824932:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MobileScreenShareToggleCommand=void 0;i(585532);const a=i(994224),n=i(502278),o=i(746096),s=i(436237),r=i(733754),l=i(886045),c=i(853374);t.MobileScreenShareToggleCommand=class{constructor(e){this._callInfo=e}canExecute(){const e=a.default.DeviceStore.getAvailableScreens();return e&&e.length>0&&a.default.CallingFeaturesHelper.allowMobileScreenSharing(this._callInfo)}execute(){const e=this._callInfo.callId;if(!e)return;const t=c.default.newCauseId(),i=a.default.CallingStore.isScreenSharing(e);if(s.log(o.LogTraceArea.CallingUI,`ScreenShareToggleCommand isScreenShareActive:${i}; callId: ${e}; causeId: ${t}`),i)a.default.CallingStore.stopScreenSharing(e,t),n.default.updateCallTelemetry(e,t,(e=>e.stopScreenSharing())),l.default.maybeAnnounceForAccessibility(r.getString("AccessibilityLabel.ScreenShareStopped"));else{const i=a.default.DeviceStore.getAvailableScreens();if(i&&i.length>0){(()=>{a.default.CallingStore.startScreenSharing(e,t,i[0],!1),n.default.updateCallTelemetry(e,t,(e=>e.startScreenSharing())),l.default.maybeAnnounceForAccessibility(r.getString("AccessibilityLabel.ScreenShareStarted"))})()}else s.error(o.LogTraceArea.CallingUI,"No screens are available for sharing")}}}},646393:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LgTmModeElementsManager=t.PresentationModeElementsManager=t.SpeakerModeElementsManager=t.GridModeElementsManager=t.FullScreenBotType=t.StageModeElementsManager=void 0;const a=i(496486),n=i(18078),o=i(436237),s=i(853374),r=i(480200),l=i(805581),c=i(366355),d=i(598925),u=i(994224),h=i(471727),p=i(76514),g=i(889391);class C{constructor(e,t,i,a){this._callId=e,this._trayMainAxisSize=t,this._trayItemSizeMultiplier=i,this._trayItemsCompact=a,this._filterOutNonDisplayableParticipants=e=>!0}onInit(e){return o.log(c.LogTraceArea.CallingUI,"StageModeElementsManager: initializing participants"),this.updateParticipants(e)}updateParticipants(e){const t=a.filter(e,this._filterOutNonDisplayableParticipants),i=h.CallUIUtils.getOrderedByVideoPresenceParticipants(a.compact(t),this._callId);if(g.default.getS4LCMCFeatures().modernCallStage.enableVideoPrioritization){const e=s.default.newCauseId();this._updateVideoPriorityOrder(i,e)}const n=this._getStageParticipants(i),o=a.without(i,...n),r=this._getTrayParticipants(i,n);return{stageParticipants:n,trayParticipants:r,trayRemainder:o.length-r.length}}setTrayParameters(e,t,i=1,a=!1){return this._trayMainAxisSize=e,this._trayItemSizeMultiplier=i,this._trayItemsCompact=a,this.updateParticipants(t)}_updateVideoPriorityOrder(e,t){if(!this._callId)return;const i=[n.default.getSkypeMri(),...e];u.default.CallingStore.setRemoteVideoPriorityOrder(this._callId,a.without(i,r.CallStageElementKeys.localUserKey),t)}_getTrayParticipants(e,t,i=!1,n=!1){const o=a.without(e,...t);return h.CallUIUtils.getOrderedDisplayedTrayParticipants(o,this._trayMainAxisSize,this._callId,this._trayItemSizeMultiplier,this._trayItemsCompact,i,n)}}var S;t.StageModeElementsManager=C,function(e){e[e.LargeGrid=0]="LargeGrid",e[e.TogetherMode=1]="TogetherMode"}(S=t.FullScreenBotType||(t.FullScreenBotType={}));t.GridModeElementsManager=class extends C{constructor(e,t,i,n,o,s,r){super(e,t,i,n),this._callId=e,this._trayMainAxisSize=t,this._trayItemSizeMultiplier=i,this._trayItemsCompact=n,this._stageCapacity=o,this._onlyVideoOnStage=s,this._showSelfInTheGrid=r,this._filterOutNonDisplayableParticipants=e=>!a.includes(l.default.getNonInteractiveInCallBotMris(),e)}updateStageCapacity(e,t){return o.log(c.LogTraceArea.CallingUI,"GridModeElementsManager.updateStageCapacity to "+t),this._stageCapacity=t,this.updateParticipants(e)}_getStageParticipants(e){if(g.default.getS4LCMCFeatures().enableCallParticipantsPinning&&p.default.hasPinnedParticipants(this._callId))return this._getParticipantsForPinningMode(e);let t=e;this._showSelfInTheGrid||(t=a.without(e,r.CallStageElementKeys.localUserKey));let i=t;return this._onlyVideoOnStage&&(i=a.filter(e,(e=>{const t=u.default.CallParticipantStore.getParticipantRenderInfo(e,this._callId);return!!(null==t?void 0:t.shouldRenderVideo)}))),a.take(i,this._stageCapacity)}_getParticipantsForPinningMode(e){const t=a.intersection(e,p.default.getPinnedParticipants(this._callId));return a.take(t,this._stageCapacity)}_getTrayParticipants(e,t){const i=a.without(e,...t);return u.default.CallingStore.isOneOnOneCall(this._callId)&&a.remove(i,(e=>e===r.CallStageElementKeys.localUserKey)),h.CallUIUtils.getOrderedDisplayedTrayParticipants(i,this._trayMainAxisSize,this._callId,this._trayItemSizeMultiplier,this._trayItemsCompact)}};t.SpeakerModeElementsManager=class extends C{constructor(e,t,i,n){super(e,t,i,n),this._callId=e,this._trayMainAxisSize=t,this._trayItemSizeMultiplier=i,this._trayItemsCompact=n,this._filterOutNonDisplayableParticipants=e=>!a.includes(l.default.getNonInteractiveInCallBotMris(),e)&&!a.startsWith(e,d.ScreenSharingPrefix)}_getStageParticipants(e){const t=a.minBy(e,(e=>{var t;return null===(t=u.default.CallParticipantStore.getParticipantRenderInfo(e,this._callId))||void 0===t?void 0:t.activeSpeakerRank}));return t?[t]:[]}};t.PresentationModeElementsManager=class extends C{constructor(e,t,i,n){super(e,t,i,n),this._callId=e,this._trayMainAxisSize=t,this._trayItemSizeMultiplier=i,this._trayItemsCompact=n,this._filterOutNonDisplayableParticipants=e=>!a.includes(l.default.getNonInteractiveInCallBotMris(),e)}_getStageParticipants(e){const t=e.find((e=>a.startsWith(e,d.ScreenSharingPrefix))),i=[];return t&&i.push(t),i}_updateVideoPriorityOrder(e,t){if(!this._callId)return;const i=[...this._getStageParticipants(e),...e];super._updateVideoPriorityOrder(a.uniq(i),t)}_getTrayParticipants(e,t){return super._getTrayParticipants(e,t,!0,!0)}};t.LgTmModeElementsManager=class extends C{constructor(e,t,i,n,o){super(e,t,i,n),this._callId=e,this._trayMainAxisSize=t,this._trayItemSizeMultiplier=i,this._trayItemsCompact=n,this._botType=o,this._filterOutNonDisplayableParticipants=e=>{const t=this._getBotMrisToFilterOut();return!a.includes(l.default.getNonVisibleInCallBotMris(),e)&&!a.includes(t,e)&&!a.startsWith(e,d.ScreenSharingPrefix)}}_getStageParticipants(e){const t=this._getBotMris(),i=e.find((e=>a.includes(t,e))),n=[];return i&&n.push(i),n}_updateVideoPriorityOrder(e,t){if(!this._callId)return;const i=[...this._getStageParticipants(e),...e];super._updateVideoPriorityOrder(a.uniq(i),t)}_getBotMris(){switch(this._botType){case S.LargeGrid:return l.default.getCallGridViewBotMriFilter();case S.TogetherMode:return l.default.getCallAudienceBotMriFilter()}}_getBotMrisToFilterOut(){switch(this._botType){case S.LargeGrid:return l.default.getCallAudienceBotMriFilter();case S.TogetherMode:return l.default.getCallGridViewBotMriFilter()}}}},66123:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(889391),o=i(733754),s=i(711828),r=new Set(["Auditorium","AuditoriumDark","AuditoriumGold","Amphitheater","DiningRoom","ConferenceRoom","CoffeeShop","BigConferenceRoom","AbstractDark","Halo","Underwater","Classroom","Minecraft","HolidaySnow","HolidayCave","Restaurant","WinterLodge","KitchenDining","WarmSantorini","Dinner","Celebration","Outdoors","Crowd","TropicalSunset","PowerTogether","Airplane","Birthday"]);class l{static getTogetherModeBackgrounds(){const{backgrounds:e}=n.default.getS4LCMCFeatures().callAudienceBotConfig;return a.map(e,(e=>{const t=this._getTranslatedLabel(e);return{sceneId:e.sceneId,untranslatedName:e.name,label:t,url:e.thumbSrc,maxAudience:e.maxAudience}}))}static getTogetherModeBackgroundName(e){var t;return null===(t=l.getTogetherModeBackgrounds().find((t=>t.sceneId===e)))||void 0===t?void 0:t.untranslatedName}static getPanelId(){return"_togetherModeModalId"}static getBackgroundChangeButtonIcon(){return s.SkypeIcon.Picture}static _getTranslatedLabel(e){const t=e.humanFriendlyId;if(!r.has(t))return e.name;const i=`TogetherModeBackgroundNames.${t}`;return o.getString(i)}}t.default=l},613084:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(598925),n=i(422801),o=i(891114),s=i(539549),r=i(882261),l=i(746096),c=i(436237),d=i(46929),u=i(785207),h=i(914976),p=i(404057);t.default=new class{_getTranslationToLocale(e){const t=(0,s.default)().getConversation(e);return t?t.getMessageTranslationLocale():void 0}disableTranslation(e,t){this._changeTranslationState(e,a.TranslationState.Disabled,a.TranslationState.Disabled,t),d.default.deleteTranslationBannerDismissStates(e),c.track(new o.ConversationTranslationAction(e,l.TranslationAction.Disabled,t,this._getTranslationToLocale(e)))}cancelTranslationRequest(e,t){this._changeTranslationState(e,a.TranslationState.Disabled,a.TranslationState.Cancelled,t),d.default.deleteTranslationBannerDismissStates(e),c.track(new o.ConversationTranslationAction(e,l.TranslationAction.Cancelled,t,this._getTranslationToLocale(e)))}declineTranslationRequest(e,t){this._changeTranslationState(e,a.TranslationState.Disabled,a.TranslationState.Declined,t),d.default.deleteTranslationBannerDismissStates(e),c.track(new o.ConversationTranslationAction(e,l.TranslationAction.Declined,t,this._getTranslationToLocale(e)))}requestTranslation(e,t){this._changeTranslationState(e,a.TranslationState.Requested,a.TranslationState.Pending,t),d.default.setInCallTranslationBannerDismissState(e,!1),d.default.setConversationTranslationBannerDismissState(e,!1),c.track(new o.ConversationTranslationAction(e,l.TranslationAction.Requested,t,this._getTranslationToLocale(e)))}acceptTranslation(e,t){this._changeTranslationState(e,a.TranslationState.Enabled,a.TranslationState.Enabled,t),c.track(new o.ConversationTranslationAction(e,l.TranslationAction.Accepted,t,this._getTranslationToLocale(e)))}_changeTranslationState(e,t,i,o){c.log(l.LogTraceArea.Calling,"TranslationHelper._changeTranslationState conversationId: "+h.mriOrId(e)+" localTranslationState "+a.TranslationState[t]+" remoteTranslationState "+a.TranslationState[i]);const s=r.createTranslationSettingsMessage(e,l.PostSource.MessagePanel,o,i,!1);s?n.default.setTranslationState(e,t).then((()=>u.default.postMessage(s))).catch((e=>{c.error(l.LogTraceArea.Calling,"TranslationHelper._changeTranslationState failed: "+p.default.errorAsString(e))})):c.error(l.LogTraceArea.Calling,"TranslationHelper._changeTranslationState failed to create translation settings message")}}},948310:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TwinCamFlowStep=void 0;const a=i(746096),n=i(436237),o=i(415963),s=i(794050),r=i(853374);var l;!function(e){e.QRNavigationStarted="QRNavigationStarted",e.JoinNavigationStarted="JoinNavigationStarted",e.QRCodeScanned="QRCodeScanned",e.StartTwinCamClicked="StartTwinCamClicked",e.CallStarted="CallStarted",e.PanelReady="PanelReady",e.CallTransfered="CallTransfered",e.StartingTwinCamFailed="StartingTwinCamFailed",e.CallEnded="CallEnded",e.TwinCamStopped="TwinCamStopped"}(l=t.TwinCamFlowStep||(t.TwinCamFlowStep={}));const c=new class{beginTrackingTwinCam(e){const t={EntryPoint:a.NavigationCallOrigin[e]};this.finishScenario();const i=new s.default(o.ScenarioName.TwinCamFlow,r.default.newGuid(),t);i.start(),this._twinCamScenario=i}trackQRNavigationStarted(e){this._convId?this.finishScenario():(this._convId=e,this._markFlowStep(l.QRNavigationStarted,{ConversationId:e}))}trackJoinNavigationStarted(e){this._convId?this.finishScenario():(this._convId=e,this._markFlowStep(l.JoinNavigationStarted,{ConversationId:e}))}trackQRCodeScanned(e){this._isConversationIdConsistent(e)&&this._markFlowStep(l.QRCodeScanned,{ConversationId:e})}trackStartTwinCamClicked(e){this._isConversationIdConsistent(e)&&this._markFlowStep(l.StartTwinCamClicked,{ConversationId:e})}trackCallStarted(e){this._isConversationIdConsistent(e)&&this._markFlowStep(l.CallStarted)}trackLobbyOpen(e){this._isConversationIdConsistent(e)&&this._markFlowStep(l.PanelReady,{ConversationId:e})}trackCallTransfered(e){this._isConversationIdConsistent(e)&&(this._markFlowStep(l.CallTransfered,{ConversationId:e}),this.finishScenario())}trackCallEnded(e){this._twinCamScenario&&e===this._convId&&(this._markFlowStep(l.CallEnded,{ConversationId:e}),this.finishScenario())}trackTwinCamStopped(e){this._isConversationIdConsistent(e)&&this._markFlowStep(l.TwinCamStopped,{ConversationId:e})}trackStartingTwinCamFailed(e){this._isConversationIdConsistent(e)&&this._markFlowStep(l.StartingTwinCamFailed,{ConversationId:e})}test_getTwinCamScenario(){return this._twinCamScenario}_isConversationIdConsistent(e){return this._twinCamScenario&&!this._convId?(this._convId=e,!0):!(!this._twinCamScenario||e!==this._convId)||(this.finishScenario(),!1)}finishScenario(){this._twinCamScenario&&(this._twinCamScenario.finish(),this._twinCamScenario=void 0),this._convId=void 0}_markFlowStep(e,t){this._twinCamScenario?this._twinCamScenario.markStepCompleted(e,t):n.log(a.LogTraceArea.JoinLink,"TwinCamTelemetryHelpers._markFlowStep cannot mark step because you need to begin this scenario first")}};t.default=c},976543:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(823113),n=i(148540),o=i(889391),s=i(216568),r=i(952262),l=i(581736),c=i(436237),d=i(733754),u=i(746096),h=i(711828),p=i(478262),g=i(593486),C=i(671830),S=i(33004),m=i(568580),y=i(18078),f=i(109520),b=i(598925),_=i(502278);class T{constructor(){this._endedCalls={},this._unknownReasonTimestamps=[]}test_reset(){this._endedCalls={},this._unknownReasonTimestamps=[]}reportUnansweredCallActionTaken(e,t,i,a){const n=this._endedCalls[e];n?(c.log(u.LogTraceArea.UnansweredCall,"Reporting UCUX action callId: "+n.callId+" reason: "+b.UnansweredCallReason[t]+" action: "+b.UnansweredCallAction[i]+" causeId: "+n.causeId),delete this._endedCalls[e],c.track(new f.UnansweredCallActionEvent(e,s.default.CallingNodeId.get(),n.terminatedReason,n.failureType,t,i))):c.warn(u.LogTraceArea.UnansweredCall,"Attempted to report result of UCUX for unknown callId: "+e+" causeId: "+a)}unansweredCallOptionsParticipant(e,t){const i=this._reasonForAddParticipantFailedInfo(e);if(i!==b.UnansweredCallReason.None)return{reason:i,actions:T._actionsForUnansweredCall(i,e.conversationMri,!1),title:d.getString("PstnUtils.UnableToAddParticipant"),optionalSecondaryMessage:T._titleForUnansweredCall(i,e.participantInfo.mri),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:T._visualInfoForUnasnweredCall(i)};c.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX in participant flow - callId: "+e.callId+" ParticipantStateReason: "+n.ParticipantStateReason[e.participantInfo.reason]+" causeId: "+t)}unansweredCallOptions(e,t){if(e.terminatedReason!==n.TerminatedReason.NoPermission){const i=t.lastEventReaction?S.default.parseCallEventReaction(t.lastEventReaction):void 0,a=(null==i?void 0:i.mri)===y.default.getSkypeMri()&&(null==i?void 0:i.eventType)===p.ReactionsTextType.CallEventKickedOutOwn;if((e.terminatedReason!==n.TerminatedReason.Kicked||a)&&!e.isCallCreator&&(e.terminatedReason!==n.TerminatedReason.CallSetupError||t.hasMicrophones))return void c.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX - user is not call creator and TerminatedReason is NOT Kicked callId: "+e.callId+" causeId: "+e.causeId);if(t.isPreheatedAndNotJoined)return void c.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX - was preheating callId: "+e.callId+" causeId: "+e.causeId)}const i=this._reasonForCallEndedInfo(e,t);if(i!==b.UnansweredCallReason.None)return c.log(u.LogTraceArea.UnansweredCall,"Computed UCUX result callId: "+e.callId+" reason: "+b.UnansweredCallReason[i]+" causeId: "+e.causeId),this._endedCalls[e.callId]=e,{reason:i,actions:T._actionsForUnansweredCall(i,e.conversationMri,this._showSendFeedbackOption()),title:T._titleForUnansweredCall(i,e.conversationMri),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:T._visualInfoForUnasnweredCall(i),optionalSecondaryMessage:T._secondaryMessageForUnansweredCall(i,t)};c.log(u.LogTraceArea.UnansweredCall,"Skipping UCUX - success callId: "+e.callId+" causeId: "+e.causeId)}kickCallOptions(e,t){const i=b.UnansweredCallReason.Kicked;return c.log(u.LogTraceArea.UnansweredCall,"Computed kick UCUX result callId: "+e.callId+" reason: "+b.UnansweredCallReason[i]+" causeId: "+e.causeId),this._endedCalls[e.callId]=e,{reason:i,actions:[{action:b.UnansweredCallAction.None}],title:T._titleForUnansweredCall(i,e.conversationMri,t),originalCallId:e.callId,originalConversationMri:e.conversationMri,visualInfo:T._visualInfoForUnasnweredCall(i,t)}}_resetUnknownReasonCounter(){this._unknownReasonTimestamps=[]}_incrementUnknownReasonCounter(e){this._unknownReasonTimestamps.push(e)}_showSendFeedbackOption(){const e=this._unknownReasonTimestamps.length;if(g.default.isChild()||e<3)return!1;const t=this._unknownReasonTimestamps.slice(e-3,e);return(t[2]-t[0])/1e3<=300}_reasonForAddParticipantFailedInfo(e){let t=b.UnansweredCallReason.None;switch(e.participantInfo.reason){case n.ParticipantStateReason.PstnSkypeoutAccountBlocked:t=b.UnansweredCallReason.PstnSkypeoutAccountBlocked;break;case n.ParticipantStateReason.PstnCouldNotConnectToSkypeProxy:t=b.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy;break;case n.ParticipantStateReason.PstnBlockedByUs:t=b.UnansweredCallReason.PstnBlockedByUs;break;case n.ParticipantStateReason.PstnNumberForbidden:t=b.UnansweredCallReason.PstnNumberForbidden;break;case n.ParticipantStateReason.PstnCallTerminated:t=b.UnansweredCallReason.PstnCallTerminated;break;case n.ParticipantStateReason.PstnNumberUnavailable:t=b.UnansweredCallReason.PstnNumberUnavailable;break;case n.ParticipantStateReason.Declined:case n.ParticipantStateReason.Busy:t=b.UnansweredCallReason.DeclineParticipant;break;case n.ParticipantStateReason.PstnInsufficientFunds:case n.ParticipantStateReason.PstnNoSubscriptionCover:case n.ParticipantStateReason.PstnCreditExpired:case n.ParticipantStateReason.PstnCreditExpiredButEnough:t=b.UnansweredCallReason.InsufficientFunds;break;case n.ParticipantStateReason.PstnBlockedRegulatoryIndia:t=b.UnansweredCallReason.BlockedRegulatoryIndia;break;case n.ParticipantStateReason.PstnInvalidNumber:t=b.UnansweredCallReason.InvalidNumber}return m.default.isPstnNetherlandsReason(e.participantInfo.callEndDiagnosticsInfo)&&(t=b.UnansweredCallReason.BlockedRegulatoryNetherlands),t}_reasonForCallEndedInfo(e,t){const i=e.failureType===n.FailureType.CallSetupFailed||0===e.durationSeconds&&e.failureType!==n.FailureType.CallDropped,o=(Date.now()-t.callCreationTime)/1e3;let s=b.UnansweredCallReason.Unknown;switch(e.terminatedReason){case n.TerminatedReason.Success:s=C.isThread(e.conversationMri)&&0===t.maxConnectedParticipants?b.UnansweredCallReason.NoAnswer:b.UnansweredCallReason.None;break;case n.TerminatedReason.Cancelled:s=o>15?b.UnansweredCallReason.NoAnswer:b.UnansweredCallReason.None;break;case n.TerminatedReason.NoNgcEndpoint:case n.TerminatedReason.NoSignalingFromPeer:case n.TerminatedReason.TemporarilyUnavailable:s=b.UnansweredCallReason.Unreachable;break;case n.TerminatedReason.NetworkError:case n.TerminatedReason.MediaDroppedError:case n.TerminatedReason.LocalHttpStackError:case n.TerminatedReason.NetworkRequestTimeoutError:case n.TerminatedReason.CannotConnectToNetworkError:case n.TerminatedReason.MediaRelayWhiteListingIssue:i?(_.default.onCallNetworkErrorReason(e.callId,e.terminatedReason),s=b.UnansweredCallReason.LocalNetworkError):s=b.UnansweredCallReason.None;break;case n.TerminatedReason.CallSetupError:t.hasMicrophones||(s=b.UnansweredCallReason.NoMicrophoneDetected);break;case n.TerminatedReason.PstnSkypeoutAccountBlocked:s=b.UnansweredCallReason.PstnSkypeoutAccountBlocked;break;case n.TerminatedReason.PstnCouldNotConnectToSkypeProxy:s=b.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy;break;case n.TerminatedReason.PstnBlockedByUs:s=b.UnansweredCallReason.PstnBlockedByUs;break;case n.TerminatedReason.PstnNumberForbidden:s=b.UnansweredCallReason.PstnNumberForbidden;break;case n.TerminatedReason.PstnCallTerminated:s=b.UnansweredCallReason.PstnCallTerminated;break;case n.TerminatedReason.PstnNumberUnavailable:s=b.UnansweredCallReason.PstnNumberUnavailable;break;case n.TerminatedReason.NoPermission:const r=l.default.permissionStatus(p.PermissionType.Microphone)===a.PermissionStatus.Granted,d=l.default.permissionStatus(p.PermissionType.Camera)===a.PermissionStatus.Granted,h=l.default.permissionStatus(p.PermissionType.ReadPhoneState)===a.PermissionStatus.Granted;if(!e.withVideo||r||d)if(r)if(d)if(h){const e="TerminatedReason.NoPermission, yet cannot identify what permissions are lacking";c.error(u.LogTraceArea.UnansweredCall,e)}else s=b.UnansweredCallReason.ReadPhoneStatePermissionDenied;else{const e="Never show 'CameraPermissionDenied' if 'withVideo' is false";c.error(u.LogTraceArea.UnansweredCall,e),s=b.UnansweredCallReason.CameraPermissionDenied}else s=b.UnansweredCallReason.MicrophonePermissionDenied;else s=b.UnansweredCallReason.MicAndCamPermissionDenied;break;case n.TerminatedReason.Missed:s=b.UnansweredCallReason.NoAnswer;break;case n.TerminatedReason.Declined:case n.TerminatedReason.Busy:s=b.UnansweredCallReason.Decline;break;case n.TerminatedReason.PstnInvalidNumber:s=b.UnansweredCallReason.InvalidNumber;break;case n.TerminatedReason.PstnEmergencyCallDenied:s=b.UnansweredCallReason.EmergencyCallDenied;break;case n.TerminatedReason.Kicked:s=b.UnansweredCallReason.Kicked;break;case n.TerminatedReason.PstnInsufficientFunds:case n.TerminatedReason.PstnNoSubscriptionCover:case n.TerminatedReason.PstnCreditExpired:case n.TerminatedReason.PstnCreditExpiredButEnough:s=b.UnansweredCallReason.InsufficientFunds;break;case n.TerminatedReason.PstnBlockedRegulatoryIndia:s=b.UnansweredCallReason.BlockedRegulatoryIndia;break;case n.TerminatedReason.Undefined:s=b.UnansweredCallReason.None}return i||(s=b.UnansweredCallReason.None),s===b.UnansweredCallReason.Unknown?this._incrementUnknownReasonCounter(t.callCreationTime):this._resetUnknownReasonCounter(),s}static _secondaryMessageForUnansweredCall(e,t){if(e===b.UnansweredCallReason.NoMicrophoneDetected)return d.getString("UnansweredCallTitle.NoMicDetectedMessage")}static _titleForUnansweredCall(e,t,i){const a=r.default.getShortDisplayName(t)||d.getString("UnansweredCallTitle.UnknownCallee");switch(e){case b.UnansweredCallReason.NoAnswer:case b.UnansweredCallReason.Decline:return C.isGroupConversation(t)?d.getString("UnansweredCallTitle.NoAnswerGroup"):d.getString("UnansweredCallTitle.Decline",{name:a});case b.UnansweredCallReason.DeclineParticipant:return d.getString("UnansweredCallTitle.Decline",{name:a});case b.UnansweredCallReason.Unreachable:return d.getString("UnansweredCallTitle.Unreachable",{name:a});case b.UnansweredCallReason.LocalNetworkError:return d.getString("UnansweredCallTitle.NetworkError");case b.UnansweredCallReason.MicrophonePermissionDenied:return d.getString("UnansweredCallTitle.NoMicrophonePermission");case b.UnansweredCallReason.CameraPermissionDenied:return d.getString("UnansweredCallTitle.NoCameraPermission");case b.UnansweredCallReason.MicAndCamPermissionDenied:return d.getString("UnansweredCallTitle.NoMicAndCamPermission");case b.UnansweredCallReason.Kicked:{const e=this._getKickedPrimaryMessage(i);return e||d.getString("CallControls.RemovedFromCallMessage")}case b.UnansweredCallReason.NoMicrophoneDetected:return d.getString("UnansweredCallTitle.NoMicDetected");case b.UnansweredCallReason.EmergencyCallDenied:return d.getString("PstnUtils.EmergencyCallDenied");case b.UnansweredCallReason.BlockedRegulatoryIndia:return d.getString("PstnUtils.BlockedRegulatoryIndia");case b.UnansweredCallReason.BlockedRegulatoryNetherlands:return d.getString("PstnUtils.BlockedRegulatoryNetherlands");case b.UnansweredCallReason.PstnBlockedByUs:return d.getString("PstnUtils.BlockedByUs");case b.UnansweredCallReason.PstnSkypeoutAccountBlocked:return d.getString("PstnUtils.SkypeoutAccountBlocked");case b.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy:return d.getString("PstnUtils.CouldNotConnectToSkypeProxy");case b.UnansweredCallReason.PstnNumberForbidden:return d.getString("PstnUtils.NumberForbidden");case b.UnansweredCallReason.PstnCallTerminated:return d.getString("PstnUtils.CallTerminated");case b.UnansweredCallReason.PstnNumberUnavailable:return d.getString("PstnUtils.NumberUnavailable");case b.UnansweredCallReason.InvalidNumber:return d.getString("PstnUtils.InvalidNumber");case b.UnansweredCallReason.Unknown:return d.getString("UnansweredCallTitle.OtherError");case b.UnansweredCallReason.TransferedToTwinCam:return d.getString("CallControls.RemovedFromCallByTwinCam");case b.UnansweredCallReason.ReadPhoneStatePermissionDenied:return d.getString("UnansweredCallTitle.NoReadPhoneStatePermission")}return d.getString("UnansweredCallTitle.OtherError")}static _actionsForUnansweredCall(e,t,i){switch(e){case b.UnansweredCallReason.NoAnswer:case b.UnansweredCallReason.Unreachable:return[{action:b.UnansweredCallAction.SendMessage,prepopulatedMessage:T._chatMessagesForReason(e,t)},{action:b.UnansweredCallAction.CallPSTN}];case b.UnansweredCallReason.Decline:return[{action:b.UnansweredCallAction.SendMessage,prepopulatedMessage:T._chatMessagesForReason(e,t)}];case b.UnansweredCallReason.LocalNetworkError:return[{action:b.UnansweredCallAction.SendMessage}];case b.UnansweredCallReason.Kicked:return[{action:b.UnansweredCallAction.None}];case b.UnansweredCallReason.Unknown:const a=[{action:b.UnansweredCallAction.SendMessage,message:""}];return i?a.concat({action:b.UnansweredCallAction.SendFeedback,message:d.getString("FeedbackMechanism.FeedbackDialogTitle")}):a;case b.UnansweredCallReason.MicrophonePermissionDenied:case b.UnansweredCallReason.CameraPermissionDenied:case b.UnansweredCallReason.MicAndCamPermissionDenied:case b.UnansweredCallReason.ReadPhoneStatePermissionDenied:return[{action:b.UnansweredCallAction.PromptForPermission}];case b.UnansweredCallReason.BlockedRegulatoryIndia:return[{action:b.UnansweredCallAction.ShowRegulatoryInfoIndia}];case b.UnansweredCallReason.BlockedRegulatoryNetherlands:return[{action:b.UnansweredCallAction.ShowRegulatoryInfoNetherlands}]}return[]}static _chatMessagesForReason(e,t){if(!C.isThread(t))switch(e){case b.UnansweredCallReason.NoAnswer:case b.UnansweredCallReason.Decline:return d.getString("UnansweredCallChatMessages.CallMeBack")}}static _visualInfoForUnasnweredCall(e,t){switch(e){case b.UnansweredCallReason.Decline:case b.UnansweredCallReason.NoAnswer:case b.UnansweredCallReason.Unreachable:return{type:b.UnansweredCallVisualInfoType.Emoticon,name:"call"};case b.UnansweredCallReason.Kicked:case b.UnansweredCallReason.Unknown:if(t){const e=S.default.parseCallEventReaction(t);if(e&&e.eventType===p.ReactionsTextType.CallEventTransfer)return{type:b.UnansweredCallVisualInfoType.Emoticon,name:"yes"}}return{type:b.UnansweredCallVisualInfoType.Emoticon,name:"cry"};case b.UnansweredCallReason.NoMicrophoneDetected:return{type:b.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.MicrophoneOff};case b.UnansweredCallReason.LocalNetworkError:return{type:b.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.CallQualityIndicator};case b.UnansweredCallReason.MicAndCamPermissionDenied:case b.UnansweredCallReason.MicrophonePermissionDenied:return{type:b.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.MicrophoneOff};case b.UnansweredCallReason.CameraPermissionDenied:return{type:b.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.VideoOff};case b.UnansweredCallReason.EmergencyCallDenied:case b.UnansweredCallReason.BlockedRegulatoryIndia:case b.UnansweredCallReason.BlockedRegulatoryNetherlands:return{type:b.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.CallBlockedFilled};case b.UnansweredCallReason.PstnBlockedByUs:case b.UnansweredCallReason.PstnCallTerminated:case b.UnansweredCallReason.PstnCouldNotConnectToSkypeProxy:case b.UnansweredCallReason.PstnNumberForbidden:case b.UnansweredCallReason.PstnNumberUnavailable:case b.UnansweredCallReason.PstnSkypeoutAccountBlocked:case b.UnansweredCallReason.InvalidNumber:return{type:b.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.CallErrorFilled};case b.UnansweredCallReason.ReadPhoneStatePermissionDenied:return{type:b.UnansweredCallVisualInfoType.Icon,name:h.SkypeIcon.CallBlockedFilled};case b.UnansweredCallReason.None:return}}static _getKickedPrimaryMessage(e){if(!o.default.getS4LCMCFeaturesNoSubscription().enableNotifyUsersMuteKick)return;if(!e||!S.default.isCallEventReaction(e))return;const t=S.default.parseCallEventReaction(e);if(!t)return;const i=T._getUserName(t.mri);return t.eventType===p.ReactionsTextType.CallEventTransfer?d.getString("CallControls.RemovedFromCallByTwinCam"):d.getString("CallControls.RemovedFromCallMessageWithName",{name:i})}static _getUserName(e){const t=C.sanitizeMri(e,C.Namespaces.SkypeId);return r.default.getDisplayName(t)||d.getString("Notifications.UnknownUserShort")}}const v=new T;t.default=v},342046:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.countInactivePstnParticipantInThread=void 0;const a=i(671830);t.countInactivePstnParticipantInThread=function(e,t){return t.filter((t=>a.isPhoneMri(t.id)&&!e.includes(t.id))).length}},614833:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.useMicrophoneLevel=void 0;const a=i(667294),n=i(912770),o=i(994224);t.useMicrophoneLevel=e=>{const[t,i]=(0,a.useState)(0);return(0,a.useEffect)((()=>{const t=n.default.setInterval((()=>{o.default.DeviceStore.getMicrophoneVolumeLevel().then((e=>{i(null!=e?e:0)}))}),e);return()=>{n.default.clearInterval(t)}}),[e]),t}},469309:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(397691),o=i(889391),s=i(351077),r=i(671830),l=i(562141),c=i(746096),d=i(897811),u=i(617379),h=i(436237),p=i(422538),g=i(404057),C="CallCaptionsCleanupStarted",S="CallCaptionsCleanupFailure";t.default=new class{constructor(){this._isCleanupInProgress=!1,this._doCallCaptionsCleanup=()=>(u.default.queueIdleTask("Scheduling call captions cleanup",u.TaskTypeFlags.CpuIntensive|u.TaskTypeFlags.UsesNetworking,(()=>{try{return o.default.getS4LCMCFeaturesNoSubscription().isCallCaptionsCleanupEnabled?l.default.getLastCallCaptionsCleanupTimestamp().then(this._isCallCaptionsCleanupRequired).then(this._cleanupCallCaptions).catch((e=>{h.track(new d.FundamentalsDebugEvent(S,"FailureInPromise")),this._logError("Call captions cleanup failed. Error: "+g.default.errorAsString(e))})):(this._logInfo("Call captions cleanup disabled."),n.Resolved())}catch(e){return h.track(new d.FundamentalsDebugEvent(S,"FailureInWrapperCatch")),this._logError("Call captions cleanup failed. Error: "+g.default.errorAsString(e)),n.Rejected()}})),n.Resolved()),this._isCallCaptionsCleanupRequired=e=>{if(this._isCleanupInProgress)return!1;if(!e)return h.track(new d.FundamentalsDebugEvent(C,"FirstRun")),this._logInfo("Call captions cleanup not yet done."),!0;return!!(e<this._parseCleanupValidTimestamp())&&(h.track(new d.FundamentalsDebugEvent(C,"Expired")),this._logInfo("Call captions cleanup expired. Need for another cleanup."),!0)},this._parseCleanupValidTimestamp=()=>{const e=o.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupValidDate,t=Date.parse(e);return isNaN(t)?0:t},this._cleanupCallCaptions=e=>e?(this._isCleanupInProgress=!0,n.all([this._setCaptionsCleanupStartTimestamp(),this._processCaptionsCleanup(),this._processConversationCleanup()]).then(this._completeCleanup)):(this._logInfo("Call captions - cleanup valid. No need for another cleanup."),n.Resolved()),this._setCaptionsCleanupStartTimestamp=()=>l.default.openTransaction([l.Stores.InternalData],!0).then((e=>e.getCallCaptionsCleanupStartTimestamp().then((t=>t?n.Resolved():e.setCallCaptionsCleanupStartTimestamp())).then((()=>e.markCompleted()),(e=>{this._logError(`Call captions - Set startTimestamp failed. Error: ${g.default.errorAsString(e)}`)})))),this._processCaptionsCleanup=()=>{const e=n.Defer(),t=o.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupBatchSize;return this._cleanMessageCaptionsAsync(e,0,t),e.promise()},this._cleanMessageCaptionsAsync=(e,t,i)=>{u.default.queueIdleTask("Clean Messages startIndex: "+t,u.TaskTypeFlags.CpuIntensive|u.TaskTypeFlags.UsesNetworking,(()=>{l.default.getAllMessages(i,t).then((n=>{if(0===n.length)return this._logInfo("Call captions - cleanup finished"),void e.resolve();const o=this._filterCallCaptionMessageType(n);if(a.isEmpty(o)){const a=t+i;this._logInfo(`Call captions - 0 to delete. Moving offset to ${a}`),this._cleanMessageCaptionsAsync(e,a,i)}else this._removeCaptions(o).then((()=>{let a=t+(i-o.length);a<0&&(a=0),this._logInfo(`Call captions - ${o.length} deleted. Moving offset to ${a}`),this._cleanMessageCaptionsAsync(e,a,i)}))}))}))},this._processConversationCleanup=()=>{const e=n.Defer(),t=o.default.getS4LCMCFeaturesNoSubscription().callCaptionsCleanupBatchSize;return this._cleanConversationsAsync(e,0,t),e.promise()},this._cleanConversationsAsync=(e,t,i)=>{l.default.getAllConversationMetas(i,t).then((n=>{if(0===n.length)return this._logInfo("Conversations - lastMessage captions cleanup finished."),void e.resolve();u.default.queueIdleTask("Clean conversation last message startIndex: "+t,u.TaskTypeFlags.CpuIntensive|u.TaskTypeFlags.UsesNetworking,(()=>{const o=this._filterCallCaptionConversationType(n);a.isEmpty(o)?this._cleanConversationNext(e,t,i,0):this._cleanConversationsLastMessage(o).then((()=>{this._cleanConversationNext(e,t,i,o.length)}))}))}))},this._filterCallCaptionMessageType=e=>{const t=a.filter(e,(e=>s.isCaptionMessageType(e.messagetype)));return this._logInfo("Call captions - filtering captions message type. Found "+t.length+" captions."),t},this._filterCallCaptionConversationType=e=>{const t=a.filter(e,(e=>(0,r.isReactionsThread)(e.conv.id)&&!!e.conv.lastMessage&&s.isCaptionMessageType(e.conv.lastMessage.messagetype)));return this._logInfo(`Conversations - filtering caption conversation type. Found ${t.length} captions conversations.`),t},this._removeCaptions=e=>l.default.openTransaction([l.Stores.Messages],!0).then((t=>t.removeMessages(e).then((()=>{t.markCompleted(),this._logInfo("Call captions - remove batch finished.")}),(e=>(this._logError(`Call captions - remove batch failed. Error: ${g.default.errorAsString(e)}`),n.Rejected(e)))))),this._cleanConversationsLastMessage=e=>(e=a.map(e,(e=>e.updateConversation(e.conv.dropLastMessage()))),l.default.openTransaction([l.Stores.Conversations],!0).then((t=>t.putConversationMetas(e).then((()=>{t.markCompleted(),this._logInfo("Conversations - update batch finished.")}),(e=>(this._logError(`Conversations - update batch failed. Error: ${g.default.errorAsString(e)}`),n.Rejected(e))))))),this._completeCleanup=()=>l.default.openTransaction([l.Stores.InternalData],!0).then((e=>e.getCallCaptionsCleanupStartTimestamp().then((e=>{if(e){const t=Date.now()-e;h.track(new d.FundamentalsDebugEvent("CallCaptionsCleanupTime",t.toString())),this._logInfo(`Captions and conversations cleanup execution time: ${t}ms.`)}})).then((()=>e.deleteCallCaptionsCleanupStartTimestamp())).then((()=>e.setCallCaptionsCleanupEndTimestamp())).then((()=>{this._isCleanupInProgress=!1,e.markCompleted(),this._logInfo("Captions and conversations cleanup finished.")}),(e=>(this._logError(`Captions and conversations cleanup failed. Error: ${g.default.errorAsString(e)}`),n.Rejected(e)))))),this._logInfo=e=>{h.log(c.LogTraceArea.GenericUnsafe,`[CaptionsCleanup] ${e}`)},this._logError=e=>{h.error(c.LogTraceArea.GenericUnsafe,`[CaptionsCleanup] ${e}`)},this.test_doCallCaptionsCleanup=()=>this._doCallCaptionsCleanup(),p.RegisterStartupable(this,"CallCaptionsCleanupService")}startup(){return o.default.subscribe(this._doCallCaptionsCleanup),this._doCallCaptionsCleanup(),n.Resolved()}_cleanConversationNext(e,t,i,a){const n=t+i;this._logInfo(`Conversations - ${a} updated. Moving offset to ${n}`),this._cleanConversationsAsync(e,n,i)}}},403986:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(805984),o=i(397691),s=i(889391),r=i(994224),l=i(671830),c=i(898278),d=i(651129),u=i(746096),h=i(436237),p=i(704329),g=i(104735),C=i(527683),S=i(789871),m=i(422538),y=i(404057),f=i(853374),b="tel:";t.default=new class{constructor(){this._processIntentEvent=e=>{const t=f.default.newCauseId();h.log(u.LogTraceArea.DialerPanel,`CallIntentService._processIntentEvent eventType=${e.type} causeId: ${t}`),e.number&&a.startsWith(e.number,b)&&(e.number=e.number.replace(b,""));const i=e.number&&y.default.safeDecodeURIComponent(e.number),o=C.default.isPossiblyPhoneNumber(i)?e.number:void 0;if(e.type===n.IntentEventType.contactMessage&&e.skypeId){const i=l.sanitizeMri(e.skypeId,l.Namespaces.SkypeId);g.default.navigateToConversation({convId:i,causeId:t,origin:u.NavigationConversationOrigin.NativeContactIntent})}else if(e.type!==n.IntentEventType.contactAudio&&e.type!==n.IntentEventType.contactVideo||!e.skypeId)if(e.type===n.IntentEventType.contactPhone&&i&&o&&(d.default.isE164Format(i)||s.default.getS4LCommerceFeatures().callIntent.allowNonE164NumberCalls)){S.default.initializeCountrySelection(),S.default.overwritePhoneNumberInput(o,!1);const e=S.default.getPhoneNumber(S.TriggerKeys.E164),i=l.sanitizeMri(e.E164,l.Namespaces.PSTN);r.default.CallNavigationHelper.startCall({conversationMri:i,withVideo:!1,origin:u.NavigationCallOrigin.NativeContactIntent},t)}else g.default.navigateToPSTNDialerWithParams({causeId:t,navigationSource:u.DialerNavigationSource.CallIntent,prefilledNumber:o},c.MainRootViewId);else{const i=l.sanitizeMri(e.skypeId,l.Namespaces.SkypeId);r.default.CallNavigationHelper.startCall({conversationMri:i,withVideo:"contactVideo"===e.type,origin:u.NavigationCallOrigin.NativeContactIntent},t)}},m.RegisterStartupable(this,"CallIntentService"),p.default.registerForLogout(this,"CallIntentService")}startup(){return n.default.setListener(this._processIntentEvent),o.Resolved()}test_processIntentEvent(e){this._processIntentEvent(e)}logout(e,t,i){return n.default.removeListener(),o.Resolved()}}},691789:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(598925),n=i(103933),o=i(322418),s=i(129273),r=i(994224),l=i(853374),c=i(436237),d=i(746096),u=i(889391),h=i(201990);t.default=new class{constructor(){this._translationStateUpdated=e=>{const t=l.default.newCauseId(),i=u.default.getS4LCMCFeaturesNoSubscription().translationFeatures.toastTimeout,o=n.default.getInCallFeatureState(e);switch(null==o?void 0:o.state){case a.InCallFeatureState.Disabled:case a.InCallFeatureState.SelfConsentRejected:r.default.InCallBotService.isSkypeTranslationEnabled(e)&&r.default.InCallBotService.stopSkypeTranslation(e,t);break;case a.InCallFeatureState.Failed:case a.InCallFeatureState.RemoteFailed:s.removeAll(),s.addErrorMessage(e),r.default.InCallBotService.isSkypeTranslationEnabled(e)&&r.default.InCallBotService.stopSkypeTranslation(e,t);break;case a.InCallFeatureState.SelfConsentRequested:s.removeAll(),s.addTranslationConsentMessage(e,[()=>{n.default.requestProvideConsent(e)},()=>{n.default.requestRejectConsent(e),h.translationAutoDetectDisable(e)}]);break;case a.InCallFeatureState.RemoteConsentRequested:s.removeAll(),s.addTranslationConsentSentMessage(e,[()=>{},()=>{n.default.requestStopFeature(e)}]);break;case a.InCallFeatureState.RemoteConsentCancelled:s.removeAll(),s.addTranslationCancelledMessage(e,i),r.default.InCallBotService.isSkypeTranslationEnabled(e)&&r.default.InCallBotService.stopSkypeTranslation(e,t);break;case a.InCallFeatureState.ConsentRequestedByRemote:s.removeAll(),s.addTranslationConsentQuestionMessage(e,o.requestedBy,[()=>{n.default.requestProvideConsent(e)},()=>{n.default.requestRejectConsent(e)}]);break;case a.InCallFeatureState.RemoteConsentRejected:s.removeAll(),s.addTranslationRejectedMessage(e,i),r.default.InCallBotService.isSkypeTranslationEnabled(e)&&r.default.InCallBotService.stopSkypeTranslation(e,t);break;case a.InCallFeatureState.StoppedByRemote:s.removeAll(),r.default.InCallBotService.isSkypeTranslationEnabled(e)?r.default.InCallBotService.stopSkypeTranslation(e,t).always((()=>{s.addTranslationStoppedMessage(e,o.requestedBy,i)})):s.addTranslationStoppedMessage(e,o.requestedBy,i);break;case a.InCallFeatureState.Stopped:s.removeAll(),r.default.InCallBotService.isSkypeTranslationEnabled(e)&&r.default.InCallBotService.stopSkypeTranslation(e,t).then((()=>{s.addTranslationStoppedMessage(e,void 0,i)})).catch((e=>{c.error(d.LogTraceArea.InCallBotService,"Translator stop failed with: "+JSON.stringify(e))}));break;case a.InCallFeatureState.NotSupported:s.removeAll(),s.addTranslationNotSuppportedMessage(e,[()=>{}],i);break;case a.InCallFeatureState.Enabled:h.translationAutoDetectEnableOnFirstConsent(e),r.default.InCallBotService.isSkypeTranslationEnabled(e)||r.default.InCallBotService.startSkypeTranslation(e,t).then((()=>{s.addTranslationEnabledMessage(e,void 0,i)}));break;case a.InCallFeatureState.EnabledByRemote:h.translationAutoDetectEnableOnFirstConsent(e),r.default.InCallBotService.isSkypeTranslationEnabled(e)||r.default.InCallBotService.startSkypeTranslation(e,t).then((()=>{s.addTranslationEnabledMessage(e,o.requestedBy,i)}))}},this._truVoiceStateUpdated=e=>{const t=l.default.newCauseId(),i=u.default.getS4LCMCFeaturesNoSubscription().translationFeatures.toastTimeout,n=o.default.getInCallFeatureState(e);switch(null==n?void 0:n.state){case a.InCallFeatureState.SelfConsentRequested:s.removeAll(),s.addTruVoiceConsentMessage(e,[()=>{o.default.requestProvideConsent(e)},()=>{o.default.requestRejectConsent(e),h.truVoiceDisable(e)}]);break;case a.InCallFeatureState.RemoteConsentRequested:s.removeAll(),s.addTruVoiceConsentSentMessage(e,[()=>{},()=>{o.default.requestStopFeature(e),h.truVoiceDisable(e)}]);break;case a.InCallFeatureState.RemoteConsentCancelled:s.removeAll(),s.addTruVoiceCancelledMessage(e,i);break;case a.InCallFeatureState.ConsentRequestedByRemote:s.removeAll(),s.addTruVoiceConsentQuestionMessage(e,n.requestedBy,[()=>{o.default.requestProvideConsent(e)},()=>{o.default.requestRejectConsent(e)}]);break;case a.InCallFeatureState.RemoteConsentRejected:h.truVoiceDisable(e),s.removeAll(),s.addTruVoiceRejectedMessage(e,i);break;case a.InCallFeatureState.StoppedByRemote:h.truVoiceDisable(e),r.default.InCallBotService.refreshConfig(e,t),s.removeAll(),s.addTruVoiceStoppedMessage(e,n.requestedBy,i);break;case a.InCallFeatureState.Stopped:h.truVoiceDisable(e),r.default.InCallBotService.refreshConfig(e,t),s.removeAll(),s.addTruVoiceStoppedMessage(e,void 0,i);break;case a.InCallFeatureState.NotSupported:break;case a.InCallFeatureState.Enabled:h.truVoiceEnable(e),r.default.InCallBotService.refreshConfig(e,t),s.removeAll(),s.addTruVoiceEnabledMessage(e,void 0,i);break;case a.InCallFeatureState.EnabledByRemote:h.truVoiceEnable(e),r.default.InCallBotService.refreshConfig(e,t),s.removeAll(),s.addTruVoiceEnabledMessage(e,n.requestedBy,i)}}}start(e){u.default.getS4LCMCFeaturesNoSubscription().translationFeatures.enableConsentListener&&(n.default.startTracking(e),o.default.startTracking(e),this._translationStateSub=n.default.stateUpdatedEvent().subscribe(this._translationStateUpdated),this._truVoiceStateSub=o.default.stateUpdatedEvent().subscribe(this._truVoiceStateUpdated))}stop(e){u.default.getS4LCMCFeaturesNoSubscription().translationFeatures.enableConsentListener&&(n.default.stopTracking(e),o.default.stopTracking(e),this._translationStateSub&&this._translationStateSub.unsubscribe(),this._truVoiceStateSub&&this._truVoiceStateSub.unsubscribe())}}},962484:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(148540),n=i(994224),o=i(129273),s=i(805581),r=i(436237),l=i(746096),c=i(853374),d=i(671830),u=i(46929),h=i(889391),p=i(201990),g=i(458666);t.default=new class{constructor(){this._participantUpdateSubscription={},this._participantLanguage={},this._lastSeen={},this._stop=(e,t)=>n.default.InCallBotService.stopSkypeTranslationConsent(e,t),this._pause=(e,t,i)=>n.default.InCallBotService.setSkypeTranslationPause(e,t,i),this._isPaused=e=>n.default.InCallBotService.isSkypeTranslationPaused(e),this._getVariant=()=>h.default.getS4LCMCFeaturesNoSubscription().skypeTranslation.variantB,this._participantChanged=(e,t)=>{t.state===a.ParticipantState.Connected&&s.default.getCallTranslatorBotMriFilter().includes(t.id)&&t.endpoints&&t.endpoints.endpointDetails.map((t=>{var i;const a=null===(i=t.endpointMetadata)||void 0===i?void 0:i.detectedSpokenLanguage;if(a){if(a.timestamp<=this._lastSeen[e])return;this._lastSeen[e]=a.timestamp;const t=a.participantId;if(!this._acceptedParticipant(e,t))return;if(a.isFailure)r.log(l.LogTraceArea.InCallBotService,`[LID] FAILED to detect language for ${a.participantId}, Previous language: ${a.language}, Timestamp: ${a.timestamp}`),this._unableDetectLanguage(e,t);else{r.log(l.LogTraceArea.InCallBotService,`[LID] Language detected for ${a.participantId}, Previous language: ${a.previousLanguage}, New language: ${a.language}, Confidence: ${a.confidence}, Timestamp: ${a.timestamp}`);const i=this._getCurrentLanguage(e,t);if(this._languageDetectionSuccess(i,a)){const n=a.language.toLowerCase();this._languageDetected(e,t,i,n)}}}}))}}start(e){h.default.getS4LCMCFeaturesNoSubscription().translationFeatures.automaticLangDetection&&(o.removeAll(e),this._participantLanguage[e]={},this._participantUpdateSubscription[e]=n.default.CallingStore.participantUpdatedEvent().subscribe(this._participantChanged),this._lastSeen[e]=0)}stop(e){h.default.getS4LCMCFeaturesNoSubscription().translationFeatures.automaticLangDetection&&(this._participantUpdateSubscription[e]&&(this._participantUpdateSubscription[e].unsubscribe(),delete this._participantUpdateSubscription[e]),o.removeAll(e),delete this._participantLanguage[e],delete this._lastSeen[e])}setUpMenu(e){this._setUpMenu=e}_languageDetectionSuccess(e,t){const i=g.getLocaleStandardized(t.language.toLowerCase());return!!s.default.isLanguageSupportedForTranslation(i)&&(void 0===e||e!==i&&("high"===t.confidence.toLowerCase()||parseFloat(t.confidence)>.5))}_isAllSameLangs(e){const t=n.default.CallingStore.getCallConversationMri(e);if(this._isPstn(e)){const e=s.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(t),i=s.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(t);return r.log(l.LogTraceArea.InCallBotService,`_isAllSameLangs, pstn mode, comparing langs local: ${e} and remote: ${i}`),(null==e?void 0:e.toLowerCase())===(null==i?void 0:i.toLowerCase())}const i=s.default.getCallTranslatorSpokenLanguage(t),a=g.getLanguageFromLocale(i),o=n.default.InCallBotService.getTranslatorBotSenders(e).map((e=>e.locale));return r.log(l.LogTraceArea.InCallBotService,`_isAllSameLangs, skype mode, comparing langs local: ${i} and remotes: ${o.join(",")}`),o.every((e=>g.getLanguageFromLocale(e).toLowerCase()===a.toLowerCase()))}_unableDetectLanguage(e,t){const i=this._getVariant(),a=c.default.newCauseId();if(i){const i=c.default.newCauseId();this._pause(e,!0,i),o.addUnableDetectLanguageMessage(e,t,[()=>{this._pause(e,!1,i)},()=>{var t;p.translationAutoDetectDisable(e),null===(t=this._setUpMenu)||void 0===t||t.call(this)}],!0)}else o.addUnableDetectLanguageMessage(e,t,[()=>{var t;p.translationAutoDetectDisable(e),null===(t=this._setUpMenu)||void 0===t||t.call(this)},()=>{this._stop(e,a)}],!1)}_languageDetected(e,t,i,a){const n=this._getVariant(),s=c.default.newCauseId();if(n){const n=a;this._changeLanguageForParticipant(e,t,n),this._isPaused(e)&&this._pause(e,!1,s),o.addLanguageChangeDetectedMessage(e,t,a,[i?()=>{const a=i;this._changeLanguageForParticipant(e,t,a)}:void 0],!0),this._isAllSameLangs(e)&&this._sameLanguage(e)}else o.addLanguageChangeDetectedMessage(e,t,a,[()=>{const i=a;this._changeLanguageForParticipant(e,t,i),this._isPaused(e)&&this._pause(e,!1,s),this._isAllSameLangs(e)&&this._sameLanguage(e)}],!1)}_sameLanguage(e){const t=this._getVariant(),i=c.default.newCauseId();t?o.addSameLanguageMessage(e,[()=>{this._pause(e,!1,i)},()=>{}],!0):o.addSameLanguageMessage(e,[()=>{this._stop(e,i)},()=>{}],!1)}_acceptedParticipant(e,t){const i=this._isPstn(e),a=n.default.CallingStore.getParticipantId(e);return!!(t===a&&!i||t===a&&i||t!==a&&i)}_isPstn(e){const t=n.default.CallingStore.getCallConversationMri(e);return t&&d.isPhoneMri(t)&&n.default.InCallBotService.isPstnTranslationEnabled(e)}_getCurrentLanguage(e,t){const i=n.default.CallingStore.getCallConversationMri(e),a=this._isPstn(e),o=n.default.CallingStore.getParticipantId(e);return t===o&&i&&!a?s.default.getCallTranslatorSpokenLanguage(i):t===o&&i&&a?s.default.getLocalPstnCallTranlatorBotSpokenLanguageLocale(i):t!==o&&i&&a?s.default.getOtherPstnCallTranlatorBotSpokenLanguageLocale(i):void 0}_changeLanguageForParticipant(e,t,i){const a=n.default.CallingStore.getCallConversationMri(e),o=this._isPstn(e),r=n.default.CallingStore.getParticipantId(e);t===r&&u.default.setCallTranslatorBotSubtitleLanguageLocale(i),t===r&&a&&!o?s.default.setCallTranslatorSpokenLanguage(a,i):t===r&&a&&o?s.default.setLocalPstnCallTranlatorBotSpokenLanguageLocale(a,i):t!==r&&a&&o&&s.default.setOtherPstnCallTranlatorBotSpokenLanguageLocale(a,i)}}},162859:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(516778),o=i(397691),s=i(300060),r=i(889391),l=i(423842),c=i(803493),d=i(671830),u=i(562141),h=i(539549),p=i(816402),g=i(968894),C=i(746096),S=i(746096),m=i(657347),y=i(172685),f=i(436237),b=i(998754),_=i(861253),T=i(46929),v=i(18078),w=i(877532),I=i(532514),P=i(422538),M=i(404057),k=i(172758),A=i(853374);t.default=new class{constructor(){this._cachedUserProfilesDict={},this._didShowNotification=!1,this._didIdentifyDifferentTopContacts=!1,this._topContactsWithBirthday=[],this._activationStateChangedSubscribeCallback=()=>{const e=n.App.getActivationState()===n.Types.AppActivationState.Active;this._isAppActive!==e&&(f.log(C.LogTraceArea.Engagement,"Active state changed to "+n.Types.AppActivationState[n.App.getActivationState()]),this._isAppActive=e,this._appConfigStoreSubscribeCallback())},this._appConfigStoreSubscribeCallback=()=>{this._initServiceConfig(),this._isFeatureEnabled?this._usersStoreSubscriptionToken||(this._usersStoreSubscriptionToken=k.default.subscribe((e=>{this._tryCreateBirthdayNotification(e)})),f.log(C.LogTraceArea.Engagement,"Subscribed to UsersStore, _usersStoreSubscriptionToken: "+(this._usersStoreSubscriptionToken?"1":"0"))):(f.log(C.LogTraceArea.Engagement,"CelebrationNotificationService disabled. Disabling subscriptions"),this._usersStoreSubscriptionToken&&(k.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0))},this._tryCreateBirthdayNotification=e=>{if(!this._isFeatureEnabled)return f.log(C.LogTraceArea.Engagement,"Birthday notification feature is not enabled. Skipping scheduling"),o.Resolved();if(this._didShowNotification)return f.log(C.LogTraceArea.Engagement,"Birthday notification already created. Skipping scheduling"),o.Resolved();let t;const i=this._getAllContactsMrisEnabled?this.getAllContacts():this.getFavoriteAndSuggestedContacts();return t=e?a.intersection(e,a.keys(this._cachedUserProfilesDict)):i.favoriteContactsMris.concat(i.nonFavoriteSuggestedContactsMris),this.fetchUserProfiles(t).then((()=>{const e=this.getTopContactMrisWithBirthdaysToday(i);if(a.isUndefined(this._topContactsWithBirthday)||this._topContactsWithBirthday.length<=0)return f.log(C.LogTraceArea.Engagement,"Identified contacts with birthday during first run. Scheduling birthday notification"),this.maybeCreateBirthdayLocalEngagementNotification(e);const t=e[0],n=this._topContactsWithBirthday[0];return t&&t!==n?(f.log(C.LogTraceArea.Engagement,"Identified new contacts with birthday. Scheduling birthday notification"),this.maybeCreateBirthdayLocalEngagementNotification(e)):o.Resolved()}))},P.RegisterStartupable(this,"CelebrationNotificationService",[h.default,y.default,b.default,T.default,k.default,w.default])}startup(){return this._initAppStateConfig(),this._appStateSubscription=s.default.subscribeForChanges("CelebrationNotificationService",this._activationStateChangedSubscribeCallback),this._appConfigStoreSubscription=r.default.subscribe(this._appConfigStoreSubscribeCallback),this._appConfigStoreSubscribeCallback(),y.default.setRefreshOptions("CelebrationNotification",{interval:this._refreshTime,taskTypeFlags:y.TaskTypeFlags.UsesNetworking,callback:()=>this._tryCreateBirthdayNotification()}),this._isFeatureEnabled&&m.default.queueIdleTask("CelebrationNotificationService",y.TaskTypeFlags.CpuIntensive,this._tryCreateBirthdayNotification),o.Resolved()}logout(e,t,i){return f.log(C.LogTraceArea.Engagement,"Logout action triggered for CelebrationNotificationService"),this._usersStoreSubscriptionToken&&(k.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0),this._searchStore&&(this._searchStore.destroy(),this._searchStore=void 0),this._didShowNotification=!1,this._topContactsWithBirthday=[],a.each(this._cachedUserProfilesDict,((e,t)=>{e&&delete this._cachedUserProfilesDict[t]})),f.log(C.LogTraceArea.Engagement,"Cleared local cache of user profiles in CelebrationNotificationService"),o.Resolved()}_initAppStateConfig(){this._isAppActive=n.App.getActivationState()===n.Types.AppActivationState.Active}_initServiceConfig(){const e=r.default.getEngagementFeatures().engagementCelebrationNotificationSetting,t=r.default.getSkypeEngagementFeatures().birthdayContent;f.log(C.LogTraceArea.Engagement,"initServiceConfig callback executed, given featureSettings: "+JSON.stringify(e)+"given birthdayContent: "+JSON.stringify(t)),this._campaignId=t.campaignId,this._variantId=t.variantId,this._isFeatureEnabled=e.enabled,this._refreshTime=e.refreshTime,this._celebrationNotificationsTopContactCutOff=e.celebrationNotificationsTopContactCutOff,this._isThrottlingOnRoamingSettingsEnabled=e.isThrottlingOnRoamingSettingsEnabled,this._isThrottlingOnLocalSettingsEnabled=e.isThrottlingOnLocalSettingsEnabled,this._isContactCutOffEnabled=e.isContactCutOffEnabled,this._getAllContactsMrisEnabled=e.getAllContactsMrisEnabled,this._isDiscardingOnAppActiveEnabled=e.isDiscardingOnAppActiveEnabled}_doesMriHaveBirthdayToday(e){const t=this._cachedUserProfilesDict[e];return t&&c.default.isTodayBirthdayForParticipantProfile(t)}_getSearchStore(){if(!this._searchStore){this._searchStore=new I.default;const e={rawQuery:"",trimmedNormalizedQuery:"",userMriToExclude:[v.default.getSkypeMri()],excludeBots:!0,onlyGroupCapable:!1,onlyCallCapable:!0,includeBlocked:!1,excludeNonManuallyAdded:!0};this._searchStore.updateConfig(e,[S.SearchResultsListGroup.FavoriteContacts,S.SearchResultsListGroup.SuggestedFrequentConversations,S.SearchResultsListGroup.AddressBook])}return this._searchStore}getAllContacts(){if(f.log(C.LogTraceArea.Engagement,"Will try to fetch all contacts"),this._searchStore=this._getSearchStore(),!this._searchStore)return f.log(C.LogTraceArea.Engagement,"Birthday notification search store did not initialize. Returning empty list of contact MRIs"),{favoriteContactsMris:[],nonFavoriteSuggestedContactsMris:[]};let e=this._celebrationNotificationsTopContactCutOff;const t=a.filter(this._searchStore.getCombinedContactsWithoutAddressBookAndShortCircuit(),(t=>{if(!t.skypeContact)return!1;const i=t.skypeContact.getMri();return!!i&&(this._isContactCutOffEnabled&&d.isOneOnOneConversation(i)?(e--,e>=0):d.isOneOnOneConversation(i))})),i=a.map(t,(e=>{if(e.skypeContact)return e.skypeContact.getMri()}));return this._isContactCutOffEnabled&&0===e&&(f.log(C.LogTraceArea.Engagement,"Birthday notification contact cutoff reached. Returning empty list of contact MRIs"),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.ContactCutOffLimitReached,numberOfTopContacts:this._celebrationNotificationsTopContactCutOff,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId}))),{favoriteContactsMris:i,nonFavoriteSuggestedContactsMris:[]}}getFavoriteAndSuggestedContacts(){if(f.log(C.LogTraceArea.Engagement,"Will try to fetch favorite and suggested contacts"),this._searchStore=this._getSearchStore(),!this._searchStore)return f.log(C.LogTraceArea.Engagement,"Birthday notification search store did not initialize. Returning empty list of favorite and nonFavorite contact MRIs"),{favoriteContactsMris:[],nonFavoriteSuggestedContactsMris:[]};let e=this._celebrationNotificationsTopContactCutOff;const t=a.filter(this._searchStore.getFavoriteContactsResults(),(t=>this._isContactCutOffEnabled&&d.isOneOnOneConversation(t)?(e--,e>=0):d.isOneOnOneConversation(t)));if(this._isContactCutOffEnabled&&0===e)return f.log(C.LogTraceArea.Engagement,"Birthday notification contact cutoff reached. Returning empty list of nonFavorite contact MRIs"),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.ContactCutOffLimitReached,numberOfTopContacts:this._celebrationNotificationsTopContactCutOff,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId})),{favoriteContactsMris:t,nonFavoriteSuggestedContactsMris:[]};let i=[];return i=a.filter(this._searchStore.getSuggestedContactsAndConversationsResults(S.SearchResultsListGroup.SuggestedFrequentConversations),(e=>d.isOneOnOneConversation(e))),i=a.difference(i,t),i=i.splice(e-1,i.length-e),{favoriteContactsMris:t,nonFavoriteSuggestedContactsMris:i}}fetchUserProfiles(e){return f.log(C.LogTraceArea.Engagement,"Starting to fetch user profiles for specified MRIs"),k.default.getFullUserProfileByMrisAsync(e).then((e=>{a.each(e,(e=>{this._cachedUserProfilesDict[e.mri]&&delete this._cachedUserProfilesDict[e.mri],this._cachedUserProfilesDict[e.mri]=e})),f.log(C.LogTraceArea.Engagement,"Finished fetching user profiles for specified MRIs")}))}getTopContactMrisWithBirthdaysToday(e){const t=e.favoriteContactsMris,i=e.nonFavoriteSuggestedContactsMris;let n=a.filter(t,(e=>this._doesMriHaveBirthdayToday(e)));const o=a.filter(i,(e=>this._doesMriHaveBirthdayToday(e)));return n.sort(((e,t)=>this._compareTwoContacts(e,t))),o.sort(((e,t)=>this._compareTwoContacts(e,t))),n=n.concat(o),n}maybeCreateBirthdayLocalEngagementNotification(e){const t=this._getCelebrationNotificationLastShownTime(this._isThrottlingOnLocalSettingsEnabled,this._isThrottlingOnRoamingSettingsEnabled);return this._didIdentifyDifferentTopContacts=!1,this._didShowNotification=!this._wasTimeBeforeToday(t),this._didShowNotification?(f.log(C.LogTraceArea.Engagement,"Birthday notification already created since: "+t+". Skipping scheduling"),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.NotificationAlreadyShown,numberOfTopContacts:e.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId})),o.Resolved()):(this._didIdentifyDifferentTopContacts=!(0,_.default)(this._topContactsWithBirthday,e),this._topContactsWithBirthday=e,f.log(C.LogTraceArea.Engagement,"Birthday notification will now be created"),this._createLocalBirthdayEngagementNotificationWithTopContacts(this._topContactsWithBirthday).always((e=>e?(this._didShowNotification=!0,f.log(C.LogTraceArea.Engagement,"Birthday notification created successfully"),this._setCelebrationNotificationLastShownTime(Date.now())):(f.log(C.LogTraceArea.Engagement,"Birthday notification not created"),o.Resolved()))))}_createLocalBirthdayEngagementNotificationWithTopContacts(e){if(0===e.length)return f.log(C.LogTraceArea.Notifications,"Ignoring celebration notification because topContacts list is empty."),o.Resolved(!1);const t=e[0],i=k.default.getFullUserProfileByMri(t).getSkypeId();if(!this._cachedUserProfilesDict[t])return f.log(C.LogTraceArea.Notifications,"Ignoring celebration notification because of incomplete user profile."),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.SelectedTopContactUserProfileIncomplete,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId,celebratedUserSkypeId:i})),o.Resolved(!1);if(this._isDiscardingOnAppActiveEnabled&&!this._isAppActive)return f.log(C.LogTraceArea.Notifications,"Ignoring celebration notification because app is not active."),o.Resolved(!1);const a={content:{skypeId:i}};return w.default.openCampaign(this._campaignId,this._variantId,g.EngagementType.PopCard,A.default.newGuid(),a).then((()=>(f.log(C.LogTraceArea.Notifications,"Created celebration popcard notification with campaignId : "+this._campaignId,"variantId : "+this._variantId),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.Created,notificationType:l.CelebrationNotificationType.EngagementPopCard,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardCampaignId:this._campaignId,cardGuid:this._variantId,celebratedUserSkypeId:i})),!0))).fail((e=>(f.log(C.LogTraceArea.Notifications,"Failed to fetch campaign using PullCampaignContentService campaignId : "+this._campaignId+"variantId : "+this._variantId+" error: "+M.default.errorAsString(e)),f.track(new l.CelebrationNotificationTelemetryEvent({action:l.CelebrationNotificationTelemetryEventAction.PullCampaignContentServiceFailed,numberOfTopContacts:this._topContactsWithBirthday.length,didIdentifyDifferentTopContacts:this._didIdentifyDifferentTopContacts,cardGuid:this._variantId,cardCampaignId:this._campaignId,celebratedUserSkypeId:i})),!1)))}_getRecentConversationsInvolvingUser(e){return a.filter((0,h.default)().getDisplayableRecentConversationsSortedAll(),(t=>a.some(t.getMemberMris(),(t=>!v.default.isMyMri(e)&&t===e))))}_compareTwoContacts(e,t){const i=this._getRecentConversationsInvolvingUser(e),a=this._getRecentConversationsInvolvingUser(t),n=i.length-a.length;let o=0;return i.length>0&&a.length>0&&(o=i[0].getTimestamp()-a[0].getTimestamp()),0===n?o:n}_wasTimeBeforeToday(e){const t=new Date(e),i=new Date;return i.setHours(0,0,0,0),t.getTime()<i.getTime()}_getCelebrationNotificationLastShownTime(e,t){const i=e&&b.default.getData(u.InternalKeys.CelebrationNotificationLastShownTime)||0,a=t&&T.default.getCelebrationNotificationLastShownTime()||0;return Math.max(i,a)}_setCelebrationNotificationLastShownTime(e){b.default.putData(u.InternalKeys.CelebrationNotificationLastShownTime,e),T.default.setCelebrationNotificationLastShownTime(e)}test_startup(){this._appConfigStoreSubscribeCallback()}test_reset(){this._searchStore&&(this._searchStore.destroy(),this._searchStore=void 0),this._usersStoreSubscriptionToken&&(k.default.unsubscribe(this._usersStoreSubscriptionToken),this._usersStoreSubscriptionToken=void 0),this._appStateSubscription&&(this._appStateSubscription.unsubscribe(),this._appStateSubscription=void 0),this._appConfigStoreSubscription&&(r.default.unsubscribe(this._appConfigStoreSubscription),this._appConfigStoreSubscription=void 0),a.each(this._cachedUserProfilesDict,((e,t)=>{e&&delete this._cachedUserProfilesDict[t]})),this._didShowNotification=!1;const e=p.default.add(Date.now(),0,-1);this._setCelebrationNotificationLastShownTime(e)}setFavoriteAndSuggestedContactsList(e){a.each(e,(e=>{this._cachedUserProfilesDict[e.mri]=e}))}setTopContactsList(e){this._topContactsWithBirthday=e}}},156976:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class i{static savePhoneNumberInput(e){this.phoneNumberInput=e}static clearState(){this.phoneNumberInput=void 0,this.restoreStateRequired=!1}static restorePhoneNumberInputIfNeeded(){return this.restoreStateRequired?this.phoneNumberInput:void 0}static shouldRestoreState(){this.restoreStateRequired=!0}}i.phoneNumberInput=void 0,i.restoreStateRequired=!1,t.default=i},349663:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.E911Service=void 0;const a=i(496486),n=i(397691),o=i(348564),s=i(440276),r=i(436237),l=i(746096),c=i(735426),d=i(404057);class u{getBase64EncodedLocation(e,t,i){return r.log(l.LogTraceArea.Phone,"E911Service: Fetching location from Bing Maps API."),o.default.getInstance().getLocationByPoint(e,t,i).then((i=>{var o;const d=null===(o=i.resourceSets[0])||void 0===o?void 0:o.resources[0];if(a.isUndefined(d))return n.Rejected();r.track(new c.E911BingMapsEvent(String(i.statusCode))),r.log(l.LogTraceArea.Phone,"E911Service: Location is fetched from Bing Maps API. Formatting location to PIDF-LO.");const u=this._formatLocation(e,t,d);return r.log(l.LogTraceArea.Phone,"E911Service: Location is formatted to PIDF-LO. Encoding location to Base64."),(0,s.btoaUtf8)(u)})).catch((e=>{const t=String(a.get(e,"statusCode"))||"NO_STATUS_CODE",i=String(a.get(e,"statusDescription"))||"NO_STATUS_DESCRIPTION";return r.track(new c.E911BingMapsEvent(t)),r.warn(l.LogTraceArea.Phone,"E911Service: Failed to fetch location from Bing Maps API: "+t+" - "+i),n.Rejected()}))}_formatLocation(e,t,i){return`<?xml version="1.0" encoding="utf-8"?>\n            <presence xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:ietf:params:xml:ns:pidf">\n                <tuple id="tuple0">\n                    <status>\n                        <geopriv xmlns="urn:ietf:params:xml:ns:pidf:geopriv10">\n                            <location-info>\n                                <Point srsName="urn:ogc:def:crs:EPSG::4326" xmlns="http://www.opengis.net/gml">\n                                    <pos>${e} ${t}</pos>\n                                </Point>\n                                <civicAddress xmlns="urn:ietf:params:xml:ns:pidf:geopriv10:civicAddr">\n                                    ${`<country>${d.default.toUpper(a.escape(i.address.countryRegionIso2))}</country>\n                <A1>${a.escape(i.address.adminDistrict)}</A1>\n                <A2>${a.escape(i.address.adminDistrict2)}</A2>\n                <A3>${a.escape(i.address.locality)}</A3>\n                <RD>${a.escape(i.address.addressLine)}</RD>\n                <LMK>${a.escape(i.address.landmark)}</LMK>\n                <PC>${a.escape(i.address.postalCode)}</PC>`}\n                                </civicAddress>\n                            </location-info>\n                            <usage-rules>\n                                <retransmission-allowed xmlns="urn:ietf:params:xml:ns:pidf:geopriv10:basicPolicy">true</retransmission-allowed>\n                            </usage-rules>\n                            <method>Derived</method>\n                        </geopriv>\n                    </status>\n                </tuple>\n            </presence>`}}t.E911Service=u,t.default=new u},954416:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(174958),n=i(496486),o=i(872090),s=i(269521),r=i(662783),l=i(974634),c=i(397691),d=i(889391),u=i(562141),h=(i(440276),i(746096)),p=i(436237),g=i(998754),C=i(861253),S=i(733754),m=i(704329),y=i(940821),f=i(111878),b=i(216568),_=i(422538),T=i(404057),v=i(640363),w=i(912770),I=i(994214),P=i(449682),M=i(47447),k=i(853374);t.default=new class{constructor(){this.pushTransportPathChanged=new l.default,this._exponentialTime=new r.ExponentialTime(1e3,3e5),this._checkStateRunning=!1,this._checkStateQueued=!1,this._subscriptions=[],this._clearedPushVoipRegistrations=!1,this._clearedPushAlertRegistrations=!1,this._handleRegistrationTokenReceived=e=>{const t=new y.GotToken;if(p.log(h.LogTraceArea.RegistrarService,"OS Push Notification registration token received: "+a.pii.Omit(JSON.stringify(e))),e){let i;i=e,t.registrationAction=this._setPushTransportPath(i)}else p.warn(h.LogTraceArea.RegistrarService,"Not starting RegistrarService - no push token");p.track(t)},this._handleRegistrationAlertTokenReceived=e=>{const t=new y.GotToken;if(p.log(h.LogTraceArea.RegistrarService,"OS Push Notification registration token received: "+a.pii.Omit(JSON.stringify(e))),e){let i;i=e,t.registrationAction=this._setPushTransportAlertPath(i)}else p.warn(h.LogTraceArea.RegistrarService,"Not starting RegistrarService - no push token");p.track(t)},this._gaveUpOnFetchingRegistrationTokenEvent=()=>{p.track(new y.GaveUpOnFetchingToken)},this._nonFatalErrorFetchingRegistrationTokenEvent=e=>{p.track(new y.NonFatalErrorFetchingToken(e.errorCode,e.errorMessage,e.networkConnectivityLevel))},this._handleRegistrationInvalidated=()=>{p.warn(h.LogTraceArea.RegistrarService,"OS Push Notification token has been invalidated")},this._updateTrouter=(e,t)=>{this._trouterUrl===e&&this._trouterTTL===t||(this._setTrouterEndpoint(e,t),this._checkState())},this._checkState=()=>{if(this._checkStateRunning)return this._checkStateQueued=!0,"no_action";for(;;){this._checkStateRunning=!0;const e=this._checkStateInner();if(this._checkStateRunning=!1,!this._checkStateQueued)return e;this._checkStateQueued=!1}},_.RegisterStartupable(this,"RegistrarService",[g.default,b.default,I.default,P.default]),m.default.registerForLogout(this,"RegistrarService")}startup(){const e=g.default.getData(u.InternalKeys.EdfRegistrationInfo);e&&(this._setRegistrationId(e.registrationId,!!e.registrationIdGenerated),this._lastPostedTime=e.lastPostedTime,this._lastPostedPayload=e.lastPostedPayload,p.log(h.LogTraceArea.RegistrarService,"Loaded registrationId: "+this._registrationId+" lastPostedTime: "+this._lastPostedTime),d.default.getS4LFeatures().pushConfig.refreshOnLaunch&&(p.log(h.LogTraceArea.RegistrarService,"Clearing lastPostedPayload - will re-register"),this._lastPostedPayload=void 0));const t=o.default.useNativeRegistrationId();if(t||this._registrationId)!t||this._registrationId&&!this._registrationIdGenerated||b.default.InternalCallingRegistrationId.waitUntilSet().then((()=>this._setAndPersistRegistrationId(b.default.InternalCallingRegistrationId.get(),!1)));else{const e=k.default.newGuid();p.log(h.LogTraceArea.RegistrarService,"Generated new arbitrary registrationId: "+e),this._setAndPersistRegistrationId(e,!0)}this._subscriptions.push(s.PushNotifications.registrationTokenReceivedEvent.subscribe(this._handleRegistrationTokenReceived)),this._subscriptions.push(s.PushNotifications.registrationAlertTokenReceivedEvent.subscribe(this._handleRegistrationAlertTokenReceived)),this._subscriptions.push(s.PushNotifications.gaveUpOnFetchingRegistrationTokenEvent.subscribe(this._gaveUpOnFetchingRegistrationTokenEvent)),this._subscriptions.push(s.PushNotifications.nonFatalErrorFetchingRegistrationTokenEvent.subscribe(this._nonFatalErrorFetchingRegistrationTokenEvent)),this._subscriptions.push(s.PushNotifications.registrationTokenInvalidatedEvent.subscribe(this._handleRegistrationInvalidated));const i=s.PushNotifications.getRegistrationToken();i&&this._handleRegistrationTokenReceived(i);const a=s.PushNotifications.getAlertRegistrationToken();return a&&this._handleRegistrationAlertTokenReceived(a),this._tokenStoreSubscription=I.default.subscribe(this._checkState,I.TriggerKeys.SkypeTokenKey),this._subscriptions.push(P.default.trouterChanged.subscribe(this._updateTrouter)),this._setTrouterEndpoint(P.default.getUrl(),P.default.getTTL()),this._checkState(),c.Resolved()}logout(e,t,i){this._unsubscribe();const a=i?c.Resolved():g.default.putData(u.InternalKeys.EdfRegistrationInfo,void 0),o=this._deleteRegistration(),s=b.default.deleteIds({edfRegistrationId:!0},!i);return c.all([a,s]).always((()=>c.raceTimer(o,500))).then(n.noop)}test_reset(){return this._pushTransportPath=void 0,this._pushTransportAlertPath=void 0,this._trouterUrl=void 0,this._trouterTTL=void 0,this._registrationId=void 0,this._registrationIdGenerated=void 0,this._lastPostedTime=void 0,this._lastPostedPayload=void 0,this._dontPostUntilAfter=void 0,this._registrationInFlight=void 0,this._postingPayload=void 0,this._clearedPushVoipRegistrations=!1,this._clearedPushAlertRegistrations=!1,this._unsubscribe(),c.all([b.default.deleteIds({edfRegistrationId:!0}),g.default.putData(u.InternalKeys.EdfRegistrationInfo,void 0)]).then(n.noop)}_unsubscribe(){const e=this._subscriptions;if(this._subscriptions=[],n.each(e,(e=>e.unsubscribe())),this._tokenStoreSubscription){const e=this._tokenStoreSubscription;this._tokenStoreSubscription=void 0,I.default.unsubscribe(e)}if(this._appConfigStoreSubscription){const e=this._appConfigStoreSubscription;this._appConfigStoreSubscription=void 0,d.default.unsubscribe(e)}}_setPushTransportPath(e){return this._pushTransportPath===e?"no_action":(this._pushTransportPath=e,this.pushTransportPathChanged.fire(),this._checkState())}_setPushTransportAlertPath(e){return this._pushTransportAlertPath===e?"no_action":(this._pushTransportAlertPath=e,this._checkState())}getPushTransportPath(){return this._pushTransportPath}test_updateTrouter(e,t){this._updateTrouter(e,t)}_setTrouterEndpoint(e,t){this._trouterUrl=e,this._trouterTTL=t}hasRegisteredWithService(){return!!this._lastPostedPayload}debug_getLastPayload(){return this._lastPostedPayload}debug_enumerateRegistrations(){return f.default.enumerateRegistrations().then((e=>e.bindings))}_deleteRegistration(){return this._registrationId?f.default.deleteRegistration(this._registrationId):c.Resolved()}_checkStateInner(){if(!I.default.hasUsableSkypeToken())return p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: No usable SkypeToken"),"no_usable_skype_token";if(!this._registrationId)return p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: No registrationId"),"no_registration_id";if(!this._trouterUrl&&!this._pushTransportPath)return p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: No valid transport"),"no_valid_transport";if(!this._trouterUrl&&!this._pushTransportAlertPath&&M.UICapabilities.alertNotificationEnabled())return p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: No valid alert transport path"),"no_valid_alert_transport";const e=Date.now();if(this._dontPostUntilAfter&&e<this._dontPostUntilAfter)return this._retryTimer&&w.default.clearExpiration(this._retryTimer),this._retryTimer=w.default.setExpiration(this._checkState,this._dontPostUntilAfter),p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: Cannot post until "+this._dontPostUntilAfter),"registration_blocked_until_timestamp";const t=this._buildRegistrationPayload();if(!this._lastPostedTime||!(0,C.default)(this._lastPostedPayload,t)||e>this._lastPostedTime+1e3*d.default.getS4LFeatures().pushConfig.refreshIntervalSeconds||e>this._lastPostedTime+this._calcLowestTTLForPayload(this._lastPostedPayload)/2){if(this._registrationInFlight){if((0,C.default)(t,this._postingPayload))return p.log(h.LogTraceArea.RegistrarService,"Skipping PNH registration request: Already posting"),"registration_already_in_progress";const e=this._registrationInFlight;this._registrationInFlight=void 0,e.cancel()}return this._registrationInFlight=this._clearPushRegistrations().finally((()=>this._createPushRegistration(t))),"registration_started"}{const e=this._registrationCompleteDeferred;return e&&(p.log(h.LogTraceArea.RegistrarService,"PNH Registration Completed..."),e.resolve(void 0),this._registrationCompleteDeferred=void 0),"no_action"}}_createPushRegistration(e){return this._logPnhRegistrationAttempt(e),this._postingPayload=e,f.default.postRegistration(this._postingPayload).finally((()=>{this._registrationInFlight=void 0,this._postingPayload=void 0})).then((()=>{this._dontPostUntilAfter=void 0,this._exponentialTime.reset(),p.log(h.LogTraceArea.RegistrarService,"PNH Registration Completed!"),this._lastPostedTime=Date.now(),this._lastPostedPayload=e,this._saveInfoToDb()}),(e=>{p.warn(h.LogTraceArea.RegistrarService,"PNH Registration errored: "+T.default.errorAsString(e)),this._dontPostUntilAfter=Date.now()+this._exponentialTime.getTimeAndCalculateNext()})).finally((()=>{this._checkState()}))}_logPnhRegistrationAttempt(e){p.log(h.LogTraceArea.RegistrarService,"Sending PNH registration request:\nClient Description: "+JSON.stringify(e.clientDescription)+", NodeId: "+e.nodeId+", Registration Id: "+e.registrationId+", Transports: "+n.map(e.transports,((e,t)=>{let i="";return"\n"+t+" registered for:"+n.map(e,(e=>(i=i||e.path,", Context: "+e.context+", TTL: "+e.ttl+", CreationTime: "+e.creationTime)))+", with Path: "+p.piiTrustMeThisIsSafe(i)})))}_clearPushRegistrations(){if(!d.default.getS4LMessagingFeaturesNoSubscription().clearPushRegistrations)return c.Resolved();const e=Date.now()/1e3+1e5,t=o.default.getApplicationId(),i=[];return this._pushTransportPath&&!this._clearedPushVoipRegistrations&&i.push(f.default.patchRegistrations(this._pushTransportPath,e,t).then((()=>{p.log(h.LogTraceArea.RegistrarService,"Cleared VoIP push registrations"),this._clearedPushVoipRegistrations=!0}),(e=>{p.log(h.LogTraceArea.RegistrarService,"Failed to clear VoIP push registrations with error: "+T.default.errorAsString(e))}))),M.UICapabilities.alertNotificationEnabled()&&this._pushTransportAlertPath&&!this._clearedPushAlertRegistrations&&i.push(f.default.patchRegistrations(this._pushTransportAlertPath,e,t).then((()=>{p.log(h.LogTraceArea.RegistrarService,"Cleared alert push registrations"),this._clearedPushAlertRegistrations=!0}),(e=>{p.log(h.LogTraceArea.RegistrarService,"Failed to clear alert push registrations with error: "+T.default.errorAsString(e))}))),p.log(h.LogTraceArea.RegistrarService,"Number of push registration paths to be cleared: "+i.length),c.all(i)}waitForRegistrationComplete(){this._registrationCompleteDeferred||(this._registrationCompleteDeferred=c.Defer());const e=this._registrationCompleteDeferred.promise();return p.log(h.LogTraceArea.RegistrarService,"Awaiting PNH Registration..."),this._checkState(),e}_calcLowestTTLForPayload(e){let t;return n.each(e.transports,(e=>{n.each(e,(e=>{(!t||e.ttl<t)&&(t=e.ttl)}))})),t}_saveInfoToDb(){const e={registrationId:this._registrationId,registrationIdGenerated:this._registrationIdGenerated,lastPostedTime:this._lastPostedTime,lastPostedPayload:this._lastPostedPayload};return g.default.putData(u.InternalKeys.EdfRegistrationInfo,e)}_setAndPersistRegistrationId(e,t){this._setRegistrationId(e,t),this._saveInfoToDb().then((()=>this._checkState()))}getRegistrationId(){return this._registrationId}_setRegistrationId(e,t){this._registrationId=e,this._registrationIdGenerated=t,this._registrationId&&b.default.setEdfRegistrationId(this._registrationId)}_buildRegistrationPayload(){const e=n.merge({},this._pushTransportPath?o.default.getTransports(d.default.getS4LFeatures().pushConfig.ttlSeconds,this._pushTransportPath,this._pushTransportAlertPath,M.UICapabilities.alertNotificationEnabled()):{},this._getTrouterTransport());return{registrationId:this._registrationId,nodeId:"",clientDescription:{appId:o.default.getApplicationId(),platform:o.default.getPlatformName(),languageId:S.getLocale(),templateKey:o.default.getTemplateKey(M.UICapabilities.alertNotificationEnabled()),platformUIVersion:v.default.getClientVersionAndPlatform()+"/",notificationFilteringService:o.default.getNotificationFilteringService()},transports:e}}_getTrouterTransport(){return this._trouterUrl?{TROUTER:[{context:"",creationTime:"",path:this._trouterUrl,ttl:this._trouterTTL}]}:{}}getTrouterUrl(){return this._trouterUrl}}},524688:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=(i(174958),i(397691)),o=i(889391),s=i(994224),r=i(568580),l=i(422801),c=i(400984),d=i(695742),u=i(746096),h=i(436237),p=i(704329),g=i(14138),C=i(276173),S=i(654565),m=i(422538),y=i(147202),f=i(172758);t.default=new class{constructor(){this._subscriptions=[],m.RegisterStartupable(this,"TrouterNotificationsService",[g.default]),p.default.registerForLogout(this,"TrouterNotificationsService")}startup(){return this._subscriptions.push(g.default.event_trouterNotificationQueueChanged.subscribe((()=>{this._drainTrouterQueue()}))),this._drainTrouterQueue(),n.Resolved()}_drainTrouterQueue(){a.each(g.default.fetchAndDrainTrouterNotificationQueue(),(e=>{this._handleTrouterMessage(e.notification,e.causeId)}))}logout(e,t,i){const o=this._subscriptions;return this._subscriptions=[],a.each(o,(e=>e.unsubscribe())),n.Resolved()}_handleTrouterMessage(e,t){const i=Number(e.eventId);h.log(u.LogTraceArea.Trouter,"_handleTrouterMessage (Evt: "+i+", causeId: "+t+"), MS-CV: "+e.cv+")"),s.default.CallNotificationHelpers.maybeDisposePendingWarmCallForNotification(i);const a=Date.now();if(i===C.PNHEvents.IncomingNGCCall||i===C.PNHEvents.IncomingNGCGroupCall||i===C.PNHEvents.IncomingNGCPSTNCall||i===C.PNHEvents.IncomingS4BCall||i===C.PNHEvents.IncomingNGCEncryptedCall)s.default.CallNotificationHelpers.processIncomingCallNotification(i,"trouter",r.default.incomingCallNotificationForTrouter(e),a,a,t);else if(i===C.PNHEvents.IncomingGoLiveStart)s.default.CallNotificationHelpers.processIncomingGoLiveNotification(i,"trouter",r.default.incomingGoLiveNotificationForTrouter(e),a,a,t);else if(i===C.PNHEvents.IncomingGoLiveStop)s.default.CallNotificationHelpers.processGoLiveStopNotification(i,"trouter",r.default.stopGoLiveNotificationForTrouter(e),a,a,t);else if(i===C.PNHEvents.IncomingNGCStopRinger)s.default.CallNotificationHelpers.processStopCallNotification("trouter",r.default.stopCallNotificationForTrouter(e),a,a,t);else if(i===C.PNHEvents.IncomingWarmCall)s.default.CallNotificationHelpers.processWarmCallNotification(!1,e.body,t);else if(i===C.PNHEvents.IncomingP2PCall)s.default.CallNotificationHelpers.processP2PCallNotification(i,"trouter",e.body,a,a,t);else if(i===C.PNHEvents.IncomingContactListChange)c.default.processContactListChangeNotification();else if(i===C.PNHEvents.IncomingContactRequest||i===C.PNHEvents.IncomingContactAccept||i===C.PNHEvents.IncomingContactInviteListChange)c.default.processContactInviteNotification();else if(i===C.PNHEvents.IncomingProfileChange)f.default.fetchUserPotentiallyBeforeStartup();else if(i===C.PNHEvents.IncomingAvatarChange)f.default.fetchUserAvatarUrlPotentiallyBeforeStartup();else if(i===C.PNHEvents.SceUserServicesChange)d.default.processSceUserServicesChangeNotification(e.body.data||e.body);else if(i===C.PNHEvents.IncomingTPUMConciergeMessage){const i=e.body;y.default.processTPUMNotification(i,t)}else if(i===C.PNHEvents.IncomingUpsPresence)S.default.handleTrouterEvent(e.body);else{if(i!==C.PNHEvents.Ued)return h.warn(u.LogTraceArea.Trouter,"_handleTrouterMessage: Failed to handle event type: "+i+" causeId: "+t+", MS-CV: "+e.cv),!1;{const t=o.default.getS4LMessagingFeaturesNoSubscription().ued,i=t&&t.enabled&&t.consumeEvents;h.log(u.LogTraceArea.Trouter,"Incoming UED event, MS-CV: "+e.cv+", processing enabled:"+i),i&&l.default.handleTrouterEvent(e.body,e.cv,e.messageStoreUsed)}}return!0}}},449682:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(583367),o=i(385033),s=i(974634),r=i(397691),l=i(889391),c=i(746096),d=i(436237),u=i(276173),h=i(17791),p=i(422538),g=i(404057),C=i(640363),S=i(994214),m=i(681072),y=i(327795),f=i(216568);t.default=new class{constructor(){this.messageReceived=new s.default,this.trouterChanged=new s.default,this.messageLost=new s.default,this._started=!1,this._activityLevelIsBackground=!1,p.RegisterStartupable(this,"TrouterService",[S.default,f.default])}startup(){this._configStoreSubscriptionToken=l.default.subscribe((()=>this._onConfigChanged()));const e=l.default.getTrouterJScriptClientConfig();return o.default.initialize({version:C.default.getUIVersion(),sessionIdProvider:()=>C.default.getDeviceId(),registrationIdProvider:()=>f.default.EdfRegistrationId.get(),tokenProvider:e=>Promise.resolve(S.default.getRawSkypeToken()),urlProvider:()=>l.default.getTrouterJScriptClientConfig().TrouterConnectionUrl,telemetry:{sender:{logEvent(e){d.track(new m.TrouterEvent(e))}},settings:{enabled:e.TelemetryEnabled,logHealthCheckError:e.ClientTelemetryEventEnabled.logHealthCheckError,trouter_js_client_connected:e.ClientTelemetryEventEnabled.trouter_js_client_connected,trouter_js_client_disconnected:e.ClientTelemetryEventEnabled.trouter_js_client_disconnected,trouter_js_client_error:e.ClientTelemetryEventEnabled.trouter_js_client_error,trouter_js_client_progress:e.ClientTelemetryEventEnabled.trouter_js_client_progress,trouter_js_client_response:e.ClientTelemetryEventEnabled.trouter_js_client_response,numberOfStepsToMaintain:e.ClientTelemetryEventEnabled.numberOfStepsToMaintain,sendProgressTimeoutSecs:e.ClientTelemetryEventEnabled.sendProgressTimeoutSecs}},connectivityChanged:h.default.connectivityChangedEvent}),o.default.registerMessageHandler({handleMessage:e=>this.messageReceived.fire(e),canHandleMessage:e=>!a.isNaN(e.eventId)&&e.eventId!==u.PNHEvents.IncomingUnknown&&a.some(a.values(u.PNHEvents),(t=>a.toNumber(t)===e.eventId))}),o.default.onConnectedChanged((e=>{if(d.log(c.LogTraceArea.Trouter,"onConnectedChanged "+e),e&&this._waitingForTrouterConnected){const e=this._waitingForTrouterConnected;this._waitingForTrouterConnected=void 0,e.resolve(void 0)}d.track(new y.DevDebug("UED-Trouter-Event",JSON.stringify({event:"onStateChange",isConnected:e,url:o.default.url()}))),this.trouterChanged.fire(o.default.url(),o.default.ttl())})),o.default.onMessagingMessageLoss.subscribe((()=>{d.track(new y.DevDebug("UED-Trouter-Event",JSON.stringify({event:"onMessageLoss",url:o.default.url()}))),this.messageLost.fire()})),S.default.performWhenValidSkypeTokenArrives().then((()=>o.default.start())),this._started=!0,r.Resolved()}logout(e,t,i){o.default.clearMessageHandlers(),l.default.unsubscribe(this._configStoreSubscriptionToken),this.setActivityLevel(!0),this._started=!1}isEnabled(){return o.default.isEnabled()}isConnected(){return o.default.isConnected()}setUserActivityState(e,t){try{const i=btoa(String.fromCharCode.apply(void 0,Array.from(Array(16),(e=>255*Math.random())))).substring(0,22)+".0";return d.log(c.LogTraceArea.Trouter,`setUserActivityState: ${t}, cv: ${i}, endpointId: ${e}`),o.default.setUserActivityState(e,t,i),r.Resolved()}catch(e){return d.log(c.LogTraceArea.Trouter,`setUserActivityState failed with error: ${g.default.errorAsString(e)}`),r.Rejected("Trouter.setUserActivityState failed "+g.default.errorAsString(e))}}setActivityLevel(e){this._started?e!==this._activityLevelIsBackground&&(d.log(c.LogTraceArea.Trouter,"Setting activity level to "+(e?"background":"foreground")),this._activityLevelIsBackground=e,this._activityLevelIsBackground?n.default.disableWifiLock().catch((e=>{d.warn(c.LogTraceArea.Trouter,"disableWifiLock failed: "+g.default.errorAsString(e))})):n.default.enableWifiLock().catch((e=>{d.warn(c.LogTraceArea.Trouter,"enableWifiLock failed: "+g.default.errorAsString(e))}))):d.log(c.LogTraceArea.Trouter,"Ignoring setActivityLevel call - not started")}getUrl(){return o.default.url()}getTTL(){return o.default.ttl()}performWhenTrouterIsConnected(){return o.default.isConnected()?r.Resolved():(this._waitingForTrouterConnected||(this._waitingForTrouterConnected=r.Defer()),this._waitingForTrouterConnected.promise())}_onConfigChanged(){const e=l.default.getCachedEcsConfig();return e?o.default.setEcsConfig(e.config):(d.log(c.LogTraceArea.Trouter,"No cached ECS settings available"),r.Resolved())}}},471502:(e,t,i)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.EmailABCHEntry=t.PhoneABCHEntry=t.ABCHEntry=t.VerificationState=void 0;const n=i(570655),o=i(174958),s=i(496486),r=i(217041),l=i(397691),c=i(593705),d=i(403486),u=i(746096),h=i(436237),p=i(178735),g=i(393818),C=i(404057),S=i(853374);var m,y;!function(e){e[e.ProfileChanged=0]="ProfileChanged"}(m||(m={})),function(e){e[e.Unverified=0]="Unverified",e[e.VerificationPending=1]="VerificationPending",e[e.Verified=2]="Verified"}(y=t.VerificationState||(t.VerificationState={}));class f{constructor(e){switch(this.Searchable=e.Searchable,this.Source=e.Source,e.State){case c.VerificationStrings.Verified:this.VerifiedState=y.Verified;break;case c.VerificationStrings.VerificationPending:this.VerifiedState=y.VerificationPending;break;case c.VerificationStrings.Unverified:default:this.VerifiedState=y.Unverified}}}t.ABCHEntry=f;class b extends f{constructor(e){super(e),this.Phone=d.default.getPhonePartsFromViewValue(e)}}t.PhoneABCHEntry=b;class _ extends f{constructor(e){super(e),this.EmailAddress=e.Name}}t.EmailABCHEntry=_;let T=a=class extends r.StoreBase{constructor(){super(...arguments),this._shortCircuitEntries={}}getEntries(){return this._profile||this._initialize(),s.cloneDeep(this._shortCircuitEntries)}getProfile(e=!1){return!this._profile||e?this._initialize():l.Resolved(this._profile)}hidePhoneNumberInSearch(e){const t={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!1},i={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[t]}]};return h.log(u.LogTraceArea.ABCHStore,"Hide phone number in search "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(i).then((e=>this._parseProfile(e)))}showPhoneNumberInSearch(e,t){const i={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0},n="Msa"===t;n&&(i.Label=c.Phone_Other_Label);const s=n?{Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Add:[i]}]}:{Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[i]}]};return h.log(u.LogTraceArea.ABCHStore,"Show phone number in search "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then((e=>this._parseProfile(e)))}deletePhoneNumber(e){const t={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Label:c.Phone_Other_Label},i={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Delete:[t]}]};return h.log(u.LogTraceArea.ABCHStore,"Delete phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(i).then((e=>this._parseProfile(e)))}verifyPhoneNumber(e,t){const i={Token:t,Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode)},n={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[i]}]};return h.log(u.LogTraceArea.ABCHStore,"Verify phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(n).then((e=>this._parseProfile(e)))}provisionExistingPhoneNumber(e,t,i){const n={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0,VerifyMethod:t,VerifyLanguage:i},s={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Edit:[n]}]};return h.log(u.LogTraceArea.ABCHStore,"Provision exisiting phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then((e=>this._parseProfile(e)))}provisionNewPhoneNumber(e,t,i){const n={Name:e.Number,Country:a.getCountryForVerification(e.CountryIsoCode,e.CountryCallingCode),Searchable:!0,VerifyMethod:t,VerifyLanguage:i,Label:c.Phone_Other_Label},s={Attributes:[{Name:c.AttributeNames.PersonalContactProfilePhones,Add:[n]}]};return h.log(u.LogTraceArea.ABCHStore,"Provision new phone number "+o.pii.Omit(e.Number)),c.default.postActionOnPhoneNumber(s).then((e=>this._parseProfile(e)))}getUnverifiedPhoneNumberFromProfile(e){let t="";return s.eachRight(this._shortCircuitEntries,((i,a)=>!(i instanceof b&&i.VerifiedState!==y.Verified&&i.Source===e)||(t=i.Phone.Number,!1))),t}updateEntrySearchability(e,t){this._shortCircuitEntries[e]&&(this._shortCircuitEntries[e].Searchable=t,this.trigger())}registerMsaVerifiedEmailWithShortCircuit(){return this.getProfile(!0).then((e=>{let t,i;return s.each(e.Views,(e=>{s.each(e.Attributes,(e=>{e.Name===c.AttributeNames.PersonalContactProfileEmails&&s.each(e.Value,(e=>{"Msa"===e.Source&&e.State===c.VerificationStrings.Verified&&!e.Searchable&&e.Name&&(t=e.Name,i=e.Label)}))}))})),!(!t||!i)&&c.default.registerEmailWithShortCircuit(t,i).then((()=>!0))}))}_initialize(){return this._initializationPromise||(this._initializationPromise=c.default.getMyProfile(),h.log(u.LogTraceArea.ABCHStore,"Profile loading started.")),this._initializationPromise.then((e=>(h.log(u.LogTraceArea.ABCHStore,`Profile successfully loaded. Views length: ${e.Views.length}`),this._parseProfile(e)))).catch((e=>(h.track(new g.MyProfileFetch({isSuccess:!1,isV2:!0,isMigrationSuggested:!1,isMigratedToV2:!1,origin:u.MyProfileFetchOrigin.ABCHStore})),l.Rejected(e)))).finally((()=>{this.trigger(m.ProfileChanged),this._initializationPromise=void 0}))}getParsedProfile(){var e;const t={phoneNumbersAndParts:[],emails:[]};if(!this._profile)return this._initialize(),t;const i=s.flatten(s.map(null===(e=this._profile)||void 0===e?void 0:e.Views,"Attributes")),a=s.filter(i,(e=>s.includes([c.AttributeNames.PersonalContactProfilePhones,c.AttributeNames.PersonalContactProfileEmails],e.Name)));return s.each(a,(e=>{s.each(e.Value,(i=>{if(e.Name===c.AttributeNames.PersonalContactProfilePhones&&0===t.phoneNumbersAndParts.length){const e=d.default.getPhonePartsFromViewValue(i);t.phoneNumbersAndParts.push({phoneNumber:d.default.getPhoneKey(e.Number,e.CountryIsoCode,e.CountryCallingCode,!0),phoneParts:e,source:i.Source})}else e.Name===c.AttributeNames.PersonalContactProfileEmails&&0===t.emails.length&&t.emails.push(i.Name)}))})),t}_parseProfile(e){this._profile=e,this._shortCircuitEntries={};let t=!1;s.each(e.Views,(e=>{s.each(e.Attributes,(e=>{s.each(e.Value,(i=>{if(e.Name===c.AttributeNames.PersonalContactProfilePhones){const e=d.default.calculatePhoneKeyFromViewValue(i);this._shortCircuitEntries[e]=new b(i)}else if(e.Name===c.AttributeNames.PersonalContactProfileEmails){const e=this._calculateEmailKeyFromViewValue(i);this._shortCircuitEntries[e]=new _(i),i.State===c.VerificationStrings.Verified&&(t=!0)}}))}))}));const i=s.map(this._shortCircuitEntries,((e,t)=>`${this._getEntryName(e)}:${o.pii.Omit(t)}`)).join("\n");return h.log(u.LogTraceArea.ABCHStore,"Updated profile info:\n"+i),p.default.setUserPreferencesLocal({hasVerifiedEmail:t}),this.trigger(),e}_getEntryName(e){return e instanceof b?"Phone":e instanceof _?"Email":S.default.switchStatementExhaustiveChecking(e)}static getCountryForVerification(e,t){return C.default.toUpper(e)+"-"+t}_calculateEmailKeyFromViewValue(e){return e.Name.trim().toLowerCase()}test_reset_store(){this._profile=void 0,this._initializationPromise=void 0}};n.__decorate([r.autoSubscribe],T.prototype,"getEntries",null),n.__decorate([r.autoSubscribe],T.prototype,"getProfile",null),n.__decorate([(0,r.autoSubscribeWithKey)(m.ProfileChanged)],T.prototype,"getParsedProfile",null),T=a=n.__decorate([r.AutoSubscribeStore],T),t.default=new T},775492:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(217041),o=i(746096),s=i(436237);var r;!function(e){e[e.CallStatsVisibilty=0]="CallStatsVisibilty",e[e.OverflowMenuVisibility=1]="OverflowMenuVisibility"}(r||(r={}));let l=class extends n.StoreBase{constructor(){super(...arguments),this._isVisible=!1,this._overflowMenuVisible=!1}areCallControlsVisible(){return this._isVisible}setCallControlsVisible(e,t){s.log(o.LogTraceArea.CallingUI,"CallControlsVisibilityStore.setCallControlsVisible.visible: "+(e?"true":"false")+" causeId: "+t);this.areCallControlsVisible()!==e&&this._triggerUpdates(e)}_triggerUpdates(e){this._isVisible=e,this.trigger()}isOverflowMenuVisible(){return this._overflowMenuVisible}setOverflowMenuVisiblity(e,t){e!==this._overflowMenuVisible&&(s.log(o.LogTraceArea.CallingUI,`CallControlsVisibilityStore.setOverflowMenuVisibility moving  ${this._overflowMenuVisible}->${e} causeId: ${t}`),this._overflowMenuVisible=e,this.trigger(r.OverflowMenuVisibility))}resetAllVisibility(e){s.log(o.LogTraceArea.CallingUI,`CallControlsVisibilityStore.resetAllVisibility causeId: ${e}`),this._isVisible=!1,this._overflowMenuVisible=!1}};a.__decorate([n.autoSubscribe],l.prototype,"areCallControlsVisible",null),a.__decorate([(0,n.autoSubscribeWithKey)(r.OverflowMenuVisibility)],l.prototype,"isOverflowMenuVisible",null),l=a.__decorate([n.AutoSubscribeStore],l),t.default=new l},178816:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallDebugMenuItem=t.TriggerKeys=void 0;const a=i(570655),n=i(496486),o=i(583367),s=i(217041),r=i(148540),l=i(397691),c=i(994224),d=i(671830),u=i(400984),h=i(366355),p=i(436237),g=i(104735),C=i(404057),S=i(912770),m=i(172758),y=i(853374);var f,b;!function(e){e[e.SelectedTab=0]="SelectedTab",e[e.Participants=1]="Participants",e[e.CallTechnicalInfo=2]="CallTechnicalInfo",e[e.AppMetrics=3]="AppMetrics",e[e.RendererMetrics=4]="RendererMetrics"}(f=t.TriggerKeys||(t.TriggerKeys={})),function(e){e[e.CallStats=0]="CallStats",e[e.Simulation=1]="Simulation",e[e.Inspect=2]="Inspect"}(b=t.CallDebugMenuItem||(t.CallDebugMenuItem={}));let _=class extends s.StoreBase{constructor(){super(...arguments),this._selectedItem=b.CallStats,this._refreshIntervalTokens={},this._callTechnicalInfo={},this._callParticipants={},this._rendererStats={},this._showAppMetrics=!1,this._showVideoMetrics=!1,this._handleCallEndedEvent=e=>{const t=y.default.newCauseId();this.dispose(e.callId),this.closeDebugWindow(e.callId,t,void 0)},this._updatePerformanceMetrics=()=>l.all([o.default.getSystemUsage(),o.default.getAppMetrics()]).then((e=>{const[t,i]=e;this._metrics={systemUsageInfo:t,gpu:i?i.find((e=>"GPU"===e.type)):void 0,renderer:i?i.find((e=>"Tab"===e.type)):void 0},this.trigger(f.AppMetrics)})),this._updateCallTechnicalInfo=e=>c.default.CallingStore.getTechnicalInformation(e).then((t=>{const i=C.default.parseJsonErrorToUndefined(t);this._callTechnicalInfo[e]||(this._callTechnicalInfo[e]=void 0),this._callTechnicalInfo[e]=i,this.trigger((0,s.formCompoundKey)(e,f.CallTechnicalInfo))}))}init(e){c.default.CallingStore.callEndedEvent().subscribe(this._handleCallEndedEvent),this.startTrackCallTechnicalInfo(e)}getParticipants(e){return this._callParticipants[e]?this._callParticipants[e]:[]}addParticipant(e){this._callParticipants[e]||(this._callParticipants[e]=[]);const t=this._generateParticipant(e);t&&(this._callParticipants[e].push(t),this.trigger(f.Participants))}resetParticipants(e){delete this._callParticipants[e],this.trigger(f.Participants)}removeParticipants(e){this._callParticipants[e]&&(this._callParticipants[e].pop(),this.trigger(f.Participants))}addGroupParticipants(e){for(let t=0;t<12;t++)this.addParticipant(e);this.trigger(f.Participants)}isFakeCallParticipant(e,t){return!!this._callParticipants[e]&&void 0!==n.find(this._callParticipants[e],(e=>e.mri===t))}closeDebugWindow(e,t,i,a=!0){g.default.closeCallDebugPanel(t,i,a)}openNativeWindow(e,t,i,a){g.default.closeCallDebugPanel(a,i,!t),g.default.navigateToCallingDebugPanel(e,i,t),this.trigger()}getCallTechnicalInfo(e){return this._callTechnicalInfo[e]}getAppMetrics(){return this._metrics}getSelectedTab(){return this._selectedItem}showAppMetrics(){return this._showAppMetrics}showVideoMetrics(){return this._showVideoMetrics}setShowAppMetrics(e){this._showAppMetrics=e,e?this._refreshAppMetricsIntervalTokens||(this._refreshAppMetricsIntervalTokens=S.default.setInterval(this._updatePerformanceMetrics,1e4),this._updatePerformanceMetrics()):this._refreshAppMetricsIntervalTokens&&(S.default.clearInterval(this._refreshAppMetricsIntervalTokens),this._refreshAppMetricsIntervalTokens=void 0,this._metrics=void 0),this.trigger(f.AppMetrics)}setShowVideoMetrics(e){this._showVideoMetrics=e,this.trigger()}getRendererMetrics(e,t){if(this._rendererStats[e]&&this._rendererStats[e][t])return this._rendererStats[e][t]}fetchRendererStats(e,t,i){if(!e)return;const a=c.default.RemoteStreamHelper.getRemoteStreamRenderer(e,t,i);null==a||a.getStats().then((i=>{var n,o;this._rendererStats[e]||(this._rendererStats[e]={}),this._rendererStats[e][t]={framesDropped:i.framesDropped,framesTotal:i.framesTotal,frameType:r.FrameType[null==a?void 0:a.frameType],rendererType:r.RendererType[null==a?void 0:a.rendererType],streamSize:`${null===(n=null==a?void 0:a.streamSize)||void 0===n?void 0:n.width}:${null===(o=null==a?void 0:a.streamSize)||void 0===o?void 0:o.height}`},this.trigger((0,s.formCompoundKey)(e,f.RendererMetrics))}))}setSelectedTab(e){this._selectedItem=e,this.trigger(f.SelectedTab)}startTrackCallTechnicalInfo(e){this._refreshIntervalTokens[e]||(this._refreshIntervalTokens[e]=S.default.setInterval((()=>this._updateCallTechnicalInfo(e)),1e4),this._updateCallTechnicalInfo(e))}getCallDebugMemberMri(e,t){return n.find(this._callParticipants[e],(e=>e.id===t.id)).mri}dispose(e){const t=this._refreshIntervalTokens[e];t&&S.default.clearInterval(t),this._selectedItem=b.CallStats,this._refreshIntervalTokens[e]=void 0,this._callTechnicalInfo[e]=void 0}test_reset(){n.map(this._refreshIntervalTokens,(e=>{e&&S.default.clearInterval(e)})),this._refreshIntervalTokens={},this._callParticipants={},this._selectedItem=b.CallStats,this._callTechnicalInfo={}}_generateParticipant(e){const t=u.default.dangerousGetContactMriListMutable();if(0===t.length)return;const i=n.random(0,t.length);let a;do{a=t[n.random(0,t.length)]}while(!(0,d.isMri)(a));try{const t=m.default.getDisplayableUserByMri(a),n=new T(y.default.newGuid(),t?t.getMri():"8:myfakeuserdebug"+y.default.newCauseId(),t?t.getDisplayName():`MyFakeUser${i}`,r.ParticipantState.Connected);return n.streams={[r.StreamType.Video]:[new v(i,e,!0,!0,1,r.StreamType.Video)]},n}catch(e){return void p.log(h.LogTraceArea.CallDebug,"User doesn't exists")}}};a.__decorate([(0,s.autoSubscribeWithKey)(f.Participants)],_.prototype,"getParticipants",null),a.__decorate([(0,s.autoSubscribeWithKey)(f.CallTechnicalInfo),a.__param(0,s.key)],_.prototype,"getCallTechnicalInfo",null),a.__decorate([(0,s.autoSubscribeWithKey)(f.AppMetrics)],_.prototype,"getAppMetrics",null),a.__decorate([(0,s.autoSubscribeWithKey)(f.SelectedTab)],_.prototype,"getSelectedTab",null),a.__decorate([s.autoSubscribe],_.prototype,"showAppMetrics",null),a.__decorate([s.autoSubscribe],_.prototype,"showVideoMetrics",null),a.__decorate([(0,s.autoSubscribeWithKey)(f.RendererMetrics),a.__param(0,s.key)],_.prototype,"getRendererMetrics",null),a.__decorate([s.autoSubscribe],_.prototype,"getCallDebugMemberMri",null),_=a.__decorate([s.AutoSubscribeStore],_);class T{constructor(e,t,i,a){this.id=e,this.mri=t,this.displayName=i,this.state=a}getSourceIdForMediaType(e){return 42}getDiagnosticData(){return"MockedParticipant"}dispose(){}changed(e){return{dispose:e=>{}}}on(e,t){return{dispose:e=>{}}}once(e,t){return{dispose:e=>{}}}}class v{constructor(e,t,i,a,n,o){this.mediaSourceId=0,this.id=e,this.callId=t,this.isAvailable=i,this.isStreaming=a,this.rank=n,this.type=o}changed(e){return{dispose:e=>{}}}dispose(e){}getDiagnosticData(){return""}getStats(){assert.fail("not implemented")}isActive(){return!0}on(e,t){return{dispose:e=>{}}}once(e,t){return{dispose:e=>{}}}start(e,t){return new Promise(((e,t)=>{const i=c.default.CallingStore.getVideoPreviewRenderer(this.callId);i?e(i):t("No renderer")}))}stop(){return new Promise(((e,t)=>{e()}))}}t.default=new _},781770:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(174958),o=i(496486),s=i(217041),r=i(746096),l=i(436237),c=i(861253);var d;!function(e){e[e.DropTarget=0]="DropTarget",e[e.Drag=1]="Drag",e[e.Hover=2]="Hover"}(d||(d={}));let u=class extends s.StoreBase{getCurrentDraggingParticipantKey(){return this._currentConfig?this._currentConfig.key:void 0}getCurrentDraggingParticipantConfig(){return this._currentConfig}getCurrentHoveringParticipantConfig(){return this._hoveringConfig}dangerouslyGetCurrentDraggingParticipantConfig(){return this._currentConfig}setDraggingParticipantConfig(e){if((0,c.default)(this._currentConfig,e))return;const t=this._currentConfig;this._currentConfig=e;const i=[],a=t?t.key:null;if(!this._currentConfig||a!==this._currentConfig.key){const e=this._currentConfig?this._currentConfig.key:"none";l.log(r.LogTraceArea.CallingUI,"CallDraggingParticipantStore.setDraggingParticipantConfig change: key: "+n.pii.Omit(e)),i.push(d.Drag)}e&&this._hoveringConfig&&(this._hoveringConfig=void 0,i.push(d.Hover)),i.push(d.DropTarget),this.trigger(i)}clearHoveringParticipantConfig(e){!this._hoveringConfig||e&&this._hoveringConfig.source!==e||(this._hoveringConfig=void 0,o.defer((()=>{this.trigger(d.Hover)})))}setHoveringParticipantConfig(e){(0,c.default)(this._hoveringConfig,e)||(this._hoveringConfig=e,this.trigger(d.Hover))}};a.__decorate([(0,s.autoSubscribeWithKey)(d.Drag)],u.prototype,"getCurrentDraggingParticipantKey",null),a.__decorate([(0,s.autoSubscribeWithKey)(d.DropTarget)],u.prototype,"getCurrentDraggingParticipantConfig",null),a.__decorate([(0,s.autoSubscribeWithKey)(d.Hover)],u.prototype,"getCurrentHoveringParticipantConfig",null),u=a.__decorate([s.AutoSubscribeStore],u);const h=new u;t.default=h},325489:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Test_CallLogStore=void 0;const a=i(570655),n=i(496486),o=i(217041),s=i(476621),r=i(562141),l=i(746096),c=i(436237);let d=class extends o.StoreBase{constructor(){super(),this._requestThrottle=n.throttle(this._requestCallLogsThrottled,250),this._throttledIds={},this._dbLookups={},this._cache={},this._incomingCallLogsProcessedCallback=e=>{n.each(e,(e=>{const t=this._isTrackingKey(e.callId);t&&this._addToCache(e),c.log(l.LogTraceArea.Calling,`CallLogStore received new calllog: ${e.callId} tracking: ${t}`)}))},s.default.callLogsReceived.subscribe(this._incomingCallLogsProcessedCallback)}getCallLog(e){return this._cache[e]}_startedTrackingKey(e){this._dbLookups[e]||(this._throttledIds[e]=e,this._requestThrottle())}_stoppedTrackingKey(e){delete this._throttledIds[e],delete this._cache[e]}_requestCallLogsThrottled(){if(n.isEmpty(this._throttledIds))return;const e=n.values(this._throttledIds);this._throttledIds={},c.log(l.LogTraceArea.Calling,`CallLogStore processing throttle for ${e}`);const t=r.default.getCallLogs(e).finally((()=>{n.each(e,(e=>delete this._dbLookups[e]))})).then((e=>{n.each(e,(e=>{e&&this._isTrackingKey(e.callId)&&(this._addToCache(e),c.log(l.LogTraceArea.Calling,`CallLogStore adding calllog from store: ${e.callId}`))}))})).fail((t=>{c.warn(l.LogTraceArea.Calling,`CallLogStore failed getting calllogs from store: ${e}`)}));n.each(e,(e=>{this._dbLookups[e]=t}))}_addToCache(e){const t=this._cache[e.callId];t&&t.messageCuid&&e.messageCuid&&!(e.messageCuid>t.messageCuid)||(this._cache[e.callId]=e,this.trigger(e.callId))}test_setCache(e){this._cache=e}};a.__decorate([o.autoSubscribe,a.__param(0,o.key)],d.prototype,"getCallLog",null),a.__decorate([o.disableWarnings],d.prototype,"_startedTrackingKey",null),a.__decorate([o.disableWarnings],d.prototype,"_stoppedTrackingKey",null),d=a.__decorate([o.AutoSubscribeStore],d),t.Test_CallLogStore=d,t.default=new d},32057:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallNetworkConnectionStore=void 0;const a=i(570655),n=i(496486),o=i(217041),s=i(994224),r=i(598925),l=i(746096),c=i(436237);let d,u=class extends o.StoreBase{constructor(){super(),this._networkSubscription=void 0,this._calls=[],this._reconnection={},this._receiveQuality={},this._receiveCatastrophic={},this._startWatchingForNetworkConnectionChanges=e=>{n.includes(this._calls,e.callId)||this._calls.push(e.callId),this._networkSubscription||(this._networkSubscription=s.default.CallingStore.networkConnectionEvent().subscribe(this._callNetworkStateUpdated))},this._stopWatchingForNetworkConnectionChanges=e=>{delete this._receiveQuality[e.callId],delete this._reconnection[e.callId],delete this._receiveCatastrophic[e.callId],n.pull(this._calls,e.callId),n.isEmpty(this._calls)&&(this._networkSubscription&&(this._networkSubscription.unsubscribe(),this._networkSubscription=void 0),this._reconnection={},this._receiveQuality={},this._receiveCatastrophic={})},this._callNetworkStateUpdated=e=>{const t=e.callId;n.includes(this._calls,t)&&(e.eventType===r.CallNetworkQualityEventType.NetworkReconnection?this._reconnection[t]=e.networkState:e.eventType===r.CallNetworkQualityEventType.NetworkReceiveQuality?this._receiveQuality[t]=e.networkState:e.eventType!==r.CallNetworkQualityEventType.NetworkReceiveCatastrophic&&e.eventType!==r.CallNetworkQualityEventType.NetworkSendCatastrophic||(this._receiveCatastrophic[t]=e.networkState),this.trigger(t))},this._listenStartAndStopCallEvents()}getCallReconnectionState(e){if(e in this._reconnection)return this._reconnection[e]}isCallQualityPoor(e){if(this.isCallCatastrophic(e))return!0;const t=this._getCallReceivedQualityState(e);return c.log(l.LogTraceArea.Calling,`isCallQualityPoor: connectionState=${t}`),t===r.NetworkConnectionState.LostConnection}isCallCatastrophic(e){const t=this._getCallReceiveCatastrophic(e);return c.log(l.LogTraceArea.Calling,`isCallCatastrophic: connectionState=${t}`),t===r.NetworkConnectionState.Connecting||t===r.NetworkConnectionState.LostConnection}_getCallReceivedQualityState(e){if(e in this._receiveQuality)return this._receiveQuality[e]}_getCallReceiveCatastrophic(e){if(e in this._receiveCatastrophic)return this._receiveCatastrophic[e]}test_listenStartAndStopCallEvents(){this._listenStartAndStopCallEvents()}_listenStartAndStopCallEvents(){s.default.CallingStore.callCreatedEvent().subscribe(this._startWatchingForNetworkConnectionChanges),s.default.CallingStore.callEndedEvent().subscribe(this._stopWatchingForNetworkConnectionChanges)}};a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"getCallReconnectionState",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"isCallQualityPoor",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"isCallCatastrophic",null),a.__decorate([o.disableWarnings],u.prototype,"_listenStartAndStopCallEvents",null),u=a.__decorate([o.AutoSubscribeStore],u),t.CallNetworkConnectionStore=u,t.default=function(){return d||(d=new u)}},76514:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(496486),o=i(217041),s=i(436237),r=i(366355),l=i(914976);let c=class extends o.StoreBase{constructor(){super(...arguments),this._pinnedParticipants={}}pinParticipant(e,t){s.log(r.LogTraceArea.CallingUI,"Pinning participant with key "+l.mriOrId(e)+" for the callId: "+t),this._pinnedParticipants[t]||(this._pinnedParticipants[t]=[]),this._pinnedParticipants[t].push(e),this.trigger(t)}unpinParticipant(e,t){s.log(r.LogTraceArea.CallingUI,"Trying to unpin participant with key "+l.mriOrId(e)+" for the callId: "+t),this._pinnedParticipants[t]&&(n.pull(this._pinnedParticipants[t],e),this.trigger(t))}cleanupPinnedParticipants(e){s.log(r.LogTraceArea.CallingUI,"Cleaning up the call participants for a call "+e),delete this._pinnedParticipants[e],this.trigger(e)}getPinnedParticipants(e){return this._pinnedParticipants[e]}isParticipantPinned(e,t){return n.includes(this._pinnedParticipants[t],e)}hasPinnedParticipants(e){return!n.isEmpty(this._pinnedParticipants[e])}};a.__decorate([o.autoSubscribe,a.__param(0,o.key)],c.prototype,"getPinnedParticipants",null),a.__decorate([o.autoSubscribe,a.__param(1,o.key)],c.prototype,"isParticipantPinned",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],c.prototype,"hasPinnedParticipants",null),c=a.__decorate([o.AutoSubscribeStore],c),t.default=new c},544279:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(496486),o=i(217041),s=i(718260),r=i(671830),l=i(488366),c=i(695742),d=i(527683);let u=class extends o.StoreBase{constructor(){super(...arguments),this._phoneNumberRates={},this._phoneNumberSkypeCallRates={},this._lookups={},this._getPhoneNumberFromPhoneMri=e=>{const t=r.getPhoneNumberFromMri(e);return t?d.default.stripPlusSign(t):e},this._getPhoneNumberRates=e=>this._phoneNumberRates[e]&&this._phoneNumberRates[e][e]?this._phoneNumberRates[e][e]:void 0,this._getCallRateFundingSourceForPhoneNumber=e=>this._phoneNumberSkypeCallRates[e]&&this._phoneNumberSkypeCallRates[e][e]?this._phoneNumberSkypeCallRates[e][e].callFundedBy:void 0}_startedTrackingKey(e){const t=r.isMri(e)?this._getPhoneNumberFromPhoneMri(e):e;this._lookups[t]||(this._lookups[t]=c.default.getRates([t]).finally((()=>{delete this._lookups[t]})).then((i=>{const a={};n.transform(i,((e,t)=>{const i=s.compileCallRateLabel(t);i&&(e[t.pstnNumber]=i)}),a),this._phoneNumberRates[t]=a,this._phoneNumberSkypeCallRates[t]=i,this.trigger(e)})))}_stoppedTrackingKey(e){const t=this._lookups[e];t&&(delete this._lookups[e],t.cancel()),delete this._phoneNumberRates[e],delete this._phoneNumberSkypeCallRates[e]}getCallRateByPhoneNumber(e){return this._getPhoneNumberRates(e)}getCallRateByMri(e){const t=this._getPhoneNumberFromPhoneMri(e);return this._getPhoneNumberRates(t)}isPhoneNumberEligibleForTaster(e){const t=this._getCallRateFundingSourceForPhoneNumber(e);return!!t&&t===l.CallRateFundingSource.TasterCall}isPhoneMriTollFree(e){const t=this._getPhoneNumberFromPhoneMri(e),i=this._getCallRateFundingSourceForPhoneNumber(t);return!!i&&i===l.CallRateFundingSource.FreeCall}};a.__decorate([o.disableWarnings],u.prototype,"_startedTrackingKey",null),a.__decorate([o.disableWarnings],u.prototype,"_stoppedTrackingKey",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"getCallRateByPhoneNumber",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"getCallRateByMri",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"isPhoneNumberEligibleForTaster",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],u.prototype,"isPhoneMriTollFree",null),u=a.__decorate([o.AutoSubscribeStore],u),t.default=new u},278968:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const a=i(570655),n=i(496486),o=i(217041),s=i(397691),r=i(476621),l=i(351077),c=i(562141),d=i(746096),u=i(436237),h=i(18078),p=i(33004),g=i(914976),C=i(422538);!function(e){e[e.EventReactions=0]="EventReactions"}(t.TriggerKeys||(t.TriggerKeys={}));let S=class extends o.StoreBase{constructor(){super(),this._reactionGroups={},this._outerToInnerThreadMap={},this._isAnimationPlaying=!1,C.RegisterStartupable(this,"CallReactionsStore",[r.default])}startup(){return s.Resolved()}destroy(){this._messagesUpdatedSubscriptionToken&&(this._messagesUpdatedSubscriptionToken.unsubscribe(),this._messagesUpdatedSubscriptionToken=void 0)}_startedTrackingKey(e){u.log(d.LogTraceArea.CallReactions,"CallReactionsStore._startedTrackingKey, reactionsConversationMri: "+g.mriOrId(e)),this._reactionGroups[e]||(this._reactionGroups[e]=this._newCallReactionsGroup()),c.default.getMessagesInConversation(e).then((t=>{t.length&&this._reactionGroups[e]&&this._putInnerOrOuterThreadReactions(e,t)})),this._messagesUpdatedSubscriptionToken||(this._messagesUpdatedSubscriptionToken=r.default.messagesProcessed.subscribe((e=>{const t=n.filter(e,(e=>!!this._reactionGroups[e.conversationId]||!!this._outerToInnerThreadMap[e.conversationId])),i=n.groupBy(t,(e=>e.conversationId));n.each(i,((e,t)=>{this._putInnerOrOuterThreadReactions(t,e)}))})))}_stoppedTrackingKey(e){const t=this._reactionGroups[e];t&&t.outerThreadMri&&this._clearOuterThreadAssignment(e,t.outerThreadMri)}assignOuterThread(e,t){if(u.log(d.LogTraceArea.CallReactions,"CallReactionsStore.assignOuterThread, outerThreadMri: "+g.mriOrId(t)+" innerThreadMri: "+g.mriOrId(e)),this._outerToInnerThreadMap[t]||(this._outerToInnerThreadMap[t]=[]),n.includes(this._outerToInnerThreadMap[t],e)||this._outerToInnerThreadMap[t].push(e),this._reactionGroups[e]){const i=this._reactionGroups[e].outerThreadMri;i&&i!==t&&this._clearOuterThreadAssignment(e,i)}else this._reactionGroups[e]=this._newCallReactionsGroup();this._reactionGroups[e].outerThreadMri=t}clearOuterThreadAssignment(e,t){u.log(d.LogTraceArea.CallReactions,"CallReactionsStore.clearOuterThreadAssignment, outerThreadMri: "+g.mriOrId(t)+" innerThreadMri: "+g.mriOrId(e)),this._clearOuterThreadAssignment(e,t)}setReactionPressedScenario(e){this._reactionPressedScenario=e}maybeGetAndClearReactionPressedScenario(){const e=this._reactionPressedScenario;return this._reactionPressedScenario=void 0,e}setHasPostedReactions(e,t){const i=this._reactionGroups[e];i&&i.hasPostedReactions!==t&&(i.hasPostedReactions=t,t&&this._triggerForMri(e))}getUnseenIncomingTextCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingTextCount:0}resetUnSeenIncomingTextCount(e){const t=this._reactionGroups[e];t&&(t.unseenIncomingTextCount=0),this._triggerForMri(e)}getUnseenIncomingPhotoCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingPhotoCount:0}resetUnSeenIncomingPhotoCount(e){const t=this._reactionGroups[e];t&&(t.unseenIncomingPhotoCount=0),this._triggerForMri(e)}markOneIncomingPhotoSeen(e){const t=this._reactionGroups[e];t&&t.unseenIncomingPhotoCount>0&&t.unseenIncomingPhotoCount--,this._triggerForMri(e)}getUnseenIncomingTranscriptionCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingTranscriptionCount:0}resetUnseenIncomingTranscriptionCount(e){const t=this._reactionGroups[e];t&&(t.unseenIncomingTranscriptionCount=0),this._triggerForMri(e)}getUnseenIncomingEventsCount(e){const t=this._reactionGroups[e];return t?t.unseenIncomingEventsCount:0}resetUnseenIncomingEventsCount(e){const t=this._reactionGroups[e];t&&(t.unseenIncomingEventsCount=0),this._triggerForMri(e)}hasPostedReactions(e){const t=this._reactionGroups[e];return!!t&&t.hasPostedReactions}getReactions(e,t=0){const i=this._reactionsInfoForThreadMri(e);return i&&i.allReactions.length?n.filter(i.allReactions,((e,i)=>e.createdTime>t&&!e.isEmoticonCallReaction())):[]}getTextReactions(e,t=0){const i=this._reactionsInfoForThreadMri(e);return i&&i.textReactions.length?t>0?n.filter(i.textReactions,((e,i)=>e.createdTime>t)):i.textReactions:[]}getLastReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);if(!i||!i.textReactions.length)return;const a=n.last(i.textReactions);return a&&a.createdTime>t?a:void 0}getPictureReactions(e,t=0,i=!1){const a=this._reactionsInfoForThreadMri(e);return a&&a.photoReactions.length?t>0||i?n.filter(a.photoReactions,((a,n)=>!(a.createdTime<=t)&&(!i||a.conversationId===e))):a.photoReactions:[]}getLastTranscriptionReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);if(!i||!i.transcriptionReactions.length)return;const a=n.last(i.transcriptionReactions);return a&&a.createdTime>t?a:void 0}getLastTranscriptionReactions(e,t=0){const i=this._reactionsInfoForThreadMri(e);if(!i||!i.transcriptionReactions.length)return[];return n.filter(i.transcriptionReactions,(e=>e.createdTime>t))}getEventsReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);return i&&i.eventReactions.length?t>0?n.filter(i.eventReactions,((i,a)=>!(i.createdTime<=t)&&i.conversationId===e)):i.eventReactions:[]}getLastEventReaction(e,t=0){const i=this._reactionsInfoForThreadMri(e);if(!i||!i.eventReactions.length)return;const a=n.last(i.eventReactions);return a&&a.createdTime>t?a:void 0}_clearOuterThreadAssignment(e,t){if(this._outerToInnerThreadMap[t]){const i=this._outerToInnerThreadMap[t];n.remove(i,(t=>t===e)),n.isEmpty(i)&&delete this._outerToInnerThreadMap[t]}}_putInnerOrOuterThreadReactions(e,t){const i=this._innerThreadMris(e),a=n.filter(i,(e=>this._putReactions(e,t)));this.trigger(a)}_putReactions(e,t){const i=this._reactionGroups[e];if(!i)return!1;let a=!1;return n.each(t,(t=>{if(t.isDeletedMessage())i.callReactionsInfo.allReactions=n.filter(i.callReactionsInfo.allReactions,(e=>e.cuid!==t.cuid)),i.callReactionsInfo.photoReactions=n.filter(i.callReactionsInfo.photoReactions,(e=>e.cuid!==t.cuid)),i.callReactionsInfo.textReactions=n.filter(i.callReactionsInfo.textReactions,(e=>e.cuid!==t.cuid)),i.callReactionsInfo.transcriptionReactions=n.filter(i.callReactionsInfo.transcriptionReactions,(e=>e.cuid!==t.cuid)),i.callReactionsInfo.eventReactions=n.filter(i.callReactionsInfo.eventReactions,(e=>e.cuid!==t.cuid));else{if(this._maybeUpdateReactionMessage(t,e))return;if(l.getMessageTypeGroup(t)===l.MessageTypeGroups.Picture)i.callReactionsInfo.photoReactions.push(t),h.default.isMyMri(t.creator)||i.unseenIncomingPhotoCount++;else{if(l.getMessageTypeGroup(t)!==l.MessageTypeGroups.Text)return;l.isCaptionMessageType(t.messagetype)?(i.callReactionsInfo.transcriptionReactions.push(t),i.unseenIncomingTranscriptionCount++):p.default.isCallEventReaction(t)?(i.callReactionsInfo.eventReactions.push(t),i.unseenIncomingEventsCount++):(i.callReactionsInfo.textReactions.push(t),t.isEmoticonCallReaction()||i.unseenIncomingTextCount++)}i.callReactionsInfo.allReactions.push(t)}a=!0})),u.log(d.LogTraceArea.CallReactions,"CallReactionsStore._putReactions, triggering changes: "+a+" innerThreadMri: "+g.mriOrId(e)+" unseenIncomingPhotoCount: "+i.unseenIncomingPhotoCount+" unseenIncomingTextCount: "+i.unseenIncomingTextCount),a}setAnimationIsPlaying(e){this._isAnimationPlaying=e}isAnimationPlaying(){return this._isAnimationPlaying}_maybeUpdateReactionMessage(e,t){const i=this._reactionsInfoForThreadMri(t);return!!i&&(!!this._replaceReactionMessage(e,i.allReactions)&&(l.getMessageTypeGroup(e)===l.MessageTypeGroups.Picture?this._replaceReactionMessage(e,i.photoReactions):l.getMessageTypeGroup(e)===l.MessageTypeGroups.Text&&(l.isCaptionMessageType(e.messagetype)?this._replaceReactionMessage(e,i.transcriptionReactions):p.default.isCallEventReaction(e)?this._replaceReactionMessage(e,i.eventReactions):this._replaceReactionMessage(e,i.textReactions)),!0))}_replaceReactionMessage(e,t){const i=n.findIndex(t,(t=>t.cuid===e.cuid));return i>=0&&(t.splice(i,1,e),!0)}_newCallReactionsGroup(){return{callReactionsInfo:{allReactions:[],photoReactions:[],textReactions:[],transcriptionReactions:[],eventReactions:[]},unseenIncomingPhotoCount:0,unseenIncomingTextCount:0,unseenIncomingTranscriptionCount:0,unseenIncomingEventsCount:0,hasPostedReactions:!1}}_reactionsInfoForThreadMri(e){const t=this._reactionGroups[e];if(t&&t.callReactionsInfo)return t.callReactionsInfo}_innerThreadMris(e){return this._reactionGroups[e]?[e]:this._outerToInnerThreadMap[e]||[]}_triggerForMri(e){const t=n.uniq(this._innerThreadMris(e));this.trigger(t)}test_putInnerOrOuterThreadReactions(e,t){this._putInnerOrOuterThreadReactions(e,t)}test_reset(){this._reactionGroups={},this._outerToInnerThreadMap={}}};a.__decorate([o.disableWarnings],S.prototype,"_startedTrackingKey",null),a.__decorate([o.disableWarnings],S.prototype,"_stoppedTrackingKey",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getUnseenIncomingTextCount",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getUnseenIncomingPhotoCount",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getUnseenIncomingTranscriptionCount",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getUnseenIncomingEventsCount",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"hasPostedReactions",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getReactions",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getTextReactions",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getLastReaction",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getPictureReactions",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getLastTranscriptionReaction",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getLastTranscriptionReactions",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getEventsReaction",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],S.prototype,"getLastEventReaction",null),a.__decorate([o.autoSubscribe],S.prototype,"isAnimationPlaying",null),S=a.__decorate([o.AutoSubscribeStore],S),t.default=new S},156018:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallScreenElementsStore=void 0;const a=i(570655),n=i(496486),o=i(148540),s=i(174958),r=i(217041),l=i(889391),c=i(436237),d=i(994224),u=i(136850),h=i(480200),p=i(746096),g=i(861253),C=i(646393),S=i(598925),m=i(853374),y=i(76514);let f=class extends r.StoreBase{constructor(){super(...arguments),this._statePerCallId=new Map}_startedTrackingKey(e){c.log(p.LogTraceArea.CallingUI,`CallScreenElementsStore._startedTrackingKey: callId ${e}`);const t={remoteCallElements:new Map,stageElements:[],trayElements:[],stageCapacity:Number.MAX_VALUE,trayMainAxisSize:Number.MAX_VALUE,trayRemainder:0,trayItemSizeMultiplier:1,trayItemsCompact:!1,layoutStoreSubscription:u.default.subscribe((()=>this._onLayoutStoreUpdate(e)),e),callParticipantsStoreSubscription:d.default.CallParticipantStore.subscribe((()=>this._onParticipantsChanged(e)),e),callPinningStoreSubscription:y.default.subscribe((()=>this._onParticipantsChanged(e)),e)};this._statePerCallId.set(e,t),this._onLayoutStoreUpdate(e),this._onParticipantsChanged(e)}_stoppedTrackingKey(e){const t=m.default.newCauseId();c.log(p.LogTraceArea.CallingUI,"CallScreenElementsStore cleaning up subscriptions for call "+e+" causeId: "+t),this._cleanupFullscreenBotStreamOverrides(e,t);const i=this._getCallScreenElementsStateFor(e);i&&(u.default.unsubscribe(i.layoutStoreSubscription),d.default.CallParticipantStore.unsubscribe(i.callParticipantsStoreSubscription),y.default.unsubscribe(i.callPinningStoreSubscription),this._statePerCallId.delete(e))}_getCallScreenElementsStateFor(e){return this._statePerCallId.get(e)}_onLayoutStoreUpdate(e){var t;const i=u.default.getStageMode(e),a=m.default.newCauseId();c.log(p.LogTraceArea.CallingUI,"CallScreenElementsStore._onLayoutStoreUpdate: callId "+e+" stageMode: "+h.StageMode[i]+" causeId: "+a),this._cleanupFullscreenBotStreamOverrides(e,a);const n=this._getCallScreenElementsStateFor(e);n&&(n.manager=this._getStageModeManager(e,i,a),this._updateScreenElements(e,null===(t=n.manager)||void 0===t?void 0:t.onInit(this._getCallParticipantsMris(e)),a))}_cleanupFullscreenBotStreamOverrides(e,t){var i;null===(i=d.default.CallingStore.getVideoOverrides(e))||void 0===i||i.clearRemoteStreamOverride(S.VideoOverrideReason.FullScreenBot)}_registerFullscreenBotStreamOverrides(e,t){var i;null===(i=d.default.CallingStore.getVideoOverrides(e))||void 0===i||i.setRemoteStreamOverride(S.VideoOverrideReason.FullScreenBot)}_updateScreenElements(e,t,i){t&&(this._setStageParticipants(e,t.stageParticipants),this._setTrayParticipants(e,t.trayParticipants),this._setTrayRemainder(e,t.trayRemainder||0))}_getStageModeManager(e,t,i){const a=this._getCallScreenElementsStateFor(e);if(a)switch(t){case h.StageMode.Grid:case h.StageMode.Manual:return new C.GridModeElementsManager(e,a.trayMainAxisSize,a.trayItemSizeMultiplier,a.trayItemsCompact,a.stageCapacity,u.default.getOnlyVideoOnTheStage(e),u.default.getSelfInTheGrid(e));case h.StageMode.Speaker:return new C.SpeakerModeElementsManager(e,a.trayMainAxisSize,a.trayItemSizeMultiplier,a.trayItemsCompact);case h.StageMode.Presentation:case h.StageMode.FocusedScreenShare:return new C.PresentationModeElementsManager(e,a.trayMainAxisSize,a.trayItemSizeMultiplier,a.trayItemsCompact);case h.StageMode.LargeGrid:return this._registerFullscreenBotStreamOverrides(e,i),new C.LgTmModeElementsManager(e,a.trayMainAxisSize,a.trayItemSizeMultiplier,a.trayItemsCompact,C.FullScreenBotType.LargeGrid);case h.StageMode.TogetherMode:return this._registerFullscreenBotStreamOverrides(e,i),new C.LgTmModeElementsManager(e,a.trayMainAxisSize,a.trayItemSizeMultiplier,a.trayItemsCompact,C.FullScreenBotType.TogetherMode)}else c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._getStageModeManager call id '${e}' is undefined`)}_onParticipantsChanged(e){var t;const i=m.default.newCauseId(),a=this._getCallScreenElementsStateFor(e);if(!a)return void c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._onParticipantsChanged call id '${e}' is undefined`);const s=[...this._getRemoteCallElements(e).keys()],r=d.default.CallParticipantStore.getParticipantRenderInfosForCall(e),l=[];r.forEach((e=>{a.remoteCallElements.set(e.renderKey,{mri:e.mri,renderKey:e.renderKey,participantState:e.state||o.ParticipantState.None,isScreenShare:e.isAScreensharing}),l.push(e.renderKey)}));const u=n.difference(s,l);n.each(u,(e=>{a.remoteCallElements.delete(e)})),this._updateScreenElements(e,null===(t=a.manager)||void 0===t?void 0:t.updateParticipants(this._getCallParticipantsMris(e)),i)}_setStageParticipants(e,t){const i=this._getCallScreenElementsStateFor(e);i?(0,g.default)(i.stageElements,t)||(c.log(p.LogTraceArea.CallingUI,"Stage participants for callId "+e+" updated. New stage elements: "+s.pii.Omit(t.toString())),i.stageElements=t,this.trigger(e)):c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._setStageParticipants call id '${e}' is undefined`)}_setTrayParticipants(e,t){const i=this._getCallScreenElementsStateFor(e);i?n.xor(i.trayElements,t).length&&(c.log(p.LogTraceArea.CallingUI,"Tray participants for callId "+e+" updated. New tray elements: "+s.pii.Omit(t.toString())),i.trayElements=t,this.trigger(e)):c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._setTrayParticipants call id '${e}' is undefined`)}_getCallParticipantsMris(e){const t=this._getCallScreenElementsStateFor(e);return t?l.default.getS4LCMCFeatures().enableMultipleStreamSupport?n.uniq(Array.from(t.remoteCallElements.values()).map((e=>e.renderKey||e.mri))):Array.from(t.remoteCallElements.keys()):(c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._getCallParticipantsMris call id '${e}' is undefined`),[])}_setTrayRemainder(e,t){const i=this._getCallScreenElementsStateFor(e);i?i.trayRemainder!==t&&(i.trayRemainder=t,this.trigger(e)):c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore._setTrayRemainder call id '${e}' is undefined`)}_getRemoteCallElements(e){var t,i;return n.clone(null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.remoteCallElements)&&void 0!==i?i:new Map)}getStageElements(e){var t,i;return n.clone(null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.stageElements)&&void 0!==i?i:[])}getTrayElements(e){var t,i;return n.clone(null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.trayElements)&&void 0!==i?i:[])}getTrayRemainder(e){var t,i;return null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.trayRemainder)&&void 0!==i?i:0}trayHasParticipants(e){var t,i,a;return(null!==(a=null===(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.trayElements)||void 0===i?void 0:i.length)&&void 0!==a?a:0)>0}setStageCapacity(e,t){const i=this._getCallScreenElementsStateFor(e);if(!i)return void c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore.setStageCapacity call id '${e}' is undefined`);const{manager:a}=i;if(a&&a instanceof C.GridModeElementsManager&&i.stageCapacity!==t){i.stageCapacity=t;const n=this._getCallParticipantsMris(e),o=m.default.newCauseId();this._updateScreenElements(e,a.updateStageCapacity(n,i.stageCapacity),o),this.trigger(e)}}getStageCapacity(e){var t,i;return null!==(i=null===(t=this._getCallScreenElementsStateFor(e))||void 0===t?void 0:t.stageCapacity)&&void 0!==i?i:0}setTrayParameters(e,t,i=1,a=!1){var n;const o=this._getCallScreenElementsStateFor(e);if(o){if(o.trayMainAxisSize!==t&&0!==t){o.trayMainAxisSize=t,o.trayItemSizeMultiplier=i,o.trayItemsCompact=a;const s=this._getCallParticipantsMris(e),r=m.default.newCauseId();this._updateScreenElements(e,null===(n=o.manager)||void 0===n?void 0:n.setTrayParameters(t,s,i,a),r)}}else c.error(p.LogTraceArea.CallingUI,`CallScreenElementsStore.setTrayParameters call id '${e}' is undefined`)}getRemoteCallElements(e,t=!1){return t&&this._onParticipantsChanged(e),this._getRemoteCallElements(e)}};a.__decorate([r.disableWarnings],f.prototype,"_startedTrackingKey",null),a.__decorate([r.disableWarnings],f.prototype,"_stoppedTrackingKey",null),a.__decorate([r.autoSubscribe,a.__param(0,r.key)],f.prototype,"getStageElements",null),a.__decorate([r.autoSubscribe,a.__param(0,r.key)],f.prototype,"getTrayElements",null),a.__decorate([r.autoSubscribe,a.__param(0,r.key)],f.prototype,"getTrayRemainder",null),a.__decorate([r.autoSubscribe,a.__param(0,r.key)],f.prototype,"trayHasParticipants",null),a.__decorate([r.autoSubscribe,a.__param(0,r.key)],f.prototype,"getStageCapacity",null),a.__decorate([a.__param(0,r.key)],f.prototype,"getRemoteCallElements",null),f=a.__decorate([r.AutoSubscribeStore],f),t.CallScreenElementsStore=f,t.default=new f},136850:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(496486),o=i(217041),s=i(397691),r=i(889391),l=i(994224),c=i(109520),d=i(480200),u=i(471727),h=i(746096),p=i(436237),g=i(330124),C=i(422538),S=i(853374),m=i(178735),y=d.StageMode.Grid;let f=class extends o.StoreBase{constructor(){super(),this._stageLayoutMode={},this._fallbackStageLayoutMode={},this._callHeaderLayoutMode={},this._fallbackCallHeaderLayoutMode={},this._onlyVideoOnTheStage={},this._selfInTheGrid={},this._hideTopTray={},this._callScreenshareStoreSubscriptions={},this._callCallingStoreSubscriptions={},this._wasFullScreenBotAutoTriggered={},C.RegisterStartupable(this,"CallStageLayoutStore")}startup(){return s.Resolved()}onStartTrackingCall(e,t,i){this._setDefaultHeaderLayoutMode(e,t),this._setDefaultSelfInTheGrid(t,e),this.setStageMode(e,y,i,!0),this._subscribeToScreenshareStore(e),this._subscribeForFullScreenBots(e,t)}onStopTrackingCall(e){this._cleanUpStageLayoutSettings(e),this._unsubscribeFromScreenshareStore(e),this._unsubscribeForFullScreenBots(e)}_subscribeForFullScreenBots(e,t){this._callCallingStoreSubscriptions[e]||(this._callCallingStoreSubscriptions[e]=l.default.CallingStore.subscribe((()=>this._onCallingStoreChanged(e,t)),e))}_unsubscribeForFullScreenBots(e){this._callCallingStoreSubscriptions[e]&&(l.default.CallingStore.unsubscribe(this._callCallingStoreSubscriptions[e]),delete this._callCallingStoreSubscriptions[e],delete this._wasFullScreenBotAutoTriggered[e])}_onCallingStoreChanged(e,t){const i=S.default.newCauseId();if(l.default.CallingStore.isConnectedAudienceBotInCall(e)&&!this._wasFullScreenBotAutoTriggered[e]){p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._onCallingStoreChanged with audience bot,\n                causeId: ${i}`),this._wasFullScreenBotAutoTriggered[e]=!0;const t=d.StageMode.TogetherMode;this._setFallbackStageMode(e,i,t),l.default.CallScreenShareStore.hasIncomingScreensharing(e)||(this._setStageMode(e,t,i,!0),this._setFallbackHeaderLayoutMode(e,i),this._setCallHeaderLayoutMode(e,d.CallPanelHeaderLayout.Window,i))}else if(!l.default.CallingStore.isPossiblyNotConnectedAudienceBotInCall(e)&&this._wasFullScreenBotAutoTriggered[e]){p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._onCallingStoreChanged audience bot disconnected,\n                causeId: ${i}`),this._wasFullScreenBotAutoTriggered[e]=!1;const a=this._getStageMode(e);u.default.isTogetherMode(a)?(this._setDefaultHeaderLayoutMode(e,t),this.setStageMode(e,y,i,!0)):u.default.isInIncomingScreenshareMode(a)&&this._setFallbackStageMode(e,i,y)}}_subscribeToScreenshareStore(e){this._callScreenshareStoreSubscriptions[e]||(this._callScreenshareStoreSubscriptions[e]=l.default.CallScreenShareStore.subscribe((()=>this._onScreensharingChanged(e)),e))}_unsubscribeFromScreenshareStore(e){this._callScreenshareStoreSubscriptions[e]&&(l.default.CallScreenShareStore.unsubscribe(this._callScreenshareStoreSubscriptions[e]),delete this._callScreenshareStoreSubscriptions[e])}_onScreensharingChanged(e){const t=S.default.newCauseId();p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._onScreensharingChanged, causeId: ${t}`),l.default.CallScreenShareStore.hasIncomingScreensharing(e)?this._applyScreensharingSettings(e,t):this._applyFallbackSettings(e,t)}_applyScreensharingSettings(e,t){this._setFallbackStageMode(e,t);const i=u.default.getScreensharingMode();this._setStageMode(e,i,t,!0),this._setFallbackHeaderLayoutMode(e,t),this._setCallHeaderLayoutMode(e,d.CallPanelHeaderLayout.Window,t)}_applyFallbackSettings(e,t){u.default.isInIncomingScreenshareMode(this._getStageMode(e))&&this._resetStageModeToFallback(e,t),this._resetHeaderModeToFallback(e)}getStageMode(e){return this._getStageMode(e)}_getStageMode(e){return n.isUndefined(this._stageLayoutMode[e])?y:this._stageLayoutMode[e]}setStageMode(e,t,i,a){this._setStageMode(e,t,i,a),n.isUndefined(this._fallbackStageLayoutMode[e])||delete this._fallbackStageLayoutMode[e]}getAvailableStageModes(e){const t=r.default.getS4LCMCFeatures(),i=[d.StageMode.Grid],a=l.default.CallingStore.isOneOnOneCall(e);l.default.CallScreenShareStore.hasIncomingScreensharing(e)?i.push(u.default.getScreensharingMode()):a||i.push(d.StageMode.Speaker);const n=l.default.CallingStore.isPSTNCall(e),o=l.default.CallingStore.isEncryptedCall(e);if(n||o)return i;return(a?t.callAudienceBotConfig.enabledOneOnOneCall:t.callAudienceBotConfig.enabledGroupCall)&&i.push(d.StageMode.TogetherMode),!a&&t.callGridViewBotConfig.enabled&&i.push(d.StageMode.LargeGrid),i}getAvailableStageModesV2(e){const t=r.default.getS4LCMCFeatures(),i=[],a=l.default.CallingStore.isOneOnOneCall(e);a||i.push(d.StageMode.Speaker),l.default.CallScreenShareStore.hasIncomingScreensharing(e)&&i.push(u.default.getScreensharingMode()),i.push(d.StageMode.Grid);const n=l.default.CallingStore.isPSTNCall(e),o=l.default.CallingStore.isEncryptedCall(e);if(n||o)return i;!a&&t.callGridViewBotConfig.enabled&&i.push(d.StageMode.LargeGrid);return(a?t.callAudienceBotConfig.enabledOneOnOneCall:t.callAudienceBotConfig.enabledGroupCall)&&i.push(d.StageMode.TogetherMode),i}_setStageMode(e,t,i,a){const n=this._stageLayoutMode[e];if(n!==t){this._stageLayoutMode[e]=t,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setStageMode: call stage mode\n                changed from ${d.StageMode[n]} to ${d.StageMode[t]}, causeId: ${i}`);const o=this._getOnlyVideoOnTheStage(e),s=m.default.getNewCallScreenDesignEnabledNoSubscription();p.track(new c.CallStageLayoutChangeEvent(n,t,o,o,!!s,!!a)),this.trigger(e)}}_cleanUpStageLayoutSettings(e){delete this._stageLayoutMode[e],delete this._fallbackStageLayoutMode[e],delete this._callHeaderLayoutMode[e],delete this._fallbackCallHeaderLayoutMode[e],delete this._onlyVideoOnTheStage[e],delete this._selfInTheGrid[e],delete this._hideTopTray[e]}_setFallbackStageMode(e,t,i){const a=n.isUndefined(i)?this._stageLayoutMode[e]:i;this._fallbackStageLayoutMode[e]===a||u.default.isInIncomingScreenshareMode(a)||(this._fallbackStageLayoutMode[e]=a,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setFallbackStageMode: fallback call stage mode\n                set to ${d.StageMode[a]}, causeId: ${t}`))}_resetStageModeToFallback(e,t){const i=this._fallbackStageLayoutMode[e];n.isUndefined(i)?(p.log(h.LogTraceArea.Calling,"CallStageLayoutStore.resetStageModeToFallback: No fallback mode found for call id "+e+" causeId: "+t),this.setStageMode(e,y,t,!0)):(p.log(h.LogTraceArea.Calling,`CallStageLayoutStore.resetStageModeToFallback: set stage mode\n                to ${d.StageMode[i]} , causeId ${t}`),this.setStageMode(e,i,void 0,!0),delete this._fallbackStageLayoutMode[e])}getCallHeaderLayoutMode(e){return n.isUndefined(this._callHeaderLayoutMode[e])?this._getDefaultHeaderLayout(!0):this._callHeaderLayoutMode[e]}setCallHeaderLayoutMode(e,t,i){n.isUndefined(this._fallbackCallHeaderLayoutMode[e])||delete this._fallbackCallHeaderLayoutMode[e],this._setCallHeaderLayoutMode(e,t,i)}_setDefaultHeaderLayoutMode(e,t){this._setCallHeaderLayoutMode(e,this._getDefaultHeaderLayout(t))}_setCallHeaderLayoutMode(e,t,i){const a=this._callHeaderLayoutMode[e];a!==t&&(this._callHeaderLayoutMode[e]=t,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setCallHeaderLayoutMode: header layout mode\n                changed from ${d.CallPanelHeaderLayout[a]} to ${d.CallPanelHeaderLayout[t]},\n                causeId: ${i}`),this.trigger(e))}_setFallbackHeaderLayoutMode(e,t){const i=this._callHeaderLayoutMode[e];this._fallbackCallHeaderLayoutMode[e]!==i&&(this._fallbackCallHeaderLayoutMode[e]=i,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._setFallbackHeaderLayoutMode: fallback call header mode\n                set to ${d.CallPanelHeaderLayout[i]}, causeId: ${t}`))}_resetHeaderModeToFallback(e){const t=this._fallbackCallHeaderLayoutMode[e];n.isUndefined(t)?p.log(h.LogTraceArea.Calling,"No header fallback mode found for call id "+e):(p.log(h.LogTraceArea.Calling,`CallStageLayoutStore._resetHeaderModeToFallback: set header mode\n                to ${d.CallPanelHeaderLayout[t]}`),this.setCallHeaderLayoutMode(e,t),delete this._fallbackCallHeaderLayoutMode[e])}_getDefaultHeaderLayout(e){return g.default.isUsingStackNavigationContext()?d.CallPanelHeaderLayout.Mobile:e?d.CallPanelHeaderLayout.Window:d.CallPanelHeaderLayout.Float}getOnlyVideoOnTheStage(e){return this._getOnlyVideoOnTheStage(e)}_getOnlyVideoOnTheStage(e){return n.isUndefined(this._onlyVideoOnTheStage[e])?this._getDefaultOnlyVideoOnTheStage():this._onlyVideoOnTheStage[e]}_getDefaultOnlyVideoOnTheStage(){const e=r.default.getS4LCMCFeaturesNoSubscription();return!m.default.getNewCallScreenDesignEnabledNoSubscription()&&!e.enableAudioParticipantsOnTheStageByDefault}setOnlyVideoOnTheStage(e,t,i){const a=this._onlyVideoOnTheStage[e];if(a!==t){this._onlyVideoOnTheStage[e]=t,p.log(h.LogTraceArea.Calling,`CallStageLayoutStore.setOnlyVideoOnTheStage: onlyVideoOnTheStage changed from ${a} to ${t}, causeId: ${i}`);const n=this._getStageMode(e),o=m.default.getNewCallScreenDesignEnabledNoSubscription();p.track(new c.CallStageLayoutChangeEvent(n,n,a,t,!!o,!1)),this.trigger(e)}}getSelfInTheGrid(e){return this._getSelfInTheGrid(e)}_getSelfInTheGrid(e){return!!n.isUndefined(this._selfInTheGrid[e])||this._selfInTheGrid[e]}_setDefaultSelfInTheGrid(e,t){this.setSelfInTheGrid(e,t)}setSelfInTheGrid(e,t){p.log(h.LogTraceArea.CallingUI,"Set local view on the stage to "+e);m.default.getNewCallScreenDesignEnabledNoSubscription()?this._getSelfInTheGrid(t)!==e&&(this._selfInTheGrid[t]=e,this.trigger(t)):p.warn(h.LogTraceArea.CallingUI,"Attempt to set local video on stage when new call stage is not enabled")}isTopTrayHidden(e){return!!this._hideTopTray[e]}setHideTopTray(e,t){this._hideTopTray[t]!==e&&(this._hideTopTray[t]=e,this.trigger(t))}};a.__decorate([o.autoSubscribe,a.__param(0,o.key)],f.prototype,"getStageMode",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],f.prototype,"getAvailableStageModes",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],f.prototype,"getAvailableStageModesV2",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],f.prototype,"getCallHeaderLayoutMode",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],f.prototype,"getOnlyVideoOnTheStage",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],f.prototype,"getSelfInTheGrid",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],f.prototype,"isTopTrayHidden",null),f=a.__decorate([o.AutoSubscribeStore],f),t.default=new f},518154:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(174958),o=i(496486),s=i(217041),r=i(889391),l=i(994224),c=i(278968),d=i(746096),u=i(436237),h=i(861253),p=i(18078),g=i(404057),C=i(908458);let S=class extends s.StoreBase{constructor(){super(...arguments),this._transcriptionInfo={},this._reactionsStoreSubscription={}}_stoppedTrackingKey(e){const t=this._reactionsStoreSubscription[e];t&&(r.default.getS4LCMCFeaturesNoSubscription().isCallCaptionsDataChannelEnabled?C.default.unsubscribe(t):c.default.unsubscribe(t),delete this._reactionsStoreSubscription[e])}_getTranscriptions(e,t){if(!this._transcriptionInfo[e])return[];let i=this._transcriptionInfo[e].transcriptions;if(o.isEmpty(i))return[];if(t){const a=this._transcriptionInfo[e].consumptionHorizon;i=a?o.filter(i,(e=>e.message.createdTime>=a)):o.clone(i),i.splice(0,Math.max(i.length-t,0))}else i=o.clone(i);return i}getTranscriptions(e,t){return this._getTranscriptions(e,t)}getTranscriptionsMerged(e,t){var i,a,n;const s=this._getTranscriptions(e,t),r=[];let l;for(const e of s){if(l===e.senderMri){const t=o.last(r);null===(i=null==t?void 0:t.messages)||void 0===i||i.push(e.message),null===(a=null==t?void 0:t.payloads)||void 0===a||a.push(e.payload),null===(n=null==t?void 0:t.sentences)||void 0===n||n.push(e.sentence)}else{const t=o.cloneDeep(e);t.messages=[t.message],t.payloads=[t.payload],t.sentences=[t.sentence],r.push(t)}l=e.senderMri}return r}transcriptionCount(e){return this._transcriptionInfo[e]?this._transcriptionInfo[e].transcriptions.length:0}resetUnseenTranscriptionCount(e){if(r.default.getS4LCMCFeaturesNoSubscription().isCallCaptionsDataChannelEnabled){const t=this._transcriptionInfo[e].callId||"";C.default.resetUnseenCaptionsCount(t)}else c.default.resetUnseenIncomingTranscriptionCount(e)}assignCallId(e,t){this._initStorage(e),this._transcriptionInfo[e].callId=t,this._reactionsStoreSubscription[e]||(r.default.getS4LCMCFeaturesNoSubscription().isCallCaptionsDataChannelEnabled?this._reactionsStoreSubscription[e]=C.default.subscribe((()=>this._processReactionsStoreUpdate(e)),t):this._reactionsStoreSubscription[e]=c.default.subscribe((()=>this._processReactionsStoreUpdate(e)),e))}clearCallIdAssignment(e){this._deleteStorage(e)}setConsumptionHorizon(e,t){this._transcriptionInfo[e]&&this._transcriptionInfo[e].consumptionHorizon!==t&&(this._transcriptionInfo[e].consumptionHorizon=t,this.trigger(e))}clearConsumptionHorizon(e){this.setConsumptionHorizon(e,0)}_processReactionsStoreUpdate(e){if(!this._transcriptionInfo[e])return;const t=this._transcriptionInfo[e].callId;if(!t)return;const i=l.default.CallingStore.getParticipantId(t);if(!i)return;if(l.default.CallingStore.isCallOnHold(t))return void u.log(d.LogTraceArea.CallingUI,"CallTranscriptionStore: Call is on hold, ignoring incoming subtitles");let a;a=r.default.getS4LCMCFeaturesNoSubscription().isCallCaptionsDataChannelEnabled?C.default.getLastCaptions(t,this._transcriptionInfo[e].lastItemTime):c.default.getLastTranscriptionReactions(e,this._transcriptionInfo[e].lastItemTime),o.isEmpty(a)?u.log(d.LogTraceArea.CallingUI,"CallTranscriptionStore: no transcription reactions"):(o.each(a,(t=>{this._processTranscription(t,e,i),t.createdTime>this._transcriptionInfo[e].lastItemTime&&(this._transcriptionInfo[e].lastItemTime=t.createdTime)})),this.trigger(e))}_processTranscription(e,t,i){const a=g.default.parseJsonErrorToUndefined(e.content);if(!a||!a.sender||o.isEmpty(a.receivers)||!a.message&&!a.translation)return void u.warn(d.LogTraceArea.CallingUI,"CallTranscriptionStore: Invalid transcription payload: "+n.pii.Omit(e.content));if(!o.includes(a.receivers,i))return;const s=this._transcriptionInfo[t].transcriptions,l=o.findIndex(s,(e=>e.payload.cid===a.cid));let c=a.message||a.translation||"";if(l>=0){if((0,h.default)(s[l].payload,a))return;if(s[l].payload.isFinal&&!a.isFinal)return;!a.isFinal&&s[l].sentence&&(c=s[l].sentence+" "+c)}const p={message:e,payload:a,sentence:c,senderMri:this._getSenderMri(t,a.sender)};if(-1===l){const e=Math.max(50,r.default.getS4LCMCFeaturesNoSubscription().callCaptionsMaxHistory),t=s.length-e+1;t>0&&s.splice(0,t),s.push(p)}else s[l]=p}_getSenderMri(e,t){if(!this._transcriptionInfo[e])return;const i=this._transcriptionInfo[e].callId;if(!i)return;const a=l.default.CallingStore.getParticipantId(i);if(!a)return;if(t===a)return p.default.getSkypeMri();const n=l.default.CallingStore.findRemoteCallMemberByEndpointParticipantId(i,t);return n?n.id:void 0}_initStorage(e){this._transcriptionInfo[e]||(this._transcriptionInfo[e]={transcriptions:[],lastItemTime:0,consumptionHorizon:0})}_deleteStorage(e){this._transcriptionInfo[e]&&delete this._transcriptionInfo[e]}};a.__decorate([s.disableWarnings],S.prototype,"_stoppedTrackingKey",null),a.__decorate([a.__param(0,s.key)],S.prototype,"_getTranscriptions",null),a.__decorate([s.autoSubscribe,a.__param(0,s.key)],S.prototype,"getTranscriptions",null),a.__decorate([s.autoSubscribe,a.__param(0,s.key)],S.prototype,"getTranscriptionsMerged",null),a.__decorate([s.autoSubscribe,a.__param(0,s.key)],S.prototype,"transcriptionCount",null),S=a.__decorate([s.AutoSubscribeStore],S),t.default=new S},346565:(e,t,i)=>{var a;Object.defineProperty(t,"__esModule",{value:!0});const n=i(570655),o=i(496486),s=i(217041),r=i(746096),l=i(436237);var c;!function(e){e[e.CallVisible=0]="CallVisible"}(c||(c={}));let d=a=class extends s.StoreBase{constructor(){super(...arguments),this._visibleCalls={},this._hasVisibleCall=!1,this._callPreviewViews={}}isCallVisible(e){return!!this._visibleCalls[e]}hasVisibleCall(){return this._hasVisibleCall}hasCallPreviewViewBeenSeen(e){return!!this._callPreviewViews[e]}setCallPreviewViewSeen(e){this._callPreviewViews[e]=!0,this.trigger(e)}setCallPreviewViewNotSeen(e){this._callPreviewViews[e]=!1,this.trigger(e)}setCallViewVisible(e,t,i){if(l.log(r.LogTraceArea.CallingUI,"CallVisibilityStore.setCallViewVisible: "+e+" visible: "+(t?"true":"false")+" causeId: "+i),!e)return;const n=!o.isEmpty(this._visibleCalls);if(t){const t=o.find(this._visibleCalls,(t=>t.callId===e));o.isUndefined(t)?this._visibleCalls[e]=a._visibleCall(e):t.refCounter++}else void 0!==this._visibleCalls[e]?(this._visibleCalls[e].refCounter--,this._visibleCalls[e].refCounter<=0&&delete this._visibleCalls[e]):l.warn(r.LogTraceArea.CallingUI,"CallVisibilityStore.setCallViewVisible: "+e+" trying to set visiblity false at a already invisible call");this._triggerUpdates(e,n)}_triggerUpdates(e,t=!0){this.trigger(e);const i=!o.isEmpty(this._visibleCalls);t!==i&&(this._hasVisibleCall=i,this.trigger(c.CallVisible))}static _visibleCall(e){return{callId:e,refCounter:1}}};n.__decorate([s.autoSubscribe,n.__param(0,s.key)],d.prototype,"isCallVisible",null),n.__decorate([(0,s.autoSubscribeWithKey)(c.CallVisible)],d.prototype,"hasVisibleCall",null),n.__decorate([s.autoSubscribe,n.__param(0,s.key)],d.prototype,"hasCallPreviewViewBeenSeen",null),d=a=n.__decorate([s.AutoSubscribeStore],d),t.default=new d},610190:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CallingSettingsStore=t.CallingSettingsFeature=void 0;const a=i(570655),n=i(217041),o=i(889391),s=i(746096),r=i(436237),l=i(372816),c=i(404057);t.CallingSettingsFeature=class{};let d=class extends n.StoreBase{fetch(e=!1){if(this._callingSettings=o.default.getS4LCommerceFeatures().callingSettingsPanel,e)return;const t=this.callForwardingFeature();t&&t.clientEnabled&&this._fetchCallForwarding()}callForwardingFeature(){if(!this._callingSettings)return;const e=this._callingSettings.callForwarding;return{clientEnabled:e.enabled,link:e.link,goTarget:e.goTarget,useExternalWebBrowser:e.useExternalWebBrowser,fetched:void 0!==this._callForwardingEnabled,active:this._callForwardingEnabled}}_fetchCallForwarding(){l.default.getIsCallForwardingEnabledOption().then((e=>this._setCallForwardingEnabled(e))).catch((e=>{r.warn(s.LogTraceArea.Calling,"CallingSettingsStore: "+c.default.errorAsString(e)),this._setCallForwardingEnabled(void 0)}))}_setCallForwardingEnabled(e){this._callForwardingEnabled!==e&&(this._callForwardingEnabled=e,this.trigger())}};a.__decorate([n.autoSubscribe],d.prototype,"callForwardingFeature",null),d=a.__decorate([n.AutoSubscribeStore],d),t.CallingSettingsStore=d,t.default=new d},908458:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(496486),o=i(217041),s=i(994224),r=i(366355),l=i(436237),c=i(109520);let d=class extends o.StoreBase{constructor(){super(...arguments),this._cache={},this._captionsSubscriptionToken={}}_startedTrackingKey(e){this._cache[e]||(this._cache[e]=this._newCallCaptions()),this._captionsSubscriptionToken[e]||(this._captionsSubscriptionToken[e]=s.default.CaptionsDataChannelService.captionReceivedEvent(e).subscribe((t=>{this._putCaptions(e,t)})))}_stoppedTrackingKey(e){var t;this._captionsSubscriptionToken[e]&&(null===(t=this._captionsSubscriptionToken[e])||void 0===t||t.unsubscribe(),this._captionsSubscriptionToken[e]=void 0),delete this._cache[e]}_putCaptions(e,t){this._cache[e]&&t&&(this._cache[e].captions.push(t),this._cache[e].unseenCaptionsCount++,l.log(r.LogTraceArea.Calling,`Emitting event for CaptionsBotResponse for callId: ${e}`),l.track(new c.CallDataChannelEvent(c.CallDataChannelEventType.CaptionsBotResponse)),this.trigger(e))}getLastCaptions(e,t=0){const i=this._cache[e];return(null==i?void 0:i.captions.length)?(0,n.filter)(i.captions,(e=>e.createdTime>t)):[]}getUnseenCaptionsCount(e){return this._cache[e]?this._cache[e].unseenCaptionsCount:0}resetUnseenCaptionsCount(e){const t=this._cache[e];t&&(t.unseenCaptionsCount=0),this.trigger(e)}_newCallCaptions(){return{captions:[],unseenCaptionsCount:0}}};a.__decorate([o.disableWarnings],d.prototype,"_startedTrackingKey",null),a.__decorate([o.disableWarnings],d.prototype,"_stoppedTrackingKey",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],d.prototype,"getLastCaptions",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],d.prototype,"getUnseenCaptionsCount",null),d=a.__decorate([o.AutoSubscribeStore],d),t.default=new d},803493:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CelebrationType=void 0;const a=i(570655),n=i(994224),o=i(952262),s=i(746096),r=i(436237),l=i(861253),c=i(733754),d=i(18078),u=i(172758),h=i(217041);var p;!function(e){e[e.Birthday=0]="Birthday",e[e.SpecialDay=1]="SpecialDay"}(p=t.CelebrationType||(t.CelebrationType={}));let g=class extends h.StoreBase{constructor(){super(...arguments),this._celebrationConversations={}}_startedTrackingKey(e){this._celebrationConversations||(this._celebrationConversations={}),this._celebrationConversations[e]||(this._celebrationConversations[e]=this._newCelebrationConversation()),this._celebrationConversations[e].callIdToken||(r.log(s.LogTraceArea.Calling,"CelebrationStore subscribing to CallingStore for callId : "+e),this._celebrationConversations[e].callIdToken=n.default.CallingStore.subscribe((()=>{this._celebrationConversations[e]?(0,l.default)(this._celebrationConversations[e].participantMris,n.default.CallingStore.getRemoteCallMemberMris(e))||(r.log(s.LogTraceArea.Calling,"CelebrationStore triggering for callId : "+e),this._celebrationConversations[e].participantMris=n.default.CallingStore.getRemoteCallMemberMris(e),this.trigger()):r.warn(s.LogTraceArea.Calling,"No celebration conversation for callId : "+e)}),e))}_stoppedTrackingKey(e){const t=this._celebrationConversations[e];t&&t.callIdToken&&(r.log(s.LogTraceArea.Calling,"CelebrationStore unsubscribing from CallingStore for callId : "+e),n.default.CallingStore.unsubscribe(t.callIdToken),delete this._celebrationConversations[e])}_getCelebrateButtonText(e){const t=e.length;switch(t){case 0:return c.getString("ReactionsStream.CelebrateButtonGenericTitle");case 1:return c.getString("ReactionsStream.CelebrateButtonTitle1User",{firstUser:e[0]});case 2:return c.getString("ReactionsStream.CelebrateButtonTitle2Users",{firstUser:e[0],secondUser:e[1]});default:return c.getString("ReactionsStream.CelebrateButtonTitleMoreUsers",{firstUser:e[0],secondUser:e[1],count:t-2})}}_newCelebrationConversation(){return{callIdToken:void 0,participantMris:[]}}getCelebrationData(e,t){this._celebrationConversations||(this._celebrationConversations={}),this._celebrationConversations[t]||(this._celebrationConversations[t]=this._newCelebrationConversation());const i=this._celebrationConversations[t];if(i){(0,l.default)(i.participantMris,n.default.CallingStore.getRemoteCallMemberMris(t))||(i.participantMris=n.default.CallingStore.getRemoteCallMemberMris(t),this.trigger());const a=i.participantMris.filter((e=>this.isTodayBirthdayForParticipant(e,!1))),s=p.Birthday,r=a.map((t=>{const i=o.default.getMemberShortNameForConversation(e,t);return i||""}));if(a.length>0){return{recipientMris:a,recipientFirstNames:r,celebrationType:s,celebrationText:this._getCelebrateButtonText(r)}}}}isTodayBirthdayForParticipant(e,t){if(d.default.isMyMri(e)&&!t)return!1;const i=u.default.getFullUserProfileByMri(e).birthday;if(i){const e=new Date;e.setHours(0,0,0,0);const t=i.split("-");return e.getDate()===Number(t[2])&&e.getMonth()+1===Number(t[1])}return!1}isTodayBirthdayForParticipantProfile(e){const t=e.birthday;if(t){const e=new Date;e.setHours(0,0,0,0);const i=t.split("-");return e.getDate()===Number(i[2])&&e.getMonth()+1===Number(i[1])}return!1}};a.__decorate([h.disableWarnings],g.prototype,"_startedTrackingKey",null),a.__decorate([h.disableWarnings],g.prototype,"_stoppedTrackingKey",null),a.__decorate([h.autoSubscribe,a.__param(1,h.key)],g.prototype,"getCelebrationData",null),g=a.__decorate([h.AutoSubscribeStore],g),t.default=new g},211437:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(496486),o=i(217041),s=i(397691),r=i(481169),l=i(562141),c=i(400984);let d=class extends o.StoreBase{constructor(){super(...arguments),this._dbLookups={},this._usersByPhoneNumber={},this._usersByPhoneNumberPromise={}}_startedTrackingKey(e){this._dbLookups[e]||(this._dbLookups[e]=l.default.getUserProfilesByPhoneNumber(e).finally((()=>{delete this._dbLookups[e]})).then((t=>{this._isTrackingKey(e)&&(this._usersByPhoneNumber[e]=t,this.trigger(e))})))}_stoppedTrackingKey(e){const t=this._dbLookups[e];t&&(delete this._dbLookups[e],t.cancel()),delete this._usersByPhoneNumber[e]}getSortedUsersByPhoneNumber(e){return this._sortFoundUsers(this._usersByPhoneNumber[e])}getSortedUsersByPhoneNumberAsync(e){return this._usersByPhoneNumber[e]?s.Resolved(this._usersByPhoneNumber[e]):(this._usersByPhoneNumberPromise[e]||(this._usersByPhoneNumberPromise[e]=l.default.getUserProfilesByPhoneNumber(e).finally((()=>{delete this._usersByPhoneNumberPromise[e]})).then((e=>this._sortFoundUsers(e)))),this._usersByPhoneNumberPromise[e])}getUserByPhoneNumberExactMatch(e){return this._getFirstUserMriByExactPhone(this.getSortedUsersByPhoneNumber(e),e)}getUserByPhoneNumberExactMatchAsync(e){return this._usersByPhoneNumberPromise[e]||(this._usersByPhoneNumberPromise[e]=this.getSortedUsersByPhoneNumberAsync(e)),this._usersByPhoneNumberPromise[e].then((t=>this._getFirstUserMriByExactPhone(t,e)))}_getFirstUserMriByExactPhone(e,t){return n.find(e,(e=>!!e.phones&&!!n.find(e.phones,(e=>e.number===t))))}_sortFoundUsers(e){const t=c.default.dangerousGetContactMriListMutable();return(0,r.chain)(e,(0,r.filter)((e=>e.getMri()&&n.includes(t,e.getMri()))),(0,r.sortBy)((e=>e.getDisplayName().toLowerCase())))}test_reset(){this._dbLookups={},this._usersByPhoneNumberPromise={},this._usersByPhoneNumber={}}};a.__decorate([o.disableWarnings],d.prototype,"_startedTrackingKey",null),a.__decorate([o.disableWarnings],d.prototype,"_stoppedTrackingKey",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],d.prototype,"getSortedUsersByPhoneNumber",null),a.__decorate([o.autoSubscribe,a.__param(0,o.key)],d.prototype,"getUserByPhoneNumberExactMatch",null),d=a.__decorate([o.AutoSubscribeStore],d);const u=new d;t.default=u},862633:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DialerUXStore=t.TriggerKeys=void 0;const a=i(570655),n=i(496486),o=i(217041),s=i(397691),r=i(889391),l=i(468734),c=i(544279),d=i(898278),u=i(527683),h=i(789871),p=i(29130),g=i(422538);var C;!function(e){e[e.CallerIdCTA=0]="CallerIdCTA",e[e.CallRate=1]="CallRate",e[e.DialpadCollapse=2]="DialpadCollapse",e[e.SaveContact=3]="SaveContact",e[e.TasterPromotion=4]="TasterPromotion",e[e.DialingExtension=5]="DialingExtension",e[e.CanDialComma=6]="CanDialComma"}(C=t.TriggerKeys||(t.TriggerKeys={}));let S=class extends o.StoreBase{constructor(){super(),this._isDialpadCollapsed=!1,this._shouldShowCallerIdCTA=!1,this._isCallerIdCTACollapsedInPortrait=!1,this._isCallerIdCTACollapsedInLandscape=!1,this._callRatesSubscriptions={},this._callRates={},this._rateIntegrationEnabled=!1,this._saveContactEnabled=!1,this._saveContactVisible=!1,this._tasterPromotionEnabled=!1,this._isRoomForTasterImage=!1,this._canDialComma=!1,this._isDialingExtension=!1,this._updateAppConfigFields=()=>{const e=r.default.getS4LEntitlementFeatures().SCE.UserServices.Client.Features.RateIntegrationEnabled;this._rateIntegrationEnabled!==e&&(this._rateIntegrationEnabled=e,this.trigger(C.CallRate),this._updateCallerIdCTAVisibility());const t=r.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.SaveContactEnabled;this._saveContactEnabled!==t&&(this._saveContactEnabled=t,this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility());const i=r.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.TasterPromotionEnabled;this._tasterPromotionEnabled!==i&&(this._tasterPromotionEnabled=i,this.trigger(C.TasterPromotion))},this._shouldShowCallerIdCTAUpdate=()=>{const e=l.default.shouldShowDialpadCTA();this._shouldShowCallerIdCTA!==e&&(this._shouldShowCallerIdCTA=e,this.trigger(C.CallerIdCTA))},this._searchResultsUpdate=()=>{this._contactSearchResults=h.default.getSearchResults(),this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility()},this._phoneNumberUpdate=()=>{this._phoneNumber=h.default.getPhoneNumber(h.TriggerKeys.E164),this.trigger(C.CallRate),this._updateSaveContactVisibility(),this._updateCallerIdCTAVisibility()},this._phoneNumberInputUpdate=()=>{this._phoneNumber=h.default.getPhoneNumber(h.TriggerKeys.InputValue),this._updateIsDialingExtension(),this._updateCanDialComma()},this._screenSizeUpdate=()=>{const e=p.default.isMobileScreenSize(d.MainRootViewId)&&!p.default.isHeightSmallerThanThreshold(710,d.MainRootViewId);this._isRoomForTasterImage!==e&&(this._isRoomForTasterImage=e,this.trigger(C.TasterPromotion))},this._updateSaveContactVisibility=()=>{const e=this._saveContactEnabled&&this._phoneNumber&&this._phoneNumber.callable&&!this._phoneNumber.emergency&&!this._phoneNumber.extension&&(!this._contactSearchResults||!this._contactSearchResults.selectedResult&&!this._contactSearchResults.exactMatch)&&!(this._callRates[this._phoneNumber.E164]&&this._callRates[this._phoneNumber.E164].isTasterEligible);this._saveContactVisible!==e&&(this._saveContactVisible=!!e,this.trigger(C.SaveContact))},this._updateCallerIdCTAVisibility=()=>{let e=!1,t=!1;this._phoneNumber&&this._callRates[this._phoneNumber.E164]&&(e=!0),this._contactSearchResults&&(this._contactSearchResults.results.length>0||this._contactSearchResults.selectedResult)&&(e=!0),this.isDialpadCollapsed()&&(e=!0),this._saveContactVisible&&(e=!0),this._phoneNumber&&this._phoneNumber.emergency&&(e=!0,t=!0),this._isCallerIdCTACollapsedInPortrait===e&&this._isCallerIdCTACollapsedInLandscape===t||(this._isCallerIdCTACollapsedInPortrait=e,this._isCallerIdCTACollapsedInLandscape=t,this.trigger(C.CallerIdCTA))},this._updateCanDialComma=()=>{const e=!!this._phoneNumber&&this._phoneNumber.callable;this._canDialComma!==e&&(this._canDialComma=e,this.trigger(C.CanDialComma))},this._updateIsDialingExtension=()=>{const e=!!this._phoneNumber&&!!this._phoneNumber.extension;this._isDialingExtension!==e&&(this._isDialingExtension=e,this.trigger(C.DialingExtension))},g.RegisterStartupable(this,"DialerUXStore")}startup(){return r.default.subscribe(this._updateAppConfigFields),this._updateAppConfigFields(),h.default.subscribe(this._searchResultsUpdate,h.TriggerKeys.SearchResults),this._searchResultsUpdate(),h.default.subscribe(this._phoneNumberUpdate,h.TriggerKeys.E164),this._phoneNumberUpdate(),h.default.subscribe(this._phoneNumberInputUpdate,h.TriggerKeys.InputValue),this._phoneNumberInputUpdate(),p.default.subscribe(this._screenSizeUpdate,p.TriggerKeys.ResponsiveWidth),p.default.subscribe(this._screenSizeUpdate,p.TriggerKeys.Height),this._screenSizeUpdate(),s.Resolved()}resetDialerPanelState(){this.toggleDialpadCollapse(!1)}toggleDialpadCollapse(e){this._isDialpadCollapsed=e,this._updateCallerIdCTAVisibility(),this.trigger(C.DialpadCollapse)}isDialpadCollapsed(){return this._isDialpadCollapsed}getCallRate(){if(!this._phoneNumber||!this._isValidPhoneNumber(this._phoneNumber.E164)||!this._rateIntegrationEnabled)return{};const e=this._phoneNumber.E164,t=u.default.stripPlusSign(e);return void 0===this._callRatesSubscriptions[e]&&(this._callRatesSubscriptions[e]=c.default.subscribe((()=>this._callRateUpdate(e)),t),this._callRates[e]={message:c.default.getCallRateByPhoneNumber(t),isTasterEligible:c.default.isPhoneNumberEligibleForTaster(t)}),this._callRates[e]}isSaveContactVisible(e,t){return!this._isInvalidNumberNotificationVisible(e,t)&&this._saveContactVisible}isCallerIdCTAVisibleInPortrait(e,t){return this._isCallerIdCTAVisible(e,t)&&!this._isCallerIdCTACollapsedInPortrait}isCallerIdCTAVisibleInLandscape(e,t){return this._isCallerIdCTAVisible(e,t)&&!this._isCallerIdCTACollapsedInLandscape}shouldShowRateAboveSelectedContact(){return!(this.tasterImageEnabled()&&this.getCallRate().isTasterEligible)}tasterImageEnabled(){return this._tasterPromotionEnabled&&this._isRoomForTasterImage}tasterCoachmarkEnabled(){return this._tasterPromotionEnabled&&!this._isRoomForTasterImage}tasterGreenCallButtonEnabled(){return this._tasterPromotionEnabled}isDialingExtension(){return this._isDialingExtension}canDialComma(){return this._canDialComma}_isCallerIdCTAVisible(e,t){return!this._isInvalidNumberNotificationVisible(e,t)&&(void 0===this._callerIdPromptStoreSubscription&&(this._callerIdPromptStoreSubscription=l.default.subscribe(this._shouldShowCallerIdCTAUpdate,l.TriggerKeys.DialpadCTA),this._shouldShowCallerIdCTA=l.default.shouldShowDialpadCTA()),this._shouldShowCallerIdCTA)}_isInvalidNumberNotificationVisible(e,t){return!!(e&&t&&this._phoneNumber&&this._phoneNumber.E164===t)}_isValidPhoneNumber(e){try{return!n.isEmpty(e)&&u.default.isValidNumberString(e)}catch(e){return!1}}_callRateUpdate(e){const t=u.default.stripPlusSign(e),i={message:c.default.getCallRateByPhoneNumber(t),isTasterEligible:c.default.isPhoneNumberEligibleForTaster(u.default.stripPlusSign(t))};this._callRates[e].message===i.message&&this._callRates[e].isTasterEligible===i.isTasterEligible||(this._callRates[e]=i,this.trigger(C.CallRate),this._updateCallerIdCTAVisibility()),c.default.unsubscribe(this._callRatesSubscriptions[e]),delete this._callRatesSubscriptions[e]}};a.__decorate([(0,o.autoSubscribeWithKey)(C.DialpadCollapse)],S.prototype,"isDialpadCollapsed",null),a.__decorate([(0,o.autoSubscribeWithKey)(C.CallRate)],S.prototype,"getCallRate",null),a.__decorate([(0,o.autoSubscribeWithKey)(C.SaveContact)],S.prototype,"isSaveContactVisible",null),a.__decorate([(0,o.autoSubscribeWithKey)(C.CallerIdCTA)],S.prototype,"isCallerIdCTAVisibleInPortrait",null),a.__decorate([(0,o.autoSubscribeWithKey)(C.CallerIdCTA)],S.prototype,"isCallerIdCTAVisibleInLandscape",null),a.__decorate([(0,o.autoSubscribeWithKey)([C.CallRate,C.TasterPromotion])],S.prototype,"shouldShowRateAboveSelectedContact",null),a.__decorate([(0,o.autoSubscribeWithKey)(C.TasterPromotion)],S.prototype,"tasterImageEnabled",null),a.__decorate([(0,o.autoSubscribeWithKey)(C.TasterPromotion)],S.prototype,"tasterCoachmarkEnabled",null),a.__decorate([(0,o.autoSubscribeWithKey)(C.TasterPromotion)],S.prototype,"tasterGreenCallButtonEnabled",null),a.__decorate([(0,o.autoSubscribeWithKey)(C.DialingExtension)],S.prototype,"isDialingExtension",null),a.__decorate([(0,o.autoSubscribeWithKey)(C.CanDialComma)],S.prototype,"canDialComma",null),S=a.__decorate([o.AutoSubscribeStore],S),t.DialerUXStore=S,t.default=new S},759799:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.E911Store=void 0;const a=i(570655),n=i(421832),o=i(583367),s=i(496486),r=i(217041),l=i(889391),c=i(349663),d=i(746096),u=i(436237),h=i(993924),p=i(861253),g=i(46634),C=i(178735),S=i(581736),m=i(46929),y=i(735426),f=i(422538),b=(i(640363),i(478262));let _=class extends r.StoreBase{constructor(){super(),this.requiresSystemPermission=!1,this._supportsNativeEmergencyCalling=!1,f.RegisterStartupable(this,"E911Store",[S.default,m.default,C.default,g.default])}startup(){return o.default.supportsNativeEmergencyCalling().catch((()=>!1)).then((e=>{var t;if(this._supportsNativeEmergencyCalling=e,u.log(d.LogTraceArea.Phone,"E911Store: Native emergency calling capability checked, supports="+e),!e){let e,i=this._isLocationEnabled();if(l.default.subscribe((()=>{this.trigger();const e=this._isLocationEnabled();i!==e&&(i=e,e||this.resetLocation())})),this.requiresSystemPermission){let e=S.default.permissionStatus(b.PermissionType.Location)===h.PermissionStatus.Granted;s.isUndefined(C.default.isE911LocationConsentGranted())||C.default.setE911LocationConsentGranted(e),S.default.subscribe((()=>{if(!s.isUndefined(C.default.isE911LocationConsentGranted())){const t=S.default.permissionStatus(b.PermissionType.Location)===h.PermissionStatus.Granted;e!==t&&(C.default.setE911LocationConsentGranted(t),e=t,t||this.resetLocation())}}),b.PermissionType.Location)}else{let e=!!C.default.isE911LocationConsentGranted();C.default.subscribe((()=>{const t=!!C.default.isE911LocationConsentGranted();e!==t&&(e=t,t||this.resetLocation())}))}null===(t=n.default.getStack())||void 0===t||t.on("e911InfoChanged",(t=>{if((0,p.default)(e,t)){e=t;const i=l.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;this._canShareLocation()&&i.locationUpdateEventEnabled&&this.updateLocation(d.LocationUpdateReason.E911NetworkChange)}})),this._canShareLocation()&&this.updateLocationWithPermission(d.LocationUpdateReason.E911Startup)}}))}isEnabled(){return this._isEnabled()}_isEnabled(){if(this._supportsNativeEmergencyCalling)return!1;const e=l.default.getHeaders().CountryCode;if(!e)return!1;const t=l.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;return s.includes(t.enabledCountries,s.toLower(e))}isLocationEnabled(){return this._isLocationEnabled()}_isLocationEnabled(){const e=l.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;return this._isEnabled()&&e.locationEnabled}_canShareLocation(){return this._isLocationEnabled()&&!!C.default.isE911LocationConsentGranted()}shouldRequestAcknowledgementNoSubscription(){return!!this._isEnabled()&&(!m.default.isE911Acknowledged()||this._isLocationEnabled()&&s.isUndefined(C.default.isE911LocationConsentGranted()))}getEmergencyContentForNumberNoSubscription(e){const t=l.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;if(!s.includes(t.locationNumbers,e))return;if(!this._canShareLocation()||s.isUndefined(this._location))return;const i={pidf:this._location};return JSON.stringify(i)}requestLocationPermission(){return g.default.getLocationPermission(!0,b.PermissionType.Location)}updateLocation(e){if(!s.isUndefined(this._locationUpdatePromise))return u.log(d.LogTraceArea.Phone,"E911Store: Already updating location. Exit now."),this._locationUpdatePromise;u.log(d.LogTraceArea.Phone,"E911Store: Updating location. Reason: "+e);const t=l.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911.locationUpdateThrottlingMs,i=this._locationUpdateTimestamp?Date.now()-this._locationUpdateTimestamp:void 0;if(!s.isUndefined(this._location)&&!s.isUndefined(i)&&i<t)return u.log(d.LogTraceArea.Phone,"E911Store: Location has been updated recently. Exit now."),Promise.resolve(this._location);u.log(d.LogTraceArea.Phone,"E911Store: Resolving geo coordinates.");const a=g.default.updateLocation(e,!0).then((e=>{const t=null==e?void 0:e.coords;return s.isUndefined(t)?Promise.reject():(u.log(d.LogTraceArea.Phone,"E911Store: Geo coordinates resolved. Fetching location."),c.default.getBase64EncodedLocation(t.latitude,t.longitude,this._getCountryLocale()).toEs6Promise().then((e=>(this._location=e,this._locationUpdateTimestamp=Date.now(),u.track(new y.E911LocationUpdateEvent),u.log(d.LogTraceArea.Phone,"E911Store: Location is updated."),e))))})).catch((()=>(u.warn(d.LogTraceArea.Phone,"E911Store: Failed to update location: Couldn't resolve geo coordinates."),Promise.reject())));return this._locationUpdatePromise=a,a.finally((()=>{this._locationUpdatePromise=void 0})),a}updateLocationWithPermission(e){return this.requestLocationPermission().then((()=>this.updateLocation(e)))}resetLocation(){u.log(d.LogTraceArea.Phone,"E911Store: Resetting location."),this._location=void 0,this._locationUpdateTimestamp=void 0}_getCountryLocale(){const e=l.default.getHeaders().CountryCode;return s.toLower(e),"en-US"}};a.__decorate([r.autoSubscribe],_.prototype,"isEnabled",null),a.__decorate([r.autoSubscribe],_.prototype,"isLocationEnabled",null),_=a.__decorate([r.AutoSubscribeStore],_),t.E911Store=_,t.default=new _},454570:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InCallFeatureConsentStore=void 0;const a=i(570655),n=i(217041),o=i(148540),s=i(496486),r=i(974634),l=i(889391),c=i(994224),d=i(568580),u=i(598925),h=i(436237),p=i(746096),g=i(952262),C=i(805581);class S extends n.StoreBase{constructor(){super(...arguments),this._participantUpdateSubscription={},this._inCallFeatureStateMachine={},this._participantInCallFeatureRequest={},this._stateUpdatedEvent=new r.default,this.requestStartFeature=e=>{this._isFeatureConsentEnabled()&&this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.Start})},this.requestStopFeature=e=>{this._isFeatureConsentEnabled()&&this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.Stop})},this.requestProvideConsent=e=>{this._isFeatureConsentEnabled()&&(this._setLocalConsent(!0),this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.Start}))},this.requestRemoteConsent=e=>{this._isFeatureConsentEnabled()&&(this._setLocalConsent(!0),this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.RequestConsent}))},this.requestRejectConsent=e=>{this._isFeatureConsentEnabled()&&(this._setLocalConsent(!1),this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.RejectConsent}))},this.requestFeatureFailure=e=>{this._maybeGoToNextStateFromLocalUserAction(e,{action:u.InCallFeatureTransitionAction.Fail})},this._maybeGoToNextStateFromLocalUserAction=(e,t)=>{var i;this._maybeResetToInitialState(e);const a=null===(i=this._inCallFeatureStateMachine[e])||void 0===i?void 0:i.handleLocalUserAction(t);this._maybeTriggerNextState(e,a)},this._maybeGoToNextStateFromRemoteUserAction=(e,t)=>{var i;this._maybeResetToInitialState(e);var a=null===(i=this._inCallFeatureStateMachine[e])||void 0===i?void 0:i.handleRemoteUserAction(t);this._maybeTriggerNextState(e,a)},this._maybeTriggerNextState=(e,t)=>{t&&this._inCallFeatureStateMachine[e]!==t&&(t.onEnter(),this._inCallFeatureStateMachine[e]=t,t.shouldPublishToRoster()&&void 0!==t.getTransitionAction()&&this._updateRosterState(e,t),this._stateUpdatedEvent.fire(e),this.trigger(e))},this._maybeResetToInitialState=e=>{var t;(null===(t=this._inCallFeatureStateMachine[e])||void 0===t?void 0:t.isFinal())&&this._resetToInitialState(e)},this._clearState=e=>{this._inCallFeatureStateMachine[e]&&delete this._inCallFeatureStateMachine[e],this._participantInCallFeatureRequest[e]&&delete this._participantInCallFeatureRequest[e]},this._getRosterUpdateDelay=()=>l.default.getS4LCMCFeaturesNoSubscription().inCallFeatureConsentRosterDelayMs,this._processTransitionRequestUpdate=(e,t,i)=>{var a,n;const o=null===(n=null===(a=this._participantInCallFeatureRequest[e])||void 0===a?void 0:a[t])||void 0===n?void 0:n.action,s=i.action;this._logMessage(`Update from ROSTER: ${o?u.InCallFeatureTransitionAction[o]:"undefined"}->${u.InCallFeatureTransitionAction[s]}`),this._recordParticipantInCallTransitionRequest(e,t,i),this._maybeGoToNextStateFromRemoteUserAction(e,i)},this._participantChanged=(e,t)=>{t.state===o.ParticipantState.Connected&&!c.default.CallingStore.isCallOnHold(e)&&t.endpoints&&this._notSelfUpdate(e,t.id)&&t.endpoints.endpointDetails.forEach((i=>{const a=this._getInCallFeatureTransitionRequestFromRoster(e,i.endpointMetadata);a&&(this._isParticipantInCallFeatureStateUpdate(e,t.id,a)?(a.requestedBy=g.default.getShortDisplayName(t.id)||t.displayName,this._processTransitionRequestUpdate(e,t.id,a)):this._logMessage("Transition request not updated"))}))},this._notSelfUpdate=(e,t)=>c.default.CallingStore.getParticipantId(e)!==t,this._recordParticipantInCallTransitionRequest=(e,t,i)=>{this._participantInCallFeatureRequest[e]||(this._participantInCallFeatureRequest[e]={}),this._participantInCallFeatureRequest[e][t]=i},this._participantInCallFeatureStateExists=(e,t)=>{var i;return!!(null===(i=this._participantInCallFeatureRequest[e])||void 0===i?void 0:i[t])},this._isParticipantInCallFeatureStateUpdate=(e,t,i)=>{var a,n,o;if(!this._participantInCallFeatureStateExists(e,t))return this._logMessage("Participant state does not exist -> process update"),!0;const s=null===(a=this._participantInCallFeatureRequest[e])||void 0===a?void 0:a[t],r=null!==(n=i.requestVersion)&&void 0!==n?n:0,l=null!==(o=s.requestVersion)&&void 0!==o?o:0;return s&&r>l?(this._logMessage(`${this._getInCallFeatureName()} state update to ${u.InCallFeatureState[i.action]} as new state version is greater (${i.requestVersion} > ${s.requestVersion})`),!0):(this._logMessage(`Not processing ${u.InCallFeatureState[i.action]} transition as new state version is lower (${i.requestVersion} <= ${s.requestVersion})`),!1)},this._getConnectedParticipants=e=>{const t=C.default.getNonInteractiveInCallBotMris();return c.default.CallingStore.getRemoteCallMembers(e).filter((i=>{if(!d.default.isParticipantConnected(i))return!1;const a=c.default.CallingStore.getRemoteCallMemberMri(e,i);return!(!i.endpoints||t.includes(a))}))},this._logMessage=e=>{h.log(p.LogTraceArea.InCallBotService,`${this._getInCallFeatureName()} ${e}`)},this._isFeatureConsentEnabled=()=>l.default.getS4LCMCFeaturesNoSubscription().isInCallFeatureConsentEnabled}startTracking(e){this._isFeatureConsentEnabled()&&(this._resetToInitialState(e),this._participantUpdateSubscription[e]=c.default.CallingStore.participantUpdatedEvent().subscribe(this._participantChanged))}stopTracking(e){this._isFeatureConsentEnabled()&&(this._participantUpdateSubscription[e]&&(this._participantUpdateSubscription[e].unsubscribe(),delete this._participantUpdateSubscription[e]),this._clearState(e))}stateUpdatedEvent(){return this._stateUpdatedEvent}getInCallFeatureState(e){var t;if(!this._isFeatureConsentEnabled())return;const i=null===(t=this._inCallFeatureStateMachine[e])||void 0===t?void 0:t.getState();return i?(0,s.clone)(i):void 0}}a.__decorate([n.autoSubscribe,a.__param(0,n.key)],S.prototype,"getInCallFeatureState",null),t.InCallFeatureConsentStore=S},103933:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(217041),o=i(496486),s=i(994224),r=i(454570),l=i(928303),c=i(46929);function d(e,t){s.default.CallingStore.setInCallTranslationState(e,t)}let u=class extends r.InCallFeatureConsentStore{constructor(){super(...arguments),this._setLocalConsent=e=>{s.default.CallingStore.setHasInCallTranslationConsent(e)},this._getLocalConsent=()=>c.default.getCallTranslatorTranslationConsent(),this._isInCallFeatureSupported=e=>{let t=!0;return s.default.CallingStore.hasConnectedParticipants(e)?(0,o.each)(this._getConnectedParticipants(e),(i=>{s.default.CallingStore.getRemoteMemberSupportsInCallTranslation(e,i.id)||(t=!1)})):t=!1,t},this._didOtherUsersProvideConsent=e=>{let t=!0;return s.default.CallingStore.hasConnectedParticipants(e)?(0,o.each)(this._getConnectedParticipants(e),(i=>{s.default.CallingStore.getRemoteMemberHasInCallTranslationConsent(e,i.id)||(t=!1)})):t=!1,t},this._updateRosterState=(e,t)=>{(0,o.delay)(d,this._getRosterUpdateDelay(),e,t.getTransitionAction())},this._getInCallFeatureTransitionRequestFromRoster=(e,t)=>{var i;return null===(i=null==t?void 0:t.inCallTranslationState)||void 0===i?void 0:i[e]},this._resetToInitialState=e=>{this._inCallFeatureStateMachine[e]=new l.InCallFeatureDisabledState((()=>this._getLocalConsent()),(()=>this._didOtherUsersProvideConsent(e)),(()=>this._isInCallFeatureSupported(e)),e)},this._getInCallFeatureName=()=>"[InCallTranslation]"}};u=a.__decorate([n.AutoSubscribeStore],u),t.default=new u},121936:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TestableNdiConfigStore=void 0;const a=i(570655),n=i(516283),o=i(217041),s=i(562141),r=i(436237),l=i(998754),c=i(404057),d=i(853374);let u=class extends o.StoreBase{constructor(){super(),this._ndiConfig={isNdiEnabled:!1,watermarkLocation:"1,0"}}initialize(){const e=d.default.newCauseId(),t=l.default.getDataExclusive(s.InternalKeys.NdiConfig);if(r.log(n.LogTraceArea.Ndi,`NdiConfigStore.initialize. causeId: ${e}`),t){let e=!1;this._ndiConfig.isNdiEnabled===t.isNdiEnabled&&this._ndiConfig.watermarkLocation===t.watermarkLocation||(e=!0),this._ndiConfig.isNdiEnabled=t.isNdiEnabled,this._ndiConfig.watermarkLocation=t.watermarkLocation,e&&this.trigger()}r.log(n.LogTraceArea.Ndi,`Initial ndi config is ${JSON.stringify(this._ndiConfig)}`)}isNdiEnabled(){return this._ndiConfig.isNdiEnabled}setNdiEnabled(e){const t=d.default.newCauseId();this._ndiConfig.isNdiEnabled!==e?(r.log(n.LogTraceArea.Ndi,`updating isNdiEnabled to ${e}. causeId: ${t}`),this._ndiConfig.isNdiEnabled=e,this.trigger(),this._writeToUserConfig(t)):r.log(n.LogTraceArea.Ndi,`setNdiEnabled called with value same as current (${e}). causeId: ${t}`)}getWatermarkLocation(){return this._ndiConfig.watermarkLocation}setWatermarkLocation(e){const t=d.default.newCauseId();this._ndiConfig.watermarkLocation!==e?(r.log(n.LogTraceArea.Ndi,`updating watermarkLocation to ${e} causeId: ${t}`),this._ndiConfig.watermarkLocation=e,this.trigger(),this._writeToUserConfig(t)):r.log(n.LogTraceArea.Ndi,`setWatermarkLocation called with value same as current (${e}). causeId: ${t}`)}_writeToUserConfig(e){r.log(n.LogTraceArea.Ndi,`Writing ${JSON.stringify(this._ndiConfig)} to internalDataStore. causeId: ${e}`),l.default.putData(s.InternalKeys.NdiConfig,this._ndiConfig,void 0,e).catch((t=>r.warn(n.LogTraceArea.Ndi,`putData Failed. causeId: ${e} error: ${c.default.errorAsString(t)}`))).finally((()=>{r.log(n.LogTraceArea.Ndi,`Done writing. causeId: ${e}`)}))}};a.__decorate([o.autoSubscribe],u.prototype,"isNdiEnabled",null),a.__decorate([o.autoSubscribe],u.prototype,"getWatermarkLocation",null),u=a.__decorate([o.AutoSubscribeStore],u),t.TestableNdiConfigStore=u,t.default=new u},789871:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TriggerKeys=void 0;const a=i(570655),n=i(496486),o=i(217041),s=i(889391),r=i(481169),l=i(671830),c=i(211437),d=i(539549),u=i(651129),h=i(256955),p=i(746096),g=i(436237),C=i(518460),S=i(772136),m=i(527683),y=i(735426),f=i(912770),b=i(172758),_=i(110996),T=i(269399);var v;!function(e){e[e.InputValue=0]="InputValue",e[e.Emergency=1]="Emergency",e[e.E164=2]="E164",e[e.SelectedCountry=3]="SelectedCountry",e[e.Prefix=4]="Prefix",e[e.Callable=5]="Callable",e[e.SearchResults=6]="SearchResults"}(v=t.TriggerKeys||(t.TriggerKeys={}));let w=class extends o.StoreBase{constructor(){super(...arguments),this._phoneNumber={inputValue:"",E164:"",callable:!1,emergency:!1,forceChangedPrefix:!1,searchable:!0},this._searchResults={results:[],query:"",sessionId:""},this._searchCache=[],this._searchContacts={},this._searchInitialized=!1,this._searchCacheLoading=!1,this._lastCalledCountryCodes={},this._phoneNumberPrefixIndex={index:{},indexSize:0,maxLength:0}}getPhoneNumber(e){return this._phoneNumber}getSearchResults(){return this._searchResults}getSelectedCountry(){return this._selectedCountry}getDefaultCountry(){return this._defaultCountry}getAccessibilitySummary(){return{searchHasResults:!!this._searchResults.results.length&&!this._searchResults.selectedResult,selectedContactDisplayName:this._searchResults.selectedResult?this._searchResults.selectedResult.contact.displayName:void 0,selectedCountryName:this._selectedCountry?this._selectedCountry.countryName:void 0}}getLast5CalledCountriesNoSubscription(){return this._lastCalledCountryCodes}setSelectedCountry(e,t=!1){if(g.log(p.LogTraceArea.DialerStore,"setSelectedCountry("+JSON.stringify(e)+", "+t+")"),g.log(p.LogTraceArea.DialerStore,"selectedCountry state changed, from ["+JSON.stringify(this._selectedCountry)+"] to ["+JSON.stringify(e)+"]"),this._selectedCountry=e,this._setDefaultCountry(this._selectedCountry),t){let e="";this._selectedCountry&&(this._phoneNumber.suffix&&this._phoneNumber.E164?(g.log(p.LogTraceArea.DialerStore,"Preserving number input"),this._phoneNumber.suffix===this._phoneNumber.inputValue?(this._phoneNumber.prefix=n.toString(this._selectedCountry.countryCode),e=this._phoneNumber.suffix,this._recalculatePhoneNumberCountry(),this._recalculatePhoneNumberE164Format()):e=m.default.compilePhoneNumber(this._phoneNumber.suffix,this._selectedCountry.countryCode)):e="+"+this._selectedCountry.countryCode),this.overwritePhoneNumberInput(e,!!e)}this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped),this.trigger(v.SelectedCountry)}_preselectCountry(){const e=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch;if(!this._selectedCountry){const t=u.default.getDefaultPstnDestinationCountry();g.log(p.LogTraceArea.DialerStore,"_preselectCountry() Stored PSTN default country: "+JSON.stringify(t)),t&&this.setSelectedCountry(t,!e.T9SearchEnabled)}!e.T9SearchEnabled||this._searchResults&&this._searchResults.preselected||this.cleanupPhoneNumberInput()}cleanupPhoneNumberInput(e=!0){g.log(p.LogTraceArea.DialerStore,"cleanupPhoneNumberInput("+e+")"),this._setInputValue("",e),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped)}eraseCharFromPhoneNumberInput(e=!0){g.log(p.LogTraceArea.DialerStore,"eraseCharFromPhoneNumberInput("+e+")");const t=this._phoneNumber.inputValue.slice(-1),i=this._phoneNumber.inputValue.slice(0,-1);return this._setInputValue(i,e),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped),[t,i]}appendCharToPhoneNumberInput(e,t=!0){g.log(p.LogTraceArea.DialerStore,"appendCharToPhoneNumberInput(*, "+t+")"),e=u.default.filterPhoneNumberChar(this._phoneNumber.inputValue,e),this._setInputValue(this._phoneNumber.inputValue?this._phoneNumber.inputValue+e:e,t),this.setPhoneNumberOrigin(p.NavigationCallOrigin.PstnDialpadTyped)}overwritePhoneNumberInput(e,t=!0,i=p.NavigationCallOrigin.PstnDialpadTyped){g.log(p.LogTraceArea.DialerStore,"overwritePhoneNumberInput(*, "+t+")"),this._setInputValue(e,t),this.setPhoneNumberOrigin(i)}selectSearchResultItem(e){const t=this._searchResults.results[e];this.overwritePhoneNumberInput(t.phone.number,!1,p.NavigationCallOrigin.PstnDialpadSearchResult),this._resetSearchResults(),this._searchResults.results=[t],this._searchResults.exactMatch=t,this._searchResults.selectedResult=t,this.trigger(v.SearchResults)}initializeSearch(){this._searchInitialized||this._searchCacheLoading||(this._searchCacheLoading=!0,this._searchCachePromise=c.default.getSortedUsersByPhoneNumberAsync("+").then((e=>{this._searchCache=[],n.each(e,(e=>{this._searchContacts[e.getUniqueId()]={displayName:e.getDisplayName(),uniqueId:e.getUniqueId(),userMri:e.getMri()},n.each(e.phones,((t,i)=>{this._searchCache.push({contact:this._searchContacts[e.getUniqueId()],phone:t,t9SearchHash:u.default.mapKeypadLettersToNumbers(e.getDisplayName())})}))})),this._searchCache=h.DialerSearchUtils.sortByDisplayName(this._searchCache),g.log(p.LogTraceArea.DialerStore,"Contact search: [init], Contacts cache: ["+n.size(this._searchContacts)+"], Search cache: ["+n.size(this._searchCache)+"]"),this._localAddressBookSubToken||(this._localAddressBookSubToken=C.default.subscribe((()=>this._updateSearchCache()))),this._updateSearchCache(),this._searchInitialized=!0})).finally((()=>{this._searchCachePromise=void 0,this._searchCacheLoading=!1})))}_updateSearchCache(){const e=C.default.getFilteredSortedAddressBookContacts("",!0,!1);n.each(e,(e=>{this._searchContacts[e.getUniqueId()]={displayName:e.getDisplayName(),uniqueId:e.getUniqueId(),userMri:""},n.remove(this._searchCache,(t=>t.contact.uniqueId===this._searchContacts[e.getUniqueId()].uniqueId)),n.each(e.phones,((t,i)=>{this._searchCache.push({contact:this._searchContacts[e.getUniqueId()],phone:t,t9SearchHash:u.default.mapKeypadLettersToNumbers(e.getDisplayName())})}))})),g.log(p.LogTraceArea.DialerStore,"Contact search: [update], AB contacts: ["+e.length+"] Contacts cache: ["+n.size(this._searchContacts)+"], Search cache: ["+n.size(this._searchCache)+"]"),this._searchCache=h.DialerSearchUtils.sortByDisplayName(this._searchCache)}_scheduleSearch(e){if(this._cancelOngoingSearch(),!this._phoneNumber.searchable)return;this.initializeSearch();const t=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch;this._phoneNumberHandlingPromise=f.default.sleep(t.ExecutionDelay).then((()=>{this._resetSearchResults();const i={resultsName:[],resultsNumber:[]};n.isEmpty(this._searchResults.query)||(n.each(this._searchCache,(e=>{if(t.T9SearchEnabled){let t=e.phone.number.indexOf(this._searchResults.query);-1!==t&&(e.matchedString=this._searchResults.query,i.resultsNumber.push(e)),t=e.t9SearchHash.indexOf(this._searchResults.query),-1!==t&&(e.matchedString=e.contact.displayName.substring(t,this._searchResults.query.length+t),i.resultsName.push(e))}else n.startsWith(e.phone.number,this._searchResults.query)&&(e.matchedString=this._searchResults.query,i.resultsNumber.push(e));e.phone.number===this._searchResults.query&&(this._searchResults.exactMatch=e)})),this._searchResults.results=i.resultsName.concat(i.resultsNumber),this._searchResults.sessionId=e,(0,_.searchResultsReceived)(T.ScenarioSearchTypes.FastContacts,e,this._isZeroTermSearch()))})).always((()=>{g.log(p.LogTraceArea.DialerStore,"Contact search: [results], Partial match: ["+this._searchResults.results.length+"] Exact match: ["+!!this._searchResults.exactMatch+"]"),this._phoneNumberHandlingPromise=void 0,this.trigger(v.SearchResults)}))}_isZeroTermSearch(){return 0===this._phoneNumber.inputValue.length}_cancelOngoingSearch(){if(this._phoneNumberHandlingPromise){const e=this._phoneNumberHandlingPromise;this._phoneNumberHandlingPromise=void 0,e.cancel()}}_resetSearchResults(){const e=s.default.getS4LEntitlementFeatures().SCE.Dialpad.ContactsSearch.T9SearchEnabled;this._searchResults.query=h.DialerSearchUtils.getSearchCriteria(this._phoneNumber,e),this._searchResults.results=[],this._searchResults.exactMatch=void 0,this._searchResults.selectedResult=void 0,this._searchResults.preselected=void 0}destroySearch(){if(this._cancelOngoingSearch(),this._searchInitialized&&(this._searchCache=[],this._searchContacts={},this._searchInitialized=!1,this._searchCachePromise)){const e=this._searchCachePromise;this._searchCacheLoading=!1,this._searchCachePromise=void 0,e.cancel()}this._localAddressBookSubToken&&(C.default.unsubscribe(this._localAddressBookSubToken),this._localAddressBookSubToken=void 0),this._resetSearchResults(),this.trigger(v.SearchResults),g.log(p.LogTraceArea.DialerStore,"Contact search: [destroy]")}initializeCountrySelection(){g.log(p.LogTraceArea.DialerStore,"CountrySelection: [init]");const e=n.sortBy(n.filter((0,d.default)().getAllConversationsInMemory(),(e=>e.isCurrentUserMember()&&!!e.lastCallTime&&l.isPhoneMri(e.id))),(e=>-1*(e.lastCallTime||0))),t=(0,r.chain)(e,(0,r.map)((e=>this._getRegionCodeForConversation(e))),(0,r.uniq)(),(0,r.compact)());this._lastCalledCountryCodes=(0,r.chain)(t,(0,r.take)(5),(0,r.map)((e=>["recent_"+e,S.default.getCountryByCode(e)])),(0,r.fromPairs)()),this._preselectCountry()}destroyCountrySelection(){this._lastCalledCountryCodes={},this._selectedCountry=void 0,this._defaultCountry=void 0,g.log(p.LogTraceArea.DialerStore,"CountrySelection: [destroy]")}resetPhoneNumber(){this._phoneNumber={inputValue:"",E164:"",callable:!1,emergency:!1,forceChangedPrefix:!1,searchable:!0},g.log(p.LogTraceArea.DialerStore,"PhoneNumber: [destroy]")}_setInputValue(e,t=!0){const i=n.uniqueId("Query");if((0,_.willSearch)(T.ScenarioSearchTypes.FastContacts,i),g.log(p.LogTraceArea.DialerStore,"_setInputValue(): [before] "+u.default.phoneNumberToString(this._phoneNumber)),this._phoneNumber.searchable=t,this._phoneNumber.inputValue===e)return;let a=this._processPhoneNumber(e);0!==a.length&&(a=n.uniq(a.concat(this._identifyEmergencyNumber())),this._identifyCallableNumber()&&a.push(v.Callable),g.log(p.LogTraceArea.DialerStore,"_setInputValue(): TriggerEvents",a),this.trigger(a),(0,_.searchCallSent)(T.ScenarioSearchTypes.FastContacts,i,this._isZeroTermSearch()),this._scheduleSearch(i),g.log(p.LogTraceArea.DialerStore,"_setInputValue(): [after] "+u.default.phoneNumberToString(this._phoneNumber)))}_processPhoneNumber(e){const t=[];e=u.default.normalizePhoneNumber(e);const i=m.default.stripPossibleExtension(e);return this._recalculatePhoneNumberPrefix(i)&&(t.push(v.Prefix),this._recalculatePhoneNumberCountry()),this._phoneNumber.suffix=u.default.getPhoneNumberSuffix(i,this._phoneNumber.prefix),this._phoneNumber.extension=m.default.getPossibleExtension(e,!0),u.default.isE164Format(i)&&(e=u.default.getFormattedPhoneNumber(e,this._phoneNumber.prefix)),this._phoneNumber.inputValue!==e&&(this._phoneNumber.inputValue=e,t.unshift(v.InputValue),this._recalculatePhoneNumberE164Format()&&t.push(v.E164)),t}_identifyEmergencyNumber(){let e=[],t=!1;if(u.default.isEmergencyNumber(this._phoneNumber)){t=!0;const i=u.default.getEmergencyCallingCountrySubstitute(this._phoneNumber.countryCode);if(i&&!u.default.isE164Format(this._phoneNumber.inputValue)){const t=u.default.getE164FormattedPhoneNumber(n.toString(i.countryCode),this._phoneNumber.suffix);e=this._processPhoneNumber(t),this._phoneNumber.forceChangedPrefix=!0}else this._phoneNumber.forceChangedPrefix=!1}return this._phoneNumber.emergency!==t&&(this._phoneNumber.emergency=t,e.push(v.Emergency),t&&g.track(new y.EmergencyNumber)),e}_identifyCallableNumber(){const e=u.default.isCallableNumber(this._phoneNumber);return this._phoneNumber.callable!==e&&(this._phoneNumber.callable=e,!0)}_recalculatePhoneNumberPrefix(e){if(this._phoneNumber.prefix&&1===e.indexOf(this._phoneNumber.prefix))return!1;let t;if(0!==e.indexOf("+")&&e.length>0){const e=this._selectedCountry||this._defaultCountry;e&&(t=n.toString(e.countryCode))}else t=u.default.getPhoneNumberPrefix(e,this._getPhoneNumberPrefixIndex());return this._phoneNumber.prefix!==t&&(this._phoneNumber.prefix=t,!0)}_recalculatePhoneNumberCountry(){const e=u.default.getPhoneNumberPrefixCountry(this._phoneNumber.prefix,this._getPhoneNumberPrefixIndex());e?this._phoneNumber.countryCode!==e.country&&(this._phoneNumber.countryCode=e.country,this._selectedCountry&&n.toString(this._selectedCountry.countryCode)===this._phoneNumber.prefix||this.setSelectedCountry(e)):this._selectedCountry&&(this._phoneNumber.countryCode=void 0,this.setSelectedCountry(void 0))}_recalculatePhoneNumberE164Format(){const e=u.default.getE164FormattedPhoneNumber(this._phoneNumber.prefix,this._phoneNumber.suffix);return this._phoneNumber.E164!==e&&(this._phoneNumber.E164=e,!0)}_setDefaultCountry(e){!e||this._defaultCountry&&this._defaultCountry.country===e.country||(void 0!==this._defaultCountry&&u.default.setDefaultPstnDestinationCountryCode(e.country),g.log(p.LogTraceArea.DialerStore,"Default country state changed, from ["+JSON.stringify(this._defaultCountry)+"] to ["+JSON.stringify(e)+"]"),this._defaultCountry=e)}_getRegionCodeForConversation(e){const t=l.stripMriNamespace(e.id);if(u.default.containsNonGeographicOrTestPrefixes(t))return;const i=m.default.parseAndKeepRawInput(t),a=m.default.getRegionCodeForNumber(i);return a?a.toLowerCase():void 0}_getPhoneNumberPrefixIndex(){return this._phoneNumberPrefixIndex.indexSize<=0&&(this._phoneNumberPrefixIndex=u.default.getCountryDestinationPrefixIndex(S.default.getCountries()),g.log(p.LogTraceArea.DialerStore,"PhoneNumberPrefixIndex init, indexSize:",this._phoneNumberPrefixIndex.indexSize)),this._phoneNumberPrefixIndex}setPhoneNumberOrigin(e){this._phoneNumberOrigin=e}resetPhoneNumberOrigin(){this._phoneNumberOrigin=void 0}getPhoneNumberOrigin(){return this._phoneNumberOrigin}preselectSavedContact(e){const t=b.default.getFullUserProfileByMriNoSubscription(e);if(t&&t.phones){this._resetSearchResults(),this._searchInitialized=!1;const e={contact:{displayName:t.getDisplayName(),uniqueId:t.getUniqueId(),userMri:t.getMri()},phone:t.phones[0]};this.overwritePhoneNumberInput(e.phone.number,!1,p.NavigationCallOrigin.PstnDialpadSaveContact),this._searchResults.results=[e],this._searchResults.exactMatch=e,this._searchResults.selectedResult=e,this._searchResults.preselected=!0,this.trigger(v.SearchResults)}}};a.__decorate([o.autoSubscribe,a.__param(0,o.key)],w.prototype,"getPhoneNumber",null),a.__decorate([(0,o.autoSubscribeWithKey)(v.SearchResults)],w.prototype,"getSearchResults",null),a.__decorate([(0,o.autoSubscribeWithKey)(v.SelectedCountry)],w.prototype,"getSelectedCountry",null),a.__decorate([(0,o.autoSubscribeWithKey)(v.SelectedCountry)],w.prototype,"getDefaultCountry",null),a.__decorate([(0,o.autoSubscribeWithKey)([v.SelectedCountry,v.SearchResults])],w.prototype,"getAccessibilitySummary",null),w=a.__decorate([o.AutoSubscribeStore],w),t.default=new w},772136:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(496486),o=i(516778),s=i(217041),r=i(397691),l=i(481169),c=i(562141),d=i(172685),u=i(998754),h=i(472731),p=i(733754),g=i(178735),C=i(99075),S=i(422538),m=i(404057),y=i(815899);let f=class extends s.StoreBase{constructor(){super(),this._handleMemoryWarningEvent=()=>{this._countries={}},this._updateData=(e,t)=>{this._countries=(0,l.chain)(e,(0,l.uniqBy)((e=>e.MSShort)),(0,l.map)((e=>{const t=Number(e.TAPICode);if(!isNaN(t))return{country:n.toLower(e.MSShort),countryName:e.CountryRegionName,countryCode:t}})),(0,l.compact)(),(0,l.keyBy)((e=>e.country)));const i={countries:this._countries,language:t};u.default.putData(c.InternalKeys.PhoneCountryCache,i),this._locale=t,this.trigger()},p.localeChangedEvent.subscribe((e=>{S.HasStarted(this)&&e!==this._locale&&this._requestCountryConfig(e)})),S.RegisterStartupable(this,"PhoneCountryStore",[d.default,u.default,g.default])}startup(){return this._countries={},this._locale=p.getLocale(),o.App.memoryWarningEvent.subscribe(this._handleMemoryWarningEvent),d.default.setRefreshOptions(c.InternalKeys.PhoneCountryCache,{interval:6048e5,taskTypeFlags:d.TaskTypeFlags.UsesNetworking,callback:()=>this._requestCountryConfig(p.getLocale())}),r.Resolved()}getCountries(){return this._getCountries()}getCountriesKeyedByPhoneCodeFromBackupNoSubscription(){return(0,l.chain)(y,(0,l.uniqBy)((e=>e.MSShort)),(0,l.map)((e=>{const t=Number(e.TAPICode);if(!isNaN(t))return{country:n.toLower(e.MSShort),countryName:e.CountryRegionName,countryCode:t}})),(0,l.compact)(),(0,l.keyBy)((e=>e.countryCode)))}getCountryByCode(e){return this._getCountries()[e]}_getCountries(){if(n.isEmpty(this._countries)){const e=u.default.getData(c.InternalKeys.PhoneCountryCache);this._countries=e&&e.countries||{},n.isEmpty(this._countries)?(this._loadDataFromBackupFile(),S.EnsureStarted(this).then((()=>{d.default.fireEarly(c.InternalKeys.PhoneCountryCache)}))):e&&e.language!==p.getLocale()&&S.EnsureStarted(this).then((()=>{d.default.fireEarly(c.InternalKeys.PhoneCountryCache)}))}return this._countries}_requestCountryConfig(e,t=!0){return C.default.getConfig(e).then((t=>this._updateData(t,e))).catch((i=>{if(404===i.statusCode&&t){const t=this._getFallbackLocale(e);if(t!==e)return void this._requestCountryConfig(t,!1)}n.isEmpty(this._countries)&&this._loadDataFromBackupFile()}))}_loadDataFromBackupFile(){this._updateData(y,"en-US")}_getFallbackLocale(e){const t=e&&e.split("-")[0],i=h.getDefaultLocale(t);return`${t}-${m.default.toUpper(i)}`}};a.__decorate([s.autoSubscribe],f.prototype,"getCountries",null),a.__decorate([s.autoSubscribe,a.__param(0,s.key)],f.prototype,"getCountryByCode",null),f=a.__decorate([s.AutoSubscribeStore],f),t.default=new f},157876:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(217041),o=i(397691),s=i(671830),r=i(211437);let l=class extends n.StoreBase{constructor(){super(...arguments),this._phoneNumberUserMri={}}_startedTrackingKey(e){const t=r.default.getUserByPhoneNumberExactMatch(e);this._phoneNumberUserMri[e]=t?t.getMri():void 0,this._updateUserMriByPhoneNumber(e)}getConversationMri(e){return this._phoneNumberUserMri[e]}getConversationMriAsync(e){const t=s.getPhoneNumberFromMri(e);return t?this._updateUserMriByPhoneNumber(t).then((()=>this._phoneNumberUserMri[t]||e)):o.Resolved(e)}_updateUserMriByPhoneNumber(e){return r.default.getUserByPhoneNumberExactMatchAsync(e).then((t=>{this._phoneNumberUserMri[e]=t?t.getMri():void 0,this.trigger(e)}))}};a.__decorate([n.disableWarnings],l.prototype,"_startedTrackingKey",null),a.__decorate([n.autoSubscribe,a.__param(0,n.key)],l.prototype,"getConversationMri",null),l=a.__decorate([n.AutoSubscribeStore],l),t.default=new l},322418:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(570655),n=i(217041),o=i(496486),s=i(994224),r=i(454570),l=i(928303),c=i(46929);function d(e,t){s.default.CallingStore.setTruVoiceTranslationState(e,t)}let u=class extends r.InCallFeatureConsentStore{constructor(){super(...arguments),this._setLocalConsent=e=>{s.default.CallingStore.setHasTruVoiceTranslationConsent(e)},this._getLocalConsent=()=>c.default.getCallTranslatorTruVoiceConsent(),this._isInCallFeatureSupported=e=>{let t=!0;return s.default.CallingStore.hasConnectedParticipants(e)?(0,o.each)(this._getConnectedParticipants(e),(i=>{s.default.CallingStore.getRemoteMemberSupportsTruVoiceTranslation(e,i.id)||(t=!1)})):t=!1,t},this._didOtherUsersProvideConsent=e=>{let t=!0;return s.default.CallingStore.hasConnectedParticipants(e)?(0,o.each)(this._getConnectedParticipants(e),(i=>{s.default.CallingStore.getRemoteMemberHasTruVoiceTranslationConsent(e,i.id)||(t=!1)})):t=!1,t},this._updateRosterState=(e,t)=>{(0,o.delay)(d,this._getRosterUpdateDelay(),e,t.getTransitionAction())},this._getInCallFeatureTransitionRequestFromRoster=(e,t)=>{var i;return null===(i=null==t?void 0:t.truVoiceTranslationState)||void 0===i?void 0:i[e]},this._resetToInitialState=e=>{this._inCallFeatureStateMachine[e]=new l.InCallFeatureDisabledState((()=>this._getLocalConsent()),(()=>this._didOtherUsersProvideConsent(e)),(()=>this._isInCallFeatureSupported(e)),e)},this._getInCallFeatureName=()=>"[TruVoiceTranslation]"}};u=a.__decorate([n.AutoSubscribeStore],u),t.default=new u},368036:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalVideoState=void 0;const a=i(570655),n=i(217041),o=i(746096),s=i(436237),r=i(404057);let l=class extends n.StoreBase{constructor(e){super(),this._call=e,this._enabled=!1,this._overrides=[],this._updateVideoPromise=Promise.resolve(!1),this._updateVideo=e=>{const t=this._isLocalVideoActivated();return t===e?e:t?this._call.startVideo().then((()=>!0),(t=>(s.error(o.LogTraceArea.Calling,`Failed to start local video. ${r.default.errorAsString(t,!0)}`),e))):this._call.stopVideo().then((()=>!1),(t=>(s.error(o.LogTraceArea.Calling,`Failed to stop local video. ${r.default.errorAsString(t,!0)}`),e)))}}setLocalVideoEnabled(e){this._enabled!==e&&(this._enabled=e,this._trigger())}isLocalVideoEnabled(){return this._enabled}setLocalVideoOverride(e){this._overrides.includes(e)||(this._overrides.push(e),this._trigger())}clearLocalVideoOverride(e){const t=this._overrides.indexOf(e);t>=0&&(this._overrides.splice(t,1),this._trigger())}_isLocalVideoActivated(){return this._enabled&&0===this._overrides.length}isLocalVideoActivated(){return this._isLocalVideoActivated()}_trigger(){this._updateVideoPromise=this._updateVideoPromise.then(this._updateVideo),this.trigger()}};a.__decorate([n.autoSubscribe],l.prototype,"isLocalVideoActivated",null),l=a.__decorate([n.AutoSubscribeStore],l),t.LocalVideoState=l},686310:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteStreamStarter=void 0;const a=i(746096),n=i(436237);class o{constructor(e){this._singleRendererPerStream=e,this._startedStreams=new Map,this._maximumVideoCount=0,this._pendingAcquires=[]}setMaximumVideoCount(e){this._maximumVideoCount=e,this._processAcquires()}_releaseSlot(e){let t=this._startedStreams.get(e);t&&(--t,n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] release slot { stream: ${e.id}, remainingAcquires: ${t} }`),t?this._startedStreams.set(e,t):(this._startedStreams.delete(e),this._processAcquires()))}_acquireSlot(e,t){const i=new Promise(((i,a)=>{this._pendingAcquires.push({stream:e,resolve:i,reject:a,startId:t})})),a=this._pendingAcquires[this._pendingAcquires.length-1];return this._processAcquires(),Object.assign(i,{cancel:()=>{const e=this._pendingAcquires.indexOf(a);e>=0&&(this._pendingAcquires.splice(e,1),a.reject())}})}_processAcquires(){for(let e=0;e<this._pendingAcquires.length;){const{stream:t,resolve:i,startId:o}=this._pendingAcquires[e];!(!this._maximumVideoCount||this._startedStreams.size<this._maximumVideoCount||this._startedStreams.has(t))||this._singleRendererPerStream&&this._startedStreams.has(t)?++e:(this._pendingAcquires.splice(e,1),this._startedStreams.set(t,(this._startedStreams.get(t)||0)+1),n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] slot acquired { stream: ${t.id}, startId: ${o} }`),i())}}startStream(e,t,i,s){const r=o._nextStartId++;n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] acquire slot { startId: ${r}, stream: ${t.id}, participant: ${t.participantId}, endpoint: ${t.endpointId} }`),e("Acquiring video slot...");const l=this._acquireSlot(t,r),c=l.then((()=>{n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] start stream { startId: ${r} }`),e("Starting stream...");const o=t.start(i,s);return o.catch((e=>{n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] start stream failed { startId: ${r}, reason: ${e} }`),this._releaseSlot(t)})),o.then((e=>{n.log(a.LogTraceArea.Calling,`[RemoteStreamStarter] start stream succeeded { startId: ${r} }`);const i=this,{dispose:o}=e;return e.dispose=function(){this.dispose=o,o.apply(this,arguments),i._releaseSlot(t)},e}))}));return Object.assign(c,{cancel:()=>l.cancel()})}}o._nextStartId=0,t.RemoteStreamStarter=o},485876:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VideoOverrides=void 0;const a=i(570655),n=i(217041);let o=class extends n.StoreBase{constructor(){super(...arguments),this._remoteStreamOverrides=[]}setRemoteStreamOverride(e){return!this._remoteStreamOverrides.includes(e)&&(this._remoteStreamOverrides.push(e),this.trigger(e),!0)}clearRemoteStreamOverride(e){const t=this._remoteStreamOverrides.indexOf(e);return!(t<0)&&(this._remoteStreamOverrides.splice(t,1),this.trigger(e),!0)}hasAnyRemoteStreamOverride(e=[]){return this._remoteStreamOverrides.some((t=>!e.includes(t)))}hasSpecificRemoteStreamOverride(e){return this._remoteStreamOverrides.includes(e)}};a.__decorate([n.autoSubscribe],o.prototype,"hasAnyRemoteStreamOverride",null),a.__decorate([n.autoSubscribe,a.__param(0,n.key)],o.prototype,"hasSpecificRemoteStreamOverride",null),o=a.__decorate([n.AutoSubscribeStore],o),t.VideoOverrides=o},775352:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MicrophoneSettingsOrigin=t.SettingsMode=void 0,function(e){e[e.All=0]="All",e[e.Audio=1]="Audio",e[e.Video=2]="Video"}(t.SettingsMode||(t.SettingsMode={})),function(e){e[e.AVSettings=0]="AVSettings",e[e.InCallPopup=1]="InCallPopup"}(t.MicrophoneSettingsOrigin||(t.MicrophoneSettingsOrigin={}))},976059:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TransferStatus=t.CallDirection=t.CallType=t.CallState=t.CallSessionType=t.ParticipantType=void 0,function(e){e.Default="default",e.Voicemail="voicemail"}(t.ParticipantType||(t.ParticipantType={})),function(e){e.Default="default",e.ScreenSharing="screenSharing"}(t.CallSessionType||(t.CallSessionType={})),function(e){e.Failed="failed",e.Missed="missed",e.Accepted="accepted",e.Declined="declined",e.AcceptedElsewhere="acceptedElsewhere"}(t.CallState||(t.CallState={})),function(e){e.TwoParty="twoParty",e.MultiParty="multiParty"}(t.CallType||(t.CallType={})),function(e){e.Incoming="incoming",e.Outgoing="outgoing"}(t.CallDirection||(t.CallDirection={})),function(e){e.Transferred="transferred",e.TransferAccepted="transferAccepted",e.TransferFailed="transferFailed",e.TransferSucceeded="transferSucceeded"}(t.TransferStatus||(t.TransferStatus={}))},598925:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSharingPrefix=t.EcoMode=t.SlimcoreSetupKeys=t.KeyDistributionUrlType=t.UdpTransportUrlType=t.ConversationServiceUrlType=t.InCallFeatureTransitionAction=t.InCallFeatureState=t.TranslationState=t.StartCallOrMaybePromptUserIntent=t.UnansweredCallVisualInfoType=t.UnansweredCallVisualInfo=t.UnansweredCallAction=t.UnansweredCallReason=t.CallingError=t.CallValidationFailureReason=t.CallAction=t.LocalCallActions=t.VideoOverrideReason=t.CallDeviceQualityEventType=t.CallDeviceState=t.CallNetworkQualityEventType=t.NetworkConnectionState=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.LostConnection=1]="LostConnection",e[e.Connecting=2]="Connecting",e[e.Connected=3]="Connected"}(t.NetworkConnectionState||(t.NetworkConnectionState={})),function(e){e[e.Unknown=0]="Unknown",e[e.NetworkReconnection=1]="NetworkReconnection",e[e.NetworkReceiveQuality=2]="NetworkReceiveQuality",e[e.NetworkReceiveCatastrophic=3]="NetworkReceiveCatastrophic",e[e.NetworkSendCatastrophic=4]="NetworkSendCatastrophic"}(t.CallNetworkQualityEventType||(t.CallNetworkQualityEventType={})),function(e){e[e.Working=0]="Working",e[e.NotWorking=1]="NotWorking"}(t.CallDeviceState||(t.CallDeviceState={})),function(e){e[e.None=0]="None",e[e.AudioStoppedWorking=1]="AudioStoppedWorking",e[e.AudioDeviceBusy=2]="AudioDeviceBusy",e[e.AudioDeviceMuted=3]="AudioDeviceMuted",e[e.MicrophoneStoppedWorking=4]="MicrophoneStoppedWorking",e[e.SpeakerStoppedWorking=5]="SpeakerStoppedWorking",e[e.VideoStoppedWorking=6]="VideoStoppedWorking",e[e.VideoTimedOut=7]="VideoTimedOut",e[e.VideoCameraBusy=8]="VideoCameraBusy",e[e.VideoSystemOutOfMemory=9]="VideoSystemOutOfMemory",e[e.DeviceCausingEcho=10]="DeviceCausingEcho",e[e.MicrophoneNotMuteButSilent=11]="MicrophoneNotMuteButSilent",e[e.DeviceRenderGlitches=12]="DeviceRenderGlitches",e[e.DeviceLowSNR=13]="DeviceLowSNR",e[e.DeviceClipping=14]="DeviceClipping",e[e.DeviceEcho=15]="DeviceEcho",e[e.DeviceMultipleEndpoints=16]="DeviceMultipleEndpoints",e[e.DeviceRenderZeroVolume=17]="DeviceRenderZeroVolume",e[e.CpuInsufficient=18]="CpuInsufficient",e[e.ZeroCaptureDevicesEnumerated=19]="ZeroCaptureDevicesEnumerated",e[e.ZeroRenderDevicesEnumerated=20]="ZeroRenderDevicesEnumerated",e[e.VideoCaptureDeviceFreeze=21]="VideoCaptureDeviceFreeze",e[e.AudioCapturePermissionDenied=22]="AudioCapturePermissionDenied",e[e.VideoCapturePermissionDenied=23]="VideoCapturePermissionDenied",e[e.VideoCaptureFreezeRecovered=24]="VideoCaptureFreezeRecovered",e[e.DeviceRenderHowling=25]="DeviceRenderHowling",e[e.PresentationAudioLoopbackDeviceState=26]="PresentationAudioLoopbackDeviceState",e[e.RemoteNetworkConnectivityIssue=27]="RemoteNetworkConnectivityIssue",e[e.AudioCaptureUltrasoundDetected=28]="AudioCaptureUltrasoundDetected",e[e.MusicModeNotAvailable=29]="MusicModeNotAvailable",e[e.CameraLighting=30]="CameraLighting",e[e.AudioCaptureMusicDetectedWithHighNS=31]="AudioCaptureMusicDetectedWithHighNS",e[e.AudioCaptureMusicDetectedWithHighNSNotAvailable=32]="AudioCaptureMusicDetectedWithHighNSNotAvailable",e[e.AudioCaptureMusicDetectedWithLowNS=33]="AudioCaptureMusicDetectedWithLowNS"}(t.CallDeviceQualityEventType||(t.CallDeviceQualityEventType={})),function(e){e[e.Logout=0]="Logout",e[e.InBackground=1]="InBackground",e[e.AudioOnlyMode=2]="AudioOnlyMode",e[e.IncomingVideoDisabled=3]="IncomingVideoDisabled",e[e.FullScreenBot=4]="FullScreenBot"}(t.VideoOverrideReason||(t.VideoOverrideReason={})),function(e){e[e.None=0]="None",e[e.Initialized=1]="Initialized",e[e.StartedWithRing=2]="StartedWithRing",e[e.StartedGoLive=4]="StartedGoLive",e[e.Joined=8]="Joined",e[e.Answered=16]="Answered",e[e.Rejected=32]="Rejected",e[e.Ended=64]="Ended"}(t.LocalCallActions||(t.LocalCallActions={})),function(e){e.Initialize="initialize",e.Start="start",e.Join="join",e.Answer="answer",e.AnswerOrJoin="answerOrJoin",e.Merge="merge",e.Reject="reject",e.End="end"}(t.CallAction||(t.CallAction={})),function(e){e[e.None=0]="None",e[e.InvalidLiveState=1]="InvalidLiveState",e[e.InvalidParameters=2]="InvalidParameters",e[e.PlatformNotSupported=3]="PlatformNotSupported",e[e.CalleeIsBlocked=4]="CalleeIsBlocked",e[e.CallingNotAllowed=5]="CallingNotAllowed",e[e.CallNotFound=6]="CallNotFound",e[e.ConversationNotFound=7]="ConversationNotFound",e[e.NoCameraPermission=8]="NoCameraPermission",e[e.NoMicPermission=9]="NoMicPermission",e[e.NoMicDetected=10]="NoMicDetected",e[e.OtherCallsOngoing=11]="OtherCallsOngoing",e[e.GogoNetwork=12]="GogoNetwork",e[e.CalleeDoesNotSupportCalling=13]="CalleeDoesNotSupportCalling",e[e.GroupTooLarge=14]="GroupTooLarge",e[e.OnePersonGroup=15]="OnePersonGroup",e[e.E2eeHandshakeIncomplete=16]="E2eeHandshakeIncomplete",e[e.RegularMemberInModeratedGroup=17]="RegularMemberInModeratedGroup",e[e.NoReadPhoneStatePermission=18]="NoReadPhoneStatePermission",e[e.RegisterActiveCallFailure=19]="RegisterActiveCallFailure"}(t.CallValidationFailureReason||(t.CallValidationFailureReason={}));class i extends Error{constructor(e,t,i,a,n,o,s){super(i),this.callId=e,this.action=t,this.message=i,this.terminatedReason=a,this.failureType=n,this.validationReason=o,this.causeId=s}}t.CallingError=i,function(e){e[e.None=0]="None",e[e.PstnNumberUnavailable=1]="PstnNumberUnavailable",e[e.PstnCallTerminated=2]="PstnCallTerminated",e[e.PstnNumberForbidden=3]="PstnNumberForbidden",e[e.PstnBlockedByUs=4]="PstnBlockedByUs",e[e.PstnCouldNotConnectToSkypeProxy=5]="PstnCouldNotConnectToSkypeProxy",e[e.PstnSkypeoutAccountBlocked=6]="PstnSkypeoutAccountBlocked",e[e.NoAnswer=7]="NoAnswer",e[e.Decline=8]="Decline",e[e.DeclineParticipant=9]="DeclineParticipant",e[e.Unreachable=10]="Unreachable",e[e.LocalNetworkError=11]="LocalNetworkError",e[e.NoMicrophoneDetected=12]="NoMicrophoneDetected",e[e.MicrophonePermissionDenied=13]="MicrophonePermissionDenied",e[e.CameraPermissionDenied=14]="CameraPermissionDenied",e[e.MicAndCamPermissionDenied=15]="MicAndCamPermissionDenied",e[e.Unknown=16]="Unknown",e[e.InvalidNumber=17]="InvalidNumber",e[e.EmergencyCallDenied=18]="EmergencyCallDenied",e[e.Kicked=19]="Kicked",e[e.InsufficientFunds=20]="InsufficientFunds",e[e.BlockedRegulatoryIndia=21]="BlockedRegulatoryIndia",e[e.BlockedRegulatoryNetherlands=22]="BlockedRegulatoryNetherlands",e[e.TransferedToTwinCam=23]="TransferedToTwinCam",e[e.KickedOwn=24]="KickedOwn",e[e.ReadPhoneStatePermissionDenied=25]="ReadPhoneStatePermissionDenied"}(t.UnansweredCallReason||(t.UnansweredCallReason={})),function(e){e[e.None=0]="None",e[e.SendMessage=1]="SendMessage",e[e.PromptForPermission=2]="PromptForPermission",e[e.SendFeedback=3]="SendFeedback",e[e.CallPSTN=4]="CallPSTN",e[e.ShowRegulatoryInfoIndia=5]="ShowRegulatoryInfoIndia",e[e.ShowRegulatoryInfoNetherlands=6]="ShowRegulatoryInfoNetherlands"}(t.UnansweredCallAction||(t.UnansweredCallAction={}));t.UnansweredCallVisualInfo=class{},function(e){e[e.Emoticon=0]="Emoticon",e[e.Icon=1]="Icon"}(t.UnansweredCallVisualInfoType||(t.UnansweredCallVisualInfoType={})),function(e){e[e.Generic=0]="Generic",e[e.Video=1]="Video",e[e.Audio=2]="Audio"}(t.StartCallOrMaybePromptUserIntent||(t.StartCallOrMaybePromptUserIntent={})),function(e){e[e.Disabled=0]="Disabled",e[e.Requested=1]="Requested",e[e.Pending=2]="Pending",e[e.Enabled=3]="Enabled",e[e.Cancelled=4]="Cancelled",e[e.Declined=5]="Declined"}(t.TranslationState||(t.TranslationState={})),function(e){e[e.NotSupported=0]="NotSupported",e[e.Failed=1]="Failed",e[e.RemoteFailed=2]="RemoteFailed",e[e.SelfConsentRequested=3]="SelfConsentRequested",e[e.SelfConsentRejected=4]="SelfConsentRejected",e[e.RemoteConsentRequested=5]="RemoteConsentRequested",e[e.RemoteConsentRejected=6]="RemoteConsentRejected",e[e.RemoteConsentCancelled=7]="RemoteConsentCancelled",e[e.ConsentRequestedByRemote=8]="ConsentRequestedByRemote",e[e.Enabled=9]="Enabled",e[e.EnabledByRemote=10]="EnabledByRemote",e[e.Disabled=11]="Disabled",e[e.Stopped=12]="Stopped",e[e.StoppedByRemote=13]="StoppedByRemote"}(t.InCallFeatureState||(t.InCallFeatureState={})),function(e){e[e.Start=0]="Start",e[e.Stop=1]="Stop",e[e.RequestConsent=2]="RequestConsent",e[e.RejectConsent=3]="RejectConsent",e[e.Fail=4]="Fail"}(t.InCallFeatureTransitionAction||(t.InCallFeatureTransitionAction={})),function(e){e.Prod="https://api.cc.skype.com/conv/",e.Dev="http://api.conv-dev.skype.net/conv/"}(t.ConversationServiceUrlType||(t.ConversationServiceUrlType={})),function(e){e.Prod="udp://api.cc.skype.com:3478/",e.Dev="udp://api.conv-dev.skype.net:11000/"}(t.UdpTransportUrlType||(t.UdpTransportUrlType={})),function(e){e.Prod="https://api.cc.skype.com/kd/",e.Dev="http://api.conv-dev.skype.net/kd/"}(t.KeyDistributionUrlType||(t.KeyDistributionUrlType={})),function(e){e.UdpEnabled="*Lib/Call/NG/UdpEnabled",e.EnableUdpCanary="*Lib/Call/NG/EnableUdpCanary",e.EnableEncryptedHttp="*Lib/Call/NG/EnableEncryptedHttp",e.EnableEncryptedHttpForBroker="*Lib/Call/NG/EnableEncryptedHttpForBroker",e.ConversationServiceUrl="*Lib/Call/NG/ConversationServiceUrl",e.UdpTransportUrl="*Lib/Call/NG/UdpTransportUrl",e.KeyDistributionUrl="*Lib/Call/NG/KeyDistributionUrl",e.EnableEcoMode="*Lib/Call/EnableEcoMode",e.EnableDnsCache="*Lib/Call/NG/EnableDnsCache",e.TestContextKey="*Lib/Call/TestContextId",e.ECSClientType="*Lib/ECS/ClientType",e.AutoJoinOnConflict="*Lib/Call/NG/AutoJoinOnConflict",e.AdditionalVideoLinesForGroupCalls="*Lib/Call/NG/AdditionalVideoLinesForGroupCalls",e.MaxNrOfVideosVisibleInUI="*Lib/Call/MaxNrOfVideosVisibleInUI",e.EndpointMetadataSetupKey="*Lib/Call/EndpointMetadata",e.LogLevelKey="*Lib/LogLevel",e.AufLogLevelKey="*Lib/AufObjectLogLevel",e.LogRotationSizeKey="*Lib/Logging/Rotation/RotateSize",e.LogRetentionTimeKey="*Lib/Logging/Rotation/RetentionTime",e.LogULMaxSizeKey="*Lib/RootTools/Logging/Appender/MaxSize",e.LogULMaxFilesKey="*Lib/RootTools/Logging/Appender/MaxRotations",e.DeleteOldLogsKey="*Lib/Logging/Rotation/DeleteOldLogs",e.MediaStackLogEnabledKey="*Lib/Media/MediaLibraryLogFileEnabled",e.PreserveFirstLogKey="*Lib/Logging/Rotation/PreserveFirstLog",e.EdfRegistrationKey="*Lib/Call/NG/ForceEDFRegistration",e.RenewSkypeTokenKey="*Lib/Auth/EnableRenewSkypeToken",e.UiLanguageKey="*Lib/Call/NG/LanguageId",e.EmergencyCallingCountryKey="Lib/Call/EmergencyCountry",e.MediaLibraryLogFileEnabledKey="*Lib/Media/MediaLibraryLogFileEnabled",e.AsyncMediaInitKey="*Lib/AsyncMediaInit"}(t.SlimcoreSetupKeys||(t.SlimcoreSetupKeys={})),function(e){e[e.Off=0]="Off",e[e.MobileNetwork=1]="MobileNetwork",e[e.AllNetworks=2]="AllNetworks"}(t.EcoMode||(t.EcoMode={})),t.ScreenSharingPrefix="ss_"},994460:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ButtonEvents=t.Buttons=t.Tab=void 0,function(e){e[e.Calls=0]="Calls",e[e.Phone=1]="Phone"}(t.Tab||(t.Tab={})),function(e){e[e.SkypeCredit=0]="SkypeCredit",e[e.SkypeToPhone=1]="SkypeToPhone",e[e.SkypeNumber=2]="SkypeNumber",e[e.CreditBar=3]="CreditBar",e[e.MeetNow=4]="MeetNow",e[e.AudioCall=5]="AudioCall"}(t.Buttons||(t.Buttons={})),function(e){e[e.Press=0]="Press"}(t.ButtonEvents||(t.ButtonEvents={}))},480200:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LayoutPickerButtonWidth=t.MobileLayoutPickerItemHeight=t.DesktopLayoutPickerItemHeight=t.BigTrayCallParticipantAvatarSize=t.BigTrayOverflowButtonSize=t.BigTrayCallParticipantMainAxisSize=t.CallPanelHeaderHeight=t.RibbonType=t.DesktopMinCallPanelHeaderV2WidthBreakpoint=t.DesktopMinCallRibbonWidthBreakpoint=t.DesktopMinCallPanelHeaderWidthBreakpoint=t.DesktopMinSmallestNewCallControlsWidthBreakpoint=t.DesktopMediumtNewCallControlsWidthBreakpoint=t.DesktopMinStageTwoNewCallControlsWidthBreakpoint=t.DesktopMinNewCallControlsWidthBreakpoint=t.ParticipantEventType=t.CallControlsType=t.ReactionsItemType=t.PhotoAnimationDirection=t.ToastActionType=t.CallRosterOrigin=t.LayoutPickerMenuItemType=t.StageMode=t.DeviceStatusToastType=t.CallControlsKeys=t.InCallWarningViewType=t.CallParticipantStreamsStatus=t.ActiveCallStatus=t.VideoStatus=t.RibbonExtraVisibility=t.CallPanelHeaderLayout=t.ParticipantDragState=t.LayoutInfoVideoType=t.MobileTopTraySizeMultiplier=t.MobileNewHeaderHeight=t.DesktopTopTrayHeight=t.DesktopNewHeaderHeight=t.DesktopCallControlsHeight=t.CallStageViewMode=t.CallControlsOverflowItem=t.CallStageConfig=t.CallButtonSizes=t.RibbonSizes=t.CallAccessoryType=t.CallAccessoryPosition=t.HoveringParticipantSource=t.CallStageElementKeys=t.CallingViewUIPostion=t.CallingViewCornerPostion=t.CallUIState=void 0,t.CallTranscriptionLeftViewMinWidth=t.CallTranscriptionBottomViewMinHeight=t.AudioNotificationOffset=void 0;const a=i(711828);!function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.IncomingRing=2]="IncomingRing",e[e.OutgoingRing=3]="OutgoingRing",e[e.Disconnected=4]="Disconnected",e[e.Voicemail=5]="Voicemail",e[e.GoLiveSinglePlayer=6]="GoLiveSinglePlayer"}(t.CallUIState||(t.CallUIState={})),function(e){e[e.NotAtCorner=0]="NotAtCorner",e[e.UpperLeft=1]="UpperLeft",e[e.UpperRight=2]="UpperRight",e[e.BottomLeft=3]="BottomLeft",e[e.BottomRight=4]="BottomRight"}(t.CallingViewCornerPostion||(t.CallingViewCornerPostion={})),function(e){e[e.Stage=0]="Stage",e[e.Ribbon=1]="Ribbon",e[e.FloatingOnTop=2]="FloatingOnTop",e[e.RibbonWidowsMode=3]="RibbonWidowsMode"}(t.CallingViewUIPostion||(t.CallingViewUIPostion={})),t.CallStageElementKeys={remainderViewKey:"ringingview",callstageViewKey:"callview",screenShareViewKey:"screenshareview",callTextReactionViewKey:"calltextreactionview",ribbonModeViewKey:"ribbonmode",localUserKey:"local",addToCallViewKey:"addtocall",bingBackgrounds:"bingBackgrounds"},function(e){e[e.Participant=1]="Participant",e[e.Nametag=2]="Nametag"}(t.HoveringParticipantSource||(t.HoveringParticipantSource={})),function(e){e[e.Center=1]="Center",e[e.TopLeft=2]="TopLeft",e[e.TopRight=3]="TopRight",e[e.BottomLeft=4]="BottomLeft",e[e.BottomRight=5]="BottomRight",e[e.BottomLeftSmallPadding=6]="BottomLeftSmallPadding",e[e.BottomRightSmallPadding=7]="BottomRightSmallPadding"}(t.CallAccessoryPosition||(t.CallAccessoryPosition={})),function(e){e[e.Mute=1]="Mute",e[e.OnHold=2]="OnHold",e[e.Screensharing=3]="Screensharing"}(t.CallAccessoryType||(t.CallAccessoryType={})),t.RibbonSizes={ribbonItemSizeSmall:60,ribbonItemSizeLarge:100,defaultRibbonItemTopMargin:16,ribbonItemModernStageTopMargin:10,ribbonItemInnerMargin:16,ribbonItemMargin:16,ribbonItemRectBorderRadius:10,ribbonDropTargetSmallHeight:80,ribbonDropTargetLargeHeight:132,ribbonModeElementSize:40},t.CallButtonSizes={callbuttonExtraLargeSize:64,callbuttonLargeSize:52,callbuttonSmallSize:a.IconSize.size40,callbuttonExtraSmallSize:a.IconSize.size32,callbuttonSmallestSize:a.IconSize.size24},t.CallStageConfig={animationDuration:250,maxStageElements:4},function(e){e[e.Reactions=1]="Reactions",e[e.Chat=2]="Chat",e[e.AddPeople=3]="AddPeople",e[e.Gallery=4]="Gallery",e[e.Moments=5]="Moments",e[e.CallRecording=6]="CallRecording",e[e.CallTranslator=7]="CallTranslator",e[e.CallSkypeTranslation=8]="CallSkypeTranslation",e[e.IncomingVideo=9]="IncomingVideo",e[e.AudienceChangeBackground=10]="AudienceChangeBackground",e[e.HeartReaction=11]="HeartReaction",e[e.CelebrationAnimation=12]="CelebrationAnimation",e[e.ThumbsUpReaction=13]="ThumbsUpReaction",e[e.MobileScreenSharing=14]="MobileScreenSharing",e[e.CallStats=15]="CallStats",e[e.BackgroundBlur=16]="BackgroundBlur",e[e.RaiseHands=17]="RaiseHands",e[e.LowerHands=18]="LowerHands",e[e.ChangeTogetherModeBackground=19]="ChangeTogetherModeBackground",e[e.BingBackgrounds=20]="BingBackgrounds",e[e.NoiseSuppression=21]="NoiseSuppression",e[e.TwinCam=22]="TwinCam",e[e.ToggleHoldCall=23]="ToggleHoldCall",e[e.Participants=24]="Participants",e[e.SwitchCamera=25]="SwitchCamera"}(t.CallControlsOverflowItem||(t.CallControlsOverflowItem={})),function(e){e[e.None=0]="None",e[e.StageAndRibbon=1]="StageAndRibbon",e[e.RibbonOnly=2]="RibbonOnly",e[e.StageOnly=3]="StageOnly"}(t.CallStageViewMode||(t.CallStageViewMode={})),t.DesktopCallControlsHeight=70,t.DesktopNewHeaderHeight=40,t.DesktopTopTrayHeight=128,t.MobileNewHeaderHeight=0,t.MobileTopTraySizeMultiplier=.5,function(e){e[e.None=1]="None",e[e.Portrait=2]="Portrait",e[e.Landscape=3]="Landscape"}(t.LayoutInfoVideoType||(t.LayoutInfoVideoType={})),function(e){e[e.Unspecified=0]="Unspecified",e[e.Pan=1]="Pan",e[e.Move=2]="Move"}(t.ParticipantDragState||(t.ParticipantDragState={})),function(e){e[e.Mobile=0]="Mobile",e[e.Float=1]="Float",e[e.Window=2]="Window",e[e.None=3]="None"}(t.CallPanelHeaderLayout||(t.CallPanelHeaderLayout={})),function(e){e[e.None=0]="None",e[e.Hidden=1]="Hidden",e[e.Visible=2]="Visible"}(t.RibbonExtraVisibility||(t.RibbonExtraVisibility={})),function(e){e[e.None=0]="None",e[e.Available=1]="Available",e[e.Streaming=2]="Streaming"}(t.VideoStatus||(t.VideoStatus={})),function(e){e[e.None=0]="None",e[e.Connected=1]="Connected",e[e.OnHold=2]="OnHold"}(t.ActiveCallStatus||(t.ActiveCallStatus={})),function(e){e[e.None=0]="None",e[e.Single=1]="Single",e[e.Multiple=2]="Multiple"}(t.CallParticipantStreamsStatus||(t.CallParticipantStreamsStatus={})),function(e){e[e.Audio=0]="Audio",e[e.Network=1]="Network",e[e.Voicemail=2]="Voicemail",e[e.Forwarding=3]="Forwarding"}(t.InCallWarningViewType||(t.InCallWarningViewType={})),function(e){e.Mic="mic",e.MicQuickSettings="micQuickSettings",e.Video="video",e.VideoQuickSettings="videoQuickSettings",e.Dialpad="dialpad",e.Participants="participants",e.ScreenShare="screenShare",e.ScreenShareControl="screenShareControl",e.EndCall="endCall",e.RaiseHand="raiseHand",e.LowerHand="lowerHand",e.ShareLink="shareLink",e.ChangeScene="changeScene",e.Record="recordCall",e.ReactionsDrawer="reactionspicker",e.ReactionsPopover="reactionspopover",e.Overflow="overflow",e.Moments="moments",e.Chat="chat",e.TwinCam="twinCam",e.StopTwinCam="StopTwinCam",e.LiveCaptions="LiveCaptions",e.SkypeTranslate="SkypeTranslate"}(t.CallControlsKeys||(t.CallControlsKeys={})),function(e){e[e.None=0]="None",e[e.SpeakerDisconnected=1]="SpeakerDisconnected",e[e.MicrophoneDisconnected=2]="MicrophoneDisconnected",e[e.CompositeAudioAvailable=3]="CompositeAudioAvailable",e[e.AudioStoppedWorking=4]="AudioStoppedWorking",e[e.MicrophoneStoppedWorking=5]="MicrophoneStoppedWorking",e[e.SpeakerStoppedWorking=6]="SpeakerStoppedWorking",e[e.AudioDeviceBusy=7]="AudioDeviceBusy",e[e.SoundSharingStopped=8]="SoundSharingStopped",e[e.VideoStoppedWorking=9]="VideoStoppedWorking",e[e.VideoTimedOut=10]="VideoTimedOut",e[e.VideoSystemOutOfMemory=11]="VideoSystemOutOfMemory",e[e.VideoSystemBusy=12]="VideoSystemBusy",e[e.SpeakerChanged=13]="SpeakerChanged",e[e.MicrophoneChanged=14]="MicrophoneChanged",e[e.CameraChanged=15]="CameraChanged",e[e.DeviceCausingEcho=16]="DeviceCausingEcho",e[e.MicrophoneNotMuteButSilent=17]="MicrophoneNotMuteButSilent",e[e.MicrophoneServerMuted=18]="MicrophoneServerMuted",e[e.OutgoingVideoDisabledDuringScreenSharing=19]="OutgoingVideoDisabledDuringScreenSharing",e[e.DeviceRenderGlitches=20]="DeviceRenderGlitches",e[e.DeviceLowSNR=21]="DeviceLowSNR",e[e.DeviceClipping=22]="DeviceClipping",e[e.DeviceEcho=23]="DeviceEcho",e[e.DeviceMultipleEndpoints=24]="DeviceMultipleEndpoints",e[e.DeviceRenderZeroVolume=25]="DeviceRenderZeroVolume",e[e.CpuInsufficient=26]="CpuInsufficient",e[e.ZeroCaptureDevicesEnumerated=27]="ZeroCaptureDevicesEnumerated",e[e.ZeroRenderDevicesEnumerated=28]="ZeroRenderDevicesEnumerated",e[e.VideoCaptureDeviceFreeze=29]="VideoCaptureDeviceFreeze",e[e.AudioCapturePermissionDenied=30]="AudioCapturePermissionDenied",e[e.VideoCapturePermissionDenied=31]="VideoCapturePermissionDenied",e[e.VideoCaptureFreezeRecovered=32]="VideoCaptureFreezeRecovered",e[e.DeviceRenderHowling=33]="DeviceRenderHowling",e[e.PresentationAudioLoopbackDeviceState=34]="PresentationAudioLoopbackDeviceState",e[e.RemoteNetworkConnectivityIssue=35]="RemoteNetworkConnectivityIssue",e[e.AudioCaptureUltrasoundDetected=36]="AudioCaptureUltrasoundDetected",e[e.MusicModeNotAvailable=37]="MusicModeNotAvailable",e[e.CameraLighting=38]="CameraLighting",e[e.VideoEffectsQualityChange=39]="VideoEffectsQualityChange",e[e.AudioCaptureMusicDetectedWithHighNS=40]="AudioCaptureMusicDetectedWithHighNS",e[e.AudioCaptureMusicDetectedWithHighNSNotAvailable=41]="AudioCaptureMusicDetectedWithHighNSNotAvailable",e[e.AudioCaptureMusicDetectedWithLowNS=42]="AudioCaptureMusicDetectedWithLowNS"}(t.DeviceStatusToastType||(t.DeviceStatusToastType={})),function(e){e[e.Speaker=0]="Speaker",e[e.FocusedScreenShare=1]="FocusedScreenShare",e[e.Grid=2]="Grid",e[e.Manual=3]="Manual",e[e.Presentation=4]="Presentation",e[e.TogetherMode=5]="TogetherMode",e[e.LargeGrid=6]="LargeGrid"}(t.StageMode||(t.StageMode={})),function(e){e[e.Divider=0]="Divider",e[e.StageModeSpeaker=1]="StageModeSpeaker",e[e.StageModeFocusedScreenShare=2]="StageModeFocusedScreenShare",e[e.StageModeGrid=3]="StageModeGrid",e[e.StageModeManual=4]="StageModeManual",e[e.StageModePresentation=5]="StageModePresentation",e[e.StageModeTogetherMode=6]="StageModeTogetherMode",e[e.StageModeLargeGrid=7]="StageModeLargeGrid",e[e.OnlyVideoOnTheStage=8]="OnlyVideoOnTheStage",e[e.Fullscreen=9]="Fullscreen",e[e.CallPanelHeaderLayoutMobile=10]="CallPanelHeaderLayoutMobile",e[e.CallPanelHeaderLayoutFloat=11]="CallPanelHeaderLayoutFloat",e[e.CallPanelHeaderLayoutWindow=12]="CallPanelHeaderLayoutWindow",e[e.CallPanelHeaderLayoutNone=13]="CallPanelHeaderLayoutNone",e[e.SelfInTheGridToggle=14]="SelfInTheGridToggle",e[e.HidePeopleAtTop=15]="HidePeopleAtTop",e[e.ShowPeopleAtTop=16]="ShowPeopleAtTop",e[e.SwitchToDarkThemeStage=17]="SwitchToDarkThemeStage",e[e.SwitchToLightThemeStage=18]="SwitchToLightThemeStage"}(t.LayoutPickerMenuItemType||(t.LayoutPickerMenuItemType={})),function(e){e[e.FromGroupTitle=0]="FromGroupTitle",e[e.FromManageGroupButton=1]="FromManageGroupButton",e[e.FromParticipantCount=2]="FromParticipantCount",e[e.FromConversationIcon=3]="FromConversationIcon",e[e.GoLiveInformationView=4]="GoLiveInformationView",e[e.CallControls=5]="CallControls",e[e.OverflowMenu=6]="OverflowMenu",e[e.TrayOverflowButton=7]="TrayOverflowButton"}(t.CallRosterOrigin||(t.CallRosterOrigin={})),function(e){e[e.Actioned=0]="Actioned",e[e.ManualDismissed=1]="ManualDismissed",e[e.AutoDismissed=2]="AutoDismissed",e[e.Dismissed=3]="Dismissed"}(t.ToastActionType||(t.ToastActionType={})),function(e){e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=3]="Up",e[e.Zoom=4]="Zoom"}(t.PhotoAnimationDirection||(t.PhotoAnimationDirection={})),function(e){e[e.Sticker=0]="Sticker",e[e.Emoticon=1]="Emoticon",e[e.Snapshot=2]="Snapshot",e[e.Animation=3]="Animation",e[e.CallEvent=4]="CallEvent"}(t.ReactionsItemType||(t.ReactionsItemType={})),function(e){e[e.Default=0]="Default",e[e.Mobile=1]="Mobile",e[e.DesktopMin=2]="DesktopMin",e[e.DesktopMinStageTwo=3]="DesktopMinStageTwo",e[e.DesktopMedium=4]="DesktopMedium",e[e.DesktopMinSmallest=5]="DesktopMinSmallest"}(t.CallControlsType||(t.CallControlsType={})),function(e){e[e.Join=0]="Join",e[e.Leave=1]="Leave",e[e.Unavailable=2]="Unavailable",e[e.BotUnavailable=3]="BotUnavailable",e[e.Muted=4]="Muted",e[e.KickedOut=5]="KickedOut",e[e.HandRaised=6]="HandRaised",e[e.TogetherModeDesiredBackgroundAlreadySet=7]="TogetherModeDesiredBackgroundAlreadySet",e[e.TogetherModeBackgroundChangeFailed=8]="TogetherModeBackgroundChangeFailed",e[e.TogetherModeBackgroundChanged=9]="TogetherModeBackgroundChanged"}(t.ParticipantEventType||(t.ParticipantEventType={})),t.DesktopMinNewCallControlsWidthBreakpoint=1200,t.DesktopMinStageTwoNewCallControlsWidthBreakpoint=1050,t.DesktopMediumtNewCallControlsWidthBreakpoint=899,t.DesktopMinSmallestNewCallControlsWidthBreakpoint=749,t.DesktopMinCallPanelHeaderWidthBreakpoint=824,t.DesktopMinCallRibbonWidthBreakpoint=1128,t.DesktopMinCallPanelHeaderV2WidthBreakpoint=700,function(e){e[e.Small=0]="Small",e[e.Large=1]="Large"}(t.RibbonType||(t.RibbonType={})),t.CallPanelHeaderHeight={mobile:72,window:80},t.BigTrayCallParticipantMainAxisSize={video:200,audio:120},t.BigTrayOverflowButtonSize=t.BigTrayCallParticipantMainAxisSize.audio,t.BigTrayCallParticipantAvatarSize=64,t.DesktopLayoutPickerItemHeight=37,t.MobileLayoutPickerItemHeight=53,t.LayoutPickerButtonWidth=200,t.AudioNotificationOffset=30,t.CallTranscriptionBottomViewMinHeight=200,t.CallTranscriptionLeftViewMinWidth=260},491570:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QuickCallPanelMenuItemCommand=t.QuickCallPanelFilter=void 0,function(e){e[e.All=0]="All",e[e.Skype=1]="Skype",e[e.Phone=2]="Phone"}(t.QuickCallPanelFilter||(t.QuickCallPanelFilter={})),t.QuickCallPanelMenuItemCommand={all:"all",skype:"skype",phone:"phone"}},813598:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.zoomDrawerValues=t.zoomUiSizesText=t.ZoomDelayValues=t.ZoomLevelBoundaries=t.ScreenShareZoomType=void 0,function(e){e[e.ScrollWheel=0]="ScrollWheel",e[e.UIControls=1]="UIControls",e[e.Keyboard=2]="Keyboard",e[e.TrackPad=3]="TrackPad"}(t.ScreenShareZoomType||(t.ScreenShareZoomType={})),function(e){e[e.DefaultLevel=0]="DefaultLevel",e[e.MaxLevel=4]="MaxLevel"}(t.ZoomLevelBoundaries||(t.ZoomLevelBoundaries={})),function(e){e[e.MinDelay=60]="MinDelay",e[e.MaxDelay=120]="MaxDelay",e[e.TrackPadDelay=240]="TrackPadDelay"}(t.ZoomDelayValues||(t.ZoomDelayValues={})),t.zoomUiSizesText=["3","2.5","2","1.5","1"],t.zoomDrawerValues={minHeight:30,minOpacity:0,maxOpacity:1,openDuration:150,closeDuration:50,activeItemSize:28,nonActiveItemSize:22,itemMargin:7,lastItemMargin:3,coachMarkWidth:400}},924899:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(889391),r=i(719061),l=i(67930),c=i(994224),d=i(502278),u=i(109520),h=i(587134),p=i(746096),g=i(110117),C=i(702301),S=i(567977),m=i(436237),y=i(915877),f=i(540522),b=i(733754),_=i(104735),T=i(217093),v=i(285683),w=i(190631),I=i(711828),P=i(680837),M=i(619675),k=i(853374),A=i(897634),R=S.UserIconSize.Size40,x=(0,y.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),headerContainer:()=>o.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch"}),itemContainer:()=>o.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch",flexDirection:"column",paddingHorizontal:20,marginBottom:10}),itemTextContainer:()=>o.Styles.createTextStyle({fontSize:15,cursor:"pointer"}),itemDivider:()=>o.Styles.createViewStyle({height:1}),sectionTitle:()=>o.Styles.createViewStyle({height:48,flexDirection:"row",alignItems:"center",justifyContent:"flex-start",paddingHorizontal:20}),userContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"flex-start",justifyContent:"flex-start",paddingVertical:12}),userIcon:()=>o.Styles.createViewStyle({marginRight:8}),enableFeature:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"stretch",justifyContent:"flex-start",paddingHorizontal:20}),enableFeatureText:()=>o.Styles.createViewStyle({flexDirection:"row",flexGrow:1,alignItems:"center"}),bingIconLeft:()=>o.Styles.createViewStyle({width:16,height:16,marginRight:10}),copyrightText:()=>o.Styles.createTextStyle({fontSize:12}),settignsPanelWrapper:()=>o.Styles.createViewStyle({paddingHorizontal:20}),settignsPanel:()=>o.Styles.createViewStyle({flexDirection:"row",justifyContent:"flex-start",marginTop:10,marginBottom:12}),topBgReplaceIcon:()=>o.Styles.createViewStyle({width:24,height:24,marginRight:10}),bgReplaceTextBlock:()=>o.Styles.createViewStyle({flexDirection:"column",justifyContent:"flex-start",flexShrink:1}),bgReplaceTitle:()=>o.Styles.createTextStyle({fontSize:13,paddingBottom:5}),bgReplaceText:()=>o.Styles.createTextStyle({fontSize:13}),bgReplaceTexHover:()=>o.Styles.createTextStyle({cursor:"pointer"})});class L extends l.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onSettingsTextMouseOver=()=>{this.setState({settingsTextHover:!0})},this._onSettingsTextMouseLeave=()=>{this.setState({settingsTextHover:!1})},this._onSettingClick=()=>{const e=k.default.newCauseId();this._goBack(e),_.default.navigateToDesktopSettingsGroup(T.SettingsGroup.AudioVideoSettings,this._getRootViewId(),e)},this._closeView=()=>{const e=k.default.newCauseId();m.log(p.LogTraceArea.CallingUI,`[CallRosterView] _closeRoster, causeId: ${e}`),this._goBack(e)}}static getHeaderText(){return b.getString("CallPanel.CallRosterAccessibilityLabel")}_buildState(e,t){const i=c.default.CallParticipantBackgroundInfoStore.getBackgroundInfos(e.route.params.callId);return{captions:i,sortedCaptions:this._sortCaptions(i),isBingPictureOfDayBgSelected:c.default.CallParticipantBackgroundInfoStore.getBingBackgroundEnabled(),isBgReplaceEnabled:c.default.DeviceStore.isBackgroundReplacementEnabled()}}_sortCaptions(e){const t={};for(const i of n.values(e)){if(!(i.isoDate&&i.market&&i.caption&&i.copyright))continue;const e=i.market,a=i.isoDate;t[e]||(t[e]={});const n=i.userId;if(t[e][a])t[e][a].userIds.push(n);else{const o={caption:i.caption,copyright:i.copyright,link:i.link,market:e,isoDate:a,userIds:[n]};t[e][a]=o}}return t}_getHeader(){const e={closeButtonType:w.CloseButtonType.Close,onPress:this._closeView,title:b.getString("Global.CloseButtonTitle")},t=(0,a.jsx)(o.View,{style:P.default.flexOne}),i=b.getString("CallControls.BingBackgrounds");return(0,a.jsx)(o.View,Object.assign({style:x.headerContainer},{children:(0,a.jsx)(w.SimplePanelHeader,{panelName:i,useTransparentBackground:!0,leftButton:e,titleView:t})}))}_renderList(){const e=[],{dividerColorStyle:t,secondaryTextColorStyle:i}=A.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),{primaryIconColor:s,primaryBackgroundColor:r}=A.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),l=[x.itemDivider,t],c=this.state.settingsTextHover?x.bgReplaceTexHover:void 0;if(this.state.isBgReplaceEnabled&&e.push((0,a.jsxs)(o.View,Object.assign({style:x.settignsPanelWrapper},{children:[(0,a.jsxs)(o.View,Object.assign({style:x.settignsPanel},{children:[(0,a.jsx)(g.default,{color:s,icon:I.SkypeIcon.BackgroundReplacement,size:I.IconSize.size24,style:x.topBgReplaceIcon}),(0,a.jsxs)(o.View,Object.assign({style:x.bgReplaceTextBlock,onMouseOver:this._onSettingsTextMouseOver,onMouseLeave:this._onSettingsTextMouseLeave,onPress:this._onSettingClick},{children:[(0,a.jsx)(M.BodyText,Object.assign({bold:!0,style:[x.bgReplaceTitle,c]},{children:b.getString("AudioVideoSettings.BackgroundEffectBingCameraTitle2")})),(0,a.jsx)(M.BodyText,Object.assign({style:[x.bgReplaceText,i,c]},{children:b.getString("AudioVideoSettings.BackgroundEffectBingCoachMarkText2")}))]}))]})),(0,a.jsx)(h.default,{style:l},"itemDivider")]}))),e.push((0,a.jsx)(o.View,Object.assign({style:x.sectionTitle},{children:(0,a.jsx)(v.SectionTitle,{title:b.getString("CallPanel.BingBackgroundOverviewTitle"),titleStyles:P.default.flexOne})}))),this.state.sortedCaptions)for(const t of n.keys(this.state.sortedCaptions)){const s=this.state.sortedCaptions[t];for(const t of n.keys(s)){const n=s[t],c=[];for(const e of n.userIds){const t=e;c.push((0,a.jsx)(C.UserIcon,{userMri:t,size:R,useCircleForAgentMask:!0,statusBorderColor:r,style:x.userIcon},"userIcon"))}const d=(0,a.jsxs)(o.View,Object.assign({style:x.itemContainer},{children:[(0,a.jsx)(M.BodyText,Object.assign({bold:!0,style:x.itemTextContainer,onPress:()=>{this._onClick(n)}},{children:n.caption})),(0,a.jsx)(M.BodyText,Object.assign({style:[x.copyrightText,i]},{children:n.copyright})),(0,a.jsx)(o.View,Object.assign({style:x.userContainer},{children:c})),(0,a.jsx)(h.default,{style:l},"itemDivider")]}));e.push(d)}}return(0,a.jsx)(o.ScrollView,{children:e},"scrollview")}render(){const{primaryBackgroundColorStyle:e}=A.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return(0,a.jsxs)(o.View,Object.assign({style:[x.container,e]},{children:[this._getHeader(),this._renderList()]}))}_onClick(e){const{callId:t}=this.props.route.params;if(t){const i=k.default.newCauseId();d.default.updateCallTelemetry(t,i,(e=>e.bingBackgroundEffectCaptionClick())),m.track(new u.BackgroundEffectsBingInfoClickEvent(t,e.isoDate,void 0,e.market,!1))}if(e.link){const t=`${s.default.getS4LCMCFeaturesNoSubscription().bingBackgrounds.host}${e.link}`,i={browserTitle:b.getString("AudioVideoSettings.BackgroundEffectCategoryBing"),preventInAppNavigationForGuest:!r.default.canNavigateInApp()};f.openUrlWithParams({origin:p.BrowserOrigin.LinkNode,url:t,options:i,rootViewId:this._getRootViewId()})}}_getHeaderText(e){return L.getHeaderText()}}t.default=L},83940:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(667294),o=i(904812);class s extends n.Component{render(){return(0,a.jsx)(o.CallPanel,Object.assign({},this.props))}}t.default=s},110604:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(751793),o=i(257538);t.default=e=>{const{activeCallId:t,callOrigin:i,conversationMri:s,isTwinCam:r}=e.route.params;return(0,a.jsx)(n.default,{meetNowParameters:{origin:o.MeetNowOrigin.CallPanel,convId:s},callPreviewProps:{callOrigin:i},showTwinCam:r,activeCallId:t})}},691848:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(67930),s=i(994224),r=i(866080),l=i(647176),c=i(502278),d=i(671830),u=i(746096),h=i(436237),p=i(915877),g=i(733754),C=i(104735),S=i(914976),m=i(190631),y=i(711828),f=i(680837),b=i(790970),_=i(853374),T=i(897634),v=(0,p.lazyProperties)({container:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),headerContainer:()=>n.Styles.createViewStyle({alignSelf:"stretch",alignItems:"stretch"})});class w extends o.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._closeRoster=()=>{const e=_.default.newCauseId();h.log(u.LogTraceArea.CallingUI,`[CallRosterView] _closeRoster, causeId: ${e}`),this._goBack(e),b.default.getActiveSession()&&(b.default.completeSession(),h.log(u.LogTraceArea.CallingUI,`[CallRosterView] _closeRoster Call Roster completeSession, causeId: ${e}`),c.default.updateCallTelemetry(this.props.route.params.callId,e,(e=>e.callRosterClosedCount())))},this._addParticipantsToCall=()=>{const{callId:e,conversationId:t}=this.props.route.params,i=_.default.newCauseId();h.log(u.LogTraceArea.CallingUI,`[CallRosterView] _addParticipantsToCall, causeId: ${i}`),C.default.openAddToCall(t,e,u.NavigationAddToCallOrigin.RosterView,this._getContext(),i),b.default.updateCallRosterTelemetry(e,i,(e=>e.callRosterAddToCall()))}}static getHeaderText(){return g.getString("CallPanel.CallRosterAccessibilityLabel")}_buildState(e,t){const{callId:i,conversationId:a}=e.route.params,n=l.default.getRosterForConversation(a);if(n&&0===n.length){const e=_.default.newCauseId();h.warn(u.LogTraceArea.CallingUI,"CallRosterView._buildState: allParticipants is empty list conversationId="+S.mriOrId(a)+" causeId="+e),c.default.updateCallTelemetry(i,e,(e=>e.callRosterGetAllParticipantsFailedCount()))}const o=l.default.getActiveParticipants(i,a),r=s.default.CallingStore.isPSTNCall(i),p=d.isEncryptedThread(a);return{allParticipantCount:n.length,activeParticipantCount:o.length,conversationName:l.default.getConversationName(a),allowAddToCall:s.default.CallingFeaturesHelper.allowAddToCall({conversationMri:a,isPSTNCall:r,isEncryptedCall:p,callId:i})}}_getCallRosterHeader(){const e={closeButtonType:m.CloseButtonType.Close,onPress:this._closeRoster,title:g.getString("Global.CloseButtonTitle")},t=this.state.allowAddToCall?{onPress:this._addParticipantsToCall,accessibilityLabel:g.getString("CallPanel.AddToCallTooltipTitle"),icon:y.SkypeIcon.ContactAdd}:void 0,i=(0,a.jsx)(n.View,{style:f.default.flexOne}),o=g.getString("CallPanel.CallRosterTitle",{count:this.state.activeParticipantCount,total:this.state.allParticipantCount});return(0,a.jsx)(n.View,Object.assign({style:v.headerContainer},{children:(0,a.jsx)(m.SimplePanelHeader,{panelName:o,useTransparentBackground:!0,leftButton:e,rightButtons:t,titleView:i})}))}render(){const{primaryBackgroundColorStyle:e}=T.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return(0,a.jsxs)(n.View,Object.assign({style:[v.container,e]},{children:[this._getCallRosterHeader(),(0,a.jsx)(r.default,{callId:this.props.route.params.callId,conversationMri:this.props.route.params.conversationId})]}))}_getHeaderText(e){return w.getHeaderText()}}t.default=w},104096:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(787720),r=i(996074),l=i(178816),c=i(898278),d=i(587134),u=i(915877),h=i(106658),p=i(590602),g=i(190631),C=i(22222),S=i(581760),m=i(711828),y=i(680837),f=i(619675),b=i(853374),_=(0,u.lazyProperties)({container:()=>o.Styles.createViewStyle({flex:1,flexDirection:"column",padding:15,backgroundColor:S.Color.white}),buttonsContainer:()=>o.Styles.createViewStyle({flexDirection:"row",alignContent:"stretch",paddingVertical:5}),headerContainer:()=>o.Styles.createViewStyle({flexDirection:"row",paddingVertical:5,flex:1}),scrollView:()=>o.Styles.createScrollViewStyle({flex:1,alignSelf:"stretch"}),headerStyle:()=>o.Styles.createTextStyle({marginVertical:10}),buttonStyle:()=>o.Styles.createViewStyle({marginVertical:10}),buttonGroupContainer:()=>o.Styles.createViewStyle({flexDirection:"column",paddingVertical:5,flex:1})});class T extends r.BaseNavigationView{constructor(){super(...arguments),this._onAppMetricChange=(e,t)=>{l.default.setShowAppMetrics(t)},this._onVideoMetricChange=(e,t)=>{l.default.setShowVideoMetrics(t)},this._onClose=()=>{const e=b.default.newCauseId();l.default.closeDebugWindow(this.props.route.params.callId,e,this._getContext(),!1)},this._onPopout=()=>{const e=b.default.newCauseId();l.default.openNativeWindow(this.props.route.params.callId,!0,this._getContext(),e)}}_buildState(e,t){return{callTechnicalInfo:l.default.getCallTechnicalInfo(e.route.params.callId),selectedItem:t?l.CallDebugMenuItem.CallStats:l.default.getSelectedTab(),showAppMetrics:l.default.showAppMetrics(),showVideoMetrics:l.default.showVideoMetrics(),appMetrics:l.default.getAppMetrics()}}componentDidMount(){super.componentDidMount(),l.default.init(this.props.route.params.callId)}componentWillUnmount(){super.componentWillUnmount(),l.default.dispose(this.props.route.params.callId)}render(){const{selectedItem:e}=this.state;let t;switch(e){case l.CallDebugMenuItem.Simulation:t=this._renderSimulatePanel();break;case l.CallDebugMenuItem.CallStats:t=this._renderCallStats();break;case l.CallDebugMenuItem.Inspect:t=this._renderInspectContent()}const i={closeButtonType:g.CloseButtonType.Close,onPress:this._onClose,title:"Close"};return(0,a.jsxs)(o.View,Object.assign({style:_.container},{children:[!this.props.route.params.nativeWindow&&(0,a.jsx)(g.SimplePanelHeader,{panelName:"Call debug panel",titleTextStyle:y.default.flexNegativeOne,leftButton:i,rightButtons:undefined,hideBottomBorder:!0,leavePaddingForStatusBar:o.StatusBar.isOverlay()}),(0,a.jsx)(o.View,Object.assign({style:_.buttonsContainer},{children:this._renderMenuItems()})),(0,a.jsx)(d.default,{}),(0,a.jsx)(o.ScrollView,Object.assign({style:_.scrollView},{children:(0,a.jsx)(o.View,{children:t})}),"scrollview")]}))}_renderMenuItems(){const{selectedItem:e}=this.state;return n.map(l.CallDebugMenuItem,(t=>{const i=l.CallDebugMenuItem[t];return n.isString(i)?(0,a.jsx)(C.default,{buttonSize:c.SXButtonSize.Small,buttonStyle:t===e?void 0:c.SXButtonStyle.ThemeNoBackground,title:l.CallDebugMenuItem[t],onPress:()=>l.default.setSelectedTab(t)},"calldebug"+i):void 0}))}_renderCallStats(){const{callTechnicalInfo:e}=this.state;if(e)return(0,a.jsx)(o.View,{children:n.map(null==e?void 0:e.channels,((e,t)=>(0,a.jsxs)(o.View,{children:[(0,a.jsx)(f.Header,Object.assign({selectable:!0,style:_.headerStyle,size:5,numberOfLines:1},{children:`Channel ${t}`})),n.map(e,((e,t,i)=>{const n="Bandwidth Estimation Algorithm"===t?"Band. est. alg.":t;return(0,a.jsxs)(o.View,Object.assign({style:y.default.flexOne},{children:[this._renderMetricLine(n,e),(0,a.jsx)(d.default,{})]}),`callstat-${i}`)}))]})))})}_renderSimulatePanel(){return(0,a.jsxs)(o.View,{children:[(0,a.jsx)(f.Header,Object.assign({style:_.headerStyle,size:5,numberOfLines:1},{children:"Actions"}),"actions"),(0,a.jsxs)(o.View,Object.assign({style:_.buttonGroupContainer},{children:[(0,a.jsx)(C.default,{buttonSize:c.SXButtonSize.Medium,buttonStyle:c.SXButtonStyle.ColorStroke,icon:m.SkypeIcon.ContactAdd,title:"Add participant",style:_.buttonStyle,onPress:()=>this._onAddParticipantPress()},"addParticipant"),(0,a.jsx)(C.default,{buttonSize:c.SXButtonSize.Medium,buttonStyle:c.SXButtonStyle.ColorStroke,icon:m.SkypeIcon.SwitchAccount,title:"Remove participant",style:_.buttonStyle,onPress:()=>this._onRemoveParticipantPress()},"removeParticipant"),(0,a.jsx)(C.default,{buttonSize:c.SXButtonSize.Medium,buttonStyle:c.SXButtonStyle.ColorStroke,icon:m.SkypeIcon.ContactGroup,title:"Add 12 participants",style:_.buttonStyle,onPress:()=>this._onGroupParticipantPress()},"addGroupParticipant"),(0,a.jsx)(C.default,{buttonSize:c.SXButtonSize.Medium,buttonStyle:c.SXButtonStyle.ColorStroke,icon:m.SkypeIcon.Reload,title:"Reset",style:_.buttonStyle,onPress:()=>this._resetParticipants()},"resetParticipants")]})),(0,a.jsx)(f.Header,Object.assign({style:_.headerStyle,size:5,numberOfLines:1},{children:"Simulate call states"}),"Simulate"),(0,a.jsx)(f.Header,Object.assign({style:_.headerStyle,size:5,numberOfLines:1},{children:"Network states"}),"Network")]})}_renderInspectContent(){return(0,a.jsxs)(o.View,{children:[(0,a.jsx)(f.Header,Object.assign({style:_.headerStyle,size:5,numberOfLines:1},{children:"Actions"})),(0,a.jsxs)(o.View,Object.assign({style:_.buttonGroupContainer},{children:[(0,a.jsx)(s.default,Object.assign({accessibilityLabel:"Show app metrics",style:p.default.controlRowWithDescription,isOn:!!this.state.showAppMetrics,onChange:this._onAppMetricChange},{children:(0,a.jsx)(o.View,Object.assign({style:y.default.flexOne},{children:(0,a.jsx)(f.RowTitle,Object.assign({style:p.default.switchTitleMediumSemiLarge},{children:"Show app metrics"}))}))})),(0,a.jsx)(s.default,Object.assign({accessibilityLabel:"Show video metrics",style:p.default.controlRowWithDescription,isOn:!!this.state.showVideoMetrics,onChange:this._onVideoMetricChange},{children:(0,a.jsx)(o.View,Object.assign({style:y.default.flexOne},{children:(0,a.jsx)(f.RowTitle,Object.assign({style:p.default.switchTitleMediumSemiLarge},{children:"Show video metrics"}))}))})),this._renderAppMetrics()]}))]})}_renderAppMetrics(){var e,t,i,n,s,r,l,c,u,h,p,g,C,S,m,b,T,v,w,I,P,M,k,A,R,x,L,V,O;if(!this.state.showAppMetrics)return;const B=(null===(e=this.state.appMetrics)||void 0===e?void 0:e.gpu)&&(0,a.jsxs)(o.View,{children:[(0,a.jsxs)(f.Header,Object.assign({style:_.headerStyle,size:5,numberOfLines:1},{children:["GPU ",null===(i=null===(t=this.state.appMetrics)||void 0===t?void 0:t.gpu)||void 0===i?void 0:i.pid]})),this._renderMetricLine("CPU",`${null===(s=null===(n=this.state.appMetrics)||void 0===n?void 0:n.gpu)||void 0===s?void 0:s.cpu.toFixed(2)} %`),this._renderMetricLine("Memory",`${((null===(l=null===(r=this.state.appMetrics)||void 0===r?void 0:r.gpu)||void 0===l?void 0:l.wss)/1024).toFixed(2)} Mb`)]}),D=(null===(c=this.state.appMetrics)||void 0===c?void 0:c.renderer)&&(0,a.jsxs)(o.View,{children:[(0,a.jsxs)(f.Header,Object.assign({style:_.headerStyle,size:5,numberOfLines:1},{children:["Renderer ",null===(h=null===(u=this.state.appMetrics)||void 0===u?void 0:u.renderer)||void 0===h?void 0:h.pid]})),this._renderMetricLine("CPU",`${null===(g=null===(p=this.state.appMetrics)||void 0===p?void 0:p.renderer)||void 0===g?void 0:g.cpu.toFixed(2)} %`),this._renderMetricLine("Memory",`${((null===(S=null===(C=this.state.appMetrics)||void 0===C?void 0:C.renderer)||void 0===S?void 0:S.wss)/1024).toFixed(2)} Mb`),(0,a.jsx)(d.default,{})]}),E=(null===(m=this.state.appMetrics)||void 0===m?void 0:m.systemUsageInfo)&&(0,a.jsxs)(o.View,{children:[(0,a.jsx)(f.Header,Object.assign({style:_.headerStyle,size:5,numberOfLines:1},{children:"Main"})),this._renderMetricLine("CPU Model",null===(T=null===(b=this.state.appMetrics)||void 0===b?void 0:b.systemUsageInfo)||void 0===T?void 0:T.cpuModel),this._renderMetricLine("CPU Speed",null===(w=null===(v=this.state.appMetrics)||void 0===v?void 0:v.systemUsageInfo)||void 0===w?void 0:w.cpuSpeed),this._renderMetricLine("CPU Cores",null===(P=null===(I=this.state.appMetrics)||void 0===I?void 0:I.systemUsageInfo)||void 0===P?void 0:P.cores),this._renderMetricLine("Total memory",`${null===(k=null===(M=this.state.appMetrics)||void 0===M?void 0:M.systemUsageInfo)||void 0===k?void 0:k.totalMemory} Mb`),this._renderMetricLine("Free memory",`${null===(R=null===(A=this.state.appMetrics)||void 0===A?void 0:A.systemUsageInfo)||void 0===R?void 0:R.freeMemory} Mb`),this._renderMetricLine("Memory allocated to heap",`${null===(L=null===(x=this.state.appMetrics)||void 0===x?void 0:x.systemUsageInfo)||void 0===L?void 0:L.processMemory} Mb`),this._renderMetricLine("CPU Usage",`${null===(O=null===(V=this.state.appMetrics)||void 0===V?void 0:V.systemUsageInfo)||void 0===O?void 0:O.cpuUsage} %`),(0,a.jsx)(d.default,{})]});return(0,a.jsxs)(o.View,Object.assign({style:y.default.flexOne},{children:[E,D,B]}))}_renderMetricLine(e,t){return(0,a.jsxs)(o.View,Object.assign({style:_.headerContainer},{children:[(0,a.jsxs)(f.Caption,Object.assign({selected:!0,selectable:!0,messageStreamFontSize:h.MessageStreamFontSize.Normal},{children:[e,":"," "]})),(0,a.jsx)(f.Caption,Object.assign({selectable:!0,messageStreamFontSize:h.MessageStreamFontSize.Normal},{children:t}))]}),e)}_onAddParticipantPress(){l.default.addParticipant(this.props.route.params.callId)}_resetParticipants(){l.default.resetParticipants(this.props.route.params.callId)}_onRemoveParticipantPress(){l.default.removeParticipants(this.props.route.params.callId)}_onGroupParticipantPress(){l.default.addGroupParticipants(this.props.route.params.callId)}}t.default=T},652120:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(996074),o=i(500091),s=i(346565),r=i(746096),l=i(436237),c=i(451070),d=i(853374);class u extends n.BaseNavigationView{_buildState(e,t){return{topPadding:c.default.statusBarPadding()}}componentDidMount(){super.componentDidMount();const e=d.default.newCauseId();l.log(r.LogTraceArea.CallingUI,"CallTranscriptionStackPanel.componentDidMount causeId: "+e),s.default.setCallViewVisible(this.props.route.params.callId,!1,e)}componentWillUnmount(){super.componentWillUnmount();const e=d.default.newCauseId();l.log(r.LogTraceArea.CallingUI,"CallTranscriptionStackPanel.componentWillUnmount causeId: "+e),s.default.setCallViewVisible(this.props.route.params.callId,!0,e)}render(){return(0,a.jsx)(o.default,{callId:this.props.route.params.callId,conversationMri:this.props.route.params.conversationMri,reactionsMri:this.props.route.params.reactionMri,topPadding:this.state.topPadding},"callTranscriptionPanelView")}_componentId(){return"CallTranscriptionStackPanel"}}t.default=u},524360:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(496486),s=i(583367),r=i(67930),l=i(752754),c=i(780128),d=i(817456),u=i(341444),h=i(437490),p=i(746096),g=i(436237),C=i(915877),S=i(733754),m=i(104735),y=i(330124),f=i(772136),b=i(789871),_=i(29130),T=i(451070),v=i(190631),w=i(853374),I=i(897634),P=(i(340395),(0,C.lazyProperties)({panel:()=>n.Styles.createViewStyle({alignSelf:"stretch",flex:1}),headerContainer:()=>n.Styles.createViewStyle({alignItems:"stretch",flexDirection:"column"})}));class M extends r.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._searchActive=!1,this._onSearchActive=e=>{this._showOrHideHeader(this.state,!e,!0),e||this.setState({query:""}),this.setState({isExpanded:e})},this._onPressClose=e=>{this._close()},this._onCountrySelected=e=>{this.props.route.params.onCountrySelected?this.props.route.params.onCountrySelected(e):b.default.setSelectedCountry(this.state.countries[e],!0),this._close()},this._onSearch=e=>{this.isComponentMounted()&&(this.setState({query:e}),this._countryListRef&&this._countryListRef.onFilterChange(e))},this._onCountryListRef=e=>{this._countryListRef=e||void 0}}static getHeaderText(){return S.getString("PSTNCountrySelectorPanel.Title")}_buildState(e,t){const i=this._getRootViewId();let a=f.default.getCountries();if(e.route.params.countriesFiltered){a=o.pickBy(a,(function(t,i){return o.includes(e.route.params.countriesFiltered,t.country)}))}const r={countries:a,statusBarPadding:T.default.statusBarPadding(),isPortrait:_.default.getDeviceOrientation(i)===s.DeviceOrientation.Portrait,isUsingStackNavigationContext:y.default.isUsingStackNavigationContext(),isSmallDevice:_.default.isSmallDevice(i),isExpanded:!1};return t&&(r.query="",this._headerAnimatedHeightValue=new n.Animated.Value(c.default.expandedHeight(i)),this._headerAnimatedHeightStyle=n.Styles.createAnimatedViewStyle({height:this._headerAnimatedHeightValue}),this._headerAnimatedTopValue=new n.Animated.Value(0),this._headerAnimatedTopStyle=n.Styles.createAnimatedViewStyle({transform:[{translateY:this._headerAnimatedTopValue}]})),r}render(){const{primaryBackgroundColorStyle:e}=I.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride);return(0,a.jsxs)(n.View,Object.assign({style:[P.panel,e]},{children:[!1,this._renderHeaderContainer(),(0,a.jsx)(d.default,{ref:this._onCountryListRef,countries:this.state.countries,recentCountries:this.props.route.params.hideRecentCountries?void 0:b.default.getLast5CalledCountriesNoSubscription(),onSelect:this._onCountrySelected})]}))}componentDidMount(){super.componentDidMount(),this._showOrHideHeader(this.state,!this._searchActive,!1)}UNSAFE_componentWillUpdate(e,t,i){super.UNSAFE_componentWillUpdate(e,t,i),this.state.statusBarPadding===t.statusBarPadding&&this.state.isPortrait===t.isPortrait||this._showOrHideHeader(t,!this._searchActive,!1)}_renderHeaderContainer(){let e;e=this.state.isUsingStackNavigationContext?(0,a.jsx)(l.default,{initialValue:1,showButtonWhenInactive:!0,placeholderText:S.getString("PSTNCountrySelector.SearchPlaceholder"),rawSearchQuery:this.state.query,onInputTextChange:this._onSearch,onActive:this._onSearchActive},"searchInputButton"):(0,a.jsx)(u.default,{placeholderText:S.getString("PSTNCountrySelector.SearchPlaceholder"),activePlaceholderText:S.getString("PSTNCountrySelector.SearchPlaceholder"),showButtonWhenInactive:!0,autoFocus:this.props.route.params.searchAutoFocus,autoFocusWhenActive:!0,rawSearchQuery:this.state.query,onInputTextChange:this._onSearch,onActive:this._onSearchActive},"searchInputButton");const t={closeButtonType:this.props.route.params.isAloneInNavStack||this._getContext().isPresentedByMobileStackNavigator?v.CloseButtonType.Close:v.CloseButtonType.Back,title:S.getString("Global.CloseButtonTitle"),onPress:this._onPressClose},i=(0,a.jsx)(v.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:t,hideBottomBorder:this.state.isUsingStackNavigationContext});let o;return o=this.state.isUsingStackNavigationContext?(0,a.jsx)(n.Animated.View,Object.assign({style:[P.headerContainer,this._headerAnimatedHeightStyle]},{children:(0,a.jsxs)(n.Animated.View,Object.assign({style:this._headerAnimatedTopStyle},{children:[i,e]}))})):(0,a.jsxs)(n.View,{children:[i,e]}),o}_showOrHideHeader(e,t,i=!0){this._searchActive=!t;const a=this._getRootViewId(),o=this._headerHeight(e),s=t?0:-1*o,r=t?o+c.default.collapsableHeight(a):c.default.expandedHeight(a)+e.statusBarPadding;i?n.Animated.parallel([n.Animated.timing(this._headerAnimatedTopValue,{toValue:s,duration:200,easing:n.Animated.Easing.Out()}),n.Animated.timing(this._headerAnimatedHeightValue,{toValue:r,duration:200,easing:n.Animated.Easing.Out()})]).start():(this._headerAnimatedTopValue.setValue(s),this._headerAnimatedHeightValue.setValue(r))}_headerHeight(e){return(e.isPortrait?e.isSmallDevice?v.HeaderHeightSmall:v.HeaderHeight:e.isSmallDevice?v.HeaderHeightLandscapeSmall:v.HeaderHeightLandscape)+e.statusBarPadding}_close(){const e=w.default.newCauseId();g.log(p.LogTraceArea.Navigation,"CountrySelector._close,  causeId: "+e),h.dismissAll(),m.default.goBack(e,this._getContext())}_getHeaderText(e){return M.getHeaderText()}}t.default=M},79274:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=(i(496486),i(583367),i(967593)),o=i(516778),s=i(889391),r=i(23680),l=i(67930),c=i(700190),d=i(468734),u=i(897306),h=i(877836),p=i(898278),g=i(862633),C=i(256586),S=i(745247),m=i(808113),y=i(796613),f=i(437490),b=i(746096),_=i(881722),T=i(208360),v=i(436237),w=i(915877),I=i(733754),P=i(89808),M=i(104735),k=i(330124),A=i(639254),R=(i(254344),i(29130)),x=i(451070),L=i(681115),V=i(778314),O=i(886045),B=i(255336),D=i(37627),E=i(295384),N=i(919364),F=i(699948),j=i(581760),U=i(680837),H=i(853374),z=i(897634),G=(0,w.lazyProperties)({dialerWrapper:()=>o.Styles.createViewStyle({backgroundColor:j.Color.darkThemeSecondaryBackground,flexDirection:"column",flexGrow:1,flexShrink:0,overflow:"visible"}),regularLightThemeBackground:()=>o.Styles.createViewStyle({backgroundColor:j.Color.transparent,bottom:0,left:0,position:"absolute",right:0,top:0}),accessibleLightThemeBackground:()=>o.Styles.createViewStyle({backgroundColor:j.Color.gray50,bottom:0,left:0,position:"absolute",right:0,top:0}),darkThemeBackground:()=>o.Styles.createViewStyle({backgroundColor:j.Color.gray400,bottom:0,left:0,position:"absolute",right:0,top:0}),firstGroupLandscape:()=>o.Styles.createViewStyle({flex:1,flexBasis:0}),secondGroup:()=>o.Styles.createViewStyle({bottom:0,left:0,position:"absolute",right:0}),secondGroupLandscape:()=>o.Styles.createViewStyle({flex:1,flexBasis:0,borderLeftWidth:1}),groups:()=>o.Styles.createViewStyle({alignSelf:"stretch",flex:1}),groupsLandscape:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row"}),itemDivider:()=>o.Styles.createViewStyle({backgroundColor:j.Color.gray400,height:1})});class W extends l.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._onScrollFastContactsSearch=()=>{const e=this._fastContactsSearch&&this._fastContactsSearch.state.isSingleSelection;!this._dialpadAnimation||this.state.isInLandscape||e||this._dialpadAnimation.toggleDialpadToCollapsedState(!0)},this._onItemPressedFastContactsSearch=()=>{this._dialpadAnimation&&!this.state.isInLandscape&&this._dialpadAnimation.toggleDialpadToCollapsedState(!1)},this._onRenderFastContactsSearch=()=>{const e=this._getSearchResultCount();if(O.default.shouldAnnounceForAccessibility()&&this._lastAnnouncedSearchCount!==e){this._lastAnnouncedSearchCount=e;const t=I.getString("SearchResultsList.SearchResultsAnnouncement",{count:e});o.Accessibility.announceForAccessibility(t)}!this._dialpadAnimation||this.state.isInLandscape||this._dialpadAnimation.isCollapsed()||this._balancePanelAnimation&&this._fastContactsSearch&&this._balancePanelAnimation.toggleBalancePanelVisibility(this._fastContactsSearch.state.isSingleSelection||e>=1)},this._renderDialpadView=()=>{const{colorThemeOverride:e}=this.props.route.params,{primaryBackgroundColorStyle:t,dividerColorStyle:i}=z.themeStyles(this._getContext(),e),n=[G.dialerWrapper];this.state.bottomSafeAreaInset&&n.push(L.default.paddingBottomStyle(this.state.bottomSafeAreaInset)),z.isUsingDarkTheme(this._getContext(),e)||n.push(t);const s=[G.itemDivider];z.isUsingDarkTheme(this._getContext(),e)||s.push(i);const l=this.state.isInLandscape?void 0:(0,a.jsx)(o.View,{style:s});return(0,a.jsxs)(o.View,Object.assign({style:n},{children:[this.state.isInLandscape?void 0:this._renderCallerIdCTA(),l,(0,a.jsx)(r.default,Object.assign({ref:this._onBalancePanelAnimationRef,isInLandscape:this.state.isInLandscape,onCannotToggle:this._onCannotToggleBalancePanelAnimation},{children:(0,a.jsx)(N.default,{isLandscape:this.state.isInLandscape,location:_.ExperimentLocation.DialerPanel})})),(0,a.jsxs)(S.default,Object.assign({ref:this._onDialpadAnimationRef,isInLandscape:this.state.isInLandscape,onToggleStart:this._onToggleStartDialpadAnimation,onToggleCompletion:this._onToggleCompletionDialpadAnimation,onHeightsChanged:this._onHeightsChangedDialpadAnimation},{children:[(0,a.jsx)(C.default,{ref:this._onDialpadRef,isInLandscape:this.state.isInLandscape,isDtmfDialpad:!1,enableExtensionDialing:this.state.extensionDialingEnabled}),(0,a.jsx)(m.default,{callId:this.props.route.params.callId,conversationId:this.props.route.params.conversationId})]}))]}))},this._onPress=()=>{this._dialpadAnimation&&this._dialpadAnimation.toggleDialpadToCollapsedState(!1)},this._onContactSaved=()=>{this._dialpadAnimation&&!this.state.isInLandscape&&!this._dialpadAnimation.isCollapsed()&&this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(!1)},this._onCallerIdDialpadCtaPress=()=>{const e=H.default.newCauseId();v.log(b.LogTraceArea.Navigation,"DialerPanel._onCallerIdDialpadCtaPress,  causeId: "+e),h.default.registerCallerIdDialerCTAClick(),M.default.navigateToCallerIdSettingsPanel(this._getRootViewId(),e)},this._onFastContactsSearchRef=e=>{this._fastContactsSearch=e||void 0},this._onSearchSpacerAnimationRef=e=>{this._searchSpacerAnimation=e||void 0},this._onBalancePanelAnimationRef=e=>{this._balancePanelAnimation=e||void 0},this._onCannotToggleBalancePanelAnimation=e=>!e&&!!this._dialpadAnimation&&this._dialpadAnimation.isCollapsed(),this._onDialpadAnimationRef=e=>{this._dialpadAnimation=e||void 0},this._onDialpadRef=e=>{this._dialpad=e||void 0},this._onDialpadHeaderRef=e=>{this._dialpadHeader=e||void 0},this._onToggleStartDialpadAnimation=e=>{this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToHiddenState(),e&&this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(!0)},this._onToggleCompletionDialpadAnimation=e=>{e?this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToCollapsedState():(this._balancePanelAnimation&&this._balancePanelAnimation.toggleBalancePanelVisibility(this._getSearchResultCount()>=1),this._searchSpacerAnimation&&this._searchSpacerAnimation.toggleToExpandedState(),this._dialpad&&this._dialpad.focusFirst()),g.default.toggleDialpadCollapse(e)},this._onHeightsChangedDialpadAnimation=(e,t)=>{this._searchSpacerAnimation&&this._searchSpacerAnimation.setState({expandedHeight:e,collapsedHeight:t})}}_buildState(e,t){const i=k.default.isUsingStackNavigationContext(),a=this._getRootViewId(),{callId:n,conversationId:o,prefilledNumber:r,reopenOnInvalidNumber:l}=e.route.params,c=R.default.isHeightSmallerThanThreshold(R.default.getWidth(a),a)&&R.default.isHeightSmallerThanThreshold(625,a),d=R.default.isSmallOrTinyScreenSize(a);let u=this._getContext().isPresentedInDesktopSubview?void 0:x.default.horizontalInsets(p.HorizontalInsetDefault);u&&c&&(u={left:u.left,right:0});const h=g.default.isSaveContactVisible(l,r),C=g.default.isCallerIdCTAVisibleInPortrait(l,r),S=g.default.isCallerIdCTAVisibleInLandscape(l,r),m=s.default.getS4LEntitlementFeatures().SCE.Dialpad.Features.ExtensionDialingEnabled;return{screenWidth:R.default.getWidth(a),isSmallOrTinyScreenSize:d,bottomSafeAreaInset:x.default.bottomSafeAreaInset(p.BottomInsetDefault),isInLandscape:c,safeAreaHorizontalInsets:u,isUsingStackNavigationContext:i,shouldShowSaveContact:h,shouldShowCallerIdCTAPortrait:C,shouldShowCallerIdCTALandscape:S,extensionDialingEnabled:m&&void 0===o&&void 0===n,shouldShowRateAboveSelectedContact:g.default.shouldShowRateAboveSelectedContact(),enableRefreshedPalette:s.default.getS4LUiFeatures().enableRefreshedPalette}}UNSAFE_componentWillMount(){super.UNSAFE_componentWillMount(),f.dismissAll()}componentDidMount(){super.componentDidMount(),F.default.dialpadRendered(),d.default.notifyDialpadCTAShown(),E.default.showPromptIfNeeded(this.props.route.params.conversationId||p.MainRootViewId)}componentWillUnmount(){super.componentWillUnmount(),g.default.resetDialerPanelState()}render(){const{colorThemeOverride:e,isAloneInNavStack:t}=this.props.route.params,{primaryBackgroundColorStyle:i,searchBoxColorStyle:s,dividerBorderColorStyle:r}=z.themeStyles(this._getContext(),e),l=[G.dialerWrapper,i];let c;if(z.isUsingDarkTheme(this._getContext(),e))l.push(s),c=(0,a.jsx)(o.View,{style:G.darkThemeBackground});else if(z.isUsingAccessibleTheme(this._getContext(),e)){const e=[G.accessibleLightThemeBackground];this.state.enableRefreshedPalette&&e.push(o.Styles.createViewStyle({backgroundColor:this._getContext().themeColors.surfacePrimary},!1)),c=(0,a.jsx)(o.View,{style:e})}else c=(0,a.jsx)(n.GradientView,{style:G.regularLightThemeBackground,colors:P.default.getGradientColorsNoSubscription(),direction:n.GradientDirection.BOTTOM_RIGHT});return(0,a.jsxs)(o.View,Object.assign({style:this.state.isInLandscape?G.groupsLandscape:G.groups},{children:[(0,a.jsxs)(o.View,Object.assign({style:this.state.isInLandscape?G.firstGroupLandscape:U.default.flexOne},{children:[c,(0,a.jsx)(y.default,{ref:this._onDialpadHeaderRef,isUsingStackNavigationContext:this.state.isUsingStackNavigationContext,isAloneInNavStack:t,isInLandscape:this.state.isInLandscape,maxWidth:this.state.screenWidth?this.state.screenWidth-100:0}),this._renderPhoneNumberInput(),this.state.shouldShowRateAboveSelectedContact?this._renderCallRates():this._renderSelectedContact(),this._renderSaveContact(),this.state.shouldShowRateAboveSelectedContact?this._renderSelectedContact():this._renderCallRates(),(0,a.jsx)(T.default,{ref:this._onFastContactsSearchRef,isInLandscape:this.state.isInLandscape,safeAreaHorizontalInsets:this.state.safeAreaHorizontalInsets,onScroll:this._onScrollFastContactsSearch,onItemPressed:this._onItemPressedFastContactsSearch,onRender:this._onRenderFastContactsSearch}),(0,a.jsx)(B.default,{ref:this._onSearchSpacerAnimationRef,isInLandscape:this.state.isInLandscape}),this.state.isInLandscape?this._renderCallerIdCTA():void 0]})),(0,a.jsx)(o.View,Object.assign({style:this.state.isInLandscape?[G.secondGroupLandscape,r]:G.secondGroup},{children:(0,a.jsx)(o.View,Object.assign({style:l},{children:this._renderDialpadView()}))}))]}))}_renderCallRates(){return(0,a.jsx)(u.default,{},"callRates")}_renderSelectedContact(){return(0,a.jsx)(D.default,{},"selectedContact")}_renderSaveContact(){if(!this.state.shouldShowSaveContact)return;return(0,a.jsx)(V.default,{onContactSaved:this._onContactSaved})}_renderPhoneNumberInput(){const{callId:e,conversationId:t,prefilledNumber:i,reopenOnInvalidNumber:n,navigationSource:o}=this.props.route.params;return(0,a.jsx)(A.default,{onPress:this._onPress,callId:e,conversationId:t,isInLandscape:this.state.isInLandscape,prefilledInput:i,openedOnInvalidNumberError:n,navigationSource:o})}_renderCallerIdCTA(){if((this.state.isInLandscape||this.state.shouldShowCallerIdCTAPortrait)&&(!this.state.isInLandscape||this.state.shouldShowCallerIdCTALandscape))return(0,a.jsx)(c.default,{onMount:h.default.registerCallerIdDialerCTAOpen,onPress:this._onCallerIdDialpadCtaPress,isSmallScreen:this.state.isSmallOrTinyScreenSize})}_safeAreaMarginStyle(){if(this.state.safeAreaHorizontalInsets&&L.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets))return L.default.horizontalMarginStyle(this.state.safeAreaHorizontalInsets)}_getSearchResultCount(){return this._fastContactsSearch?this._fastContactsSearch.state.profiles.length:0}_getHeaderText(e){return W.getHeaderText()}static getHeaderText(){return I.getString("PSTNDialerPanel.PSTNDialerPanelAccessibilityTitle")}}t.default=W},594641:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(516778),s=i(244770),r=i(787720),l=i(219784),c=i(889391),d=i(67930),u=i(898278),h=i(759799),p=i(746096),g=i(110117),C=i(436237),S=i(915877),m=i(733754),y=i(178735),f=i(46929),b=i(104735),_=i(330124),T=i(735426),v=i(451070),w=i(413262),I=i(190631),P=i(22222),M=i(581760),k=i(311010),A=i(711828),R=i(359433),x=i(680837),L=i(619675),V=i(897634),O=i(853374),B=(0,S.lazyProperties)({panel:()=>o.Styles.createViewStyle({flex:1,alignSelf:"stretch"}),innerContainer:()=>o.Styles.createViewStyle({alignSelf:"stretch",marginTop:16,marginHorizontal:20,overflow:"visible",flexGrow:1}),titlePadding:()=>o.Styles.createTextStyle({paddingTop:4,paddingBottom:16}),textPadding:()=>o.Styles.createTextStyle({paddingBottom:16}),toggle:()=>o.Styles.createViewStyle({flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginTop:16,paddingTop:4}),toggleText:()=>o.Styles.createTextStyle({flex:1,marginRight:20}),actionButton:()=>o.Styles.createViewStyle({flex:1,alignSelf:"center",marginVertical:16,minWidth:160}),bullet:()=>o.Styles.createViewStyle({flex:1,flexDirection:"row",marginBottom:12}),bulletText:()=>o.Styles.createTextStyle({font:k.default.font.uiDisplaySemibold}),bulletIcon:()=>o.Styles.createViewStyle({marginTop:-2,marginHorizontal:16}),locationImage:()=>o.Styles.createImageStyle({alignSelf:"center"}),locationImageSmall:()=>o.Styles.createImageStyle({marginVertical:20,width:110,height:125}),locationImageLarge:()=>o.Styles.createImageStyle({marginVertical:30,width:145,height:165})});class D extends d.BaseNavigationViewPresentedInModal{constructor(){super(...arguments),this._close=()=>{const e=O.default.newCauseId();C.log(p.LogTraceArea.Navigation,"E911AcknowledgementPanel._close, causeId: "+e),b.default.goBack(e,this._getContext())},this._onLeftButtonPress=()=>{if(this.state.isAcknowledged)y.default.setE911LocationConsentGranted(this.state.isLocationConsentToggleOn),this.state.isLocationConsentToggleOn&&h.default.updateLocationWithPermission(p.LocationUpdateReason.E911ConsentUpdate),this._close();else if(this.props.route.params.isAloneInNavStack||this.state.isUsingStackNavigationContext){const e=m.getString("E911AcknowledgementPanel.AcknowledgeDismissTitle"),t=m.getString("E911AcknowledgementPanel.AcknowledgeDismissMessage"),i=[{text:m.getString("E911AcknowledgementPanel.AcknowledgeDismissLabel"),onPress:this._close,isSubmit:!0},{text:m.getString("Global.CancelLabel"),isCancel:!0}];l.default.showWithOptions({title:e,dialogAccessibilityTitle:t,message:t,buttons:i,rootViewId:this._getRootViewId()})}else this._close()},this._onScrollToBottomViewRef=e=>{this._scrollToBottomViewRef=e||void 0},this._onScrollToBottom=()=>{this.state.isAcknowledged||this.state.isAcknowledgementReviewed||(C.log(p.LogTraceArea.Phone,"E911AcknowledgementPanel: Acknowledgement reviewed."),this.setState({isAcknowledgementReviewed:!0}))},this._onLocationFAQLinkPress=e=>{e.stopPropagation(),e.preventDefault();const t=c.default.getS4LEntitlementFeaturesNoSubscription().SCE.Dialpad.E911;o.Linking.openUrl(t.locationFAQLink)},this._onLocationConsentToggleChange=(e,t)=>{this.setState({isLocationConsentToggleOn:t})},this._onActionButtonPress=()=>{var e;this.state.isAcknowledged?h.default.requiresSystemPermission?h.default.requestLocationPermission().then((()=>this._onLocationConsent(!0))).catch((()=>this._onLocationConsent(!1))):this._onLocationConsent(this.state.isLocationConsentToggleOn):this.state.isUsingStackNavigationContext||this.state.isAcknowledgementReviewed?(f.default.setE911Acknowledged(!0),C.track(new T.E911AcknowledgementEvent),this.state.shouldRequestLocationConsent||this.props.route.params.onComplete()):null===(e=this._scrollToBottomViewRef)||void 0===e||e.scrollToBottom()},this._onLocationConsent=e=>{y.default.setE911LocationConsentGranted(e),C.track(new T.E911LocationConsentEvent(e)),e&&(h.default.requiresSystemPermission?h.default.updateLocation(p.LocationUpdateReason.E911ConsentUpdate):h.default.updateLocationWithPermission(p.LocationUpdateReason.E911ConsentUpdate)),this.props.route.params.onComplete()}}static getHeaderText(){return m.getString("E911AcknowledgementPanel.PanelHeader")}_getHeaderText(e){return D.getHeaderText()}_buildState(e,t){const i={isAcknowledged:f.default.isE911Acknowledged(),shouldRequestLocationConsent:!e.route.params.shouldSkipLocationConsent&&h.default.isLocationEnabled()&&n.isUndefined(y.default.isE911LocationConsentGranted()),isUsingStackNavigationContext:_.default.isUsingStackNavigationContext(),safeAreaHorizontalPaddingStyle:this._getContext().isPresentedInDesktopSubview?void 0:v.default.horizontalPaddingStyle(u.HorizontalInsetZero)};return t&&(i.isAcknowledgementReviewed=!1,i.isLocationConsentToggleOn=!1),i}render(){const e={closeButtonType:this.props.route.params.isAloneInNavStack||this.state.isUsingStackNavigationContext?I.CloseButtonType.Close:I.CloseButtonType.Back,onPress:this._onLeftButtonPress},{primaryBackgroundColorStyle:t}=V.themeStyles(this._getContext(),this.props.route.params.colorThemeOverride),i=(0,a.jsx)(I.SimplePanelHeader,{panelName:this._getHeaderText(this.state),leftButton:e}),n=this.state.isUsingStackNavigationContext?this._getStackNavigationContent():this._getContent();return(0,a.jsxs)(o.View,Object.assign({style:[B.panel,t]},{children:[i,n]}))}_getContent(){return(0,a.jsxs)(o.View,Object.assign({style:x.default.flexOne},{children:[(0,a.jsx)(w.default,Object.assign({style:x.default.flexOne,ref:this._onScrollToBottomViewRef,onScrollToBottom:this._onScrollToBottom},{children:(0,a.jsxs)(o.View,Object.assign({style:this._getInnerContainerStyles()},{children:[this._getAcknowledgementSection(),this._getLocationConsentSection()]}))})),(0,a.jsx)(o.View,{children:this._getActionButton()})]}))}_getStackNavigationContent(){return(0,a.jsx)(o.ScrollView,Object.assign({style:x.default.flexOne},{children:(0,a.jsxs)(o.View,Object.assign({style:this._getInnerContainerStyles()},{children:[this._getAcknowledgementSection(),this._getLocationConsentSection(),this._getActionButton()]}))}))}_getInnerContainerStyles(){const e=[B.innerContainer];return this.state.safeAreaHorizontalPaddingStyle&&e.push(this.state.safeAreaHorizontalPaddingStyle),e}_getAcknowledgementSection(){if(!this.state.isAcknowledged||!this.state.shouldRequestLocationConsent)return(0,a.jsxs)(o.View,{children:[(0,a.jsx)(L.BodyText,Object.assign({style:B.titlePadding,bold:!0},{children:m.getString("E911AcknowledgementPanel.DisclosureTitle")})),(0,a.jsx)(L.BodyText,Object.assign({style:B.textPadding},{children:m.getString("E911AcknowledgementPanel.DisclosureText1")})),(0,a.jsx)(L.BodyText,Object.assign({style:B.textPadding},{children:m.getString("E911AcknowledgementPanel.DisclosureText2")})),(0,a.jsx)(L.BodyText,Object.assign({style:B.titlePadding,bold:!0},{children:m.getString("E911AcknowledgementPanel.LimitationTitle")})),(0,a.jsx)(L.BodyText,{children:m.getString("E911AcknowledgementPanel.LimitationText")})]})}_getLocationConsentSection(){if(this.state.isAcknowledged&&this.state.shouldRequestLocationConsent)return(0,a.jsxs)(o.View,{children:[this._getLocationConsentText(),this._getLocationImage(),this._getLocationConsentBullets(),this._getLocationConsentToggle()]})}_getLocationConsentText(){const e=h.default.requiresSystemPermission?m.getString("E911AcknowledgementPanel.LocationConsentText3"):m.getString("E911AcknowledgementPanel.LocationConsentText1");return(0,a.jsx)(L.BodyText,{children:e})}_getLocationImage(){const e=[B.locationImage];return h.default.requiresSystemPermission?e.push(B.locationImageLarge):e.push(B.locationImageSmall),(0,a.jsx)(o.Image,{source:s.Collection.LOCATION_SHARE,style:e,resizeMode:"contain"})}_getLocationConsentBullets(){const e=m.getString("E911AcknowledgementPanel.LocationConsentText2"),t=(0,a.jsx)(o.Text,{children:e}),i=h.default.requiresSystemPermission?m.getString("E911AcknowledgementPanel.LocationConsentText5"):m.getString("E911AcknowledgementPanel.LocationConsentText4"),n=(0,a.jsx)(R.default,Object.assign({url:"#",style:B.bulletText,linkTextStyle:u.LinkTextStyle.BodyText,blue:!0,onPress:this._onLocationFAQLinkPress},{children:m.getString("Global.LearnMore")})),s=(0,a.jsxs)(o.Text,{children:[i," ",n]});return[this._getBullet(A.SkypeIcon.GPS,t,"bullet1"),this._getBullet(A.SkypeIcon.LiveLocation,s,"bullet2")]}_getBullet(e,t,i){const n=[x.default.flexOne,B.bulletText],{primaryTextColor:s}=V.themeColors(this._getContext(),this.props.route.params.colorThemeOverride),r=V.isUsingAccessibleTheme(this._getContext(),this.props.route.params.colorThemeOverride)?s:V.isUsingDarkTheme(this._getContext(),this.props.route.params.colorThemeOverride)?M.Color.gray300:M.Color.gray500;return(0,a.jsxs)(o.View,Object.assign({style:B.bullet},{children:[(0,a.jsx)(g.default,{icon:e,size:A.IconSize.size24,color:r,style:B.bulletIcon}),(0,a.jsx)(L.BodyText,Object.assign({style:n},{children:t}))]}),i)}_getLocationConsentToggle(){if(h.default.requiresSystemPermission)return;const e=m.getString("E911AcknowledgementPanel.LocationConsentToggleLabel");return(0,a.jsx)(r.default,Object.assign({style:B.toggle,isOn:this.state.isLocationConsentToggleOn,accessibilityLabel:e,onChange:this._onLocationConsentToggleChange},{children:(0,a.jsx)(L.BodyText,Object.assign({style:B.toggleText,bold:!0},{children:e}))}))}_getActionButton(){const e=this._getActionButtonTitle();return(0,a.jsx)(o.View,Object.assign({style:B.actionButton},{children:(0,a.jsx)(P.default,{buttonSize:u.SXButtonSize.Medium,title:e,allowTextWrap:!0,onPress:this._onActionButtonPress})}))}_getActionButtonTitle(){return this.state.isAcknowledged&&this.state.shouldRequestLocationConsent?m.getString("E911AcknowledgementPanel.ContinueLabel"):this.state.isUsingStackNavigationContext||this.state.isAcknowledgementReviewed?m.getString("E911AcknowledgementPanel.AcknowledgeLabel"):m.getString("Global.MoreButtonTitle")}}t.default=D},437876:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QuickCallNavigation=void 0;const a=i(785893),n=i(770170);t.QuickCallNavigation=e=>{const{conversationId:t,callId:i,newGroup:o,searchOnly:s}=e.route.params;return(0,a.jsx)(n.default,{conversationId:t,callId:i,newGroup:o,searchOnly:s,hideIllustration:!0})},t.default=t.QuickCallNavigation},577721:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(496486),o=i(583367),s=i(516778),r=i(219784),l=i(889391),c=i(996074),d=i(109520),u=i(471727),h=i(147204),p=i(898278),g=i(746096),C=i(110117),S=i(436237),m=i(648638),y=i(172490),f=i(915877),b=i(733754),_=i(178735),T=i(330124),v=i(29130),w=i(672997),I=i(451070),P=i(681115),M=i(910265),k=i(190631),A=i(404057),R=i(22222),x=i(581760),L=i(711828),V=i(360305),O=i(897634),B=i(429311),D=i(66123),E=i(789174),N=i(853374),F=x.Color.gray400,j=(0,f.lazyProperties)({panel:()=>s.Styles.createViewStyle({flex:1,flexDirection:"column",alignSelf:"stretch",backgroundColor:F}),modalContainerForAll:()=>s.Styles.createViewStyle({flex:1,flexDirection:"column",alignItems:"stretch",justifyContent:"flex-start",paddingTop:0,paddingLeft:20,paddingRight:20,paddingBottom:20}),backgroundsList:()=>s.Styles.createViewStyle({flexWrap:"wrap",flexDirection:"row",justifyContent:"center"}),backgroundsListParent:()=>s.Styles.createViewStyle({flex:1,flexWrap:"wrap",flexDirection:"column",justifyContent:"center",alignSelf:"center"}),header:()=>s.Styles.createViewStyle({paddingHorizontal:10,backgroundColor:F}),titleText:()=>s.Styles.createTextStyle({color:x.Color.white}),noteText:()=>s.Styles.createTextStyle({paddingLeft:8,color:x.Color.white}),noteTextRtl:()=>s.Styles.createTextStyle({paddingRight:8,color:x.Color.white}),divider:()=>s.Styles.createViewStyle({flex:1,height:void 0,minWidth:2}),button:()=>s.Styles.createViewStyle({width:180,marginTop:5}),buttonStacked:()=>s.Styles.createViewStyle({marginTop:5}),closeButton:()=>s.Styles.createViewStyle({height:50,paddingLeft:15,paddingRight:15}),infoAndButton:()=>s.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",alignItems:"center",marginHorizontal:10,marginTop:10}),infoAndButtonStacked:()=>s.Styles.createViewStyle({flexDirection:"row",flexWrap:"wrap",justifyContent:"center",alignItems:"center",marginHorizontal:10,marginTop:10}),infoIconAndText:()=>s.Styles.createViewStyle({flexDirection:"row",alignItems:"center",marginTop:5})});class U extends c.BaseNavigationView{constructor(){super(...arguments),this._onEscape=()=>(S.log(g.LogTraceArea.CallingUI,"TogetherModePanel._onEscape"),this._onClose(),!0),this._onClose=()=>{if(this._dismissPanel(),this.props.route.params.onClose){const e=this.props.route.params.isAudienceBotInCall;S.track(new d.TogetherModePanelActionEvent(d.TogetherModePanelActionOrigin.Cancel,e)),this.props.route.params.onClose()}},this._onBackgroundItemDoubleTap=()=>{this._applyTogetherMode()},this._onBackgroundSelected=(e,t)=>{S.log(g.LogTraceArea.CallingUI,"TogetherModePanel: _onBackgroundSelected "+A.default.asString(e.untranslatedName)),t&&this.state.isNavigatingWithKeyboard?this._requestToApplyTogetherMode():this.setState({selectedBackground:e})},this._requestToApplyTogetherMode=()=>{this.state.stackNavigation?this._showApplyConfirmationDialog():this._applyTogetherMode()}}_buildState(e,t){t&&(this._rootViewId=this._getRootViewId());const i=v.default.getWidth(this._rootViewId),a=w.default.responsiveWidthForSize(i),o=D.default.getTogetherModeBackgrounds(),s=n.first(o),r=t?e.route.params.selectedBackground||s:this.state.selectedBackground;S.log(g.LogTraceArea.CallingUI,`created new state backgroundsList ${o.length}`);const c=O.isUsingAccessibleTheme(this._getContext()),d=l.default.getS4LCMCFeatures(),h=u.default.isLightTheme()&&d.enableNewCallScreen&&_.default.getNewCallScreenDesignEnabled(),p=T.default.isUsingStackNavigationContext(),C=h||c||p;return{backgroundsList:o,hasBackgroundsSection:o.length>0,appWidth:i,selectedBackground:r,screenSize:a,isNavigatingWithKeyboard:m.default.isNavigatingWithKeyboard(),highContrastTheme:c,stackNavigation:p,defaultTheme:C,deviceOrientation:v.default.getDeviceOrientation(this._rootViewId),safeAreaHorizontalInsets:I.default.horizontalInsets(),isTablet:V.default.isTablet()}}componentDidMount(){super.componentDidMount(),y.default.addEscapeHandler(this._onEscape)}componentWillUnmount(){super.componentWillUnmount(),y.default.removeEscapeHandler(this._onEscape)}render(){const e=this.state.deviceOrientation===o.DeviceOrientation.Portrait,t=E.default.getBackgroundItemDimensions(this.state.stackNavigation,e,this.state.isTablet),i=this.state.stackNavigation,n=E.default.getModalWidth(this.state.screenSize,this.state.backgroundsList.length),r=E.default.getModalHeight(this.state.backgroundsList.length),l=i?void 0:n,c=[j.backgroundsList,s.Styles.createViewStyle({maxWidth:l},!1)],d=(0,a.jsx)(B.default,{style:c,backgroundsList:this.state.backgroundsList,itemWidth:t.width,itemHeight:t.height,selectedBackground:this.state.selectedBackground,isNavigatingWithKeyboard:this.state.isNavigatingWithKeyboard,onItemDoubleTap:this._onBackgroundItemDoubleTap,onItemSelected:this._onBackgroundSelected,accessibilityLabel:b.getString("TogetherModeModal.Title"),highContrastTheme:this.state.highContrastTheme,stackNavigation:this.state.stackNavigation,defaultTheme:this.state.defaultTheme}),u=[j.modalContainerForAll];if(!!this.state.safeAreaHorizontalInsets&&P.default.hasHorizontalSafeAreas(this.state.safeAreaHorizontalInsets)){const e=P.default.horizontalPaddingStyle(this.state.safeAreaHorizontalInsets);u.push(e)}const h=(0,a.jsxs)(s.View,Object.assign({style:u},{children:[(0,a.jsx)(s.View,Object.assign({style:j.backgroundsListParent},{children:d})),this._getInfoIconAndButton()]})),p=[j.panel],{primaryBackgroundColorStyle:g,primaryTextColorStyle:C}=this._getContext().themeStyles;this.state.defaultTheme&&p.push(g);const S=[j.header];this.state.defaultTheme&&S.push(g);const m=this.state.defaultTheme?C:j.titleText;return(0,a.jsx)(M.default,Object.assign({dialogId:"togetherMode",onClickOutside:this._onClose,maxWidth:n,maxHeight:r,fullScreen:i,useFullSizeContainer:!0},{children:(0,a.jsxs)(s.View,Object.assign({style:p},{children:[(0,a.jsx)(k.SimplePanelHeader,{panelName:this._getTitleText(),leftButton:this._getCancelButton(),style:S,titleTextStyle:m,hideBottomBorder:!this.state.stackNavigation,useCenteredControls:!0}),h]}))}))}_getCancelButton(){const{headerIconColor:e,iconHoverColor:t}=this._getContext().themeColors,i=this.state.defaultTheme?e:x.Color.white,a=this.state.defaultTheme?t:x.Color.gray100;return{closeButtonType:k.CloseButtonType.Close,title:b.getString("Global.CloseButtonTitle"),onPress:this._onClose,color:i,hoverColor:a}}_getApplyButton(){return(0,a.jsx)(R.default,{title:this._getApplyButtonText(),style:this.state.stackNavigation?j.buttonStacked:j.button,buttonSize:p.SXButtonSize.Medium,onPress:this._requestToApplyTogetherMode,disabled:!this.state.selectedBackground})}_getInfoIconAndButton(){const e=this.state.stackNavigation?j.infoAndButtonStacked:j.infoAndButton,{primaryTextColorStyle:t}=this._getContext().themeStyles,{headerIconColor:i}=this._getContext().themeColors,n=[this._getContext().isRTL?j.noteTextRtl:j.noteText];this.state.defaultTheme&&n.push(t);const o=this.state.defaultTheme?i:x.Color.white,r=this.state.stackNavigation?void 0:(0,a.jsxs)(s.View,Object.assign({style:j.infoIconAndText},{children:[(0,a.jsx)(C.default,{size:L.IconSize.size16,icon:L.SkypeIcon.Info,color:o}),(0,a.jsx)(s.Text,Object.assign({style:n},{children:b.getString("TogetherModeModal.AppliesToAllParticipantsNote")}))]}));return(0,a.jsxs)(s.View,Object.assign({style:e},{children:[r,this._getApplyButton()]}))}_getTitleText(){const e=this.state.deviceOrientation===o.DeviceOrientation.Portrait;return this.state.stackNavigation&&!this.state.isTablet&&e?b.getString("TogetherModeModal.TitleCompact"):b.getString("TogetherModeModal.Title")}_getApplyButtonText(){const e=this.state.deviceOrientation===o.DeviceOrientation.Portrait,t=this.state.stackNavigation&&!this.state.isTablet&&e;return this.props.route.params.isAudienceBotInCall||t?b.getString("TogetherModeModal.Apply"):b.getString("TogetherModeModal.ApplyAndEnable")}_showApplyConfirmationDialog(){const e=b.getString("TogetherModeModal.ConfirmTitle"),t=b.getString("TogetherModeModal.AppliesToAllParticipantsNote"),i=[{text:b.getString("Global.CancelLabel"),isCancel:!0,onPress:()=>{}},{text:b.getString("Global.ConfirmLabel"),isSubmit:!0,style:"destructive",onPress:()=>{this._applyTogetherMode()}}];r.default.showWithOptions({title:e,dialogAccessibilityTitle:t,message:t,buttons:i,rootViewId:this._getRootViewId()})}_dismissPanel(){if(this.state.stackNavigation){const e=N.default.newCauseId();this._goBack(e)}else h.default.dismissModal(D.default.getPanelId(),this._rootViewId)}_applyTogetherMode(){const e=this.props.route.params.isAudienceBotInCall,t=this.state.selectedBackground;n.isUndefined(t)?e?S.warn(g.LogTraceArea.CallingUI,"Attempting to change Together Mode background to undefined."):S.warn(g.LogTraceArea.CallingUI,"Attempting to start Together Mode without specifying a background."):(S.track(new d.TogetherModePanelActionEvent(d.TogetherModePanelActionOrigin.Apply,e)),this._dismissPanel(),e?this.props.route.params.onChangeBackground(t):this.props.route.params.onStartTogetherMode(t))}}t.default=U},417096:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(785893),n=i(516778),o=i(67930),s=i(190631),r=i(680837),l=i(733754),c=i(915877),d=i(313912),u=i(897634),h=(0,c.lazyProperties)({panel:()=>n.Styles.createViewStyle({flex:1,alignSelf:"stretch"})});class p extends o.BaseNavigationViewPresentedInModal{static getHeaderText(){return l.getString("MeetNowCallControls.TwinCam")}_getHeaderText(e){return p.getHeaderText()}render(){const{callId:e,conversationMri:t,isAloneInNavStack:i,onStopTwinCamPressed:o,colorThemeOverride:c}=this.props.route.params,{primaryBackgroundColorStyle:p}=u.themeStyles(this._getContext(),c);return(0,a.jsxs)(n.View,Object.assign({style:[h.panel,p]},{children:[(0,a.jsx)(s.SimplePanelHeader,{panelName:l.getString("MeetNowCallControls.TwinCam"),leftButton:{closeButtonType:i?s.CloseButtonType.Close:s.CloseButtonType.Back}}),(0,a.jsx)(n.ScrollView,Object.assign({style:r.default.flexOne},{children:(0,a.jsx)(d.default,{callId:e,conversationMri:t,leftOffset:0,onStopTwinCamPressed:o})}))]}))}}t.default=p},615315:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TwinCamPanel=t.TogetherModePanel=t.QuickCallNavigation=t.CallTranscriptionStackPanel=t.CallStatsView=t.CallRosterPanel=t.CallPreviewStackNavigation=t.CallPanel=t.BingBackgroundsPanelView=t.E911AcknowledgementPanel=t.DialerPanel=t.CountrySelector=void 0;var a=i(524360);Object.defineProperty(t,"CountrySelector",{enumerable:!0,get:function(){return a.default}});var n=i(79274);Object.defineProperty(t,"DialerPanel",{enumerable:!0,get:function(){return n.default}});var o=i(594641);Object.defineProperty(t,"E911AcknowledgementPanel",{enumerable:!0,get:function(){return o.default}});var s=i(924899);Object.defineProperty(t,"BingBackgroundsPanelView",{enumerable:!0,get:function(){return s.default}});var r=i(83940);Object.defineProperty(t,"CallPanel",{enumerable:!0,get:function(){return r.default}});var l=i(110604);Object.defineProperty(t,"CallPreviewStackNavigation",{enumerable:!0,get:function(){return l.default}});var c=i(691848);Object.defineProperty(t,"CallRosterPanel",{enumerable:!0,get:function(){return c.default}});var d=i(104096);Object.defineProperty(t,"CallStatsView",{enumerable:!0,get:function(){return d.default}});var u=i(652120);Object.defineProperty(t,"CallTranscriptionStackPanel",{enumerable:!0,get:function(){return u.default}});var h=i(437876);Object.defineProperty(t,"QuickCallNavigation",{enumerable:!0,get:function(){return h.default}});var p=i(577721);Object.defineProperty(t,"TogetherModePanel",{enumerable:!0,get:function(){return p.default}});var g=i(417096);Object.defineProperty(t,"TwinCamPanel",{enumerable:!0,get:function(){return g.default}})},704117:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(496486),n=i(706541),o=i(37802),s=i(746096),r=i(436237),l=i(18078),c=i(640363);class d extends n.BaseEntitlementsClient{getRates(e){const t=Date.now(),i=l.default.getSkypeId(),n="users/"+encodeURIComponent(i)+"/call-rates?Platform="+c.default.getSkypePlatformId()+a.map(e,((e,t)=>"&callNumbers["+t+"]="+encodeURIComponent(e))).join("");r.log(s.LogTraceArea.EntitlementsClient,"Performing call to ConsumerEntitlement: GET Call Rates");return this._performRequest(n,{acceptType:"application/json; ver=1.0"}).then((e=>{const i=a.keyBy(e.body,(e=>e.pstnNumber));return r.track(new o.RatesFetching(Date.now()-t)),i}))}}t.default=new d},99075:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(662783),n=i(889391),o=i(733754);class s extends a.GenericRestClient{constructor(){super(n.default.getConfigSettingsNoSubscription().pstn.host),this._ratesEndpoint=n.default.getConfigSettingsNoSubscription().pstn.ratesEndpoint}getConfig(e){const t=(e||o.getLocale()).toLowerCase()+".json";return this.performApiGet(this._ratesEndpoint+t)}}t.default=new s},111878:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0});const a=i(662783),n=i(889391),o=i(746096),s=i(436237),r=i(415963),l=i(216568),c=i(13159),d=i(794050),u=i(994214);class h extends c.SkypeRestClient{constructor(){super(n.default.getConfigSettingsNoSubscription().registrar.host),this._customErrorHandler=(e,t)=>401===t.statusCode&&t.body&&40102===t.body.code?(s.log(o.LogTraceArea.RegistrarService,"RegistrarClient got 401 w/error code 40102 from request -- nuking skypetoken"),u.default.skypeTokenInvalid(e.getRequestHeaders()["X-Skypetoken"]),a.ErrorHandlingType.DoNotRetry):(0,a.DefaultErrorHandler)(e,t),this._defaultOptions.mustHaveValidSkypeToken=!0,this._defaultOptions.customErrorHandler=this._customErrorHandler}_getHeaders(e){const t=super._getHeaders(e);return t["X-Skypetoken"]=u.default.getRawSkypeToken(),t}enumerateRegistrations(){return this.performApiGet(n.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl)}patchRegistrations(e,t,i){return this.performApiPatch(n.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl,JSON.stringify({path:e,timestamp:t,appId:i}),{contentType:"application/x-skype-remove-invalid-apns-binding+json"})}_getPostRegistrationUrl(){return n.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl+""}postRegistration(e){return l.default.CallingNodeId.waitUntilSet().then((()=>{const t=new d.default(r.ScenarioName.PNH_Post,void 0,{NodeId:l.default.CallingNodeId.get()||""});return t.start(),this.performApiPost(this._getPostRegistrationUrl(),e).then((()=>t.finish()),(e=>t.fail(e.statusCode.toString(),{body:JSON.stringify(e.body),statusText:e.statusText||""})))}))}deleteRegistration(e){return l.default.CallingNodeId.waitUntilSet().then((()=>{const t=new d.default(r.ScenarioName.PNH_Delete,void 0,{NodeId:l.default.CallingNodeId.get()||""});t.start();const i=n.default.getConfigSettingsNoSubscription().registrar.registrationRelativeUrl+"/"+e;return this.performApiDelete(i).then((()=>t.finish()),(e=>t.fail(e.statusCode.toString(),{body:JSON.stringify(e.body),statusText:e.statusText||""})))}))}}t.default=new h}}]);